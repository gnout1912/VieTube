const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CmBpR0aG-DX6lmGuN.js","assets/embed-C4piUvKA.js","assets/jschannel-DkCUG_QY.js","assets/embed-B6DOGqvw.css"])))=>i.map(i=>d[i]);
import{_ as ST}from"./embed-C4piUvKA.js";const Rd=globalThis||void 0||self;var CT=Object.defineProperty,wT=(n,e,t)=>e in n?CT(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Qe=(n,e,t)=>wT(n,typeof e!="symbol"?e+"":e,t);const AT={"filter:api.trending-videos.videos.list.params":!0,"filter:api.trending-videos.videos.list.result":!0,"filter:api.most-liked-videos.videos.list.params":!0,"filter:api.most-liked-videos.videos.list.result":!0,"filter:api.local-videos.videos.list.params":!0,"filter:api.local-videos.videos.list.result":!0,"filter:api.recently-added-videos.videos.list.params":!0,"filter:api.recently-added-videos.videos.list.result":!0,"filter:api.browse-videos.videos.list.params":!0,"filter:api.browse-videos.videos.list.result":!0,"filter:api.user-subscriptions-videos.videos.list.params":!0,"filter:api.user-subscriptions-videos.videos.list.result":!0,"filter:api.video-watch.video.get.params":!0,"filter:api.video-watch.video.get.result":!0,"filter:api.video-watch.video-playlist-elements.get.params":!0,"filter:api.video-watch.video-playlist-elements.get.result":!0,"filter:api.video-watch.video-threads.list.params":!0,"filter:api.video-watch.video-threads.list.result":!0,"filter:api.video-watch.video-thread-replies.list.params":!0,"filter:api.video-watch.video-thread-replies.list.result":!0,"filter:api.search.videos.list.params":!0,"filter:api.search.videos.list.result":!0,"filter:api.search.video-channels.list.params":!0,"filter:api.search.video-channels.list.result":!0,"filter:api.search.video-playlists.list.params":!0,"filter:api.search.video-playlists.list.result":!0,"filter:api.signup.registration.create.params":!0,"filter:api.my-library.video-playlist-elements.list.params":!0,"filter:api.my-library.video-playlist-elements.list.result":!0,"filter:internal.video-watch.player.build-options.params":!0,"filter:internal.video-watch.player.build-options.result":!0,"filter:internal.video-watch.player.load-options.params":!0,"filter:internal.video-watch.player.load-options.result":!0,"filter:internal.common.svg-icons.get-content.params":!0,"filter:internal.common.svg-icons.get-content.result":!0,"filter:left-menu.links.create.result":!0,"filter:upload.messages.create.result":!0,"filter:login.instance-about-plugin-panels.create.result":!0,"filter:signup.instance-about-plugin-panels.create.result":!0,"filter:share.video-embed-code.build.params":!0,"filter:share.video-embed-code.build.result":!0,"filter:share.video-playlist-embed-code.build.params":!0,"filter:share.video-playlist-embed-code.build.result":!0,"filter:share.video-embed-url.build.params":!0,"filter:share.video-embed-url.build.result":!0,"filter:share.video-playlist-embed-url.build.params":!0,"filter:share.video-playlist-embed-url.build.result":!0,"filter:share.video-url.build.params":!0,"filter:share.video-url.build.result":!0,"filter:share.video-playlist-url.build.params":!0,"filter:share.video-playlist-url.build.result":!0,"filter:video-watch.video-plugin-metadata.result":!0,"filter:internal.player.videojs.options.result":!0,"filter:internal.player.p2p-media-loader.options.result":!0,"filter:admin-users-list.bulk-actions.create.result":!0,"filter:admin-video-comments-list.actions.create.result":!0,"filter:admin-video-comments-list.bulk-actions.create.result":!0,"filter:user-moderation.actions.create.result":!0,"filter:admin-abuse-list.actions.create.result":!0},IT={"action:application.init":!0,"action:video-watch.init":!0,"action:video-watch.video.loaded":!0,"action:video-watch.player.loaded":!0,"action:video-watch.video-threads.loaded":!0,"action:video-watch.video-thread-replies.loaded":!0,"action:video-channel-create.init":!0,"action:video-channel-update.init":!0,"action:video-channel-update.video-channel.loaded":!0,"action:video-channel-videos.init":!0,"action:video-channel-videos.video-channel.loaded":!0,"action:video-channel-videos.videos.loaded":!0,"action:video-channel-playlists.init":!0,"action:video-channel-playlists.video-channel.loaded":!0,"action:video-channel-playlists.playlists.loaded":!0,"action:video-edit.init":!0,"action:video-edit.form.updated":!0,"action:login.init":!0,"action:search.init":!0,"action:router.navigation-end":!0,"action:signup.register.init":!0,"action:admin-plugin-settings.init":!0,"action:video-upload.init":!0,"action:video-url-import.init":!0,"action:video-torrent-import.init":!0,"action:go-live.init":!0,"action:auth-user.logged-in":!0,"action:auth-user.logged-out":!0,"action:auth-user.information-loaded":!0,"action:modal.video-download.shown":!0,"action:modal.share.shown":!0,"action:embed.player.loaded":!0};Object.assign({},AT,IT);const LT={"filter:api.videos.list.params":!0,"filter:api.videos.list.result":!0,"filter:api.video-playlist.videos.list.params":!0,"filter:api.video-playlist.videos.list.result":!0,"filter:api.accounts.videos.list.params":!0,"filter:api.accounts.videos.list.result":!0,"filter:api.video-channels.videos.list.params":!0,"filter:api.video-channels.videos.list.result":!0,"filter:api.user.me.videos.list.params":!0,"filter:api.user.me.videos.list.result":!0,"filter:api.overviews.videos.list.params":!0,"filter:api.overviews.videos.list.result":!0,"filter:api.user.me.subscription-videos.list.params":!0,"filter:api.user.me.subscription-videos.list.result":!0,"filter:api.search.videos.local.list.params":!0,"filter:api.search.videos.local.list.result":!0,"filter:api.search.videos.index.list.params":!0,"filter:api.search.videos.index.list.result":!0,"filter:api.search.video-channels.local.list.params":!0,"filter:api.search.video-channels.local.list.result":!0,"filter:api.search.video-channels.index.list.params":!0,"filter:api.search.video-channels.index.list.result":!0,"filter:api.search.video-playlists.local.list.params":!0,"filter:api.search.video-playlists.local.list.result":!0,"filter:api.search.video-playlists.index.list.params":!0,"filter:api.search.video-playlists.index.list.result":!0,"filter:api.video.get.result":!0,"filter:api.video-channels.list.params":!0,"filter:api.video-channels.list.result":!0,"filter:api.video-channel.get.result":!0,"filter:api.video.upload.accept.result":!0,"filter:api.live-video.create.accept.result":!0,"filter:api.video.pre-import-url.accept.result":!0,"filter:api.video.pre-import-torrent.accept.result":!0,"filter:api.video.post-import-url.accept.result":!0,"filter:api.video.post-import-torrent.accept.result":!0,"filter:api.video.update-file.accept.result":!0,"filter:api.video.user-import.accept.result":!0,"filter:api.video-thread.create.accept.result":!0,"filter:api.video-comment-reply.create.accept.result":!0,"filter:api.video.upload.video-attribute.result":!0,"filter:api.video.import-url.video-attribute.result":!0,"filter:api.video.import-torrent.video-attribute.result":!0,"filter:api.video.live.video-attribute.result":!0,"filter:api.video.user-import.video-attribute.result":!0,"filter:api.video-threads.list.params":!0,"filter:api.video-threads.list.result":!0,"filter:api.video-thread-comments.list.params":!0,"filter:api.video-thread-comments.list.result":!0,"filter:api.server.stats.get.result":!0,"filter:video.auto-blacklist.result":!0,"filter:api.user.signup.allowed.result":!0,"filter:api.user.request-signup.allowed.result":!0,"filter:api.download.video.allowed.result":!0,"filter:api.download.generated-video.allowed.result":!0,"filter:api.download.torrent.allowed.result":!0,"filter:html.embed.video.allowed.result":!0,"filter:html.embed.video-playlist.allowed.result":!0,"filter:html.client.json-ld.result":!0,"filter:job-queue.process.params":!0,"filter:job-queue.process.result":!0,"filter:transcoding.manual.resolutions-to-transcode.result":!0,"filter:transcoding.auto.resolutions-to-transcode.result":!0,"filter:activity-pub.remote-video-comment.create.accept.result":!0,"filter:activity-pub.activity.context.build.result":!0,"filter:activity-pub.video.json-ld.build.result":!0,"filter:feed.podcast.rss.create-custom-xmlns.result":!0,"filter:feed.podcast.channel.create-custom-tags.result":!0,"filter:feed.podcast.video.create-custom-tags.result":!0,"filter:api.user.me.get.result":!0,"filter:oauth.password-grant.get-user.params":!0,"filter:api.email-verification.ask-send-verify-email.body":!0,"filter:api.users.ask-reset-password.body":!0,"filter:email.subject.result":!0,"filter:email.template-path.result":!0},kT={"action:application.listening":!0,"action:notifier.notification.created":!0,"action:api.video.updated":!0,"action:api.video.deleted":!0,"action:api.video.uploaded":!0,"action:api.video.viewed":!0,"action:api.video.file-updated":!0,"action:api.video-channel.created":!0,"action:api.video-channel.updated":!0,"action:api.video-channel.deleted":!0,"action:api.live-video.created":!0,"action:live.video.state.updated":!0,"action:api.video-thread.created":!0,"action:api.video-comment-reply.created":!0,"action:api.video-comment.deleted":!0,"action:api.video-caption.created":!0,"action:api.video-caption.deleted":!0,"action:api.user.blocked":!0,"action:api.user.unblocked":!0,"action:api.user.registered":!0,"action:api.user.requested-registration":!0,"action:api.user.created":!0,"action:api.user.deleted":!0,"action:api.user.updated":!0,"action:api.user.oauth2-got-token":!0,"action:api.video-playlist-element.created":!0,"action:activity-pub.remote-video.created":!0,"action:activity-pub.remote-video.updated":!0};Object.assign({},LT,kT);const ka={HIGH_LATENCY:2,SMALL_LATENCY:3},Ut={H_NOVIDEO:0,H_144P:144,H_240P:240,H_360P:360,H_480P:480,H_720P:720,H_1080P:1080,H_1440P:1440,H_4K:2160},Ra={VIOLENT:1,EXPLICIT_SEX:2};function ro(n){if(!n)return 0;if(typeof n=="number")return Math.floor(n);const e=new RegExp("^((?<hours>\\d+)h)?((?<minutes>\\d+)m)?((?<seconds>\\d+)s?)?$"),t=n.match(e);if(t){const a=parseInt(t.groups.hours||"0",10),l=parseInt(t.groups.minutes||"0",10),c=parseInt(t.groups.seconds||"0",10);return a*3600+l*60+c}const i=n.split(":").reverse(),s={0:1,1:60,2:3600};let r=0;for(let a=0;a<i.length;a++){const l=parseInt(i[a],10);if(isNaN(l))return 0;r+=s[a]*l}return r}function Os(n){var e;let t,i="short",s;typeof n=="number"?t=n:(t=n.seconds,i=(e=n.format)!==null&&e!==void 0?e:"short",s=n.symbol);let r="";if(t===0&&i!=="full")return"0s";const a=m=>i==="locale-string"?m.toLocaleString():m,l=s||"h",c=s||"m",h=i==="full"?"":"s",f=Math.floor(t/3600);f>=1&&f<10&&i==="full"?r="0"+f+l:f>=1?r=a(f)+l:i==="full"&&(r="00"+l),t%=3600;const p=Math.floor(t/60);return p>=1&&p<10&&i==="full"?r+="0"+p+c:p>=1?r+=a(p)+c:i==="full"&&(r+="00"+c),t=Math.round(t)%60,t>=1&&t<10&&i==="full"?r+="0"+t+h:t>=1?r+=a(t)+h:i==="full"&&(r+="00"),r}function $l(n,e){const t={};for(const i of e)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}function Pd(n,e){const t={},i=new Set(e);for(const[s,r]of Object.entries(n))i.has(s)||(t[s]=r);return t}function Eg(n,e){const t=new URL(n);for(const i of Object.keys(e))t.searchParams.append(i,e[i]);return t.toString()}function RT(n){const e=new URL(n);return e.searchParams.forEach((t,i)=>e.searchParams.delete(i)),e.toString()}function PT(n){return"/w/"+n.shortUUID}function nh(n,e){return window.location.origin+PT(n)}function bg(n){const{url:e}=n,t=new URLSearchParams;if(n.startTime!==void 0&&n.startTime!==null){const i=Math.floor(n.startTime);t.set("start",Os(i))}if(n.stopTime){const i=Math.floor(n.stopTime);t.set("stop",Os(i))}return n.subtitle&&t.set("subtitle",n.subtitle),n.loop===!0&&t.set("loop","1"),n.autoplay===!0&&t.set("autoplay","1"),n.muted===!0&&t.set("muted","1"),n.title===!1&&t.set("title","0"),n.warningTitle===!1&&t.set("warningTitle","0"),n.controls===!1&&t.set("controls","0"),n.controlBar===!1&&t.set("controlBar","0"),n.peertubeLink===!1&&t.set("peertubeLink","0"),n.p2p!==void 0&&t.set("p2p",n.p2p?"1":"0"),n.api!==void 0&&t.set("api",n.api?"1":"0"),n.version!==void 0&&t.set("v",n.version+""),DT(e,t)}function DT(n,e){let t=!1;return e.forEach(()=>{t=!0}),t?n+"?"+e.toString():n}const xT={"en-US":"English",ar:"العربية","ca-ES":"Català","cs-CZ":"Čeština","de-DE":"Deutsch","el-GR":"ελληνικά",eo:"Esperanto","es-ES":"Español","eu-ES":"Euskara","fa-IR":"فارسی","fi-FI":"Suomi","fr-FR":"Français",gd:"Gàidhlig","gl-ES":"Galego",hr:"Hrvatski","hu-HU":"Magyar",is:"Íslenska","it-IT":"Italiano","ja-JP":"日本語",kab:"Taqbaylit","nb-NO":"Norsk bokmål","nl-NL":"Nederlands",nn:"Norsk nynorsk",oc:"Occitan","pl-PL":"Polski","pt-BR":"Português (Brasil)","pt-PT":"Português (Portugal)","ru-RU":"Pусский","sk-SK":"Slovenčina",sq:"Shqip","sv-SE":"Svenska","th-TH":"ไทย",tok:"Toki Pona","tr-TR":"Türkçe","uk-UA":"украї́нська мо́ва","vi-VN":"Tiếng Việt","zh-Hans-CN":"简体中文（中国）","zh-Hant-TW":"繁體中文（台灣）"},Sg={"ar-001":"ar",ca:"ca-ES",cs:"cs-CZ",de:"de-DE",el:"el-GR",en:"en-US",es:"es-ES",eu:"eu-ES",fa:"fa-IR",fi:"fi-FI",fr:"fr-FR",gl:"gl-ES",hu:"hu-HU",it:"it-IT",ja:"ja-JP",nb:"nb-NO",nl:"nl-NL",pl:"pl-PL",pt:"pt-BR",ru:"ru-RU",sk:"sk-SK",sv:"sv-SE",th:"th-TH",tr:"tr-TR",uk:"uk-UA",vi:"vi-VN","zh-CN":"zh-Hans-CN","zh-Hans":"zh-Hans-CN","zh-Hant":"zh-Hant-TW","zh-TW":"zh-Hant-TW",zh:"zh-Hans-CN"},Cg=Object.keys(xT).concat(Object.keys(Sg));function OT(){return"en-US"}function wg(n){return bo(n)===bo(OT())}Cg.map(n=>"/"+n);function MT(n){return Cg.includes(n)}function bo(n){return n&&(Sg[n]||n)}function FT(n){return n.includes("-")===!1?n:n.split("-")[0]}const NT=new Set([Ut.H_NOVIDEO,Ut.H_144P,Ut.H_240P,Ut.H_360P,Ut.H_480P,Ut.H_720P,Ut.H_1080P,Ut.H_1440P,Ut.H_4K]),Dd={3840:Ut.H_4K,1920:Ut.H_1080P,1280:Ut.H_720P,854:Ut.H_480P,640:Ut.H_360P,426:Ut.H_240P,256:Ut.H_144P};function BT(n){const{height:e,width:t}=n;if(n.resolution===0)return"Audio only";let i=n.resolution;if(!NT.has(i)&&typeof e=="number"&&typeof t=="number"){const s=Math.max(e,t);Dd[s]&&(i=Dd[s])}return`${i}p`}function Ag(n,e){return e&&e>=50?n+e:n}const Cs=new Map;function xd(n){return new Proxy(n,{set:function(e,t,i){return Object.prototype.hasOwnProperty.call(ah,t)?n[t]=i:n.setItem(t,i),!0},get:function(e,t){if(typeof n[t]=="function")return n[t];if(Cs.has(t))return n.getItem(t)}})}class ah{getItem(e){const t=String(e);return Cs.has(e)?String(Cs.get(t)):null}setItem(e,t){Cs.set(String(e),String(t))}removeItem(e){Cs.delete(e)}clear(){Cs.clear()}key(e){if(arguments.length===0)throw new TypeError('Failed to execute "key" on "Storage": 1 argument required, but only 0 present.');return Array.from(Cs.keys())[e]}get length(){return Cs.size}}let or,Yn;function Ig(){const n=new ah,e=new ah;or=xd(n),Yn=xd(e)}try{or=localStorage,Yn=sessionStorage}catch{Ig()}(!or||!Yn)&&Ig();const Xi={ACCESS_TOKEN:"access_token",REFRESH_TOKEN:"refresh_token",TOKEN_TYPE:"token_type"};class qh{constructor(e){Qe(this,"accessToken"),Qe(this,"refreshToken"),Qe(this,"tokenType"),e&&(this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,e.tokenType==="bearer"?this.tokenType="Bearer":this.tokenType=e.tokenType)}static getUserTokens(e){const t=e.getItem(Xi.ACCESS_TOKEN),i=e.getItem(Xi.REFRESH_TOKEN),s=e.getItem(Xi.TOKEN_TYPE);return!t||!i||!s?null:new qh({accessToken:t,refreshToken:i,tokenType:s})}static saveToLocalStorage(e,t){e.setItem(Xi.ACCESS_TOKEN,t.accessToken),e.setItem(Xi.REFRESH_TOKEN,t.refreshToken),e.setItem(Xi.TOKEN_TYPE,t.tokenType)}static flushLocalStorage(e){e.removeItem(Xi.ACCESS_TOKEN),e.removeItem(Xi.REFRESH_TOKEN),e.removeItem(Xi.TOKEN_TYPE)}}let UT=class{constructor(){Qe(this,"hooks",[])}info(e,t){this.runHooks("info",e,t),t?console.log(e,t):console.log(e)}warn(e,t){this.runHooks("warn",e,t),this.clientWarn(e,t)}clientWarn(e,t){t?console.warn(e,t):console.warn(e)}error(e,t){this.runHooks("error",e,t),this.clientError(e,t)}clientError(e,t){t?console.error(e,t):console.error(e)}addHook(e,t){this.hooks.push({level:e,hook:t})}registerServerSending(e){this.addHook("warn",(t,i)=>this.sendClientLog(e,this.buildServerLogPayload("warn",t,i))),this.addHook("error",(t,i)=>this.sendClientLog(e,this.buildServerLogPayload("error",t,i)))}sendClientLog(e,t){if(!t)return;const i=new Headers({Accept:"application/json","Content-Type":"application/json"});try{const s=qh.getUserTokens(or);s&&i.set("Authorization",`${s.tokenType} ${s.accessToken}`)}catch(s){console.error("Cannot set tokens to client log sender.",{err:s})}fetch(e+"/api/v1/server/logs/client",{headers:i,method:"POST",body:JSON.stringify(t)}).catch(s=>console.error("Cannot send client warn/error to server.",s))}buildServerLogPayload(e,t,i){return t?{message:this.buildMessageServerLogPayload(t),userAgent:navigator.userAgent,url:window.location.href,level:e,stackTrace:this.buildStackServerLogPayload(t,i),meta:this.buildMetaServerLogPayload(i)}:null}buildMessageServerLogPayload(e){return typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}buildStackServerLogPayload(e,t){if(e instanceof Error)return this.buildStack(e);if(t instanceof Error)return this.buildStack(t);if(t?.err instanceof Error)return this.buildStack(t.err)}buildMetaServerLogPayload(e){if(!e||e instanceof Error)return;let t;try{t=JSON.stringify(e,(i,s)=>{if(i!=="err")return s})}catch(i){console.error("Cannot stringify meta.",i)}return t}runHooks(e,t,i){for(const s of this.hooks)s.level===e&&s.hook(t,i)}buildStack(e){return`${e.message}
${e.stack||""}`}};const ze=window.logger||new UT;window.logger=ze;const Lg=class Or{static getServerTranslations(e,t){const i=Or.getLocalePath(e,t);return i?fetch(i+"/server.json").then(s=>s.json()).catch(s=>{ze.error("Cannot get server translations",s)}):Promise.resolve(void 0)}static loadLocaleInVideoJS(e,t,i){const s=Or.getLocalePath(e,t);if(!s)return Promise.resolve(void 0);let r;Or.videojsLocaleCache[s]?r=Promise.resolve(Or.videojsLocaleCache[s]):r=fetch(s+"/player.json").then(l=>l.json()).then(l=>(Or.videojsLocaleCache[s]=l,l)).catch(l=>{ze.error("Cannot get player translations",l)});const a=bo(t);return r.then(l=>i.addLanguage(FT(a),l))}static getLocalePath(e,t){const i=bo(t);if(!(!MT(i)||wg(i)))return e+"/client/locales/"+i}};Qe(Lg,"videojsLocaleCache",{});let $T=Lg;function Hl(n,e){e||(e=document.body);const t=document.createElement("textarea");t.value=n,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",e.appendChild(t),t.select(),document.execCommand("copy"),e.removeChild(t)}function HT(n){return new Promise(e=>{setTimeout(()=>e(),n)})}function jT(n){const{embedUrl:e,embedTitle:t,aspectRatio:i,responsive:s=!1}=n,r=document.createElement("iframe");if(r.title=t,r.width=s?"100%":"560",r.height=s?"100%":"315",r.src=e,r.frameBorder="0",r.allowFullscreen=!0,r.sandbox.add("allow-same-origin","allow-scripts","allow-popups","allow-forms"),s){const a=document.createElement("div");return a.style.position="relative",a.style.paddingTop=i?(1/i*100).toFixed(2)+"%":"56.25%",r.style.position="absolute",r.style.inset="0",a.appendChild(r),a.outerHTML}return r.outerHTML}function VT(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:!!(navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel"))}function GT(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function So(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}var Co=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Rd<"u"?Rd:typeof self<"u"?self:{};function kg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function KT(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}),t}var jl,Od;function Go(){if(Od)return jl;Od=1;var n;return typeof window<"u"?n=window:typeof Co<"u"?n=Co:typeof self<"u"?n=self:n={},jl=n,jl}const qT={},WT=Object.freeze(Object.defineProperty({__proto__:null,default:qT},Symbol.toStringTag,{value:"Module"})),zT=KT(WT);var Vl,Md;function Rg(){if(Md)return Vl;Md=1;var n=typeof Co<"u"?Co:typeof window<"u"?window:{},e=zT,t;return typeof document<"u"?t=document:(t=n["__GLOBAL_DOCUMENT_CACHE@4"],t||(t=n["__GLOBAL_DOCUMENT_CACHE@4"]=e)),Vl=t,Vl}var Gl={exports:{}},Fd;function Pg(){return Fd||(Fd=1,function(n){function e(){return n.exports=e=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var r in s)({}).hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},n.exports.__esModule=!0,n.exports.default=n.exports,e.apply(null,arguments)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports}(Gl)),Gl.exports}var Pa={exports:{}},Nd;function YT(){return Nd||(Nd=1,function(n,e){function t(c){if(c&&typeof c=="object"){var h=c.which||c.keyCode||c.charCode;h&&(c=h)}if(typeof c=="number")return a[c];var f=String(c),p=i[f.toLowerCase()];if(p)return p;var p=s[f.toLowerCase()];if(p)return p;if(f.length===1)return f.charCodeAt(0)}t.isEventKey=function(h,f){if(h&&typeof h=="object"){var p=h.which||h.keyCode||h.charCode;if(p==null)return!1;if(typeof f=="string"){var m=i[f.toLowerCase()];if(m)return m===p;var m=s[f.toLowerCase()];if(m)return m===p}else if(typeof f=="number")return f===p;return!1}},e=n.exports=t;var i=e.code=e.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},s=e.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};/*!
 * Programatically add the following
 */for(r=97;r<123;r++)i[String.fromCharCode(r)]=r-32;for(var r=48;r<58;r++)i[r-48]=r;for(r=1;r<13;r++)i["f"+r]=r+111;for(r=0;r<10;r++)i["numpad "+r]=r+96;var a=e.names=e.title={};for(r in i)a[i[r]]=r;for(var l in s)i[l]=s[l]}(Pa,Pa.exports)),Pa.exports}var Kl={exports:{}},Bd;function XT(){return Bd||(Bd=1,function(n){function e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports}(Kl)),Kl.exports}var ql={exports:{}},Wl={exports:{}},Ud;function Wh(){return Ud||(Ud=1,function(n){function e(t,i){return n.exports=e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,r){return s.__proto__=r,s},n.exports.__esModule=!0,n.exports.default=n.exports,e(t,i)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports}(Wl)),Wl.exports}var $d;function QT(){return $d||($d=1,function(n){var e=Wh();function t(i,s){i.prototype=Object.create(s.prototype),i.prototype.constructor=i,e(i,s)}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports}(ql)),ql.exports}var zl,Hd;function JT(){if(Hd)return zl;Hd=1,zl=n;function n(e,t){var i,s=null;try{i=JSON.parse(e,t)}catch(r){s=r}return[s,i]}return zl}var Da={exports:{}},Yl,jd;function ZT(){if(jd)return Yl;jd=1,Yl=e;var n=Object.prototype.toString;function e(t){if(!t)return!1;var i=n.call(t);return i==="[object Function]"||typeof t=="function"&&i!=="[object RegExp]"||typeof window<"u"&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}return Yl}var Xl,Vd;function e_(){if(Vd)return Xl;Vd=1;var n=Go(),e=function(s,r){return r===void 0&&(r=!1),function(a,l,c){if(a){s(a);return}if(l.statusCode>=400&&l.statusCode<=599){var h=c;if(r)if(n.TextDecoder){var f=t(l.headers&&l.headers["content-type"]);try{h=new TextDecoder(f).decode(c)}catch{}}else h=String.fromCharCode.apply(null,new Uint8Array(c));s({cause:h});return}s(null,c)}};function t(i){return i===void 0&&(i=""),i.toLowerCase().split(";").reduce(function(s,r){var a=r.split("="),l=a[0],c=a[1];return l.trim()==="charset"?c.trim():s},"utf-8")}return Xl=e,Xl}var Gd;function t_(){if(Gd)return Da.exports;Gd=1;var n=Go(),e=Pg(),t=ZT();l.httpHandler=e_();/**
 * @license
 * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
 * Copyright (c) 2014 David Björklund
 * Available under the MIT license
 * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
 */var i=function(m){var _={};return m&&m.trim().split(`
`).forEach(function(E){var C=E.indexOf(":"),S=E.slice(0,C).trim().toLowerCase(),I=E.slice(C+1).trim();typeof _[S]>"u"?_[S]=I:Array.isArray(_[S])?_[S].push(I):_[S]=[_[S],I]}),_};Da.exports=l,Da.exports.default=l,l.XMLHttpRequest=n.XMLHttpRequest||f,l.XDomainRequest="withCredentials"in new l.XMLHttpRequest?l.XMLHttpRequest:n.XDomainRequest,s(["get","put","post","patch","head","delete"],function(p){l[p==="delete"?"del":p]=function(m,_,E){return _=a(m,_,E),_.method=p.toUpperCase(),c(_)}});function s(p,m){for(var _=0;_<p.length;_++)m(p[_])}function r(p){for(var m in p)if(p.hasOwnProperty(m))return!1;return!0}function a(p,m,_){var E=p;return t(m)?(_=m,typeof p=="string"&&(E={uri:p})):E=e({},m,{uri:p}),E.callback=_,E}function l(p,m,_){return m=a(p,m,_),c(m)}function c(p){if(typeof p.callback>"u")throw new Error("callback argument missing");var m=!1,_=function(ie,ne,ae){m||(m=!0,p.callback(ie,ne,ae))};function E(){R.readyState===4&&setTimeout(I,0)}function C(){var se=void 0;if(R.response?se=R.response:se=R.responseText||h(R),P)try{se=JSON.parse(se)}catch{}return se}function S(se){return clearTimeout(G),se instanceof Error||(se=new Error(""+(se||"Unknown XMLHttpRequest Error"))),se.statusCode=0,_(se,J)}function I(){if(!D){var se;clearTimeout(G),p.useXDR&&R.status===void 0?se=200:se=R.status===1223?204:R.status;var ie=J,ne=null;return se!==0?(ie={body:C(),statusCode:se,method:N,headers:{},url:x,rawRequest:R},R.getAllResponseHeaders&&(ie.headers=i(R.getAllResponseHeaders()))):ne=new Error("Internal XMLHttpRequest Error"),_(ne,ie,ie.body)}}var R=p.xhr||null;R||(p.cors||p.useXDR?R=new l.XDomainRequest:R=new l.XMLHttpRequest);var k,D,x=R.url=p.uri||p.url,N=R.method=p.method||"GET",B=p.body||p.data,H=R.headers=p.headers||{},O=!!p.sync,P=!1,G,J={body:void 0,headers:{},statusCode:0,method:N,url:x,rawRequest:R};if("json"in p&&p.json!==!1&&(P=!0,H.accept||H.Accept||(H.Accept="application/json"),N!=="GET"&&N!=="HEAD"&&(H["content-type"]||H["Content-Type"]||(H["Content-Type"]="application/json"),B=JSON.stringify(p.json===!0?B:p.json))),R.onreadystatechange=E,R.onload=I,R.onerror=S,R.onprogress=function(){},R.onabort=function(){D=!0},R.ontimeout=S,R.open(N,x,!O,p.username,p.password),O||(R.withCredentials=!!p.withCredentials),!O&&p.timeout>0&&(G=setTimeout(function(){if(!D){D=!0,R.abort("timeout");var se=new Error("XMLHttpRequest timeout");se.code="ETIMEDOUT",S(se)}},p.timeout)),R.setRequestHeader)for(k in H)H.hasOwnProperty(k)&&R.setRequestHeader(k,H[k]);else if(p.headers&&!r(p.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in p&&(R.responseType=p.responseType),"beforeSend"in p&&typeof p.beforeSend=="function"&&p.beforeSend(R),R.send(B||null),R}function h(p){try{if(p.responseType==="document")return p.responseXML;var m=p.responseXML&&p.responseXML.documentElement.nodeName==="parsererror";if(p.responseType===""&&!m)return p.responseXML}catch{}return null}function f(){}return Da.exports}var Ql={exports:{}},Jl,Kd;function i_(){if(Kd)return Jl;Kd=1;var n=Rg(),e=Object.create||function(){function O(){}return function(P){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return O.prototype=P,new O}}();function t(O,P){this.name="ParsingError",this.code=O.code,this.message=P||O.message}t.prototype=e(Error.prototype),t.prototype.constructor=t,t.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function i(O){function P(J,se,ie,ne){return(J|0)*3600+(se|0)*60+(ie|0)+(ne|0)/1e3}var G=O.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return G?G[3]?P(G[1],G[2],G[3].replace(":",""),G[4]):G[1]>59?P(G[1],G[2],0,G[4]):P(0,G[1],G[2],G[4]):null}function s(){this.values=e(null)}s.prototype={set:function(O,P){!this.get(O)&&P!==""&&(this.values[O]=P)},get:function(O,P,G){return G?this.has(O)?this.values[O]:P[G]:this.has(O)?this.values[O]:P},has:function(O){return O in this.values},alt:function(O,P,G){for(var J=0;J<G.length;++J)if(P===G[J]){this.set(O,P);break}},integer:function(O,P){/^-?\d+$/.test(P)&&this.set(O,parseInt(P,10))},percent:function(O,P){return P.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(P=parseFloat(P),P>=0&&P<=100)?(this.set(O,P),!0):!1}};function r(O,P,G,J){var se=J?O.split(J):[O];for(var ie in se)if(typeof se[ie]=="string"){var ne=se[ie].split(G);if(ne.length===2){var ae=ne[0].trim(),fe=ne[1].trim();P(ae,fe)}}}function a(O,P,G){var J=O;function se(){var ae=i(O);if(ae===null)throw new t(t.Errors.BadTimeStamp,"Malformed timestamp: "+J);return O=O.replace(/^[^\sa-zA-Z-]+/,""),ae}function ie(ae,fe){var ee=new s;r(ae,function(oe,re){switch(oe){case"region":for(var le=G.length-1;le>=0;le--)if(G[le].id===re){ee.set(oe,G[le].region);break}break;case"vertical":ee.alt(oe,re,["rl","lr"]);break;case"line":var Q=re.split(","),te=Q[0];ee.integer(oe,te),ee.percent(oe,te)&&ee.set("snapToLines",!1),ee.alt(oe,te,["auto"]),Q.length===2&&ee.alt("lineAlign",Q[1],["start","center","end"]);break;case"position":Q=re.split(","),ee.percent(oe,Q[0]),Q.length===2&&ee.alt("positionAlign",Q[1],["start","center","end"]);break;case"size":ee.percent(oe,re);break;case"align":ee.alt(oe,re,["start","center","end","left","right"]);break}},/:/,/\s/),fe.region=ee.get("region",null),fe.vertical=ee.get("vertical","");try{fe.line=ee.get("line","auto")}catch{}fe.lineAlign=ee.get("lineAlign","start"),fe.snapToLines=ee.get("snapToLines",!0),fe.size=ee.get("size",100);try{fe.align=ee.get("align","center")}catch{fe.align=ee.get("align","middle")}try{fe.position=ee.get("position","auto")}catch{fe.position=ee.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},fe.align)}fe.positionAlign=ee.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},fe.align)}function ne(){O=O.replace(/^\s+/,"")}if(ne(),P.startTime=se(),ne(),O.substr(0,3)!=="-->")throw new t(t.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+J);O=O.substr(3),ne(),P.endTime=se(),ne(),ie(O,P)}var l=n.createElement&&n.createElement("textarea"),c={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},h={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},f={v:"title",lang:"lang"},p={rt:"ruby"};function m(O,P){function G(){if(!P)return null;function te(be){return P=P.substr(be.length),be}var Se=P.match(/^([^<]*)(<[^>]*>?)?/);return te(Se[1]?Se[1]:Se[2])}function J(te){return l.innerHTML=te,te=l.textContent,l.textContent="",te}function se(te,Se){return!p[Se.localName]||p[Se.localName]===te.localName}function ie(te,Se){var be=c[te];if(!be)return null;var Pe=O.document.createElement(be),Me=f[te];return Me&&Se&&(Pe[Me]=Se.trim()),Pe}for(var ne=O.document.createElement("div"),ae=ne,fe,ee=[];(fe=G())!==null;){if(fe[0]==="<"){if(fe[1]==="/"){ee.length&&ee[ee.length-1]===fe.substr(2).replace(">","")&&(ee.pop(),ae=ae.parentNode);continue}var oe=i(fe.substr(1,fe.length-2)),re;if(oe){re=O.document.createProcessingInstruction("timestamp",oe),ae.appendChild(re);continue}var le=fe.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!le||(re=ie(le[1],le[3]),!re)||!se(ae,re))continue;if(le[2]){var Q=le[2].split(".");Q.forEach(function(te){var Se=/^bg_/.test(te),be=Se?te.slice(3):te;if(h.hasOwnProperty(be)){var Pe=Se?"background-color":"color",Me=h[be];re.style[Pe]=Me}}),re.className=Q.join(" ")}ee.push(le[1]),ae.appendChild(re),ae=re;continue}ae.appendChild(O.document.createTextNode(J(fe)))}return ne}var _=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function E(O){for(var P=0;P<_.length;P++){var G=_[P];if(O>=G[0]&&O<=G[1])return!0}return!1}function C(O){var P=[],G="",J;if(!O||!O.childNodes)return"ltr";function se(ae,fe){for(var ee=fe.childNodes.length-1;ee>=0;ee--)ae.push(fe.childNodes[ee])}function ie(ae){if(!ae||!ae.length)return null;var fe=ae.pop(),ee=fe.textContent||fe.innerText;if(ee){var oe=ee.match(/^.*(\n|\r)/);return oe?(ae.length=0,oe[0]):ee}if(fe.tagName==="ruby")return ie(ae);if(fe.childNodes)return se(ae,fe),ie(ae)}for(se(P,O);G=ie(P);)for(var ne=0;ne<G.length;ne++)if(J=G.charCodeAt(ne),E(J))return"rtl";return"ltr"}function S(O){if(typeof O.line=="number"&&(O.snapToLines||O.line>=0&&O.line<=100))return O.line;if(!O.track||!O.track.textTrackList||!O.track.textTrackList.mediaElement)return-1;for(var P=O.track,G=P.textTrackList,J=0,se=0;se<G.length&&G[se]!==P;se++)G[se].mode==="showing"&&J++;return++J*-1}function I(){}I.prototype.applyStyles=function(O,P){P=P||this.div;for(var G in O)O.hasOwnProperty(G)&&(P.style[G]=O[G])},I.prototype.formatStyle=function(O,P){return O===0?0:O+P};function R(O,P,G){I.call(this),this.cue=P,this.cueDiv=m(O,P.text);var J={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:P.vertical===""?"horizontal-tb":P.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(J,this.cueDiv),this.div=O.document.createElement("div"),J={direction:C(this.cueDiv),writingMode:P.vertical===""?"horizontal-tb":P.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:P.align==="middle"?"center":P.align,font:G.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(J),this.div.appendChild(this.cueDiv);var se=0;switch(P.positionAlign){case"start":case"line-left":se=P.position;break;case"center":se=P.position-P.size/2;break;case"end":case"line-right":se=P.position-P.size;break}P.vertical===""?this.applyStyles({left:this.formatStyle(se,"%"),width:this.formatStyle(P.size,"%")}):this.applyStyles({top:this.formatStyle(se,"%"),height:this.formatStyle(P.size,"%")}),this.move=function(ie){this.applyStyles({top:this.formatStyle(ie.top,"px"),bottom:this.formatStyle(ie.bottom,"px"),left:this.formatStyle(ie.left,"px"),right:this.formatStyle(ie.right,"px"),height:this.formatStyle(ie.height,"px"),width:this.formatStyle(ie.width,"px")})}}R.prototype=e(I.prototype),R.prototype.constructor=R;function k(O){var P,G,J,se;if(O.div){G=O.div.offsetHeight,J=O.div.offsetWidth,se=O.div.offsetTop;var ie=(ie=O.div.childNodes)&&(ie=ie[0])&&ie.getClientRects&&ie.getClientRects();O=O.div.getBoundingClientRect(),P=ie?Math.max(ie[0]&&ie[0].height||0,O.height/ie.length):0}this.left=O.left,this.right=O.right,this.top=O.top||se,this.height=O.height||G,this.bottom=O.bottom||se+(O.height||G),this.width=O.width||J,this.lineHeight=P!==void 0?P:O.lineHeight}k.prototype.move=function(O,P){switch(P=P!==void 0?P:this.lineHeight,O){case"+x":this.left+=P,this.right+=P;break;case"-x":this.left-=P,this.right-=P;break;case"+y":this.top+=P,this.bottom+=P;break;case"-y":this.top-=P,this.bottom-=P;break}},k.prototype.overlaps=function(O){return this.left<O.right&&this.right>O.left&&this.top<O.bottom&&this.bottom>O.top},k.prototype.overlapsAny=function(O){for(var P=0;P<O.length;P++)if(this.overlaps(O[P]))return!0;return!1},k.prototype.within=function(O){return this.top>=O.top&&this.bottom<=O.bottom&&this.left>=O.left&&this.right<=O.right},k.prototype.overlapsOppositeAxis=function(O,P){switch(P){case"+x":return this.left<O.left;case"-x":return this.right>O.right;case"+y":return this.top<O.top;case"-y":return this.bottom>O.bottom}},k.prototype.intersectPercentage=function(O){var P=Math.max(0,Math.min(this.right,O.right)-Math.max(this.left,O.left)),G=Math.max(0,Math.min(this.bottom,O.bottom)-Math.max(this.top,O.top)),J=P*G;return J/(this.height*this.width)},k.prototype.toCSSCompatValues=function(O){return{top:this.top-O.top,bottom:O.bottom-this.bottom,left:this.left-O.left,right:O.right-this.right,height:this.height,width:this.width}},k.getSimpleBoxPosition=function(O){var P=O.div?O.div.offsetHeight:O.tagName?O.offsetHeight:0,G=O.div?O.div.offsetWidth:O.tagName?O.offsetWidth:0,J=O.div?O.div.offsetTop:O.tagName?O.offsetTop:0;O=O.div?O.div.getBoundingClientRect():O.tagName?O.getBoundingClientRect():O;var se={left:O.left,right:O.right,top:O.top||J,height:O.height||P,bottom:O.bottom||J+(O.height||P),width:O.width||G};return se};function D(O,P,G,J){function se(be,Pe){for(var Me,De=new k(be),$e=1,Ve=0;Ve<Pe.length;Ve++){for(;be.overlapsOppositeAxis(G,Pe[Ve])||be.within(G)&&be.overlapsAny(J);)be.move(Pe[Ve]);if(be.within(G))return be;var Je=be.intersectPercentage(G);$e>Je&&(Me=new k(be),$e=Je),be=new k(De)}return Me||De}var ie=new k(P),ne=P.cue,ae=S(ne),fe=[];if(ne.snapToLines){var ee;switch(ne.vertical){case"":fe=["+y","-y"],ee="height";break;case"rl":fe=["+x","-x"],ee="width";break;case"lr":fe=["-x","+x"],ee="width";break}var oe=ie.lineHeight,re=oe*Math.round(ae),le=G[ee]+oe,Q=fe[0];Math.abs(re)>le&&(re=re<0?-1:1,re*=Math.ceil(le/oe)*oe),ae<0&&(re+=ne.vertical===""?G.height:G.width,fe=fe.reverse()),ie.move(Q,re)}else{var te=ie.lineHeight/G.height*100;switch(ne.lineAlign){case"center":ae-=te/2;break;case"end":ae-=te;break}switch(ne.vertical){case"":P.applyStyles({top:P.formatStyle(ae,"%")});break;case"rl":P.applyStyles({left:P.formatStyle(ae,"%")});break;case"lr":P.applyStyles({right:P.formatStyle(ae,"%")});break}fe=["+y","-x","+x","-y"],ie=new k(P)}var Se=se(ie,fe);P.move(Se.toCSSCompatValues(G))}function x(){}x.StringDecoder=function(){return{decode:function(O){if(!O)return"";if(typeof O!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(O))}}},x.convertCueToDOMTree=function(O,P){return!O||!P?null:m(O,P)};var N=.05,B="sans-serif",H="1.5%";return x.processCues=function(O,P,G){if(!O||!P||!G)return null;for(;G.firstChild;)G.removeChild(G.firstChild);var J=O.document.createElement("div");J.style.position="absolute",J.style.left="0",J.style.right="0",J.style.top="0",J.style.bottom="0",J.style.margin=H,G.appendChild(J);function se(oe){for(var re=0;re<oe.length;re++)if(oe[re].hasBeenReset||!oe[re].displayState)return!0;return!1}if(!se(P)){for(var ie=0;ie<P.length;ie++)J.appendChild(P[ie].displayState);return}var ne=[],ae=k.getSimpleBoxPosition(J),fe=Math.round(ae.height*N*100)/100,ee={font:fe+"px "+B};(function(){for(var oe,re,le=0;le<P.length;le++)re=P[le],oe=new R(O,re,ee),J.appendChild(oe.div),D(O,oe,ae,ne),re.displayState=oe.div,ne.push(k.getSimpleBoxPosition(oe))})()},x.Parser=function(O,P,G){G||(G=P,P={}),P||(P={}),this.window=O,this.vttjs=P,this.state="INITIAL",this.buffer="",this.decoder=G||new TextDecoder("utf8"),this.regionList=[]},x.Parser.prototype={reportOrThrowError:function(O){if(O instanceof t)this.onparsingerror&&this.onparsingerror(O);else throw O},parse:function(O){var P=this;O&&(P.buffer+=P.decoder.decode(O,{stream:!0}));function G(){for(var oe=P.buffer,re=0;re<oe.length&&oe[re]!=="\r"&&oe[re]!==`
`;)++re;var le=oe.substr(0,re);return oe[re]==="\r"&&++re,oe[re]===`
`&&++re,P.buffer=oe.substr(re),le}function J(oe){var re=new s;if(r(oe,function(Q,te){switch(Q){case"id":re.set(Q,te);break;case"width":re.percent(Q,te);break;case"lines":re.integer(Q,te);break;case"regionanchor":case"viewportanchor":var Se=te.split(",");if(Se.length!==2)break;var be=new s;if(be.percent("x",Se[0]),be.percent("y",Se[1]),!be.has("x")||!be.has("y"))break;re.set(Q+"X",be.get("x")),re.set(Q+"Y",be.get("y"));break;case"scroll":re.alt(Q,te,["up"]);break}},/=/,/\s/),re.has("id")){var le=new(P.vttjs.VTTRegion||P.window.VTTRegion);le.width=re.get("width",100),le.lines=re.get("lines",3),le.regionAnchorX=re.get("regionanchorX",0),le.regionAnchorY=re.get("regionanchorY",100),le.viewportAnchorX=re.get("viewportanchorX",0),le.viewportAnchorY=re.get("viewportanchorY",100),le.scroll=re.get("scroll",""),P.onregion&&P.onregion(le),P.regionList.push({id:re.get("id"),region:le})}}function se(oe){var re=new s;r(oe,function(le,Q){switch(le){case"MPEGT":re.integer(le+"S",Q);break;case"LOCA":re.set(le+"L",i(Q));break}},/[^\d]:/,/,/),P.ontimestampmap&&P.ontimestampmap({MPEGTS:re.get("MPEGTS"),LOCAL:re.get("LOCAL")})}function ie(oe){oe.match(/X-TIMESTAMP-MAP/)?r(oe,function(re,le){switch(re){case"X-TIMESTAMP-MAP":se(le);break}},/=/):r(oe,function(re,le){switch(re){case"Region":J(le);break}},/:/)}try{var ne;if(P.state==="INITIAL"){if(!/\r\n|\n/.test(P.buffer))return this;ne=G();var ae=ne.match(/^WEBVTT([ \t].*)?$/);if(!ae||!ae[0])throw new t(t.Errors.BadSignature);P.state="HEADER"}for(var fe=!1;P.buffer;){if(!/\r\n|\n/.test(P.buffer))return this;switch(fe?fe=!1:ne=G(),P.state){case"HEADER":/:/.test(ne)?ie(ne):ne||(P.state="ID");continue;case"NOTE":ne||(P.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(ne)){P.state="NOTE";break}if(!ne)continue;P.cue=new(P.vttjs.VTTCue||P.window.VTTCue)(0,0,"");try{P.cue.align="center"}catch{P.cue.align="middle"}if(P.state="CUE",ne.indexOf("-->")===-1){P.cue.id=ne;continue}case"CUE":try{a(ne,P.cue,P.regionList)}catch(oe){P.reportOrThrowError(oe),P.cue=null,P.state="BADCUE";continue}P.state="CUETEXT";continue;case"CUETEXT":var ee=ne.indexOf("-->")!==-1;if(!ne||ee&&(fe=!0)){P.oncue&&P.oncue(P.cue),P.cue=null,P.state="ID";continue}P.cue.text&&(P.cue.text+=`
`),P.cue.text+=ne.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":ne||(P.state="ID");continue}}}catch(oe){P.reportOrThrowError(oe),P.state==="CUETEXT"&&P.cue&&P.oncue&&P.oncue(P.cue),P.cue=null,P.state=P.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var O=this;try{if(O.buffer+=O.decoder.decode(),(O.cue||O.state==="HEADER")&&(O.buffer+=`

`,O.parse()),O.state==="INITIAL")throw new t(t.Errors.BadSignature)}catch(P){O.reportOrThrowError(P)}return O.onflush&&O.onflush(),this}},Jl=x,Jl}var Zl,qd;function s_(){if(qd)return Zl;qd=1;var n="auto",e={"":1,lr:1,rl:1},t={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function i(a){if(typeof a!="string")return!1;var l=e[a.toLowerCase()];return l?a.toLowerCase():!1}function s(a){if(typeof a!="string")return!1;var l=t[a.toLowerCase()];return l?a.toLowerCase():!1}function r(a,l,c){this.hasBeenReset=!1;var h="",f=!1,p=a,m=l,_=c,E=null,C="",S=!0,I="auto",R="start",k="auto",D="auto",x=100,N="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return h},set:function(B){h=""+B}},pauseOnExit:{enumerable:!0,get:function(){return f},set:function(B){f=!!B}},startTime:{enumerable:!0,get:function(){return p},set:function(B){if(typeof B!="number")throw new TypeError("Start time must be set to a number.");p=B,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return m},set:function(B){if(typeof B!="number")throw new TypeError("End time must be set to a number.");m=B,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return _},set:function(B){_=""+B,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return E},set:function(B){E=B,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return C},set:function(B){var H=i(B);if(H===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");C=H,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return S},set:function(B){S=!!B,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return I},set:function(B){if(typeof B!="number"&&B!==n)throw new SyntaxError("Line: an invalid number or illegal string was specified.");I=B,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return R},set:function(B){var H=s(B);H?(R=H,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return k},set:function(B){if(B<0||B>100)throw new Error("Position must be between 0 and 100.");k=B,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return D},set:function(B){var H=s(B);H?(D=H,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return x},set:function(B){if(B<0||B>100)throw new Error("Size must be between 0 and 100.");x=B,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return N},set:function(B){var H=s(B);if(!H)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");N=H,this.hasBeenReset=!0}}}),this.displayState=void 0}return r.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},Zl=r,Zl}var eu,Wd;function r_(){if(Wd)return eu;Wd=1;var n={"":!0,up:!0};function e(s){if(typeof s!="string")return!1;var r=n[s.toLowerCase()];return r?s.toLowerCase():!1}function t(s){return typeof s=="number"&&s>=0&&s<=100}function i(){var s=100,r=3,a=0,l=100,c=0,h=100,f="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return s},set:function(p){if(!t(p))throw new Error("Width must be between 0 and 100.");s=p}},lines:{enumerable:!0,get:function(){return r},set:function(p){if(typeof p!="number")throw new TypeError("Lines must be set to a number.");r=p}},regionAnchorY:{enumerable:!0,get:function(){return l},set:function(p){if(!t(p))throw new Error("RegionAnchorX must be between 0 and 100.");l=p}},regionAnchorX:{enumerable:!0,get:function(){return a},set:function(p){if(!t(p))throw new Error("RegionAnchorY must be between 0 and 100.");a=p}},viewportAnchorY:{enumerable:!0,get:function(){return h},set:function(p){if(!t(p))throw new Error("ViewportAnchorY must be between 0 and 100.");h=p}},viewportAnchorX:{enumerable:!0,get:function(){return c},set:function(p){if(!t(p))throw new Error("ViewportAnchorX must be between 0 and 100.");c=p}},scroll:{enumerable:!0,get:function(){return f},set:function(p){var m=e(p);m===!1?console.warn("Scroll: an invalid or illegal string was specified."):f=m}}})}return eu=i,eu}var zd;function n_(){if(zd)return Ql.exports;zd=1;var n=Go(),e=Ql.exports={WebVTT:i_(),VTTCue:s_(),VTTRegion:r_()};n.vttjs=e,n.WebVTT=e.WebVTT;var t=e.VTTCue,i=e.VTTRegion,s=n.VTTCue,r=n.VTTRegion;return e.shim=function(){n.VTTCue=t,n.VTTRegion=i},e.restore=function(){n.VTTCue=s,n.VTTRegion=r},n.VTTCue||e.shim(),Ql.exports}var tu={exports:{}},iu={exports:{}},Yd;function a_(){return Yd||(Yd=1,function(n){function e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(n.exports=e=function(){return!!t},n.exports.__esModule=!0,n.exports.default=n.exports)()}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports}(iu)),iu.exports}var Xd;function o_(){return Xd||(Xd=1,function(n){var e=a_(),t=Wh();function i(s,r,a){if(e())return Reflect.construct.apply(null,arguments);var l=[null];l.push.apply(l,r);var c=new(s.bind.apply(s,l));return a&&t(c,a.prototype),c}n.exports=i,n.exports.__esModule=!0,n.exports.default=n.exports}(tu)),tu.exports}var su={exports:{}},Qd;function l_(){return Qd||(Qd=1,function(n){var e=Wh();function t(i,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(s&&s.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),s&&e(i,s)}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports}(su)),su.exports}/**
 * @license
 * Video.js 7.21.7 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/main/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
 */var ru,Jd;function u_(){if(Jd)return ru;Jd=1;var n=Go(),e=Rg(),t=Pg(),i=YT(),s=XT(),r=QT(),a=JT(),l=t_(),c=n_(),h=o_(),f=l_();function p(v){return v&&typeof v=="object"&&"default"in v?v:{default:v}}for(var m=p(n),_=p(e),E=p(t),C=p(i),S=p(s),I=p(r),R=p(a),k=p(l),D=p(c),x=p(h),N=p(f),B="7.21.7",H={},O=function(T,g){return H[T]=H[T]||[],g&&(H[T]=H[T].concat(g)),H[T]},P=function(T,g){O(T,g)},G=function(T,g){var d=O(T).indexOf(g);return d<=-1?!1:(H[T]=H[T].slice(),H[T].splice(d,1),!0)},J=function(T,g){O(T,[].concat(g).map(function(d){var o=function u(){return G(T,u),d.apply(void 0,arguments)};return o}))},se={prefixed:!0},ie=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],ne=ie[0],ae,fe=0;fe<ie.length;fe++)if(ie[fe][1]in _.default){ae=ie[fe];break}if(ae){for(var ee=0;ee<ae.length;ee++)se[ne[ee]]=ae[ee];se.prefixed=ae[0]!==ne[0]}var oe=[],re=function(T,g){return function(d,o,u){var y=g.levels[o],w=new RegExp("^("+y+")$");if(d!=="log"&&u.unshift(d.toUpperCase()+":"),u.unshift(T+":"),oe){oe.push([].concat(u));var F=oe.length-1e3;oe.splice(0,F>0?F:0)}if(m.default.console){var $=m.default.console[d];!$&&d==="debug"&&($=m.default.console.info||m.default.console.log),!(!$||!y||!w.test(d))&&$[Array.isArray(u)?"apply":"call"](m.default.console,u)}}};function le(v){var T="info",g,d=function(){for(var u=arguments.length,y=new Array(u),w=0;w<u;w++)y[w]=arguments[w];g("log",T,y)};return g=re(v,d),d.createLogger=function(o){return le(v+": "+o)},d.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:T},d.level=function(o){if(typeof o=="string"){if(!d.levels.hasOwnProperty(o))throw new Error('"'+o+'" in not a valid log level');T=o}return T},d.history=function(){return oe?[].concat(oe):[]},d.history.filter=function(o){return(oe||[]).filter(function(u){return new RegExp(".*"+o+".*").test(u[0])})},d.history.clear=function(){oe&&(oe.length=0)},d.history.disable=function(){oe!==null&&(oe.length=0,oe=null)},d.history.enable=function(){oe===null&&(oe=[])},d.error=function(){for(var o=arguments.length,u=new Array(o),y=0;y<o;y++)u[y]=arguments[y];return g("error",T,u)},d.warn=function(){for(var o=arguments.length,u=new Array(o),y=0;y<o;y++)u[y]=arguments[y];return g("warn",T,u)},d.debug=function(){for(var o=arguments.length,u=new Array(o),y=0;y<o;y++)u[y]=arguments[y];return g("debug",T,u)},d}var Q=le("VIDEOJS"),te=Q.createLogger,Se=Object.prototype.toString,be=function(T){return $e(T)?Object.keys(T):[]};function Pe(v,T){be(v).forEach(function(g){return T(v[g],g)})}function Me(v,T,g){return g===void 0&&(g=0),be(v).reduce(function(d,o){return T(d,v[o],o)},g)}function De(v){for(var T=arguments.length,g=new Array(T>1?T-1:0),d=1;d<T;d++)g[d-1]=arguments[d];return Object.assign?E.default.apply(void 0,[v].concat(g)):(g.forEach(function(o){o&&Pe(o,function(u,y){v[y]=u})}),v)}function $e(v){return!!v&&typeof v=="object"}function Ve(v){return $e(v)&&Se.call(v)==="[object Object]"&&v.constructor===Object}function Je(v,T){if(!v||!T)return"";if(typeof m.default.getComputedStyle=="function"){var g;try{g=m.default.getComputedStyle(v)}catch{return""}return g?g.getPropertyValue(T)||g[T]:""}return""}var Ye=m.default.navigator&&m.default.navigator.userAgent||"",ti=/AppleWebKit\/([\d.]+)/i.exec(Ye),Kt=ti?parseFloat(ti.pop()):null,Ii=/iPod/i.test(Ye),Oe=function(){var v=Ye.match(/OS (\d+)_/i);return v&&v[1]?v[1]:null}(),Ke=/Android/i.test(Ye),Et=function(){var v=Ye.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!v)return null;var T=v[1]&&parseFloat(v[1]),g=v[2]&&parseFloat(v[2]);return T&&g?parseFloat(v[1]+"."+v[2]):T||null}(),Ht=Ke&&Et<5&&Kt<537,bt=/Firefox/i.test(Ye),Nt=/Edg/i.test(Ye),mt=!Nt&&(/Chrome/i.test(Ye)||/CriOS/i.test(Ye)),mi=function(){var v=Ye.match(/(Chrome|CriOS)\/(\d+)/);return v&&v[2]?parseFloat(v[2]):null}(),Ot=function(){var v=/MSIE\s(\d+)\.\d/.exec(Ye),T=v&&parseFloat(v[1]);return!T&&/Trident\/7.0/i.test(Ye)&&/rv:11.0/.test(Ye)&&(T=11),T}(),St=/Safari/i.test(Ye)&&!mt&&!Ke&&!Nt,kt=/Windows/i.test(Ye),qt=!!(ue()&&("ontouchstart"in m.default||m.default.navigator.maxTouchPoints||m.default.DocumentTouch&&m.default.document instanceof m.default.DocumentTouch)),Rt=/iPad/i.test(Ye)||St&&qt&&!/iPhone/i.test(Ye),It=/iPhone/i.test(Ye)&&!Rt,M=It||Rt||Ii,b=(St||M)&&!mt,A=Object.freeze({__proto__:null,IS_IPOD:Ii,IOS_VERSION:Oe,IS_ANDROID:Ke,ANDROID_VERSION:Et,IS_NATIVE_ANDROID:Ht,IS_FIREFOX:bt,IS_EDGE:Nt,IS_CHROME:mt,CHROME_VERSION:mi,IE_VERSION:Ot,IS_SAFARI:St,IS_WINDOWS:kt,TOUCH_ENABLED:qt,IS_IPAD:Rt,IS_IPHONE:It,IS_IOS:M,IS_ANY_SAFARI:b});function j(v){return typeof v=="string"&&!!v.trim()}function q(v){if(v.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function Z(v){return new RegExp("(^|\\s)"+v+"($|\\s)")}function ue(){return _.default===m.default.document}function Fe(v){return $e(v)&&v.nodeType===1}function at(){try{return m.default.parent!==m.default.self}catch{return!0}}function tt(v){return function(T,g){if(!j(T))return _.default[v](null);j(g)&&(g=_.default.querySelector(g));var d=Fe(g)?g:_.default;return d[v]&&d[v](T)}}function Re(v,T,g,d){v===void 0&&(v="div"),T===void 0&&(T={}),g===void 0&&(g={});var o=_.default.createElement(v);return Object.getOwnPropertyNames(T).forEach(function(u){var y=T[u];u.indexOf("aria-")!==-1||u==="role"||u==="type"?(Q.warn(`Setting attributes in the second argument of createEl()
has been deprecated. Use the third argument instead.
`+("createEl(type, properties, attributes). Attempting to set "+u+" to "+y+".")),o.setAttribute(u,y)):u==="textContent"?qe(o,y):(o[u]!==y||u==="tabIndex")&&(o[u]=y)}),Object.getOwnPropertyNames(g).forEach(function(u){o.setAttribute(u,g[u])}),d&&nn(o,d),o}function qe(v,T){return typeof v.textContent>"u"?v.innerText=T:v.textContent=T,v}function tn(v,T){T.firstChild?T.insertBefore(v,T.firstChild):T.appendChild(v)}function Yi(v,T){return q(T),v.classList?v.classList.contains(T):Z(T).test(v.className)}function vi(v,T){return v.classList?v.classList.add(T):Yi(v,T)||(v.className=(v.className+" "+T).trim()),v}function Hs(v,T){return v?(v.classList?v.classList.remove(T):(q(T),v.className=v.className.split(/\s+/).filter(function(g){return g!==T}).join(" ")),v):(Q.warn("removeClass was called with an element that doesn't exist"),null)}function sn(v,T,g){var d=Yi(v,T);if(typeof g=="function"&&(g=g(v,T)),typeof g!="boolean"&&(g=!d),g!==d)return g?vi(v,T):Hs(v,T),v}function Qn(v,T){Object.getOwnPropertyNames(T).forEach(function(g){var d=T[g];d===null||typeof d>"u"||d===!1?v.removeAttribute(g):v.setAttribute(g,d===!0?"":d)})}function ri(v){var T={},g=",autoplay,controls,playsinline,loop,muted,default,defaultMuted,";if(v&&v.attributes&&v.attributes.length>0)for(var d=v.attributes,o=d.length-1;o>=0;o--){var u=d[o].name,y=d[o].value;(typeof v[u]=="boolean"||g.indexOf(","+u+",")!==-1)&&(y=y!==null),T[u]=y}return T}function Jn(v,T){return v.getAttribute(T)}function ps(v,T,g){v.setAttribute(T,g)}function hr(v,T){v.removeAttribute(T)}function Zn(){_.default.body.focus(),_.default.onselectstart=function(){return!1}}function ea(){_.default.onselectstart=function(){return!0}}function gs(v){if(v&&v.getBoundingClientRect&&v.parentNode){var T=v.getBoundingClientRect(),g={};return["bottom","height","left","right","top","width"].forEach(function(d){T[d]!==void 0&&(g[d]=T[d])}),g.height||(g.height=parseFloat(Je(v,"height"))),g.width||(g.width=parseFloat(Je(v,"width"))),g}}function Li(v){if(!v||v&&!v.offsetParent)return{left:0,top:0,width:0,height:0};for(var T=v.offsetWidth,g=v.offsetHeight,d=0,o=0;v.offsetParent&&v!==_.default[se.fullscreenElement];)d+=v.offsetLeft,o+=v.offsetTop,v=v.offsetParent;return{left:d,top:o,width:T,height:g}}function js(v,T){var g={x:0,y:0};if(M)for(var d=v;d&&d.nodeName.toLowerCase()!=="html";){var o=Je(d,"transform");if(/^matrix/.test(o)){var u=o.slice(7,-1).split(/,\s/).map(Number);g.x+=u[4],g.y+=u[5]}else if(/^matrix3d/.test(o)){var y=o.slice(9,-1).split(/,\s/).map(Number);g.x+=y[12],g.y+=y[13]}d=d.parentNode}var w={},F=Li(T.target),$=Li(v),K=$.width,z=$.height,V=T.offsetY-($.top-F.top),ge=T.offsetX-($.left-F.left);return T.changedTouches&&(ge=T.changedTouches[0].pageX-$.left,V=T.changedTouches[0].pageY+$.top,M&&(ge-=g.x,V-=g.y)),w.y=1-Math.max(0,Math.min(1,V/z)),w.x=Math.max(0,Math.min(1,ge/K)),w}function ta(v){return $e(v)&&v.nodeType===3}function rn(v){for(;v.firstChild;)v.removeChild(v.firstChild);return v}function ia(v){return typeof v=="function"&&(v=v()),(Array.isArray(v)?v:[v]).map(function(T){if(typeof T=="function"&&(T=T()),Fe(T)||ta(T))return T;if(typeof T=="string"&&/\S/.test(T))return _.default.createTextNode(T)}).filter(function(T){return T})}function nn(v,T){return ia(T).forEach(function(g){return v.appendChild(g)}),v}function sa(v,T){return nn(rn(v),T)}function ms(v){return v.button===void 0&&v.buttons===void 0||v.button===0&&v.buttons===void 0||v.type==="mouseup"&&v.button===0&&v.buttons===0?!0:!(v.button!==0||v.buttons!==1)}var ki=tt("querySelector"),ra=tt("querySelectorAll"),na=Object.freeze({__proto__:null,isReal:ue,isEl:Fe,isInFrame:at,createEl:Re,textContent:qe,prependTo:tn,hasClass:Yi,addClass:vi,removeClass:Hs,toggleClass:sn,setAttributes:Qn,getAttributes:ri,getAttribute:Jn,setAttribute:ps,removeAttribute:hr,blockTextSelection:Zn,unblockTextSelection:ea,getBoundingClientRect:gs,findPosition:Li,getPointerPosition:js,isTextNode:ta,emptyEl:rn,normalizeContent:ia,appendContent:nn,insertContent:sa,isSingleLeftClick:ms,$:ki,$$:ra}),aa=!1,an,oa=function(){if(an.options.autoSetup!==!1){var T=Array.prototype.slice.call(_.default.getElementsByTagName("video")),g=Array.prototype.slice.call(_.default.getElementsByTagName("audio")),d=Array.prototype.slice.call(_.default.getElementsByTagName("video-js")),o=T.concat(g,d);if(o&&o.length>0)for(var u=0,y=o.length;u<y;u++){var w=o[u];if(w&&w.getAttribute){if(w.player===void 0){var F=w.getAttribute("data-setup");F!==null&&an(w)}}else{on(1);break}}else aa||on(1)}};function on(v,T){ue()&&(T&&(an=T),m.default.setTimeout(oa,v))}function ln(){aa=!0,m.default.removeEventListener("load",ln)}ue()&&(_.default.readyState==="complete"?ln():m.default.addEventListener("load",ln));var cr=function(T){var g=_.default.createElement("style");return g.className=T,g},vs=function(T,g){T.styleSheet?T.styleSheet.cssText=g:T.textContent=g},la=3,un=la;function ni(){return un++}var ua;m.default.WeakMap||(ua=function(){function v(){this.vdata="vdata"+Math.floor(m.default.performance&&m.default.performance.now()||Date.now()),this.data={}}var T=v.prototype;return T.set=function(d,o){var u=d[this.vdata]||ni();return d[this.vdata]||(d[this.vdata]=u),this.data[u]=o,this},T.get=function(d){var o=d[this.vdata];if(o)return this.data[o];Q("We have no data for this element",d)},T.has=function(d){var o=d[this.vdata];return o in this.data},T.delete=function(d){var o=d[this.vdata];o&&(delete this.data[o],delete d[this.vdata])},v}());var Mt=m.default.WeakMap?new WeakMap:new ua;function ha(v,T){if(Mt.has(v)){var g=Mt.get(v);g.handlers[T].length===0&&(delete g.handlers[T],v.removeEventListener?v.removeEventListener(T,g.dispatcher,!1):v.detachEvent&&v.detachEvent("on"+T,g.dispatcher)),Object.getOwnPropertyNames(g.handlers).length<=0&&(delete g.handlers,delete g.dispatcher,delete g.disabled),Object.getOwnPropertyNames(g).length===0&&Mt.delete(v)}}function dr(v,T,g,d){g.forEach(function(o){v(T,o,d)})}function fr(v){if(v.fixed_)return v;function T(){return!0}function g(){return!1}if(!v||!v.isPropagationStopped||!v.isImmediatePropagationStopped){var d=v||m.default.event;v={};for(var o in d)o!=="layerX"&&o!=="layerY"&&o!=="keyLocation"&&o!=="webkitMovementX"&&o!=="webkitMovementY"&&o!=="path"&&(o==="returnValue"&&d.preventDefault||(v[o]=d[o]));if(v.target||(v.target=v.srcElement||_.default),v.relatedTarget||(v.relatedTarget=v.fromElement===v.target?v.toElement:v.fromElement),v.preventDefault=function(){d.preventDefault&&d.preventDefault(),v.returnValue=!1,d.returnValue=!1,v.defaultPrevented=!0},v.defaultPrevented=!1,v.stopPropagation=function(){d.stopPropagation&&d.stopPropagation(),v.cancelBubble=!0,d.cancelBubble=!0,v.isPropagationStopped=T},v.isPropagationStopped=g,v.stopImmediatePropagation=function(){d.stopImmediatePropagation&&d.stopImmediatePropagation(),v.isImmediatePropagationStopped=T,v.stopPropagation()},v.isImmediatePropagationStopped=g,v.clientX!==null&&v.clientX!==void 0){var u=_.default.documentElement,y=_.default.body;v.pageX=v.clientX+(u&&u.scrollLeft||y&&y.scrollLeft||0)-(u&&u.clientLeft||y&&y.clientLeft||0),v.pageY=v.clientY+(u&&u.scrollTop||y&&y.scrollTop||0)-(u&&u.clientTop||y&&y.clientTop||0)}v.which=v.charCode||v.keyCode,v.button!==null&&v.button!==void 0&&(v.button=v.button&1?0:v.button&4?1:v.button&2?2:0)}return v.fixed_=!0,v}var Vs,Gs=function(){if(typeof Vs!="boolean"){Vs=!1;try{var T=Object.defineProperty({},"passive",{get:function(){Vs=!0}});m.default.addEventListener("test",null,T),m.default.removeEventListener("test",null,T)}catch{}}return Vs},el=["touchstart","touchmove"];function jt(v,T,g){if(Array.isArray(T))return dr(jt,v,T,g);Mt.has(v)||Mt.set(v,{});var d=Mt.get(v);if(d.handlers||(d.handlers={}),d.handlers[T]||(d.handlers[T]=[]),g.guid||(g.guid=ni()),d.handlers[T].push(g),d.dispatcher||(d.disabled=!1,d.dispatcher=function(u,y){if(!d.disabled){u=fr(u);var w=d.handlers[u.type];if(w)for(var F=w.slice(0),$=0,K=F.length;$<K&&!u.isImmediatePropagationStopped();$++)try{F[$].call(v,u,y)}catch(z){Q.error(z)}}}),d.handlers[T].length===1)if(v.addEventListener){var o=!1;Gs()&&el.indexOf(T)>-1&&(o={passive:!0}),v.addEventListener(T,d.dispatcher,o)}else v.attachEvent&&v.attachEvent("on"+T,d.dispatcher)}function Pt(v,T,g){if(Mt.has(v)){var d=Mt.get(v);if(d.handlers){if(Array.isArray(T))return dr(Pt,v,T,g);var o=function($,K){d.handlers[K]=[],ha($,K)};if(T===void 0){for(var u in d.handlers)Object.prototype.hasOwnProperty.call(d.handlers||{},u)&&o(v,u);return}var y=d.handlers[T];if(y){if(!g){o(v,T);return}if(g.guid)for(var w=0;w<y.length;w++)y[w].guid===g.guid&&y.splice(w--,1);ha(v,T)}}}}function ys(v,T,g){var d=Mt.has(v)?Mt.get(v):{},o=v.parentNode||v.ownerDocument;if(typeof T=="string"?T={type:T,target:v}:T.target||(T.target=v),T=fr(T),d.dispatcher&&d.dispatcher.call(v,T,g),o&&!T.isPropagationStopped()&&T.bubbles===!0)ys.call(null,o,T,g);else if(!o&&!T.defaultPrevented&&T.target&&T.target[T.type]){Mt.has(T.target)||Mt.set(T.target,{});var u=Mt.get(T.target);T.target[T.type]&&(u.disabled=!0,typeof T.target[T.type]=="function"&&T.target[T.type](),u.disabled=!1)}return!T.defaultPrevented}function pr(v,T,g){if(Array.isArray(T))return dr(pr,v,T,g);var d=function o(){Pt(v,T,o),g.apply(this,arguments)};d.guid=g.guid=g.guid||ni(),jt(v,T,d)}function ca(v,T,g){var d=function o(){Pt(v,T,o),g.apply(this,arguments)};d.guid=g.guid=g.guid||ni(),jt(v,T,d)}var da=Object.freeze({__proto__:null,fixEvent:fr,on:jt,off:Pt,trigger:ys,one:pr,any:ca}),Wt=30,ot=function(T,g,d){g.guid||(g.guid=ni());var o=g.bind(T);return o.guid=d?d+"_"+g.guid:g.guid,o},yi=function(T,g){var d=m.default.performance.now(),o=function(){var y=m.default.performance.now();y-d>=g&&(T.apply(void 0,arguments),d=y)};return o},Ee=function(T,g,d,o){o===void 0&&(o=m.default);var u,y=function(){o.clearTimeout(u),u=null},w=function(){var $=this,K=arguments,z=function(){u=null,z=null,T.apply($,K)};o.clearTimeout(u),u=o.setTimeout(z,g)};return w.cancel=y,w},U=function(){};U.prototype.allowedEvents_={},U.prototype.on=function(v,T){var g=this.addEventListener;this.addEventListener=function(){},jt(this,v,T),this.addEventListener=g},U.prototype.addEventListener=U.prototype.on,U.prototype.off=function(v,T){Pt(this,v,T)},U.prototype.removeEventListener=U.prototype.off,U.prototype.one=function(v,T){var g=this.addEventListener;this.addEventListener=function(){},pr(this,v,T),this.addEventListener=g},U.prototype.any=function(v,T){var g=this.addEventListener;this.addEventListener=function(){},ca(this,v,T),this.addEventListener=g},U.prototype.trigger=function(v){var T=v.type||v;typeof v=="string"&&(v={type:T}),v=fr(v),this.allowedEvents_[T]&&this["on"+T]&&this["on"+T](v),ys(this,v)},U.prototype.dispatchEvent=U.prototype.trigger;var ye;U.prototype.queueTrigger=function(v){var T=this;ye||(ye=new Map);var g=v.type||v,d=ye.get(this);d||(d=new Map,ye.set(this,d));var o=d.get(g);d.delete(g),m.default.clearTimeout(o);var u=m.default.setTimeout(function(){d.delete(g),d.size===0&&(d=null,ye.delete(T)),T.trigger(v)},0);d.set(g,u)};var xe=function(T){return typeof T.name=="function"?T.name():typeof T.name=="string"?T.name:T.name_?T.name_:T.constructor&&T.constructor.name?T.constructor.name:typeof T},Be=function(T){return T instanceof U||!!T.eventBusEl_&&["on","one","off","trigger"].every(function(g){return typeof T[g]=="function"})},ht=function(T,g){Be(T)?g():(T.eventedCallbacks||(T.eventedCallbacks=[]),T.eventedCallbacks.push(g))},it=function(T){return typeof T=="string"&&/\S/.test(T)||Array.isArray(T)&&!!T.length},Ti=function(T,g,d){if(!T||!T.nodeName&&!Be(T))throw new Error("Invalid target for "+xe(g)+"#"+d+"; must be a DOM node or evented object.")},Ts=function(T,g,d){if(!it(T))throw new Error("Invalid event type for "+xe(g)+"#"+d+"; must be a non-empty string or array.")},Xe=function(T,g,d){if(typeof T!="function")throw new Error("Invalid listener for "+xe(g)+"#"+d+"; must be a function.")},zt=function(T,g,d){var o=g.length<3||g[0]===T||g[0]===T.eventBusEl_,u,y,w;return o?(u=T.eventBusEl_,g.length>=3&&g.shift(),y=g[0],w=g[1]):(u=g[0],y=g[1],w=g[2]),Ti(u,T,d),Ts(y,T,d),Xe(w,T,d),w=ot(T,w),{isTargetingSelf:o,target:u,type:y,listener:w}},Bt=function(T,g,d,o){Ti(T,T,g),T.nodeName?da[g](T,d,o):T[g](d,o)},hn={on:function(){for(var T=this,g=arguments.length,d=new Array(g),o=0;o<g;o++)d[o]=arguments[o];var u=zt(this,d,"on"),y=u.isTargetingSelf,w=u.target,F=u.type,$=u.listener;if(Bt(w,"on",F,$),!y){var K=function(){return T.off(w,F,$)};K.guid=$.guid;var z=function(){return T.off("dispose",K)};z.guid=$.guid,Bt(this,"on","dispose",K),Bt(w,"on","dispose",z)}},one:function(){for(var T=this,g=arguments.length,d=new Array(g),o=0;o<g;o++)d[o]=arguments[o];var u=zt(this,d,"one"),y=u.isTargetingSelf,w=u.target,F=u.type,$=u.listener;if(y)Bt(w,"one",F,$);else{var K=function z(){T.off(w,F,z);for(var V=arguments.length,ge=new Array(V),Ae=0;Ae<V;Ae++)ge[Ae]=arguments[Ae];$.apply(null,ge)};K.guid=$.guid,Bt(w,"one",F,K)}},any:function(){for(var T=this,g=arguments.length,d=new Array(g),o=0;o<g;o++)d[o]=arguments[o];var u=zt(this,d,"any"),y=u.isTargetingSelf,w=u.target,F=u.type,$=u.listener;if(y)Bt(w,"any",F,$);else{var K=function z(){T.off(w,F,z);for(var V=arguments.length,ge=new Array(V),Ae=0;Ae<V;Ae++)ge[Ae]=arguments[Ae];$.apply(null,ge)};K.guid=$.guid,Bt(w,"any",F,K)}},off:function(T,g,d){if(!T||it(T))Pt(this.eventBusEl_,T,g);else{var o=T,u=g;Ti(o,this,"off"),Ts(u,this,"off"),Xe(d,this,"off"),d=ot(this,d),this.off("dispose",d),o.nodeName?(Pt(o,u,d),Pt(o,"dispose",d)):Be(o)&&(o.off(u,d),o.off("dispose",d))}},trigger:function(T,g){Ti(this.eventBusEl_,this,"trigger");var d=T&&typeof T!="string"?T.type:T;if(!it(d)){var o="Invalid event type for "+xe(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(T)(this.log||Q).error(o);else throw new Error(o)}return ys(this.eventBusEl_,T,g)}};function cn(v,T){T===void 0&&(T={});var g=T,d=g.eventBusKey;if(d){if(!v[d].nodeName)throw new Error('The eventBusKey "'+d+'" does not refer to an element.');v.eventBusEl_=v[d]}else v.eventBusEl_=Re("span",{className:"vjs-event-bus"});return De(v,hn),v.eventedCallbacks&&v.eventedCallbacks.forEach(function(o){o()}),v.on("dispose",function(){v.off(),[v,v.el_,v.eventBusEl_].forEach(function(o){o&&Mt.has(o)&&Mt.delete(o)}),m.default.setTimeout(function(){v.eventBusEl_=null},0)}),v}var fy={state:{},setState:function(T){var g=this;typeof T=="function"&&(T=T());var d;return Pe(T,function(o,u){g.state[u]!==o&&(d=d||{},d[u]={from:g.state[u],to:o}),g.state[u]=o}),d&&Be(this)&&this.trigger({changes:d,type:"statechanged"}),d}};function Ic(v,T){return De(v,fy),v.state=De({},v.state,T),typeof v.handleStateChanged=="function"&&Be(v)&&v.on("statechanged",v.handleStateChanged),v}var fa=function(T){return typeof T!="string"?T:T.replace(/./,function(g){return g.toLowerCase()})},vt=function(T){return typeof T!="string"?T:T.replace(/./,function(g){return g.toUpperCase()})},py=function(T,g){return vt(T)===vt(g)};function dt(){for(var v={},T=arguments.length,g=new Array(T),d=0;d<T;d++)g[d]=arguments[d];return g.forEach(function(o){o&&Pe(o,function(u,y){if(!Ve(u)){v[y]=u;return}Ve(v[y])||(v[y]={}),v[y]=dt(v[y],u)})}),v}var gy=function(){function v(){this.map_={}}var T=v.prototype;return T.has=function(d){return d in this.map_},T.delete=function(d){var o=this.has(d);return delete this.map_[d],o},T.set=function(d,o){return this.map_[d]=o,this},T.forEach=function(d,o){for(var u in this.map_)d.call(o,this.map_[u],u,this)},v}(),my=m.default.Map?m.default.Map:gy,vy=function(){function v(){this.set_={}}var T=v.prototype;return T.has=function(d){return d in this.set_},T.delete=function(d){var o=this.has(d);return delete this.set_[d],o},T.add=function(d){return this.set_[d]=1,this},T.forEach=function(d,o){for(var u in this.set_)d.call(o,u,u,this)},v}(),tl=m.default.Set?m.default.Set:vy,me=function(){function v(g,d,o){var u=this;if(!g&&this.play?this.player_=g=this:this.player_=g,this.isDisposed_=!1,this.parentComponent_=null,this.options_=dt({},this.options_),d=this.options_=dt(this.options_,d),this.id_=d.id||d.el&&d.el.id,!this.id_){var y=g&&g.id&&g.id()||"no_player";this.id_=y+"_component_"+ni()}this.name_=d.name||null,d.el?this.el_=d.el:d.createEl!==!1&&(this.el_=this.createEl()),d.className&&this.el_&&d.className.split(" ").forEach(function(w){return u.addClass(w)}),d.evented!==!1&&(cn(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),Ic(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new tl,this.setIntervalIds_=new tl,this.rafIds_=new tl,this.namedRafs_=new my,this.clearingTimersOnDispose_=!1,d.initChildren!==!1&&this.initChildren(),this.ready(o),d.reportTouchActivity!==!1&&this.enableTouchActivity()}var T=v.prototype;return T.dispose=function(d){if(d===void 0&&(d={}),!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var o=this.children_.length-1;o>=0;o--)this.children_[o].dispose&&this.children_[o].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(d.restoreEl?this.el_.parentNode.replaceChild(d.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}},T.isDisposed=function(){return!!this.isDisposed_},T.player=function(){return this.player_},T.options=function(d){return d?(this.options_=dt(this.options_,d),this.options_):this.options_},T.el=function(){return this.el_},T.createEl=function(d,o,u){return Re(d,o,u)},T.localize=function(d,o,u){u===void 0&&(u=d);var y=this.player_.language&&this.player_.language(),w=this.player_.languages&&this.player_.languages(),F=w&&w[y],$=y&&y.split("-")[0],K=w&&w[$],z=u;return F&&F[d]?z=F[d]:K&&K[d]&&(z=K[d]),o&&(z=z.replace(/\{(\d+)\}/g,function(V,ge){var Ae=o[ge-1],We=Ae;return typeof Ae>"u"&&(We=V),We})),z},T.handleLanguagechange=function(){},T.contentEl=function(){return this.contentEl_||this.el_},T.id=function(){return this.id_},T.name=function(){return this.name_},T.children=function(){return this.children_},T.getChildById=function(d){return this.childIndex_[d]},T.getChild=function(d){if(d)return this.childNameIndex_[d]},T.getDescendant=function(){for(var d=arguments.length,o=new Array(d),u=0;u<d;u++)o[u]=arguments[u];o=o.reduce(function(F,$){return F.concat($)},[]);for(var y=this,w=0;w<o.length;w++)if(y=y.getChild(o[w]),!y||!y.getChild)return;return y},T.addChild=function(d,o,u){o===void 0&&(o={}),u===void 0&&(u=this.children_.length);var y,w;if(typeof d=="string"){w=vt(d);var F=o.componentClass||w;o.name=w;var $=v.getComponent(F);if(!$)throw new Error("Component "+F+" does not exist");if(typeof $!="function")return null;y=new $(this.player_||this,o)}else y=d;if(y.parentComponent_&&y.parentComponent_.removeChild(y),this.children_.splice(u,0,y),y.parentComponent_=this,typeof y.id=="function"&&(this.childIndex_[y.id()]=y),w=w||y.name&&vt(y.name()),w&&(this.childNameIndex_[w]=y,this.childNameIndex_[fa(w)]=y),typeof y.el=="function"&&y.el()){var K=null;this.children_[u+1]&&(this.children_[u+1].el_?K=this.children_[u+1].el_:Fe(this.children_[u+1])&&(K=this.children_[u+1])),this.contentEl().insertBefore(y.el(),K)}return y},T.removeChild=function(d){if(typeof d=="string"&&(d=this.getChild(d)),!(!d||!this.children_)){for(var o=!1,u=this.children_.length-1;u>=0;u--)if(this.children_[u]===d){o=!0,this.children_.splice(u,1);break}if(o){d.parentComponent_=null,this.childIndex_[d.id()]=null,this.childNameIndex_[vt(d.name())]=null,this.childNameIndex_[fa(d.name())]=null;var y=d.el();y&&y.parentNode===this.contentEl()&&this.contentEl().removeChild(d.el())}}},T.initChildren=function(){var d=this,o=this.options_.children;if(o){var u=this.options_,y=function(K){var z=K.name,V=K.opts;if(u[z]!==void 0&&(V=u[z]),V!==!1){V===!0&&(V={}),V.playerOptions=d.options_.playerOptions;var ge=d.addChild(z,V);ge&&(d[z]=ge)}},w,F=v.getComponent("Tech");Array.isArray(o)?w=o:w=Object.keys(o),w.concat(Object.keys(this.options_).filter(function($){return!w.some(function(K){return typeof K=="string"?$===K:$===K.name})})).map(function($){var K,z;return typeof $=="string"?(K=$,z=o[K]||d.options_[K]||{}):(K=$.name,z=$),{name:K,opts:z}}).filter(function($){var K=v.getComponent($.opts.componentClass||vt($.name));return K&&!F.isTech(K)}).forEach(y)}},T.buildCSSClass=function(){return""},T.ready=function(d,o){if(o===void 0&&(o=!1),!!d){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(d);return}o?d.call(this):this.setTimeout(d,1)}},T.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var d=this.readyQueue_;this.readyQueue_=[],d&&d.length>0&&d.forEach(function(o){o.call(this)},this),this.trigger("ready")},1)},T.$=function(d,o){return ki(d,o||this.contentEl())},T.$$=function(d,o){return ra(d,o||this.contentEl())},T.hasClass=function(d){return Yi(this.el_,d)},T.addClass=function(d){vi(this.el_,d)},T.removeClass=function(d){Hs(this.el_,d)},T.toggleClass=function(d,o){sn(this.el_,d,o)},T.show=function(){this.removeClass("vjs-hidden")},T.hide=function(){this.addClass("vjs-hidden")},T.lockShowing=function(){this.addClass("vjs-lock-showing")},T.unlockShowing=function(){this.removeClass("vjs-lock-showing")},T.getAttribute=function(d){return Jn(this.el_,d)},T.setAttribute=function(d,o){ps(this.el_,d,o)},T.removeAttribute=function(d){hr(this.el_,d)},T.width=function(d,o){return this.dimension("width",d,o)},T.height=function(d,o){return this.dimension("height",d,o)},T.dimensions=function(d,o){this.width(d,!0),this.height(o)},T.dimension=function(d,o,u){if(o!==void 0){(o===null||o!==o)&&(o=0),(""+o).indexOf("%")!==-1||(""+o).indexOf("px")!==-1?this.el_.style[d]=o:o==="auto"?this.el_.style[d]="":this.el_.style[d]=o+"px",u||this.trigger("componentresize");return}if(!this.el_)return 0;var y=this.el_.style[d],w=y.indexOf("px");return parseInt(w!==-1?y.slice(0,w):this.el_["offset"+vt(d)],10)},T.currentDimension=function(d){var o=0;if(d!=="width"&&d!=="height")throw new Error("currentDimension only accepts width or height value");if(o=Je(this.el_,d),o=parseFloat(o),o===0||isNaN(o)){var u="offset"+vt(d);o=this.el_[u]}return o},T.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},T.currentWidth=function(){return this.currentDimension("width")},T.currentHeight=function(){return this.currentDimension("height")},T.focus=function(){this.el_.focus()},T.blur=function(){this.el_.blur()},T.handleKeyDown=function(d){this.player_&&(C.default.isEventKey(d,"Tab")||d.stopPropagation(),this.player_.handleKeyDown(d))},T.handleKeyPress=function(d){this.handleKeyDown(d)},T.emitTapEvents=function(){var d=0,o=null,u=10,y=200,w;this.on("touchstart",function($){$.touches.length===1&&(o={pageX:$.touches[0].pageX,pageY:$.touches[0].pageY},d=m.default.performance.now(),w=!0)}),this.on("touchmove",function($){if($.touches.length>1)w=!1;else if(o){var K=$.touches[0].pageX-o.pageX,z=$.touches[0].pageY-o.pageY,V=Math.sqrt(K*K+z*z);V>u&&(w=!1)}});var F=function(){w=!1};this.on("touchleave",F),this.on("touchcancel",F),this.on("touchend",function($){if(o=null,w===!0){var K=m.default.performance.now()-d;K<y&&($.preventDefault(),this.trigger("tap"))}})},T.enableTouchActivity=function(){if(!(!this.player()||!this.player().reportUserActivity)){var d=ot(this.player(),this.player().reportUserActivity),o;this.on("touchstart",function(){d(),this.clearInterval(o),o=this.setInterval(d,250)});var u=function(w){d(),this.clearInterval(o)};this.on("touchmove",d),this.on("touchend",u),this.on("touchcancel",u)}},T.setTimeout=function(d,o){var u=this,y;return d=ot(this,d),this.clearTimersOnDispose_(),y=m.default.setTimeout(function(){u.setTimeoutIds_.has(y)&&u.setTimeoutIds_.delete(y),d()},o),this.setTimeoutIds_.add(y),y},T.clearTimeout=function(d){return this.setTimeoutIds_.has(d)&&(this.setTimeoutIds_.delete(d),m.default.clearTimeout(d)),d},T.setInterval=function(d,o){d=ot(this,d),this.clearTimersOnDispose_();var u=m.default.setInterval(d,o);return this.setIntervalIds_.add(u),u},T.clearInterval=function(d){return this.setIntervalIds_.has(d)&&(this.setIntervalIds_.delete(d),m.default.clearInterval(d)),d},T.requestAnimationFrame=function(d){var o=this;if(!this.supportsRaf_)return this.setTimeout(d,1e3/60);this.clearTimersOnDispose_();var u;return d=ot(this,d),u=m.default.requestAnimationFrame(function(){o.rafIds_.has(u)&&o.rafIds_.delete(u),d()}),this.rafIds_.add(u),u},T.requestNamedAnimationFrame=function(d,o){var u=this;if(!this.namedRafs_.has(d)){this.clearTimersOnDispose_(),o=ot(this,o);var y=this.requestAnimationFrame(function(){o(),u.namedRafs_.has(d)&&u.namedRafs_.delete(d)});return this.namedRafs_.set(d,y),d}},T.cancelNamedAnimationFrame=function(d){this.namedRafs_.has(d)&&(this.cancelAnimationFrame(this.namedRafs_.get(d)),this.namedRafs_.delete(d))},T.cancelAnimationFrame=function(d){return this.supportsRaf_?(this.rafIds_.has(d)&&(this.rafIds_.delete(d),m.default.cancelAnimationFrame(d)),d):this.clearTimeout(d)},T.clearTimersOnDispose_=function(){var d=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(o){var u=o[0],y=o[1];d[u].forEach(function(w,F){return d[y](F)})}),d.clearingTimersOnDispose_=!1}))},v.registerComponent=function(d,o){if(typeof d!="string"||!d)throw new Error('Illegal component name, "'+d+'"; must be a non-empty string.');var u=v.getComponent("Tech"),y=u&&u.isTech(o),w=v===o||v.prototype.isPrototypeOf(o.prototype);if(y||!w){var F;throw y?F="techs must be registered using Tech.registerTech()":F="must be a Component subclass",new Error('Illegal component, "'+d+'"; '+F+".")}d=vt(d),v.components_||(v.components_={});var $=v.getComponent("Player");if(d==="Player"&&$&&$.players){var K=$.players,z=Object.keys(K);if(K&&z.length>0&&z.map(function(V){return K[V]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return v.components_[d]=o,v.components_[fa(d)]=o,o},v.getComponent=function(d){if(!(!d||!v.components_))return v.components_[d]},v}();me.prototype.supportsRaf_=typeof m.default.requestAnimationFrame=="function"&&typeof m.default.cancelAnimationFrame=="function",me.registerComponent("Component",me);function yy(v,T,g){if(typeof T!="number"||T<0||T>g)throw new Error("Failed to execute '"+v+"' on 'TimeRanges': The index provided ("+T+") is non-numeric or out of bounds (0-"+g+").")}function Lc(v,T,g,d){return yy(v,d,g.length-1),g[d][T]}function il(v){var T;return v===void 0||v.length===0?T={length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:T={length:v.length,start:Lc.bind(null,"start",0,v),end:Lc.bind(null,"end",1,v)},m.default.Symbol&&m.default.Symbol.iterator&&(T[m.default.Symbol.iterator]=function(){return(v||[]).values()}),T}function Ks(v,T){return Array.isArray(v)?il(v):v===void 0||T===void 0?il():il([[v,T]])}function kc(v,T){var g=0,d,o;if(!T)return 0;(!v||!v.length)&&(v=Ks(0,0));for(var u=0;u<v.length;u++)d=v.start(u),o=v.end(u),o>T&&(o=T),g+=o-d;return g/T}function Vt(v){if(v instanceof Vt)return v;typeof v=="number"?this.code=v:typeof v=="string"?this.message=v:$e(v)&&(typeof v.code=="number"&&(this.code=v.code),De(this,v)),this.message||(this.message=Vt.defaultMessages[this.code]||"")}Vt.prototype.code=0,Vt.prototype.message="",Vt.prototype.status=null,Vt.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],Vt.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var gr=0;gr<Vt.errorTypes.length;gr++)Vt[Vt.errorTypes[gr]]=gr,Vt.prototype[Vt.errorTypes[gr]]=gr;function dn(v){return v!=null&&typeof v.then=="function"}function Ri(v){dn(v)&&v.then(null,function(T){})}var sl=function(T){var g=["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(d,o,u){return T[o]&&(d[o]=T[o]),d},{cues:T.cues&&Array.prototype.map.call(T.cues,function(d){return{startTime:d.startTime,endTime:d.endTime,text:d.text,id:d.id}})});return g},Ty=function(T){var g=T.$$("track"),d=Array.prototype.map.call(g,function(u){return u.track}),o=Array.prototype.map.call(g,function(u){var y=sl(u.track);return u.src&&(y.src=u.src),y});return o.concat(Array.prototype.filter.call(T.textTracks(),function(u){return d.indexOf(u)===-1}).map(sl))},_y=function(T,g){return T.forEach(function(d){var o=g.addRemoteTextTrack(d).track;!d.src&&d.cues&&d.cues.forEach(function(u){return o.addCue(u)})}),g.textTracks()},Rc={textTracksToJson:Ty,jsonToTextTracks:_y,trackToJson_:sl},rl="vjs-modal-dialog",mr=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.handleKeyDown_=function(y){return u.handleKeyDown(y)},u.close_=function(y){return u.close(y)},u.opened_=u.hasBeenOpened_=u.hasBeenFilled_=!1,u.closeable(!u.options_.uncloseable),u.content(u.options_.content),u.contentEl_=Re("div",{className:rl+"-content"},{role:"document"}),u.descEl_=Re("p",{className:rl+"-description vjs-control-text",id:u.el().getAttribute("aria-describedby")}),qe(u.descEl_,u.description()),u.el_.appendChild(u.descEl_),u.el_.appendChild(u.contentEl_),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},g.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,v.prototype.dispose.call(this)},g.buildCSSClass=function(){return rl+" vjs-hidden "+v.prototype.buildCSSClass.call(this)},g.label=function(){return this.localize(this.options_.label||"Modal Window")},g.description=function(){var o=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(o+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),o},g.open=function(){if(!this.opened_){var o=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!o.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&o.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=o.controls(),o.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},g.opened=function(o){return typeof o=="boolean"&&this[o?"open":"close"](),this.opened_},g.close=function(){if(this.opened_){var o=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&o.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&o.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},g.closeable=function(o){if(typeof o=="boolean"){var u=this.closeable_=!!o,y=this.getChild("closeButton");if(u&&!y){var w=this.contentEl_;this.contentEl_=this.el_,y=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=w,this.on(y,"close",this.close_)}!u&&y&&(this.off(y,"close",this.close_),this.removeChild(y),y.dispose())}return this.closeable_},g.fill=function(){this.fillWith(this.content())},g.fillWith=function(o){var u=this.contentEl(),y=u.parentNode,w=u.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,y.removeChild(u),this.empty(),sa(u,o),this.trigger("modalfill"),w?y.insertBefore(u,w):y.appendChild(u);var F=this.getChild("closeButton");F&&y.appendChild(F.el_)},g.empty=function(){this.trigger("beforemodalempty"),rn(this.contentEl()),this.trigger("modalempty")},g.content=function(o){return typeof o<"u"&&(this.content_=o),this.content_},g.conditionalFocus_=function(){var o=_.default.activeElement,u=this.player_.el_;this.previouslyActiveEl_=null,(u.contains(o)||u===o)&&(this.previouslyActiveEl_=o,this.focus())},g.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},g.handleKeyDown=function(o){if(o.stopPropagation(),C.default.isEventKey(o,"Escape")&&this.closeable()){o.preventDefault(),this.close();return}if(C.default.isEventKey(o,"Tab")){for(var u=this.focusableEls_(),y=this.el_.querySelector(":focus"),w,F=0;F<u.length;F++)if(y===u[F]){w=F;break}_.default.activeElement===this.el_&&(w=0),o.shiftKey&&w===0?(u[u.length-1].focus(),o.preventDefault()):!o.shiftKey&&w===u.length-1&&(u[0].focus(),o.preventDefault())}},g.focusableEls_=function(){var o=this.el_.querySelectorAll("*");return Array.prototype.filter.call(o,function(u){return(u instanceof m.default.HTMLAnchorElement||u instanceof m.default.HTMLAreaElement)&&u.hasAttribute("href")||(u instanceof m.default.HTMLInputElement||u instanceof m.default.HTMLSelectElement||u instanceof m.default.HTMLTextAreaElement||u instanceof m.default.HTMLButtonElement)&&!u.hasAttribute("disabled")||u instanceof m.default.HTMLIFrameElement||u instanceof m.default.HTMLObjectElement||u instanceof m.default.HTMLEmbedElement||u.hasAttribute("tabindex")&&u.getAttribute("tabindex")!==-1||u.hasAttribute("contenteditable")})},T}(me);mr.prototype.options_={pauseOnOpen:!0,temporary:!0},me.registerComponent("ModalDialog",mr);var vr=function(v){I.default(T,v);function T(d){var o;d===void 0&&(d=[]),o=v.call(this)||this,o.tracks_=[],Object.defineProperty(S.default(o),"length",{get:function(){return this.tracks_.length}});for(var u=0;u<d.length;u++)o.addTrack(d[u]);return o}var g=T.prototype;return g.addTrack=function(o){var u=this,y=this.tracks_.length;""+y in this||Object.defineProperty(this,y,{get:function(){return this.tracks_[y]}}),this.tracks_.indexOf(o)===-1&&(this.tracks_.push(o),this.trigger({track:o,type:"addtrack",target:this})),o.labelchange_=function(){u.trigger({track:o,type:"labelchange",target:u})},Be(o)&&o.addEventListener("labelchange",o.labelchange_)},g.removeTrack=function(o){for(var u,y=0,w=this.length;y<w;y++)if(this[y]===o){u=this[y],u.off&&u.off(),this.tracks_.splice(y,1);break}u&&this.trigger({track:u,type:"removetrack",target:this})},g.getTrackById=function(o){for(var u=null,y=0,w=this.length;y<w;y++){var F=this[y];if(F.id===o){u=F;break}}return u},T}(U);vr.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(var Ey in vr.prototype.allowedEvents_)vr.prototype["on"+Ey]=null;var nl=function(T,g){for(var d=0;d<T.length;d++)!Object.keys(T[d]).length||g.id===T[d].id||(T[d].enabled=!1)},by=function(v){I.default(T,v);function T(d){var o;d===void 0&&(d=[]);for(var u=d.length-1;u>=0;u--)if(d[u].enabled){nl(d,d[u]);break}return o=v.call(this,d)||this,o.changing_=!1,o}var g=T.prototype;return g.addTrack=function(o){var u=this;o.enabled&&nl(this,o),v.prototype.addTrack.call(this,o),o.addEventListener&&(o.enabledChange_=function(){u.changing_||(u.changing_=!0,nl(u,o),u.changing_=!1,u.trigger("change"))},o.addEventListener("enabledchange",o.enabledChange_))},g.removeTrack=function(o){v.prototype.removeTrack.call(this,o),o.removeEventListener&&o.enabledChange_&&(o.removeEventListener("enabledchange",o.enabledChange_),o.enabledChange_=null)},T}(vr),al=function(T,g){for(var d=0;d<T.length;d++)!Object.keys(T[d]).length||g.id===T[d].id||(T[d].selected=!1)},Sy=function(v){I.default(T,v);function T(d){var o;d===void 0&&(d=[]);for(var u=d.length-1;u>=0;u--)if(d[u].selected){al(d,d[u]);break}return o=v.call(this,d)||this,o.changing_=!1,Object.defineProperty(S.default(o),"selectedIndex",{get:function(){for(var w=0;w<this.length;w++)if(this[w].selected)return w;return-1},set:function(){}}),o}var g=T.prototype;return g.addTrack=function(o){var u=this;o.selected&&al(this,o),v.prototype.addTrack.call(this,o),o.addEventListener&&(o.selectedChange_=function(){u.changing_||(u.changing_=!0,al(u,o),u.changing_=!1,u.trigger("change"))},o.addEventListener("selectedchange",o.selectedChange_))},g.removeTrack=function(o){v.prototype.removeTrack.call(this,o),o.removeEventListener&&o.selectedChange_&&(o.removeEventListener("selectedchange",o.selectedChange_),o.selectedChange_=null)},T}(vr),Pc=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.addTrack=function(o){var u=this;v.prototype.addTrack.call(this,o),this.queueChange_||(this.queueChange_=function(){return u.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return u.trigger("selectedlanguagechange")}),o.addEventListener("modechange",this.queueChange_);var y=["metadata","chapters"];y.indexOf(o.kind)===-1&&o.addEventListener("modechange",this.triggerSelectedlanguagechange_)},g.removeTrack=function(o){v.prototype.removeTrack.call(this,o),o.removeEventListener&&(this.queueChange_&&o.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&o.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},T}(vr),Cy=function(){function v(g){g===void 0&&(g=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var d=0,o=g.length;d<o;d++)this.addTrackElement_(g[d])}var T=v.prototype;return T.addTrackElement_=function(d){var o=this.trackElements_.length;""+o in this||Object.defineProperty(this,o,{get:function(){return this.trackElements_[o]}}),this.trackElements_.indexOf(d)===-1&&this.trackElements_.push(d)},T.getTrackElementByTrack_=function(d){for(var o,u=0,y=this.trackElements_.length;u<y;u++)if(d===this.trackElements_[u].track){o=this.trackElements_[u];break}return o},T.removeTrackElement_=function(d){for(var o=0,u=this.trackElements_.length;o<u;o++)if(d===this.trackElements_[o]){this.trackElements_[o].track&&typeof this.trackElements_[o].track.off=="function"&&this.trackElements_[o].track.off(),typeof this.trackElements_[o].off=="function"&&this.trackElements_[o].off(),this.trackElements_.splice(o,1);break}},v}(),Dc=function(){function v(g){v.prototype.setCues_.call(this,g),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var T=v.prototype;return T.setCues_=function(d){var o=this.length||0,u=0,y=d.length;this.cues_=d,this.length_=d.length;var w=function($){""+$ in this||Object.defineProperty(this,""+$,{get:function(){return this.cues_[$]}})};if(o<y)for(u=o;u<y;u++)w.call(this,u)},T.getCueById=function(d){for(var o=null,u=0,y=this.length;u<y;u++){var w=this[u];if(w.id===d){o=w;break}}return o},v}(),wy={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},Ay={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},Iy={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},xc={disabled:"disabled",hidden:"hidden",showing:"showing"},ol=function(v){I.default(T,v);function T(g){var d;g===void 0&&(g={}),d=v.call(this)||this;var o={id:g.id||"vjs_track_"+ni(),kind:g.kind||"",language:g.language||""},u=g.label||"",y=function($){Object.defineProperty(S.default(d),$,{get:function(){return o[$]},set:function(){}})};for(var w in o)y(w);return Object.defineProperty(S.default(d),"label",{get:function(){return u},set:function($){$!==u&&(u=$,this.trigger("labelchange"))}}),d}return T}(U),ll=function(T){var g=["protocol","hostname","port","pathname","search","hash","host"],d=_.default.createElement("a");d.href=T;for(var o={},u=0;u<g.length;u++)o[g[u]]=d[g[u]];return o.protocol==="http:"&&(o.host=o.host.replace(/:80$/,"")),o.protocol==="https:"&&(o.host=o.host.replace(/:443$/,"")),o.protocol||(o.protocol=m.default.location.protocol),o.host||(o.host=m.default.location.host),o},Oc=function(T){if(!T.match(/^https?:\/\//)){var g=_.default.createElement("a");g.href=T,T=g.href}return T},ul=function(T){if(typeof T=="string"){var g=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/,d=g.exec(T);if(d)return d.pop().toLowerCase()}return""},pa=function(T,g){g===void 0&&(g=m.default.location);var d=ll(T),o=d.protocol===":"?g.protocol:d.protocol,u=o+d.host!==g.protocol+g.host;return u},Ly=Object.freeze({__proto__:null,parseUrl:ll,getAbsoluteURL:Oc,getFileExtension:ul,isCrossOrigin:pa}),Mc=function(T,g){var d=new m.default.WebVTT.Parser(m.default,m.default.vttjs,m.default.WebVTT.StringDecoder()),o=[];d.oncue=function(u){g.addCue(u)},d.onparsingerror=function(u){o.push(u)},d.onflush=function(){g.trigger({type:"loadeddata",target:g})},d.parse(T),o.length>0&&(m.default.console&&m.default.console.groupCollapsed&&m.default.console.groupCollapsed("Text Track parsing errors for "+g.src),o.forEach(function(u){return Q.error(u)}),m.default.console&&m.default.console.groupEnd&&m.default.console.groupEnd()),d.flush()},Fc=function(T,g){var d={uri:T},o=pa(T);o&&(d.cors=o);var u=g.tech_.crossOrigin()==="use-credentials";u&&(d.withCredentials=u),k.default(d,ot(this,function(y,w,F){if(y)return Q.error(y,w);g.loaded_=!0,typeof m.default.WebVTT!="function"?g.tech_&&g.tech_.any(["vttjsloaded","vttjserror"],function($){if($.type==="vttjserror"){Q.error("vttjs failed to load, stopping trying to process "+g.src);return}return Mc(F,g)}):Mc(F,g)}))},fn=function(v){I.default(T,v);function T(d){var o;if(d===void 0&&(d={}),!d.tech)throw new Error("A tech was not provided.");var u=dt(d,{kind:Iy[d.kind]||"subtitles",language:d.language||d.srclang||""}),y=xc[u.mode]||"disabled",w=u.default;(u.kind==="metadata"||u.kind==="chapters")&&(y="hidden"),o=v.call(this,u)||this,o.tech_=u.tech,o.cues_=[],o.activeCues_=[],o.preload_=o.tech_.preloadTextTracks!==!1;var F=new Dc(o.cues_),$=new Dc(o.activeCues_),K=!1;o.timeupdateHandler=ot(S.default(o),function(V){if(V===void 0&&(V={}),!this.tech_.isDisposed()){if(!this.tech_.isReady_){V.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,K&&(this.trigger("cuechange"),K=!1),V.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});var z=function(){o.stopTracking()};return o.tech_.one("dispose",z),y!=="disabled"&&o.startTracking(),Object.defineProperties(S.default(o),{default:{get:function(){return w},set:function(){}},mode:{get:function(){return y},set:function(ge){xc[ge]&&y!==ge&&(y=ge,!this.preload_&&y!=="disabled"&&this.cues.length===0&&Fc(this.src,this),this.stopTracking(),y!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?F:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(this.cues.length===0)return $;for(var ge=this.tech_.currentTime(),Ae=[],We=0,Ys=this.cues.length;We<Ys;We++){var Di=this.cues[We];(Di.startTime<=ge&&Di.endTime>=ge||Di.startTime===Di.endTime&&Di.startTime<=ge&&Di.startTime+.5>=ge)&&Ae.push(Di)}if(K=!1,Ae.length!==this.activeCues_.length)K=!0;else for(var Ul=0;Ul<Ae.length;Ul++)this.activeCues_.indexOf(Ae[Ul])===-1&&(K=!0);return this.activeCues_=Ae,$.setCues_(this.activeCues_),$},set:function(){}}}),u.src?(o.src=u.src,o.preload_||(o.loaded_=!0),(o.preload_||u.kind!=="subtitles"&&u.kind!=="captions")&&Fc(o.src,S.default(o))):o.loaded_=!0,o}var g=T.prototype;return g.startTracking=function(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)},g.stopTracking=function(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)},g.addCue=function(o){var u=o;if(!("getCueAsHTML"in u)){u=new m.default.vttjs.VTTCue(o.startTime,o.endTime,o.text);for(var y in o)y in u||(u[y]=o[y]);u.id=o.id,u.originalCue_=o}for(var w=this.tech_.textTracks(),F=0;F<w.length;F++)w[F]!==this&&w[F].removeCue(u);this.cues_.push(u),this.cues.setCues_(this.cues_)},g.removeCue=function(o){for(var u=this.cues_.length;u--;){var y=this.cues_[u];if(y===o||y.originalCue_&&y.originalCue_===o){this.cues_.splice(u,1),this.cues.setCues_(this.cues_);break}}},T}(ol);fn.prototype.allowedEvents_={cuechange:"cuechange"};var Nc=function(v){I.default(T,v);function T(g){var d;g===void 0&&(g={});var o=dt(g,{kind:Ay[g.kind]||""});d=v.call(this,o)||this;var u=!1;return Object.defineProperty(S.default(d),"enabled",{get:function(){return u},set:function(w){typeof w!="boolean"||w===u||(u=w,this.trigger("enabledchange"))}}),o.enabled&&(d.enabled=o.enabled),d.loaded_=!0,d}return T}(ol),Bc=function(v){I.default(T,v);function T(g){var d;g===void 0&&(g={});var o=dt(g,{kind:wy[g.kind]||""});d=v.call(this,o)||this;var u=!1;return Object.defineProperty(S.default(d),"selected",{get:function(){return u},set:function(w){typeof w!="boolean"||w===u||(u=w,this.trigger("selectedchange"))}}),o.selected&&(d.selected=o.selected),d}return T}(ol),Uc=0,ky=1,$c=2,Ry=3,yr=function(v){I.default(T,v);function T(g){var d;g===void 0&&(g={}),d=v.call(this)||this;var o,u=new fn(g);return d.kind=u.kind,d.src=u.src,d.srclang=u.language,d.label=u.label,d.default=u.default,Object.defineProperties(S.default(d),{readyState:{get:function(){return o}},track:{get:function(){return u}}}),o=Uc,u.addEventListener("loadeddata",function(){o=$c,d.trigger({type:"load",target:S.default(d)})}),d}return T}(U);yr.prototype.allowedEvents_={load:"load"},yr.NONE=Uc,yr.LOADING=ky,yr.LOADED=$c,yr.ERROR=Ry;var ai={audio:{ListClass:by,TrackClass:Nc,capitalName:"Audio"},video:{ListClass:Sy,TrackClass:Bc,capitalName:"Video"},text:{ListClass:Pc,TrackClass:fn,capitalName:"Text"}};Object.keys(ai).forEach(function(v){ai[v].getterName=v+"Tracks",ai[v].privateName=v+"Tracks_"});var Tr={remoteText:{ListClass:Pc,TrackClass:fn,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:Cy,TrackClass:yr,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Gt=E.default({},ai,Tr);Tr.names=Object.keys(Tr),ai.names=Object.keys(ai),Gt.names=[].concat(Tr.names).concat(ai.names);function Py(v,T,g,d,o){o===void 0&&(o={});var u=v.textTracks();o.kind=T,g&&(o.label=g),d&&(o.language=d),o.tech=v;var y=new Gt.text.TrackClass(o);return u.addTrack(y),y}var lt=function(v){I.default(T,v);function T(d,o){var u;return d===void 0&&(d={}),o===void 0&&(o=function(){}),d.reportTouchActivity=!1,u=v.call(this,null,d,o)||this,u.onDurationChange_=function(y){return u.onDurationChange(y)},u.trackProgress_=function(y){return u.trackProgress(y)},u.trackCurrentTime_=function(y){return u.trackCurrentTime(y)},u.stopTrackingCurrentTime_=function(y){return u.stopTrackingCurrentTime(y)},u.disposeSourceHandler_=function(y){return u.disposeSourceHandler(y)},u.queuedHanders_=new Set,u.hasStarted_=!1,u.on("playing",function(){this.hasStarted_=!0}),u.on("loadstart",function(){this.hasStarted_=!1}),Gt.names.forEach(function(y){var w=Gt[y];d&&d[w.getterName]&&(u[w.privateName]=d[w.getterName])}),u.featuresProgressEvents||u.manualProgressOn(),u.featuresTimeupdateEvents||u.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(y){d["native"+y+"Tracks"]===!1&&(u["featuresNative"+y+"Tracks"]=!1)}),d.nativeCaptions===!1||d.nativeTextTracks===!1?u.featuresNativeTextTracks=!1:(d.nativeCaptions===!0||d.nativeTextTracks===!0)&&(u.featuresNativeTextTracks=!0),u.featuresNativeTextTracks||u.emulateTextTracks(),u.preloadTextTracks=d.preloadTextTracks!==!1,u.autoRemoteTextTracks_=new Gt.text.ListClass,u.initTrackListeners(),d.nativeControlsForTouch||u.emitTapEvents(),u.constructor&&(u.name_=u.constructor.name||"Unknown Tech"),u}var g=T.prototype;return g.triggerSourceset=function(o){var u=this;this.isReady_||this.one("ready",function(){return u.setTimeout(function(){return u.triggerSourceset(o)},1)}),this.trigger({src:o,type:"sourceset"})},g.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},g.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},g.trackProgress=function(o){this.stopTrackingProgress(),this.progressInterval=this.setInterval(ot(this,function(){var u=this.bufferedPercent();this.bufferedPercent_!==u&&this.trigger("progress"),this.bufferedPercent_=u,u===1&&this.stopTrackingProgress()}),500)},g.onDurationChange=function(o){this.duration_=this.duration()},g.buffered=function(){return Ks(0,0)},g.bufferedPercent=function(){return kc(this.buffered(),this.duration_)},g.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},g.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},g.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},g.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},g.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},g.dispose=function(){this.clearTracks(ai.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),v.prototype.dispose.call(this)},g.clearTracks=function(o){var u=this;o=[].concat(o),o.forEach(function(y){for(var w=u[y+"Tracks"]()||[],F=w.length;F--;){var $=w[F];y==="text"&&u.removeRemoteTextTrack($),w.removeTrack($)}})},g.cleanupAutoTextTracks=function(){for(var o=this.autoRemoteTextTracks_||[],u=o.length;u--;){var y=o[u];this.removeRemoteTextTrack(y)}},g.reset=function(){},g.crossOrigin=function(){},g.setCrossOrigin=function(){},g.error=function(o){return o!==void 0&&(this.error_=new Vt(o),this.trigger("error")),this.error_},g.played=function(){return this.hasStarted_?Ks(0,0):Ks()},g.play=function(){},g.setScrubbing=function(){},g.scrubbing=function(){},g.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},g.initTrackListeners=function(){var o=this;ai.names.forEach(function(u){var y=ai[u],w=function(){o.trigger(u+"trackchange")},F=o[y.getterName]();F.addEventListener("removetrack",w),F.addEventListener("addtrack",w),o.on("dispose",function(){F.removeEventListener("removetrack",w),F.removeEventListener("addtrack",w)})})},g.addWebVttScript_=function(){var o=this;if(!m.default.WebVTT)if(_.default.body.contains(this.el())){if(!this.options_["vtt.js"]&&Ve(D.default)&&Object.keys(D.default).length>0){this.trigger("vttjsloaded");return}var u=_.default.createElement("script");u.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",u.onload=function(){o.trigger("vttjsloaded")},u.onerror=function(){o.trigger("vttjserror")},this.on("dispose",function(){u.onload=null,u.onerror=null}),m.default.WebVTT=!0,this.el().parentNode.appendChild(u)}else this.ready(this.addWebVttScript_)},g.emulateTextTracks=function(){var o=this,u=this.textTracks(),y=this.remoteTextTracks(),w=function(V){return u.addTrack(V.track)},F=function(V){return u.removeTrack(V.track)};y.on("addtrack",w),y.on("removetrack",F),this.addWebVttScript_();var $=function(){return o.trigger("texttrackchange")},K=function(){$();for(var V=0;V<u.length;V++){var ge=u[V];ge.removeEventListener("cuechange",$),ge.mode==="showing"&&ge.addEventListener("cuechange",$)}};K(),u.addEventListener("change",K),u.addEventListener("addtrack",K),u.addEventListener("removetrack",K),this.on("dispose",function(){y.off("addtrack",w),y.off("removetrack",F),u.removeEventListener("change",K),u.removeEventListener("addtrack",K),u.removeEventListener("removetrack",K);for(var z=0;z<u.length;z++){var V=u[z];V.removeEventListener("cuechange",$)}})},g.addTextTrack=function(o,u,y){if(!o)throw new Error("TextTrack kind is required but was not provided");return Py(this,o,u,y)},g.createRemoteTextTrack=function(o){var u=dt(o,{tech:this});return new Tr.remoteTextEl.TrackClass(u)},g.addRemoteTextTrack=function(o,u){var y=this;o===void 0&&(o={});var w=this.createRemoteTextTrack(o);return u!==!0&&u!==!1&&(Q.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),u=!0),this.remoteTextTrackEls().addTrackElement_(w),this.remoteTextTracks().addTrack(w.track),u!==!0&&this.ready(function(){return y.autoRemoteTextTracks_.addTrack(w.track)}),w},g.removeRemoteTextTrack=function(o){var u=this.remoteTextTrackEls().getTrackElementByTrack_(o);this.remoteTextTrackEls().removeTrackElement_(u),this.remoteTextTracks().removeTrack(o),this.autoRemoteTextTracks_.removeTrack(o)},g.getVideoPlaybackQuality=function(){return{}},g.requestPictureInPicture=function(){var o=this.options_.Promise||m.default.Promise;if(o)return o.reject()},g.disablePictureInPicture=function(){return!0},g.setDisablePictureInPicture=function(){},g.requestVideoFrameCallback=function(o){var u=this,y=ni();return!this.isReady_||this.paused()?(this.queuedHanders_.add(y),this.one("playing",function(){u.queuedHanders_.has(y)&&(u.queuedHanders_.delete(y),o())})):this.requestNamedAnimationFrame(y,o),y},g.cancelVideoFrameCallback=function(o){this.queuedHanders_.has(o)?this.queuedHanders_.delete(o):this.cancelNamedAnimationFrame(o)},g.setPoster=function(){},g.playsinline=function(){},g.setPlaysinline=function(){},g.overrideNativeAudioTracks=function(){},g.overrideNativeVideoTracks=function(){},g.canPlayType=function(){return""},T.canPlayType=function(){return""},T.canPlaySource=function(o,u){return T.canPlayType(o.type)},T.isTech=function(o){return o.prototype instanceof T||o instanceof T||o===T},T.registerTech=function(o,u){if(T.techs_||(T.techs_={}),!T.isTech(u))throw new Error("Tech "+o+" must be a Tech");if(!T.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!T.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return o=vt(o),T.techs_[o]=u,T.techs_[fa(o)]=u,o!=="Tech"&&T.defaultTechOrder_.push(o),u},T.getTech=function(o){if(o){if(T.techs_&&T.techs_[o])return T.techs_[o];if(o=vt(o),m.default&&m.default.videojs&&m.default.videojs[o])return Q.warn("The "+o+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),m.default.videojs[o]}},T}(me);Gt.names.forEach(function(v){var T=Gt[v];lt.prototype[T.getterName]=function(){return this[T.privateName]=this[T.privateName]||new T.ListClass,this[T.privateName]}}),lt.prototype.featuresVolumeControl=!0,lt.prototype.featuresMuteControl=!0,lt.prototype.featuresFullscreenResize=!1,lt.prototype.featuresPlaybackRate=!1,lt.prototype.featuresProgressEvents=!1,lt.prototype.featuresSourceset=!1,lt.prototype.featuresTimeupdateEvents=!1,lt.prototype.featuresNativeTextTracks=!1,lt.prototype.featuresVideoFrameCallback=!1,lt.withSourceHandlers=function(v){v.registerSourceHandler=function(g,d){var o=v.sourceHandlers;o||(o=v.sourceHandlers=[]),d===void 0&&(d=o.length),o.splice(d,0,g)},v.canPlayType=function(g){for(var d=v.sourceHandlers||[],o,u=0;u<d.length;u++)if(o=d[u].canPlayType(g),o)return o;return""},v.selectSourceHandler=function(g,d){for(var o=v.sourceHandlers||[],u,y=0;y<o.length;y++)if(u=o[y].canHandleSource(g,d),u)return o[y];return null},v.canPlaySource=function(g,d){var o=v.selectSourceHandler(g,d);return o?o.canHandleSource(g,d):""};var T=["seekable","seeking","duration"];T.forEach(function(g){var d=this[g];typeof d=="function"&&(this[g]=function(){return this.sourceHandler_&&this.sourceHandler_[g]?this.sourceHandler_[g].apply(this.sourceHandler_,arguments):d.apply(this,arguments)})},v.prototype),v.prototype.setSource=function(g){var d=v.selectSourceHandler(g,this.options_);d||(v.nativeSourceHandler?d=v.nativeSourceHandler:Q.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),d!==v.nativeSourceHandler&&(this.currentSource_=g),this.sourceHandler_=d.handleSource(g,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},v.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},me.registerComponent("Tech",lt),lt.registerTech("Tech",lt),lt.defaultTechOrder_=[];var qs={},hl={},ga={};function Dy(v,T){qs[v]=qs[v]||[],qs[v].push(T)}function xy(v,T,g){v.setTimeout(function(){return Ws(T,qs[T.type],g,v)},1)}function Oy(v,T){v.forEach(function(g){return g.setTech&&g.setTech(T)})}function My(v,T,g){return v.reduceRight(cl(g),T[g]())}function Fy(v,T,g,d){return T[g](v.reduce(cl(g),d))}function Hc(v,T,g,d){d===void 0&&(d=null);var o="call"+vt(g),u=v.reduce(cl(o),d),y=u===ga,w=y?null:T[g](u);return Uy(v,g,w,y),w}var Ny={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},By={setCurrentTime:1,setMuted:1,setVolume:1},jc={play:1,pause:1};function cl(v){return function(T,g){return T===ga?ga:g[v]?g[v](T):T}}function Uy(v,T,g,d){for(var o=v.length-1;o>=0;o--){var u=v[o];u[T]&&u[T](d,g)}}function $y(v){hl[v.id()]=null}function Hy(v,T){var g=hl[v.id()],d=null;if(g==null)return d=T(v),hl[v.id()]=[[T,d]],d;for(var o=0;o<g.length;o++){var u=g[o],y=u[0],w=u[1];y===T&&(d=w)}return d===null&&(d=T(v),g.push([T,d])),d}function Ws(v,T,g,d,o,u){v===void 0&&(v={}),T===void 0&&(T=[]),o===void 0&&(o=[]),u===void 0&&(u=!1);var y=T,w=y[0],F=y.slice(1);if(typeof w=="string")Ws(v,qs[w],g,d,o,u);else if(w){var $=Hy(d,w);if(!$.setSource)return o.push($),Ws(v,F,g,d,o,u);$.setSource(De({},v),function(K,z){if(K)return Ws(v,F,g,d,o,u);o.push($),Ws(z,v.type===z.type?F:qs[z.type],g,d,o,u)})}else F.length?Ws(v,F,g,d,o,u):u?g(v,o):Ws(v,qs["*"],g,d,o,!0)}var jy={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},ma=function(T){T===void 0&&(T="");var g=ul(T),d=jy[g.toLowerCase()];return d||""},Vy=function(T,g){if(!g)return"";if(T.cache_.source.src===g&&T.cache_.source.type)return T.cache_.source.type;var d=T.cache_.sources.filter(function(w){return w.src===g});if(d.length)return d[0].type;for(var o=T.$$("source"),u=0;u<o.length;u++){var y=o[u];if(y.type&&y.src&&y.src===g)return y.type}return ma(g)},Gy=function v(T){if(Array.isArray(T)){var g=[];T.forEach(function(d){d=v(d),Array.isArray(d)?g=g.concat(d):$e(d)&&g.push(d)}),T=g}else typeof T=="string"&&T.trim()?T=[Vc({src:T})]:$e(T)&&typeof T.src=="string"&&T.src&&T.src.trim()?T=[Vc(T)]:T=[];return T};function Vc(v){if(!v.type){var T=ma(v.src);T&&(v.type=T)}return v}var Ky=function(v){I.default(T,v);function T(g,d,o){var u,y=dt({createEl:!1},d);if(u=v.call(this,g,y,o)||this,!d.playerOptions.sources||d.playerOptions.sources.length===0)for(var w=0,F=d.playerOptions.techOrder;w<F.length;w++){var $=vt(F[w]),K=lt.getTech($);if($||(K=me.getComponent($)),K&&K.isSupported()){g.loadTech_($);break}}else g.src(d.playerOptions.sources);return u}return T}(me);me.registerComponent("MediaLoader",Ky);var va=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.options_.controlText&&u.controlText(u.options_.controlText),u.handleMouseOver_=function(y){return u.handleMouseOver(y)},u.handleMouseOut_=function(y){return u.handleMouseOut(y)},u.handleClick_=function(y){return u.handleClick(y)},u.handleKeyDown_=function(y){return u.handleKeyDown(y)},u.emitTapEvents(),u.enable(),u}var g=T.prototype;return g.createEl=function(o,u,y){o===void 0&&(o="div"),u===void 0&&(u={}),y===void 0&&(y={}),u=De({className:this.buildCSSClass(),tabIndex:0},u),o==="button"&&Q.error("Creating a ClickableComponent with an HTML element of "+o+" is not supported; use a Button instead."),y=De({role:"button"},y),this.tabIndex_=u.tabIndex;var w=Re(o,u,y);return w.appendChild(Re("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(w),w},g.dispose=function(){this.controlTextEl_=null,v.prototype.dispose.call(this)},g.createControlTextEl=function(o){return this.controlTextEl_=Re("span",{className:"vjs-control-text"},{"aria-live":"polite"}),o&&o.appendChild(this.controlTextEl_),this.controlText(this.controlText_,o),this.controlTextEl_},g.controlText=function(o,u){if(u===void 0&&(u=this.el()),o===void 0)return this.controlText_||"Need Text";var y=this.localize(o);this.controlText_=o,qe(this.controlTextEl_,y),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&u.setAttribute("title",y)},g.buildCSSClass=function(){return"vjs-control vjs-button "+v.prototype.buildCSSClass.call(this)},g.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},g.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},g.handleLanguagechange=function(){this.controlText(this.controlText_)},g.handleClick=function(o){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},g.handleKeyDown=function(o){C.default.isEventKey(o,"Space")||C.default.isEventKey(o,"Enter")?(o.preventDefault(),o.stopPropagation(),this.trigger("click")):v.prototype.handleKeyDown.call(this,o)},T}(me);me.registerComponent("ClickableComponent",va);var qy=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update(),u.update_=function(y){return u.update(y)},d.on("posterchange",u.update_),u}var g=T.prototype;return g.dispose=function(){this.player().off("posterchange",this.update_),v.prototype.dispose.call(this)},g.createEl=function(){var o=Re("div",{className:"vjs-poster",tabIndex:-1});return o},g.update=function(o){var u=this.player().poster();this.setSrc(u),u?this.show():this.hide()},g.setSrc=function(o){var u="";o&&(u='url("'+o+'")'),this.el_.style.backgroundImage=u},g.handleClick=function(o){if(this.player_.controls()){var u=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;this.player_.tech(!0)&&!((Ot||Nt)&&u)&&this.player_.tech(!0).focus(),this.player_.paused()?Ri(this.player_.play()):this.player_.pause()}},T}(va);me.registerComponent("PosterImage",qy);var oi="#222",Gc="#ccc",Wy={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function dl(v,T){var g;if(v.length===4)g=v[1]+v[1]+v[2]+v[2]+v[3]+v[3];else if(v.length===7)g=v.slice(1);else throw new Error("Invalid color code provided, "+v+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(g.slice(0,2),16)+","+parseInt(g.slice(2,4),16)+","+parseInt(g.slice(4,6),16)+","+T+")"}function fl(v,T,g){try{v.style[T]=g}catch{return}}var zy=function(v){I.default(T,v);function T(d,o,u){var y;y=v.call(this,d,o,u)||this;var w=function($){return y.updateDisplay($)};return d.on("loadstart",function(F){return y.toggleDisplay(F)}),d.on("texttrackchange",w),d.on("loadedmetadata",function(F){return y.preselectTrack(F)}),d.ready(ot(S.default(y),function(){if(d.tech_&&d.tech_.featuresNativeTextTracks){this.hide();return}d.on("fullscreenchange",w),d.on("playerresize",w),m.default.addEventListener("orientationchange",w),d.on("dispose",function(){return m.default.removeEventListener("orientationchange",w)});for(var F=this.options_.playerOptions.tracks||[],$=0;$<F.length;$++)this.player_.addRemoteTextTrack(F[$],!0);this.preselectTrack()})),y}var g=T.prototype;return g.preselectTrack=function(){for(var o={captions:1,subtitles:1},u=this.player_.textTracks(),y=this.player_.cache_.selectedLanguage,w,F,$,K=0;K<u.length;K++){var z=u[K];y&&y.enabled&&y.language&&y.language===z.language&&z.kind in o?z.kind===y.kind?$=z:$||($=z):y&&!y.enabled?($=null,w=null,F=null):z.default&&(z.kind==="descriptions"&&!w?w=z:z.kind in o&&!F&&(F=z))}$?$.mode="showing":F?F.mode="showing":w&&(w.mode="showing")},g.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})},g.clearDisplay=function(){typeof m.default.WebVTT=="function"&&m.default.WebVTT.processCues(m.default,[],this.el_)},g.updateDisplay=function(){var o=this.player_.textTracks(),u=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),u){for(var y=[],w=0;w<o.length;++w){var F=o[w];F.mode==="showing"&&y.push(F)}this.updateForTrack(y);return}for(var $=null,K=null,z=o.length;z--;){var V=o[z];V.mode==="showing"&&(V.kind==="descriptions"?$=V:K=V)}K?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(K)):$&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack($))},g.updateDisplayState=function(o){for(var u=this.player_.textTrackSettings.getValues(),y=o.activeCues,w=y.length;w--;){var F=y[w];if(F){var $=F.displayState;if(u.color&&($.firstChild.style.color=u.color),u.textOpacity&&fl($.firstChild,"color",dl(u.color||"#fff",u.textOpacity)),u.backgroundColor&&($.firstChild.style.backgroundColor=u.backgroundColor),u.backgroundOpacity&&fl($.firstChild,"backgroundColor",dl(u.backgroundColor||"#000",u.backgroundOpacity)),u.windowColor&&(u.windowOpacity?fl($,"backgroundColor",dl(u.windowColor,u.windowOpacity)):$.style.backgroundColor=u.windowColor),u.edgeStyle&&(u.edgeStyle==="dropshadow"?$.firstChild.style.textShadow="2px 2px 3px "+oi+", 2px 2px 4px "+oi+", 2px 2px 5px "+oi:u.edgeStyle==="raised"?$.firstChild.style.textShadow="1px 1px "+oi+", 2px 2px "+oi+", 3px 3px "+oi:u.edgeStyle==="depressed"?$.firstChild.style.textShadow="1px 1px "+Gc+", 0 1px "+Gc+", -1px -1px "+oi+", 0 -1px "+oi:u.edgeStyle==="uniform"&&($.firstChild.style.textShadow="0 0 4px "+oi+", 0 0 4px "+oi+", 0 0 4px "+oi+", 0 0 4px "+oi)),u.fontPercent&&u.fontPercent!==1){var K=m.default.parseFloat($.style.fontSize);$.style.fontSize=K*u.fontPercent+"px",$.style.height="auto",$.style.top="auto"}u.fontFamily&&u.fontFamily!=="default"&&(u.fontFamily==="small-caps"?$.firstChild.style.fontVariant="small-caps":$.firstChild.style.fontFamily=Wy[u.fontFamily])}}},g.updateForTrack=function(o){if(Array.isArray(o)||(o=[o]),!(typeof m.default.WebVTT!="function"||o.every(function(ge){return!ge.activeCues}))){for(var u=[],y=0;y<o.length;++y)for(var w=o[y],F=0;F<w.activeCues.length;++F)u.push(w.activeCues[F]);m.default.WebVTT.processCues(m.default,u,this.el_);for(var $=0;$<o.length;++$){for(var K=o[$],z=0;z<K.activeCues.length;++z){var V=K.activeCues[z].displayState;vi(V,"vjs-text-track-cue"),vi(V,"vjs-text-track-cue-"+(K.language?K.language:$)),K.language&&ps(V,"lang",K.language)}this.player_.textTrackSettings&&this.updateDisplayState(K)}}},T}(me);me.registerComponent("TextTrackDisplay",zy);var Yy=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(){var o=this.player_.isAudio(),u=this.localize(o?"Audio Player":"Video Player"),y=Re("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[u])}),w=v.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return w.appendChild(y),w},T}(me);me.registerComponent("LoadingSpinner",Yy);var _i=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(o,u,y){u===void 0&&(u={}),y===void 0&&(y={}),o="button",u=De({className:this.buildCSSClass()},u),y=De({type:"button"},y);var w=Re(o,u,y);return w.appendChild(Re("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(w),w},g.addChild=function(o,u){u===void 0&&(u={});var y=this.constructor.name;return Q.warn("Adding an actionable (user controllable) child to a Button ("+y+") is not supported; use a ClickableComponent instead."),me.prototype.addChild.call(this,o,u)},g.enable=function(){v.prototype.enable.call(this),this.el_.removeAttribute("disabled")},g.disable=function(){v.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},g.handleKeyDown=function(o){if(C.default.isEventKey(o,"Space")||C.default.isEventKey(o,"Enter")){o.stopPropagation();return}v.prototype.handleKeyDown.call(this,o)},T}(va);me.registerComponent("Button",_i);var Kc=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.mouseused_=!1,u.on("mousedown",function(y){return u.handleMouseDown(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-big-play-button"},g.handleClick=function(o){var u=this.player_.play();if(this.mouseused_&&o.clientX&&o.clientY){var y=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;Ri(u),this.player_.tech(!0)&&!((Ot||Nt)&&y)&&this.player_.tech(!0).focus();return}var w=this.player_.getChild("controlBar"),F=w&&w.getChild("playToggle");if(!F){this.player_.tech(!0).focus();return}var $=function(){return F.focus()};dn(u)?u.then($,function(){}):this.setTimeout($,1)},g.handleKeyDown=function(o){this.mouseused_=!1,v.prototype.handleKeyDown.call(this,o)},g.handleMouseDown=function(o){this.mouseused_=!0},T}(_i);Kc.prototype.controlText_="Play Video",me.registerComponent("BigPlayButton",Kc);var Xy=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.controlText(o&&o.controlText||u.localize("Close")),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-close-button "+v.prototype.buildCSSClass.call(this)},g.handleClick=function(o){this.trigger({type:"close",bubbles:!1})},g.handleKeyDown=function(o){C.default.isEventKey(o,"Esc")?(o.preventDefault(),o.stopPropagation(),this.trigger("click")):v.prototype.handleKeyDown.call(this,o)},T}(_i);me.registerComponent("CloseButton",Xy);var qc=function(v){I.default(T,v);function T(d,o){var u;return o===void 0&&(o={}),u=v.call(this,d,o)||this,o.replay=o.replay===void 0||o.replay,u.on(d,"play",function(y){return u.handlePlay(y)}),u.on(d,"pause",function(y){return u.handlePause(y)}),o.replay&&u.on(d,"ended",function(y){return u.handleEnded(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-play-control "+v.prototype.buildCSSClass.call(this)},g.handleClick=function(o){this.player_.paused()?Ri(this.player_.play()):this.player_.pause()},g.handleSeeked=function(o){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(o):this.handlePlay(o)},g.handlePlay=function(o){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},g.handlePause=function(o){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},g.handleEnded=function(o){var u=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",function(y){return u.handleSeeked(y)})},T}(_i);qc.prototype.controlText_="Play",me.registerComponent("PlayToggle",qc);var Wc=function(T,g){T=T<0?0:T;var d=Math.floor(T%60),o=Math.floor(T/60%60),u=Math.floor(T/3600),y=Math.floor(g/60%60),w=Math.floor(g/3600);return(isNaN(T)||T===1/0)&&(u=o=d="-"),u=u>0||w>0?u+":":"",o=((u||y>=10)&&o<10?"0"+o:o)+":",d=d<10?"0"+d:d,u+o+d},pl=Wc;function Qy(v){pl=v}function Jy(){pl=Wc}function _r(v,T){return T===void 0&&(T=v),pl(v,T)}var Er=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,["timeupdate","ended"],function(y){return u.updateContent(y)}),u.updateTextNode_(),u}var g=T.prototype;return g.createEl=function(){var o=this.buildCSSClass(),u=v.prototype.createEl.call(this,"div",{className:o+" vjs-time-control vjs-control"}),y=Re("span",{className:"vjs-control-text",textContent:this.localize(this.labelText_)+" "},{role:"presentation"});return u.appendChild(y),this.contentEl_=Re("span",{className:o+"-display"},{"aria-live":"off",role:"presentation"}),u.appendChild(this.contentEl_),u},g.dispose=function(){this.contentEl_=null,this.textNode_=null,v.prototype.dispose.call(this)},g.updateTextNode_=function(o){var u=this;o===void 0&&(o=0),o=_r(o),this.formattedTime_!==o&&(this.formattedTime_=o,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){if(u.contentEl_){var y=u.textNode_;y&&u.contentEl_.firstChild!==y&&(y=null,Q.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),u.textNode_=_.default.createTextNode(u.formattedTime_),u.textNode_&&(y?u.contentEl_.replaceChild(u.textNode_,y):u.contentEl_.appendChild(u.textNode_))}}))},g.updateContent=function(o){},T}(me);Er.prototype.labelText_="Time",Er.prototype.controlText_="Time",me.registerComponent("TimeDisplay",Er);var gl=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-current-time"},g.updateContent=function(o){var u;this.player_.ended()?u=this.player_.duration():u=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(u)},T}(Er);gl.prototype.labelText_="Current Time",gl.prototype.controlText_="Current Time",me.registerComponent("CurrentTimeDisplay",gl);var ml=function(v){I.default(T,v);function T(d,o){var u;u=v.call(this,d,o)||this;var y=function(F){return u.updateContent(F)};return u.on(d,"durationchange",y),u.on(d,"loadstart",y),u.on(d,"loadedmetadata",y),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-duration"},g.updateContent=function(o){var u=this.player_.duration();this.updateTextNode_(u)},T}(Er);ml.prototype.labelText_="Duration",ml.prototype.controlText_="Duration",me.registerComponent("DurationDisplay",ml);var Zy=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),u=v.prototype.createEl.call(this,"div"),y=v.prototype.createEl.call(this,"span",{textContent:"/"});return u.appendChild(y),o.appendChild(u),o},T}(me);me.registerComponent("TimeDivider",Zy);var vl=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,"durationchange",function(y){return u.updateContent(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-remaining-time"},g.createEl=function(){var o=v.prototype.createEl.call(this);return this.options_.displayNegative!==!1&&o.insertBefore(Re("span",{},{"aria-hidden":!0},"-"),this.contentEl_),o},g.updateContent=function(o){if(typeof this.player_.duration()=="number"){var u;this.player_.ended()?u=0:this.player_.remainingTimeDisplay?u=this.player_.remainingTimeDisplay():u=this.player_.remainingTime(),this.updateTextNode_(u)}},T}(Er);vl.prototype.labelText_="Remaining Time",vl.prototype.controlText_="Remaining Time",me.registerComponent("RemainingTimeDisplay",vl);var eT=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.updateShowing(),u.on(u.player(),"durationchange",function(y){return u.updateShowing(y)}),u}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Re("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(Re("span",{className:"vjs-control-text",textContent:this.localize("Stream Type")+" "})),this.contentEl_.appendChild(_.default.createTextNode(this.localize("LIVE"))),o.appendChild(this.contentEl_),o},g.dispose=function(){this.contentEl_=null,v.prototype.dispose.call(this)},g.updateShowing=function(o){this.player().duration()===1/0?this.show():this.hide()},T}(me);me.registerComponent("LiveDisplay",eT);var zc=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.updateLiveEdgeStatus(),u.player_.liveTracker&&(u.updateLiveEdgeStatusHandler_=function(y){return u.updateLiveEdgeStatus(y)},u.on(u.player_.liveTracker,"liveedgechange",u.updateLiveEdgeStatusHandler_)),u}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=Re("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),o.appendChild(this.textEl_),o},g.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},g.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},g.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,v.prototype.dispose.call(this)},T}(_i);zc.prototype.controlText_="Seek to live, currently playing live",me.registerComponent("SeekToLive",zc);var ya=function(T,g,d){return T=Number(T),Math.min(d,Math.max(g,isNaN(T)?g:T))},yl=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.handleMouseDown_=function(y){return u.handleMouseDown(y)},u.handleMouseUp_=function(y){return u.handleMouseUp(y)},u.handleKeyDown_=function(y){return u.handleKeyDown(y)},u.handleClick_=function(y){return u.handleClick(y)},u.handleMouseMove_=function(y){return u.handleMouseMove(y)},u.update_=function(y){return u.update(y)},u.bar=u.getChild(u.options_.barName),u.vertical(!!u.options_.vertical),u.enable(),u}var g=T.prototype;return g.enabled=function(){return this.enabled_},g.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},g.disable=function(){if(this.enabled()){var o=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(o,"mousemove",this.handleMouseMove_),this.off(o,"mouseup",this.handleMouseUp_),this.off(o,"touchmove",this.handleMouseMove_),this.off(o,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},g.createEl=function(o,u,y){return u===void 0&&(u={}),y===void 0&&(y={}),u.className=u.className+" vjs-slider",u=De({tabIndex:0},u),y=De({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},y),v.prototype.createEl.call(this,o,u,y)},g.handleMouseDown=function(o){var u=this.bar.el_.ownerDocument;o.type==="mousedown"&&o.preventDefault(),o.type==="touchstart"&&!mt&&o.preventDefault(),Zn(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(u,"mousemove",this.handleMouseMove_),this.on(u,"mouseup",this.handleMouseUp_),this.on(u,"touchmove",this.handleMouseMove_),this.on(u,"touchend",this.handleMouseUp_),this.handleMouseMove(o,!0)},g.handleMouseMove=function(o){},g.handleMouseUp=function(){var o=this.bar.el_.ownerDocument;ea(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(o,"mousemove",this.handleMouseMove_),this.off(o,"mouseup",this.handleMouseUp_),this.off(o,"touchmove",this.handleMouseMove_),this.off(o,"touchend",this.handleMouseUp_),this.update()},g.update=function(){var o=this;if(!(!this.el_||!this.bar)){var u=this.getProgress();return u===this.progress_||(this.progress_=u,this.requestNamedAnimationFrame("Slider#update",function(){var y=o.vertical()?"height":"width";o.bar.el().style[y]=(u*100).toFixed(2)+"%"})),u}},g.getProgress=function(){return Number(ya(this.getPercent(),0,1).toFixed(4))},g.calculateDistance=function(o){var u=js(this.el_,o);return this.vertical()?u.y:u.x},g.handleKeyDown=function(o){C.default.isEventKey(o,"Left")||C.default.isEventKey(o,"Down")?(o.preventDefault(),o.stopPropagation(),this.stepBack()):C.default.isEventKey(o,"Right")||C.default.isEventKey(o,"Up")?(o.preventDefault(),o.stopPropagation(),this.stepForward()):v.prototype.handleKeyDown.call(this,o)},g.handleClick=function(o){o.stopPropagation(),o.preventDefault()},g.vertical=function(o){if(o===void 0)return this.vertical_||!1;this.vertical_=!!o,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")},T}(me);me.registerComponent("Slider",yl);var Tl=function(T,g){return ya(T/g*100,0,100).toFixed(2)+"%"},tT=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.partEls_=[],u.on(d,"progress",function(y){return u.update(y)}),u}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),u=Re("span",{className:"vjs-control-text"}),y=Re("span",{textContent:this.localize("Loaded")}),w=_.default.createTextNode(": ");return this.percentageEl_=Re("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),o.appendChild(u),u.appendChild(y),u.appendChild(w),u.appendChild(this.percentageEl_),o},g.dispose=function(){this.partEls_=null,this.percentageEl_=null,v.prototype.dispose.call(this)},g.update=function(o){var u=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var y=u.player_.liveTracker,w=u.player_.buffered(),F=y&&y.isLive()?y.seekableEnd():u.player_.duration(),$=u.player_.bufferedEnd(),K=u.partEls_,z=Tl($,F);u.percent_!==z&&(u.el_.style.width=z,qe(u.percentageEl_,z),u.percent_=z);for(var V=0;V<w.length;V++){var ge=w.start(V),Ae=w.end(V),We=K[V];We||(We=u.el_.appendChild(Re()),K[V]=We),!(We.dataset.start===ge&&We.dataset.end===Ae)&&(We.dataset.start=ge,We.dataset.end=Ae,We.style.left=Tl(ge,$),We.style.width=Tl(Ae-ge,$))}for(var Ys=K.length;Ys>w.length;Ys--)u.el_.removeChild(K[Ys-1]);K.length=w.length})},T}(me);me.registerComponent("LoadProgressBar",tT);var iT=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=yi(ot(S.default(u),u.update),Wt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},g.update=function(o,u,y){var w=Li(this.el_),F=gs(this.player_.el()),$=o.width*u;if(!(!F||!w)){var K=o.left-F.left+$,z=o.width-$+(F.right-o.right),V=w.width/2;K<V?V+=V-K:z<V&&(V=z),V<0?V=0:V>w.width&&(V=w.width),V=Math.round(V),this.el_.style.right="-"+V+"px",this.write(y)}},g.write=function(o){qe(this.el_,o)},g.updateTime=function(o,u,y,w){var F=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var $,K=F.player_.duration();if(F.player_.liveTracker&&F.player_.liveTracker.isLive()){var z=F.player_.liveTracker.liveWindow(),V=z-u*z;$=(V<1?"":"-")+_r(V,z)}else $=_r(y,K);F.update(o,u,$),w&&w()})},T}(me);me.registerComponent("TimeTooltip",iT);var _l=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=yi(ot(S.default(u),u.update),Wt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},g.update=function(o,u){var y=this.getChild("timeTooltip");if(y){var w=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();y.updateTime(o,u,w)}},T}(me);_l.prototype.options_={children:[]},!M&&!Ke&&_l.prototype.options_.children.push("timeTooltip"),me.registerComponent("PlayProgressBar",_l);var Yc=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=yi(ot(S.default(u),u.update),Wt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},g.update=function(o,u){var y=this,w=u*this.player_.duration();this.getChild("timeTooltip").updateTime(o,u,w,function(){y.el_.style.left=o.width*u+"px"})},T}(me);Yc.prototype.options_={children:["timeTooltip"]},me.registerComponent("MouseTimeDisplay",Yc);var Ta=5,Xc=12,El=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.setEventHandlers_(),u}var g=T.prototype;return g.setEventHandlers_=function(){var o=this;this.update_=ot(this,this.update),this.update=yi(this.update_,Wt),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(u){return o.enableInterval_(u)},this.disableIntervalHandler_=function(u){return o.disableInterval_(u)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in _.default&&"visibilityState"in _.default&&this.on(_.default,"visibilitychange",this.toggleVisibility_)},g.toggleVisibility_=function(o){_.default.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(o)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())},g.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,Wt))},g.disableInterval_=function(o){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&o&&o.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)},g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},g.update=function(o){var u=this;if(_.default.visibilityState!=="hidden"){var y=v.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var w=u.player_.ended()?u.player_.duration():u.getCurrentTime_(),F=u.player_.liveTracker,$=u.player_.duration();F&&F.isLive()&&($=u.player_.liveTracker.liveCurrentTime()),u.percent_!==y&&(u.el_.setAttribute("aria-valuenow",(y*100).toFixed(2)),u.percent_=y),(u.currentTime_!==w||u.duration_!==$)&&(u.el_.setAttribute("aria-valuetext",u.localize("progress bar timing: currentTime={1} duration={2}",[_r(w,$),_r($,$)],"{1} of {2}")),u.currentTime_=w,u.duration_=$),u.bar&&u.bar.update(gs(u.el()),u.getProgress())}),y}},g.userSeek_=function(o){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(o)},g.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},g.getPercent=function(){var o=this.getCurrentTime_(),u,y=this.player_.liveTracker;return y&&y.isLive()?(u=(o-y.seekableStart())/y.liveWindow(),y.atLiveEdge()&&(u=1)):u=o/this.player_.duration(),u},g.handleMouseDown=function(o){ms(o)&&(o.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),v.prototype.handleMouseDown.call(this,o))},g.handleMouseMove=function(o,u){if(u===void 0&&(u=!1),!!ms(o)){!u&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);var y,w=this.calculateDistance(o),F=this.player_.liveTracker;if(!F||!F.isLive())y=w*this.player_.duration(),y===this.player_.duration()&&(y=y-.1);else{if(w>=.99){F.seekToLiveEdge();return}var $=F.seekableStart(),K=F.liveCurrentTime();if(y=$+w*F.liveWindow(),y>=K&&(y=K),y<=$&&(y=$+.1),y===1/0)return}this.userSeek_(y)}},g.enable=function(){v.prototype.enable.call(this);var o=this.getChild("mouseTimeDisplay");o&&o.show()},g.disable=function(){v.prototype.disable.call(this);var o=this.getChild("mouseTimeDisplay");o&&o.hide()},g.handleMouseUp=function(o){v.prototype.handleMouseUp.call(this,o),o&&o.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?Ri(this.player_.play()):this.update_()},g.stepForward=function(){this.userSeek_(this.player_.currentTime()+Ta)},g.stepBack=function(){this.userSeek_(this.player_.currentTime()-Ta)},g.handleAction=function(o){this.player_.paused()?this.player_.play():this.player_.pause()},g.handleKeyDown=function(o){var u=this.player_.liveTracker;if(C.default.isEventKey(o,"Space")||C.default.isEventKey(o,"Enter"))o.preventDefault(),o.stopPropagation(),this.handleAction(o);else if(C.default.isEventKey(o,"Home"))o.preventDefault(),o.stopPropagation(),this.userSeek_(0);else if(C.default.isEventKey(o,"End"))o.preventDefault(),o.stopPropagation(),u&&u.isLive()?this.userSeek_(u.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(C.default(o))){o.preventDefault(),o.stopPropagation();var y=(C.default.codes[C.default(o)]-C.default.codes[0])*10/100;u&&u.isLive()?this.userSeek_(u.seekableStart()+u.liveWindow()*y):this.userSeek_(this.player_.duration()*y)}else C.default.isEventKey(o,"PgDn")?(o.preventDefault(),o.stopPropagation(),this.userSeek_(this.player_.currentTime()-Ta*Xc)):C.default.isEventKey(o,"PgUp")?(o.preventDefault(),o.stopPropagation(),this.userSeek_(this.player_.currentTime()+Ta*Xc)):v.prototype.handleKeyDown.call(this,o)},g.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in _.default&&"visibilityState"in _.default&&this.off(_.default,"visibilitychange",this.toggleVisibility_),v.prototype.dispose.call(this)},T}(yl);El.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},!M&&!Ke&&El.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),me.registerComponent("SeekBar",El);var Qc=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.handleMouseMove=yi(ot(S.default(u),u.handleMouseMove),Wt),u.throttledHandleMouseSeek=yi(ot(S.default(u),u.handleMouseSeek),Wt),u.handleMouseUpHandler_=function(y){return u.handleMouseUp(y)},u.handleMouseDownHandler_=function(y){return u.handleMouseDown(y)},u.enable(),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},g.handleMouseMove=function(o){var u=this.getChild("seekBar");if(u){var y=u.getChild("playProgressBar"),w=u.getChild("mouseTimeDisplay");if(!(!y&&!w)){var F=u.el(),$=Li(F),K=js(F,o).x;K=ya(K,0,1),w&&w.update($,K),y&&y.update($,u.getProgress())}}},g.handleMouseSeek=function(o){var u=this.getChild("seekBar");u&&u.handleMouseMove(o)},g.enabled=function(){return this.enabled_},g.disable=function(){if(this.children().forEach(function(u){return u.disable&&u.disable()}),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){var o=this.getChild("seekBar");this.player_.scrubbing(!1),o.videoWasPlaying&&Ri(this.player_.play())}},g.enable=function(){this.children().forEach(function(o){return o.enable&&o.enable()}),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},g.removeListenersAddedOnMousedownAndTouchstart=function(){var o=this.el_.ownerDocument;this.off(o,"mousemove",this.throttledHandleMouseSeek),this.off(o,"touchmove",this.throttledHandleMouseSeek),this.off(o,"mouseup",this.handleMouseUpHandler_),this.off(o,"touchend",this.handleMouseUpHandler_)},g.handleMouseDown=function(o){var u=this.el_.ownerDocument,y=this.getChild("seekBar");y&&y.handleMouseDown(o),this.on(u,"mousemove",this.throttledHandleMouseSeek),this.on(u,"touchmove",this.throttledHandleMouseSeek),this.on(u,"mouseup",this.handleMouseUpHandler_),this.on(u,"touchend",this.handleMouseUpHandler_)},g.handleMouseUp=function(o){var u=this.getChild("seekBar");u&&u.handleMouseUp(o),this.removeListenersAddedOnMousedownAndTouchstart()},T}(me);Qc.prototype.options_={children:["seekBar"]},me.registerComponent("ProgressControl",Qc);var Jc=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,["enterpictureinpicture","leavepictureinpicture"],function(y){return u.handlePictureInPictureChange(y)}),u.on(d,["disablepictureinpicturechanged","loadedmetadata"],function(y){return u.handlePictureInPictureEnabledChange(y)}),u.on(d,["loadedmetadata","audioonlymodechange","audiopostermodechange"],function(){var y=d.currentType().substring(0,5)==="audio";y||d.audioPosterMode()||d.audioOnlyMode()?(d.isInPictureInPicture()&&d.exitPictureInPicture(),u.hide()):u.show()}),u.disable(),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-picture-in-picture-control "+v.prototype.buildCSSClass.call(this)},g.handlePictureInPictureEnabledChange=function(){_.default.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1?this.enable():this.disable()},g.handlePictureInPictureChange=function(o){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},g.handleClick=function(o){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},T}(_i);Jc.prototype.controlText_="Picture-in-Picture",me.registerComponent("PictureInPictureToggle",Jc);var Zc=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,"fullscreenchange",function(y){return u.handleFullscreenChange(y)}),_.default[d.fsApi_.fullscreenEnabled]===!1&&u.disable(),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-fullscreen-control "+v.prototype.buildCSSClass.call(this)},g.handleFullscreenChange=function(o){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},g.handleClick=function(o){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},T}(_i);Zc.prototype.controlText_="Fullscreen",me.registerComponent("FullscreenToggle",Zc);var sT=function(T,g){g.tech_&&!g.tech_.featuresVolumeControl&&T.addClass("vjs-hidden"),T.on(g,"loadstart",function(){g.tech_.featuresVolumeControl?T.removeClass("vjs-hidden"):T.addClass("vjs-hidden")})},rT=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"div",{className:"vjs-volume-level"});return o.appendChild(v.prototype.createEl.call(this,"span",{className:"vjs-control-text"})),o},T}(me);me.registerComponent("VolumeLevel",rT);var nT=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=yi(ot(S.default(u),u.update),Wt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},g.update=function(o,u,y,w){if(!y){var F=gs(this.el_),$=gs(this.player_.el()),K=o.width*u;if(!$||!F)return;var z=o.left-$.left+K,V=o.width-K+($.right-o.right),ge=F.width/2;z<ge?ge+=ge-z:V<ge&&(ge=V),ge<0?ge=0:ge>F.width&&(ge=F.width),this.el_.style.right="-"+ge+"px"}this.write(w+"%")},g.write=function(o){qe(this.el_,o)},g.updateVolume=function(o,u,y,w,F){var $=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",function(){$.update(o,u,y,w.toFixed(0)),F&&F()})},T}(me);me.registerComponent("VolumeLevelTooltip",nT);var ed=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=yi(ot(S.default(u),u.update),Wt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},g.update=function(o,u,y){var w=this,F=100*u;this.getChild("volumeLevelTooltip").updateVolume(o,u,y,F,function(){y?w.el_.style.bottom=o.height*u+"px":w.el_.style.left=o.width*u+"px"})},T}(me);ed.prototype.options_={children:["volumeLevelTooltip"]},me.registerComponent("MouseVolumeLevelDisplay",ed);var _a=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on("slideractive",function(y){return u.updateLastVolume_(y)}),u.on(d,"volumechange",function(y){return u.updateARIAAttributes(y)}),d.ready(function(){return u.updateARIAAttributes()}),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},g.handleMouseDown=function(o){ms(o)&&v.prototype.handleMouseDown.call(this,o)},g.handleMouseMove=function(o){var u=this.getChild("mouseVolumeLevelDisplay");if(u){var y=this.el(),w=gs(y),F=this.vertical(),$=js(y,o);$=F?$.y:$.x,$=ya($,0,1),u.update(w,$,F)}ms(o)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(o)))},g.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},g.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},g.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},g.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},g.updateARIAAttributes=function(o){var u=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",u),this.el_.setAttribute("aria-valuetext",u+"%")},g.volumeAsPercentage_=function(){return Math.round(this.player_.volume()*100)},g.updateLastVolume_=function(){var o=this,u=this.player_.volume();this.one("sliderinactive",function(){o.player_.volume()===0&&o.player_.lastVolume_(u)})},T}(yl);_a.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},!M&&!Ke&&_a.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),_a.prototype.playerEvent="volumechange",me.registerComponent("VolumeBar",_a);var td=function(v){I.default(T,v);function T(d,o){var u;return o===void 0&&(o={}),o.vertical=o.vertical||!1,(typeof o.volumeBar>"u"||Ve(o.volumeBar))&&(o.volumeBar=o.volumeBar||{},o.volumeBar.vertical=o.vertical),u=v.call(this,d,o)||this,sT(S.default(u),d),u.throttledHandleMouseMove=yi(ot(S.default(u),u.handleMouseMove),Wt),u.handleMouseUpHandler_=function(y){return u.handleMouseUp(y)},u.on("mousedown",function(y){return u.handleMouseDown(y)}),u.on("touchstart",function(y){return u.handleMouseDown(y)}),u.on("mousemove",function(y){return u.handleMouseMove(y)}),u.on(u.volumeBar,["focus","slideractive"],function(){u.volumeBar.addClass("vjs-slider-active"),u.addClass("vjs-slider-active"),u.trigger("slideractive")}),u.on(u.volumeBar,["blur","sliderinactive"],function(){u.volumeBar.removeClass("vjs-slider-active"),u.removeClass("vjs-slider-active"),u.trigger("sliderinactive")}),u}var g=T.prototype;return g.createEl=function(){var o="vjs-volume-horizontal";return this.options_.vertical&&(o="vjs-volume-vertical"),v.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+o})},g.handleMouseDown=function(o){var u=this.el_.ownerDocument;this.on(u,"mousemove",this.throttledHandleMouseMove),this.on(u,"touchmove",this.throttledHandleMouseMove),this.on(u,"mouseup",this.handleMouseUpHandler_),this.on(u,"touchend",this.handleMouseUpHandler_)},g.handleMouseUp=function(o){var u=this.el_.ownerDocument;this.off(u,"mousemove",this.throttledHandleMouseMove),this.off(u,"touchmove",this.throttledHandleMouseMove),this.off(u,"mouseup",this.handleMouseUpHandler_),this.off(u,"touchend",this.handleMouseUpHandler_)},g.handleMouseMove=function(o){this.volumeBar.handleMouseMove(o)},T}(me);td.prototype.options_={children:["volumeBar"]},me.registerComponent("VolumeControl",td);var aT=function(T,g){g.tech_&&!g.tech_.featuresMuteControl&&T.addClass("vjs-hidden"),T.on(g,"loadstart",function(){g.tech_.featuresMuteControl?T.removeClass("vjs-hidden"):T.addClass("vjs-hidden")})},id=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,aT(S.default(u),d),u.on(d,["loadstart","volumechange"],function(y){return u.update(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-mute-control "+v.prototype.buildCSSClass.call(this)},g.handleClick=function(o){var u=this.player_.volume(),y=this.player_.lastVolume_();if(u===0){var w=y<.1?.1:y;this.player_.volume(w),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())},g.update=function(o){this.updateIcon_(),this.updateControlText_()},g.updateIcon_=function(){var o=this.player_.volume(),u=3;M&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),o===0||this.player_.muted()?u=0:o<.33?u=1:o<.67&&(u=2);for(var y=0;y<4;y++)Hs(this.el_,"vjs-vol-"+y);vi(this.el_,"vjs-vol-"+u)},g.updateControlText_=function(){var o=this.player_.muted()||this.player_.volume()===0,u=o?"Unmute":"Mute";this.controlText()!==u&&this.controlText(u)},T}(_i);id.prototype.controlText_="Mute",me.registerComponent("MuteToggle",id);var sd=function(v){I.default(T,v);function T(d,o){var u;return o===void 0&&(o={}),typeof o.inline<"u"?o.inline=o.inline:o.inline=!0,(typeof o.volumeControl>"u"||Ve(o.volumeControl))&&(o.volumeControl=o.volumeControl||{},o.volumeControl.vertical=!o.inline),u=v.call(this,d,o)||this,u.handleKeyPressHandler_=function(y){return u.handleKeyPress(y)},u.on(d,["loadstart"],function(y){return u.volumePanelState_(y)}),u.on(u.muteToggle,"keyup",function(y){return u.handleKeyPress(y)}),u.on(u.volumeControl,"keyup",function(y){return u.handleVolumeControlKeyUp(y)}),u.on("keydown",function(y){return u.handleKeyPress(y)}),u.on("mouseover",function(y){return u.handleMouseOver(y)}),u.on("mouseout",function(y){return u.handleMouseOut(y)}),u.on(u.volumeControl,["slideractive"],u.sliderActive_),u.on(u.volumeControl,["sliderinactive"],u.sliderInactive_),u}var g=T.prototype;return g.sliderActive_=function(){this.addClass("vjs-slider-active")},g.sliderInactive_=function(){this.removeClass("vjs-slider-active")},g.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},g.createEl=function(){var o="vjs-volume-panel-horizontal";return this.options_.inline||(o="vjs-volume-panel-vertical"),v.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+o})},g.dispose=function(){this.handleMouseOut(),v.prototype.dispose.call(this)},g.handleVolumeControlKeyUp=function(o){C.default.isEventKey(o,"Esc")&&this.muteToggle.focus()},g.handleMouseOver=function(o){this.addClass("vjs-hover"),jt(_.default,"keyup",this.handleKeyPressHandler_)},g.handleMouseOut=function(o){this.removeClass("vjs-hover"),Pt(_.default,"keyup",this.handleKeyPressHandler_)},g.handleKeyPress=function(o){C.default.isEventKey(o,"Esc")&&this.handleMouseOut()},T}(me);sd.prototype.options_={children:["muteToggle","volumeControl"]},me.registerComponent("VolumePanel",sd);var rd=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,o&&(u.menuButton_=o.menuButton),u.focusedChild_=-1,u.on("keydown",function(y){return u.handleKeyDown(y)}),u.boundHandleBlur_=function(y){return u.handleBlur(y)},u.boundHandleTapClick_=function(y){return u.handleTapClick(y)},u}var g=T.prototype;return g.addEventListenerForItem=function(o){o instanceof me&&(this.on(o,"blur",this.boundHandleBlur_),this.on(o,["tap","click"],this.boundHandleTapClick_))},g.removeEventListenerForItem=function(o){o instanceof me&&(this.off(o,"blur",this.boundHandleBlur_),this.off(o,["tap","click"],this.boundHandleTapClick_))},g.removeChild=function(o){typeof o=="string"&&(o=this.getChild(o)),this.removeEventListenerForItem(o),v.prototype.removeChild.call(this,o)},g.addItem=function(o){var u=this.addChild(o);u&&this.addEventListenerForItem(u)},g.createEl=function(){var o=this.options_.contentElType||"ul";this.contentEl_=Re(o,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var u=v.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return u.appendChild(this.contentEl_),jt(u,"click",function(y){y.preventDefault(),y.stopImmediatePropagation()}),u},g.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,v.prototype.dispose.call(this)},g.handleBlur=function(o){var u=o.relatedTarget||_.default.activeElement;if(!this.children().some(function(w){return w.el()===u})){var y=this.menuButton_;y&&y.buttonPressed_&&u!==y.el().firstChild&&y.unpressButton()}},g.handleTapClick=function(o){if(this.menuButton_){this.menuButton_.unpressButton();var u=this.children();if(!Array.isArray(u))return;var y=u.filter(function(w){return w.el()===o.target})[0];if(!y)return;y.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}},g.handleKeyDown=function(o){C.default.isEventKey(o,"Left")||C.default.isEventKey(o,"Down")?(o.preventDefault(),o.stopPropagation(),this.stepForward()):(C.default.isEventKey(o,"Right")||C.default.isEventKey(o,"Up"))&&(o.preventDefault(),o.stopPropagation(),this.stepBack())},g.stepForward=function(){var o=0;this.focusedChild_!==void 0&&(o=this.focusedChild_+1),this.focus(o)},g.stepBack=function(){var o=0;this.focusedChild_!==void 0&&(o=this.focusedChild_-1),this.focus(o)},g.focus=function(o){o===void 0&&(o=0);var u=this.children().slice(),y=u.length&&u[0].hasClass("vjs-menu-title");y&&u.shift(),u.length>0&&(o<0?o=0:o>=u.length&&(o=u.length-1),this.focusedChild_=o,u[o].el_.focus())},T}(me);me.registerComponent("Menu",rd);var bl=function(v){I.default(T,v);function T(d,o){var u;o===void 0&&(o={}),u=v.call(this,d,o)||this,u.menuButton_=new _i(d,o),u.menuButton_.controlText(u.controlText_),u.menuButton_.el_.setAttribute("aria-haspopup","true");var y=_i.prototype.buildCSSClass();u.menuButton_.el_.className=u.buildCSSClass()+" "+y,u.menuButton_.removeClass("vjs-control"),u.addChild(u.menuButton_),u.update(),u.enabled_=!0;var w=function($){return u.handleClick($)};return u.handleMenuKeyUp_=function(F){return u.handleMenuKeyUp(F)},u.on(u.menuButton_,"tap",w),u.on(u.menuButton_,"click",w),u.on(u.menuButton_,"keydown",function(F){return u.handleKeyDown(F)}),u.on(u.menuButton_,"mouseenter",function(){u.addClass("vjs-hover"),u.menu.show(),jt(_.default,"keyup",u.handleMenuKeyUp_)}),u.on("mouseleave",function(F){return u.handleMouseLeave(F)}),u.on("keydown",function(F){return u.handleSubmenuKeyDown(F)}),u}var g=T.prototype;return g.update=function(){var o=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=o,this.addChild(o),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))},g.createMenu=function(){var o=new rd(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var u=Re("li",{className:"vjs-menu-title",textContent:vt(this.options_.title),tabIndex:-1}),y=new me(this.player_,{el:u});o.addItem(y)}if(this.items=this.createItems(),this.items)for(var w=0;w<this.items.length;w++)o.addItem(this.items[w]);return o},g.createItems=function(){},g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},g.buildWrapperCSSClass=function(){var o="vjs-menu-button";this.options_.inline===!0?o+="-inline":o+="-popup";var u=_i.prototype.buildCSSClass();return"vjs-menu-button "+o+" "+u+" "+v.prototype.buildCSSClass.call(this)},g.buildCSSClass=function(){var o="vjs-menu-button";return this.options_.inline===!0?o+="-inline":o+="-popup","vjs-menu-button "+o+" "+v.prototype.buildCSSClass.call(this)},g.controlText=function(o,u){return u===void 0&&(u=this.menuButton_.el()),this.menuButton_.controlText(o,u)},g.dispose=function(){this.handleMouseLeave(),v.prototype.dispose.call(this)},g.handleClick=function(o){this.buttonPressed_?this.unpressButton():this.pressButton()},g.handleMouseLeave=function(o){this.removeClass("vjs-hover"),Pt(_.default,"keyup",this.handleMenuKeyUp_)},g.focus=function(){this.menuButton_.focus()},g.blur=function(){this.menuButton_.blur()},g.handleKeyDown=function(o){C.default.isEventKey(o,"Esc")||C.default.isEventKey(o,"Tab")?(this.buttonPressed_&&this.unpressButton(),C.default.isEventKey(o,"Tab")||(o.preventDefault(),this.menuButton_.focus())):(C.default.isEventKey(o,"Up")||C.default.isEventKey(o,"Down"))&&(this.buttonPressed_||(o.preventDefault(),this.pressButton()))},g.handleMenuKeyUp=function(o){(C.default.isEventKey(o,"Esc")||C.default.isEventKey(o,"Tab"))&&this.removeClass("vjs-hover")},g.handleSubmenuKeyPress=function(o){this.handleSubmenuKeyDown(o)},g.handleSubmenuKeyDown=function(o){(C.default.isEventKey(o,"Esc")||C.default.isEventKey(o,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),C.default.isEventKey(o,"Tab")||(o.preventDefault(),this.menuButton_.focus()))},g.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),M&&at())return;this.menu.focus()}},g.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},g.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},g.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},T}(me);me.registerComponent("MenuButton",bl);var Sl=function(v){I.default(T,v);function T(g,d){var o,u=d.tracks;if(o=v.call(this,g,d)||this,o.items.length<=1&&o.hide(),!u)return S.default(o);var y=ot(S.default(o),o.update);return u.addEventListener("removetrack",y),u.addEventListener("addtrack",y),u.addEventListener("labelchange",y),o.player_.on("ready",y),o.player_.on("dispose",function(){u.removeEventListener("removetrack",y),u.removeEventListener("addtrack",y),u.removeEventListener("labelchange",y)}),o}return T}(bl);me.registerComponent("TrackButton",Sl);var oT=["Tab","Esc","Up","Down","Right","Left"],pn=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.selectable=o.selectable,u.isSelected_=o.selected||!1,u.multiSelectable=o.multiSelectable,u.selected(u.isSelected_),u.selectable?u.multiSelectable?u.el_.setAttribute("role","menuitemcheckbox"):u.el_.setAttribute("role","menuitemradio"):u.el_.setAttribute("role","menuitem"),u}var g=T.prototype;return g.createEl=function(o,u,y){this.nonIconControl=!0;var w=v.prototype.createEl.call(this,"li",De({className:"vjs-menu-item",tabIndex:-1},u),y);return w.replaceChild(Re("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),w.querySelector(".vjs-icon-placeholder")),w},g.handleKeyDown=function(o){oT.some(function(u){return C.default.isEventKey(o,u)})||v.prototype.handleKeyDown.call(this,o)},g.handleClick=function(o){this.selected(!0)},g.selected=function(o){this.selectable&&(o?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},T}(va);me.registerComponent("MenuItem",pn);var gn=function(v){I.default(T,v);function T(d,o){var u,y=o.track,w=d.textTracks();o.label=y.label||y.language||"Unknown",o.selected=y.mode==="showing",u=v.call(this,d,o)||this,u.track=y,u.kinds=(o.kinds||[o.kind||u.track.kind]).filter(Boolean);var F=function(){for(var V=arguments.length,ge=new Array(V),Ae=0;Ae<V;Ae++)ge[Ae]=arguments[Ae];u.handleTracksChange.apply(S.default(u),ge)},$=function(){for(var V=arguments.length,ge=new Array(V),Ae=0;Ae<V;Ae++)ge[Ae]=arguments[Ae];u.handleSelectedLanguageChange.apply(S.default(u),ge)};if(d.on(["loadstart","texttrackchange"],F),w.addEventListener("change",F),w.addEventListener("selectedlanguagechange",$),u.on("dispose",function(){d.off(["loadstart","texttrackchange"],F),w.removeEventListener("change",F),w.removeEventListener("selectedlanguagechange",$)}),w.onchange===void 0){var K;u.on(["tap","click"],function(){if(typeof m.default.Event!="object")try{K=new m.default.Event("change")}catch{}K||(K=_.default.createEvent("Event"),K.initEvent("change",!0,!0)),w.dispatchEvent(K)})}return u.handleTracksChange(),u}var g=T.prototype;return g.handleClick=function(o){var u=this.track,y=this.player_.textTracks();if(v.prototype.handleClick.call(this,o),!!y)for(var w=0;w<y.length;w++){var F=y[w];this.kinds.indexOf(F.kind)!==-1&&(F===u?F.mode!=="showing"&&(F.mode="showing"):F.mode!=="disabled"&&(F.mode="disabled"))}},g.handleTracksChange=function(o){var u=this.track.mode==="showing";u!==this.isSelected_&&this.selected(u)},g.handleSelectedLanguageChange=function(o){if(this.track.mode==="showing"){var u=this.player_.cache_.selectedLanguage;if(u&&u.enabled&&u.language===this.track.language&&u.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},g.dispose=function(){this.track=null,v.prototype.dispose.call(this)},T}(pn);me.registerComponent("TextTrackMenuItem",gn);var nd=function(v){I.default(T,v);function T(d,o){return o.track={player:d,kind:o.kind,kinds:o.kinds,default:!1,mode:"disabled"},o.kinds||(o.kinds=[o.kind]),o.label?o.track.label=o.label:o.track.label=o.kinds.join(" and ")+" off",o.selectable=!0,o.multiSelectable=!1,v.call(this,d,o)||this}var g=T.prototype;return g.handleTracksChange=function(o){for(var u=this.player().textTracks(),y=!0,w=0,F=u.length;w<F;w++){var $=u[w];if(this.options_.kinds.indexOf($.kind)>-1&&$.mode==="showing"){y=!1;break}}y!==this.isSelected_&&this.selected(y)},g.handleSelectedLanguageChange=function(o){for(var u=this.player().textTracks(),y=!0,w=0,F=u.length;w<F;w++){var $=u[w];if(["captions","descriptions","subtitles"].indexOf($.kind)>-1&&$.mode==="showing"){y=!1;break}}y&&(this.player_.cache_.selectedLanguage={enabled:!1})},T}(gn);me.registerComponent("OffTextTrackMenuItem",nd);var br=function(v){I.default(T,v);function T(d,o){return o===void 0&&(o={}),o.tracks=d.textTracks(),v.call(this,d,o)||this}var g=T.prototype;return g.createItems=function(o,u){o===void 0&&(o=[]),u===void 0&&(u=gn);var y;this.label_&&(y=this.label_+" off"),o.push(new nd(this.player_,{kinds:this.kinds_,kind:this.kind_,label:y})),this.hideThreshold_+=1;var w=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var F=0;F<w.length;F++){var $=w[F];if(this.kinds_.indexOf($.kind)>-1){var K=new u(this.player_,{track:$,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});K.addClass("vjs-"+$.kind+"-menu-item"),o.push(K)}}return o},T}(Sl);me.registerComponent("TextTrackButton",br);var ad=function(v){I.default(T,v);function T(d,o){var u,y=o.track,w=o.cue,F=d.currentTime();return o.selectable=!0,o.multiSelectable=!1,o.label=w.text,o.selected=w.startTime<=F&&F<w.endTime,u=v.call(this,d,o)||this,u.track=y,u.cue=w,u}var g=T.prototype;return g.handleClick=function(o){v.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime)},T}(pn);me.registerComponent("ChaptersTrackMenuItem",ad);var Cl=function(v){I.default(T,v);function T(d,o,u){var y;return y=v.call(this,d,o,u)||this,y.selectCurrentItem_=function(){y.items.forEach(function(w){w.selected(y.track_.activeCues[0]===w.cue)})},y}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-chapters-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-chapters-button "+v.prototype.buildWrapperCSSClass.call(this)},g.update=function(o){if(!(o&&o.track&&o.track.kind!=="chapters")){var u=this.findChaptersTrack();u!==this.track_?(this.setTrack(u),v.prototype.update.call(this)):(!this.items||u&&u.cues&&u.cues.length!==this.items.length)&&v.prototype.update.call(this)}},g.setTrack=function(o){if(this.track_!==o){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var u=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);u&&u.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=o,this.track_){this.track_.mode="hidden";var y=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);y&&y.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}},g.findChaptersTrack=function(){for(var o=this.player_.textTracks()||[],u=o.length-1;u>=0;u--){var y=o[u];if(y.kind===this.kind_)return y}},g.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(vt(this.kind_))},g.createMenu=function(){return this.options_.title=this.getMenuCaption(),v.prototype.createMenu.call(this)},g.createItems=function(){var o=[];if(!this.track_)return o;var u=this.track_.cues;if(!u)return o;for(var y=0,w=u.length;y<w;y++){var F=u[y],$=new ad(this.player_,{track:this.track_,cue:F});o.push($)}return o},T}(br);Cl.prototype.kind_="chapters",Cl.prototype.controlText_="Chapters",me.registerComponent("ChaptersButton",Cl);var wl=function(v){I.default(T,v);function T(d,o,u){var y;y=v.call(this,d,o,u)||this;var w=d.textTracks(),F=ot(S.default(y),y.handleTracksChange);return w.addEventListener("change",F),y.on("dispose",function(){w.removeEventListener("change",F)}),y}var g=T.prototype;return g.handleTracksChange=function(o){for(var u=this.player().textTracks(),y=!1,w=0,F=u.length;w<F;w++){var $=u[w];if($.kind!==this.kind_&&$.mode==="showing"){y=!0;break}}y?this.disable():this.enable()},g.buildCSSClass=function(){return"vjs-descriptions-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+v.prototype.buildWrapperCSSClass.call(this)},T}(br);wl.prototype.kind_="descriptions",wl.prototype.controlText_="Descriptions",me.registerComponent("DescriptionsButton",wl);var Al=function(v){I.default(T,v);function T(d,o,u){return v.call(this,d,o,u)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-subtitles-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+v.prototype.buildWrapperCSSClass.call(this)},T}(br);Al.prototype.kind_="subtitles",Al.prototype.controlText_="Subtitles",me.registerComponent("SubtitlesButton",Al);var Il=function(v){I.default(T,v);function T(d,o){var u;return o.track={player:d,kind:o.kind,label:o.kind+" settings",selectable:!1,default:!1,mode:"disabled"},o.selectable=!1,o.name="CaptionSettingsMenuItem",u=v.call(this,d,o)||this,u.addClass("vjs-texttrack-settings"),u.controlText(", opens "+o.kind+" settings dialog"),u}var g=T.prototype;return g.handleClick=function(o){this.player().getChild("textTrackSettings").open()},T}(gn);me.registerComponent("CaptionSettingsMenuItem",Il);var Ll=function(v){I.default(T,v);function T(d,o,u){return v.call(this,d,o,u)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-captions-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-captions-button "+v.prototype.buildWrapperCSSClass.call(this)},g.createItems=function(){var o=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(o.push(new Il(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),v.prototype.createItems.call(this,o)},T}(br);Ll.prototype.kind_="captions",Ll.prototype.controlText_="Captions",me.registerComponent("CaptionsButton",Ll);var od=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(o,u,y){var w=v.prototype.createEl.call(this,o,u,y),F=w.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(F.appendChild(Re("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),F.appendChild(Re("span",{className:"vjs-control-text",textContent:" "+this.localize("Captions")}))),w},T}(gn);me.registerComponent("SubsCapsMenuItem",od);var kl=function(v){I.default(T,v);function T(d,o){var u;return o===void 0&&(o={}),u=v.call(this,d,o)||this,u.label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(u.player_.language_)>-1&&(u.label_="captions"),u.menuButton_.controlText(vt(u.label_)),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-subs-caps-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+v.prototype.buildWrapperCSSClass.call(this)},g.createItems=function(){var o=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(o.push(new Il(this.player_,{kind:this.label_})),this.hideThreshold_+=1),o=v.prototype.createItems.call(this,o,od),o},T}(br);kl.prototype.kinds_=["captions","subtitles"],kl.prototype.controlText_="Subtitles",me.registerComponent("SubsCapsButton",kl);var ld=function(v){I.default(T,v);function T(d,o){var u,y=o.track,w=d.audioTracks();o.label=y.label||y.language||"Unknown",o.selected=y.enabled,u=v.call(this,d,o)||this,u.track=y,u.addClass("vjs-"+y.kind+"-menu-item");var F=function(){for(var K=arguments.length,z=new Array(K),V=0;V<K;V++)z[V]=arguments[V];u.handleTracksChange.apply(S.default(u),z)};return w.addEventListener("change",F),u.on("dispose",function(){w.removeEventListener("change",F)}),u}var g=T.prototype;return g.createEl=function(o,u,y){var w=v.prototype.createEl.call(this,o,u,y),F=w.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="main-desc"&&(F.appendChild(Re("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),F.appendChild(Re("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),w},g.handleClick=function(o){if(v.prototype.handleClick.call(this,o),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks)for(var u=this.player_.audioTracks(),y=0;y<u.length;y++){var w=u[y];w!==this.track&&(w.enabled=w===this.track)}},g.handleTracksChange=function(o){this.selected(this.track.enabled)},T}(pn);me.registerComponent("AudioTrackMenuItem",ld);var ud=function(v){I.default(T,v);function T(d,o){return o===void 0&&(o={}),o.tracks=d.audioTracks(),v.call(this,d,o)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-audio-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-audio-button "+v.prototype.buildWrapperCSSClass.call(this)},g.createItems=function(o){o===void 0&&(o=[]),this.hideThreshold_=1;for(var u=this.player_.audioTracks(),y=0;y<u.length;y++){var w=u[y];o.push(new ld(this.player_,{track:w,selectable:!0,multiSelectable:!1}))}return o},T}(Sl);ud.prototype.controlText_="Audio Track",me.registerComponent("AudioTrackButton",ud);var Rl=function(v){I.default(T,v);function T(d,o){var u,y=o.rate,w=parseFloat(y,10);return o.label=y,o.selected=w===d.playbackRate(),o.selectable=!0,o.multiSelectable=!1,u=v.call(this,d,o)||this,u.label=y,u.rate=w,u.on(d,"ratechange",function(F){return u.update(F)}),u}var g=T.prototype;return g.handleClick=function(o){v.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},g.update=function(o){this.selected(this.player().playbackRate()===this.rate)},T}(pn);Rl.prototype.contentElType="button",me.registerComponent("PlaybackRateMenuItem",Rl);var hd=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.menuButton_.el_.setAttribute("aria-describedby",u.labelElId_),u.updateVisibility(),u.updateLabel(),u.on(d,"loadstart",function(y){return u.updateVisibility(y)}),u.on(d,"ratechange",function(y){return u.updateLabel(y)}),u.on(d,"playbackrateschange",function(y){return u.handlePlaybackRateschange(y)}),u}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=Re("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),o.appendChild(this.labelEl_),o},g.dispose=function(){this.labelEl_=null,v.prototype.dispose.call(this)},g.buildCSSClass=function(){return"vjs-playback-rate "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-playback-rate "+v.prototype.buildWrapperCSSClass.call(this)},g.createItems=function(){for(var o=this.playbackRates(),u=[],y=o.length-1;y>=0;y--)u.push(new Rl(this.player(),{rate:o[y]+"x"}));return u},g.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},g.handleClick=function(o){var u=this.player().playbackRate(),y=this.playbackRates(),w=y.indexOf(u),F=(w+1)%y.length;this.player().playbackRate(y[F])},g.handlePlaybackRateschange=function(o){this.update()},g.playbackRates=function(){var o=this.player();return o.playbackRates&&o.playbackRates()||[]},g.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},g.updateVisibility=function(o){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},g.updateLabel=function(o){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")},T}(bl);hd.prototype.controlText_="Playback Rate",me.registerComponent("PlaybackRateMenuButton",hd);var cd=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-spacer "+v.prototype.buildCSSClass.call(this)},g.createEl=function(o,u,y){return o===void 0&&(o="div"),u===void 0&&(u={}),y===void 0&&(y={}),u.className||(u.className=this.buildCSSClass()),v.prototype.createEl.call(this,o,u,y)},T}(me);me.registerComponent("Spacer",cd);var lT=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-custom-control-spacer "+v.prototype.buildCSSClass.call(this)},g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),textContent:" "})},T}(cd);me.registerComponent("CustomControlSpacer",lT);var Ea=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},T}(me);Ea.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in _.default&&Ea.prototype.options_.children.splice(Ea.prototype.options_.children.length-1,0,"pictureInPictureToggle"),me.registerComponent("ControlBar",Ea);var dd=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,"error",function(y){return u.open(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-error-display "+v.prototype.buildCSSClass.call(this)},g.content=function(){var o=this.player().error();return o?this.localize(o.message):""},T}(mr);dd.prototype.options_=E.default({},mr.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),me.registerComponent("ErrorDisplay",dd);var Pl="vjs-text-track-settings",fd=["#000","Black"],pd=["#00F","Blue"],gd=["#0FF","Cyan"],md=["#0F0","Green"],vd=["#F0F","Magenta"],yd=["#F00","Red"],Td=["#FFF","White"],_d=["#FF0","Yellow"],Dl=["1","Opaque"],xl=["0.5","Semi-Transparent"],Ed=["0","Transparent"],zs={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[fd,Td,yd,md,pd,_d,vd,gd]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[Dl,xl,Ed]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Td,fd,yd,md,pd,_d,vd,gd]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(T){return T==="1.00"?null:Number(T)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[Dl,xl]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[Ed,xl,Dl]}};zs.windowColor.options=zs.backgroundColor.options;function bd(v,T){if(T&&(v=T(v)),v&&v!=="none")return v}function uT(v,T){var g=v.options[v.options.selectedIndex].value;return bd(g,T)}function hT(v,T,g){if(T){for(var d=0;d<v.options.length;d++)if(bd(v.options[d].value,g)===T){v.selectedIndex=d;break}}}var cT=function(v){I.default(T,v);function T(d,o){var u;return o.temporary=!1,u=v.call(this,d,o)||this,u.updateDisplay=u.updateDisplay.bind(S.default(u)),u.fill(),u.hasBeenOpened_=u.hasBeenFilled_=!0,u.endDialog=Re("p",{className:"vjs-control-text",textContent:u.localize("End of dialog window.")}),u.el().appendChild(u.endDialog),u.setDefaults(),o.persistTextTrackSettings===void 0&&(u.options_.persistTextTrackSettings=u.options_.playerOptions.persistTextTrackSettings),u.on(u.$(".vjs-done-button"),"click",function(){u.saveSettings(),u.close()}),u.on(u.$(".vjs-default-button"),"click",function(){u.setDefaults(),u.updateDisplay()}),Pe(zs,function(y){u.on(u.$(y.selector),"change",u.updateDisplay)}),u.options_.persistTextTrackSettings&&u.restoreSettings(),u}var g=T.prototype;return g.dispose=function(){this.endDialog=null,v.prototype.dispose.call(this)},g.createElSelect_=function(o,u,y){var w=this;u===void 0&&(u=""),y===void 0&&(y="label");var F=zs[o],$=F.id.replace("%s",this.id_),K=[u,$].join(" ").trim();return["<"+y+' id="'+$+'" class="'+(y==="label"?"vjs-label":"")+'">',this.localize(F.label),"</"+y+">",'<select aria-labelledby="'+K+'">'].concat(F.options.map(function(z){var V=$+"-"+z[1].replace(/\W+/g,"");return['<option id="'+V+'" value="'+z[0]+'" ','aria-labelledby="'+K+" "+V+'">',w.localize(z[1]),"</option>"].join("")})).concat("</select>").join("")},g.createElFgColor_=function(){var o="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+o+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",o),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",o),"</span>","</fieldset>"].join("")},g.createElBgColor_=function(){var o="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+o+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",o),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",o),"</span>","</fieldset>"].join("")},g.createElWinColor_=function(){var o="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+o+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",o),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",o),"</span>","</fieldset>"].join("")},g.createElColors_=function(){return Re("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},g.createElFont_=function(){return Re("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},g.createElControls_=function(){var o=this.localize("restore all settings to the default values");return Re("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+o+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+o+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},g.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},g.label=function(){return this.localize("Caption Settings Dialog")},g.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},g.buildCSSClass=function(){return v.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},g.getValues=function(){var o=this;return Me(zs,function(u,y,w){var F=uT(o.$(y.selector),y.parser);return F!==void 0&&(u[w]=F),u},{})},g.setValues=function(o){var u=this;Pe(zs,function(y,w){hT(u.$(y.selector),o[w],y.parser)})},g.setDefaults=function(){var o=this;Pe(zs,function(u){var y=u.hasOwnProperty("default")?u.default:0;o.$(u.selector).selectedIndex=y})},g.restoreSettings=function(){var o;try{o=JSON.parse(m.default.localStorage.getItem(Pl))}catch(u){Q.warn(u)}o&&this.setValues(o)},g.saveSettings=function(){if(this.options_.persistTextTrackSettings){var o=this.getValues();try{Object.keys(o).length?m.default.localStorage.setItem(Pl,JSON.stringify(o)):m.default.localStorage.removeItem(Pl)}catch(u){Q.warn(u)}}},g.updateDisplay=function(){var o=this.player_.getChild("textTrackDisplay");o&&o.updateDisplay()},g.conditionalBlur_=function(){this.previouslyActiveEl_=null;var o=this.player_.controlBar,u=o&&o.subsCapsButton,y=o&&o.captionsButton;u?u.focus():y&&y.focus()},T}(mr);me.registerComponent("TextTrackSettings",cT);var dT=function(v){I.default(T,v);function T(d,o){var u,y=o.ResizeObserver||m.default.ResizeObserver;o.ResizeObserver===null&&(y=!1);var w=dt({createEl:!y,reportTouchActivity:!1},o);return u=v.call(this,d,w)||this,u.ResizeObserver=o.ResizeObserver||m.default.ResizeObserver,u.loadListener_=null,u.resizeObserver_=null,u.debouncedHandler_=Ee(function(){u.resizeHandler()},100,!1,S.default(u)),y?(u.resizeObserver_=new u.ResizeObserver(u.debouncedHandler_),u.resizeObserver_.observe(d.el())):(u.loadListener_=function(){if(!(!u.el_||!u.el_.contentWindow)){var F=u.debouncedHandler_,$=u.unloadListener_=function(){Pt(this,"resize",F),Pt(this,"unload",$),$=null};jt(u.el_.contentWindow,"unload",$),jt(u.el_.contentWindow,"resize",F)}},u.one("load",u.loadListener_)),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})},g.resizeHandler=function(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")},g.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,v.prototype.dispose.call(this)},T}(me);me.registerComponent("ResizeManager",dT);var fT={trackingThreshold:20,liveTolerance:15},pT=function(v){I.default(T,v);function T(d,o){var u,y=dt(fT,o,{createEl:!1});return u=v.call(this,d,y)||this,u.handleVisibilityChange_=function(w){return u.handleVisibilityChange(w)},u.trackLiveHandler_=function(){return u.trackLive_()},u.handlePlay_=function(w){return u.handlePlay(w)},u.handleFirstTimeupdate_=function(w){return u.handleFirstTimeupdate(w)},u.handleSeeked_=function(w){return u.handleSeeked(w)},u.seekToLiveEdge_=function(w){return u.seekToLiveEdge(w)},u.reset_(),u.on(u.player_,"durationchange",function(w){return u.handleDurationchange(w)}),u.on(u.player_,"canplay",function(){return u.toggleTracking()}),Ot&&"hidden"in _.default&&"visibilityState"in _.default&&u.on(_.default,"visibilitychange",u.handleVisibilityChange_),u}var g=T.prototype;return g.handleVisibilityChange=function(){this.player_.duration()===1/0&&(_.default.hidden?this.stopTracking():this.startTracking())},g.trackLive_=function(){var o=this.player_.seekable();if(!(!o||!o.length)){var u=Number(m.default.performance.now().toFixed(4)),y=this.lastTime_===-1?0:(u-this.lastTime_)/1e3;this.lastTime_=u,this.pastSeekEnd_=this.pastSeekEnd()+y;var w=this.liveCurrentTime(),F=this.player_.currentTime(),$=this.player_.paused()||this.seekedBehindLive_||Math.abs(w-F)>this.options_.liveTolerance;(!this.timeupdateSeen_||w===1/0)&&($=!1),$!==this.behindLiveEdge_&&(this.behindLiveEdge_=$,this.trigger("liveedgechange"))}},g.handleDurationchange=function(){this.toggleTracking()},g.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},g.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,Wt),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},g.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},g.handleSeeked=function(){var o=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&o>2,this.nextSeekedFromUser_=!1,this.trackLive_()},g.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},g.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},g.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},g.stopTracking=function(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))},g.seekableEnd=function(){for(var o=this.player_.seekable(),u=[],y=o?o.length:0;y--;)u.push(o.end(y));return u.length?u.sort()[u.length-1]:1/0},g.seekableStart=function(){for(var o=this.player_.seekable(),u=[],y=o?o.length:0;y--;)u.push(o.start(y));return u.length?u.sort()[0]:0},g.liveWindow=function(){var o=this.liveCurrentTime();return o===1/0?0:o-this.seekableStart()},g.isLive=function(){return this.isTracking()},g.atLiveEdge=function(){return!this.behindLiveEdge()},g.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},g.pastSeekEnd=function(){var o=this.seekableEnd();return this.lastSeekEnd_!==-1&&o!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=o,this.pastSeekEnd_},g.behindLiveEdge=function(){return this.behindLiveEdge_},g.isTracking=function(){return typeof this.trackingInterval_=="number"},g.seekToLiveEdge=function(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},g.dispose=function(){this.off(_.default,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),v.prototype.dispose.call(this)},T}(me);me.registerComponent("LiveTracker",pT);var Ol=function(T){var g=T.el();if(g.hasAttribute("src"))return T.triggerSourceset(g.src),!0;var d=T.$$("source"),o=[],u="";if(!d.length)return!1;for(var y=0;y<d.length;y++){var w=d[y].src;w&&o.indexOf(w)===-1&&o.push(w)}return o.length?(o.length===1&&(u=o[0]),T.triggerSourceset(u),!0):!1},gT=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(T){var g=_.default.createElement(this.nodeName.toLowerCase());g.innerHTML=T;for(var d=_.default.createDocumentFragment();g.childNodes.length;)d.appendChild(g.childNodes[0]);return this.innerText="",m.default.Element.prototype.appendChild.call(this,d),this.innerHTML}}),Sd=function(T,g){for(var d={},o=0;o<T.length&&(d=Object.getOwnPropertyDescriptor(T[o],g),!(d&&d.set&&d.get));o++);return d.enumerable=!0,d.configurable=!0,d},mT=function(T){return Sd([T.el(),m.default.HTMLMediaElement.prototype,m.default.Element.prototype,gT],"innerHTML")},Cd=function(T){var g=T.el();if(!g.resetSourceWatch_){var d={},o=mT(T),u=function(w){return function(){for(var F=arguments.length,$=new Array(F),K=0;K<F;K++)$[K]=arguments[K];var z=w.apply(g,$);return Ol(T),z}};["append","appendChild","insertAdjacentHTML"].forEach(function(y){g[y]&&(d[y]=g[y],g[y]=u(d[y]))}),Object.defineProperty(g,"innerHTML",dt(o,{set:u(o.set)})),g.resetSourceWatch_=function(){g.resetSourceWatch_=null,Object.keys(d).forEach(function(y){g[y]=d[y]}),Object.defineProperty(g,"innerHTML",o)},T.one("sourceset",g.resetSourceWatch_)}},vT=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?Oc(m.default.Element.prototype.getAttribute.call(this,"src")):""},set:function(T){return m.default.Element.prototype.setAttribute.call(this,"src",T),T}}),yT=function(T){return Sd([T.el(),m.default.HTMLMediaElement.prototype,vT],"src")},TT=function(T){if(T.featuresSourceset){var g=T.el();if(!g.resetSourceset_){var d=yT(T),o=g.setAttribute,u=g.load;Object.defineProperty(g,"src",dt(d,{set:function(w){var F=d.set.call(g,w);return T.triggerSourceset(g.src),F}})),g.setAttribute=function(y,w){var F=o.call(g,y,w);return/src/i.test(y)&&T.triggerSourceset(g.src),F},g.load=function(){var y=u.call(g);return Ol(T)||(T.triggerSourceset(""),Cd(T)),y},g.currentSrc?T.triggerSourceset(g.currentSrc):Ol(T)||Cd(T),g.resetSourceset_=function(){g.resetSourceset_=null,g.load=u,g.setAttribute=o,Object.defineProperty(g,"src",d),g.resetSourceWatch_&&g.resetSourceWatch_()}}}},Ml=function(T,g,d,o){o===void 0&&(o=!0);var u=function(F){return Object.defineProperty(T,g,{value:F,enumerable:!0,writable:!0})},y={configurable:!0,enumerable:!0,get:function(){var F=d();return u(F),F}};return o&&(y.set=u),Object.defineProperty(T,g,y)},Ce=function(v){I.default(T,v);function T(d,o){var u;u=v.call(this,d,o)||this;var y=d.source,w=!1;if(u.featuresVideoFrameCallback=u.featuresVideoFrameCallback&&u.el_.tagName==="VIDEO",y&&(u.el_.currentSrc!==y.src||d.tag&&d.tag.initNetworkState_===3)?u.setSource(y):u.handleLateInit_(u.el_),d.enableSourceset&&u.setupSourcesetHandling_(),u.isScrubbing_=!1,u.el_.hasChildNodes()){for(var F=u.el_.childNodes,$=F.length,K=[];$--;){var z=F[$],V=z.nodeName.toLowerCase();V==="track"&&(u.featuresNativeTextTracks?(u.remoteTextTrackEls().addTrackElement_(z),u.remoteTextTracks().addTrack(z.track),u.textTracks().addTrack(z.track),!w&&!u.el_.hasAttribute("crossorigin")&&pa(z.src)&&(w=!0)):K.push(z))}for(var ge=0;ge<K.length;ge++)u.el_.removeChild(K[ge])}return u.proxyNativeTracks_(),u.featuresNativeTextTracks&&w&&Q.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),u.restoreMetadataTracksInIOSNativePlayer_(),(qt||It||Ht)&&d.nativeControlsForTouch===!0&&u.setControls(!0),u.proxyWebkitFullscreen_(),u.triggerReady(),u}var g=T.prototype;return g.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),T.disposeMediaElement(this.el_),this.options_=null,v.prototype.dispose.call(this)},g.setupSourcesetHandling_=function(){TT(this)},g.restoreMetadataTracksInIOSNativePlayer_=function(){var o=this.textTracks(),u,y=function(){u=[];for(var $=0;$<o.length;$++){var K=o[$];K.kind==="metadata"&&u.push({track:K,storedMode:K.mode})}};y(),o.addEventListener("change",y),this.on("dispose",function(){return o.removeEventListener("change",y)});var w=function F(){for(var $=0;$<u.length;$++){var K=u[$];K.track.mode==="disabled"&&K.track.mode!==K.storedMode&&(K.track.mode=K.storedMode)}o.removeEventListener("change",F)};this.on("webkitbeginfullscreen",function(){o.removeEventListener("change",y),o.removeEventListener("change",w),o.addEventListener("change",w)}),this.on("webkitendfullscreen",function(){o.removeEventListener("change",y),o.addEventListener("change",y),o.removeEventListener("change",w)})},g.overrideNative_=function(o,u){var y=this;if(u===this["featuresNative"+o+"Tracks"]){var w=o.toLowerCase();this[w+"TracksListeners_"]&&Object.keys(this[w+"TracksListeners_"]).forEach(function(F){var $=y.el()[w+"Tracks"];$.removeEventListener(F,y[w+"TracksListeners_"][F])}),this["featuresNative"+o+"Tracks"]=!u,this[w+"TracksListeners_"]=null,this.proxyNativeTracksForType_(w)}},g.overrideNativeAudioTracks=function(o){this.overrideNative_("Audio",o)},g.overrideNativeVideoTracks=function(o){this.overrideNative_("Video",o)},g.proxyNativeTracksForType_=function(o){var u=this,y=ai[o],w=this.el()[y.getterName],F=this[y.getterName]();if(!(!this["featuresNative"+y.capitalName+"Tracks"]||!w||!w.addEventListener)){var $={change:function(V){var ge={type:"change",target:F,currentTarget:F,srcElement:F};F.trigger(ge),o==="text"&&u[Tr.remoteText.getterName]().trigger(ge)},addtrack:function(V){F.addTrack(V.track)},removetrack:function(V){F.removeTrack(V.track)}},K=function(){for(var V=[],ge=0;ge<F.length;ge++){for(var Ae=!1,We=0;We<w.length;We++)if(w[We]===F[ge]){Ae=!0;break}Ae||V.push(F[ge])}for(;V.length;)F.removeTrack(V.shift())};this[y.getterName+"Listeners_"]=$,Object.keys($).forEach(function(z){var V=$[z];w.addEventListener(z,V),u.on("dispose",function(ge){return w.removeEventListener(z,V)})}),this.on("loadstart",K),this.on("dispose",function(z){return u.off("loadstart",K)})}},g.proxyNativeTracks_=function(){var o=this;ai.names.forEach(function(u){o.proxyNativeTracksForType_(u)})},g.createEl=function(){var o=this.options_.tag;if(!o||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(o){var u=o.cloneNode(!0);o.parentNode&&o.parentNode.insertBefore(u,o),T.disposeMediaElement(o),o=u}else{o=_.default.createElement("video");var y=this.options_.tag&&ri(this.options_.tag),w=dt({},y);(!qt||this.options_.nativeControlsForTouch!==!0)&&delete w.controls,Qn(o,De(w,{id:this.options_.techId,class:"vjs-tech"}))}o.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&ps(o,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(o.disablePictureInPicture=this.options_.disablePictureInPicture);for(var F=["loop","muted","playsinline","autoplay"],$=0;$<F.length;$++){var K=F[$],z=this.options_[K];typeof z<"u"&&(z?ps(o,K,K):hr(o,K),o[K]=z)}return o},g.handleLateInit_=function(o){if(!(o.networkState===0||o.networkState===3)){if(o.readyState===0){var u=!1,y=function(){u=!0};this.on("loadstart",y);var w=function(){u||this.trigger("loadstart")};this.on("loadedmetadata",w),this.ready(function(){this.off("loadstart",y),this.off("loadedmetadata",w),u||this.trigger("loadstart")});return}var F=["loadstart"];F.push("loadedmetadata"),o.readyState>=2&&F.push("loadeddata"),o.readyState>=3&&F.push("canplay"),o.readyState>=4&&F.push("canplaythrough"),this.ready(function(){F.forEach(function($){this.trigger($)},this)})}},g.setScrubbing=function(o){this.isScrubbing_=o},g.scrubbing=function(){return this.isScrubbing_},g.setCurrentTime=function(o){try{this.isScrubbing_&&this.el_.fastSeek&&b?this.el_.fastSeek(o):this.el_.currentTime=o}catch(u){Q(u,"Video is not ready. (Video.js)")}},g.duration=function(){var o=this;if(this.el_.duration===1/0&&Ke&&mt&&this.el_.currentTime===0){var u=function y(){o.el_.currentTime>0&&(o.el_.duration===1/0&&o.trigger("durationchange"),o.off("timeupdate",y))};return this.on("timeupdate",u),NaN}return this.el_.duration||NaN},g.width=function(){return this.el_.offsetWidth},g.height=function(){return this.el_.offsetHeight},g.proxyWebkitFullscreen_=function(){var o=this;if("webkitDisplayingFullscreen"in this.el_){var u=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},y=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",u),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",y),this.on("dispose",function(){o.off("webkitbeginfullscreen",y),o.off("webkitendfullscreen",u)})}},g.supportsFullScreen=function(){if(typeof this.el_.webkitEnterFullScreen=="function"){var o=m.default.navigator&&m.default.navigator.userAgent||"";if(/Android/.test(o)||!/Chrome|Mac OS X 10.5/.test(o))return!0}return!1},g.enterFullScreen=function(){var o=this.el_;if(o.paused&&o.networkState<=o.HAVE_METADATA)Ri(this.el_.play()),this.setTimeout(function(){o.pause();try{o.webkitEnterFullScreen()}catch(u){this.trigger("fullscreenerror",u)}},0);else try{o.webkitEnterFullScreen()}catch(u){this.trigger("fullscreenerror",u)}},g.exitFullScreen=function(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()},g.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},g.requestVideoFrameCallback=function(o){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(o):v.prototype.requestVideoFrameCallback.call(this,o)},g.cancelVideoFrameCallback=function(o){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(o):v.prototype.cancelVideoFrameCallback.call(this,o)},g.src=function(o){if(o===void 0)return this.el_.src;this.setSrc(o)},g.reset=function(){T.resetMediaElement(this.el_)},g.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},g.setControls=function(o){this.el_.controls=!!o},g.addTextTrack=function(o,u,y){return this.featuresNativeTextTracks?this.el_.addTextTrack(o,u,y):v.prototype.addTextTrack.call(this,o,u,y)},g.createRemoteTextTrack=function(o){if(!this.featuresNativeTextTracks)return v.prototype.createRemoteTextTrack.call(this,o);var u=_.default.createElement("track");return o.kind&&(u.kind=o.kind),o.label&&(u.label=o.label),(o.language||o.srclang)&&(u.srclang=o.language||o.srclang),o.default&&(u.default=o.default),o.id&&(u.id=o.id),o.src&&(u.src=o.src),u},g.addRemoteTextTrack=function(o,u){var y=v.prototype.addRemoteTextTrack.call(this,o,u);return this.featuresNativeTextTracks&&this.el().appendChild(y),y},g.removeRemoteTextTrack=function(o){if(v.prototype.removeRemoteTextTrack.call(this,o),this.featuresNativeTextTracks)for(var u=this.$$("track"),y=u.length;y--;)(o===u[y]||o===u[y].track)&&this.el().removeChild(u[y])},g.getVideoPlaybackQuality=function(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();var o={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(o.droppedVideoFrames=this.el().webkitDroppedFrameCount,o.totalVideoFrames=this.el().webkitDecodedFrameCount),m.default.performance&&typeof m.default.performance.now=="function"?o.creationTime=m.default.performance.now():m.default.performance&&m.default.performance.timing&&typeof m.default.performance.timing.navigationStart=="number"&&(o.creationTime=m.default.Date.now()-m.default.performance.timing.navigationStart),o},T}(lt);Ml(Ce,"TEST_VID",function(){if(ue()){var v=_.default.createElement("video"),T=_.default.createElement("track");return T.kind="captions",T.srclang="en",T.label="English",v.appendChild(T),v}}),Ce.isSupported=function(){try{Ce.TEST_VID.volume=.5}catch{return!1}return!!(Ce.TEST_VID&&Ce.TEST_VID.canPlayType)},Ce.canPlayType=function(v){return Ce.TEST_VID.canPlayType(v)},Ce.canPlaySource=function(v,T){return Ce.canPlayType(v.type)},Ce.canControlVolume=function(){try{var v=Ce.TEST_VID.volume;Ce.TEST_VID.volume=v/2+.1;var T=v!==Ce.TEST_VID.volume;return T&&M?(m.default.setTimeout(function(){Ce&&Ce.prototype&&(Ce.prototype.featuresVolumeControl=v!==Ce.TEST_VID.volume)}),!1):T}catch{return!1}},Ce.canMuteVolume=function(){try{var v=Ce.TEST_VID.muted;return Ce.TEST_VID.muted=!v,Ce.TEST_VID.muted?ps(Ce.TEST_VID,"muted","muted"):hr(Ce.TEST_VID,"muted","muted"),v!==Ce.TEST_VID.muted}catch{return!1}},Ce.canControlPlaybackRate=function(){if(Ke&&mt&&mi<58)return!1;try{var v=Ce.TEST_VID.playbackRate;return Ce.TEST_VID.playbackRate=v/2+.1,v!==Ce.TEST_VID.playbackRate}catch{return!1}},Ce.canOverrideAttributes=function(){try{var v=function(){};Object.defineProperty(_.default.createElement("video"),"src",{get:v,set:v}),Object.defineProperty(_.default.createElement("audio"),"src",{get:v,set:v}),Object.defineProperty(_.default.createElement("video"),"innerHTML",{get:v,set:v}),Object.defineProperty(_.default.createElement("audio"),"innerHTML",{get:v,set:v})}catch{return!1}return!0},Ce.supportsNativeTextTracks=function(){return b||M&&mt},Ce.supportsNativeVideoTracks=function(){return!!(Ce.TEST_VID&&Ce.TEST_VID.videoTracks)},Ce.supportsNativeAudioTracks=function(){return!!(Ce.TEST_VID&&Ce.TEST_VID.audioTracks)},Ce.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(v){var T=v[0],g=v[1];Ml(Ce.prototype,T,function(){return Ce[g]()},!0)}),Ce.prototype.featuresVolumeControl=Ce.canControlVolume(),Ce.prototype.movingMediaElementInDOM=!M,Ce.prototype.featuresFullscreenResize=!0,Ce.prototype.featuresProgressEvents=!0,Ce.prototype.featuresTimeupdateEvents=!0,Ce.prototype.featuresVideoFrameCallback=!!(Ce.TEST_VID&&Ce.TEST_VID.requestVideoFrameCallback);var ba;Ce.patchCanPlayType=function(){Et>=4&&!bt&&!mt&&(ba=Ce.TEST_VID&&Ce.TEST_VID.constructor.prototype.canPlayType,Ce.TEST_VID.constructor.prototype.canPlayType=function(v){var T=/^application\/(?:x-|vnd\.apple\.)mpegurl/i;return v&&T.test(v)?"maybe":ba.call(this,v)})},Ce.unpatchCanPlayType=function(){var v=Ce.TEST_VID.constructor.prototype.canPlayType;return ba&&(Ce.TEST_VID.constructor.prototype.canPlayType=ba),v},Ce.patchCanPlayType(),Ce.disposeMediaElement=function(v){if(v){for(v.parentNode&&v.parentNode.removeChild(v);v.hasChildNodes();)v.removeChild(v.firstChild);v.removeAttribute("src"),typeof v.load=="function"&&function(){try{v.load()}catch{}}()}},Ce.resetMediaElement=function(v){if(v){for(var T=v.querySelectorAll("source"),g=T.length;g--;)v.removeChild(T[g]);v.removeAttribute("src"),typeof v.load=="function"&&function(){try{v.load()}catch{}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(v){Ce.prototype[v]=function(){return this.el_[v]||this.el_.hasAttribute(v)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(v){Ce.prototype["set"+vt(v)]=function(T){this.el_[v]=T,T?this.el_.setAttribute(v,v):this.el_.removeAttribute(v)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(v){Ce.prototype[v]=function(){return this.el_[v]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(v){Ce.prototype["set"+vt(v)]=function(T){this.el_[v]=T}}),["pause","load","play"].forEach(function(v){Ce.prototype[v]=function(){return this.el_[v]()}}),lt.withSourceHandlers(Ce),Ce.nativeSourceHandler={},Ce.nativeSourceHandler.canPlayType=function(v){try{return Ce.TEST_VID.canPlayType(v)}catch{return""}},Ce.nativeSourceHandler.canHandleSource=function(v,T){if(v.type)return Ce.nativeSourceHandler.canPlayType(v.type);if(v.src){var g=ul(v.src);return Ce.nativeSourceHandler.canPlayType("video/"+g)}return""},Ce.nativeSourceHandler.handleSource=function(v,T,g){T.setSrc(v.src)},Ce.nativeSourceHandler.dispose=function(){},Ce.registerSourceHandler(Ce.nativeSourceHandler),lt.registerTech("Html5",Ce);var wd=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],Fl={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},Nl=["tiny","xsmall","small","medium","large","xlarge","huge"],Sa={};Nl.forEach(function(v){var T=v.charAt(0)==="x"?"x-"+v.substring(1):v;Sa[v]="vjs-layout-"+T});var _T={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},Ct=function(v){I.default(T,v);function T(d,o,u){var y;if(d.id=d.id||o.id||"vjs_video_"+ni(),o=De(T.getTagSettings(d),o),o.initChildren=!1,o.createEl=!1,o.evented=!1,o.reportTouchActivity=!1,!o.language)if(typeof d.closest=="function"){var w=d.closest("[lang]");w&&w.getAttribute&&(o.language=w.getAttribute("lang"))}else for(var F=d;F&&F.nodeType===1;){if(ri(F).hasOwnProperty("lang")){o.language=F.getAttribute("lang");break}F=F.parentNode}if(y=v.call(this,null,o,u)||this,y.boundDocumentFullscreenChange_=function(V){return y.documentFullscreenChange_(V)},y.boundFullWindowOnEscKey_=function(V){return y.fullWindowOnEscKey(V)},y.boundUpdateStyleEl_=function(V){return y.updateStyleEl_(V)},y.boundApplyInitTime_=function(V){return y.applyInitTime_(V)},y.boundUpdateCurrentBreakpoint_=function(V){return y.updateCurrentBreakpoint_(V)},y.boundHandleTechClick_=function(V){return y.handleTechClick_(V)},y.boundHandleTechDoubleClick_=function(V){return y.handleTechDoubleClick_(V)},y.boundHandleTechTouchStart_=function(V){return y.handleTechTouchStart_(V)},y.boundHandleTechTouchMove_=function(V){return y.handleTechTouchMove_(V)},y.boundHandleTechTouchEnd_=function(V){return y.handleTechTouchEnd_(V)},y.boundHandleTechTap_=function(V){return y.handleTechTap_(V)},y.isFullscreen_=!1,y.log=te(y.id_),y.fsApi_=se,y.isPosterFromTech_=!1,y.queuedCallbacks_=[],y.isReady_=!1,y.hasStarted_=!1,y.userActive_=!1,y.debugEnabled_=!1,y.audioOnlyMode_=!1,y.audioPosterMode_=!1,y.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!y.options_||!y.options_.techOrder||!y.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(y.tag=d,y.tagAttributes=d&&ri(d),y.language(y.options_.language),o.languages){var $={};Object.getOwnPropertyNames(o.languages).forEach(function(V){$[V.toLowerCase()]=o.languages[V]}),y.languages_=$}else y.languages_=T.prototype.options_.languages;y.resetCache_(),y.poster_=o.poster||"",y.controls_=!!o.controls,d.controls=!1,d.removeAttribute("controls"),y.changingSrc_=!1,y.playCallbacks_=[],y.playTerminatedQueue_=[],d.hasAttribute("autoplay")?y.autoplay(!0):y.autoplay(y.options_.autoplay),o.plugins&&Object.keys(o.plugins).forEach(function(V){if(typeof y[V]!="function")throw new Error('plugin "'+V+'" does not exist')}),y.scrubbing_=!1,y.el_=y.createEl(),cn(S.default(y),{eventBusKey:"el_"}),y.fsApi_.requestFullscreen&&(jt(_.default,y.fsApi_.fullscreenchange,y.boundDocumentFullscreenChange_),y.on(y.fsApi_.fullscreenchange,y.boundDocumentFullscreenChange_)),y.fluid_&&y.on(["playerreset","resize"],y.boundUpdateStyleEl_);var K=dt(y.options_);o.plugins&&Object.keys(o.plugins).forEach(function(V){y[V](o.plugins[V])}),o.debug&&y.debug(!0),y.options_.playerOptions=K,y.middleware_=[],y.playbackRates(o.playbackRates),y.initChildren(),y.isAudio(d.nodeName.toLowerCase()==="audio"),y.controls()?y.addClass("vjs-controls-enabled"):y.addClass("vjs-controls-disabled"),y.el_.setAttribute("role","region"),y.isAudio()?y.el_.setAttribute("aria-label",y.localize("Audio Player")):y.el_.setAttribute("aria-label",y.localize("Video Player")),y.isAudio()&&y.addClass("vjs-audio"),y.flexNotSupported_()&&y.addClass("vjs-no-flex"),qt&&y.addClass("vjs-touch-enabled"),M||y.addClass("vjs-workinghover"),T.players[y.id_]=S.default(y);var z=B.split(".")[0];return y.addClass("vjs-v"+z),y.userActive(!0),y.reportUserActivity(),y.one("play",function(V){return y.listenForUserActivity_(V)}),y.on("stageclick",function(V){return y.handleStageClick_(V)}),y.on("keydown",function(V){return y.handleKeyDown(V)}),y.on("languagechange",function(V){return y.handleLanguagechange(V)}),y.breakpoints(y.options_.breakpoints),y.responsive(y.options_.responsive),y.on("ready",function(){y.audioPosterMode(y.options_.audioPosterMode),y.audioOnlyMode(y.options_.audioOnlyMode)}),y}var g=T.prototype;return g.dispose=function(){var o=this;this.trigger("dispose"),this.off("dispose"),Pt(_.default,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Pt(_.default,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),T.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),$y(this),Gt.names.forEach(function(u){var y=Gt[u],w=o[y.getterName]();w&&w.off&&w.off()}),v.prototype.dispose.call(this,{restoreEl:this.options_.restoreEl})},g.createEl=function(){var o=this.tag,u,y=this.playerElIngest_=o.parentNode&&o.parentNode.hasAttribute&&o.parentNode.hasAttribute("data-vjs-player"),w=this.tag.tagName.toLowerCase()==="video-js";y?u=this.el_=o.parentNode:w||(u=this.el_=v.prototype.createEl.call(this,"div"));var F=ri(o);if(w){for(u=this.el_=o,o=this.tag=_.default.createElement("video");u.children.length;)o.appendChild(u.firstChild);Yi(u,"video-js")||vi(u,"video-js"),u.appendChild(o),y=this.playerElIngest_=u,Object.keys(u).forEach(function(Ae){try{o[Ae]=u[Ae]}catch{}})}if(o.setAttribute("tabindex","-1"),F.tabindex="-1",(Ot||mt&&kt)&&(o.setAttribute("role","application"),F.role="application"),o.removeAttribute("width"),o.removeAttribute("height"),"width"in F&&delete F.width,"height"in F&&delete F.height,Object.getOwnPropertyNames(F).forEach(function(Ae){w&&Ae==="class"||u.setAttribute(Ae,F[Ae]),w&&o.setAttribute(Ae,F[Ae])}),o.playerId=o.id,o.id+="_html5_api",o.className="vjs-tech",o.player=u.player=this,this.addClass("vjs-paused"),m.default.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=cr("vjs-styles-dimensions");var $=ki(".vjs-styles-defaults"),K=ki("head");K.insertBefore(this.styleEl_,$?$.nextSibling:K.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var z=o.getElementsByTagName("a"),V=0;V<z.length;V++){var ge=z.item(V);vi(ge,"vjs-hidden"),ge.setAttribute("hidden","hidden")}return o.initNetworkState_=o.networkState,o.parentNode&&!y&&o.parentNode.insertBefore(u,o),tn(o,u),this.children_.unshift(o),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=u,u},g.crossOrigin=function(o){if(!o)return this.techGet_("crossOrigin");if(o!=="anonymous"&&o!=="use-credentials"){Q.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+o+'"');return}this.techCall_("setCrossOrigin",o)},g.width=function(o){return this.dimension("width",o)},g.height=function(o){return this.dimension("height",o)},g.dimension=function(o,u){var y=o+"_";if(u===void 0)return this[y]||0;if(u===""||u==="auto"){this[y]=void 0,this.updateStyleEl_();return}var w=parseFloat(u);if(isNaN(w)){Q.error('Improper value "'+u+'" supplied for for '+o);return}this[y]=w,this.updateStyleEl_()},g.fluid=function(o){var u=this;if(o===void 0)return!!this.fluid_;this.fluid_=!!o,Be(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),o?(this.addClass("vjs-fluid"),this.fill(!1),ht(this,function(){u.on(["playerreset","resize"],u.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()},g.fill=function(o){if(o===void 0)return!!this.fill_;this.fill_=!!o,o?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},g.aspectRatio=function(o){if(o===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(o))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=o,this.fluid(!0),this.updateStyleEl_()},g.updateStyleEl_=function(){if(m.default.VIDEOJS_NO_DYNAMIC_STYLE===!0){var o=typeof this.width_=="number"?this.width_:this.options_.width,u=typeof this.height_=="number"?this.height_:this.options_.height,y=this.tech_&&this.tech_.el();y&&(o>=0&&(y.width=o),u>=0&&(y.height=u));return}var w,F,$,K;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?$=this.aspectRatio_:this.videoWidth()>0?$=this.videoWidth()+":"+this.videoHeight():$="16:9";var z=$.split(":"),V=z[1]/z[0];this.width_!==void 0?w=this.width_:this.height_!==void 0?w=this.height_/V:w=this.videoWidth()||300,this.height_!==void 0?F=this.height_:F=w*V,/^[^a-zA-Z]/.test(this.id())?K="dimensions-"+this.id():K=this.id()+"-dimensions",this.addClass(K),vs(this.styleEl_,`
      .`+K+` {
        width: `+w+`px;
        height: `+F+`px;
      }

      .`+K+`.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: `+V*100+`%;
      }
    `)},g.loadTech_=function(o,u){var y=this;this.tech_&&this.unloadTech_();var w=vt(o),F=o.charAt(0).toLowerCase()+o.slice(1);w!=="Html5"&&this.tag&&(lt.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=w,this.isReady_=!1;var $=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&($=!1);var K={source:u,autoplay:$,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+F+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};Gt.names.forEach(function(V){var ge=Gt[V];K[ge.getterName]=y[ge.privateName]}),De(K,this.options_[w]),De(K,this.options_[F]),De(K,this.options_[o.toLowerCase()]),this.tag&&(K.tag=this.tag),u&&u.src===this.cache_.src&&this.cache_.currentTime>0&&(K.startTime=this.cache_.currentTime);var z=lt.getTech(o);if(!z)throw new Error("No Tech named '"+w+"' exists! '"+w+"' should be registered using videojs.registerTech()'");this.tech_=new z(K),this.tech_.ready(ot(this,this.handleTechReady_),!0),Rc.jsonToTextTracks(this.textTracksJson_||[],this.tech_),wd.forEach(function(V){y.on(y.tech_,V,function(ge){return y["handleTech"+vt(V)+"_"](ge)})}),Object.keys(Fl).forEach(function(V){y.on(y.tech_,V,function(ge){if(y.tech_.playbackRate()===0&&y.tech_.seeking()){y.queuedCallbacks_.push({callback:y["handleTech"+Fl[V]+"_"].bind(y),event:ge});return}y["handleTech"+Fl[V]+"_"](ge)})}),this.on(this.tech_,"loadstart",function(V){return y.handleTechLoadStart_(V)}),this.on(this.tech_,"sourceset",function(V){return y.handleTechSourceset_(V)}),this.on(this.tech_,"waiting",function(V){return y.handleTechWaiting_(V)}),this.on(this.tech_,"ended",function(V){return y.handleTechEnded_(V)}),this.on(this.tech_,"seeking",function(V){return y.handleTechSeeking_(V)}),this.on(this.tech_,"play",function(V){return y.handleTechPlay_(V)}),this.on(this.tech_,"firstplay",function(V){return y.handleTechFirstPlay_(V)}),this.on(this.tech_,"pause",function(V){return y.handleTechPause_(V)}),this.on(this.tech_,"durationchange",function(V){return y.handleTechDurationChange_(V)}),this.on(this.tech_,"fullscreenchange",function(V,ge){return y.handleTechFullscreenChange_(V,ge)}),this.on(this.tech_,"fullscreenerror",function(V,ge){return y.handleTechFullscreenError_(V,ge)}),this.on(this.tech_,"enterpictureinpicture",function(V){return y.handleTechEnterPictureInPicture_(V)}),this.on(this.tech_,"leavepictureinpicture",function(V){return y.handleTechLeavePictureInPicture_(V)}),this.on(this.tech_,"error",function(V){return y.handleTechError_(V)}),this.on(this.tech_,"posterchange",function(V){return y.handleTechPosterChange_(V)}),this.on(this.tech_,"textdata",function(V){return y.handleTechTextData_(V)}),this.on(this.tech_,"ratechange",function(V){return y.handleTechRateChange_(V)}),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(w!=="Html5"||!this.tag)&&tn(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},g.unloadTech_=function(){var o=this;Gt.names.forEach(function(u){var y=Gt[u];o[y.privateName]=o[y.getterName]()}),this.textTracksJson_=Rc.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},g.tech=function(o){return o===void 0&&Q.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_},g.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},g.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},g.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},g.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())},g.manualAutoplay_=function(o){var u=this;if(!(!this.tech_||typeof o!="string")){var y=function(){var $=u.muted();u.muted(!0);var K=function(){u.muted($)};u.playTerminatedQueue_.push(K);var z=u.play();if(dn(z))return z.catch(function(V){throw K(),new Error("Rejection at manualAutoplay. Restoring muted value. "+(V||""))})},w;if(o==="any"&&!this.muted()?(w=this.play(),dn(w)&&(w=w.catch(y))):o==="muted"&&!this.muted()?w=y():w=this.play(),!!dn(w))return w.then(function(){u.trigger({type:"autoplay-success",autoplay:o})}).catch(function(){u.trigger({type:"autoplay-failure",autoplay:o})})}},g.updateSourceCaches_=function(o){o===void 0&&(o="");var u=o,y="";typeof u!="string"&&(u=o.src,y=o.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],u&&!y&&(y=Vy(this,u)),this.cache_.source=dt({},o,{src:u,type:y});for(var w=this.cache_.sources.filter(function(ge){return ge.src&&ge.src===u}),F=[],$=this.$$("source"),K=[],z=0;z<$.length;z++){var V=ri($[z]);F.push(V),V.src&&V.src===u&&K.push(V.src)}K.length&&!w.length?this.cache_.sources=F:w.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=u},g.handleTechSourceset_=function(o){var u=this;if(!this.changingSrc_){var y=function(K){return u.updateSourceCaches_(K)},w=this.currentSource().src,F=o.src;w&&!/^blob:/.test(w)&&/^blob:/.test(F)&&(!this.lastSource_||this.lastSource_.tech!==F&&this.lastSource_.player!==w)&&(y=function(){}),y(F),o.src||this.tech_.any(["sourceset","loadstart"],function($){if($.type!=="sourceset"){var K=u.techGet("currentSrc");u.lastSource_.tech=K,u.updateSourceCaches_(K)}})}this.lastSource_={player:this.currentSource().src,tech:o.src},this.trigger({src:o.src,type:"sourceset"})},g.hasStarted=function(o){if(o===void 0)return this.hasStarted_;o!==this.hasStarted_&&(this.hasStarted_=o,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},g.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},g.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(function(o){return o.callback(o.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},g.handleTechWaiting_=function(){var o=this;this.addClass("vjs-waiting"),this.trigger("waiting");var u=this.currentTime(),y=function w(){u!==o.currentTime()&&(o.removeClass("vjs-waiting"),o.off("timeupdate",w))};this.on("timeupdate",y)},g.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},g.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},g.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},g.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},g.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},g.handleTechFirstPlay_=function(){this.options_.starttime&&(Q.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},g.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},g.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},g.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},g.handleTechClick_=function(o){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,o):this.paused()?Ri(this.play()):this.pause())},g.handleTechDoubleClick_=function(o){if(this.controls_){var u=Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(y){return y.contains(o.target)});u||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,o):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}},g.handleTechTap_=function(){this.userActive(!this.userActive())},g.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},g.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},g.handleTechTouchEnd_=function(o){o.cancelable&&o.preventDefault()},g.handleStageClick_=function(){this.reportUserActivity()},g.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},g.documentFullscreenChange_=function(o){var u=o.target.player;if(!(u&&u!==this)){var y=this.el(),w=_.default[this.fsApi_.fullscreenElement]===y;!w&&y.matches?w=y.matches(":"+this.fsApi_.fullscreen):!w&&y.msMatchesSelector&&(w=y.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(w)}},g.handleTechFullscreenChange_=function(o,u){var y=this;u&&(u.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",function(){y.removeClass("vjs-ios-native-fs")})),this.isFullscreen(u.isFullscreen))},g.handleTechFullscreenError_=function(o,u){this.trigger("fullscreenerror",u)},g.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},g.handleTechEnterPictureInPicture_=function(o){this.isInPictureInPicture(!0)},g.handleTechLeavePictureInPicture_=function(o){this.isInPictureInPicture(!1)},g.handleTechError_=function(){var o=this.tech_.error();this.error(o)},g.handleTechTextData_=function(){var o=null;arguments.length>1&&(o=arguments[1]),this.trigger("textdata",o)},g.getCache=function(){return this.cache_},g.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},g.techCall_=function(o,u){this.ready(function(){if(o in By)return Fy(this.middleware_,this.tech_,o,u);if(o in jc)return Hc(this.middleware_,this.tech_,o,u);try{this.tech_&&this.tech_[o](u)}catch(y){throw Q(y),y}},!0)},g.techGet_=function(o){if(!(!this.tech_||!this.tech_.isReady_)){if(o in Ny)return My(this.middleware_,this.tech_,o);if(o in jc)return Hc(this.middleware_,this.tech_,o);try{return this.tech_[o]()}catch(u){throw this.tech_[o]===void 0?(Q("Video.js: "+o+" method not defined for "+this.techName_+" playback technology.",u),u):u.name==="TypeError"?(Q("Video.js: "+o+" unavailable on "+this.techName_+" playback technology element.",u),this.tech_.isReady_=!1,u):(Q(u),u)}}},g.play=function(){var o=this,u=this.options_.Promise||m.default.Promise;return u?new u(function(y){o.play_(y)}):this.play_()},g.play_=function(o){var u=this;o===void 0&&(o=Ri),this.playCallbacks_.push(o);var y=!!(!this.changingSrc_&&(this.src()||this.currentSrc())),w=!!(b||M);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!y){this.waitToPlay_=function(K){u.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!y&&w&&this.load();return}var F=this.techGet_("play"),$=w&&this.hasClass("vjs-ended");$&&this.resetProgressBar_(),F===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(F)},g.runPlayTerminatedQueue_=function(){var o=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],o.forEach(function(u){u()})},g.runPlayCallbacks_=function(o){var u=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],u.forEach(function(y){y(o)})},g.pause=function(){this.techCall_("pause")},g.paused=function(){return this.techGet_("paused")!==!1},g.played=function(){return this.techGet_("played")||Ks(0,0)},g.scrubbing=function(o){if(typeof o>"u")return this.scrubbing_;this.scrubbing_=!!o,this.techCall_("setScrubbing",this.scrubbing_),o?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},g.currentTime=function(o){if(typeof o<"u"){if(o<0&&(o=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=o,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",o),this.cache_.initTime=0;return}return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime},g.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},g.duration=function(o){if(o===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;o=parseFloat(o),o<0&&(o=1/0),o!==this.cache_.duration&&(this.cache_.duration=o,o===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(o)||this.trigger("durationchange"))},g.remainingTime=function(){return this.duration()-this.currentTime()},g.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},g.buffered=function(){var o=this.techGet_("buffered");return(!o||!o.length)&&(o=Ks(0,0)),o},g.bufferedPercent=function(){return kc(this.buffered(),this.duration())},g.bufferedEnd=function(){var o=this.buffered(),u=this.duration(),y=o.end(o.length-1);return y>u&&(y=u),y},g.volume=function(o){var u;if(o!==void 0){u=Math.max(0,Math.min(1,parseFloat(o))),this.cache_.volume=u,this.techCall_("setVolume",u),u>0&&this.lastVolume_(u);return}return u=parseFloat(this.techGet_("volume")),isNaN(u)?1:u},g.muted=function(o){if(o!==void 0){this.techCall_("setMuted",o);return}return this.techGet_("muted")||!1},g.defaultMuted=function(o){return o!==void 0?this.techCall_("setDefaultMuted",o):this.techGet_("defaultMuted")||!1},g.lastVolume_=function(o){if(o!==void 0&&o!==0){this.cache_.lastVolume=o;return}return this.cache_.lastVolume},g.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},g.isFullscreen=function(o){if(o!==void 0){var u=this.isFullscreen_;this.isFullscreen_=!!o,this.isFullscreen_!==u&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_},g.requestFullscreen=function(o){var u=this.options_.Promise||m.default.Promise;if(u){var y=this;return new u(function(w,F){function $(){y.off("fullscreenerror",z),y.off("fullscreenchange",K)}function K(){$(),w()}function z(ge,Ae){$(),F(Ae)}y.one("fullscreenchange",K),y.one("fullscreenerror",z);var V=y.requestFullscreenHelper_(o);V&&(V.then($,$),V.then(w,F))})}return this.requestFullscreenHelper_()},g.requestFullscreenHelper_=function(o){var u=this,y;if(this.fsApi_.prefixed||(y=this.options_.fullscreen&&this.options_.fullscreen.options||{},o!==void 0&&(y=o)),this.fsApi_.requestFullscreen){var w=this.el_[this.fsApi_.requestFullscreen](y);return w&&w.then(function(){return u.isFullscreen(!0)},function(){return u.isFullscreen(!1)}),w}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},g.exitFullscreen=function(){var o=this.options_.Promise||m.default.Promise;if(o){var u=this;return new o(function(y,w){function F(){u.off("fullscreenerror",K),u.off("fullscreenchange",$)}function $(){F(),y()}function K(V,ge){F(),w(ge)}u.one("fullscreenchange",$),u.one("fullscreenerror",K);var z=u.exitFullscreenHelper_();z&&(z.then(F,F),z.then(y,w))})}return this.exitFullscreenHelper_()},g.exitFullscreenHelper_=function(){var o=this;if(this.fsApi_.requestFullscreen){var u=_.default[this.fsApi_.exitFullscreen]();return u&&Ri(u.then(function(){return o.isFullscreen(!1)})),u}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},g.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=_.default.documentElement.style.overflow,jt(_.default,"keydown",this.boundFullWindowOnEscKey_),_.default.documentElement.style.overflow="hidden",vi(_.default.body,"vjs-full-window"),this.trigger("enterFullWindow")},g.fullWindowOnEscKey=function(o){C.default.isEventKey(o,"Esc")&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},g.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,Pt(_.default,"keydown",this.boundFullWindowOnEscKey_),_.default.documentElement.style.overflow=this.docOrigOverflow,Hs(_.default.body,"vjs-full-window"),this.trigger("exitFullWindow")},g.disablePictureInPicture=function(o){if(o===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",o),this.options_.disablePictureInPicture=o,this.trigger("disablepictureinpicturechanged")},g.isInPictureInPicture=function(o){if(o!==void 0){this.isInPictureInPicture_=!!o,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_},g.requestPictureInPicture=function(){if("pictureInPictureEnabled"in _.default&&this.disablePictureInPicture()===!1)return this.techGet_("requestPictureInPicture")},g.exitPictureInPicture=function(){if("pictureInPictureEnabled"in _.default)return _.default.exitPictureInPicture()},g.handleKeyDown=function(o){var u=this.options_.userActions;if(!(!u||!u.hotkeys)){var y=function(F){var $=F.tagName.toLowerCase();if(F.isContentEditable)return!0;var K=["button","checkbox","hidden","radio","reset","submit"];if($==="input")return K.indexOf(F.type)===-1;var z=["textarea"];return z.indexOf($)!==-1};y(this.el_.ownerDocument.activeElement)||(typeof u.hotkeys=="function"?u.hotkeys.call(this,o):this.handleHotkeys(o))}},g.handleHotkeys=function(o){var u=this.options_.userActions?this.options_.userActions.hotkeys:{},y=u.fullscreenKey,w=y===void 0?function(We){return C.default.isEventKey(We,"f")}:y,F=u.muteKey,$=F===void 0?function(We){return C.default.isEventKey(We,"m")}:F,K=u.playPauseKey,z=K===void 0?function(We){return C.default.isEventKey(We,"k")||C.default.isEventKey(We,"Space")}:K;if(w.call(this,o)){o.preventDefault(),o.stopPropagation();var V=me.getComponent("FullscreenToggle");_.default[this.fsApi_.fullscreenEnabled]!==!1&&V.prototype.handleClick.call(this,o)}else if($.call(this,o)){o.preventDefault(),o.stopPropagation();var ge=me.getComponent("MuteToggle");ge.prototype.handleClick.call(this,o)}else if(z.call(this,o)){o.preventDefault(),o.stopPropagation();var Ae=me.getComponent("PlayToggle");Ae.prototype.handleClick.call(this,o)}},g.canPlayType=function(o){for(var u,y=0,w=this.options_.techOrder;y<w.length;y++){var F=w[y],$=lt.getTech(F);if($||($=me.getComponent(F)),!$){Q.error('The "'+F+'" tech is undefined. Skipped browser support check for that tech.');continue}if($.isSupported()&&(u=$.canPlayType(o),u))return u}return""},g.selectSource=function(o){var u=this,y=this.options_.techOrder.map(function(z){return[z,lt.getTech(z)]}).filter(function(z){var V=z[0],ge=z[1];return ge?ge.isSupported():(Q.error('The "'+V+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),w=function(V,ge,Ae){var We;return V.some(function(Ys){return ge.some(function(Di){if(We=Ae(Ys,Di),We)return!0})}),We},F,$=function(V){return function(ge,Ae){return V(Ae,ge)}},K=function(V,ge){var Ae=V[0],We=V[1];if(We.canPlaySource(ge,u.options_[Ae.toLowerCase()]))return{source:ge,tech:Ae}};return this.options_.sourceOrder?F=w(o,y,$(K)):F=w(y,o,K),F||!1},g.handleSrc_=function(o,u){var y=this;if(typeof o>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var w=Gy(o);if(!w.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,u||(this.cache_.sources=w),this.updateSourceCaches_(w[0]),xy(this,w[0],function(K,z){y.middleware_=z,u||(y.cache_.sources=w),y.updateSourceCaches_(K);var V=y.src_(K);if(V){if(w.length>1)return y.handleSrc_(w.slice(1));y.changingSrc_=!1,y.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),y.triggerReady();return}Oy(z,y.tech_)}),this.options_.retryOnError&&w.length>1){var F=function(){y.error(null),y.handleSrc_(w.slice(1),!0)},$=function(){y.off("error",F)};this.one("error",F),this.one("playing",$),this.resetRetryOnError_=function(){y.off("error",F),y.off("playing",$)}}},g.src=function(o){return this.handleSrc_(o,!1)},g.src_=function(o){var u=this,y=this.selectSource([o]);return y?py(y.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",o):this.techCall_("src",o.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(y.tech,y.source),this.tech_.ready(function(){u.changingSrc_=!1}),!1):!0},g.load=function(){this.techCall_("load")},g.reset=function(){var o=this,u=this.options_.Promise||m.default.Promise;if(this.paused()||!u)this.doReset_();else{var y=this.play();Ri(y.then(function(){return o.doReset_()}))}},g.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),Be(this)&&this.trigger("playerreset")},g.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},g.resetProgressBar_=function(){this.currentTime(0);var o=this.controlBar||{},u=o.durationDisplay,y=o.remainingTimeDisplay;u&&u.updateContent(),y&&y.updateContent()},g.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},g.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},g.currentSources=function(){var o=this.currentSource(),u=[];return Object.keys(o).length!==0&&u.push(o),this.cache_.sources||u},g.currentSource=function(){return this.cache_.source||{}},g.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},g.currentType=function(){return this.currentSource()&&this.currentSource().type||""},g.preload=function(o){if(o!==void 0){this.techCall_("setPreload",o),this.options_.preload=o;return}return this.techGet_("preload")},g.autoplay=function(o){if(o===void 0)return this.options_.autoplay||!1;var u;typeof o=="string"&&/(any|play|muted)/.test(o)||o===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=o,this.manualAutoplay_(typeof o=="string"?o:"play"),u=!1):o?this.options_.autoplay=!0:this.options_.autoplay=!1,u=typeof u>"u"?this.options_.autoplay:u,this.tech_&&this.techCall_("setAutoplay",u)},g.playsinline=function(o){return o!==void 0?(this.techCall_("setPlaysinline",o),this.options_.playsinline=o,this):this.techGet_("playsinline")},g.loop=function(o){if(o!==void 0){this.techCall_("setLoop",o),this.options_.loop=o;return}return this.techGet_("loop")},g.poster=function(o){if(o===void 0)return this.poster_;o||(o=""),o!==this.poster_&&(this.poster_=o,this.techCall_("setPoster",o),this.isPosterFromTech_=!1,this.trigger("posterchange"))},g.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var o=this.tech_.poster()||"";o!==this.poster_&&(this.poster_=o,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},g.controls=function(o){if(o===void 0)return!!this.controls_;o=!!o,this.controls_!==o&&(this.controls_=o,this.usingNativeControls()&&this.techCall_("setControls",o),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},g.usingNativeControls=function(o){if(o===void 0)return!!this.usingNativeControls_;o=!!o,this.usingNativeControls_!==o&&(this.usingNativeControls_=o,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},g.error=function(o){var u=this;if(o===void 0)return this.error_||null;if(O("beforeerror").forEach(function(w){var F=w(u,o);if(!($e(F)&&!Array.isArray(F)||typeof F=="string"||typeof F=="number"||F===null)){u.log.error("please return a value that MediaError expects in beforeerror hooks");return}o=F}),this.options_.suppressNotSupportedError&&o&&o.code===4){var y=function(){this.error(o)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],y),this.one("loadstart",function(){this.off(["click","touchstart"],y)});return}if(o===null){this.error_=o,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new Vt(o),this.addClass("vjs-error"),Q.error("(CODE:"+this.error_.code+" "+Vt.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),O("error").forEach(function(w){return w(u,u.error_)})},g.reportUserActivity=function(o){this.userActivity_=!0},g.userActive=function(o){if(o===void 0)return this.userActive_;if(o=!!o,o!==this.userActive_){if(this.userActive_=o,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(u){u.stopPropagation(),u.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},g.listenForUserActivity_=function(){var o,u,y,w=ot(this,this.reportUserActivity),F=function(Ae){(Ae.screenX!==u||Ae.screenY!==y)&&(u=Ae.screenX,y=Ae.screenY,w())},$=function(){w(),this.clearInterval(o),o=this.setInterval(w,250)},K=function(Ae){w(),this.clearInterval(o)};this.on("mousedown",$),this.on("mousemove",F),this.on("mouseup",K),this.on("mouseleave",K);var z=this.getChild("controlBar");z&&!M&&!Ke&&(z.on("mouseenter",function(ge){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),z.on("mouseleave",function(ge){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",w),this.on("keyup",w);var V;this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(V);var ge=this.options_.inactivityTimeout;ge<=0||(V=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},ge))}},250)},g.playbackRate=function(o){if(o!==void 0){this.techCall_("setPlaybackRate",o);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1},g.defaultPlaybackRate=function(o){return o!==void 0?this.techCall_("setDefaultPlaybackRate",o):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},g.isAudio=function(o){if(o!==void 0){this.isAudio_=!!o;return}return!!this.isAudio_},g.enableAudioOnlyUI_=function(){var o=this;this.addClass("vjs-audio-only-mode");var u=this.children(),y=this.getChild("ControlBar"),w=y&&y.currentHeight();u.forEach(function(F){F!==y&&F.el_&&!F.hasClass("vjs-hidden")&&(F.hide(),o.audioOnlyCache_.hiddenChildren.push(F))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(w),this.trigger("audioonlymodechange")},g.disableAudioOnlyUI_=function(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(function(o){return o.show()}),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")},g.audioOnlyMode=function(o){var u=this;if(typeof o!="boolean"||o===this.audioOnlyMode_)return this.audioOnlyMode_;this.audioOnlyMode_=o;var y=this.options_.Promise||m.default.Promise;if(y){if(o){var w=[];return this.isInPictureInPicture()&&w.push(this.exitPictureInPicture()),this.isFullscreen()&&w.push(this.exitFullscreen()),this.audioPosterMode()&&w.push(this.audioPosterMode(!1)),y.all(w).then(function(){return u.enableAudioOnlyUI_()})}return y.resolve().then(function(){return u.disableAudioOnlyUI_()})}o?(this.isInPictureInPicture()&&this.exitPictureInPicture(),this.isFullscreen()&&this.exitFullscreen(),this.enableAudioOnlyUI_()):this.disableAudioOnlyUI_()},g.enablePosterModeUI_=function(){var o=this.tech_&&this.tech_;o.hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},g.disablePosterModeUI_=function(){var o=this.tech_&&this.tech_;o.show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},g.audioPosterMode=function(o){var u=this;if(typeof o!="boolean"||o===this.audioPosterMode_)return this.audioPosterMode_;this.audioPosterMode_=o;var y=this.options_.Promise||m.default.Promise;if(y){if(o){if(this.audioOnlyMode()){var w=this.audioOnlyMode(!1);return w.then(function(){u.enablePosterModeUI_()})}return y.resolve().then(function(){u.enablePosterModeUI_()})}return y.resolve().then(function(){u.disablePosterModeUI_()})}if(o){this.audioOnlyMode()&&this.audioOnlyMode(!1),this.enablePosterModeUI_();return}this.disablePosterModeUI_()},g.addTextTrack=function(o,u,y){if(this.tech_)return this.tech_.addTextTrack(o,u,y)},g.addRemoteTextTrack=function(o,u){if(this.tech_)return this.tech_.addRemoteTextTrack(o,u)},g.removeRemoteTextTrack=function(o){o===void 0&&(o={});var u=o,y=u.track;if(y||(y=o),this.tech_)return this.tech_.removeRemoteTextTrack(y)},g.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},g.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},g.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},g.language=function(o){if(o===void 0)return this.language_;this.language_!==String(o).toLowerCase()&&(this.language_=String(o).toLowerCase(),Be(this)&&this.trigger("languagechange"))},g.languages=function(){return dt(T.prototype.options_.languages,this.languages_)},g.toJSON=function(){var o=dt(this.options_),u=o.tracks;o.tracks=[];for(var y=0;y<u.length;y++){var w=u[y];w=dt(w),w.player=void 0,o.tracks[y]=w}return o},g.createModal=function(o,u){var y=this;u=u||{},u.content=o||"";var w=new mr(this,u);return this.addChild(w),w.on("dispose",function(){y.removeChild(w)}),w.open(),w},g.updateCurrentBreakpoint_=function(){if(this.responsive())for(var o=this.currentBreakpoint(),u=this.currentWidth(),y=0;y<Nl.length;y++){var w=Nl[y],F=this.breakpoints_[w];if(u<=F){if(o===w)return;o&&this.removeClass(Sa[o]),this.addClass(Sa[w]),this.breakpoint_=w;break}}},g.removeCurrentBreakpoint_=function(){var o=this.currentBreakpointClass();this.breakpoint_="",o&&this.removeClass(o)},g.breakpoints=function(o){return o===void 0?De(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=De({},_T,o),this.updateCurrentBreakpoint_(),De(this.breakpoints_))},g.responsive=function(o){if(o===void 0)return this.responsive_;o=!!o;var u=this.responsive_;if(o!==u)return this.responsive_=o,o?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),o},g.currentBreakpoint=function(){return this.breakpoint_},g.currentBreakpointClass=function(){return Sa[this.breakpoint_]||""},g.loadMedia=function(o,u){var y=this;if(!(!o||typeof o!="object")){this.reset(),this.cache_.media=dt(o);var w=this.cache_.media,F=w.artwork,$=w.poster,K=w.src,z=w.textTracks;!F&&$&&(this.cache_.media.artwork=[{src:$,type:ma($)}]),K&&this.src(K),$&&this.poster($),Array.isArray(z)&&z.forEach(function(V){return y.addRemoteTextTrack(V,!1)}),this.ready(u)}},g.getMedia=function(){if(!this.cache_.media){var o=this.poster(),u=this.currentSources(),y=Array.prototype.map.call(this.remoteTextTracks(),function(F){return{kind:F.kind,label:F.label,language:F.language,src:F.src}}),w={src:u,textTracks:y};return o&&(w.poster=o,w.artwork=[{src:w.poster,type:ma(w.poster)}]),w}return dt(this.cache_.media)},T.getTagSettings=function(o){var u={sources:[],tracks:[]},y=ri(o),w=y["data-setup"];if(Yi(o,"vjs-fill")&&(y.fill=!0),Yi(o,"vjs-fluid")&&(y.fluid=!0),w!==null){var F=R.default(w||"{}"),$=F[0],K=F[1];$&&Q.error($),De(y,K)}if(De(u,y),o.hasChildNodes())for(var z=o.childNodes,V=0,ge=z.length;V<ge;V++){var Ae=z[V],We=Ae.nodeName.toLowerCase();We==="source"?u.sources.push(ri(Ae)):We==="track"&&u.tracks.push(ri(Ae))}return u},g.flexNotSupported_=function(){var o=_.default.createElement("i");return!("flexBasis"in o.style||"webkitFlexBasis"in o.style||"mozFlexBasis"in o.style||"msFlexBasis"in o.style||"msFlexOrder"in o.style)},g.debug=function(o){if(o===void 0)return this.debugEnabled_;o?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},g.playbackRates=function(o){if(o===void 0)return this.cache_.playbackRates;Array.isArray(o)&&o.every(function(u){return typeof u=="number"})&&(this.cache_.playbackRates=o,this.trigger("playbackrateschange"))},T}(me);Gt.names.forEach(function(v){var T=Gt[v];Ct.prototype[T.getterName]=function(){return this.tech_?this.tech_[T.getterName]():(this[T.privateName]=this[T.privateName]||new T.ListClass,this[T.privateName])}}),Ct.prototype.crossorigin=Ct.prototype.crossOrigin,Ct.players={};var mn=m.default.navigator;Ct.prototype.options_={techOrder:lt.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:mn&&(mn.languages&&mn.languages[0]||mn.userLanguage||mn.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(v){Ct.prototype[v]=function(){return this.techGet_(v)}}),wd.forEach(function(v){Ct.prototype["handleTech"+vt(v)+"_"]=function(){return this.trigger(v)}}),me.registerComponent("Player",Ct);var Ca="plugin",Sr="activePlugins_",Cr={},wa=function(T){return Cr.hasOwnProperty(T)},Aa=function(T){return wa(T)?Cr[T]:void 0},Ad=function(T,g){T[Sr]=T[Sr]||{},T[Sr][g]=!0},Ia=function(T,g,d){var o=(d?"before":"")+"pluginsetup";T.trigger(o,g),T.trigger(o+":"+g.name,g)},ET=function(T,g){var d=function(){Ia(this,{name:T,plugin:g,instance:null},!0);var u=g.apply(this,arguments);return Ad(this,T),Ia(this,{name:T,plugin:g,instance:u}),u};return Object.keys(g).forEach(function(o){d[o]=g[o]}),d},Id=function(T,g){return g.prototype.name=T,function(){Ia(this,{name:T,plugin:g,instance:null},!0);for(var d=arguments.length,o=new Array(d),u=0;u<d;u++)o[u]=arguments[u];var y=x.default(g,[this].concat(o));return this[T]=function(){return y},Ia(this,y.getEventHash()),y}},Pi=function(){function v(g){if(this.constructor===v)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=g,this.log||(this.log=this.player.log.createLogger(this.name)),cn(this),delete this.trigger,Ic(this,this.constructor.defaultState),Ad(g,this.name),this.dispose=this.dispose.bind(this),g.on("dispose",this.dispose)}var T=v.prototype;return T.version=function(){return this.constructor.VERSION},T.getEventHash=function(d){return d===void 0&&(d={}),d.name=this.name,d.plugin=this.constructor,d.instance=this,d},T.trigger=function(d,o){return o===void 0&&(o={}),ys(this.eventBusEl_,d,this.getEventHash(o))},T.handleStateChanged=function(d){},T.dispose=function(){var d=this.name,o=this.player;this.trigger("dispose"),this.off(),o.off("dispose",this.dispose),o[Sr][d]=!1,this.player=this.state=null,o[d]=Id(d,Cr[d])},v.isBasic=function(d){var o=typeof d=="string"?Aa(d):d;return typeof o=="function"&&!v.prototype.isPrototypeOf(o.prototype)},v.registerPlugin=function(d,o){if(typeof d!="string")throw new Error('Illegal plugin name, "'+d+'", must be a string, was '+typeof d+".");if(wa(d))Q.warn('A plugin named "'+d+'" already exists. You may want to avoid re-registering plugins!');else if(Ct.prototype.hasOwnProperty(d))throw new Error('Illegal plugin name, "'+d+'", cannot share a name with an existing player method!');if(typeof o!="function")throw new Error('Illegal plugin for "'+d+'", must be a function, was '+typeof o+".");return Cr[d]=o,d!==Ca&&(v.isBasic(o)?Ct.prototype[d]=ET(d,o):Ct.prototype[d]=Id(d,o)),o},v.deregisterPlugin=function(d){if(d===Ca)throw new Error("Cannot de-register base plugin.");wa(d)&&(delete Cr[d],delete Ct.prototype[d])},v.getPlugins=function(d){d===void 0&&(d=Object.keys(Cr));var o;return d.forEach(function(u){var y=Aa(u);y&&(o=o||{},o[u]=y)}),o},v.getPluginVersion=function(d){var o=Aa(d);return o&&o.VERSION||""},v}();Pi.getPlugin=Aa,Pi.BASE_PLUGIN_NAME=Ca,Pi.registerPlugin(Ca,Pi),Ct.prototype.usingPlugin=function(v){return!!this[Sr]&&this[Sr][v]===!0},Ct.prototype.hasPlugin=function(v){return!!wa(v)};var Ld=!1,bT=function(T,g){g===void 0&&(g={}),Ld||(Q.warn("videojs.extend is deprecated as of Video.js 7.22.0 and will be removed in Video.js 8.0.0"),Ld=!0);var d=function(){T.apply(this,arguments)},o={};typeof g=="object"?(g.constructor!==Object.prototype.constructor&&(d=g.constructor),o=g):typeof g=="function"&&(d=g),N.default(d,T),T&&(d.super_=T);for(var u in o)o.hasOwnProperty(u)&&(d.prototype[u]=o[u]);return d},kd=function(T){return T.indexOf("#")===0?T.slice(1):T};function Le(v,T,g){var d=Le.getPlayer(v);if(d)return T&&Q.warn('Player "'+v+'" is already initialised. Options will not be applied.'),g&&d.ready(g),d;var o=typeof v=="string"?ki("#"+kd(v)):v;if(!Fe(o))throw new TypeError("The element or ID supplied is not valid. (videojs)");(!o.ownerDocument.defaultView||!o.ownerDocument.body.contains(o))&&Q.warn("The element supplied is not included in the DOM"),T=T||{},T.restoreEl===!0&&(T.restoreEl=(o.parentNode&&o.parentNode.hasAttribute("data-vjs-player")?o.parentNode:o).cloneNode(!0)),O("beforesetup").forEach(function(y){var w=y(o,dt(T));if(!$e(w)||Array.isArray(w)){Q.error("please return an object in beforesetup hooks");return}T=dt(T,w)});var u=me.getComponent("Player");return d=new u(o,T,g),O("setup").forEach(function(y){return y(d)}),d}if(Le.hooks_=H,Le.hooks=O,Le.hook=P,Le.hookOnce=J,Le.removeHook=G,m.default.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&ue()){var La=ki(".vjs-styles-defaults");if(!La){La=cr("vjs-styles-defaults");var Bl=ki("head");Bl&&Bl.insertBefore(La,Bl.firstChild),vs(La,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}return on(1,Le),Le.VERSION=B,Le.options=Ct.prototype.options_,Le.getPlayers=function(){return Ct.players},Le.getPlayer=function(v){var T=Ct.players,g;if(typeof v=="string"){var d=kd(v),o=T[d];if(o)return o;g=ki("#"+d)}else g=v;if(Fe(g)){var u=g,y=u.player,w=u.playerId;if(y||T[w])return y||T[w]}},Le.getAllPlayers=function(){return Object.keys(Ct.players).map(function(v){return Ct.players[v]}).filter(Boolean)},Le.players=Ct.players,Le.getComponent=me.getComponent,Le.registerComponent=function(v,T){lt.isTech(T)&&Q.warn("The "+v+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),me.registerComponent.call(me,v,T)},Le.getTech=lt.getTech,Le.registerTech=lt.registerTech,Le.use=Dy,Object.defineProperty(Le,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(Le.middleware,"TERMINATOR",{value:ga,writeable:!1,enumerable:!0}),Le.browser=A,Le.TOUCH_ENABLED=qt,Le.extend=bT,Le.mergeOptions=dt,Le.bind=ot,Le.registerPlugin=Pi.registerPlugin,Le.deregisterPlugin=Pi.deregisterPlugin,Le.plugin=function(v,T){return Q.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Pi.registerPlugin(v,T)},Le.getPlugins=Pi.getPlugins,Le.getPlugin=Pi.getPlugin,Le.getPluginVersion=Pi.getPluginVersion,Le.addLanguage=function(v,T){var g;return v=(""+v).toLowerCase(),Le.options.languages=dt(Le.options.languages,(g={},g[v]=T,g)),Le.options.languages[v]},Le.log=Q,Le.createLogger=te,Le.createTimeRange=Le.createTimeRanges=Ks,Le.formatTime=_r,Le.setFormatTime=Qy,Le.resetFormatTime=Jy,Le.parseUrl=ll,Le.isCrossOrigin=pa,Le.EventTarget=U,Le.on=jt,Le.one=pr,Le.off=Pt,Le.trigger=ys,Le.xhr=k.default,Le.TextTrack=fn,Le.AudioTrack=Nc,Le.VideoTrack=Bc,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(v){Le[v]=function(){return Q.warn("videojs."+v+"() is deprecated; use videojs.dom."+v+"() instead"),na[v].apply(null,arguments)}}),Le.computedStyle=Je,Le.dom=na,Le.url=Ly,Le.defineLazyProperty=Ml,Le.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"}),ru=Le,ru}var h_=u_();const X=kg(h_);function c_(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=e.length,i=new Uint8Array(n);let s="";for(const r of crypto.getRandomValues(i))s+=e[r%t];return s}function Dg(){const n=lr("volume");if(n!=null){const e=parseFloat(n);return isNaN(e)?void 0:e}}function xg(){const n=lr("mute");if(n!=null)return n==="true"}function Og(){const n=lr("theater-enabled");return n!=null?n==="true":!1}function Mg(n){return Us("volume",n.toString())}function Fg(n){return Us("mute",n.toString())}function Ng(n){return Us("theater-enabled",n.toString())}function Bg(n){return Us("average-bandwidth",n.toString())}function Ug(){const n=lr("average-bandwidth");if(n!=null){const e=parseInt(n,10);return isNaN(e)?void 0:e}}function oh(n){return Us("last-subtitle",n)}function $g(){return lr("last-subtitle")}function Hg(n){return Us("preferred-subtitle",n)}function jg(){return lr("preferred-subtitle")}function Vg(n,e){return Us("video-watch-history",JSON.stringify({...zh(),[n]:{duration:e,date:`${new Date().toISOString()}`}}))}function zh(n){let e;try{const t=lr("video-watch-history");if(!t)return{};e=JSON.parse(t)}catch(t){ze.error("Cannot parse video watch history from local storage/",t)}return e=e||{},n?e[n]:e}function d_(){const n=zh();if(!n)return;const e=Object.keys(n).reduce((t,i)=>{const s=Date.parse(n[i].date);return Math.ceil((new Date().getTime()-s)/(1e3*3600*24))>30?t:{...t,[i]:n[i]}},{});Us("video-watch-history",JSON.stringify(e))}function Gg(){const n="session-id";let e=f_(n);return e||(e=c_(32),p_(n,e),e)}const Ko="peertube-videojs-";function lr(n){return or.getItem(Ko+n)}function Us(n,e){or.setItem(Ko+n,e)}function f_(n){return Yn.getItem(Ko+n)}function p_(n,e){Yn.setItem(Ko+n,e)}function g_(){return`
  <div class="vjs-bezels-pause">
    <div class="vjs-bezel" role="status" aria-label="Pause">
      <div class="vjs-bezel-icon">
        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">
          <use class="vjs-svg-shadow" xlink:href="#vjs-id-1"></use>
          <path class="vjs-svg-fill" d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z" id="vjs-id-1"></path>
        </svg>
      </div>
    </div>
  </div>
  `}function m_(){return`
  <div class="vjs-bezels-play">
    <div class="vjs-bezel" role="status" aria-label="Play">
      <div class="vjs-bezel-icon">
        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">
          <use class="vjs-svg-shadow" xlink:href="#vjs-id-2"></use>
          <path class="vjs-svg-fill" d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z" id="ytp-id-2"></path>
        </svg>
      </div>
    </div>
  </div>
  `}const v_=X.getComponent("Component");class Kg extends v_{constructor(e,t){super(e,t),!So()&&(this.firstPlayDone=!1,this.paused=!1,this.playerPauseHandler=()=>{e.seeking()||(this.paused=!0,!e.ended()&&(this.container.innerHTML=g_(),this.showBezel()))},this.playerPlayHandler=()=>{if(e.seeking()||!this.firstPlayDone||!this.paused){this.firstPlayDone=!0;return}this.paused=!1,this.firstPlayDone=!0,this.container.innerHTML=m_(),this.showBezel()},this.videoChangeHandler=()=>{this.firstPlayDone=!1},e.on("video-change",()=>this.videoChangeHandler),e.on("pause",this.playerPauseHandler),e.on("play",this.playerPlayHandler))}dispose(){this.playerPauseHandler&&this.player().off("pause",this.playerPauseHandler),this.playerPlayHandler&&this.player().off("play",this.playerPlayHandler),this.videoChangeHandler&&this.player().off("video-change",this.videoChangeHandler),super.dispose()}createEl(){return this.container=super.createEl("div",{className:"vjs-bezels-content"}),this.container.style.display="none",this.container}showBezel(){this.container.style.display="inherit",setTimeout(()=>{this.container.style.display="none"},500)}}X.registerComponent("PauseBezel",Kg);const y_=X.getPlugin("plugin");class T_ extends y_{constructor(e,t){super(e),this.player.ready(()=>{e.addClass("vjs-bezels")});const i=new Kg(e,t);e.addChild(i),this.on("dispose",()=>e.removeChild(i))}}X.registerPlugin("bezels",T_);const __=X.getComponent("MenuItem");class E_ extends __{constructor(e,t){super(e,t)}handleClick(e){super.handleClick(e),this.options_.listener(e),setTimeout(()=>{this.player().contextMenu().menu.dispose()},1)}createEl(e,t,i){const s=super.createEl(e,t,i),r=X.dom.createEl("span");return r.innerHTML=`<span class="vjs-menu-item-text">${this.localize(this.options_.label)}</span>`,s.replaceChild(r,s.querySelector(".vjs-menu-item-text")),s}}const b_=X.getComponent("Menu");class S_ extends b_{constructor(e,t){super(e,{...t,menuButton:void 0}),this.dispose=X.bind(this,this.dispose);for(const i of t.content())this.addItem(new E_(e,{label:i.label,listener:X.bind(e,i.listener)}))}createEl(){const e=super.createEl();return X.dom.addClass(e,"vjs-contextmenu-ui-menu"),e.style.left=this.options_.position.left+"px",e.style.top=this.options_.position.top+"px",e}}function C_(n){let e;if(n.getBoundingClientRect&&n.parentNode&&(e=n.getBoundingClientRect()),!e)return{left:0,top:0};const t=document.documentElement,i=document.body,s=t.clientLeft||i.clientLeft||0,r=window.pageXOffset||i.scrollLeft,a=e.left+r-s,l=t.clientTop||i.clientTop||0,c=window.pageYOffset||i.scrollTop,h=e.top+c-l;return{left:Math.round(a),top:Math.round(h)}}function w_(n,e){const t={},i=C_(n),s=n.offsetWidth,r=n.offsetHeight,a=i.top,l=i.left;let c=e.pageY,h=e.pageX;return e.changedTouches&&(h=e.changedTouches[0].pageX,c=e.changedTouches[0].pageY),t.y=Math.max(0,Math.min(1,(a-c+r)/r)),t.x=Math.max(0,Math.min(1,(h-l)/s)),t}const A_=X.getPlugin("plugin");class I_ extends A_{constructor(e,t){super(e,t),this.options_=t,this.menu&&(this.menu.dispose(),this.player.off("contextmenu",this.onContextMenuBind)),this.onContextMenuBind=this.onContextMenu.bind(this),this.player.on("contextmenu",this.onContextMenuBind),this.player.ready(()=>this.player.addClass("vjs-contextmenu-ui"))}onContextMenu(e){if(L_(this.player)){this.menu.dispose();return}if(k_(e.target))return;const t=w_(this.player.el(),e),i=this.player.el().getBoundingClientRect(),s=R_(t,i),r=X.browser.IS_FIREFOX?document.documentElement:document;e.preventDefault();const a=this.menu=new S_(this.player,{content:this.options_.content,position:s});a.on("dispose",()=>{for(const f of["click","tap"])X.off(r,f,a.dispose);this.player.removeChild(a),this.menu=void 0}),this.player.addChild(a);const l=a.el(),c=l.getBoundingClientRect(),h=document.body.getBoundingClientRect();(c.right>h.width||c.bottom>h.height)&&(l.style.left=Math.floor(Math.min(s.left,this.player.currentWidth()-a.currentWidth()))+"px",l.style.top=Math.floor(Math.min(s.top,this.player.currentHeight()-a.currentHeight()))+"px");for(const f of["click","tap"])X.on(r,f,a.dispose)}}X.registerPlugin("contextMenu",I_);function L_(n){var e;return n.usingPlugin("contextMenu")?!!((e=n.contextMenu().menu)!=null&&e.el()):!1}function k_(n){const e=n.tagName.toLowerCase();return e==="input"||e==="textarea"}function R_(n,e){return{left:Math.round(e.width*n.x),top:Math.round(e.height-e.height*n.y)}}const P_=X.getComponent("Button");class D_ extends P_{constructor(e,t){super(e,t),e.on("texttrackchange",()=>this.update())}buildCSSClass(){return`vjs-caption-toggle-control vjs-captions-button ${super.buildCSSClass()}`}handleClick(e){var t;super.handleClick(e);const i=this.getShowing()||(t=this.getCaptionToEnable())==null?void 0:t.id;for(const s of this.player_.textTracks().tracks_)i&&s.id===i?s.mode="showing":s.mode="disabled"}update(){var e;if(this.getShowing()){this.controlText("Disable subtitles"),this.addClass("enabled");return}this.controlText(this.player_.localize("Enable {1} subtitle",[(e=this.getCaptionToEnable())==null?void 0:e.label])),this.removeClass("enabled")}getShowing(){return this.listCaptions().find(e=>e.mode==="showing")}getCaptionToEnable(){var e;const t=jg()||((e=this.listCaptions()[0])==null?void 0:e.id),i=this.listCaptions();return i.find(s=>s.id===t)||i[0]}listCaptions(){return this.player_.textTracks().tracks_.filter(e=>e.kind==="captions")}}X.registerComponent("CaptionToggleButton",D_);const x_=X.getComponent("ClickableComponent");class qg extends x_{constructor(e,t){super(e,t);const i=()=>{if(!this.hasValidDuration())return;const r=this.el();r.style.setProperty("left",this.buildLeftStyle()),r.style.setProperty("display","inline")};this.player().on("durationchange",i);const s=r=>r.stopPropagation();this.on(["mousedown","touchstart"],s),this.one("dispose",()=>{this.player()&&this.player().off("durationchange",i),this.el()&&this.off(["mousedown","touchstart"],s)})}createEl(){return X.dom.createEl("span",{className:"vjs-chapter-marker",style:this.hasValidDuration()?`left: ${this.buildLeftStyle()}`:"display: none;"})}handleClick(e){e.stopPropagation(),this.player()&&this.player().currentTime(this.options_.timecode)}buildLeftStyle(){return`${this.options_.timecode/this.player().duration()*100}%`}hasValidDuration(){const e=this.player().duration();return!(isNaN(e)||!e)}}X.registerComponent("ProgressBarMarkerComponent",qg);const O_=X.getPlugin("plugin");class M_ extends O_{constructor(e,t){super(e,t),Qe(this,"activeChapter"),this.markers=[],this.chapters=t.chapters,this.player.ready(()=>{e.addClass("vjs-chapters");for(const i of this.chapters){if(i.timecode===0)continue;const s=new qg(e,{timecode:i.timecode});s.on("mouseenter",()=>this.activeChapter=i),s.on("mouseleave",()=>this.activeChapter=void 0),this.markers.push(s),this.getSeekBar().addChild(s)}})}dispose(){for(const e of this.markers)this.getSeekBar().removeChild(e);super.dispose()}getChapter(e){if(this.activeChapter)return this.player.addClass("has-chapter"),{title:this.activeChapter.title,fixedTimecode:this.activeChapter.timecode};if(this.chapters.length!==0)for(let t=this.chapters.length-1;t>=0;t--){const i=this.chapters[t];if(i.timecode<=e)return this.player.addClass("has-chapter"),{title:i.title}}return this.player.removeClass("has-chapter"),{title:""}}getSeekBar(){return this.player.getDescendant("ControlBar","ProgressControl","SeekBar")}}X.registerPlugin("chapters",M_);const F_=X.getComponent("Button");class Wg extends F_{constructor(e,t){super(e,t),this.player().on("video-change",()=>{this.updateDisabled(),this.updateShowing()}),this.updateDisabled(),this.updateShowing()}createEl(){const e=this.options_.type,t=X.dom.createEl("button",{className:"vjs-"+e+"-video"}),i=X.dom.createEl("span",{className:"icon icon-"+e});return t.appendChild(i),e==="next"?t.title=this.player_.localize("Next video"):t.title=this.player_.localize("Previous video"),t}handleClick(){this.options_.handler()}updateDisabled(){this.options_.isDisabled()?this.addClass("vjs-disabled"):this.removeClass("vjs-disabled")}updateShowing(){this.options_.isDisplayed()?this.show():this.hide()}}X.registerComponent("NextVideoButton",Wg);X.registerComponent("PreviousVideoButton",Wg);function zg(n){return n.charAt(0).toUpperCase()+n.slice(1)}const nu=[{max:1024,type:"B",decimals:0},{max:1048576,type:"KB",decimals:0},{max:1073741824,type:"MB",decimals:0},{max:10995116e5,type:"GB",decimals:1}];function Zt(n){const e=nu.find(i=>n<i.max)||nu[nu.length-1];return[(n/(e.max/1024)).toFixed(e.decimals),e.type]}function N_(n){return{iceServers:n.map(e=>({urls:e}))}}const B_=X.getComponent("Button");class U_ extends B_{createEl(){const e=X.dom.createEl("div",{className:"vjs-peertube"}),t=X.dom.createEl("div",{className:"vjs-peertube-hidden"});e.appendChild(t);const i=X.dom.createEl("span",{className:"icon icon-download"},{role:"img",ariaLabel:this.player().localize("Download speed:")});t.appendChild(i);const s=X.dom.createEl("span",{className:"download-speed-text"}),r=X.dom.createEl("span",{className:"download-speed-number"}),a=X.dom.createEl("span");s.appendChild(r),s.appendChild(a),t.appendChild(s);const l=X.dom.createEl("span",{className:"icon icon-upload"},{role:"img",ariaLabel:this.player().localize("Upload speed:")});t.appendChild(l);const c=X.dom.createEl("span",{className:"upload-speed-text"}),h=X.dom.createEl("span",{className:"upload-speed-number"}),f=X.dom.createEl("span");c.appendChild(h),c.appendChild(f),t.appendChild(c);const p=X.dom.createEl("span",{className:"peers-text"}),m=X.dom.createEl("span",{className:"peers-number"});t.appendChild(m),t.appendChild(p);const _=X.dom.createEl("div",{className:"vjs-peertube-hidden"}),E=X.dom.createEl("span",{className:"http-fallback"});return _.appendChild(E),e.appendChild(_),this.player_.on("network-info",(C,S)=>{if(!S.p2p)return;t.className="vjs-peertube-displayed",_.className="vjs-peertube-hidden";const I=S.p2p,R=S.http,k=Zt(I.downloadSpeed+R.downloadSpeed),D=Zt(I.uploadSpeed),x=Zt(I.downloaded+R.downloaded),N=Zt(I.uploaded),B=I.peersWithWebSeed;if(t.title=this.player().localize("Total downloaded: ")+x.join(" ")+`
`,S.source==="p2p-media-loader"){const H=Zt(R.downloaded).join(" "),O=Zt(I.downloaded).join(" ");t.title+=" * "+this.player().localize("From servers: ")+H+`
 * `+this.player().localize("From peers: ")+O+`
`}t.title+=this.player().localize("Total uploaded: ")+N.join(" "),r.textContent=k[0],a.textContent=" "+k[1],h.textContent=D[0],f.textContent=" "+D[1],m.textContent=B.toString(),p.textContent=" "+(B>1?this.player().localize("peers"):this.player_.localize("peer")),_.className="vjs-peertube-hidden",t.className="vjs-peertube-displayed"}),this.player_.on("network-info",(C,S)=>{S.p2p||(S.source==="web-video"?E.textContent="HTTP":S.source==="p2p-media-loader"&&(E.textContent="HLS"),_.className="vjs-peertube-displayed",t.className="vjs-peertube-hidden",_.title=this.player().localize("Total downloaded: ")+Zt(S.http.downloaded).join(" "))}),this.player_.on("video-change",()=>{t.className="vjs-peertube-hidden",_.className="vjs-peertube-hidden"}),e}}X.registerComponent("P2PInfoButton",U_);const $_=X.getComponent("Component");class H_ extends $_{constructor(e,t){super(e,t),this.updateShowing(),this.player().on("video-change",()=>this.updateShowing())}dispose(){this.el()||(this.el().removeEventListener("mouseenter",this.mouseEnterHandler),this.el().removeEventListener("click",this.clickHandler),super.dispose())}createEl(){const e=X.dom.createEl("a",{href:this.buildLink(),innerText:this.options_.instanceName,title:this.player().localize("Video page (new window)"),className:"vjs-peertube-link",target:"_blank"});return this.mouseEnterHandler=()=>this.updateHref(),this.clickHandler=()=>this.player().pause(),e.addEventListener("mouseenter",this.mouseEnterHandler),e.addEventListener("click",this.clickHandler),e}updateShowing(){this.options_.isDisplayed()?this.show():this.hide()}updateHref(){this.el().setAttribute("href",this.buildLink())}buildLink(){const e=nh({shortUUID:this.options_.shortUUID()});return bg({url:e,startTime:this.player().currentTime()})}}X.registerComponent("PeerTubeLinkButton",H_);const j_=X.getComponent("ClickableComponent");class V_ extends j_{constructor(e,t){super(e,t),this.interval=this.setInterval(()=>this.updateClass(),1e3),this.updateSync(!0)}dispose(){this.interval&&(this.clearInterval(this.interval),this.interval=void 0),this.contentEl_=null,super.dispose()}createEl(){const e=super.createEl("div",{className:"vjs-pt-live-control vjs-control"});return this.contentEl_=X.dom.createEl("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(X.dom.createEl("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")} `})),this.contentEl_.appendChild(document.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}handleClick(){const e=this.getHLSJS();e&&(this.player().currentTime(e.liveSyncPosition),this.player().play(),this.updateSync(!0))}updateClass(){const e=this.getHLSJS();if(!e||this.player().currentTime()===0)return;const t=Math.abs(this.player().currentTime()-e.liveSyncPosition)<10;this.updateSync(t)}updateSync(e){e?(this.addClass("synced-with-live-edge"),this.removeAttribute("title"),this.disable()):(this.removeClass("synced-with-live-edge"),this.setAttribute("title",this.localize("Go back to the live")),this.enable())}getHLSJS(){var e;if((e=this.player())!=null&&e.usingPlugin("p2pMediaLoader"))return this.player().p2pMediaLoader().getHLSJS()}}X.registerComponent("PeerTubeLiveDisplay",V_);const G_=X.getPlugin("plugin");class K_ extends G_{constructor(e,t){super(e,t),this.url=t.url,this.height=t.height,this.width=t.width,this.interval=t.interval,this.sprites={},this.boundedHijackMouseTooltip=this.hijackMouseTooltip.bind(this),this.init(),this.player.ready(()=>{e.addClass("vjs-storyboard")})}init(){var e,t,i,s,r;const a=this.player.controlBar;this.progress=a?.progressControl,this.seekBar=(e=this.progress)==null?void 0:e.seekBar,this.mouseTimeTooltip=(i=(t=this.seekBar)==null?void 0:t.mouseTimeDisplay)==null?void 0:i.timeTooltip,this.spritePlaceholder=X.dom.createEl("div",{className:"vjs-storyboard-sprite-placeholder"}),(r=(s=this.seekBar)==null?void 0:s.el())==null||r.appendChild(this.spritePlaceholder),this.onReadyOrLoadstartHandler=l=>{if(l.type!=="ready"){const c=this.player.currentSources().find(f=>Object.prototype.hasOwnProperty.call(f,"storyboard")),h=c?.storyboard;h&&(this.url=h.url,this.height=h.height,this.width=h.width,this.interval=h.interval)}this.cached=!!this.sprites[this.url],this.load()},this.player.on(["ready","loadstart"],this.onReadyOrLoadstartHandler)}dispose(){var e,t;this.onReadyOrLoadstartHandler&&this.player.off(["ready","loadstart"],this.onReadyOrLoadstartHandler),this.progress&&this.progress.off(["mousemove","touchmove"],this.boundedHijackMouseTooltip),(t=(e=this.seekBar)==null?void 0:e.el())==null||t.removeChild(this.spritePlaceholder),super.dispose()}load(){const e=["mousemove","touchmove"];this.isReady()?(this.cached||(this.sprites[this.url]=X.dom.createEl("img",{src:this.url})),this.progress.on(e,this.boundedHijackMouseTooltip)):(this.progress.off(e,this.boundedHijackMouseTooltip),this.resetMouseTooltip())}hijackMouseTooltip(e){const t=this.sprites[this.url],i=t.naturalWidth,s=t.naturalHeight,r=this.seekBar.el();if(!t.complete||!i||!s){this.resetMouseTooltip();return}this.player.requestNamedAnimationFrame("StoryBoardPlugin#hijackMouseTooltip",()=>{const a=X.dom.getBoundingClientRect(r),l=X.dom.getBoundingClientRect(this.player.el());if(!a||!l)return;const c=X.dom.getPointerPosition(r,e).x;let h=c*this.player.duration();const f=Math.round(s/this.height*(i/this.width))-1;h=Math.min(h/this.interval,f);const p=600,m=this.player.currentWidth(),_=m<p?m/p:1,E=i/this.width,C=this.width*_,S=this.height*_,I=Math.floor(h%E)*-C,R=Math.floor(h/E)*-S,k=`${i*_}px ${s*_}px`,D=this.player.el().querySelector(".vjs-time-tooltip"),x=-S+parseInt(getComputedStyle(D).top.replace("px",""))-20,N=Math.round(C/2);let B=a.width*c-N;const H=l.left-a.left,O=a.width-C+(l.right-a.right);B<H&&(B=H),B>O&&(B=O);const P={"background-image":`url("${this.url}")`,"background-repeat":"no-repeat","background-position":`${I}px ${R}px`,"background-size":k,color:"#fff","text-shadow":"1px 1px #000",position:"relative",top:`${x}px`,border:"1px solid #000",width:`${C+2}px`,height:`${S+2}px`};P.left=`${B}px`;for(const[G,J]of Object.entries(P))this.spritePlaceholder.style.setProperty(G,J)})}resetMouseTooltip(){this.spritePlaceholder&&(this.spritePlaceholder.style.cssText="")}isReady(){return this.mouseTimeTooltip&&this.width&&this.height&&this.url}}X.registerPlugin("storyboard",K_);const q_=X.getComponent("Button"),Yg=class no extends q_{constructor(e,t){super(e,t),this.theaterButtonOptions=t;const i=Og();i===!0&&(this.player().addClass(no.THEATER_MODE_CLASS),this.handleTheaterChange()),this.controlText("Theater mode"),this.player().theaterEnabled=i,this.updateShowing(),this.player().on("video-change",()=>this.updateShowing())}buildCSSClass(){return`vjs-theater-control ${super.buildCSSClass()}`}handleTheaterChange(){const e=this.isTheaterEnabled();e?this.controlText("Normal mode"):this.controlText("Theater mode"),Ng(e),this.player_.trigger("theater-change",e)}handleClick(){this.player_.toggleClass(no.THEATER_MODE_CLASS),this.handleTheaterChange()}isTheaterEnabled(){return this.player_.hasClass(no.THEATER_MODE_CLASS)}updateShowing(){this.theaterButtonOptions.isDisplayed()?this.show():this.hide()}};Qe(Yg,"THEATER_MODE_CLASS","vjs-theater-enabled");let W_=Yg;X.registerComponent("TheaterButton",W_);const z_=X.getComponent("TimeTooltip");class Y_ extends z_{write(e){var t;const i=this.player();if(i.usingPlugin("chapters")){if(e===this.currentTimecode)return;this.currentTimecode=e;const{title:s,fixedTimecode:r}=i.chapters().getChapter(ro(this.currentTimecode));if(s){const a=r?X.formatTime(r,(t=this.player())==null?void 0:t.duration()):this.currentTimecode;return super.write(s+`\r
`+a)}}return super.write(e)}}X.registerComponent("TimeTooltip",Y_);const X_=X.getComponent("Component");class Xg extends X_{constructor(e,t){super(e,t)}createEl(){const e=super.createEl("div",{className:"peertube-dock"});if(this.options_.avatarUrl){const i=X.dom.createEl("img",{className:"peertube-dock-avatar",src:this.options_.avatarUrl},{alt:""});e.appendChild(i)}const t=super.createEl("div",{className:"peertube-dock-title-description"});if(this.options_.title){const i=X.dom.createEl("h2",{className:"peertube-dock-title",title:this.options_.title,innerText:this.options_.title});t.appendChild(i)}if(this.options_.description){const i=X.dom.createEl("div",{className:"peertube-dock-description",title:this.options_.description,innerText:this.options_.description});t.appendChild(i)}return(this.options_.title||this.options_.description)&&e.appendChild(t),e}}X.registerComponent("PeerTubeDockComponent",Xg);const Q_=X.getPlugin("plugin");class J_ extends Q_{constructor(e,t){super(e,t),e.ready(()=>{e.addClass("peertube-dock")}),this.dockComponent=new Xg(e,t),e.addChild(this.dockComponent)}dispose(){var e;(e=this.dockComponent)==null||e.dispose(),this.player.removeChild(this.dockComponent),this.player.removeClass("peertube-dock"),super.dispose()}}X.registerPlugin("peertubeDock",J_);const Z_=X.getComponent("Component");class Qg extends Z_{constructor(e,t){super(e,t)}createEl(){const e=super.createEl("div",{className:"nsfw-container"}),t=super.createEl("div",{className:"nsfw-title"});t.textContent=this.player().localize("Sensitive content");const i=super.createEl("div",{className:"nsfw-content"});if(i.textContent=this.player().localize("This video contains sensitive content."),e.appendChild(t),e.appendChild(i),this.options_.flags||this.options_.summary){const s=super.createEl("button",{textContent:this.player().localize("Learn more")},{type:"button"});e.appendChild(s),s.addEventListener("click",()=>{this.appendMoreContent(),s.style.display="none"})}return e}appendMoreContent(){const e=super.createEl("div",{className:"nsfw-more-content"});if(this.options_.flags){const t=super.createEl("div",{className:"nsfw-more-flags"});t.appendChild(super.createEl("strong",{textContent:this.player().localize("Content warning")})),t.appendChild(super.createEl("div",{textContent:this.buildFlagStrings().join(" - ")})),e.appendChild(t)}if(this.options_.summary){const t=super.createEl("div",{className:"nsfw-more-summary"});t.appendChild(super.createEl("strong",{textContent:"Author note"})),t.appendChild(super.createEl("div",{textContent:this.options_.summary})),e.appendChild(t)}this.el().appendChild(e)}buildFlagStrings(){const e=this.options_.flags,t=[];return(e&Ra.VIOLENT)===Ra.VIOLENT&&t.push(this.player().localize("Violence")),(e&Ra.EXPLICIT_SEX)===Ra.EXPLICIT_SEX&&t.push(this.player().localize("Explicit Sex")),t}}X.registerComponent("PeerTubeNSFWComponent",Qg);const eE=X.getPlugin("plugin");class tE extends eE{constructor(e,t){super(e,t),e.ready(()=>{e.addClass("peertube-nsfw"),this.nsfwComponent=new Qg(e,t),e.addChild(this.nsfwComponent)}),e.one("play",()=>{this.nsfwComponent.hide()})}dispose(){var e;(e=this.nsfwComponent)==null||e.dispose(),this.player.removeChild(this.nsfwComponent),this.player.removeClass("peertube-nsfw"),super.dispose()}}X.registerPlugin("peertubeNSFW",tE);const iE=X.getPlugin("plugin"),Yh=class Ln extends iE{constructor(e,t){super(e,t),this.isLive=t.isLive,this.handlers=this.buildHandlers(),this.handleKeyFunction=i=>this.onKeyDown(i),document.addEventListener("keydown",this.handleKeyFunction)}dispose(){document.removeEventListener("keydown",this.handleKeyFunction),super.dispose()}onKeyDown(e){if(this.isValidKeyTarget(e.target)){for(const t of this.handlers)if(t.accept(e)){t.cb(e);return}}}buildHandlers(){const e=[{accept:t=>t.key===" "||t.key==="MediaPlayPause",cb:t=>{t.preventDefault(),t.stopPropagation(),this.player.paused()?this.player.play():this.player.pause()}},{accept:t=>this.isNaked(t,"ArrowUp"),cb:t=>{t.preventDefault(),this.player.volume(this.player.volume()+Ln.VOLUME_STEP)}},{accept:t=>this.isNaked(t,"ArrowDown"),cb:t=>{t.preventDefault(),this.player.volume(this.player.volume()-Ln.VOLUME_STEP)}},{accept:t=>this.isNaked(t,"f")||!t.altKey&&t.ctrlKey&&t.key==="Enter",cb:t=>{t.preventDefault(),this.player.isFullscreen()?this.player.exitFullscreen():this.player.requestFullscreen()}},{accept:t=>this.isNaked(t,"m"),cb:t=>{t.preventDefault(),this.player.muted(!this.player.muted())}},{accept:t=>t.key===">",cb:()=>{if(this.isLive)return;const t=Math.min(this.player.playbackRate()+.1,5);this.player.playbackRate(parseFloat(t.toFixed(2)))}},{accept:t=>t.key==="<",cb:()=>{if(this.isLive)return;const t=Math.max(this.player.playbackRate()-.1,.1);this.player.playbackRate(parseFloat(t.toFixed(2)))}},{accept:t=>t.key===",",cb:()=>{if(this.isLive)return;this.player.pause();const t=1/30;this.player.currentTime(this.player.currentTime()-t)}},{accept:t=>t.key===".",cb:()=>{if(this.isLive)return;this.player.pause();const t=1/30;this.player.currentTime(this.player.currentTime()+t)}}];return this.isLive?e:e.concat(this.buildVODHandlers())}buildVODHandlers(){const e=[{accept:t=>this.isNaked(t,"ArrowLeft")||this.isNaked(t,"MediaRewind"),cb:t=>{if(this.isLive)return;t.preventDefault();const i=Math.max(0,this.player.currentTime()-Ln.SEEK_STEP);this.player.currentTime(i)}},{accept:t=>this.isNaked(t,"ArrowRight")||this.isNaked(t,"MediaForward"),cb:t=>{if(this.isLive)return;t.preventDefault();const i=Math.min(this.player.duration(),this.player.currentTime()+Ln.SEEK_STEP);this.player.currentTime(i)}}];for(let t=0;t<10;t++)e.push({accept:i=>this.isNakedOrShift(i,t+""),cb:i=>{this.isLive||(i.preventDefault(),this.player.currentTime(this.player.duration()*t*.1))}});return e}isValidKeyTarget(e){const t=this.player.el(),i=document.activeElement,s=e.tagName.toLowerCase();return i===t||i===t.querySelector(".vjs-tech")||i===t.querySelector(".vjs-control-bar")||e.id==="content"||s==="body"||s==="video"}isNaked(e,t){return t.length===1&&(t=t.toUpperCase()),!e.ctrlKey&&!e.altKey&&!e.metaKey&&!e.shiftKey&&this.getLatinKey(e.key,e.code)===t}isNakedOrShift(e,t){return!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.key===t}getLatinKey(e,t){if(e.length!==1)return e;if(e.charCodeAt(0)>=880){if(t.startsWith("Key")&&t.length===4)return t.charAt(3);if(t.startsWith("Digit")&&t.length===6)return t.charAt(5)}return e.toUpperCase()}};Qe(Yh,"VOLUME_STEP",.1);Qe(Yh,"SEEK_STEP",5);let sE=Yh;X.registerPlugin("peerTubeHotkeysPlugin",sE);function rE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Jg={exports:{}},Tt=Jg.exports={},Fi,Ni;function lh(){throw new Error("setTimeout has not been defined")}function uh(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Fi=setTimeout:Fi=lh}catch{Fi=lh}try{typeof clearTimeout=="function"?Ni=clearTimeout:Ni=uh}catch{Ni=uh}})();function Zg(n){if(Fi===setTimeout)return setTimeout(n,0);if((Fi===lh||!Fi)&&setTimeout)return Fi=setTimeout,setTimeout(n,0);try{return Fi(n,0)}catch{try{return Fi.call(null,n,0)}catch{return Fi.call(this,n,0)}}}function nE(n){if(Ni===clearTimeout)return clearTimeout(n);if((Ni===uh||!Ni)&&clearTimeout)return Ni=clearTimeout,clearTimeout(n);try{return Ni(n)}catch{try{return Ni.call(null,n)}catch{return Ni.call(this,n)}}}var rs=[],Br=!1,sr,ao=-1;function aE(){!Br||!sr||(Br=!1,sr.length?rs=sr.concat(rs):ao=-1,rs.length&&em())}function em(){if(!Br){var n=Zg(aE);Br=!0;for(var e=rs.length;e;){for(sr=rs,rs=[];++ao<e;)sr&&sr[ao].run();ao=-1,e=rs.length}sr=null,Br=!1,nE(n)}}Tt.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];rs.push(new tm(n,e)),rs.length===1&&!Br&&Zg(em)};function tm(n,e){this.fun=n,this.array=e}tm.prototype.run=function(){this.fun.apply(null,this.array)};Tt.title="browser";Tt.browser=!0;Tt.env={};Tt.argv=[];Tt.version="";Tt.versions={};function cs(){}Tt.on=cs;Tt.addListener=cs;Tt.once=cs;Tt.off=cs;Tt.removeListener=cs;Tt.removeAllListeners=cs;Tt.emit=cs;Tt.prependListener=cs;Tt.prependOnceListener=cs;Tt.listeners=function(n){return[]};Tt.binding=function(n){throw new Error("process.binding is not supported")};Tt.cwd=function(){return"/"};Tt.chdir=function(n){throw new Error("process.chdir is not supported")};Tt.umask=function(){return 0};var oE=Jg.exports;const au=rE(oE);var xa={exports:{}},ou,Zd;function lE(){if(Zd)return ou;Zd=1;var n=1e3,e=n*60,t=e*60,i=t*24,s=i*7,r=i*365.25;ou=function(f,p){p=p||{};var m=typeof f;if(m==="string"&&f.length>0)return a(f);if(m==="number"&&isFinite(f))return p.long?c(f):l(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function a(f){if(f=String(f),!(f.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(p){var m=parseFloat(p[1]),_=(p[2]||"ms").toLowerCase();switch(_){case"years":case"year":case"yrs":case"yr":case"y":return m*r;case"weeks":case"week":case"w":return m*s;case"days":case"day":case"d":return m*i;case"hours":case"hour":case"hrs":case"hr":case"h":return m*t;case"minutes":case"minute":case"mins":case"min":case"m":return m*e;case"seconds":case"second":case"secs":case"sec":case"s":return m*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return m;default:return}}}}function l(f){var p=Math.abs(f);return p>=i?Math.round(f/i)+"d":p>=t?Math.round(f/t)+"h":p>=e?Math.round(f/e)+"m":p>=n?Math.round(f/n)+"s":f+"ms"}function c(f){var p=Math.abs(f);return p>=i?h(f,p,i,"day"):p>=t?h(f,p,t,"hour"):p>=e?h(f,p,e,"minute"):p>=n?h(f,p,n,"second"):f+" ms"}function h(f,p,m,_){var E=p>=m*1.5;return Math.round(f/m)+" "+_+(E?"s":"")}return ou}var lu,ef;function uE(){if(ef)return lu;ef=1;function n(e){i.debug=i,i.default=i,i.coerce=h,i.disable=l,i.enable=r,i.enabled=c,i.humanize=lE(),i.destroy=f,Object.keys(e).forEach(p=>{i[p]=e[p]}),i.names=[],i.skips=[],i.formatters={};function t(p){let m=0;for(let _=0;_<p.length;_++)m=(m<<5)-m+p.charCodeAt(_),m|=0;return i.colors[Math.abs(m)%i.colors.length]}i.selectColor=t;function i(p){let m,_=null,E,C;function S(...I){if(!S.enabled)return;const R=S,k=Number(new Date),D=k-(m||k);R.diff=D,R.prev=m,R.curr=k,m=k,I[0]=i.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let x=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(B,H)=>{if(B==="%%")return"%";x++;const O=i.formatters[H];if(typeof O=="function"){const P=I[x];B=O.call(R,P),I.splice(x,1),x--}return B}),i.formatArgs.call(R,I),(R.log||i.log).apply(R,I)}return S.namespace=p,S.useColors=i.useColors(),S.color=i.selectColor(p),S.extend=s,S.destroy=i.destroy,Object.defineProperty(S,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(E!==i.namespaces&&(E=i.namespaces,C=i.enabled(p)),C),set:I=>{_=I}}),typeof i.init=="function"&&i.init(S),S}function s(p,m){const _=i(this.namespace+(typeof m>"u"?":":m)+p);return _.log=this.log,_}function r(p){i.save(p),i.namespaces=p,i.names=[],i.skips=[];const m=(typeof p=="string"?p:"").trim().replace(" ",",").split(",").filter(Boolean);for(const _ of m)_[0]==="-"?i.skips.push(_.slice(1)):i.names.push(_)}function a(p,m){let _=0,E=0,C=-1,S=0;for(;_<p.length;)if(E<m.length&&(m[E]===p[_]||m[E]==="*"))m[E]==="*"?(C=E,S=_,E++):(_++,E++);else if(C!==-1)E=C+1,S++,_=S;else return!1;for(;E<m.length&&m[E]==="*";)E++;return E===m.length}function l(){const p=[...i.names,...i.skips.map(m=>"-"+m)].join(",");return i.enable(""),p}function c(p){for(const m of i.skips)if(a(p,m))return!1;for(const m of i.names)if(a(p,m))return!0;return!1}function h(p){return p instanceof Error?p.stack||p.message:p}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return i.enable(i.load()),i}return lu=n,lu}var tf;function hE(){return tf||(tf=1,function(n,e){e.formatArgs=i,e.save=s,e.load=r,e.useColors=t,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;c.splice(1,0,h,"color: inherit");let f=0,p=0;c[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(f++,m==="%c"&&(p=f))}),c.splice(p,0,h)}e.log=console.debug||console.log||(()=>{});function s(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function r(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof au<"u"&&"env"in au&&(c=au.env.DEBUG),c}function a(){try{return localStorage}catch{}}n.exports=uE()(e);const{formatters:l}=n.exports;l.j=function(c){try{return JSON.stringify(c)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}(xa,xa.exports)),xa.exports}var cE=hE();const ds=kg(cE),vn=ds("peertube:player:metrics"),dE=X.getPlugin("plugin");class fE extends dE{constructor(e,t){super(e),this.options_=t,this.downloadedBytesP2P=0,this.downloadedBytesHTTP=0,this.uploadedBytesP2P=0,this.resolutionChanges=0,this.errors=0,this.bufferStalled=0,this.p2pPeers=0,this.trackBytes(),this.trackResolutionChange(),this.trackErrors(),this.trackBufferStalled(),this.one("play",()=>{this.player.on("video-change",()=>{this.runMetricsIntervalOnPlay()})}),this.runMetricsIntervalOnPlay()}dispose(){this.metricsInterval&&clearInterval(this.metricsInterval),super.dispose()}runMetricsIntervalOnPlay(){this.downloadedBytesP2P=0,this.downloadedBytesHTTP=0,this.uploadedBytesP2P=0,this.resolutionChanges=0,this.errors=0,this.bufferStalled=0,this.lastPlayerNetworkInfo=void 0,vn("Will track metrics on next play"),this.player.one("play",()=>{vn("Tracking metrics"),this.runMetricsInterval()})}runMetricsInterval(){this.metricsInterval&&clearInterval(this.metricsInterval),this.options_.metricsUrl()&&(this.metricsInterval=setInterval(()=>{let e,t;if(this.player.usingPlugin("p2pMediaLoader")){const r=this.player.p2pMediaLoader().getCurrentLevel();if(!r)return;e=Math.min(r.height||0,r.width||0);const a=r?.attrs["FRAME-RATE"];t=a?parseInt(a,10):void 0}else if(this.player.usingPlugin("webVideo")){const r=this.player.webVideo().getCurrentVideoFile();if(!r)return;e=r.resolution.id,t=r.fps&&r.fps!==-1?r.fps:void 0}else return;const i={resolution:e,fps:t,playerMode:this.options_.mode(),resolutionChanges:this.resolutionChanges,errors:this.errors,bufferStalled:this.bufferStalled,downloadedBytesHTTP:this.downloadedBytesHTTP,downloadedBytesP2P:this.downloadedBytesP2P,uploadedBytesP2P:this.uploadedBytesP2P,p2pPeers:this.p2pPeers,p2pEnabled:this.p2pEnabled,videoId:this.options_.videoUUID()};this.resolutionChanges=0,this.downloadedBytesP2P=0,this.downloadedBytesHTTP=0,this.uploadedBytesP2P=0,this.errors=0,this.bufferStalled=0;const s=new Headers({"Content-type":"application/json; charset=UTF-8"});return fetch(this.options_.metricsUrl(),{method:"POST",body:JSON.stringify(i),headers:s}).catch(r=>ze.clientWarn("Cannot send metrics to the server.",r))},this.options_.metricsInterval()))}trackBytes(){this.player.on("network-info",(e,t)=>{var i,s,r,a,l,c,h,f;this.downloadedBytesHTTP+=Math.max(Math.round(t.http.downloaded-(((i=this.lastPlayerNetworkInfo)==null?void 0:i.http.downloaded)||0)),0),this.downloadedBytesP2P+=Math.max(Math.round((((s=t.p2p)==null?void 0:s.downloaded)||0)-(((a=(r=this.lastPlayerNetworkInfo)==null?void 0:r.p2p)==null?void 0:a.downloaded)||0)),0),this.uploadedBytesP2P+=Math.max(Math.round((((l=t.p2p)==null?void 0:l.uploaded)||0)-(((h=(c=this.lastPlayerNetworkInfo)==null?void 0:c.p2p)==null?void 0:h.uploaded)||0)),0),this.p2pPeers=(f=t.p2p)==null?void 0:f.peersP2POnly,this.p2pEnabled=!!t.p2p,this.lastPlayerNetworkInfo=t})}trackResolutionChange(){this.player.on("resolution-change",(e,{initResolutionChange:t})=>{t!==!0&&(vn("Adding resolution change"),this.resolutionChanges++)})}trackErrors(){this.player.on("error",()=>{vn("Adding player error"),this.errors++})}trackBufferStalled(){this.player.on("buffer-stalled",()=>{vn("Adding buffer stalled"),this.bufferStalled++})}}X.registerPlugin("metrics",fE);const pE=X.getComponent("Component");class gE extends pE{createEl(){const e=super.createEl("div",{className:"vjs-mobile-buttons-overlay"});this.mainButton=super.createEl("div",{className:"main-button"}),this.touchStartHandler=t=>{if(t.stopPropagation(),this.player_.paused()||this.player_.ended()){this.player_.play();return}this.player_.pause()},this.mainButton.addEventListener("touchstart",this.touchStartHandler,{passive:!0}),this.rewind=super.createEl("div",{className:"rewind-button vjs-hidden"}),this.forward=super.createEl("div",{className:"forward-button vjs-hidden"});for(let t=0;t<3;t++)this.rewind.appendChild(super.createEl("span",{className:"icon"})),this.forward.appendChild(super.createEl("span",{className:"icon"}));return this.rewindText=this.rewind.appendChild(super.createEl("div",{className:"text"})),this.forwardText=this.forward.appendChild(super.createEl("div",{className:"text"})),e.appendChild(this.rewind),e.appendChild(this.mainButton),e.appendChild(this.forward),e}dispose(){this.touchStartHandler&&this.mainButton.removeEventListener("touchstart",this.touchStartHandler),super.dispose()}displayFastSeek(e){if(e===0){this.hideRewind(),this.hideForward();return}if(e>0){this.hideRewind(),this.displayForward(e);return}if(e<0){this.hideForward(),this.displayRewind(e);return}}hideRewind(){this.rewind.classList.add("vjs-hidden"),this.rewindText.textContent=""}displayRewind(e){this.rewind.classList.remove("vjs-hidden"),this.rewindText.textContent=this.player().localize("{1} seconds",[e+""])}hideForward(){this.forward.classList.add("vjs-hidden"),this.forwardText.textContent=""}displayForward(e){this.forward.classList.remove("vjs-hidden"),this.forwardText.textContent=this.player().localize("{1} seconds",[e+""])}}X.registerComponent("PeerTubeMobileButtons",gE);const wr=ds("peertube:player:mobile"),mE=X.getPlugin("plugin"),Xh=class oo extends mE{constructor(e,t){super(e,t),this.seekAmount=0,X.browser.IS_ANDROID&&screen.orientation&&this.handleFullscreenRotation(),e.controls()&&(this.peerTubeMobileButtons=e.addChild("PeerTubeMobileButtons",{reportTouchActivity:!1}),this.player.options_.userActions||(this.player.options_.userActions={}),this.player.options_.userActions.click=!1,this.player.options_.userActions.doubleClick=!1,this.onPlayHandler=()=>this.initTouchStartEvents(),this.player.one("play",this.onPlayHandler),this.seekBar=this.player.getDescendant(["controlBar","progressControl","seekBar"]),this.sliderActiveHandler=()=>this.player.addClass("vjs-mobile-sliding"),this.sliderInactiveHandler=()=>this.player.removeClass("vjs-mobile-sliding"),this.seekBar.on("slideractive",this.sliderActiveHandler),this.seekBar.on("sliderinactive",this.sliderInactiveHandler))}dispose(){var e;this.onPlayHandler&&this.player.off("play",this.onPlayHandler),this.onFullScreenChangeHandler&&this.player.off("fullscreenchange",this.onFullScreenChangeHandler),this.onTouchStartHandler&&this.player.off("touchstart",this.onFullScreenChangeHandler),this.onMobileButtonTouchStartHandler&&((e=this.peerTubeMobileButtons)==null||e.el().removeEventListener("touchstart",this.onMobileButtonTouchStartHandler)),super.dispose()}handleFullscreenRotation(){this.onFullScreenChangeHandler=()=>{!this.player.isFullscreen()||this.isPortraitVideo()||screen.orientation.lock("landscape").catch(e=>ze.error("Cannot lock screen to landscape.",e))},this.player.on("fullscreenchange",this.onFullScreenChangeHandler)}isPortraitVideo(){return this.player.videoWidth()<this.player.videoHeight()}initTouchStartEvents(){const e=(t,i=!1)=>{if(wr("Handle touch start"),this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=void 0),this.doubleTapping||this.lastTapEvent&&t.timeStamp-this.lastTapEvent.timeStamp<oo.DOUBLE_TAP_DELAY_MS){wr("Detected double tap"),this.lastTapEvent=t,this.onDoubleTap(t);return}i||(this.newActiveState=!this.player.userActive(),!this.player.paused()&&this.newActiveState===!0&&this.player.addClass("vjs-force-inactive"),this.tapTimeout=setTimeout(()=>{wr("No double tap detected, set user active state to "+this.newActiveState),this.player.removeClass("vjs-force-inactive"),this.player.userActive(this.newActiveState)},oo.DOUBLE_TAP_DELAY_MS),this.lastTapEvent=t)};this.onTouchStartHandler=t=>{const i=this.player.userActive();e(t,i)},this.player.on("touchstart",this.onTouchStartHandler),this.onMobileButtonTouchStartHandler=t=>{t.preventDefault(),t.stopPropagation(),e(t)},this.peerTubeMobileButtons.el().addEventListener("touchstart",this.onMobileButtonTouchStartHandler,{passive:!1})}onDoubleTap(e){const t=this.player.currentWidth(),i=this.findPlayerTarget(e.target).getBoundingClientRect(),s=e.targetTouches[0].pageX-i.left;wr("Calculating double tap zone (player width: %d, offset X: %d)",t,s),s>.66*t?(this.seekAmount<0&&(this.seekAmount=0),this.seekAmount+=10,wr("Will forward %d seconds",this.seekAmount)):s<.33*t&&(this.seekAmount>0&&(this.seekAmount=0),this.seekAmount-=10,wr("Will rewind %d seconds",this.seekAmount)),this.peerTubeMobileButtons.displayFastSeek(this.seekAmount),this.scheduleSetCurrentTime()}findPlayerTarget(e){return e.classList.contains("video-js")?e:this.findPlayerTarget(e.parentElement)}scheduleSetCurrentTime(){this.player.pause(),this.player.addClass("vjs-fast-seeking"),this.doubleTapping=!0,this.setCurrentTimeTimeout&&clearTimeout(this.setCurrentTimeTimeout),this.setCurrentTimeTimeout=setTimeout(()=>{let e=this.player.currentTime()+this.seekAmount;this.seekAmount=0,e=Math.max(0,e),e=Math.min(this.player.duration(),e),this.player.currentTime(e),this.seekAmount=0,this.peerTubeMobileButtons.displayFastSeek(0),this.player.userActive(!1),this.doubleTapping=!1,this.player.play(),setTimeout(()=>{this.player.removeClass("vjs-fast-seeking"),this.player.removeClass("vjs-force-inactive")},100)},oo.SET_CURRENT_TIME_DELAY)}};Qe(Xh,"DOUBLE_TAP_DELAY_MS",250);Qe(Xh,"SET_CURRENT_TIME_DELAY",750);let vE=Xh;X.registerPlugin("peertubeMobile",vE);const we=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},yE=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=TE},TE=Number.MAX_SAFE_INTEGER||9007199254740991;let ke=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),Y=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),L=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var Ge={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ie={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ar{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class _E{constructor(e,t,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ar(e),this.fast_=new Ar(t),this.defaultTTFB_=s,this.ttfb_=new Ar(e)}update(e,t){const{slow_:i,fast_:s,ttfb_:r}=this;i.halfLife!==e&&(this.slow_=new Ar(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Ar(t,s.getEstimate(),s.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Ar(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,s=e/1e3,r=i/s;this.fast_.sample(s,r),this.slow_.sample(s,r)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function EE(n,e,t){return(e=SE(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function st(){return st=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},st.apply(null,arguments)}function sf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function nt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sf(Object(t),!0).forEach(function(i){EE(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):sf(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function bE(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function SE(n){var e=bE(n,"string");return typeof e=="symbol"?e:e+""}class Ai{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=As,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const As=function(){},CE={trace:As,debug:As,log:As,warn:As,info:As,error:As};function hh(){return st({},CE)}function wE(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):As}function rf(n,e,t){return e[n]?e[n].bind(e):wE(n,t)}const ch=hh();function AE(n,e,t){const i=hh();if(typeof console=="object"&&n===!0||typeof n=="object"){const s=["debug","log","info","warn","error"];s.forEach(r=>{i[r]=rf(r,n,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.7`)}catch{return hh()}s.forEach(r=>{ch[r]=rf(r,n)})}else st(ch,i);return i}const Ze=ch;function Ns(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function IE(n){return typeof self<"u"&&n===self.ManagedMediaSource}function im(n,e){const t=Object.keys(n),i=Object.keys(e),s=t.length,r=i.length;return!s||!r||s===r&&!t.some(a=>i.indexOf(a)===-1)}function si(n,e=!1){if(typeof TextDecoder<"u"){const h=new TextDecoder("utf-8").decode(n);if(e){const f=h.indexOf("\0");return f!==-1?h.substring(0,f):h}return h.replace(/\0/g,"")}const t=n.length;let i,s,r,a="",l=0;for(;l<t;){if(i=n[l++],i===0&&e)return a;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=n[l++],a+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=n[l++],r=n[l++],a+=String.fromCharCode((i&15)<<12|(s&63)<<6|(r&63)<<0);break}}return a}const er={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let i=n[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}};function sm(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function LE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var uu={exports:{}},nf;function kE(){return nf||(nf=1,function(n,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,l={buildAbsoluteURL:function(c,h,f){if(f=f||{},c=c.trim(),h=h.trim(),!h){if(!f.alwaysNormalize)return c;var p=l.parseURL(c);if(!p)throw new Error("Error trying to parse base URL.");return p.path=l.normalizePath(p.path),l.buildURLFromParts(p)}var m=l.parseURL(h);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return f.alwaysNormalize?(m.path=l.normalizePath(m.path),l.buildURLFromParts(m)):h;var _=l.parseURL(c);if(!_)throw new Error("Error trying to parse base URL.");if(!_.netLoc&&_.path&&_.path[0]!=="/"){var E=s.exec(_.path);_.netLoc=E[1],_.path=E[2]}_.netLoc&&!_.path&&(_.path="/");var C={scheme:_.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(C.netLoc=_.netLoc,m.path[0]!=="/"))if(!m.path)C.path=_.path,m.params||(C.params=_.params,m.query||(C.query=_.query));else{var S=_.path,I=S.substring(0,S.lastIndexOf("/")+1)+m.path;C.path=l.normalizePath(I)}return C.path===null&&(C.path=f.alwaysNormalize?l.normalizePath(m.path):m.path),l.buildURLFromParts(C)},parseURL:function(c){var h=i.exec(c);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(r,"");c.length!==(c=c.replace(a,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}};n.exports=l})()}(uu)),uu.exports}var Qh=kE();class Jh{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ut={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class rm{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,PE(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let s;i.length===1?s=t?.byteRangeEndOffset||0:s=parseInt(i[1]),this._byteRange=[s,parseInt(i[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ut.AUDIO]:null,[ut.VIDEO]:null,[ut.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Jh),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Qh.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ut.AUDIO]=null,e[ut.VIDEO]=null,e[ut.AUDIOVIDEO]=null}}function At(n){return n.sn!=="initSegment"}class hu extends rm{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(we(e)&&we(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=we(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!we(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return At(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,s,r,a=!1){const{elementaryStreams:l}=this,c=l[e];if(!c){l[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:r,partial:a};return}c.startPTS=Math.min(c.startPTS,t),c.endPTS=Math.max(c.endPTS,i),c.startDTS=Math.min(c.startDTS,s),c.endDTS=Math.max(c.endDTS,r)}}class RE extends rm{constructor(e,t,i,s,r){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function nm(n,e){const t=Object.getPrototypeOf(n);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||nm(t,e)}}function PE(n,e){const t=nm(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const af=Math.pow(2,32)-1,DE=[].push,am={video:1,audio:2,id3:3,text:4};function xt(n){return String.fromCharCode.apply(null,n)}function om(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function Ne(n,e){const t=lm(n,e);return t<0?4294967296+t:t}function of(n,e){let t=Ne(n,e);return t*=Math.pow(2,32),t+=Ne(n,e+4),t}function lm(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function xE(n){const e=n.byteLength;for(let t=0;t<e;){const i=Ne(n,t);if(i>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=i>1?t+i:e}return!1}function je(n,e){const t=[];if(!e.length)return t;const i=n.byteLength;for(let s=0;s<i;){const r=Ne(n,s),a=xt(n.subarray(s+4,s+8)),l=r>1?s+r:i;if(a===e[0])if(e.length===1)t.push(n.subarray(s+8,l));else{const c=je(n.subarray(s+8,l),e.slice(1));c.length&&DE.apply(t,c)}s=l}return t}function OE(n){const e=[],t=n[0];let i=8;const s=Ne(n,i);i+=4;let r=0,a=0;t===0?(r=Ne(n,i),a=Ne(n,i+4),i+=8):(r=of(n,i),a=of(n,i+8),i+=16),i+=2;let l=n.length+a;const c=om(n,i);i+=2;for(let h=0;h<c;h++){let f=i;const p=Ne(n,f);f+=4;const m=p&2147483647;if((p&2147483648)>>>31===1)return Ze.warn("SIDX has hierarchical references (not supported)"),null;const E=Ne(n,f);f+=4,e.push({referenceSize:m,subsegmentDuration:E,info:{duration:E/s,start:l,end:l+m-1}}),l+=m,f+=4,i=f}return{earliestPresentationTime:r,timescale:s,version:t,referencesCount:c,references:e}}function um(n){const e=[],t=je(n,["moov","trak"]);for(let s=0;s<t.length;s++){const r=t[s],a=je(r,["tkhd"])[0];if(a){let l=a[0];const c=Ne(a,l===0?12:20),h=je(r,["mdia","mdhd"])[0];if(h){l=h[0];const f=Ne(h,l===0?12:20),p=je(r,["mdia","hdlr"])[0];if(p){const m=xt(p.subarray(8,12)),_={soun:ut.AUDIO,vide:ut.VIDEO}[m],E=je(r,["mdia","minf","stbl","stsd"])[0],C=ME(E);_?(e[c]={timescale:f,type:_,stsd:C},e[_]=nt({timescale:f,id:c},C)):e[c]={timescale:f,type:m,stsd:C}}}}}return je(n,["moov","mvex","trex"]).forEach(s=>{const r=Ne(s,4),a=e[r];a&&(a.default={duration:Ne(s,12),flags:Ne(s,20)})}),e}function ME(n){const e=n.subarray(8),t=e.subarray(86),i=xt(e.subarray(4,8));let s=i,r;const a=i==="enca"||i==="encv";if(a){const h=je(e,[i])[0].subarray(i==="enca"?28:78);je(h,["sinf"]).forEach(p=>{const m=je(p,["schm"])[0];if(m){const _=xt(m.subarray(4,8));if(_==="cbcs"||_==="cenc"){const E=je(p,["frma"])[0];E&&(s=xt(E))}}})}const l=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const c=je(t,["avcC"])[0];c&&c.length>3&&(s+="."+Ma(c[1])+Ma(c[2])+Ma(c[3]),r=Oa(l==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const c=je(e,[i])[0],h=je(c.subarray(28),["esds"])[0];if(h&&h.length>7){let f=4;if(h[f++]!==3)break;f=cu(h,f),f+=2;const p=h[f++];if(p&128&&(f+=2),p&64&&(f+=h[f++]),h[f++]!==4)break;f=cu(h,f);const m=h[f++];if(m===64)s+="."+Ma(m);else break;if(f+=12,h[f++]!==5)break;f=cu(h,f);const _=h[f++];let E=(_&248)>>3;E===31&&(E+=1+((_&7)<<3)+((h[f]&224)>>5)),s+="."+E}break}case"hvc1":case"hev1":{const c=je(t,["hvcC"])[0];if(c&&c.length>12){const h=c[1],f=["","A","B","C"][h>>6],p=h&31,m=Ne(c,2),_=(h&32)>>5?"H":"L",E=c[12],C=c.subarray(6,12);s+="."+f+p,s+="."+FE(m).toString(16).toUpperCase(),s+="."+_+E;let S="";for(let I=C.length;I--;){const R=C[I];(R||S)&&(S="."+R.toString(16).toUpperCase()+S)}s+=S}r=Oa(l=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=Oa(s,t)||s;break}case"vp09":{const c=je(t,["vpcC"])[0];if(c&&c.length>6){const h=c[4],f=c[5],p=c[6]>>4&15;s+="."+Mi(h)+"."+Mi(f)+"."+Mi(p)}break}case"av01":{const c=je(t,["av1C"])[0];if(c&&c.length>2){const h=c[1]>>>5,f=c[1]&31,p=c[2]>>>7?"H":"M",m=(c[2]&64)>>6,_=(c[2]&32)>>5,E=h===2&&m?_?12:10:m?10:8,C=(c[2]&16)>>4,S=(c[2]&8)>>3,I=(c[2]&4)>>2,R=c[2]&3;s+="."+h+"."+Mi(f)+p+"."+Mi(E)+"."+C+"."+S+I+R+"."+Mi(1)+"."+Mi(1)+"."+Mi(1)+"."+0,r=Oa("dav1",t)}break}}return{codec:s,encrypted:a,supplemental:r}}function Oa(n,e){const t=je(e,["dvvC"]),i=t.length?t[0]:je(e,["dvcC"])[0];if(i){const s=i[2]>>1&127,r=i[2]<<5&32|i[3]>>3&31;return n+"."+Mi(s)+"."+Mi(r)}}function FE(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function cu(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Ma(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Mi(n){return(n<10?"0":"")+n}function NE(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&je(n,["moov","trak"]).forEach(s=>{const a=je(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let l=je(a,["enca"]);const c=l.length>0;c||(l=je(a,["encv"])),l.forEach(h=>{const f=c?h.subarray(28):h.subarray(78);je(f,["sinf"]).forEach(m=>{const _=BE(m);if(_){const E=_.subarray(8,24);E.some(C=>C!==0)||(Ze.log(`[eme] Patching keyId in 'enc${c?"a":"v"}>sinf>>tenc' box: ${er.hexDump(E)} -> ${er.hexDump(t)}`),_.set(t,8))}})})}),n}function BE(n){const e=je(n,["schm"])[0];if(e){const t=xt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return je(n,["schi","tenc"])[0]}return null}function UE(n,e,t){const i={},s=je(n,["moof","traf"]);for(let r=0;r<s.length;r++){const a=s[r],l=je(a,["tfhd"])[0],c=Ne(l,4),h=e[c];if(!h)continue;const f=i[c]||(i[c]={start:NaN,duration:0,sampleCount:0,timescale:h.timescale,type:h.type}),p=je(a,["tfdt"])[0];if(p){const k=p[0];let D=Ne(p,4);k===1&&(D===af?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(D*=af+1,D+=Ne(p,8))),we(D)&&(!we(f.start)||D<f.start)&&(f.start=D)}const m=h.default,_=Ne(l,0)|m?.flags;let E=m?.duration||0;_&8&&(_&2?E=Ne(l,12):E=Ne(l,8));const C=je(a,["trun"]);let S=f.start||0,I=0,R=E;for(let k=0;k<C.length;k++){const D=C[k],x=Ne(D,4),N=f.sampleCount;f.sampleCount+=x;const B=D[3]&1,H=D[3]&4,O=D[2]&1,P=D[2]&2,G=D[2]&4,J=D[2]&8;let se=8,ie=x;for(B&&(se+=4),H&&x&&(!(D[se+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=N),se+=4,O?(R=Ne(D,se),se+=4):R=E,P&&(se+=4),J&&(se+=4),S+=R,I+=R,ie--);ie--;)O?(R=Ne(D,se),se+=4):R=E,P&&(se+=4),G&&(D[se+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(ie+1),f.keyFrameStart=S),se+=4),J&&(se+=4),S+=R,I+=R;!I&&E&&(I+=E*x)}f.duration+=I}if(!Object.keys(i).some(r=>i[r].duration)){let r=1/0,a=0;const l=je(n,["sidx"]);for(let c=0;c<l.length;c++){const h=OE(l[c]);if(h!=null&&h.references){r=Math.min(r,h.earliestPresentationTime/h.timescale);const f=h.references.reduce((p,m)=>p+m.info.duration||0,0);a=Math.max(a,f+h.earliestPresentationTime/h.timescale)}}a&&we(a)&&Object.keys(i).forEach(c=>{i[c].duration||(i[c].duration=a*i[c].timescale-i[c].start)})}return i}function $E(n){const e={valid:null,remainder:null},t=je(n,["moof"]);if(t.length<2)return e.remainder=n,e;const i=t[t.length-1];return e.valid=n.slice(0,i.byteOffset-8),e.remainder=n.slice(i.byteOffset-8),e}function gi(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function lf(n,e){const t=[],i=e.samples,s=e.timescale,r=e.id;let a=!1;return je(i,["moof"]).map(c=>{const h=c.byteOffset-8;je(c,["traf"]).map(p=>{const m=je(p,["tfdt"]).map(_=>{const E=_[0];let C=Ne(_,4);return E===1&&(C*=Math.pow(2,32),C+=Ne(_,8)),C/s})[0];return m!==void 0&&(n=m),je(p,["tfhd"]).map(_=>{const E=Ne(_,4),C=Ne(_,0)&16777215,S=(C&1)!==0,I=(C&2)!==0,R=(C&8)!==0;let k=0;const D=(C&16)!==0;let x=0;const N=(C&32)!==0;let B=8;E===r&&(S&&(B+=8),I&&(B+=4),R&&(k=Ne(_,B),B+=4),D&&(x=Ne(_,B),B+=4),N&&(B+=4),e.type==="video"&&(a=qo(e.codec)),je(p,["trun"]).map(H=>{const O=H[0],P=Ne(H,0)&16777215,G=(P&1)!==0;let J=0;const se=(P&4)!==0,ie=(P&256)!==0;let ne=0;const ae=(P&512)!==0;let fe=0;const ee=(P&1024)!==0,oe=(P&2048)!==0;let re=0;const le=Ne(H,4);let Q=8;G&&(J=Ne(H,Q),Q+=4),se&&(Q+=4);let te=J+h;for(let Se=0;Se<le;Se++){if(ie?(ne=Ne(H,Q),Q+=4):ne=k,ae?(fe=Ne(H,Q),Q+=4):fe=x,ee&&(Q+=4),oe&&(O===0?re=Ne(H,Q):re=lm(H,Q),Q+=4),e.type===ut.VIDEO){let be=0;for(;be<fe;){const Pe=Ne(i,te);if(te+=4,HE(a,i[te])){const Me=i.subarray(te,te+Pe);Zh(Me,a?2:1,n+re/s,t)}te+=Pe,be+=Pe+4}}n+=ne/s}}))})})}),t}function qo(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function HE(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Zh(n,e,t,i){const s=hm(n);let r=0;r+=e;let a=0,l=0,c=0;for(;r<s.length;){a=0;do{if(r>=s.length)break;c=s[r++],a+=c}while(c===255);l=0;do{if(r>=s.length)break;c=s[r++],l+=c}while(c===255);const h=s.length-r;let f=r;if(l<h)r+=l;else if(l>h){Ze.error(`Malformed SEI payload. ${l} is too small, only ${h} bytes left to parse.`);break}if(a===4){if(s[f++]===181){const m=om(s,f);if(f+=2,m===49){const _=Ne(s,f);if(f+=4,_===1195456820){const E=s[f++];if(E===3){const C=s[f++],S=31&C,I=64&C,R=I?2+S*3:0,k=new Uint8Array(R);if(I){k[0]=C;for(let D=1;D<R;D++)k[D]=s[f++]}i.push({type:E,payloadType:a,pts:t,bytes:k})}}}}}else if(a===5&&l>16){const p=[];for(let E=0;E<16;E++){const C=s[f++].toString(16);p.push(C.length==1?"0"+C:C),(E===3||E===5||E===7||E===9)&&p.push("-")}const m=l-16,_=new Uint8Array(m);for(let E=0;E<m;E++)_[E]=s[f++];i.push({payloadType:a,pts:t,uuid:p.join(""),userData:si(_),userDataBytes:_})}}}function hm(n){const e=n.byteLength,t=[];let i=1;for(;i<e-2;)n[i]===0&&n[i+1]===0&&n[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return n;const s=e-t.length,r=new Uint8Array(s);let a=0;for(i=0;i<s;a++,i++)a===t[0]&&(a++,t.shift()),r[i]=n[a];return r}function jE(n){const e=n[0];let t="",i="",s=0,r=0,a=0,l=0,c=0,h=0;if(e===0){for(;xt(n.subarray(h,h+1))!=="\0";)t+=xt(n.subarray(h,h+1)),h+=1;for(t+=xt(n.subarray(h,h+1)),h+=1;xt(n.subarray(h,h+1))!=="\0";)i+=xt(n.subarray(h,h+1)),h+=1;i+=xt(n.subarray(h,h+1)),h+=1,s=Ne(n,12),r=Ne(n,16),l=Ne(n,20),c=Ne(n,24),h=28}else if(e===1){h+=4,s=Ne(n,h),h+=4;const p=Ne(n,h);h+=4;const m=Ne(n,h);for(h+=4,a=2**32*p+m,yE(a)||(a=Number.MAX_SAFE_INTEGER,Ze.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=Ne(n,h),h+=4,c=Ne(n,h),h+=4;xt(n.subarray(h,h+1))!=="\0";)t+=xt(n.subarray(h,h+1)),h+=1;for(t+=xt(n.subarray(h,h+1)),h+=1;xt(n.subarray(h,h+1))!=="\0";)i+=xt(n.subarray(h,h+1)),h+=1;i+=xt(n.subarray(h,h+1)),h+=1}const f=n.subarray(h,n.byteLength);return{schemeIdUri:t,value:i,timeScale:s,presentationTime:a,presentationTimeDelta:r,eventDuration:l,id:c,payload:f}}function VE(n,...e){const t=e.length;let i=8,s=t;for(;s--;)i+=e[s].byteLength;const r=new Uint8Array(i);for(r[0]=i>>24&255,r[1]=i>>16&255,r[2]=i>>8&255,r[3]=i&255,r.set(n,4),s=0,i=8;s<t;s++)r.set(e[s],i),i+=e[s].byteLength;return r}function GE(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let i,s;i=0,s=new Uint8Array;let r;i>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),VE([112,115,115,104],new Uint8Array([i,0,0,0]),n,r,s,a,t||new Uint8Array)}const cm=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),qr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ec(n,e){const t=qr[e];return!!t&&!!t[n.slice(0,4)]}function dh(n,e,t=!0){return!n.split(",").some(i=>!tc(i,e,t))}function tc(n,e,t=!0){var i;const s=Ns(t);return(i=s?.isTypeSupported(Bn(n,e)))!=null?i:!1}function Bn(n,e){return`${e}/mp4;codecs=${n}`}function uf(n){if(n){const e=n.substring(0,4);return qr.video[e]}return 2}function wo(n){const e=cm();return n.split(",").reduce((t,i)=>{const r=e&&qo(i)?9:qr.video[i];return r?(r*2+t)/(t?3:2):(qr.audio[i]+t)/(t?2:1)},0)}const du={};function KE(n,e=!0){if(du[n])return du[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let s=0;s<t.length;s++){var i;if(tc(t[s],"audio",e))return du[n]=t[s],t[s];if(t[s]==="mp3"&&(i=Ns(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return n}const qE=/flac|opus|mp4a\.40\.34/i;function Ao(n,e=!0){return n.replace(qE,t=>KE(t.toLowerCase(),e))}function WE(n,e){const t=[];if(n){const i=n.split(",");for(let s=0;s<i.length;s++)ec(i[s],"video")||t.push(i[s])}return e&&t.push(e),t.join(",")}function lo(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(hf(n,"audio")||hf(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let i=t.length;i--;)if(t[i].substring(0,4)===n.substring(0,4))return t[i]}return t[0]}}return e||n}function hf(n,e){return ec(n,e)&&tc(n,e)}function zE(n){const e=n.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function YE(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return n}function cf(n){const e=Ns(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function fh(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const dm={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function fm(n,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:n}}function XE(n,e,t,i,s,r){const a=n.videoCodec,l=n.audioCodec?n.audioGroups:null,c=r?.audioCodec,h=r?.channels,f=h?parseInt(h):c?1/0:2;let p=null;if(l!=null&&l.length)try{l.length===1&&l[0]?p=e.groups[l[0]].channels:p=l.reduce((m,_)=>{if(_){const E=e.groups[_];if(!E)throw new Error(`Audio track group ${_} not found`);Object.keys(E.channels).forEach(C=>{m[C]=(m[C]||0)+E.channels[C]})}return m},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(m=>qo(m))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(i,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!p&&we(f)&&Object.keys(p).some(m=>parseInt(m)>f)}function pm(n,e,t,i={}){const s=n.videoCodec;if(!s&&!n.audioCodec||!t)return Promise.resolve(dm);const r=[],a=QE(n),l=a.length,c=JE(n,e,l>0),h=c.length;for(let f=l||1*h||1;f--;){const p={type:"media-source"};if(l&&(p.video=a[f%l]),h){p.audio=c[f%h];const m=p.audio.bitrate;p.video&&m&&(p.video.bitrate-=m)}r.push(p)}if(s){const f=navigator.userAgent;if(s.split(",").some(p=>qo(p))&&cm())return Promise.resolve(fm(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),r))}return Promise.all(r.map(f=>{const p=eb(f);return i[p]||(i[p]=t.decodingInfo(f))})).then(f=>({supported:!f.some(p=>!p.supported),configurations:r,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:r,decodingInfoResults:[],error:f}))}function QE(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),i=gm(n),s=n.width||640,r=n.height||480,a=n.frameRate||30,l=n.videoRange.toLowerCase();return t?t.map(c=>{const h={contentType:Bn(YE(c),"video"),width:s,height:r,bitrate:i,framerate:a};return l!=="sdr"&&(h.transferFunction=l),h}):[]}function JE(n,e,t){var i;const s=(i=n.audioCodec)==null?void 0:i.split(","),r=gm(n);return s&&n.audioGroups?n.audioGroups.reduce((a,l)=>{var c;const h=l?(c=e.groups[l])==null?void 0:c.tracks:null;return h?h.reduce((f,p)=>{if(p.groupId===l){const m=parseFloat(p.channels||"");s.forEach(_=>{const E={contentType:Bn(_,"audio"),bitrate:t?ZE(_,r):r};m&&(E.channels=""+m),f.push(E)})}return f},a):a},[]):[]}function ZE(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function gm(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function eb(n){let e="";const{audio:t,video:i}=n;if(i){const s=fh(i.contentType);e+=`${s}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const s=fh(t.contentType);e+=`${i?"_":""}${s}_c${t.channels}`}return e}const ph=["NONE","TYPE-0","TYPE-1",null];function tb(n){return ph.indexOf(n)>-1}const Io=["SDR","PQ","HLG"];function ib(n){return!!n&&Io.indexOf(n)>-1}var uo={No:"",Yes:"YES",v2:"v2"};function df(n){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=n,s=i<e/2;return e&&s?t?uo.v2:uo.Yes:uo.No}class ff{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Un{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return pf(this._audioGroups,e)}hasSubtitleGroup(e){return pf(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function pf(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function sb(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function rb(n,e){let t=!1,i=[];if(n&&(t=n!=="SDR",i=[n]),e){i=e.allowedVideoRanges||Io.slice(0);const s=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&sb(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const nb=n=>{const e=new WeakSet;return(t,i)=>{if(n&&(i=n(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},ft=(n,e)=>JSON.stringify(n,nb(e));function ab(n,e,t,i,s){const r=Object.keys(n),a=i?.channels,l=i?.audioCodec,c=s?.videoCodec,h=a&&parseInt(a)===2;let f=!1,p=!1,m=1/0,_=1/0,E=1/0,C=1/0,S=0,I=[];const{preferHDR:R,allowedVideoRanges:k}=rb(e,s);for(let H=r.length;H--;){const O=n[r[H]];f||(f=O.channels[2]>0),m=Math.min(m,O.minHeight),_=Math.min(_,O.minFramerate),E=Math.min(E,O.minBitrate),k.filter(G=>O.videoRanges[G]>0).length>0&&(p=!0)}m=we(m)?m:0,_=we(_)?_:0;const D=Math.max(1080,m),x=Math.max(30,_);E=we(E)?E:t,t=Math.max(E,t),p||(e=void 0);const N=r.length>1;return{codecSet:r.reduce((H,O)=>{const P=n[O];if(O===H)return H;if(I=p?k.filter(G=>P.videoRanges[G]>0):[],N){if(P.minBitrate>t)return xi(O,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),H;if(!P.hasDefaultAudio)return xi(O,"no renditions with default or auto-select sound found"),H;if(l&&O.indexOf(l.substring(0,4))%5!==0)return xi(O,`audio codec preference "${l}" not found`),H;if(a&&!h){if(!P.channels[a])return xi(O,`no renditions with ${a} channel sound found (channels options: ${Object.keys(P.channels)})`),H}else if((!l||h)&&f&&P.channels[2]===0)return xi(O,"no renditions with stereo sound found"),H;if(P.minHeight>D)return xi(O,`min resolution of ${P.minHeight} > maximum of ${D}`),H;if(P.minFramerate>x)return xi(O,`min framerate of ${P.minFramerate} > maximum of ${x}`),H;if(!I.some(G=>P.videoRanges[G]>0))return xi(O,`no variants with VIDEO-RANGE of ${ft(I)} found`),H;if(c&&O.indexOf(c.substring(0,4))%5!==0)return xi(O,`video codec preference "${c}" not found`),H;if(P.maxScore<S)return xi(O,`max score of ${P.maxScore} < selected max of ${S}`),H}return H&&(wo(O)>=wo(H)||P.fragmentError>n[H].fragmentError)?H:(C=P.minIndex,S=P.maxScore,O)},void 0),videoRanges:I,preferHDR:R,minFramerate:_,minBitrate:E,minIndex:C}}function xi(n,e){Ze.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function mm(n){return n.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const s=t.channels||"2";return i.channels[s]=(i.channels[s]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function ob(n,e,t,i){return n.slice(t,i+1).reduce((s,r,a)=>{if(!r.codecSet)return s;const l=r.audioGroups;let c=s[r.codecSet];c||(s[r.codecSet]=c={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!l,fragmentError:0}),c.minBitrate=Math.min(c.minBitrate,r.bitrate);const h=Math.min(r.height,r.width);return c.minHeight=Math.min(c.minHeight,h),c.minFramerate=Math.min(c.minFramerate,r.frameRate),c.minIndex=Math.min(c.minIndex,a),c.maxScore=Math.max(c.maxScore,r.score),c.fragmentError+=r.fragmentError,c.videoRanges[r.videoRange]=(c.videoRanges[r.videoRange]||0)+1,l&&l.forEach(f=>{if(!f)return;const p=e.groups[f];p&&(c.hasDefaultAudio=c.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(m=>{c.channels[m]=(c.channels[m]||0)+p.channels[m]}))}),s},{})}function gf(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:r}=n;return{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:r}}function Vi(n,e,t){if("attrs"in n){const i=e.indexOf(n);if(i!==-1)return i}for(let i=0;i<e.length;i++){const s=e[i];if(nr(n,s,t))return i}return-1}function nr(n,e,t){const{groupId:i,name:s,lang:r,assocLang:a,default:l}=n,c=n.forced;return(i===void 0||e.groupId===i)&&(s===void 0||e.name===s)&&(r===void 0||lb(r,e.lang))&&(r===void 0||e.assocLang===a)&&(l===void 0||e.default===l)&&(c===void 0||e.forced===c)&&(!("characteristics"in n)||ub(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function lb(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function ub(n,e=""){const t=n.split(","),i=e.split(",");return t.length===i.length&&!t.some(s=>i.indexOf(s)===-1)}function Zs(n,e){const{audioCodec:t,channels:i}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function hb(n,e,t,i,s){const r=e[i],l=e.reduce((m,_,E)=>{const C=_.uri;return(m[C]||(m[C]=[])).push(E),m},{})[r.uri];l.length>1&&(i=Math.max.apply(Math,l));const c=r.videoRange,h=r.frameRate,f=r.codecSet.substring(0,4),p=mf(e,i,m=>{if(m.videoRange!==c||m.frameRate!==h||m.codecSet.substring(0,4)!==f)return!1;const _=m.audioGroups,E=t.filter(C=>!_||_.indexOf(C.groupId)!==-1);return Vi(n,E,s)>-1});return p>-1?p:mf(e,i,m=>{const _=m.audioGroups,E=t.filter(C=>!_||_.indexOf(C.groupId)!==-1);return Vi(n,E,s)>-1})}function mf(n,e,t){for(let i=e;i>-1;i--)if(t(n[i]))return i;for(let i=e+1;i<n.length;i++)if(t(n[i]))return i;return-1}function Lo(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class cb extends Ai{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:s,partCurrent:r,hls:a}=this,{autoLevelEnabled:l,media:c}=a;if(!s||!c)return;const h=performance.now(),f=r?r.stats:s.stats,p=r?r.duration:s.duration,m=h-f.loading.start,_=a.minAutoLevel,E=s.level,C=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||E<=_){this.clearTimer(),this._nextAutoLevel=-1;return}if(!l)return;const S=C>-1&&C!==E,I=!!t||S;if(!I&&(c.paused||!c.playbackRate||!c.readyState))return;const R=a.mainForwardBufferInfo;if(!I&&R===null)return;const k=this.bwEstimator.getEstimateTTFB(),D=Math.abs(c.playbackRate);if(m<=Math.max(k,1e3*(p/(D*2))))return;const x=R?R.len/D:0,N=f.loading.first?f.loading.first-f.loading.start:-1,B=f.loaded&&N>-1,H=this.getBwEstimate(),O=a.levels,P=O[E],G=Math.max(f.loaded,Math.round(p*(s.bitrate||P.averageBitrate)/8));let J=B?m-N:m;J<1&&B&&(J=Math.min(m,f.loaded*8/H));const se=B?f.loaded*1e3/J:0,ie=k/1e3,ne=se?(G-f.loaded)/se:G*8/H+ie;if(ne<=x)return;const ae=se?se*8:H,fe=((i=t?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,ee=this.hls.config.abrBandWidthUpFactor;let oe=Number.POSITIVE_INFINITY,re;for(re=E-1;re>_;re--){const Se=O[re].maxBitrate,be=!O[re].details||fe;if(oe=this.getTimeToLoadFrag(ie,ae,p*Se,be),oe<Math.min(x,p+ie))break}if(oe>=ne||oe>p*10)return;B?this.bwEstimator.sample(m-Math.min(k,N),f.loaded):this.bwEstimator.sampleTTFB(m);const le=O[re].maxBitrate;this.getBwEstimate()*ee>le&&this.resetEstimator(le);const Q=this.findBestLevel(le,_,re,0,x,1,1);Q>-1&&(re=Q),this.warn(`Fragment ${s.sn}${r?" part "+r.index:""} of level ${E} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${x.toFixed(3)} s
      Estimated load time for current fragment: ${ne.toFixed(3)} s
      Estimated load time for down switch fragment: ${oe.toFixed(3)} s
      TTFB estimate: ${N|0} ms
      Current BW estimate: ${we(H)?H|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${re} @ ${le|0} bps`),a.nextLoadLevel=a.nextAutoLevel=re,this.clearTimer();const te=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===re&&re>0){const Se=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${re>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${Se.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,re>_){let be=this.findBestLevel(this.hls.levels[_].bitrate,_,re,0,Se,1,1);be===-1&&(be=_),this.hls.nextLoadLevel=this.hls.nextAutoLevel=be,this.resetEstimator(this.hls.levels[be].bitrate)}}};S||ne>oe*2?te():this.timer=self.setInterval(te,oe*1e3),a.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:r,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new _E(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Y.BUFFER_ADD_CODEC_ERROR:case Y.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Y.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:s,partCurrent:r}=this;if(i&&s&&i.sn===s.sn&&i.level===s.level){const a=performance.now(),l=r?r.stats:i.stats,c=a-l.loading.start,h=l.loading.first?l.loading.first-l.loading.start:-1;if(l.loaded&&h>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(c-Math.min(p,h),l.loaded)}else this.bwEstimator.sampleTTFB(c)}break}}}getTimeToLoadFrag(e,t,i,s){const r=e+i/t,a=s?e+this.lastLevelLoadSec:0;return r+a}onLevelLoaded(e,t){const i=this.hls.config,{loading:s}=t.stats,r=s.end-s.first;we(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const s=i?i.stats:t.stats;if(t.type===Ie.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=i?i.duration:t.duration,a=this.hls.levels[t.level],l=(a.loaded?a.loaded.bytes:0)+s.loaded,c=(a.loaded?a.loaded.duration:0)+r;a.loaded={bytes:l,duration:c},a.realBitrate=Math.round(8*l/c)}if(t.bitrateTest){const r={stats:s,frag:t,part:i,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:s}=t,r=s!=null&&s.stats.loaded?s.stats:i.stats;if(r.aborted||this.ignoreFragment(i))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ie.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,r=this.findBestLevel(i,t,e,0,s,1,1);if(r>-1)return r;const a=this.hls.firstLevel,l=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${l}`),l}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,r)&&a[e].loadError<=a[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:s,config:r,minAutoLevel:a}=i,l=t?t.duration:e?e.duration:0,c=this.getBwEstimate(),h=this.getStarvationDelay();let f=r.abrBandWidthFactor,p=r.abrBandWidthUpFactor;if(h){const S=this.findBestLevel(c,a,s,h,0,f,p);if(S>=0)return this.rebufferNotice=-1,S}let m=l?Math.min(l,r.maxStarvationDelay):r.maxStarvationDelay;if(!h){const S=this.bitrateTestDelay;S&&(m=(l?Math.min(l,r.maxLoadingDelay):r.maxLoadingDelay)-S,this.info(`bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),f=p=1)}const _=this.findBestLevel(c,a,s,h,m,f,p);if(this.rebufferNotice!==_&&(this.rebufferNotice=_,this.info(`${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${_}`)),_>-1)return _;const E=i.levels[a],C=i.loadLevelObj;return C&&E?.bitrate<C.bitrate?a:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,s,r,a,l){var c;const h=s+r,f=this.lastLoadedFragLevel,p=f===-1?this.hls.firstLevel:f,{fragCurrent:m,partCurrent:_}=this,{levels:E,allAudioTracks:C,loadLevel:S,config:I}=this.hls;if(E.length===1)return 0;const R=E[p],k=!!((c=this.hls.latestLevelDetails)!=null&&c.live),D=S===-1||f===-1;let x,N="SDR",B=R?.frameRate||0;const{audioPreference:H,videoPreference:O}=I,P=this.audioTracksByGroup||(this.audioTracksByGroup=mm(C));let G=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;const fe=this.codecTiers||(this.codecTiers=ob(E,P,t,i)),ee=ab(fe,N,e,H,O),{codecSet:oe,videoRanges:re,minFramerate:le,minBitrate:Q,minIndex:te,preferHDR:Se}=ee;G=te,x=oe,N=Se?re[re.length-1]:re[0],B=le,e=Math.max(e,Q),this.log(`picked start tier ${ft(ee)}`)}else x=R?.codecSet,N=R?.videoRange;const J=_?_.duration:m?m.duration:0,se=this.bwEstimator.getEstimateTTFB()/1e3,ie=[];for(let fe=i;fe>=t;fe--){var ne,ae;const ee=E[fe],oe=fe>p;if(!ee)continue;if(I.useMediaCapabilities&&!ee.supportedResult&&!ee.supportedPromise){const Pe=navigator.mediaCapabilities;typeof Pe?.decodingInfo=="function"&&XE(ee,P,N,B,e,H)?(ee.supportedPromise=pm(ee,P,Pe,this.supportedCache),ee.supportedPromise.then(Me=>{if(!this.hls)return;ee.supportedResult=Me;const De=this.hls.levels,$e=De.indexOf(ee);Me.error?this.warn(`MediaCapabilities decodingInfo error: "${Me.error}" for level ${$e} ${ft(Me)}`):Me.supported?Me.decodingInfoResults.some(Ve=>Ve.smooth===!1||Ve.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${$e} not smooth or powerEfficient: ${ft(Me)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${$e} ${ft(Me)}`),$e>-1&&De.length>1&&(this.log(`Removing unsupported level ${$e}`),this.hls.removeLevel($e),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):ee.supportedResult=dm}if((x&&ee.codecSet!==x||N&&ee.videoRange!==N||oe&&B>ee.frameRate||!oe&&B>0&&B<ee.frameRate||(ne=ee.supportedResult)!=null&&(ae=ne.decodingInfoResults)!=null&&ae.some(Pe=>Pe.smooth===!1))&&(!D||fe!==G)){ie.push(fe);continue}const re=ee.details,le=(_?re?.partTarget:re?.averagetargetduration)||J;let Q;oe?Q=l*e:Q=a*e;const te=J&&s>=J*2&&r===0?ee.averageBitrate:ee.maxBitrate,Se=this.getTimeToLoadFrag(se,Q,te*le,re===void 0);if(Q>=te&&(fe===f||ee.loadError===0&&ee.fragmentError===0)&&(Se<=se||!we(Se)||k&&!this.bitrateTestDelay||Se<h)){const Pe=this.forcedAutoLevel;return fe!==S&&(Pe===-1||Pe!==S)&&(ie.length&&this.trace(`Skipped level(s) ${ie.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${E[ie[0]].codecs}" ${E[ie[0]].videoRange}; not compatible with "${x}" ${N}`),this.info(`switch candidate:${p}->${fe} adjustedbw(${Math.round(Q)})-bitrate=${Math.round(Q-te)} ttfb:${se.toFixed(1)} avgDuration:${le.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${Se.toFixed(1)} firstSelection:${D} codecSet:${ee.codecSet} videoRange:${ee.videoRange} hls.loadLevel:${S}`)),D&&(this.firstSelection=fe),fe}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const vm={search:function(n,e){let t=0,i=n.length-1,s=null,r=null;for(;t<=i;){s=(t+i)/2|0,r=n[s];const a=e(r);if(a>0)t=s+1;else if(a<0)i=s-1;else return r}return null}};function db(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!we(e))return null;const i=n[0].programDateTime;if(e<(i||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let r=0;r<n.length;++r){const a=n[r];if(pb(e,t,a))return a}return null}function ar(n,e,t=0,i=0,s=.005){let r=null;if(n){r=e[1+n.sn-e[0].sn]||null;const l=n.endDTS-t;l>0&&l<15e-7&&(t+=15e-7),r&&n.level!==r.level&&r.end<=n.end&&(r=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!n||n.level===r.level)&&vf(t,i,r)===0||fb(r,n,Math.min(s,i))))return r;const a=vm.search(e,vf.bind(null,t,i));return a&&(a!==n||!r)?a:r}function fb(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((s,r)=>(r[0]==="INF"&&(s+=parseFloat(r[1])),s),t);return n.start<=i}return!1}function vf(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=n?1:t.start-i>n&&t.start?-1:0}function pb(n,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>n}function ym(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let i=n.fragments;const{fragmentHint:s}=n;s&&(i=i.concat(s));let r;return vm.search(i,a=>a.cc<e?1:a.cc>e?-1:(r=a,a.end<=t?1:a.start>t?-1:0)),r||null}return null}function ko(n){switch(n.details){case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_TIMEOUT:case Y.LEVEL_LOAD_TIMEOUT:case Y.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function yf(n,e){const t=ko(e);return n.default[`${t?"timeout":"error"}Retry`]}function ic(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Tf(n){return nt(nt({},n),{errorRetry:null,timeoutRetry:null})}function Ro(n,e,t,i){if(!n)return!1;const s=i?.code,r=e<n.maxNumRetry&&(gb(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,i,r):r}function gb(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}var $t={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Si={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class mb extends Ai{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===Ie.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const s=this.hls,r=t.context;switch(t.details){case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Y.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=$n();return}case Y.FRAG_GAP:case Y.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=$t.SendAlternateToPenaltyBox;return}case Y.LEVEL_EMPTY_ERROR:case Y.LEVEL_PARSING_ERROR:{var a,l;const h=t.parent===Ie.MAIN?t.level:s.loadLevel;t.details===Y.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(l=a.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case Y.LEVEL_LOAD_ERROR:case Y.LEVEL_LOAD_TIMEOUT:typeof r?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case Y.AUDIO_TRACK_LOAD_ERROR:case Y.AUDIO_TRACK_LOAD_TIMEOUT:case Y.SUBTITLE_LOAD_ERROR:case Y.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const h=s.loadLevelObj;if(h&&(r.type===Ge.AUDIO_TRACK&&h.hasAudioGroup(r.groupId)||r.type===Ge.SUBTITLE_TRACK&&h.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=$t.SendAlternateToPenaltyBox,t.errorAction.flags=Si.MoveAllAlternatesMatchingHost;return}}return;case Y.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const h=s.loadLevelObj,f=h?.attrs["HDCP-LEVEL"];f?t.errorAction={action:$t.SendAlternateToPenaltyBox,flags:Si.MoveAllAlternatesMatchingHDCP,hdcpLevel:f}:this.keySystemError(t)}return;case Y.BUFFER_ADD_CODEC_ERROR:case Y.REMUX_ALLOC_ERROR:case Y.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:s.loadLevel)}return;case Y.INTERNAL_EXCEPTION:case Y.BUFFER_APPENDING_ERROR:case Y.BUFFER_FULL_ERROR:case Y.LEVEL_SWITCH_ERROR:case Y.BUFFER_STALLED_ERROR:case Y.BUFFER_SEEK_OVER_HOLE:case Y.BUFFER_NUDGE_ON_STALL:t.errorAction=$n();return}t.type===ke.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,s=yf(i.config.playlistLoadPolicy,e),r=this.playlistError++;if(Ro(s,r,ko(e),e.response))return{action:$t.RetryRequest,flags:Si.None,retryConfig:s,retryCount:r};const l=this.getLevelSwitchAction(e,t);return s&&(l.retryConfig=s,l.retryCount=r),l}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],{fragLoadPolicy:r,keyLoadPolicy:a}=t.config,l=yf(e.details.startsWith("key")?a:r,e),c=t.levels.reduce((f,p)=>f+p.fragmentError,0);if(s&&(e.details!==Y.FRAG_GAP&&s.fragmentError++,Ro(l,c,ko(e),e.response)))return{action:$t.RetryRequest,flags:Si.None,retryConfig:l,retryCount:c};const h=this.getLevelSwitchAction(e,i);return l&&(h.retryConfig=l,h.retryCount=c),h}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const s=this.hls.levels[t];if(s){var r,a;const h=e.details;s.loadError++,h===Y.BUFFER_APPEND_ERROR&&s.fragmentError++;let f=-1;const{levels:p,loadLevel:m,minAutoLevel:_,maxAutoLevel:E}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const C=(r=e.frag)==null?void 0:r.type,I=(C===Ie.AUDIO&&h===Y.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(h===Y.BUFFER_ADD_CODEC_ERROR||h===Y.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:N})=>s.audioCodec!==N),k=e.sourceBufferName==="video"&&(h===Y.BUFFER_ADD_CODEC_ERROR||h===Y.BUFFER_APPEND_ERROR)&&p.some(({codecSet:N,audioCodec:B})=>s.codecSet!==N&&s.audioCodec===B),{type:D,groupId:x}=(a=e.context)!=null?a:{};for(let N=p.length;N--;){const B=(N+m)%p.length;if(B!==m&&B>=_&&B<=E&&p[B].loadError===0){var l,c;const H=p[B];if(h===Y.FRAG_GAP&&C===Ie.MAIN&&e.frag){const O=p[B].details;if(O){const P=ar(e.frag,O.fragments,e.frag.start);if(P!=null&&P.gap)continue}}else{if(D===Ge.AUDIO_TRACK&&H.hasAudioGroup(x)||D===Ge.SUBTITLE_TRACK&&H.hasSubtitleGroup(x))continue;if(C===Ie.AUDIO&&(l=s.audioGroups)!=null&&l.some(O=>H.hasAudioGroup(O))||C===Ie.SUBTITLE&&(c=s.subtitleGroups)!=null&&c.some(O=>H.hasSubtitleGroup(O))||I&&s.audioCodec===H.audioCodec||!I&&s.audioCodec!==H.audioCodec||k&&s.codecSet===H.codecSet)continue}f=B;break}}if(f>-1&&i.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:$t.SendAlternateToPenaltyBox,flags:Si.None,nextAutoLevel:f}}return{action:$t.SendAlternateToPenaltyBox,flags:Si.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case $t.DoNothing:break;case $t.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Y.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:s,hdcpLevel:r,nextAutoLevel:a}=i;switch(s){case Si.None:this.switchLevel(e,a);break;case Si.MoveAllAlternatesMatchingHDCP:r&&(t.maxHdcpLevel=ph[ph.indexOf(r)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Y.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=fh(e.mimeType),s=this.hls.levels;for(let r=s.length;r--;)s[r][`${e.sourceBufferName}Codec`]===i&&this.hls.removeLevel(r)}}}function $n(n){const e={action:$t.DoNothing,flags:Si.None};return n&&(e.resolved=!0),e}var Lt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class vb{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let s=i.length;s--;){const r=i[s];if(!r)break;const a=r.end;if(r.start<=e&&a!==null&&e<=a)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:s}=this,r=Object.keys(s);for(let a=r.length;a--;){const l=s[r[a]];if(l?.body.type===t&&(!i||l.buffered)){const c=l.body;if(c.start<=e&&e<=c.end)return c}}return null}detectEvictedFragments(e,t,i,s,r){this.timeRanges&&(this.timeRanges[e]=t);const a=s?.fragment.sn||-1;Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c||a>=c.body.sn)return;if(!c.buffered&&(!c.loaded||r)){c.body.type===i&&this.removeFragment(c.body);return}const h=c.range[e];if(h){if(h.time.length===0){this.removeFragment(c.body);return}h.time.some(f=>{const p=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return p&&this.removeFragment(c.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,s=Ir(i),r=this.fragments[s];if(!r||r.buffered&&i.gap)return;const a=!i.relurl;Object.keys(t).forEach(l=>{const c=i.elementaryStreams[l];if(!c)return;const h=t[l],f=a||c.partial===!0;r.range[l]=this.getBufferedTimes(i,e.part,f,h)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=i.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),Fa(r)||this.removeParts(i.sn-1,i.type)):this.removeFragment(r.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=_f(i,s=>s.fragment.sn>=e))}fragBuffered(e,t){const i=Ir(e);let s=this.fragments[i];!s&&t&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,i,s){const r={time:[],partial:i},a=e.start,l=e.end,c=e.minEndPTS||l,h=e.maxStartPTS||a;for(let f=0;f<s.length;f++){const p=s.start(f)-this.bufferPadding,m=s.end(f)+this.bufferPadding;if(h>=p&&c<=m){r.time.push({startPTS:Math.max(a,s.start(f)),endPTS:Math.min(l,s.end(f))});break}else if(a<m&&l>p){const _=Math.max(a,s.start(f)),E=Math.min(l,s.end(f));E>_&&(r.partial=!0,r.time.push({startPTS:_,endPTS:E}))}else if(l<=p)break}return r}getPartialFragment(e){let t=null,i,s,r,a=0;const{bufferPadding:l,fragments:c}=this;return Object.keys(c).forEach(h=>{const f=c[h];f&&Fa(f)&&(s=f.body.start-l,r=f.body.end+l,e>=s&&e<=r&&(i=Math.min(e-s,r-e),a<=i&&(t=f.body,a=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Fa(t))}getState(e){const t=Ir(e),i=this.fragments[t];return i?i.buffered?Fa(i)?Lt.PARTIAL:Lt.OK:Lt.APPENDING:Lt.NOT_LOADED}isTimeBuffered(e,t,i){let s,r;for(let a=0;a<i.length;a++){if(s=i.start(a)-this.bufferPadding,r=i.end(a)+this.bufferPadding,e>=s&&t<=r)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,s=t.part?null:t,r=Ir(i);this.fragments[r]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:s,timeRanges:r,type:a}=t;if(i.sn==="initSegment")return;const l=i.type;if(s){let h=this.activePartLists[l];h||(this.activePartLists[l]=h=[]),h.push(s)}this.timeRanges=r;const c=r[a];this.detectEvictedFragments(a,c,l,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ir(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let s=i.length;s--;){const r=t[i[s]];if(r?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,s,r){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l)return;const c=l.body;c.type!==i||s&&!c.gap||c.start<t&&c.end>e&&(l.buffered||r)&&this.removeFragment(c)})}removeFragment(e){const t=Ir(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const s=e.sn;this.activePartLists[e.type]=_f(i,r=>r.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const i=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;i&&i.forEach(s=>s.clearElementaryStreamInfo())}}function Fa(n){var e,t,i;return n.buffered&&(n.body.gap||((e=n.range.video)==null?void 0:e.partial)||((t=n.range.audio)==null?void 0:t.partial)||((i=n.range.audiovideo)==null?void 0:i.partial))}function Ir(n){return`${n.type}_${n.level}_${n.sn}`}function _f(n,e){return n.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var Bs={cbc:0,ctr:1};class yb{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case Bs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Bs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Tb(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class _b{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=t.getUint32(s*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],r=i[1],a=i[2],l=i[3],c=this.invSubMix,h=c[0],f=c[1],p=c[2],m=c[3],_=new Uint32Array(256);let E=0,C=0,S=0;for(S=0;S<256;S++)S<128?_[S]=S<<1:_[S]=S<<1^283;for(S=0;S<256;S++){let I=C^C<<1^C<<2^C<<3^C<<4;I=I>>>8^I&255^99,e[E]=I,t[I]=E;const R=_[E],k=_[R],D=_[k];let x=_[I]*257^I*16843008;s[E]=x<<24|x>>>8,r[E]=x<<16|x>>>16,a[E]=x<<8|x>>>24,l[E]=x,x=D*16843009^k*65537^R*257^E*16843008,h[I]=x<<24|x>>>8,f[I]=x<<16|x>>>16,p[I]=x<<8|x>>>24,m[I]=x,E?(E=R^_[_[_[D^R]]],C^=_[_[C]]):E=C=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,s=0;for(;s<t.length&&i;)i=t[s]===this.key[s],s++;if(i)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const a=this.ksRows=(r+6+1)*4;let l,c;const h=this.keySchedule=new Uint32Array(a),f=this.invKeySchedule=new Uint32Array(a),p=this.sBox,m=this.rcon,_=this.invSubMix,E=_[0],C=_[1],S=_[2],I=_[3];let R,k;for(l=0;l<a;l++){if(l<r){R=h[l]=t[l];continue}k=R,l%r===0?(k=k<<8|k>>>24,k=p[k>>>24]<<24|p[k>>>16&255]<<16|p[k>>>8&255]<<8|p[k&255],k^=m[l/r|0]<<24):r>6&&l%r===4&&(k=p[k>>>24]<<24|p[k>>>16&255]<<16|p[k>>>8&255]<<8|p[k&255]),h[l]=R=(h[l-r]^k)>>>0}for(c=0;c<a;c++)l=a-c,c&3?k=h[l]:k=h[l-4],c<4||l<=4?f[c]=k:f[c]=E[p[k>>>24]]^C[p[k>>>16&255]]^S[p[k>>>8&255]]^I[p[k&255]],f[c]=f[c]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const s=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,l=this.invSubMix,c=l[0],h=l[1],f=l[2],p=l[3],m=this.uint8ArrayToUint32Array_(i);let _=m[0],E=m[1],C=m[2],S=m[3];const I=new Int32Array(e),R=new Int32Array(I.length);let k,D,x,N,B,H,O,P,G,J,se,ie,ne,ae;const fe=this.networkToHostOrderSwap;for(;t<I.length;){for(G=fe(I[t]),J=fe(I[t+1]),se=fe(I[t+2]),ie=fe(I[t+3]),B=G^r[0],H=ie^r[1],O=se^r[2],P=J^r[3],ne=4,ae=1;ae<s;ae++)k=c[B>>>24]^h[H>>16&255]^f[O>>8&255]^p[P&255]^r[ne],D=c[H>>>24]^h[O>>16&255]^f[P>>8&255]^p[B&255]^r[ne+1],x=c[O>>>24]^h[P>>16&255]^f[B>>8&255]^p[H&255]^r[ne+2],N=c[P>>>24]^h[B>>16&255]^f[H>>8&255]^p[O&255]^r[ne+3],B=k,H=D,O=x,P=N,ne=ne+4;k=a[B>>>24]<<24^a[H>>16&255]<<16^a[O>>8&255]<<8^a[P&255]^r[ne],D=a[H>>>24]<<24^a[O>>16&255]<<16^a[P>>8&255]<<8^a[B&255]^r[ne+1],x=a[O>>>24]<<24^a[P>>16&255]<<16^a[B>>8&255]<<8^a[H&255]^r[ne+2],N=a[P>>>24]<<24^a[B>>16&255]<<16^a[H>>8&255]<<8^a[O&255]^r[ne+3],R[t]=fe(k^_),R[t+1]=fe(N^E),R[t+2]=fe(x^C),R[t+3]=fe(D^S),_=G,E=J,C=se,S=ie,t=t+4}return R.buffer}}class Eb{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=bb(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function bb(n){switch(n){case Bs.cbc:return"AES-CBC";case Bs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const Sb=16;class sc{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Tb(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,s){return this.useSoftware?new Promise((r,a)=>{const l=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(l,t,i,s);const c=this.flush();c?r(c.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,s)}softwareDecrypt(e,t,i,s){const{currentIV:r,currentResult:a,remainderData:l}=this;if(s!==Bs.cbc||t.byteLength!==16)return Ze.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),l&&(e=gi(l,e),this.remainderData=null);const c=this.getValidChunk(e);if(!c.length)return null;r&&(i=r);let h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new _b),h.expandKey(t);const f=a;return this.currentResult=h.decrypt(c.buffer,0,i),this.currentIV=c.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,i,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,s));this.key=t,this.fastAesKey=new Eb(this.subtle,t,s)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new yb(this.subtle,new Uint8Array(i),s).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(Ze.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,i,s)))}onWebCryptoError(e,t,i,s){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,s);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%Sb;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Ze.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Ef=Math.pow(2,17);class Cb{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new ts({type:ke.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,r=s.fLoader,a=s.loader;return new Promise((l,c)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(E=>E[0]==="GAP")){c(Sf(e));return}else e.gap=!1;const h=this.loader=r?new r(s):new a(s),f=bf(e);e.loader=h;const p=Tf(s.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Ef};e.stats=h.stats;const _={onSuccess:(E,C,S,I)=>{this.resetLoader(e,h);let R=E.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),l({frag:e,part:null,payload:R,networkDetails:I})},onError:(E,C,S,I)=>{this.resetLoader(e,h),c(new ts({type:ke.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:nt({url:i,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:S,stats:I}))},onAbort:(E,C,S)=>{this.resetLoader(e,h),c(new ts({type:ke.NETWORK_ERROR,details:Y.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:E}))},onTimeout:(E,C,S)=>{this.resetLoader(e,h),c(new ts({type:ke.NETWORK_ERROR,details:Y.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:S,stats:E}))}};t&&(_.onProgress=(E,C,S,I)=>t({frag:e,part:null,payload:S,networkDetails:I})),h.load(f,m,_)})}loadPart(e,t,i){this.abort();const s=this.config,r=s.fLoader,a=s.loader;return new Promise((l,c)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){c(Sf(e,t));return}const h=this.loader=r?new r(s):new a(s),f=bf(e,t);e.loader=h;const p=Tf(s.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ef};t.stats=h.stats,h.load(f,m,{onSuccess:(_,E,C,S)=>{this.resetLoader(e,h),this.updateStatsFromPart(e,t);const I={frag:e,part:t,payload:_.data,networkDetails:S};i(I),l(I)},onError:(_,E,C,S)=>{this.resetLoader(e,h),c(new ts({type:ke.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:nt({url:f.url,data:void 0},_),error:new Error(`HTTP Error ${_.code} ${_.text}`),networkDetails:C,stats:S}))},onAbort:(_,E,C)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,h),c(new ts({type:ke.NETWORK_ERROR,details:Y.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:C,stats:_}))},onTimeout:(_,E,C)=>{this.resetLoader(e,h),c(new ts({type:ke.NETWORK_ERROR,details:Y.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:C,stats:_}))}})})}updateStatsFromPart(e,t){const i=e.stats,s=t.stats,r=s.total;if(i.loaded+=s.loaded,r){const c=Math.round(e.duration/t.duration),h=Math.min(Math.round(i.loaded/r),c),p=(c-h)*Math.round(i.loaded/h);i.total=i.loaded+p}else i.total=Math.max(i.loaded,i.total);const a=i.loading,l=s.loading;a.start?a.first+=l.first-l.start:(a.start=l.start,a.first=l.first),a.end=l.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function bf(n,e=null){const t=e||n,i={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(we(s)&&we(r)){var a;let l=s,c=r;if(n.sn==="initSegment"&&wb((a=n.decryptdata)==null?void 0:a.method)){const h=r-s;h%16&&(c=r+(16-h%16)),s!==0&&(i.resetIV=!0,l=s-16)}i.rangeStart=l,i.rangeEnd=c}return i}function Sf(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),i={type:ke.MEDIA_ERROR,details:Y.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(i.part=e),(e||n).stats.aborted=!0,new ts(i)}function wb(n){return n==="AES-128"||n==="AES-256"}class ts extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Tm extends Ai{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class rc{constructor(e,t,i,s=0,r=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Na(),this.buffering={audio:Na(),video:Na(),audiovideo:Na()},this.level=e,this.sn=t,this.id=i,this.size=s,this.part=r,this.partial=a}}function Na(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Cf={length:0,start:()=>0,end:()=>0};class Ue{static isBuffered(e,t){if(e){const i=Ue.getBuffered(e);for(let s=i.length;s--;)if(t>=i.start(s)&&t<=i.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=Ue.getBuffered(e);return Ue.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const s=Ue.bufferedRanges(e);if(s.length)return Ue.bufferedInfo(s,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((f,p)=>f.start-p.start||p.end-f.end);let s=-1,r=[];if(i)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(s=f);const p=r.length;if(p){const m=r[p-1].end;e[f].start-m<i?e[f].end>m&&(r[p-1].end=e[f].end):r.push(e[f])}else r.push(e[f])}else r=e;let a=0,l,c=t,h=t;for(let f=0;f<r.length;f++){const p=r[f].start,m=r[f].end;if(s===-1&&t>=p&&t<=m&&(s=f),t+i>=p&&t<m)c=p,h=m,a=h-t;else if(t+i<p){l=p;break}}return{len:a,start:c||0,end:h||0,nextStart:l,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Cf}catch(t){return Ze.log("failed to get media.buffered",t),Cf}}}const _m=/\{\$([a-zA-Z0-9-_]+)\}/g;function wf(n){return _m.test(n)}function gh(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(_m,i=>{const s=i.substring(2,i.length-1),r=t?.[s];return r===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):r})}return e}function Af(n,e,t){let i=n.variableList;i||(n.variableList=i={});let s,r;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(s))r=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,r=e.VALUE;s in i?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=r||""}function Ab(n,e,t){const i=e.IMPORT;if(t&&i in t){let s=n.variableList;s||(n.variableList=s={}),s[i]=t[i]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const Ib=/^(\d+)x(\d+)$/,If=/(.+?)=(".*?"|.*?)(?:,|$)/g;class pt{constructor(e,t){typeof e=="string"&&(e=pt.parseAttrList(e,t)),st(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)i[s]=parseInt(t.slice(s*2,s*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((s,r)=>(s[r.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Ib.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const s={},r='"';for(If.lastIndex=0;(i=If.exec(e))!==null;){const a=i[1].trim();let l=i[2];const c=l.indexOf(r)===0&&l.lastIndexOf(r)===l.length-1;let h=!1;if(c)l=l.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":h=!0}if(t&&(c||h))l=gh(t,l);else if(!h&&!c)switch(a){case"CLOSED-CAPTIONS":if(l==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ze.warn(`${e}: attribute ${a} is missing quotes`)}s[a]=l}return s}}const Lb="com.apple.hls.interstitial";function kb(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function Rb(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class Em{constructor(e,t,i=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(s=t?.tagOrder)!=null?s:i,t){const r=t.attr;for(const a in r)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==r[a]){Ze.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=st(new pt({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=t?.endDate||new Date(this.attr["END-DATE"]);we(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ze.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(we(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Lb}get isValid(){return!!this.id&&!this._badValueForSameId&&we(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Pb=10;class Db{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?we(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Pb}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Ur(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function nc(n){switch(n){case"AES-128":case"AES-256":return Bs.cbc;case"AES-256-CTR":return Bs.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function bm(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function mh(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function xb(n){const e=mh(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Ob(n){const e=function(i,s,r){const a=i[s];i[s]=i[r],i[r]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function Mb(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const r=s[0]==="base64",a=s[1];r?(i.splice(-1,1),t=bm(a)):t=xb(a)}}return t}const Po=typeof self<"u"?self:void 0;var yt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ei={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function vh(n){switch(n){case ei.FAIRPLAY:return yt.FAIRPLAY;case ei.PLAYREADY:return yt.PLAYREADY;case ei.WIDEVINE:return yt.WIDEVINE;case ei.CLEARKEY:return yt.CLEARKEY}}function Lf(n){switch(n){case yt.FAIRPLAY:return ei.FAIRPLAY;case yt.PLAYREADY:return ei.PLAYREADY;case yt.WIDEVINE:return ei.WIDEVINE;case yt.CLEARKEY:return ei.CLEARKEY}}function ho(n){const{drmSystems:e,widevineLicenseUrl:t}=n,i=e?[yt.FAIRPLAY,yt.WIDEVINE,yt.PLAYREADY,yt.CLEARKEY].filter(s=>!!e[s]):[];return!i[yt.WIDEVINE]&&t&&i.push(yt.WIDEVINE),i}const Sm=function(n){return Po!=null&&(n=Po.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Fb(n,e,t,i){let s;switch(n){case yt.FAIRPLAY:s=["cenc","sinf"];break;case yt.WIDEVINE:case yt.PLAYREADY:s=["cenc"];break;case yt.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return Nb(s,e,t,i)}function Nb(n,e,t,i){return[{initDataTypes:n,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function Bb(n){var e;return n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function Ub(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(a){const l=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(l){const c=bm(l).subarray(0,16);return Ob(c),c}}return null}let Ba={};class Wo{static clearKeyUriToKeyIdMap(){Ba={}}constructor(e,t,i,s=[1],r=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=s,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Ur(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(sm(a)))}matches(e){var t,i;return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&e.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((t=e.iv)==null?void 0:t.join(","))===((i=this.iv)==null?void 0:i.join(","))}isSupported(){if(this.method){if(Ur(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ei.FAIRPLAY:case ei.WIDEVINE:case ei.PLAYREADY:case ei.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(Ur(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Ze.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=$b(e);return new Wo(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.pssh&&this.keyId)return this;const t=Mb(this.uri);if(t)switch(this.keyFormat){case ei.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){const i=t.length-22;this.keyId=t.subarray(i,i+16)}break;case ei.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=GE(i,null,t),this.keyId=Ub(t);break}default:{let i=t.subarray(0,16);if(i.length!==16){const s=new Uint8Array(16);s.set(i,16-i.length),i=s}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=Ba[this.uri];if(!i){const s=Object.keys(Ba).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,s),Ba[this.uri]=i}this.keyId=i}return this}}function $b(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const kf=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Rf=/#EXT-X-MEDIA:(.*)/g,Hb=/^#EXT(?:INF|-X-TARGETDURATION):/m,fu=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),jb=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Gi{static findGroup(e,t){for(let i=0;i<e.length;i++){const s=e[i];if(s.id===t)return s}}static resolve(e,t){return Qh.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Hb.test(e)}static parseMasterPlaylist(e,t){const i=wf(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},r=[];kf.lastIndex=0;let a;for(;(a=kf.exec(e))!=null;)if(a[1]){var l;const h=new pt(a[1],s),f=gh(s,a[2]),p={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:Gi.resolve(f,t)},m=h.decimalResolution("RESOLUTION");m&&(p.width=m.width,p.height=m.height),xf(h.CODECS,p);const _=h["SUPPLEMENTAL-CODECS"];_&&(p.supplemental={},xf(_,p.supplemental)),(l=p.unknownCodecs)!=null&&l.length||r.push(p),s.levels.push(p)}else if(a[3]){const h=a[3],f=a[4];switch(h){case"SESSION-DATA":{const p=new pt(f,s),m=p["DATA-ID"];m&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[m]=p);break}case"SESSION-KEY":{const p=Pf(f,t,s);p.encrypted&&p.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(p)):Ze.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const p=new pt(f,s);Af(s,p,t)}break}case"CONTENT-STEERING":{const p=new pt(f,s);s.contentSteering={uri:Gi.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Df(f);break}}}const c=r.length>0&&r.length<s.levels.length;return s.levels=c?r:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,i){let s;const r={},a=i.levels,l={AUDIO:a.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:a.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]};let c=0;for(Rf.lastIndex=0;(s=Rf.exec(e))!==null;){const h=new pt(s[1],i),f=h.TYPE;if(f){const p=l[f],m=r[f]||[];r[f]=m;const _=h.LANGUAGE,E=h["ASSOC-LANGUAGE"],C=h.CHANNELS,S=h.CHARACTERISTICS,I=h["INSTREAM-ID"],R={attrs:h,bitrate:0,id:c++,groupId:h["GROUP-ID"]||"",name:h.NAME||_||"",type:f,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:_,url:h.URI?Gi.resolve(h.URI,t):""};if(E&&(R.assocLang=E),C&&(R.channels=C),S&&(R.characteristics=S),I&&(R.instreamId=I),p!=null&&p.length){const k=Gi.findGroup(p,R.groupId)||p[0];Of(R,k,"audioCodec"),Of(R,k,"textCodec")}m.push(R)}}return r}static parseLevelPlaylist(e,t,i,s,r,a){var l;const c={url:t},h=new Db(t),f=h.fragments,p=[];let m=null,_=0,E=0,C=0,S=0,I=0,R=null,k=new hu(s,c),D,x,N,B=-1,H=!1,O=null,P;if(fu.lastIndex=0,h.m3u8=e,h.hasVariableRefs=wf(e),((l=fu.exec(e))==null?void 0:l[0])!=="#EXTM3U")return h.playlistParsingError=new Error("Missing format identifier #EXTM3U"),h;for(;(D=fu.exec(e))!==null;){H&&(H=!1,k=new hu(s,c),k.playlistOffset=C,k.start=C,k.sn=_,k.cc=S,I&&(k.bitrate=I),k.level=i,m&&(k.initSegment=m,m.rawProgramDateTime&&(k.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),O&&(k.setByteRange(O),O=null)));const ie=D[1];if(ie){k.duration=parseFloat(ie);const ne=(" "+D[2]).slice(1);k.title=ne||null,k.tagList.push(ne?["INF",ie,ne]:["INF",ie])}else if(D[3]){if(we(k.duration)){k.playlistOffset=C,k.start=C,N&&Ff(k,N,h),k.sn=_,k.level=i,k.cc=S,f.push(k);const ne=(" "+D[3]).slice(1);k.relurl=gh(h,ne),yh(k,R,p),R=k,C+=k.duration,_++,E=0,H=!0}}else{if(D=D[0].match(jb),!D){Ze.warn("No matches on slow regex match for level playlist!");continue}for(x=1;x<D.length&&D[x]===void 0;x++);const ne=(" "+D[x]).slice(1),ae=(" "+D[x+1]).slice(1),fe=D[x+2]?(" "+D[x+2]).slice(1):null;switch(ne){case"BYTERANGE":R?k.setByteRange(ae,R):k.setByteRange(ae);break;case"PROGRAM-DATE-TIME":k.rawProgramDateTime=ae,k.tagList.push(["PROGRAM-DATE-TIME",ae]),B===-1&&(B=f.length);break;case"PLAYLIST-TYPE":h.type&&Qi(h,ne,D),h.type=ae.toUpperCase();break;case"MEDIA-SEQUENCE":h.startSN!==0?Qi(h,ne,D):f.length>0&&Nf(h,ne,D),_=h.startSN=parseInt(ae);break;case"SKIP":{h.skippedSegments&&Qi(h,ne,D);const ee=new pt(ae,h),oe=ee.decimalInteger("SKIPPED-SEGMENTS");if(we(oe)){h.skippedSegments+=oe;for(let le=oe;le--;)f.push(null);_+=oe}const re=ee.enumeratedString("RECENTLY-REMOVED-DATERANGES");re&&(h.recentlyRemovedDateranges=(h.recentlyRemovedDateranges||[]).concat(re.split("	")));break}case"TARGETDURATION":h.targetduration!==0&&Qi(h,ne,D),h.targetduration=Math.max(parseInt(ae),1);break;case"VERSION":h.version!==null&&Qi(h,ne,D),h.version=parseInt(ae);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":h.live||Qi(h,ne,D),h.live=!1;break;case"#":(ae||fe)&&k.tagList.push(fe?[ae,fe]:[ae]);break;case"DISCONTINUITY":S++,k.tagList.push(["DIS"]);break;case"GAP":k.gap=!0,k.tagList.push([ne]);break;case"BITRATE":k.tagList.push([ne,ae]),I=parseInt(ae)*1e3,we(I)?k.bitrate=I:I=0;break;case"DATERANGE":{const ee=new pt(ae,h),oe=new Em(ee,h.dateRanges[ee.ID],h.dateRangeTagCount);h.dateRangeTagCount++,oe.isValid||h.skippedSegments?h.dateRanges[oe.id]=oe:Ze.warn(`Ignoring invalid DATERANGE tag: "${ae}"`),k.tagList.push(["EXT-X-DATERANGE",ae]);break}case"DEFINE":{{const ee=new pt(ae,h);"IMPORT"in ee?Ab(h,ee,a):Af(h,ee,t)}break}case"DISCONTINUITY-SEQUENCE":h.startCC!==0?Qi(h,ne,D):f.length>0&&Nf(h,ne,D),h.startCC=S=parseInt(ae);break;case"KEY":{const ee=Pf(ae,t,h);if(ee.isSupported()){if(ee.method==="NONE"){N=void 0;break}N||(N={});const oe=N[ee.keyFormat];oe!=null&&oe.matches(ee)||(oe&&(N=st({},N)),N[ee.keyFormat]=ee)}else Ze.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${ae}"`);break}case"START":h.startTimeOffset=Df(ae);break;case"MAP":{const ee=new pt(ae,h);if(k.duration){const oe=new hu(s,c);Mf(oe,ee,i,N),m=oe,k.initSegment=m,m.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=m.rawProgramDateTime)}else{const oe=k.byteRangeEndOffset;if(oe){const re=k.byteRangeStartOffset;O=`${oe-re}@${re}`}else O=null;Mf(k,ee,i,N),m=k,H=!0}m.cc=S;break}case"SERVER-CONTROL":{P&&Qi(h,ne,D),P=new pt(ae),h.canBlockReload=P.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=P.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&P.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=P.optionalFloat("PART-HOLD-BACK",0),h.holdBack=P.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{h.partTarget&&Qi(h,ne,D);const ee=new pt(ae);h.partTarget=ee.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ee=h.partList;ee||(ee=h.partList=[]);const oe=E>0?ee[ee.length-1]:void 0,re=E++,le=new pt(ae,h),Q=new RE(le,k,c,re,oe);ee.push(Q),k.duration+=Q.duration;break}case"PRELOAD-HINT":{const ee=new pt(ae,h);h.preloadHint=ee;break}case"RENDITION-REPORT":{const ee=new pt(ae,h);h.renditionReports=h.renditionReports||[],h.renditionReports.push(ee);break}default:Ze.warn(`line parsed but not handled: ${D}`);break}}}R&&!R.relurl?(f.pop(),C-=R.duration,h.partList&&(h.fragmentHint=R)):h.partList&&(yh(k,R,p),k.cc=S,h.fragmentHint=k,N&&Ff(k,N,h)),h.targetduration||(h.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const G=f.length,J=f[0],se=f[G-1];if(C+=h.skippedSegments*h.targetduration,C>0&&G&&se){h.averagetargetduration=C/G;const ie=se.sn;h.endSN=ie!=="initSegment"?ie:0,h.live||(se.endList=!0),J&&h.startCC===void 0&&(h.startCC=J.cc),B>0&&(Gb(f,B),J&&p.unshift(J))}else h.endSN=0,h.startCC=0;return h.fragmentHint&&(C+=h.fragmentHint.duration),h.totalduration=C,p.length&&h.dateRangeTagCount&&J&&Cm(p,h),h.endCC=S,h}}function Cm(n,e){const t=n.length;if(!t)return;const i=n[t-1],s=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let a=r.length;a--;){const l=e.dateRanges[r[a]],c=l.startDate.getTime();l.tagAnchor=i.ref;for(let h=t;h--;){const f=Vb(e,c,n,h,s);if(f!==-1){l.tagAnchor=e.fragments[f].ref;break}}}}function Vb(n,e,t,i,s){const r=t[i];if(r){const l=r.programDateTime;if(e>=l||i===0){var a;const c=(((a=t[i+1])==null?void 0:a.start)||s)-r.start;if(e<=l+c*1e3){const h=t[i].sn-n.startSN,f=n.fragments;if(f.length>t.length){const m=(t[i+1]||f[f.length-1]).sn-n.startSN;for(let _=m;_>h;_--){const E=f[_].programDateTime;if(e>=E&&e<E+f[_].duration*1e3)return _}}return h}}}return-1}function Pf(n,e,t){var i,s;const r=new pt(n,t),a=(i=r.METHOD)!=null?i:"",l=r.URI,c=r.hexadecimalInteger("IV"),h=r.KEYFORMATVERSIONS,f=(s=r.KEYFORMAT)!=null?s:"identity";l&&r.IV&&!c&&Ze.error(`Invalid IV: ${r.IV}`);const p=l?Gi.resolve(l,e):"",m=(h||"1").split("/").map(Number).filter(Number.isFinite);return new Wo(a,p,f,m,c,r.KEYID)}function Df(n){const t=new pt(n).decimalFloatingPoint("TIME-OFFSET");return we(t)?t:null}function xf(n,e){let t=(n||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const s=t.filter(r=>ec(r,i));s.length&&(e[`${i}Codec`]=s.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>s.indexOf(r)===-1))}),e.unknownCodecs=t}function Of(n,e,t){const i=e[t];i&&(n[t]=i)}function Gb(n,e){let t=n[e];for(let i=e;i--;){const s=n[i];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function yh(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function Mf(n,e,t,i){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",i&&(n.levelkeys=i),n.initSegment=null}function Ff(n,e,t){n.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&i.push(n)}function Qi(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Nf(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function pu(n,e){const t=e.startPTS;if(we(t)){let i=0,s;e.sn>n.sn?(i=t-n.start,s=n):(i=n.start-t,s=e),s.duration!==i&&s.setDuration(i)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function wm(n,e,t,i,s,r){i-t<=0&&(Ze.warn("Fragment should have a positive duration",e),i=t+e.duration,r=s+e.duration);let l=t,c=i;const h=e.startPTS,f=e.endPTS;if(we(h)){const S=Math.abs(h-t);we(e.deltaPTS)?e.deltaPTS=Math.max(S,e.deltaPTS):e.deltaPTS=S,l=Math.max(t,h),t=Math.min(t,h),s=Math.min(s,e.startDTS),c=Math.min(i,f),i=Math.max(i,f),r=Math.max(r,e.endDTS)}const p=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=i,e.minEndPTS=c,e.endDTS=r;const m=e.sn;if(!n||m<n.startSN||m>n.endSN)return 0;let _;const E=m-n.startSN,C=n.fragments;for(C[E]=e,_=E;_>0;_--)pu(C[_],C[_-1]);for(_=E;_<C.length-1;_++)pu(C[_],C[_+1]);return n.fragmentHint&&pu(C[C.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,p}function Kb(n,e){if(n===e)return;let t=null;const i=n.fragments;for(let h=i.length-1;h>=0;h--){const f=i[h].initSegment;if(f){t=f;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s;zb(n,e,(h,f,p,m)=>{if((!e.startCC||e.skippedSegments)&&f.cc!==h.cc){const _=h.cc-f.cc;for(let E=p;E<m.length;E++)m[E].cc+=_;e.endCC=m[m.length-1].cc}we(h.startPTS)&&we(h.endPTS)&&(f.setStart(f.startPTS=h.startPTS),f.startDTS=h.startDTS,f.maxStartPTS=h.maxStartPTS,f.endPTS=h.endPTS,f.endDTS=h.endDTS,f.minEndPTS=h.minEndPTS,f.setDuration(h.endPTS-h.startPTS),f.duration&&(s=f),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(f.elementaryStreams=h.elementaryStreams),f.loader=h.loader,h.hasStats&&(f.stats=h.stats),h.initSegment&&(f.initSegment=h.initSegment,t=h.initSegment)});const r=e.fragments,a=e.fragmentHint?r.concat(e.fragmentHint):r;if(t&&a.forEach(h=>{var f;h&&(!h.initSegment||h.initSegment.relurl===((f=t)==null?void 0:f.relurl))&&(h.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=r.some(h=>!h),e.deltaUpdateFailed){Ze.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)r.shift();e.startSN=r[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=qb(n.dateRanges,e));const h=n.fragments.filter(f=>f.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let f=1;f<a.length;f++)a[f].programDateTime===null&&yh(a[f],a[f-1],h);Cm(h,e)}e.endCC=r[r.length-1].cc}if(!e.startCC){var l;const h=Lm(n,e.startSN-1);e.startCC=(l=h?.cc)!=null?l:r[0].cc}Wb(n.partList,e.partList,(h,f)=>{f.elementaryStreams=h.elementaryStreams,f.stats=h.stats}),s?wm(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):Am(n,e),r.length&&(e.totalduration=e.edge-r[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const h=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=h),e.driftEndTime=c,e.driftEnd=h}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function qb(n,e){const{dateRanges:t,recentlyRemovedDateranges:i}=e,s=st({},n);i&&i.forEach(l=>{delete s[l]});const a=Object.keys(s).length;return a&&Object.keys(t).forEach(l=>{const c=s[l],h=new Em(t[l].attr,c);h.isValid?(s[l]=h,c||(h.tagOrder+=a)):Ze.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ft(t[l].attr)}"`)}),s}function Wb(n,e,t){if(n&&e){let i=0;for(let s=0,r=n.length;s<=r;s++){const a=n[s],l=e[s+i];a&&l&&a.index===l.index&&a.fragment.sn===l.fragment.sn?t(a,l):i--}}}function zb(n,e,t){const i=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,r=(n.fragmentHint?1:0)+(i?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,c=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let h=s;h<=r;h++){const f=c[a+h];let p=l[h];if(i&&!p&&f&&(p=e.fragments[h]=f),f&&p){if(t(f,p,h,l),f.url&&f.url!==p.url){e.playlistParsingError=Bf(`media sequence mismatch ${p.sn}:`,n,e,f,p);return}else if(f.cc!==p.cc){e.playlistParsingError=Bf(`discontinuity sequence mismatch (${f.cc}!=${p.cc})`,n,e,f,p);return}}}}function Bf(n,e,t,i,s){return new Error(`${n} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Am(n,e,t=!0){const i=e.startSN+e.skippedSegments-n.startSN,s=n.fragments,r=i>=0;let a=0;if(r&&i<s.length)a=s[i].start;else if(r&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(r&&t)a=n.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;Th(e,a)}function Th(n,e){if(e){const t=n.fragments;for(let i=n.skippedSegments;i<t.length;i++)t[i].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function Im(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const i=n.fragments;if(i.length&&t*4>e){const r=i[i.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function Lm(n,e,t){if(!n)return null;let i=n.fragments[e-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===e)?i:e<n.startSN&&t&&t.sn===e?t:null}function Uf(n,e,t){return n?km(n.partList,e,t):null}function km(n,e,t){if(n)for(let i=n.length;i--;){const s=n[i];if(s.index===t&&s.fragment.sn===e)return s}return null}function Rm(n){n.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function On(n,e){for(let i=0,s=n.length;i<s;i++){var t;if(((t=n[i])==null?void 0:t.cc)===e)return n[i]}return null}function Yb(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function $f(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function Pm(n,e){const t=e.fragments;for(let i=0,s=t.length;i<s;i++)$f(t[i],n);e.fragmentHint&&$f(e.fragmentHint,n),e.alignedSliding=!0}function Xb(n,e){n&&(Dm(e,n),!e.alignedSliding&&n&&Do(e,n),!e.alignedSliding&&n&&!e.skippedSegments&&Am(n,e,!1))}function Dm(n,e){if(!Yb(e,n))return;const t=Math.min(e.endCC,n.endCC),i=On(e.fragments,t),s=On(n.fragments,t);if(!i||!s)return;Ze.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=i.start-s.start;Pm(r,n)}function Do(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,i=e.fragments;if(!t.length||!i.length)return;let s,r;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(s=On(i,a),r=On(t,a)),(!s||!r)&&(s=i[Math.floor(i.length/2)],r=On(t,s.cc)||t[Math.floor(t.length/2)]);const l=s.programDateTime,c=r.programDateTime;if(!l||!c)return;const h=(c-l)/1e3-(r.start-s.start);Pm(h,n)}const Qb={toString:function(n){let e="";const t=n.length;for(let i=0;i<t;i++)e+=`[${n.start(i).toFixed(3)}-${n.end(i).toFixed(3)}]`;return e}},ce={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class ac extends Tm{constructor(e,t,i,s,r){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ce.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:l,media:c,mediaBuffer:h,state:f}=this,p=c?c.currentTime:0,m=Ue.bufferInfo(h||c,p,a.maxBufferHole),_=!m.len;if(this.log(`Media seeking to ${we(p)?p.toFixed(3):p}, state: ${f}, ${_?"out of":"in"} buffer`),this.state===ce.ENDED)this.resetLoadingState();else if(l){const E=a.maxFragLookUpTolerance,C=l.start-E,S=l.start+l.duration+E;if(_||S<m.start||C>m.end){const I=p>S;(p<C||I)&&(I&&l.loader&&(this.log(`Cancelling fragment load for seek (sn: ${l.sn})`),l.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(c){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const E=this.lastCurrentTime;if(p>E&&(this.lastCurrentTime=p),!this.loadingParts){const C=Math.max(m.end,p),S=this.shouldLoadParts(this.getLevelDetails(),C);S&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${C.toFixed(2)}`),this.loadingParts=S)}}this.hls.hasEnoughToStart||(this.log(`Setting ${_?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,_&&(this.startPosition=p)),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new Cb(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new sc(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ce.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ce.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,s=this.config.timelineOffset||0;if(i<=s)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=Ue.bufferedInfo(r,e.start,0));const a=e.nextStart;if(a&&a>s&&a<t.edge||this.media.currentTime<e.start)return!1;const c=t.partList;if(c!=null&&c.length){const f=c[c.length-1];return Ue.isBuffered(this.media,f.start+f.duration/2)}const h=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===ce.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ce.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const s=r=>{const a=r.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(a,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,i,s).then(r=>{if(!r)return;const a=this.state,l=r.frag;if(this.fragContextChanged(l)){(a===ce.FRAG_LOADING||!this.fragCurrent&&a===ce.PARSING)&&(this.fragmentTracker.removeFragment(l),this.state=ce.IDLE);return}"payload"in r&&(this.log(`Loaded ${l.type} sn: ${l.sn} of ${this.playlistLabel()} ${l.level}`),this.hls.trigger(L.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===ce.STOPPED||this.state===ce.ERROR||(this.warn(`Frag error: ${r?.message||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===Lt.APPENDING){const r=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,r),l=Math.max(e.duration,a?a.len:this.config.maxBufferLength),c=this.backtrackFragment;((c?e.sn-c.sn:0)===1||this.reduceMaxBufferLength(l,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===Lt.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:i};this.hls.trigger(L.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const s=i?.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{frag:r,payload:a}=i,l=r.decryptdata;if(a&&a.byteLength>0&&l!=null&&l.key&&l.iv&&Ur(l.method)){const c=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),l.key.buffer,l.iv.buffer,nc(l.method)).catch(h=>{throw s.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:r}),h}).then(h=>{const f=self.performance.now();return s.trigger(L.FRAG_DECRYPTED,{frag:r,payload:h,stats:{tstart:c,tdecrypt:f}}),i.payload=h,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===ce.STOPPED||this.state===ce.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==ce.STOPPED&&(this.state=ce.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?Qb.toString(Ue.getBuffered(i)):"(detached)"})`),At(e)){var s;if(e.type!==Ie.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(l=>!!a[l])){this.state=ce.IDLE;return}}const r=(s=this.levels)==null?void 0:s[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=ce.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:s,partsLoaded:r}=e,a=!r||r.length===0||r.some(c=>!c),l=new rc(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(l)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,s){var r;this.fragCurrent=e;const a=t?.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let l=null;e.encrypted&&!((r=e.decryptdata)!=null&&r.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ce.KEY_LOADING,this.fragCurrent=e,l=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(L.KEY_LOADED,p),this.state===ce.KEY_LOADING&&(this.state=ce.IDLE),p}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(l=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(l=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),l&&this.log("[eme] blocking frag load until media-keys acquired"));const c=this.fragPrevious;if(At(e)&&(!c||e.sn!==c.sn)){const p=this.shouldLoadParts(t.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${c?.sn}->${e.sn}`),this.loadingParts=p)}if(i=Math.max(e.start,i||0),this.loadingParts&&At(e)){const p=a.partList;if(p&&s){i>e.end&&a.fragmentHint&&(e=a.fragmentHint);const m=this.getNextPart(p,e,i);if(m>-1){const _=p[m];e=this.fragCurrent=_.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${_.index} (${m}/${p.length-1}) of ${this.fragInfo(e,!1,_)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=_.start+_.duration,this.state=ce.FRAG_LOADING;let E;return l?E=l.then(C=>!C||this.fragContextChanged(C.frag)?null:this.doFragPartsLoad(e,_,t,s)).catch(C=>this.handleFragLoadError(C)):E=this.doFragPartsLoad(e,_,t,s).catch(C=>this.handleFragLoadError(C)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:_,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(p,i))return Promise.resolve(null)}}if(At(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${a?"["+a.startSN+"-"+a.endSN+"]":""}, target: ${parseFloat(i.toFixed(3))}`),we(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ce.FRAG_LOADING;const h=this.config.progressive;let f;return h&&l?f=l.then(p=>!p||this.fragContextChanged(p?.frag)?null:this.fragmentLoader.load(e,s)).catch(p=>this.handleFragLoadError(p)):f=Promise.all([this.fragmentLoader.load(e,h?s:void 0),l]).then(([p])=>(!h&&p&&s&&s(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}doFragPartsLoad(e,t,i,s){return new Promise((r,a)=>{var l;const c=[],h=(l=i.details)==null?void 0:l.partList,f=p=>{this.fragmentLoader.loadPart(e,p,s).then(m=>{c[p.index]=m;const _=m.part;this.hls.trigger(L.FRAG_LOADED,m);const E=Uf(i.details,e.sn,p.index+1)||km(h,e.sn,p.index+1);if(E)f(E);else return r({frag:e,part:_,partsLoaded:c})}).catch(a)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===Y.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:ke.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ce.PARSING){!this.fragCurrent&&this.state!==ce.STOPPED&&this.state!==ce.ERROR&&(this.state=ce.IDLE);return}const{frag:i,part:s,level:r}=t,a=self.performance.now();i.stats.parsing.end=a,s&&(s.stats.parsing.end=a);const l=this.getLevelDetails(),h=l&&i.sn>l.endSN||this.shouldLoadParts(l,i.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=h),this.updateLevelTiming(i,s,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var i;const r=e.partList[0],a=r.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=a){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:s,sn:r,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const l=t[s],c=l.details,h=a>-1?Uf(c,r,a):null,f=h?h.fragment:Lm(c,r,i);return f?(i&&i!==f&&(f.stats=i.stats),{frag:f,part:h,level:l}):null}bufferFragmentData(e,t,i,s,r){var a;if(!e||this.state!==ce.PARSING)return;const{data1:l,data2:c}=e;let h=l;if(l&&c&&(h=gi(l,c)),!((a=h)!=null&&a.length))return;const f=this.initPTS[t.cc],p=f?-f.baseTime/f.timescale:void 0,m={type:e.type,frag:t,part:i,chunkMeta:s,offset:p,parent:t.type,data:h};if(this.hls.trigger(L.BUFFER_APPENDING,m),e.dropped&&e.independent&&!i){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ue.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,s=Ue.bufferInfo(t,i,0),r=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),l=Math.max(Math.min(e.start-a,s.end-a),i+a);e.start-l>a&&this.flushMainBuffer(l,e.start)}getFwdBufferInfo(e,t){var i;const s=this.getLoadPosition();if(!we(s))return null;const a=this.lastCurrentTime>s||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,a)}getFwdBufferInfoAtPos(e,t,i,s){const r=Ue.bufferInfo(e,t,s);if(r.len===0&&r.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,i);if(a&&(r.nextStart<=a.end||a.gap)){const l=Math.max(Math.min(r.nextStart,a.end)-t,s);return Ue.bufferInfo(e,t,l)}}return r}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,s=Math.max(Math.min(e-t,i.maxBufferLength),t),r=Math.max(e-t*3,i.maxMaxBufferLength/2,s);return r>=s?(i.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=Ie.MAIN){var i;const s=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(e,t);return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const i=t.fragments,s=i.length;if(!s)return null;const{config:r}=this,a=i[0].start,l=r.lowLatencyMode&&!!t.partList;let c=null;if(t.live){const p=r.initialLiveManifestSize;if(s<p)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var h;l&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),c=this.getInitialLiveFragment(t);const m=this.hls.startPosition,_=this.hls.liveSyncPosition,E=c?(m!==-1&&m>=a?m:_)||c.start:e;this.log(`Setting startPosition to ${E} to match start frag at live edge. mainStart: ${m} liveSyncPosition: ${_} frag.start: ${(h=c)==null?void 0:h.start}`),this.startPosition=this.nextLoadPosition=E}}else e<=a&&(c=i[0]);if(!c){const p=this.loadingParts?t.partEnd:t.fragmentEnd;c=this.getFragmentAtPosition(e,p,t)}let f=this.filterReplacedPrimary(c,t);if(!f&&c){const p=c.sn-t.startSN;f=this.filterReplacedPrimary(i[p+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===Lt.OK||i===Lt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,s,r){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&i.nextStart)){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s,0);if(l!==null&&i.len+l.len>=r){const c=a.sn;return this.loopSn!==c&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${c}`),this.loopSn=c),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(Hf(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Hf(this.hls.config)&&e.type!==Ie.SUBTITLE){const i=this.hls.interstitialsManager,s=i?.bufferingItem;if(s){const a=s.event;if(a){if(a.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&t?.live===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const r=i?.playerQueue;if(r)for(let a=r.length;a--;){const l=r[a].interstitial;if(l.appendInPlace&&e.start>=l.startTime&&e.end<=l.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let s=-1,r=!1,a=!0;for(let l=0,c=e.length;l<c;l++){const h=e[l];if(a=a&&!h.independent,s>-1&&i<h.start)break;const f=h.loaded;f?s=-1:(r||h.independent||a)&&h.fragment===t&&(s=l),r=f}return s}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let s=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=db(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const r=i.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=t[r-e.startSN];i.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=ym(e,i.cc,i.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(s=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,i){const{config:s}=this;let{fragPrevious:r}=this,{fragments:a,endSN:l}=i;const{fragmentHint:c}=i,{maxFragLookUpTolerance:h}=s,f=i.partList,p=!!(this.loadingParts&&f!=null&&f.length&&c);p&&c&&!this.bitrateTest&&f[f.length-1].fragment.sn===c.sn&&(a=a.concat(c),l=c.sn);let m;if(e<t){var _;const C=e<this.lastCurrentTime||e>t-h||(_=this.media)!=null&&_.paused||!this.startFragRequested?0:h;m=ar(r,a,e,C)}else m=a[a.length-1];if(m){const E=m.sn-i.startSN,C=this.fragmentTracker.getState(m);if((C===Lt.OK||C===Lt.PARTIAL&&m.gap)&&(r=m),r&&m.sn===r.sn&&(!p||f[0].fragment.sn>m.sn||!i.live&&!p)&&r&&m.level===r.level){const I=a[E+1];m.sn<l&&this.fragmentTracker.getState(I)!==Lt.OK?m=I:m=null}}return m}alignPlaylists(e,t,i){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,a=!t,l=e.alignedSliding&&we(r);if(a||!l&&!r){Xb(i,e);const c=e.fragmentStart;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),c}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const s=this.timelineOffset;if(i===-1){const r=this.startTimeOffset!==null,a=r?this.startTimeOffset:e.startTimeOffset;a!==null&&we(a)?(i=t+a,a<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${a} found in ${r?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+s}this.nextLoadPosition=i+s}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&At(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ce.FRAG_LOADING_WAITING_RETRY)&&(this.state=ce.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const E=this.getCurrentContext(t.chunkMeta);E&&(t.frag=E.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const r=t.details===Y.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(i,!0);const a=t.errorAction,{action:l,flags:c,retryCount:h=0,retryConfig:f}=a||{},p=!!a&&!!f,m=p&&l===$t.RetryRequest,_=p&&!a.resolved&&c===Si.MoveAllAlternatesMatchingHost;if(!m&&_&&At(i)&&!i.endList)this.resetFragmentErrors(e),this.treatAsGap(i),a.resolved=!0;else if((m||_)&&h<f.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const E=ic(f,h);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${h+1}/${f.maxNumRetry} in ${E}ms`),a.resolved=!0,this.retryDate=self.performance.now()+E,this.state=ce.FRAG_LOADING_WAITING_RETRY}else if(f&&a)if(this.resetFragmentErrors(e),h<f.maxNumRetry)!r&&l!==$t.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else l===$t.SendAlternateToPenaltyBox?this.state=ce.WAITING_LEVEL:this.state=ce.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===ce.PARSING||this.state===ce.PARSED){const t=e.frag,i=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,i),r=s&&s.len>.5;r&&this.reduceMaxBufferLength(s.len,t?.duration||10);const a=!r;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Ie.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ce.STOPPED&&(this.state=ce.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const s=Ue.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===ce.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ce.STOPPED&&(this.state=ce.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,s){const r=i.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((c,h)=>{const f=e.elementaryStreams[h];if(f){const p=f.endPTS-f.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${h} duration reliably (${p})`),c||!1;const m=s?0:wm(r,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:r,level:i,drift:m,type:h,frag:e,start:f.startPTS,end:f.endPTS}),!0}return c},!1)){var l;if(i.fragmentError===0&&this.treatAsGap(e,i),((l=this.transmuxer)==null?void 0:l.error)===null){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ce.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Ie.MAIN?"level":"track"}fragInfo(e,t=!0,i){var s,r;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((s=t&&!i?e.startPTS:(i||e).start)!=null?s:NaN).toFixed(3)}-${((r=t&&!i?e.endPTS:(i||e).end)!=null?r:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Hf(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class xm{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=Jb(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Jb(n,e){const t=new Uint8Array(e);let i=0;for(let s=0;s<n.length;s++){const r=n[s];t.set(r,i),i+=r.length}return t}var gu={exports:{}},jf;function Zb(){return jf||(jf=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(c,h,f){this.fn=c,this.context=h,this.once=f||!1}function r(c,h,f,p,m){if(typeof f!="function")throw new TypeError("The listener must be a function");var _=new s(f,p||c,m),E=t?t+h:h;return c._events[E]?c._events[E].fn?c._events[E]=[c._events[E],_]:c._events[E].push(_):(c._events[E]=_,c._eventsCount++),c}function a(c,h){--c._eventsCount===0?c._events=new i:delete c._events[h]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var h=[],f,p;if(this._eventsCount===0)return h;for(p in f=this._events)e.call(f,p)&&h.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(f)):h},l.prototype.listeners=function(h){var f=t?t+h:h,p=this._events[f];if(!p)return[];if(p.fn)return[p.fn];for(var m=0,_=p.length,E=new Array(_);m<_;m++)E[m]=p[m].fn;return E},l.prototype.listenerCount=function(h){var f=t?t+h:h,p=this._events[f];return p?p.fn?1:p.length:0},l.prototype.emit=function(h,f,p,m,_,E){var C=t?t+h:h;if(!this._events[C])return!1;var S=this._events[C],I=arguments.length,R,k;if(S.fn){switch(S.once&&this.removeListener(h,S.fn,void 0,!0),I){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,f),!0;case 3:return S.fn.call(S.context,f,p),!0;case 4:return S.fn.call(S.context,f,p,m),!0;case 5:return S.fn.call(S.context,f,p,m,_),!0;case 6:return S.fn.call(S.context,f,p,m,_,E),!0}for(k=1,R=new Array(I-1);k<I;k++)R[k-1]=arguments[k];S.fn.apply(S.context,R)}else{var D=S.length,x;for(k=0;k<D;k++)switch(S[k].once&&this.removeListener(h,S[k].fn,void 0,!0),I){case 1:S[k].fn.call(S[k].context);break;case 2:S[k].fn.call(S[k].context,f);break;case 3:S[k].fn.call(S[k].context,f,p);break;case 4:S[k].fn.call(S[k].context,f,p,m);break;default:if(!R)for(x=1,R=new Array(I-1);x<I;x++)R[x-1]=arguments[x];S[k].fn.apply(S[k].context,R)}}return!0},l.prototype.on=function(h,f,p){return r(this,h,f,p,!1)},l.prototype.once=function(h,f,p){return r(this,h,f,p,!0)},l.prototype.removeListener=function(h,f,p,m){var _=t?t+h:h;if(!this._events[_])return this;if(!f)return a(this,_),this;var E=this._events[_];if(E.fn)E.fn===f&&(!m||E.once)&&(!p||E.context===p)&&a(this,_);else{for(var C=0,S=[],I=E.length;C<I;C++)(E[C].fn!==f||m&&!E[C].once||p&&E[C].context!==p)&&S.push(E[C]);S.length?this._events[_]=S.length===1?S[0]:S:a(this,_)}return this},l.prototype.removeAllListeners=function(h){var f;return h?(f=t?t+h:h,this._events[f]&&a(this,f)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,n.exports=l}(gu)),gu.exports}var eS=Zb(),oc=LE(eS);const Hn="1.6.7",Wr={};function tS(){return typeof __HLS_WORKER_BUNDLE__=="function"}function iS(){const n=Wr[Hn];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Wr[Hn]=s,s}function sS(n){const e=Wr[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Wr[n]=s,s}function rS(n){const e=Wr[n||Hn];if(e&&e.clientCount--===1){const{worker:i,objectURL:s}=e;delete Wr[n||Hn],s&&self.URL.revokeObjectURL(s),i.terminate()}}function Om(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function lc(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function zo(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function jn(n,e){const t=e;let i=0;for(;lc(n,e);){i+=10;const s=zo(n,e+6);i+=s,Om(n,e+10)&&(i+=10),e+=i}if(i>0)return n.subarray(t,t+i)}function nS(n,e,t,i){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],a=r>>2&15;if(a>12){const _=new Error(`invalid ADTS sampling index:${a}`);n.emit(L.ERROR,L.ERROR,{type:ke.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!0,error:_,reason:_.message});return}const l=(r>>6&3)+1,c=e[t+3]>>6&3|(r&1)<<2,h="mp4a.40."+l,f=s[a];let p=a;(l===5||l===29)&&(p-=3);const m=[l<<3|(p&14)>>1,(p&1)<<7|c<<3];return Ze.log(`manifest codec:${i}, parsed codec:${h}, channels:${c}, rate:${f} (ADTS object type:${l} sampling index:${a})`),{config:m,samplerate:f,channelCount:c,codec:h,parsedCodec:h,manifestCodec:i}}function Mm(n,e){return n[e]===255&&(n[e+1]&246)===240}function Fm(n,e){return n[e+1]&1?7:9}function uc(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function aS(n,e){return e+5<n.length}function xo(n,e){return e+1<n.length&&Mm(n,e)}function oS(n,e){return aS(n,e)&&Mm(n,e)&&uc(n,e)<=n.length-e}function lS(n,e){if(xo(n,e)){const t=Fm(n,e);if(e+t>=n.length)return!1;const i=uc(n,e);if(i<=t)return!1;const s=e+i;return s===n.length||xo(n,s)}return!1}function Nm(n,e,t,i,s){if(!n.samplerate){const r=nS(e,t,i,s);if(!r)return;st(n,r)}}function Bm(n){return 1024*9e4/n}function uS(n,e){const t=Fm(n,e);if(e+t<=n.length){const i=uc(n,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function Um(n,e,t,i,s){const r=Bm(n.samplerate),a=i+s*r,l=uS(e,t);let c;if(l){const{frameLength:p,headerLength:m}=l,_=m+p,E=Math.max(0,t+_-e.length);E?(c=new Uint8Array(_-m),c.set(e.subarray(t+m,e.length),0)):c=e.subarray(t+m,t+_);const C={unit:c,pts:a};return E||n.samples.push(C),{sample:C,length:_,missing:E}}const h=e.length-t;return c=new Uint8Array(h),c.set(e.subarray(t,e.length),0),{sample:{unit:c,pts:a},length:h,missing:-1}}function hS(n,e){return lc(n,e)&&zo(n,e+6)+10<=n.length-e}function cS(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function mu(n,e=0,t=1/0){return dS(n,e,t,Uint8Array)}function dS(n,e,t,i){const s=fS(n);let r=1;"BYTES_PER_ELEMENT"in i&&(r=i.BYTES_PER_ELEMENT);const a=pS(n)?n.byteOffset:0,l=(a+n.byteLength)/r,c=(a+e)/r,h=Math.floor(Math.max(0,Math.min(c,l))),f=Math.floor(Math.min(h+Math.max(t,0),l));return new i(s,h,f-h)}function fS(n){return n instanceof ArrayBuffer?n:n.buffer}function pS(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function gS(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=n.data.subarray(1).indexOf(0);if(i===-1)return;const s=si(mu(n.data,1,i)),r=n.data[2+i],a=n.data.subarray(3+i).indexOf(0);if(a===-1)return;const l=si(mu(n.data,3+i,a));let c;return s==="-->"?c=si(mu(n.data,4+i+a)):c=cS(n.data.subarray(4+i+a)),e.mimeType=s,e.pictureType=r,e.description=l,e.data=c,e}function mS(n){if(n.size<2)return;const e=si(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function vS(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const i=si(n.data.subarray(t),!0);t+=i.length+1;const s=si(n.data.subarray(t));return{key:n.type,info:i,data:s}}const e=si(n.data.subarray(1));return{key:n.type,info:"",data:e}}function yS(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const i=si(n.data.subarray(t),!0);t+=i.length+1;const s=si(n.data.subarray(t));return{key:n.type,info:i,data:s}}const e=si(n.data);return{key:n.type,info:"",data:e}}function TS(n){return n.type==="PRIV"?mS(n):n.type[0]==="W"?yS(n):n.type==="APIC"?gS(n):vS(n)}function _S(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=zo(n,4),i=10;return{type:e,size:t,data:n.subarray(i,i+t)}}const Ua=10,ES=10;function $m(n){let e=0;const t=[];for(;lc(n,e);){const i=zo(n,e+6);n[e+5]>>6&1&&(e+=Ua),e+=Ua;const s=e+i;for(;e+ES<s;){const r=_S(n.subarray(e)),a=TS(r);a&&t.push(a),e+=r.size+Ua}Om(n,e)&&(e+=Ua)}return t}function Hm(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function bS(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function hc(n){const e=$m(n);for(let t=0;t<e.length;t++){const i=e[t];if(Hm(i))return bS(i)}}let ii=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function $i(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class cc{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=gi(this.cachedData,e),this.cachedData=null);let i=jn(e,0),s=i?i.length:0,r;const a=this._audioTrack,l=this._id3Track,c=i?hc(i):void 0,h=e.length;for((this.basePTS===null||this.frameIndex===0&&we(c))&&(this.basePTS=SS(c,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ii.audioId3,duration:Number.POSITIVE_INFINITY});s<h;){if(this.canParse(e,s)){const f=this.appendFrame(a,e,s);f?(this.frameIndex++,this.lastPTS=f.sample.pts,s+=f.length,r=s):s=h}else hS(e,s)?(i=jn(e,s),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ii.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,r=s):s++;if(s===h&&r!==h){const f=e.slice(r);this.cachedData?this.cachedData=gi(this.cachedData,f):this.cachedData=f}}return{audioTrack:a,videoTrack:$i(),id3Track:l,textTrack:$i()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:$i(),id3Track:this._id3Track,textTrack:$i()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const SS=(n,e,t)=>{if(we(n))return n*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let $a=null;const CS=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],wS=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],AS=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],IS=[0,1,1,4];function jm(n,e,t,i,s){if(t+24>e.length)return;const r=Vm(e,t);if(r&&t+r.frameLength<=e.length){const a=r.samplesPerFrame*9e4/r.sampleRate,l=i+s*a,c={unit:e.subarray(t,t+r.frameLength),pts:l,dts:l};return n.config=[],n.channelCount=r.channelCount,n.samplerate=r.sampleRate,n.samples.push(c),{sample:c,length:r.frameLength,missing:0}}}function Vm(n,e){const t=n[e+1]>>3&3,i=n[e+1]>>1&3,s=n[e+2]>>4&15,r=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&r!==3){const a=n[e+2]>>1&1,l=n[e+3]>>6,c=t===3?3-i:i===3?3:4,h=CS[c*14+s-1]*1e3,p=wS[(t===3?0:t===2?1:2)*3+r],m=l===3?1:2,_=AS[t][i],E=IS[i],C=_*8*E,S=Math.floor(_*h/p+a)*E;if($a===null){const k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$a=k?parseInt(k[1]):0}return!!$a&&$a<=87&&i===2&&h>=224e3&&l===0&&(n[e+3]=n[e+3]|128),{sampleRate:p,channelCount:m,frameLength:S,samplesPerFrame:C}}}function dc(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function Gm(n,e){return e+1<n.length&&dc(n,e)}function LS(n,e){return dc(n,e)&&4<=n.length-e}function Km(n,e){if(e+1<n.length&&dc(n,e)){const i=Vm(n,e);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const r=e+s;return r===n.length||Gm(n,r)}return!1}class kS extends cc{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=jn(e,0);let s=i?.length||0;if(Km(e,s))return!1;for(let r=e.length;s<r;s++)if(lS(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return oS(e,t)}appendFrame(e,t,i){Nm(e,this.observer,t,i,e.manifestCodec);const s=Um(e,t,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const qm=(n,e)=>{let t=0,i=5;e+=i;const s=new Uint32Array(1),r=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=n[e];const l=Math.min(i,8),c=8-l;r[0]=4278190080>>>24+c<<c,s[0]=(a[0]&r[0])>>c,t=t?t<<l|s[0]:s[0],e+=1,i-=l}return t};class RS extends cc{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const s=Wm(e,t,i,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=jn(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&hc(t)!==void 0&&qm(e,i)<16}}function Wm(n,e,t,i,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const l=[48e3,44100,32e3][r],c=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][c*3+r]*2;if(t+f>e.length)return-1;const p=e[t+6]>>5;let m=0;p===2?m+=2:(p&1&&p!==1&&(m+=2),p&4&&(m+=2));const _=(e[t+6]<<8|e[t+7])>>12-m&1,C=[2,1,2,3,3,4,4,5][p]+_,S=e[t+5]>>3,I=e[t+5]&7,R=new Uint8Array([r<<6|S<<1|I>>2,(I&3)<<6|p<<3|_<<2|c>>4,c<<4&224]),k=1536/l*9e4,D=i+s*k,x=e.subarray(t,t+f);return n.config=R,n.channelCount=C,n.samplerate=l,n.samples.push({unit:x,pts:D}),f}class PS extends cc{resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=jn(e,0);let i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&hc(t)!==void 0&&qm(e,i)<=16)return!1;for(let s=e.length;i<s;i++)if(Km(e,i))return Ze.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return LS(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return jm(e,t,i,this.basePTS,this.frameIndex)}}const DS=/\/emsg[-/]ID3/i;class xS{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,s){const r=this.videoTrack=$i("video",1),a=this.audioTrack=$i("audio",1),l=this.txtTrack=$i("text",1);if(this.id3Track=$i("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const c=um(e);if(c.video){const{id:h,timescale:f,codec:p,supplemental:m}=c.video;r.id=h,r.timescale=l.timescale=f,r.codec=p,r.supplemental=m}if(c.audio){const{id:h,timescale:f,codec:p}=c.audio;a.id=h,a.timescale=f,a.codec=p}l.id=am.text,r.sampleDuration=0,r.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return xE(e)}demux(e,t){this.timeOffset=t;let i=e;const s=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=gi(this.remainderData,e));const l=$E(i);this.remainderData=l.remainder,s.samples=l.valid||new Uint8Array}else s.samples=i;const a=this.extractID3Track(s,t);return r.samples=lf(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return i.samples=lf(e,t),{videoTrack:t,audioTrack:$i(),id3Track:s,textTrack:$i()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const s=je(e.samples,["emsg"]);s&&s.forEach(r=>{const a=jE(r);if(DS.test(a.schemeIdUri)){const l=Vf(a,t);let c=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;c<=.001&&(c=Number.POSITIVE_INFINITY);const h=a.payload;i.samples.push({data:h,len:h.byteLength,dts:l,pts:l,type:ii.emsg,duration:c})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const l=Vf(a,t);i.samples.push({data:a.payload,len:a.payload.byteLength,dts:l,pts:l,type:ii.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Vf(n,e){return we(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class OS{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new sc(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Bs.cbc)}decryptAacSample(e,t,i){const s=e[t].unit;if(s.length<=16)return;const r=s.subarray(16,s.length-s.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then(l=>{const c=new Uint8Array(l);s.set(c,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let s=0;for(let r=32;r<e.length-16;r+=160,s+=16)i.set(e.subarray(r,r+16),s);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let s=0;for(let r=32;r<e.length-16;r+=160,s+=16)e.set(i.subarray(s,s+16),r);return e}decryptAvcSample(e,t,i,s,r){const a=hm(r.data),l=this.getAvcEncryptedData(a);this.decryptBuffer(l.buffer).then(c=>{r.data=this.getAvcDecryptedUnit(a,c),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,s)})}decryptAvcSamples(e,t,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){s();return}const r=e[t].units;for(;!(i>=r.length);i++){const a=r[i];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,i,s,a),!this.decrypter.isSync()))return}}}}class zm{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,s;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const r=i.units;s=r[r.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,s=i.length;if(s){const r=i[s-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const s=t.byteLength;let r=e.naluState||0;const a=r,l=[];let c=0,h,f,p,m=-1,_=0;for(r===-1&&(m=0,_=this.getNALuType(t,0),r=0,c=1);c<s;){if(h=t[c++],!r){r=h?0:1;continue}if(r===1){r=h?0:2;continue}if(!h)r=3;else if(h===1){if(f=c-r-1,m>=0){const E={data:t.subarray(m,f),type:_};l.push(E)}else{const E=this.getLastNalUnit(e.samples);E&&(a&&c<=4-a&&E.state&&(E.data=E.data.subarray(0,E.data.byteLength-a)),f>0&&(E.data=gi(E.data,t.subarray(0,f)),E.state=0))}c<s?(p=this.getNALuType(t,c),m=c,_=p,r=0):r=-1}else r=0}if(m>=0&&r>=0){const E={data:t.subarray(m,s),type:_,state:r};l.push(E)}if(l.length===0){const E=this.getLastNalUnit(e.samples);E&&(E.data=gi(E.data,t))}return e.naluState=r,l}}class Mn{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");s.set(e.subarray(i,i+r)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&Ze.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Gf extends zm{parsePES(e,t,i,s){const r=this.parseNALu(e,i.data,s);let a=this.VideoSample,l,c=!1;i.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),r.forEach(h=>{var f,p;switch(h.type){case 1:{let C=!1;l=!0;const S=h.data;if(c&&S.length>4){const I=this.readSliceType(S);(I===2||I===4||I===7||I===9)&&(C=!0)}if(C){var m;(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.frame=!0,a.key=C;break}case 5:l=!0,(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 6:{l=!0,Zh(h.data,1,i.pts,t.samples);break}case 7:{var _,E;l=!0,c=!0;const C=h.data,S=this.readSPS(C);if(!e.sps||e.width!==S.width||e.height!==S.height||((_=e.pixelRatio)==null?void 0:_[0])!==S.pixelRatio[0]||((E=e.pixelRatio)==null?void 0:E[1])!==S.pixelRatio[1]){e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.sps=[C];const I=C.subarray(1,4);let R="avc1.";for(let k=0;k<3;k++){let D=I[k].toString(16);D.length<2&&(D="0"+D),R+=D}e.codec=R}break}case 8:l=!0,e.pps=[h.data];break;case 9:l=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:l=!0;break;default:l=!1;break}a&&l&&a.units.push(h)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Mn(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,s=8,r;for(let a=0;a<e;a++)s!==0&&(r=t.readEG(),s=(i+r+256)%256),i=s===0?i:s}readSPS(e){const t=new Mn(e);let i=0,s=0,r=0,a=0,l,c,h;const f=t.readUByte.bind(t),p=t.readBits.bind(t),m=t.readUEG.bind(t),_=t.readBoolean.bind(t),E=t.skipBits.bind(t),C=t.skipEG.bind(t),S=t.skipUEG.bind(t),I=this.skipScalingList.bind(this);f();const R=f();if(p(5),E(3),f(),S(),R===100||R===110||R===122||R===244||R===44||R===83||R===86||R===118||R===128){const H=m();if(H===3&&E(1),S(),S(),E(1),_())for(c=H!==3?8:12,h=0;h<c;h++)_()&&(h<6?I(16,t):I(64,t))}S();const k=m();if(k===0)m();else if(k===1)for(E(1),C(),C(),l=m(),h=0;h<l;h++)C();S(),E(1);const D=m(),x=m(),N=p(1);N===0&&E(1),E(1),_()&&(i=m(),s=m(),r=m(),a=m());let B=[1,1];if(_()&&_())switch(f()){case 1:B=[1,1];break;case 2:B=[12,11];break;case 3:B=[10,11];break;case 4:B=[16,11];break;case 5:B=[40,33];break;case 6:B=[24,11];break;case 7:B=[20,11];break;case 8:B=[32,11];break;case 9:B=[80,33];break;case 10:B=[18,11];break;case 11:B=[15,11];break;case 12:B=[64,33];break;case 13:B=[160,99];break;case 14:B=[4,3];break;case 15:B=[3,2];break;case 16:B=[2,1];break;case 255:{B=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((D+1)*16-i*2-s*2),height:(2-N)*(x+1)*16-(N?2:4)*(r+a),pixelRatio:B}}}class Kf extends zm{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,s){const r=this.parseNALu(e,i.data,s);let a=this.VideoSample,l,c=!1;i.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),r.forEach(h=>{var f,p;switch(h.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.frame=!0,l=!0;break;case 16:case 17:case 18:case 21:if(l=!0,c){var m;(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:l=!0,(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 39:l=!0,Zh(h.data,2,i.pts,t.samples);break;case 32:l=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=st(e.params,this.readVPS(h.data)),this.initVPS=h.data),e.vps=[h.data];break;case 33:if(l=!0,c=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],h.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const _=this.readSPS(h.data);e.width=_.width,e.height=_.height,e.pixelRatio=_.pixelRatio,e.codec=_.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const E in _.params)e.params[E]=_.params[E]}this.pushParameterSet(e.sps,h.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0;break;case 34:if(l=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const _=this.readPPS(h.data);for(const E in _)e.params[E]=_[E]}this.pushParameterSet(e.pps,h.data,e.vps)}break;case 35:l=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:l=!1;break}a&&l&&a.units.push(h)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[i]=e[s],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Mn(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:s}}readSPS(e){const t=new Mn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const s=t.readBits(2),r=t.readBoolean(),a=t.readBits(5),l=t.readUByte(),c=t.readUByte(),h=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),_=t.readUByte(),E=t.readUByte(),C=t.readUByte(),S=t.readUByte(),I=t.readUByte(),R=[],k=[];for(let Oe=0;Oe<i;Oe++)R.push(t.readBoolean()),k.push(t.readBoolean());if(i>0)for(let Oe=i;Oe<8;Oe++)t.readBits(2);for(let Oe=0;Oe<i;Oe++)R[Oe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),k[Oe]&&t.readUByte();t.readUEG();const D=t.readUEG();D==3&&t.skipBits(1);const x=t.readUEG(),N=t.readUEG(),B=t.readBoolean();let H=0,O=0,P=0,G=0;B&&(H+=t.readUEG(),O+=t.readUEG(),P+=t.readUEG(),G+=t.readUEG());const J=t.readUEG(),se=t.readUEG(),ie=t.readUEG(),ne=t.readBoolean();for(let Oe=ne?0:i;Oe<=i;Oe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Ke=0;Ke<4;Ke++)for(let Et=0;Et<(Ke===3?2:6);Et++)if(!t.readBoolean())t.readUEG();else{const bt=Math.min(64,1<<4+(Ke<<1));Ke>1&&t.readEG();for(let Nt=0;Nt<bt;Nt++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const ee=t.readUEG();let oe=0;for(let Oe=0;Oe<ee;Oe++){let Ke=!1;if(Oe!==0&&(Ke=t.readBoolean()),Ke){Oe===ee&&t.readUEG(),t.readBoolean(),t.readUEG();let Et=0;for(let Ht=0;Ht<=oe;Ht++){const bt=t.readBoolean();let Nt=!1;bt||(Nt=t.readBoolean()),(bt||Nt)&&Et++}oe=Et}else{const Et=t.readUEG(),Ht=t.readUEG();oe=Et+Ht;for(let bt=0;bt<Et;bt++)t.readUEG(),t.readBoolean();for(let bt=0;bt<Ht;bt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Oe=t.readUEG();for(let Ke=0;Ke<Oe;Ke++){for(let Et=0;Et<ie+4;Et++)t.readBits(1);t.readBits(1)}}let le=0,Q=1,te=1,Se=!0,be=1,Pe=0;t.readBoolean(),t.readBoolean();let Me=!1;if(t.readBoolean()){if(t.readBoolean()){const mt=t.readUByte(),mi=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ot=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];mt>0&&mt<16?(Q=mi[mt-1],te=Ot[mt-1]):mt===255&&(Q=t.readBits(16),te=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Me=t.readBoolean(),Me&&(H+=t.readUEG(),O+=t.readUEG(),P+=t.readUEG(),G+=t.readUEG()),t.readBoolean()&&(be=t.readBits(32),Pe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Ot=t.readBoolean(),St=t.readBoolean();let kt=!1;(Ot||St)&&(kt=t.readBoolean(),kt&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),kt&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let qt=0;qt<=i;qt++){Se=t.readBoolean();const Rt=Se||t.readBoolean();let It=!1;Rt?t.readEG():It=t.readBoolean();const M=It?1:t.readUEG()+1;if(Ot)for(let b=0;b<M;b++)t.readUEG(),t.readUEG(),kt&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(St)for(let b=0;b<M;b++)t.readUEG(),t.readUEG(),kt&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),le=t.readUEG())}let $e=x,Ve=N;if(B||Me){let Oe=1,Ke=1;D===1?Oe=Ke=2:D==2&&(Oe=2),$e=x-Oe*O-Oe*H,Ve=N-Ke*G-Ke*P}const Je=s?["A","B","C"][s]:"",Ye=l<<24|c<<16|h<<8|f;let ti=0;for(let Oe=0;Oe<32;Oe++)ti=(ti|(Ye>>Oe&1)<<31-Oe)>>>0;let Kt=ti.toString(16);return a===1&&Kt==="2"&&(Kt="6"),{codecString:`hvc1.${Je}${a}.${Kt}.${r?"H":"L"}${I}.B0`,params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:s,general_profile_compatibility_flags:[l,c,h,f],general_constraint_indicator_flags:[p,m,_,E,C,S],general_level_idc:I,bit_depth:J+8,bit_depth_luma_minus8:J,bit_depth_chroma_minus8:se,min_spatial_segmentation_idc:le,chroma_format_idc:D,frame_rate:{fixed:Se,fps:Pe/be}},width:$e,height:Ve,pixelRatio:[Q,te]}}readPPS(e){const t=new Mn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),r=t.readBoolean();let a=1;return r&&s?a=0:r?a=3:s&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Dt=188;class Is{constructor(e,t,i,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=s,this.videoParser=null}static probe(e,t){const i=Is.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(Dt*5,t-Dt)+1,s=0;for(;s<i;){let r=!1,a=-1,l=0;for(let c=s;c<t;c+=Dt)if(e[c]===71&&(t-c===Dt||e[c+Dt]===71)){if(l++,a===-1&&(a=c,a!==0&&(i=Math.min(a+Dt*99,e.length-Dt)+1)),r||(r=_h(e,c)===0),r&&l>1&&(a===0&&l>2||c+Dt>i))return a}else{if(l)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:am[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Is.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=Is.createTrack("audio",s),this._id3Track=Is.createTrack("id3"),this._txtTrack=Is.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,s=!1){i||(this.sampleAes=null);let r;const a=this._videoTrack,l=this._audioTrack,c=this._id3Track,h=this._txtTrack;let f=a.pid,p=a.pesData,m=l.pid,_=c.pid,E=l.pesData,C=c.pesData,S=null,I=this.pmtParsed,R=this._pmtId,k=e.length;if(this.remainderData&&(e=gi(this.remainderData,e),k=e.length,this.remainderData=null),k<Dt&&!s)return this.remainderData=e,{audioTrack:l,videoTrack:a,id3Track:c,textTrack:h};const D=Math.max(0,Is.syncOffset(e));k-=(k-D)%Dt,k<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,k,e.buffer.byteLength-k));let x=0;for(let B=D;B<k;B+=Dt)if(e[B]===71){const H=!!(e[B+1]&64),O=_h(e,B),P=(e[B+3]&48)>>4;let G;if(P>1){if(G=B+5+e[B+4],G===B+Dt)continue}else G=B+4;switch(O){case f:if(H){if(p&&(r=Lr(p,this.logger))){if(this.videoParser===null)switch(a.segmentCodec){case"avc":this.videoParser=new Gf;break;case"hevc":this.videoParser=new Kf;break}this.videoParser!==null&&this.videoParser.parsePES(a,h,r,!1)}p={data:[],size:0}}p&&(p.data.push(e.subarray(G,B+Dt)),p.size+=B+Dt-G);break;case m:if(H){if(E&&(r=Lr(E,this.logger)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,r);break;case"mp3":this.parseMPEGPES(l,r);break;case"ac3":this.parseAC3PES(l,r);break}E={data:[],size:0}}E&&(E.data.push(e.subarray(G,B+Dt)),E.size+=B+Dt-G);break;case _:H&&(C&&(r=Lr(C,this.logger))&&this.parseID3PES(c,r),C={data:[],size:0}),C&&(C.data.push(e.subarray(G,B+Dt)),C.size+=B+Dt-G);break;case 0:H&&(G+=e[G]+1),R=this._pmtId=MS(e,G);break;case R:{H&&(G+=e[G]+1);const J=FS(e,G,this.typeSupported,i,this.observer,this.logger);f=J.videoPid,f>0&&(a.pid=f,a.segmentCodec=J.segmentVideoCodec),m=J.audioPid,m>0&&(l.pid=m,l.segmentCodec=J.segmentAudioCodec),_=J.id3Pid,_>0&&(c.pid=_),S!==null&&!I&&(this.logger.warn(`MPEG-TS PMT found at ${B} after unknown PID '${S}'. Backtracking to sync byte @${D} to parse all TS packets.`),S=null,B=D-188),I=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=O;break}}else x++;x>0&&Eh(this.observer,new Error(`Found ${x} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=p,l.pesData=E,c.pesData=C;const N={audioTrack:l,videoTrack:a,id3Track:c,textTrack:h};return s&&this.extractRemainingSamples(N),N}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:s,textTrack:r}=e,a=i.pesData,l=t.pesData,c=s.pesData;let h;if(a&&(h=Lr(a,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new Gf;break;case"hevc":this.videoParser=new Kf;break}this.videoParser!==null&&(this.videoParser.parsePES(i,r,h,!0),i.pesData=null)}else i.pesData=a;if(l&&(h=Lr(l,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,h);break;case"mp3":this.parseMPEGPES(t,h);break;case"ac3":this.parseAC3PES(t,h);break}t.pesData=null}else l!=null&&l.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=l;c&&(h=Lr(c,this.logger))?(this.parseID3PES(s,h),s.pesData=null):s.pesData=c}demuxSampleAes(e,t,i){const s=this.demux(e,i,!0,!this.config.progressive),r=this.sampleAes=new OS(this.observer,this.config,t);return this.decrypt(s,r)}decrypt(e,t){return new Promise(i=>{const{audioTrack:s,videoTrack:r}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{i(e)}):i(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const s=this.aacOverFlow;let r=t.data;if(s){this.aacOverFlow=null;const p=s.missing,m=s.sample.unit.byteLength;if(p===-1)r=gi(s.sample.unit,r);else{const _=m-p;s.sample.unit.set(r.subarray(0,p),_),e.samples.push(s.sample),i=s.missing}}let a,l;for(a=i,l=r.length;a<l-1&&!xo(r,a);a++);if(a!==i){let p;const m=a<l-1;if(m?p=`AAC PES did not start with ADTS header,offset:${a}`:p="No ADTS header found in AAC PES",Eh(this.observer,new Error(p),m,this.logger),!m)return}Nm(e,this.observer,r,a,this.audioCodec);let c;if(t.pts!==void 0)c=t.pts;else if(s){const p=Bm(e.samplerate);c=s.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,f;for(;a<l;)if(f=Um(e,r,a,c,h),a+=f.length,f.missing){this.aacOverFlow=f;break}else for(h++;a<l-1&&!xo(r,a);a++);}parseMPEGPES(e,t){const i=t.data,s=i.length;let r=0,a=0;const l=t.pts;if(l===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(Gm(i,a)){const c=jm(e,i,a,l,r);if(c)a+=c.length,r++;else break}else a++}parseAC3PES(e,t){{const i=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=i.length;let a=0,l=0,c;for(;l<r&&(c=Wm(e,i,l,s,a++))>0;)l+=c}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=st({},t,{type:this._videoTrack?ii.emsg:ii.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function _h(n,e){return((n[e+1]&31)<<8)+n[e+2]}function MS(n,e){return(n[e+10]&31)<<8|n[e+11]}function FS(n,e,t,i,s,r){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=(n[e+1]&15)<<8|n[e+2],c=e+3+l-4,h=(n[e+10]&15)<<8|n[e+11];for(e+=12+h;e<c;){const f=_h(n,e),p=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!i){vu("ADTS AAC",r);break}case 15:a.audioPid===-1&&(a.audioPid=f);break;case 21:a.id3Pid===-1&&(a.id3Pid=f);break;case 219:if(!i){vu("H.264",r);break}case 27:a.videoPid===-1&&(a.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=f,a.segmentAudioCodec="mp3");break;case 193:if(!i){vu("AC-3",r);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=f,a.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&p>0){let m=e+5,_=p;for(;_>2;){switch(n[m]){case 106:t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=f,a.segmentAudioCodec="ac3");break}const C=n[m+1]+2;m+=C,_-=C}}break;case 194:case 135:return Eh(s,new Error("Unsupported EC-3 in M2TS found"),void 0,r),a;case 36:a.videoPid===-1&&(a.videoPid=f,a.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=p+5}return a}function Eh(n,e,t,i){i.warn(`parsing error: ${e.message}`),n.emit(L.ERROR,L.ERROR,{type:ke.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function vu(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Lr(n,e){let t=0,i,s,r,a,l;const c=n.data;if(!n||n.size===0)return null;for(;c[0].length<19&&c.length>1;)c[0]=gi(c[0],c[1]),c.splice(1,1);if(i=c[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(s=(i[4]<<8)+i[5],s&&s>n.size-6)return null;const f=i[7];f&192&&(a=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,f&64?(l=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,a-l>60*9e4&&(e.warn(`${Math.round((a-l)/9e4)}s delta between PTS and DTS, align them`),a=l)):l=a),r=i[8];let p=r+9;if(n.size<=p)return null;n.size-=p;const m=new Uint8Array(n.size);for(let _=0,E=c.length;_<E;_++){i=c[_];let C=i.byteLength;if(p)if(p>C){p-=C;continue}else i=i.subarray(p),C-=p,p=0;m.set(i,t),t+=C}return s&&(s-=r+3),{data:m,pts:a,dts:l,len:s}}return null}class NS{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const _s=Math.pow(2,32)-1;class W{static init(){W.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in W.types)W.types.hasOwnProperty(e)&&(W.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);W.HDLR_TYPES={video:t,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);W.STTS=W.STSC=W.STCO=r,W.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),W.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),W.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),W.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);W.FTYP=W.box(W.types.ftyp,a,c,a,l),W.DINF=W.box(W.types.dinf,W.box(W.types.dref,s))}static box(e,...t){let i=8,s=t.length;const r=s;for(;s--;)i+=t[s].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(e,4),s=0,i=8;s<r;s++)a.set(t[s],i),i+=t[s].byteLength;return a}static hdlr(e){return W.box(W.types.hdlr,W.HDLR_TYPES[e])}static mdat(e){return W.box(W.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(_s+1)),s=Math.floor(t%(_s+1));return W.box(W.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return W.box(W.types.mdia,W.mdhd(e.timescale||0,e.duration||0),W.hdlr(e.type),W.minf(e))}static mfhd(e){return W.box(W.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?W.box(W.types.minf,W.box(W.types.smhd,W.SMHD),W.DINF,W.stbl(e)):W.box(W.types.minf,W.box(W.types.vmhd,W.VMHD),W.DINF,W.stbl(e))}static moof(e,t,i){return W.box(W.types.moof,W.mfhd(e),W.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=W.trak(e[t]);return W.box.apply(null,[W.types.moov,W.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(W.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=W.trex(e[t]);return W.box.apply(null,[W.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(_s+1)),s=Math.floor(t%(_s+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return W.box(W.types.mvhd,r)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let s,r;for(s=0;s<t.length;s++)r=t[s].flags,i[s+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return W.box(W.types.sdtp,i)}static stbl(e){return W.box(W.types.stbl,W.stsd(e),W.box(W.types.stts,W.STTS),W.box(W.types.stsc,W.STSC),W.box(W.types.stsz,W.STSZ),W.box(W.types.stco,W.STCO))}static avc1(e){let t=[],i=[],s,r,a;for(s=0;s<e.sps.length;s++)r=e.sps[s],a=r.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(r));for(s=0;s<e.pps.length;s++)r=e.pps[s],a=r.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(r));const l=W.box(W.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),c=e.width,h=e.height,f=e.pixelRatio[0],p=e.pixelRatio[1];return W.box(W.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,W.box(W.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),W.box(W.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return W.box(W.types.mp4a,W.audioStsd(e),W.box(W.types.esds,W.esds(e)))}static mp3(e){return W.box(W.types[".mp3"],W.audioStsd(e))}static ac3(e){return W.box(W.types["ac-3"],W.audioStsd(e),W.box(W.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return W.box(W.types.stsd,W.STSD,W.mp4a(e));if(t==="ac3"&&e.config)return W.box(W.types.stsd,W.STSD,W.ac3(e));if(t==="mp3"&&e.codec==="mp3")return W.box(W.types.stsd,W.STSD,W.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return W.box(W.types.stsd,W.STSD,W.avc1(e));if(t==="hevc"&&e.vps)return W.box(W.types.stsd,W.STSD,W.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),s=e.width||0,r=e.height||0,a=Math.floor(i/(_s+1)),l=Math.floor(i%(_s+1));return W.box(W.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const i=W.sdtp(e),s=e.id,r=Math.floor(t/(_s+1)),a=Math.floor(t%(_s+1));return W.box(W.types.traf,W.box(W.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),W.box(W.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,a>>24,a>>16&255,a>>8&255,a&255])),W.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,W.box(W.types.trak,W.tkhd(e),W.mdia(e))}static trex(e){const t=e.id;return W.box(W.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],s=i.length,r=12+16*s,a=new Uint8Array(r);let l,c,h,f,p,m;for(t+=8+r,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),l=0;l<s;l++)c=i[l],h=c.duration,f=c.size,p=c.flags,m=c.cts,a.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,m>>>24&255,m>>>16&255,m>>>8&255,m&255],12+16*l);return W.box(W.types.trun,a)}static initSegment(e){W.types||W.init();const t=W.moov(e);return gi(W.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],s=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let a=r.length;for(let E=0;E<i.length;E+=1){a+=3;for(let C=0;C<i[E].length;C+=1)a+=2+i[E][C].length}const l=new Uint8Array(a);l.set(r,0),a=r.length;const c=i.length-1;for(let E=0;E<i.length;E+=1){l.set(new Uint8Array([32+E|(E===c?128:0),0,i[E].length]),a),a+=3;for(let C=0;C<i[E].length;C+=1)l.set(new Uint8Array([i[E][C].length>>8,i[E][C].length&255]),a),a+=2,l.set(i[E][C],a),a+=i[E][C].length}const h=W.box(W.types.hvcC,l),f=e.width,p=e.height,m=e.pixelRatio[0],_=e.pixelRatio[1];return W.box(W.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,W.box(W.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),W.box(W.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,_>>24,_>>16&255,_>>8&255,_&255])))}}W.types=void 0;W.HDLR_TYPES=void 0;W.STTS=void 0;W.STSC=void 0;W.STCO=void 0;W.STSZ=void 0;W.VMHD=void 0;W.SMHD=void 0;W.STSD=void 0;W.FTYP=void 0;W.DINF=void 0;const Ym=9e4;function fc(n,e,t=1,i=!1){const s=n*e*t;return i?Math.round(s):s}function BS(n,e,t=1,i=!1){return fc(n,e,1/t,i)}function yn(n,e=!1){return fc(n,1e3,1/Ym,e)}function US(n,e=1){return fc(n,Ym,1/e)}const $S=10*1e3,HS=1024,jS=1152,VS=1536;let kr=null,yu=null;function qf(n,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class co extends Ai{constructor(e,t,i,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,kr===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);kr=a?parseInt(a[1]):0}if(yu===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);yu=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,s=e.reduce((r,a)=>{let l=a.pts,c=l-r;return c<-4294967296&&(t=!0,l=di(l,i),c=l-r),c>0?r:l},i);return t&&this.debug("PTS rollover detected"),s}remux(e,t,i,s,r,a,l,c){let h,f,p,m,_,E,C=r,S=r;const I=e.pid>-1,R=t.pid>-1,k=t.samples.length,D=e.samples.length>0,x=l&&k>0||k>1;if((!I||D)&&(!R||x)||this.ISGenerated||l){if(this.ISGenerated){var B,H,O,P;const ie=this.videoTrackConfig;(ie&&(t.width!==ie.width||t.height!==ie.height||((B=t.pixelRatio)==null?void 0:B[0])!==((H=ie.pixelRatio)==null?void 0:H[0])||((O=t.pixelRatio)==null?void 0:O[1])!==((P=ie.pixelRatio)==null?void 0:P[1]))||!ie&&x||this.nextAudioTs===null&&D)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,r,a));const G=this.isVideoContiguous;let J=-1,se;if(x&&(J=GS(t.samples),!G&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,J>0){this.warn(`Dropped ${J} out of ${k} video samples due to a missing keyframe`);const ie=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(J),t.dropped+=J,S+=(t.samples[0].pts-ie)/t.inputTimeScale,se=S}else J===-1&&(this.warn(`No keyframe found out of ${k} video samples`),E=!1);if(this.ISGenerated){if(D&&x){const ie=this.getVideoStartPts(t.samples),ae=(di(e.samples[0].pts,ie)-ie)/t.inputTimeScale;C+=Math.max(0,ae),S+=Math.max(0,-ae)}if(D){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,r,a)),f=this.remuxAudio(e,C,this.isAudioContiguous,a,R||x||c===Ie.AUDIO?S:void 0),x){const ie=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,r,a)),h=this.remuxVideo(t,S,G,ie)}}else x&&(h=this.remuxVideo(t,S,G,0));h&&(h.firstKeyFrame=J,h.independent=J!==-1,h.firstKeyFramePTS=se)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(_=Xm(i,r,this._initPTS,this._initDTS)),s.samples.length&&(m=Qm(s,r,this._initPTS))),{audio:f,video:h,initSegment:p,independent:E,text:m,id3:_}}generateIS(e,t,i,s){const r=e.samples,a=t.samples,l=this.typeSupported,c={},h=this._initPTS;let f=!h||s,p="audio/mp4",m,_,E,C;if(f&&(m=_=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":l.mpeg?(p="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}c.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&l.mpeg?new Uint8Array(0):W.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(C=e.id,E=e.inputTimeScale,!h||E!==h.timescale?m=_=r[0].pts-Math.round(E*i):f=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:W.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(C=t.id,E=t.inputTimeScale,!h||E!==h.timescale){const S=this.getVideoStartPts(a),I=Math.round(E*i);_=Math.min(_,di(a[0].dts,S)-I),m=Math.min(m,S-I)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,f?(this._initPTS={baseTime:m,timescale:E},this._initDTS={baseTime:_,timescale:E}):m=E=void 0,{tracks:c,initPTS:m,timescale:E,trackId:C}}remuxVideo(e,t,i,s){const r=e.inputTimeScale,a=e.samples,l=[],c=a.length,h=this._initPTS,f=h.baseTime*r/h.timescale;let p=this.nextVideoTs,m=8,_=this.videoSampleDuration,E,C,S=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,R=!1;if(!i||p===null){const le=f+t*r,Q=a[0].pts-di(a[0].dts,a[0].pts);kr&&p!==null&&Math.abs(le-Q-(p+f))<15e3?i=!0:p=le-Q-f}const k=p+f;for(let le=0;le<c;le++){const Q=a[le];Q.pts=di(Q.pts,k),Q.dts=di(Q.dts,k),Q.dts<a[le>0?le-1:le].dts&&(R=!0)}R&&a.sort(function(le,Q){const te=le.dts-Q.dts,Se=le.pts-Q.pts;return te||Se}),E=a[0].dts,C=a[a.length-1].dts;const D=C-E,x=D?Math.round(D/(c-1)):_||e.inputTimeScale/30;if(i){const le=E-k,Q=le>x,te=le<-1;if((Q||te)&&(Q?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yn(le,!0)} ms (${le}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yn(-le,!0)} ms (${le}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!te||k>=a[0].pts||kr)){E=k;const Se=a[0].pts-le;if(Q)a[0].dts=E,a[0].pts=Se;else{let be=!0;for(let Pe=0;Pe<a.length&&!(a[Pe].dts>Se&&be);Pe++){const Me=a[Pe].pts;if(a[Pe].dts-=le,a[Pe].pts-=le,Pe<a.length-1){const De=a[Pe+1].pts,$e=a[Pe].pts,Ve=De<=$e,Je=De<=Me;be=Ve==Je}}}this.log(`Video: Initial PTS/DTS adjusted: ${yn(Se,!0)}/${yn(E,!0)}, delta: ${yn(le,!0)} ms`)}}E=Math.max(0,E);let N=0,B=0,H=E;for(let le=0;le<c;le++){const Q=a[le],te=Q.units,Se=te.length;let be=0;for(let Pe=0;Pe<Se;Pe++)be+=te[Pe].data.length;B+=be,N+=Se,Q.length=be,Q.dts<H?(Q.dts=H,H+=x/4|0||1):H=Q.dts,S=Math.min(Q.pts,S),I=Math.max(Q.pts,I)}C=a[c-1].dts;const O=B+4*N+8;let P;try{P=new Uint8Array(O)}catch(le){this.observer.emit(L.ERROR,L.ERROR,{type:ke.MUX_ERROR,details:Y.REMUX_ALLOC_ERROR,fatal:!1,error:le,bytes:O,reason:`fail allocating video mdat ${O}`});return}const G=new DataView(P.buffer);G.setUint32(0,O),P.set(W.types.mdat,4);let J=!1,se=Number.POSITIVE_INFINITY,ie=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,ae=Number.NEGATIVE_INFINITY;for(let le=0;le<c;le++){const Q=a[le],te=Q.units;let Se=0;for(let Me=0,De=te.length;Me<De;Me++){const $e=te[Me],Ve=$e.data,Je=$e.data.byteLength;G.setUint32(m,Je),m+=4,P.set(Ve,m),m+=Je,Se+=4+Je}let be;if(le<c-1)_=a[le+1].dts-Q.dts,be=a[le+1].pts-Q.pts;else{const Me=this.config,De=le>0?Q.dts-a[le-1].dts:x;if(be=le>0?Q.pts-a[le-1].pts:x,Me.stretchShortVideoTrack&&this.nextAudioTs!==null){const $e=Math.floor(Me.maxBufferHole*r),Ve=(s?S+s*r:this.nextAudioTs+f)-Q.pts;Ve>$e?(_=Ve-De,_<0?_=De:J=!0,this.log(`It is approximately ${Ve/90} ms to the next segment; using duration ${_/90} ms for the last video frame.`)):_=De}else _=De}const Pe=Math.round(Q.pts-Q.dts);se=Math.min(se,_),ne=Math.max(ne,_),ie=Math.min(ie,be),ae=Math.max(ae,be),l.push(qf(Q.key,_,Se,Pe))}if(l.length){if(kr){if(kr<70){const le=l[0].flags;le.dependsOn=2,le.isNonSync=0}}else if(yu&&ae-ie<ne-se&&x/ne<.025&&l[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let le=E;for(let Q=0,te=l.length;Q<te;Q++){const Se=le+l[Q].duration,be=le+l[Q].cts;if(Q<te-1){const Pe=Se+l[Q+1].cts;l[Q].duration=Pe-be}else l[Q].duration=Q?l[Q-1].duration:x;l[Q].cts=0,le=Se}}}_=J||!_?x:_;const fe=C+_;this.nextVideoTs=p=fe-f,this.videoSampleDuration=_,this.isVideoContiguous=!0;const re={data1:W.moof(e.sequenceNumber++,E,st(e,{samples:l})),data2:P,startPTS:(S-f)/r,endPTS:(I+_-f)/r,startDTS:(E-f)/r,endDTS:p/r,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,re}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return jS;case"ac3":return VS;default:return HS}}remuxAudio(e,t,i,s,r){const a=e.inputTimeScale,l=e.samplerate?e.samplerate:a,c=a/l,h=this.getSamplesPerFrame(e),f=h*c,p=this._initPTS,m=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,_=[],E=r!==void 0;let C=e.samples,S=m?0:8,I=this.nextAudioTs||-1;const R=p.baseTime*a/p.timescale,k=R+t*a;if(this.isAudioContiguous=i=i||C.length&&I>0&&(s&&Math.abs(k-(I+R))<9e3||Math.abs(di(C[0].pts,k)-(I+R))<20*f),C.forEach(function(ae){ae.pts=di(ae.pts,k)}),!i||I<0){if(C=C.filter(ae=>ae.pts>=0),!C.length)return;r===0?I=0:s&&!E?I=Math.max(0,k-R):I=C[0].pts-R}if(e.segmentCodec==="aac"){const ae=this.config.maxAudioFramesDrift;for(let fe=0,ee=I+R;fe<C.length;fe++){const oe=C[fe],re=oe.pts,le=re-ee,Q=Math.abs(1e3*le/a);if(le<=-ae*f&&E)fe===0&&(this.warn(`Audio frame @ ${(re/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*le/a)} ms.`),this.nextAudioTs=I=re-R,ee=re);else if(le>=ae*f&&Q<$S&&E){let te=Math.round(le/f);for(ee=re-te*f;ee<0&&te&&f;)te--,ee+=f;fe===0&&(this.nextAudioTs=I=ee-R),this.warn(`Injecting ${te} audio frames @ ${((ee-R)/a).toFixed(3)}s due to ${Math.round(1e3*le/a)} ms gap.`);for(let Se=0;Se<te;Se++){let be=NS.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);be||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),be=oe.unit.subarray()),C.splice(fe,0,{unit:be,pts:ee}),ee+=f,fe++}}oe.pts=ee,ee+=f}}let D=null,x=null,N,B=0,H=C.length;for(;H--;)B+=C[H].unit.byteLength;for(let ae=0,fe=C.length;ae<fe;ae++){const ee=C[ae],oe=ee.unit;let re=ee.pts;if(x!==null){const Q=_[ae-1];Q.duration=Math.round((re-x)/c)}else if(i&&e.segmentCodec==="aac"&&(re=I+R),D=re,B>0){B+=S;try{N=new Uint8Array(B)}catch(Q){this.observer.emit(L.ERROR,L.ERROR,{type:ke.MUX_ERROR,details:Y.REMUX_ALLOC_ERROR,fatal:!1,error:Q,bytes:B,reason:`fail allocating audio mdat ${B}`});return}m||(new DataView(N.buffer).setUint32(0,B),N.set(W.types.mdat,4))}else return;N.set(oe,S);const le=oe.byteLength;S+=le,_.push(qf(!0,h,le,0)),x=re}const O=_.length;if(!O)return;const P=_[_.length-1];I=x-R,this.nextAudioTs=I+c*P.duration;const G=m?new Uint8Array(0):W.moof(e.sequenceNumber++,D/c,st({},e,{samples:_}));e.samples=[];const J=(D-R)/a,se=I/a,ne={data1:G,data2:N,startPTS:J,endPTS:se,startDTS:J,endDTS:se,type:"audio",hasAudio:!0,hasVideo:!1,nb:O};return this.isAudioContiguous=!0,ne}}function di(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function GS(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Xm(n,e,t,i){const s=n.samples.length;if(!s)return;const r=n.inputTimeScale;for(let l=0;l<s;l++){const c=n.samples[l];c.pts=di(c.pts-t.baseTime*r/t.timescale,e*r)/r,c.dts=di(c.dts-i.baseTime*r/i.timescale,e*r)/r}const a=n.samples;return n.samples=[],{samples:a}}function Qm(n,e,t){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let a=0;a<i;a++){const l=n.samples[a];l.pts=di(l.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((a,l)=>a.pts-l.pts);const r=n.samples;return n.samples=[],{samples:r}}class KS extends Ai{constructor(e,t,i,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,s){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(NE(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=um(e);s.audio&&(t=Wf(s.audio,ut.AUDIO,this)),s.video&&(i=Wf(s.video,ut.VIDEO,this));const r={};s.audio&&s.video?r.audiovideo={container:"video/mp4",codec:t+","+i,supplemental:s.video.supplemental,initSegment:e,id:"main"}:s.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?r.video={container:"video/mp4",codec:i,supplemental:s.video.supplemental,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,i,s,r,a){var l,c;let{initPTS:h,lastEndTime:f}=this;const p={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};we(f)||(f=this.lastEndTime=r||0);const m=t.samples;if(!(m!=null&&m.length))return p;const _={initPTS:void 0,timescale:void 0,trackId:void 0};let E=this.initData;if((l=E)!=null&&l.length||(this.generateInitSegment(m),E=this.initData),!((c=E)!=null&&c.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(_.tracks=this.initTracks,this.emitInitSegment=!1);const C=UE(m,E,this),S=E.audio?C[E.audio.id]:null,I=E.video?C[E.video.id]:null,R=Ha(I,1/0),k=Ha(S,1/0),D=Ha(I,0,!0),x=Ha(S,0,!0);let N,B=r,H=0;if(S&&(!I||!h&&k<R||h&&h.trackId===E.audio.id)?(_.trackId=E.audio.id,N=S,H=x-k):I&&(_.trackId=E.video.id,N=I,H=D-R),N){const ae=N.timescale;B=N.start/ae,_.initPTS=N.start-r*ae,_.timescale=ae,h||(this.initPTS=h={baseTime:_.initPTS,timescale:ae,trackId:_.trackId})}(a||!h)&&(qS(h,B,r,H)||_.timescale!==h.timescale)&&(_.initPTS=B-r,_.timescale=1,h&&h.timescale===1&&this.warn(`Adjusting initPTS @${r} from ${h.baseTime/h.timescale} to ${_.initPTS}`),this.initPTS=h={baseTime:_.initPTS,timescale:1});const O=e?B-h.baseTime/h.timescale:f,P=O+H;H>0?this.lastEndTime=P:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const G=!!E.audio,J=!!E.video;let se="";G&&(se+="audio"),J&&(se+="video");const ie={data1:m,startPTS:O,startDTS:O,endPTS:P,endDTS:P,type:se,hasAudio:G,hasVideo:J,nb:1,dropped:0};p.audio=G&&!J?ie:void 0,p.video=J?ie:void 0;const ne=I?.sampleCount;if(ne){const ae=I.keyFrameIndex,fe=ae!==-1;ie.nb=ne,ie.dropped=ae===0||this.isVideoContiguous?0:fe?ae:ne,ie.independent=fe,ie.firstKeyFrame=ae,fe&&I.keyFrameStart&&(ie.firstKeyFramePTS=(I.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(p.independent=fe),this.isVideoContiguous||(this.isVideoContiguous=fe),ie.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${ae}/${ne} dropped: ${ie.dropped} start: ${ie.firstKeyFramePTS||"NA"}`)}return p.initSegment=_,p.id3=Xm(i,r,h,h),s.samples.length&&(p.text=Qm(s,r,h)),p}}function Ha(n,e,t=!1){return n?.start!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function qS(n,e,t,i){if(n===null)return!0;const s=Math.max(i,1),r=e-n.baseTime/n.timescale;return Math.abs(r-t)>s}function Wf(n,e,t){const i=n?.codec;return i&&i.length>4?i:e===ut.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?Ao(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let is;try{is=self.performance.now.bind(self.performance)}catch{is=Date.now}const fo=[{demux:xS,remux:KS},{demux:Is,remux:co},{demux:kS,remux:co},{demux:PS,remux:co}];fo.splice(2,0,{demux:RS,remux:co});class zf{constructor(e,t,i,s,r,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=r,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,s){const r=i.transmuxing;r.executeStart=is();let a=new Uint8Array(e);const{currentTransmuxState:l,transmuxConfig:c}=this;s&&(this.currentTransmuxState=s);const{contiguous:h,discontinuity:f,trackSwitch:p,accurateTimeOffset:m,timeOffset:_,initSegmentChange:E}=s||l,{audioCodec:C,videoCodec:S,defaultInitPts:I,duration:R,initSegmentData:k}=c,D=WS(a,t);if(D&&Ur(D.method)){const H=this.getDecrypter(),O=nc(D.method);if(H.isSync()){let P=H.softwareDecrypt(a,D.key.buffer,D.iv.buffer,O);if(i.part>-1){const J=H.flush();P=J&&J.buffer}if(!P)return r.executeEnd=is(),Tu(i);a=new Uint8Array(P)}else return this.asyncResult=!0,this.decryptionPromise=H.webCryptoDecrypt(a,D.key.buffer,D.iv.buffer,O).then(P=>{const G=this.push(P,null,i);return this.decryptionPromise=null,G}),this.decryptionPromise}const x=this.needsProbing(f,p);if(x){const H=this.configureTransmuxer(a);if(H)return this.logger.warn(`[transmuxer] ${H.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:ke.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,error:H,reason:H.message}),r.executeEnd=is(),Tu(i)}(f||p||E||x)&&this.resetInitSegment(k,C,S,R,t),(f||E||x)&&this.resetInitialTimestamp(I),h||this.resetContiguity();const N=this.transmux(a,D,_,m,i);this.asyncResult=Vn(N);const B=this.currentTransmuxState;return B.contiguous=!0,B.discontinuity=!1,B.trackSwitch=!1,r.executeEnd=is(),N}flush(e){const t=e.transmuxing;t.executeStart=is();const{decrypter:i,currentTransmuxState:s,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const a=[],{timeOffset:l}=s;if(i){const p=i.flush();p&&a.push(this.push(p.buffer,null,e))}const{demuxer:c,remuxer:h}=this;if(!c||!h){t.executeEnd=is();const p=[Tu(e)];return this.asyncResult?Promise.resolve(p):p}const f=c.flush(l);return Vn(f)?(this.asyncResult=!0,f.then(p=>(this.flushRemux(a,p,e),a))):(this.flushRemux(a,f,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,i){const{audioTrack:s,videoTrack:r,id3Track:a,textTrack:l}=t,{accurateTimeOffset:c,timeOffset:h}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===Ie.MAIN?"level":"track"} ${i.level}`);const f=this.remuxer.remux(s,r,a,l,h,c,!0,this.id);e.push({remuxResult:f,chunkMeta:i}),i.transmuxing.executeEnd=is()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,s,r){const{demuxer:a,remuxer:l}=this;!a||!l||(a.resetInitSegment(e,t,i,s),l.resetInitSegment(e,t,i,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,s,r){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,i,s,r):a=this.transmuxUnencrypted(e,i,s,r),a}transmuxUnencrypted(e,t,i,s){const{audioTrack:r,videoTrack:a,id3Track:l,textTrack:c}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,a,l,c,t,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,i,s,r){return this.demuxer.demuxSampleAes(e,t,i).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,i,s,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:s}=this;let r;for(let p=0,m=fo.length;p<m;p++){var a;if((a=fo[p].demux)!=null&&a.probe(e,this.logger)){r=fo[p];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,c=this.remuxer,h=r.remux,f=r.demux;(!c||!(c instanceof h))&&(this.remuxer=new h(i,t,s,this.logger)),(!l||!(l instanceof f))&&(this.demuxer=new f(i,t,s,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new sc(this.config)),e}}function WS(n,e){let t=null;return n.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Tu=n=>({remuxResult:{},chunkMeta:n});function Vn(n){return"then"in n&&n.then instanceof Function}class zS{constructor(e,t,i,s,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=s,this.defaultInitPts=r||null}}class YS{constructor(e,t,i,s,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=r,this.initSegmentChange=a}}let Yf=0;class Jm{constructor(e,t,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Yf++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=c=>{const h=c.data,f=this.hls;if(!(!f||!(h!=null&&h.event)||h.instanceNo!==this.instanceNo))switch(h.event){case"init":{var p;const m=(p=this.workerContext)==null?void 0:p.objectURL;m&&self.URL.revokeObjectURL(m);break}case"transmuxComplete":{this.handleTransmuxComplete(h.data);break}case"flush":{this.onFlush(h.data);break}case"workerLog":{f.logger[h.data.logType]&&f.logger[h.data.logType](h.data.message);break}default:{h.data=h.data||{},h.data.frag=this.frag,h.data.part=this.part,h.data.id=this.id,f.trigger(h.event,h.data);break}}},this.onWorkerError=c=>{if(!this.hls)return;const h=new Error(`${c.message}  (${c.filename}:${c.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:ke.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const a=(c,h)=>{h=h||{},h.frag=this.frag||void 0,c===L.ERROR&&(h=h,h.parent=this.id,h.part=this.part,this.error=h.error),this.hls.trigger(c,h)};this.observer=new oc,this.observer.on(L.FRAG_DECRYPTED,a),this.observer.on(L.ERROR,a);const l=cf(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const c=this.hls.logger;if(r.workerPath||tS()){try{r.workerPath?(c.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=sS(r.workerPath)):(c.log(`injecting Web Worker for "${t}"`),this.workerContext=iS());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:l,id:t,config:ft(r)})}catch(f){c.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new zf(this.observer,l,r,"",t,e.logger)}return}}this.transmuxer=new zf(this.observer,l,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Yf++;const t=this.hls.config,i=cf(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:ft(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),rS(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,s,r,a,l,c,h,f){var p,m;h.transmuxing.start=self.performance.now();const{instanceNo:_,transmuxer:E}=this,C=a?a.start:r.start,S=r.decryptdata,I=this.frag,R=!(I&&r.cc===I.cc),k=!(I&&h.level===I.level),D=I?h.sn-I.sn:-1,x=this.part?h.part-this.part.index:-1,N=D===0&&h.id>1&&h.id===I?.stats.chunkCount,B=!k&&(D===1||D===0&&(x===1||N&&x<=0)),H=self.performance.now();(k||D||r.stats.parsing.start===0)&&(r.stats.parsing.start=H),a&&(x||!B)&&(a.stats.parsing.start=H);const O=!(I&&((p=r.initSegment)==null?void 0:p.url)===((m=I.initSegment)==null?void 0:m.url)),P=new YS(R,B,c,k,C,O);if(!B||R||O){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${h.sn}${h.part>-1?" part: "+h.part:""} ${this.id===Ie.MAIN?"level":"track"}: ${h.level} id: ${h.id}
        discontinuity: ${R}
        trackSwitch: ${k}
        contiguous: ${B}
        accurateTimeOffset: ${c}
        timeOffset: ${C}
        initSegmentChange: ${O}`);const G=new zS(i,s,t,l,f);this.configureTransmuxer(G)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:_,cmd:"demux",data:e,decryptdata:S,chunkMeta:h,state:P},e instanceof ArrayBuffer?[e]:[]);else if(E){const G=E.push(e,S,h,P);Vn(G)?G.then(J=>{this.handleTransmuxComplete(J)}).catch(J=>{this.transmuxerError(J,h,"transmuxer-interface push error")}):this.handleTransmuxComplete(G)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const s=i.flush(e);Vn(s)?s.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Xf=100;class XS extends ac{constructor(e,t,i){super(e,t,i,"audio-stream-controller",Ie.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:r}){if(i===Ie.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:s,timescale:r},this.log(`InitPTS for cc: ${a} found from main: ${s}/${r}`),this.mainAnchor=t,this.state===ce.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(t,c?.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===ce.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const s=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&s?.cc===t.cc)return;const r=(s||e).cc,a=this.getLevelDetails(),l=this.getLoadPosition(),c=ym(a,r,l);c&&(this.log(`Syncing with main frag at ${c.start} cc ${c.cc}`),this.startFragRequested=!1,this.nextLoadPosition=c.start,this.resetLoadingState(),this.state===ce.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ce.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(Xf),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ce.IDLE):this.state=ce.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ce.IDLE:this.doTickIdle();break;case ce.WAITING_TRACK:{const{levels:t,trackId:i}=this,s=t?.[i],r=s?.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=ce.WAITING_INIT_PTS}break}case ce.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:s,trackId:r}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(s?.[r]||null),this.state=ce.IDLE}break}case ce.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:i,part:s,cache:r,complete:a}=t,l=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=ce.FRAG_LOADING;const c=r.flush().buffer,h={frag:i,part:s,payload:c,networkDetails:null};this._handleFragmentLoadProgress(h),a&&super._handleFragmentLoadComplete(h)}else l&&l.cc!==t.frag.cc&&this.syncWithAnchor(l,t.frag)}else this.state=ce.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:s,trackId:r}=this,a=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(i!=null&&i[r]))return;const l=i[r],c=l.details;if(!c||this.waitForLive(l)||this.waitForCdnTuneIn(c)){this.state=ce.WAITING_TRACK,this.startFragRequested=!1;return}const h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,ut.AUDIO,Ie.AUDIO));const f=this.getFwdBufferInfo(h,Ie.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,c)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=ce.ENDED;return}const p=f.len,m=t.maxBufferLength,_=c.fragments,E=_[0].start,C=this.getLoadPosition(),S=this.flushing?C:f.end;if(this.switchingTrack&&s){const k=C;c.PTSKnown&&k<E&&(f.end>E||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=E+.05)}if(p>=m&&!this.switchingTrack&&S<_[_.length-1].start)return;let I=this.getNextFragment(S,c);if(I&&this.isLoopLoading(I,S)&&(I=this.getNextFragmentLoopLoading(I,c,f,Ie.MAIN,m)),!I){this.bufferFlushed=!0;return}let R=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&R&&At(I)&&!I.endList&&(!c.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(R)===Lt.OK&&(this.mainFragLoading=R=null),R&&At(R))){if(I.start>R.end){const D=this.fragmentTracker.getFragAtPos(S,Ie.MAIN);D&&D.end>R.end&&(R=D,this.mainFragLoading={frag:D,targetBufferTime:null})}if(I.start>R.end)return}this.loadFragment(I,l,S)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new Un(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ce.STOPPED&&(this.setInterval(Xf),this.state=ce.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:s}=this,{details:r,id:a,groupId:l,track:c}=t;if(!s){this.warn(`Audio tracks reset while loading track ${a} "${c.name}" of "${l}"`);return}const h=this.mainDetails;if(!h||r.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=t,this.state!==ce.STOPPED&&(this.state=ce.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${c.name}" of "${l}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const f=s[a];let p=0;if(r.live||(i=f.details)!=null&&i.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(f.details){var m;p=this.alignPlaylists(r,f.details,(m=this.levelLastLoaded)==null?void 0:m.details)}r.alignedSliding||(Dm(r,h),r.alignedSliding||Do(r,h),p=r.fragmentStart)}f.details=r,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(h,p),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:r,id:a,groupId:t.groupId}),this.state===ce.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=ce.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:s,payload:r}=e,{config:a,trackId:l,levels:c}=this;if(!c){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const h=c[l];if(!h){this.warn("Audio track is undefined on fragment load progress");return}const f=h.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const p=a.defaultAudioCodec||h.audioCodec||"mp4a.40.2";let m=this.transmuxer;m||(m=this.transmuxer=new Jm(this.hls,Ie.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const _=this.initPTS[i.cc],E=(t=i.initSegment)==null?void 0:t.data;if(_!==void 0){const S=s?s.index:-1,I=S!==-1,R=new rc(i.level,i.sn,i.stats.chunkCount,r.byteLength,S,I);m.push(r,E,p,"",i,s,f.totalduration,!1,R,_)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${f.startSN} ,${f.endSN}],track ${l}`);const{cache:C}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new xm,complete:!1};C.push(new Uint8Array(r)),this.state!==ce.STOPPED&&(this.state=ce.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Ie.MAIN&&At(t.frag)&&(this.mainFragLoading=t,this.state===ce.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i.type!==Ie.AUDIO){!this.audioOnly&&i.type===Ie.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(At(i)){this.fragPrevious=i;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,nt({},r)))}this.fragBufferedComplete(i,s),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=ce.ERROR;return}switch(t.details){case Y.FRAG_GAP:case Y.FRAG_PARSING_ERROR:case Y.FRAG_DECRYPT_ERROR:case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ie.AUDIO,t);break;case Y.AUDIO_TRACK_LOAD_ERROR:case Y.AUDIO_TRACK_LOAD_TIMEOUT:case Y.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ce.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===Ge.AUDIO_TRACK&&(this.state=ce.IDLE);break;case Y.BUFFER_ADD_CODEC_ERROR:case Y.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Y.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Y.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ut.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ut.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ce.ENDED&&(this.state=ce.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,Ie.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:s}=this,{remuxResult:r,chunkMeta:a}=e,l=this.getCurrentContext(a);if(!l){this.resetWhenMissingContext(a);return}const{frag:c,part:h,level:f}=l,{details:p}=f,{audio:m,text:_,id3:E,initSegment:C}=r;if(this.fragContextChanged(c)||!p){this.fragmentTracker.removeFragment(c);return}if(this.state=ce.PARSING,this.switchingTrack&&m&&this.completeAudioSwitch(this.switchingTrack),C!=null&&C.tracks){const S=c.initSegment||c;this._bufferInitSegment(f,C.tracks,S,a),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:i,tracks:C.tracks})}if(m){const{startPTS:S,endPTS:I,startDTS:R,endDTS:k}=m;h&&(h.elementaryStreams[ut.AUDIO]={startPTS:S,endPTS:I,startDTS:R,endDTS:k}),c.setElementaryStreamInfo(ut.AUDIO,S,I,R,k),this.bufferFragmentData(m,c,h,a)}if(E!=null&&(t=E.samples)!=null&&t.length){const S=st({id:i,frag:c,details:p},E);s.trigger(L.FRAG_PARSING_METADATA,S)}if(_){const S=st({id:i,frag:c,details:p},_);s.trigger(L.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,i,s){if(this.state!==ce.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=Ie.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${a}/${r.codec}]`),a&&a.split(",").length===1&&(r.levelCodec=a),this.hls.trigger(L.BUFFER_CODECS,t);const l=r.initSegment;if(l!=null&&l.byteLength){const c={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:l};this.hls.trigger(L.BUFFER_APPENDING,c)}this.tickImmediate()}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===Lt.NOT_LOADED||s===Lt.PARTIAL){var r;if(!At(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ce.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Do(t.details,a)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:s,characteristics:r,audioCodec:a,channels:l}=this.bufferedTrack;nr({name:t,lang:i,assocLang:s,characteristics:r,audioCodec:a,channels:l},e,Zs)||(Lo(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,nt({},e))}}class pc extends Ai{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const s=t?.renditionReports;if(s){let r=-1;for(let a=0;a<s.length;a++){const l=s[a];let c;try{c=new self.URL(l.URI,t.url).href}catch(h){this.warn(`Could not construct new URL for Rendition Report: ${h}`),c=l.URI||""}if(c===e){r=a;break}else c===e.substring(0,c.length)&&(r=a)}if(r!==-1){const a=s[r],l=parseInt(a["LAST-MSN"])||t?.lastPartSn;let c=parseInt(a["LAST-PART"])||t?.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);c>=0&&f>t.partTarget&&(c+=1)}const h=i&&df(i);return new ff(l,c>=0?c:void 0,h)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:s,stats:r}=t,a=self.performance.now(),l=r.loading.first?Math.max(0,a-r.loading.first):0;s.advancedDateTime=Date.now()-l;const c=this.hls.config.timelineOffset;if(c!==s.appliedTimelineOffset){const f=Math.max(c||0,0);s.appliedTimelineOffset=f,s.fragments.forEach(p=>{p.start=p.playlistOffset+f})}if(s.live||i!=null&&i.live){const f="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(i),i&&s.fragments.length>0){Kb(i,s);const R=s.playlistParsingError;if(R){this.warn(R);const k=this.hls;if(!k.config.ignorePlaylistParsingErrors){var h;const{networkDetails:D}=t;k.trigger(L.ERROR,{type:ke.NETWORK_ERROR,details:Y.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:R,reason:R.message,level:t.level||void 0,parent:(h=s.fragments[0])==null?void 0:h.type,networkDetails:D,stats:r});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=r.loading.start);const p=this.hls.mainForwardBufferInfo,m=p?p.end-p.len:0,_=(s.edge-m)*1e3,E=Im(s,_);if(s.requestScheduled+E<a?s.requestScheduled=a:s.requestScheduled+=E,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let C,S,I;if(s.canBlockReload&&s.endSN&&s.advanced){const R=this.hls.config.lowLatencyMode,k=s.lastPartSn,D=s.endSN,x=s.lastPartIndex,N=x!==-1,B=k===D;N?B?(S=D+1,I=R?0:x):(S=k,I=R?x+1:s.maxPartIndex):S=D+1;const H=s.age,O=H+s.ageHeader;let P=Math.min(O-s.partTarget,s.targetduration*1.5);if(P>0){if(O>s.targetduration*3)this.log(`Playlist last advanced ${H.toFixed(2)}s ago. Omitting segment and part directives.`),S=void 0,I=void 0;else if(i!=null&&i.tuneInGoal&&O-s.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${P} with playlist age: ${s.age}`),P=0;else{const G=Math.floor(P/s.targetduration);if(S+=G,I!==void 0){const J=Math.round(P%s.targetduration/s.partTarget);I+=J}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${H.toFixed(2)}s goal: ${P} skip sn ${G} to part ${I}`)}s.tuneInGoal=P}if(C=this.getDeliveryDirectives(s,t.deliveryDirectives,S,I),R||!B){s.requestScheduled=a,this.loadingPlaylist(f,C);return}}else(s.canBlockReload||s.canSkipUntil)&&(C=this.getDeliveryDirectives(s,t.deliveryDirectives,S,I));C&&S!==void 0&&s.canBlockReload&&(s.requestScheduled=r.loading.first+Math.max(E-l*2,E/2)),this.scheduleLoading(f,C,s)}else this.clearTimer()}scheduleLoading(e,t,i){const s=i||e.details;if(!s){this.loadingPlaylist(e,t);return}const r=self.performance.now(),a=s.requestScheduled;if(r>=a){this.loadingPlaylist(e,t);return}const l=a-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(l)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),l)}getDeliveryDirectives(e,t,i,s){let r=df(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,r=uo.No),new ff(i,s,r)}checkRetry(e){const t=e.details,i=ko(e),s=e.errorAction,{action:r,retryCount:a=0,retryConfig:l}=s||{},c=!!s&&!!l&&(r===$t.RetryRequest||!s.resolved&&r===$t.SendAlternateToPenaltyBox);if(c){var h;if(a>=l.maxNumRetry)return!1;if(i&&(h=e.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${l.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=ic(l,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${a+1}/${l.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,s.resolved=!0}return c}}function Zm(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Gn(n[t].attrs,e[t].attrs))return!1;return!0}function Gn(n,e,t){const i=n["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function bh(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class QS extends pc{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:s,details:r}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Audio track with id:${i} and group:${s} not found in active group ${a?.groupId}`);return}const l=a.details;a.details=t.details,this.log(`Audio track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,s=this.groupIds;let r=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(l=>s?.indexOf(l)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(m=>!i||i.indexOf(m.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(m=>m.default)&&(this.selectDefaultTrack=!1),l.forEach((m,_)=>{m.id=_});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.audioPreference;if(!r&&c){const m=Vi(c,l,Zs);if(m>-1)r=l[m];else{const _=Vi(c,this.tracks);r=this.tracks[_]}}let h=this.findTrackId(r);h===-1&&r&&(h=this.findTrackId(null));const f={audioTracks:l};this.log(`Updating audio tracks, ${l.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,f);const p=this.trackId;if(h!==-1&&p===-1)this.setAudioTrack(h);else if(l.length&&p===-1){var a;const m=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${l.length}`);this.warn(m.message),this.hls.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ge.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const s=this.currentTrack;if(s&&nr(e,s,Zs))return s;const r=Vi(e,this.tracksInGroup,Zs);if(r>-1){const a=this.tracksInGroup[r];return this.setAudioTrack(r),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const l=hb(e,t.levels,i,a,Zs);if(l===-1)return null;t.nextLoadLevel=l}if(e.channels||e.audioCodec){const a=Vi(e,i);if(a>-1)return i[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e],r=s.details&&!s.details.live;if(e===this.trackId&&s===i&&r||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,nt({},s)),r))return;const a=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(!(this.selectDefaultTrack&&!s.default)&&(!e||nr(e,s,Zs)))return i}if(e){const{name:i,lang:s,assocLang:r,characteristics:a,audioCodec:l,channels:c}=e;for(let h=0;h<t.length;h++){const f=t[h];if(nr({name:i,lang:s,assocLang:r,characteristics:a,audioCodec:l,channels:c},f,Zs))return h}for(let h=0;h<t.length;h++){const f=t[h];if(Gn(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<t.length;h++){const f=t[h];if(Gn(e.attrs,f.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Lo(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,s=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,l=a?.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:t||null,track:e})}}class JS{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(r){var i;if(s.onError(r),this.queues===null||this.tracks===null)return;const a=(i=this.tracks[e])==null?void 0:i.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],s=i?.buffer;return s?`SourceBuffer${s.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const Qf=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,ev="HlsJsTrackRemovedError";class ZS extends Error{constructor(e){super(e),this.name=ev}}class e0 extends Ai{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:s,mediaSource:r}=this;i&&this.log("Media source opened"),!(!s||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:s,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:s}=this;i!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=IE(Ns(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const a=this.isQueued();(r||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?st(i,s.tracks):this.sourceBuffers.forEach(r=>{const[a]=r;a&&(i[a]=st({},this.tracks[a]),this.removeBuffer(a)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media,s=Ns(this.appendSource);if(this.transferData=this.overrides=void 0,i&&s){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(a),r)this._objectUrl=i.src,this.attachTransferred();else{const l=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");const c=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||c&&a instanceof c,Jf(i),t0(i,l),i.load()}catch{i.src=l}else i.src=l}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,s=t.tracks,r=s?Object.keys(s):null,a=r?r.length:0,l=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(s&&r&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${ft(i,(c,h)=>c==="initSegment"?void 0:h)};
transfer tracks: ${ft(s,(c,h)=>c==="initSegment"?void 0:h)}}`),!im(s,i)){t.mediaSource=null,t.tracks=void 0;const c=e.currentTime,h=this.details,f=Math.max(c,h?.fragments[0].start||0);if(f-c>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${c} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(i)}") start time: ${f} currentTime: ${c}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,r.forEach(c=>{const h=c,f=s[h];if(f){const p=f.buffer;if(p){const m=this.fragmentTracker,_=f.id;if(m.hasFragments(_)||m.hasParts(_)){const S=Ue.getBuffered(p);m.detectEvictedFragments(h,S,_,null,!0)}const E=_u(h),C=[h,p];this.sourceBuffers[E]=C,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(h),this.trackSourceBuffer(h,f)}}}),l(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),l()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:r,_objectUrl:a}=this;if(r){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([l])=>{l&&this.removeBuffer(l)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const l=r.readyState==="open";try{const c=r.sourceBuffers;for(let h=c.length;h--;)l&&c[h].abort(),r.removeSourceBuffer(c[h]);l&&r.endOfStream()}catch(c){this.warn(`onMediaDetaching: ${c.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),i||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(s.removeAttribute("src"),this.appendSource&&Jf(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[_u(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new JS(this.tracks)}onBufferCodecs(e,t){const i=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const r="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),a=!r&&this.sourceBufferCount&&this.media&&s.some(l=>!i[l]);if(r||a){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(l=>{var c,h,f;const p=t[l],{id:m,codec:_,levelCodec:E,container:C,metadata:S,supplemental:I}=p;let R=i[l];const k=(c=this.transferData)==null||(h=c.tracks)==null?void 0:h[l],D=k!=null&&k.buffer?k:R,x=D?.pendingCodec||D?.codec,N=D?.levelCodec;R||(R=i[l]={buffer:void 0,listeners:[],codec:_,supplemental:I,container:C,levelCodec:E,metadata:S,id:m});const B=lo(x,N),H=B?.replace(Qf,"$1");let O=lo(_,E);const P=(f=O)==null?void 0:f.replace(Qf,"$1");O&&B&&H!==P&&(l.slice(0,5)==="audio"&&(O=Ao(O,this.appendSource)),this.log(`switching codec ${x} to ${O}`),O!==(R.pendingCodec||R.codec)&&(R.pendingCodec=O),R.container=C,this.appendChangeType(l,C,O))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const s=`${t};codecs=${i}`,r={label:`change-type=${s}`,execute:()=>{const a=this.tracks[e];if(a){const l=a.buffer;l!=null&&l.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),l.changeType(s),a.codec=i,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,s=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,Ie.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var l;const c=this.tracks.video;(this.lastVideoAppendEnd>s||c!=null&&c.buffer&&Ue.isBuffered(c.buffer,s)||((l=this.fragmentTracker.getAppendedFrag(s,Ie.MAIN))==null?void 0:l.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn("Error executing block-audio operation",l)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:s,type:r,parent:a,frag:l,part:c,chunkMeta:h,offset:f}=t,p=h.buffering[r],{sn:m,cc:_}=l,E=self.performance.now();p.start=E;const C=l.stats.buffering,S=c?c.stats.buffering:null;C.start===0&&(C.start=E),S&&S.start===0&&(S.start=E);const I=i.audio;let R=!1;r==="audio"&&I?.container==="audio/mpeg"&&(R=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const k=i.video,D=k?.buffer;if(D&&m!=="initSegment"){const B=c||l,H=this.blockedAudioAppend;if(r==="audio"&&a!=="main"&&!this.blockedAudioAppend){const P=B.start+B.duration*.05,G=D.buffered,J=this.currentOp("video");!G.length&&!J?this.blockAudio(B):!J&&!Ue.isBuffered(D,P)&&this.lastVideoAppendEnd<P&&this.blockAudio(B)}else if(r==="video"){const O=B.end;if(H){const P=H.frag.start;(O>P||O<this.lastVideoAppendEnd||Ue.isBuffered(D,P))&&this.unblockAudio()}this.lastVideoAppendEnd=O}}const x=(c||l).start,N={label:`append-${r}`,execute:()=>{var B;p.executeStart=self.performance.now();const H=(B=this.tracks[r])==null?void 0:B.buffer;H&&(R?this.updateTimestampOffset(H,x,.1,r,m,_):f!==void 0&&we(f)&&this.updateTimestampOffset(H,f,1e-6,r,m,_)),this.appendExecutor(s,r)},onStart:()=>{},onComplete:()=>{const B=self.performance.now();p.executeEnd=p.end=B,C.first===0&&(C.first=B),S&&S.first===0&&(S.first=B);const H={};this.sourceBuffers.forEach(([O,P])=>{O&&(H[O]=Ue.getBuffered(P))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:r,frag:l,part:c,chunkMeta:h,parent:l.type,timeRanges:H})},onError:B=>{var H;const O={type:ke.MEDIA_ERROR,parent:l.type,details:Y.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:l,part:c,chunkMeta:h,error:B,err:B,fatal:!1},P=(H=this.media)==null?void 0:H.error;if(B.code===DOMException.QUOTA_EXCEEDED_ERR||B.name=="QuotaExceededError"||"quota"in B)O.details=Y.BUFFER_FULL_ERROR;else if(B.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!P)O.errorAction=$n(!0);else if(B.name===ev&&this.sourceBufferCount===0)O.errorAction=$n(!0);else{const G=++this.appendErrors[r];this.warn(`Failed ${G}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${P||"no media error"})`),(G>=this.hls.config.appendErrorMaxRetry||P)&&(O.fatal=!0)}this.hls.trigger(L.ERROR,O)}};this.append(N,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:i,startOffset:s,endOffset:r}=t;i?this.append(this.getFlushOp(i,s,r),i):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,s,r),a)})}onFragParsed(e,t){const{frag:i,part:s}=t,r=[],a=s?s.elementaryStreams:i.elementaryStreams;a[ut.AUDIOVIDEO]?r.push("audiovideo"):(a[ut.AUDIO]&&r.push("audio"),a[ut.VIDEO]&&r.push("video"));const l=()=>{const c=self.performance.now();i.stats.buffering.end=c,s&&(s.stats.buffering.end=c);const h=s?s.stats:i.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:i,part:s,stats:h,id:i.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(l,r).catch(c=>{this.warn(`Fragment buffered callback ${c}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,i;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((i=this.tracks[e])==null?void 0:i.ending))})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([a])=>{if(a){const l=this.tracks[a];(!t.type||t.type===a)&&(l.ending=!0,l.ended||(l.ended=!0,this.log(`${a} buffer reached EOS`)))}});const s=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var l;return a&&!((l=this.tracks[a])!=null&&l.ended)})&&(s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Y.BUFFER_APPEND_ERROR&&t.frag){var i;const s=(i=t.errorAction)==null?void 0:i.nextAutoLevel;we(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const s=e.config,r=i.currentTime,a=t.levelTargetDuration,l=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(we(l)&&l>=0){const c=Math.max(l,a),h=Math.floor(r/a)*a-c;this.flushBackBuffer(r,a,h)}if(we(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){const c=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),h=Math.max(c,a),f=Math.floor(r/a)*a+h;this.flushFrontBuffer(r,a,f)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([s,r])=>{if(r){const l=Ue.getBuffered(r);if(l.length>0&&i>l.start(0)){var a;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:i});const c=this.tracks[s];if((a=this.details)!=null&&a.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(c!=null&&c.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:s})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([s,r])=>{if(r){const a=Ue.getBuffered(r),l=a.length;if(l<2)return;const c=a.start(l-1),h=a.end(l-1);if(i>c||e>=c&&e<=h)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||i?.readyState!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&i.setLiveSeekableRange){const h=Math.max(0,t.fragmentStart),f=Math.max(h,s);return{duration:1/0,start:h,end:f}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return we(r)?{duration:r}:null;const a=this.media.duration,l=we(i.duration)?i.duration:0;return s>l&&s>a||!we(a)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:i}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(we(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${i}.`),s.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${ft(i)}`),this.tracksReady){var s;const r=(s=this.transferData)==null?void 0:s.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const s=this.tracks[t];e[t]={buffer:i,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const a=r,l=e[a];if(this.isPending(l)){const c=this.getTrackCodec(l,a),h=`${l.container};codecs=${c}`;l.codec=c,this.log(`creating sourceBuffer(${h})${this.currentOp(a)?" Queued":""} ${ft(l)}`);try{const f=i.addSourceBuffer(h),p=_u(a),m=[a,f];t[p]=m,l.buffer=f}catch(f){var s;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(a),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[a],this.hls.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:a,mimeType:h,parent:l.id});return}this.trackSourceBuffer(a,l)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let s=e.codec;i&&(t==="video"||t==="audiovideo")&&dh(i,"video")&&(s=WE(s,i));const r=lo(s,e.levelCodec);return r?t.slice(0,5)==="audio"?Ao(r,this.appendSource):r:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,a)=>{const l=a.removedRanges;l!=null&&l.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${s}`,t),this.hls.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const r=this.currentOp(e);r&&r.onError(s)}updateTimestampOffset(e,t,i,s,r,a){const l=t-e.timestampOffset;Math.abs(l)>=i&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:s,mediaSource:r}=this,a=this.tracks[e],l=a?.buffer;if(!s||!r||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const c=we(s.duration)?s.duration:1/0,h=we(r.duration)?r.duration:1/0,f=Math.max(0,t),p=Math.min(i,c,h);p>f&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${f},${p}] from the ${e} SourceBuffer`),l.remove(f,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],s=i?.buffer;if(!s)throw new ZS(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,s=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(a=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const s=(i=this.tracks[t])==null?void 0:i.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const s=this.tracks[e];if(!s)return;const r=s.buffer;if(!r)return;const a=i.bind(this,e);s.listeners.push({event:t,listener:a}),r.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(s=>{i.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function Jf(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function t0(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function _u(n){return n==="audio"?1:0}class gc{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&we(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((s,r)=>this.isLevelAllowed(s)&&r<=e);return this.clientRect=null,gc.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const s=(l,c)=>c?l.width!==c.width||l.height!==c.height:!0;let r=e.length-1;const a=Math.max(t,i);for(let l=0;l<e.length;l+=1){const c=e[l];if((c.width>=a||c.height>=a)&&s(c,e[l+1])){r=l;break}}return r}}const i0={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Yt=i0,s0={HLS:"h"},r0=s0,n0="CMCD-Object",a0="CMCD-Request",o0="CMCD-Session",l0="CMCD-Status",kn={OBJECT:n0,REQUEST:a0,SESSION:o0,STATUS:l0},u0={[kn.OBJECT]:["br","ab","d","ot","tb","tpb","lb","tab","lab","url"],[kn.REQUEST]:["pb","bl","tbl","dl","ltc","mtp","nor","nrr","rc","sn","sta","su","ttfb","ttfbb","ttlb","cmsdd","cmsds","smrt","df","cs"],[kn.SESSION]:["cid","pr","sf","sid","st","v","msd"],[kn.STATUS]:["bs","bsd","cdn","rtp","bg","pt","ec","e"]};class zr{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof zr?i:new zr(i))),this.value=e,this.params=t}}const h0="Dict";function c0(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function d0(n,e,t,i){return new Error(`failed to ${n} "${c0(e)}" as ${t}`,{cause:i})}function qi(n,e,t){return d0("serialize",n,e,t)}class tv{constructor(e){this.description=e}}const Zf="Bare Item",f0="Boolean";function p0(n){if(typeof n!="boolean")throw qi(n,f0);return n?"?1":"?0"}function g0(n){return btoa(String.fromCharCode(...n))}const m0="Byte Sequence";function v0(n){if(ArrayBuffer.isView(n)===!1)throw qi(n,m0);return`:${g0(n)}:`}const y0="Integer";function T0(n){return n<-999999999999999||999999999999999<n}function iv(n){if(T0(n))throw qi(n,y0);return n.toString()}function _0(n){return`@${iv(n.getTime()/1e3)}`}function sv(n,e){if(n<0)return-sv(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}const E0="Decimal";function b0(n){const e=sv(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw qi(n,E0);const t=e.toString();return t.includes(".")?t:`${t}.0`}const S0="String",C0=/[\x00-\x1f\x7f]+/;function w0(n){if(C0.test(n))throw qi(n,S0);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function A0(n){return n.description||n.toString().slice(7,-1)}const I0="Token";function ep(n){const e=A0(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw qi(e,I0);return e}function Sh(n){switch(typeof n){case"number":if(!we(n))throw qi(n,Zf);return Number.isInteger(n)?iv(n):b0(n);case"string":return w0(n);case"symbol":return ep(n);case"boolean":return p0(n);case"object":if(n instanceof Date)return _0(n);if(n instanceof Uint8Array)return v0(n);if(n instanceof tv)return ep(n);default:throw qi(n,Zf)}}const L0="Key";function Ch(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw qi(n,L0);return n}function mc(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Ch(e)}`:`;${Ch(e)}=${Sh(t)}`).join("")}function rv(n){return n instanceof zr?`${Sh(n.value)}${mc(n.params)}`:Sh(n)}function k0(n){return`(${n.value.map(rv).join(" ")})${mc(n.params)}`}function R0(n,e={whitespace:!0}){if(typeof n!="object")throw qi(n,h0);const t=n instanceof Map?n.entries():Object.entries(n),i=e?.whitespace?" ":"";return Array.from(t).map(([s,r])=>{r instanceof zr||(r=new zr(r));let a=Ch(s);return r.value===!0?a+=mc(r.params):(a+="=",Array.isArray(r.value)?a+=k0(r):a+=rv(r)),a}).join(`,${i}`)}function P0(n,e){return R0(n,e)}function D0(n){return["ot","sf","st","e","sta"].includes(n)}function x0(n){return typeof n=="number"?we(n):n!=null&&n!==""&&n!==!1}function O0(n,e){const t=new URL(n),i=new URL(e);if(t.origin!==i.origin)return n;const s=t.pathname.split("/").slice(1),r=i.pathname.split("/").slice(1,-1);for(;s[0]===r[0];)s.shift(),r.shift();for(;r.length;)r.shift(),s.unshift("..");return s.join("/")}const po=n=>Math.round(n),M0=(n,e)=>(e?.baseUrl&&(n=O0(n,e.baseUrl)),encodeURIComponent(n)),ja=n=>po(n/100)*100,F0={br:po,d:po,bl:ja,dl:ja,mtp:ja,nor:M0,rtp:ja,tb:po};function N0(n,e){const t={};if(n==null||typeof n!="object")return t;const i=Object.keys(n).sort(),s=st({},F0,e?.formatters),r=e?.filter;return i.forEach(a=>{if(r?.(a)===!1)return;let l=n[a];const c=s[a];c&&(l=c(l,e)),!(a==="v"&&l===1)&&(a=="pr"&&l===1||x0(l)&&(D0(a)&&typeof l=="string"&&(l=new tv(l)),t[a]=l))}),t}function nv(n,e={}){return n?P0(N0(n,e),st({whitespace:!1},e)):""}function B0(n,e={}){const t={};if(!n)return t;const i=Object.entries(n),s=Object.entries(u0).concat(Object.entries(e?.customHeaderMap||{})),r=i.reduce((a,l)=>{var c,h;const[f,p]=l,m=((c=s.find(_=>_[1].includes(f)))===null||c===void 0?void 0:c[0])||kn.REQUEST;return(h=a[m])!==null&&h!==void 0||(a[m]={}),a[m][f]=p,a},{});return Object.entries(r).reduce((a,[l,c])=>(a[l]=nv(c,e),a),t)}function U0(n,e,t){return st(n,B0(e,t))}const $0="CMCD";function H0(n,e={}){if(!n)return"";const t=nv(n,e);return`${$0}=${encodeURIComponent(t)}`}const tp=/CMCD=[^&#]+/;function j0(n,e,t){const i=H0(e,t);if(!i)return n;if(tp.test(n))return n.replace(tp,i);const s=n.includes("?")?"&":"?";return`${n}${s}${i}`}class V0{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Yt.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=s=>{try{const{frag:r,part:a}=s,l=this.hls.levels[r.level],c=this.getObjectType(r),h={d:(a||r).duration*1e3,ot:c};(c===Yt.VIDEO||c===Yt.AUDIO||c==Yt.MUXED)&&(h.br=l.bitrate/1e3,h.tb=this.getTopBandwidth(c)/1e3,h.bl=this.getBufferLength(c));const f=a?this.getNextPart(a):this.getNextFrag(r);f!=null&&f.url&&f.url!==r.url&&(h.nor=f.url),this.apply(s,h)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,s;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:r0.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){st(t,this.createData());const i=t.ot===Yt.INIT||t.ot===Yt.VIDEO||t.ot===Yt.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((a,l)=>(s.includes(l)&&(a[l]=t[l]),a),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),U0(e.headers,t,r)):e.url=j0(e.url,t,r)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const s=e.sn-i.startSN;return i.fragments[s+1]}}getNextPart(e){var t,i;const{index:s,fragment:r}=e,a=(t=this.hls.levels[r.level])==null||(i=t.details)==null?void 0:i.partList;if(a){const{sn:l}=r;for(let c=a.length-1;c>=0;c--){const h=a[c];if(h.index===s&&h.fragment.sn===l)return a[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Yt.TIMED_TEXT;if(e.sn==="initSegment")return Yt.INIT;if(t==="audio")return Yt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Yt.VIDEO:Yt.MUXED}getTopBandwidth(e){let t=0,i;const s=this.hls;if(e===Yt.AUDIO)i=s.audioTracks;else{const r=s.maxAutoLevel,a=r>-1?r+1:s.levels.length;i=s.levels.slice(0,a)}return i.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===Yt.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:Ue.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,l){t(r),this.loader.load(r,a,l)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,l){t(r),this.loader.load(r,a,l)}}}}const G0=3e5;class K0 extends Ai{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if(i?.action===$t.SendAlternateToPenaltyBox&&i.flags===Si.MoveAllAlternatesMatchingHost){const s=this.levels;let r=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:l,pathwayId:c,type:h}=t.context;l&&s?a=this.getPathwayForGroupId(l,h,a):c&&(a=c)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&s&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),i.resolved=this.pathwayId!==a),t.details===Y.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${ft(r)} penalized: ${ft(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(r=>{s-i[r]>G0&&delete i[r]});for(let r=0;r<e.length;r++){const a=e[r];if(a in i)continue;if(a===this.pathwayId)return;const l=this.hls.nextLoadLevel,c=this.hls.levels[l];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,Rm(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const h=this.hls.levels[l];c&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==c.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==c.bitrate&&this.log(`Unstable Pathways change from bitrate ${c.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=l);break}}}getPathwayForGroupId(e,t,i){const s=this.getLevelsForPathway(i).concat(this.levels||[]);for(let r=0;r<s.length;r++)if(t===Ge.AUDIO_TRACK&&s[r].hasAudioGroup(e)||t===Ge.SUBTITLE_TRACK&&s[r].hasSubtitleGroup(e))return s[r].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},s={};e.forEach(r=>{const{ID:a,"BASE-ID":l,"URI-REPLACEMENT":c}=r;if(t.some(f=>f.pathwayId===a))return;const h=this.getLevelsForPathway(l).map(f=>{const p=new pt(f.attrs);p["PATHWAY-ID"]=a;const m=p.AUDIO&&`${p.AUDIO}_clone_${a}`,_=p.SUBTITLES&&`${p.SUBTITLES}_clone_${a}`;m&&(i[p.AUDIO]=m,p.AUDIO=m),_&&(s[p.SUBTITLES]=_,p.SUBTITLES=_);const E=av(f.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",c),C=new Un({attrs:p,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:E,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let S=1;S<f.audioGroups.length;S++)C.addGroupId("audio",`${f.audioGroups[S]}_clone_${a}`);if(f.subtitleGroups)for(let S=1;S<f.subtitleGroups.length;S++)C.addGroupId("text",`${f.subtitleGroups[S]}_clone_${a}`);return C});t.push(...h),ip(this.audioTracks,i,c,a),ip(this.subtitleTracks,s,c,a)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+f)}const r={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,l=a.errorRetry||a.timeoutRetry||{},c={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},h={onSuccess:(f,p,m,_)=>{this.log(`Loaded steering manifest: "${s}"`);const E=f.data;if(E?.VERSION!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;const{"RELOAD-URI":C,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":I}=E;if(C)try{this.uri=new self.URL(C,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${C}`);return}this.scheduleRefresh(this.uri||m.url),S&&this.clonePathways(S);const R={steeringManifest:E,url:s.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,R),I&&this.updatePathwayPriority(I)},onError:(f,p,m,_)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${p.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let E=this.timeToLoad*1e3;if(f.code===429){const C=this.loader;if(typeof C?.getResponseHeader=="function"){const S=C.getResponseHeader("Retry-After");S&&(E=parseFloat(S)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,E)},onTimeout:(f,p,m)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(r,c,h)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const s=(i=this.hls)==null?void 0:i.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function ip(n,e,t,i){n&&Object.keys(e).forEach(s=>{const r=n.filter(a=>a.groupId===s).map(a=>{const l=st({},a);return l.details=void 0,l.attrs=new pt(l.attrs),l.url=l.attrs.URI=av(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),l.groupId=l.attrs["GROUP-ID"]=e[s],l.attrs["PATHWAY-ID"]=i,l});n.push(...r)})}function av(n,e,t,i){const{HOST:s,PARAMS:r,[t]:a}=i;let l;e&&(l=a?.[e],l&&(n=l));const c=new self.URL(n);return s&&!l&&(c.host=s),r&&Object.keys(r).sort().forEach(h=>{h&&c.searchParams.set(h,r[h])}),c.href}function pi(n,e,t){wi(n,e,t),n.addEventListener(e,t)}function wi(n,e,t){n.removeEventListener(e,t)}class $r extends Ai{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=$r.CDMCleanupPromise?[$r.CDMCleanupPromise]:[],this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,s=t[e];if(s)return s.licenseUrl;if(e===yt.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(a,l,c)=>!!a&&c.indexOf(a)===l,s=t.map(a=>a.audioCodec).filter(i),r=t.map(a=>a.videoCodec).filter(i);return s.length+r.length===0&&r.push("avc1.42e01e"),new Promise((a,l)=>{const c=h=>{const f=h.shift();this.getMediaKeysPromise(f,s,r).then(p=>a({keySystem:f,mediaKeys:p})).catch(p=>{h.length?c(h):p instanceof li?l(p):l(new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};c(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return Sm===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(e,t)}getMediaKeysPromise(e,t,i){const s=Fb(e,t,i,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let a=r?.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${ft(s)}`),a=this.requestMediaKeySystemAccess(e,s);const l=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),a.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const h=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),l.mediaKeys=c.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,h.then(p=>p?this.setMediaKeysServerCertificate(f,e,p):f))),l.mediaKeys.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),l.mediaKeys})}return a.then(()=>r.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${er.hexDump(e.keyId||[])}`);const s=i.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return er.hexDump(e.keyId)}updateKeySession(e,t){var i;const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${er.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Lf(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const r=Lf(s);r?t(r):i(new Error(`Unable to find format for key-system "${s}"`))}).catch(i))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=ho(this.config),i=e.map(vh).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(i)}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),s=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);let r=this.keyIdToKeySessionPromise[i];return r||(r=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))),(this.keyIdToKeySessionPromise[i]=r.then(l=>{const c="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,h,"playlist-key")})).catch(l=>this.handleError(l))),r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof li?this.hls.trigger(L.ERROR,e.data):this.hls.trigger(L.ERROR,{type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const s=vh(e.keyFormat),r=s?[s]:ho(this.config);return this.attemptKeySystemAccess(r)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=ho(this.config)),e.length===0)throw new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ft({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>i.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,i,s){var r,a;const l=(r=this.config.drmSystems)==null||(a=r[e.keySystem])==null?void 0:a.generateRequest;if(l)try{const E=l.call(this.hls,t,i,e);if(!E)throw new Error("Invalid response from configured generateRequest filter");t=E.initDataType,i=E.initData?E.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(E){var c;if(this.warn(E.message),(c=this.hls)!=null&&c.config.debug)throw E}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const h=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${h} (init data type: ${t} length: ${i?i.byteLength:null})`);const f=new oc,p=e._onmessage=E=>{const C=e.mediaKeysSession;if(!C){f.emit("error",new Error("invalid state"));return}const{messageType:S,message:I}=E;this.log(`"${S}" message event for session "${C.sessionId}" message size: ${I.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,I).catch(R=>{f.eventNames().length?f.emit("error",R):this.handleError(R)}):S==="license-release"?e.keySystem===yt.FAIRPLAY&&(this.updateKeySession(e,mh("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${S}"`)},m=e._onkeystatuseschange=E=>{if(!e.mediaKeysSession){f.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const S=e.keyStatus;f.emit("keyStatus",S),S==="expired"&&(this.warn(`${e.keySystem} expired for key ${h}`),this.renewKeySession(e))};pi(e.mediaKeysSession,"message",p),pi(e.mediaKeysSession,"keystatuseschange",m);const _=new Promise((E,C)=>{f.on("error",C),f.on("keyStatus",S=>{S.startsWith("usable")?E():S==="output-restricted"?C(new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):S==="internal-error"?C(new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${S}"`)):S==="expired"?C(new Error("key expired while generating request")):this.warn(`unhandled key status change "${S}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var E;this.log(`Request generated for key-session "${(E=e.mediaKeysSession)==null?void 0:E.sessionId}" keyId: ${h}`)}).catch(E=>{throw new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_SESSION,error:E,fatal:!1},`Error generating key-session request: ${E}`)}).then(()=>_).catch(E=>{throw f.removeAllListeners(),this.removeSession(e),E}).then(()=>(f.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{if(typeof i=="string"&&typeof t=="object"){const s=i;i=t,t=s}this.log(`key status change "${t}" for keyStatuses keyId: ${er.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${er.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,s=new i(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,l)=>{const c={responseType:"arraybuffer",url:r},h=t.certLoadPolicy.default,f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,_,E,C)=>{a(m.data)},onError:(m,_,E,C)=>{l(new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:nt({url:c.url,data:void 0},m)},`"${e}" certificate request failed (${r}). Status: ${m.code} (${m.text})`))},onTimeout:(m,_,E)=>{l(new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:c.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(m,_,E)=>{l(new Error("aborted"))}};s.load(c,f,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((s,r)=>{e.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${i?.byteLength}) on "${t}"`),s(e)}).catch(a=>{r(new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(s=>{throw new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(i,"application/xml"),r=s.querySelectorAll("HttpHeader");if(r.length>0){let f;for(let p=0,m=r.length;p<m;p++){var a,l;f=r[p];const _=(a=f.querySelector("name"))==null?void 0:a.textContent,E=(l=f.querySelector("value"))==null?void 0:l.textContent;_&&E&&e.setRequestHeader(_,E)}}const c=s.querySelector("Challenge"),h=c?.textContent;if(!h)throw new Error("Cannot find <Challenge> in key message");return mh(atob(h))}setupLicenseXHR(e,t,i,s){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,i,s)}).catch(a=>{if(!i.decryptdata)throw a;return e.open("POST",t,!0),r.call(this.hls,e,t,i,s)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((s,r)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(l.readyState===4)if(l.status===200){this._requestLicenseFailureCount=0;let c=l.response;this.log(`License received ${c instanceof ArrayBuffer?c.byteLength:c}`);const h=this.config.licenseResponseCallback;if(h)try{c=h.call(this.hls,l,a,e)}catch(f){this.error(f)}s(c)}else{const c=i.errorRetry,h=c?c.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>h||l.status>=400&&l.status<500)r(new li({type:ke.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:l,response:{url:a,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${a}). Status: ${l.status} (${l.statusText})`));else{const f=h-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(s,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=l,this.setupLicenseXHR(l,a,e,t).then(({xhr:c,licenseChallenge:h})=>{e.keySystem==yt.PLAYREADY&&(h=this.unpackPlayReadyKeyMessage(c,h)),c.send(h)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,pi(i,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(wi(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Wo.clearKeyUriToKeyIdMap();const s=i.length;$r.CDMCleanupPromise=Promise.all(i.map(r=>this.removeSession(r)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(r=>{var a;this.log(`Could not clear media keys: ${r}`),(a=this.hls)==null||a.trigger(L.ERROR,{type:ke.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${r}`)})}))).catch(r=>{var a;this.log(`Could not close sessions and clear media keys: ${r}`),(a=this.hls)==null||a.trigger(L.ERROR,{type:ke.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${r}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((s,r)=>(s.indexOf(r.keyFormat)===-1&&s.push(r.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{drmSystemOptions:r}=this.config;return(Bb(r)?new Promise((l,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(l)}):Promise.resolve()).catch(l=>{var c;this.log(`Could not remove session: ${l}`),(c=this.hls)==null||c.trigger(L.ERROR,{type:ke.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${l}`)})}).then(()=>t.close()).catch(l=>{var c;this.log(`Could not close session: ${l}`),(c=this.hls)==null||c.trigger(L.ERROR,{type:ke.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${l}`)})})}}}$r.CDMCleanupPromise=void 0;class li extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class q0{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const s=performance.now();if(t){if(this.lastTime){const r=s-this.lastTime,a=i-this.lastDroppedFrames,l=t-this.lastDecodedFrames,c=1e3*a/r,h=this.hls;if(h.trigger(L.FPS_DROP,{currentDropped:a,currentDecoded:l,totalDroppedFrames:i}),c>0&&a>h.config.fpsDroppedMonitoringThreshold*l){let f=h.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=f)&&(f=f-1,h.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:h.currentLevel}),h.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function ov(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function lv(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Ze.debug(`[texttrack-utils]: ${i}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){Ze.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function Fr(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let i=n.cues.length;i--;)e&&n.cues[i].removeEventListener("enter",e),n.removeCue(n.cues[i]);t==="disabled"&&(n.mode=t)}function wh(n,e,t,i){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const r=z0(n.cues,e,t);for(let a=0;a<r.length;a++)(!i||i(r[a]))&&n.removeCue(r[a])}s==="disabled"&&(n.mode=s)}function W0(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let i=0,s=t,r;for(;i<=s;)if(r=Math.floor((s+i)/2),e<n[r].startTime)s=r-1;else if(e>n[r].startTime&&i<t)i=r+1;else return r;return n[i].startTime-e<e-n[s].startTime?i:s}function z0(n,e,t){const i=[],s=W0(n,e);if(s>-1)for(let r=s,a=n.length;r<a;r++){const l=n[r];if(l.startTime>=e&&l.endTime<=t)i.push(l);else if(l.startTime>t)return i}return i}function go(n){const e=[];for(let t=0;t<n.length;t++){const i=n[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(n[t])}return e}class Y0 extends pc{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=go(this.media.textTracks);for(let r=0;r<i.length;r++)if(i[r].mode==="hidden")t=i[r];else if(i[r].mode==="showing"){t=i[r];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;go(i.textTracks).forEach(a=>{Fr(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:s,details:r}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${i} and group:${s} not found in active group ${a?.groupId}`);return}const l=a.details;a.details=t.details,this.log(`Subtitle track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,s=this.groupIds;let r=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(a=>s?.indexOf(a)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!i||i.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,p)=>{f.id=p});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.subtitlePreference;if(!r&&l){this.selectDefaultTrack=!1;const f=Vi(l,a);if(f>-1)r=a[f];else{const p=Vi(l,this.tracks);r=this.tracks[p]}}let c=this.findTrackId(r);c===-1&&r&&(c=this.findTrackId(null));const h={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,h),c!==-1&&this.trackId===-1&&this.setSubtitleTrack(c)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const r=t[s];if(!(i&&!r.default||!i&&!e)&&(!e||nr(r,e)))return s}if(e){for(let s=0;s<t.length;s++){const r=t[s];if(Gn(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const r=t[s];if(Gn(e.attrs,r.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(bh(s,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ge.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&nr(e,i))return i;const s=Vi(e,this.tracksInGroup);if(s>-1){const r=this.tracksInGroup[s];return this.setSubtitleTrack(s),r}else{if(i)return null;{const r=Vi(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,s=e.groupId,r=this.getUrlWithDirectives(e.url,t),a=e.details,l=a?.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=go(e.textTracks),i=this.currentTrack;let s;if(i&&(s=t.filter(r=>bh(i,r))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==s&&(r.mode="disabled")}),s){const r=this.subtitleDisplay?"showing":"hidden";s.mode!==r&&(s.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!we(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!s.details&&!s.details.live;if(e===this.trackId&&s===i&&r)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:l="",name:c,type:h,url:f}=s;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:a,groupId:l,name:c,type:h,url:f});const p=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(p)}}function X0(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?r:r&3|8).toString(16)})}}}function Fn(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Hr=.025;let Oo=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function Q0(n,e,t){return`${n.identifier}-${t+1}-${Fn(e)}`}class J0{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Eu(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Eu(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=we(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Eu(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Hr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Oo.Range:Oo.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Z0(this)}}function Eu(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Hr)?e.start:e.start+e.duration}function uv(n,e,t){const i=new self.URL(n,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function bu(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function Z0(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Mr(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class eC{constructor(e,t,i,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=i,this.assetItem=s;let a=s.uri;try{a=uv(a,t.primarySessionId).href}catch{}r.loadSource(a);const l=()=>{this.hasDetails=!0};r.once(L.LEVEL_LOADED,l),r.once(L.AUDIO_TRACK_LOADED,l),r.once(L.SUBTITLE_TRACK_LOADED,l),r.on(L.MEDIA_ATTACHING,(c,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(L.BUFFER_APPENDED,()=>{const p=this.bufferedEnd;this.reachedPlayout(p)&&(this._bufferedEosTime=p,r.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var e;return((e=this.interstitial)==null?void 0:e.appendInPlace)||!1}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const i=this.timelineOffset,s=Ue.bufferInfo(e,i,0);return this.getAssetTime(s.end)>=this._bufferedEosTime-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ue.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){const e=this.hls;if(this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){this.hls.on(e,t)}once(e,t,i){this.hls.once(e,t)}off(e,t,i){this.hls.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Mr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const sp=.033;class tC extends Ai{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(r=s[i])!=null&&r.event;){var r;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let s=0;s<i.length;s++){let r=i[s];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return s}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let s=e;s<=t&&i[s];s++){const r=i[s].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var i;if(((i=t[s].event)==null?void 0:i.identifier)===e)return s}return-1}findAssetIndex(e,t){const i=e.assetList,s=i.length;if(s>1)for(let r=0;r<s;r++){const a=i[r];if(!a.error){const l=a.timelineStart;if(t===l||t>l&&t<l+(a.duration||0))return r}}return 0}get assetIdAtEnd(){var e,t;const i=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(i){const s=i.assetList,r=s[s.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:s}=i,r=this.events,a=this.parseDateRanges(s,{url:i.url},t),l=Object.keys(s),c=r?r.filter(h=>!l.includes(h.identifier)):[];a.length&&a.sort((h,f)=>{const p=h.cue.pre,m=h.cue.post,_=f.cue.pre,E=f.cue.post;if(p&&!_)return-1;if(_&&!p||m&&!E)return 1;if(E&&!m)return-1;if(!p&&!_&&!m&&!E){const C=h.startTime,S=f.startTime;if(C!==S)return C-S}return h.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=a,c.forEach(h=>{this.removeEvent(h)}),this.updateSchedule(e,c)}updateSchedule(e,t=[]){const i=this.events||[];if(i.length||t.length||this.length<2){const s=this.items,r=this.parseSchedule(i,e);(t.length||s?.length!==r.length||r.some((l,c)=>Math.abs(l.playout.start-s[c].playout.start)>.005||Math.abs(l.playout.end-s[c].playout.end)>.005))&&(this.items=r,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,i){const s=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const l=r[a],c=e[l];if(c.isInterstitial){let h=this.eventMap[l];h?h.setDateRange(c):(h=new J0(c,t),this.eventMap[l]=h,i===!1&&(h.appendInPlace=i)),s.push(h)}}return s}parseSchedule(e,t){const i=[],s=t.main.details,r=s.live?1/0:s.edge;let a=0;if(e=e.filter(c=>!c.error&&!(c.cue.once&&c.hasPlayed)),e.length){this.resolveOffsets(e,t);let c=0,h=0;if(e.forEach((f,p)=>{const m=f.cue.pre,_=f.cue.post,E=e[p-1]||null,C=f.appendInPlace,S=_?r:f.startOffset,I=f.duration,R=f.timelineOccupancy===Oo.Range?I:0,k=f.resumptionOffset,D=E?.startTime===S,x=S+f.cumulativeDuration;let N=C?x+I:S+k;if(m||!_&&S<=0){const H=h;h+=R,f.timelineStart=x;const O=a;a+=I,i.push({event:f,start:x,end:N,playout:{start:O,end:a},integrated:{start:H,end:h}})}else if(S<=r){if(!D){const P=S-c;if(P>sp){const G=c,J=h;h+=P;const se=a;a+=P;const ie={previousEvent:e[p-1]||null,nextEvent:f,start:G,end:G+P,playout:{start:se,end:a},integrated:{start:J,end:h}};i.push(ie)}else P>0&&E&&(E.cumulativeDuration+=P,i[i.length-1].end=S)}_&&(N=x),f.timelineStart=x;const H=h;h+=R;const O=a;a+=I,i.push({event:f,start:x,end:N,playout:{start:O,end:a},integrated:{start:H,end:h}})}else return;const B=f.resumeTime;_||B>r?c=r:c=B}),c<r){var l;const f=c,p=h,m=r-c;h+=m;const _=a;a+=m,i.push({previousEvent:((l=i[i.length-1])==null?void 0:l.event)||null,nextEvent:null,start:c,end:f+m,playout:{start:_,end:a},integrated:{start:p,end:h}})}this.setDurations(r,a,h)}else i.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,s=i.live?1/0:i.edge;let r=0,a=-1;e.forEach((l,c)=>{const h=l.cue.pre,f=l.cue.post,p=h?0:f?s:l.startTime;this.updateAssetDurations(l),a===p?l.cumulativeDuration=r:(r=0,a=p),!f&&l.snapOptions.in&&(l.resumeAnchor=ar(null,i.fragments,l.startOffset+l.resumptionOffset,0,0)||void 0),l.appendInPlace&&!l.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(l,t)||(l.appendInPlace=!1)),!l.appendInPlace&&c+1<e.length&&e[c+1].startTime-e[c].resumeTime<sp&&(e[c+1].appendInPlace=!1,e[c+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${l}`));const _=we(l.resumeOffset)?l.resumeOffset:l.duration;r+=_})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(i-s)>Hr?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${s}`),!1):t?!Object.keys(t).some(a=>{const l=t[a].details,c=l.edge;if(i>=c)return this.log(`"${e.identifier}" resumption ${i} past ${a} playlist end ${c}`),!1;const h=ar(null,l.fragments,i);if(!h)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${a} playlist (${l.fragStart}-${l.fragmentEnd})`),!0;const f=a==="audio"?.175:0;return Math.abs(h.start-i)<Hr+f||Math.abs(h.end-i)<Hr+f?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${a} fragment bounds (${h.start}-${h.end} sn: ${h.sn} cc: ${h.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${i} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,s=!1,r=!1;e.assetList.forEach((a,l)=>{const c=t+i;a.startOffset=i,a.timelineStart=c,s||(s=a.duration===null),r||(r=!!a.error);const h=a.error?0:a.duration||0;i+=h}),s&&!r?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Es(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class iC{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let s;try{s=uv(i,this.hls.sessionId,e.baseUrl)}catch(m){const _=this.assignAssetListError(e,Y.ASSET_LIST_LOAD_ERROR,m,i);this.hls.trigger(L.ERROR,_);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,a=r.loader,l=new a(r),c={responseType:"json",url:s.href},h=r.interstitialAssetListLoadPolicy.default,f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,_,E,C)=>{const S=m.data,I=S?.ASSETS;if(!Array.isArray(I)){const R=this.assignAssetListError(e,Y.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),E.url,_,C);this.hls.trigger(L.ERROR,R);return}e.assetListResponse=S,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:S,networkDetails:C})},onError:(m,_,E,C)=>{const S=this.assignAssetListError(e,Y.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${m.code} ${m.text} (${_.url})`),_.url,C,E);this.hls.trigger(L.ERROR,S)},onTimeout:(m,_,E)=>{const C=this.assignAssetListError(e,Y.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${_.url})`),_.url,m,E);this.hls.trigger(L.ERROR,C)}};return l.load(c,f,p),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),l}assignAssetListError(e,t,i,s,r,a){return e.error=i,{type:ke.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:i,networkDetails:a,stats:r}}}function rp(n){n?.play().catch(()=>{})}class sC extends Ai{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;const s=i-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const a=s<=-.01;this.timelinePos=i,this.bufferedPos=i;const l=this.playingItem;if(!l){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(i,i-s)&&this.updateSchedule(),this.checkBuffer(),a&&i<l.start||i>=l.end){var c;const m=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(l)&&(c=this.media)!=null&&c.paused&&(this.shouldPlay=!1),!a){const _=this.findItemIndex(l);if(m>_){const E=this.schedule.findJumpRestrictedIndex(_+1,m);if(E>_){this.setSchedulePosition(E);return}}}this.setSchedulePosition(m);return}const h=this.playingAsset;if(!h){if(this.playingLastItem&&this.isInterstitial(l)){const m=l.event.assetList[0];m&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,m))}return}const f=h.timelineStart,p=h.duration||0;(a&&i<f||i>=f+p)&&this.setScheduleToAssetAtTime(i,h)},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(i>=s.end){this.timelinePos=s.end;const l=this.findItemIndex(s);this.setSchedulePosition(l+1)}const r=this.playingAsset;if(!r)return;const a=r.timelineStart+(r.duration||0);i>=a&&this.setScheduleToAssetAtTime(i,r)},this.onScheduleUpdate=(i,s)=>{const r=this.schedule,a=this.playingItem,l=r.events||[],c=r.items||[],h=r.durations,f=i.map(E=>E.identifier),p=!!(l.length||f.length);(p||s)&&this.log(`INTERSTITIALS_UPDATED (${l.length}): ${l}
Schedule: ${c.map(E=>Es(E))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const C=E.assetItem.timelineStart,S=E.timelineOffset-C;if(S)try{E.timelineOffset=C}catch(I){Math.abs(S)>Hr&&this.warn(`${I} ("${E.assetId}" ${E.timelineOffset}->${C})`)}}});let m=null;if(a){const E=this.updateItem(a,this.timelinePos);this.itemsMatch(a,E)&&(this.playingItem=E,this.waitingItem=this.endedItem=null,m=()=>this.trimInPlace(E,a))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const _=this.bufferingItem;if(_){const E=this.updateItem(_,this.bufferedPos);this.itemsMatch(_,E)?(this.bufferingItem=E,m||(m=()=>this.trimInPlace(E,_))):_.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(_.event,null))}if(i.forEach(E=>{E.assetList.forEach(C=>{this.clearAssetPlayer(C.identifier,null)})}),p||s){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:l.slice(0),schedule:c.slice(0),durations:h,removedIds:f}),this.isInterstitial(a)&&f.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}m&&m(),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new iC(e),this.schedule=new tC(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){wi(e,"play",this.onPlay),wi(e,"pause",this.onPause),wi(e,"seeking",this.onSeeking),wi(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;pi(i,"seeking",this.onSeeking),pi(i,"timeupdate",this.onTimeupdate),pi(i,"play",this.onPlay),pi(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!s){this.clearScheduleState();const r=this.findItemIndex(i);this.setSchedulePosition(r)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,s=this.media;if(this.media=null,!i&&(s&&this.removeMediaListeners(s),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=p=>p&&e.getAssetPlayer(p.identifier),s=(p,m,_,E,C)=>{if(p){let S=p[m].start;const I=p.event;if(I){if(m==="playout"||I.timelineOccupancy!==Oo.Point){const R=i(_);R?.interstitial===I&&(S+=R.assetItem.startOffset+R[C])}}else{const R=E==="bufferedPos"?a():e[E];S+=R-p.start}return S}return 0},r=(p,m)=>{if(p!==0&&m!=="primary"&&e.schedule.length){var _;const E=e.schedule.findItemIndexAtTime(p),C=(_=e.schedule.items)==null?void 0:_[E];if(C){const S=C[m].start-C.start;return p+S}}return p},a=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?l("primary"):Math.max(p,0)},l=p=>{var m;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:e.schedule.durations[p]},c=(p,m)=>{var _,E;const C=e.effectivePlayingItem;if(C!=null&&(_=C.event)!=null&&_.restrictions.skip)return;e.log(`seek to ${p} "${m}"`);const S=e.effectivePlayingItem,I=e.schedule.findItemIndexAtTime(p,m),R=(E=e.schedule.items)==null?void 0:E[I],k=e.getBufferingPlayer(),D=k?.interstitial,x=D?.appendInPlace,N=S&&e.itemsMatch(S,R);if(S&&(x||N)){const H=i(e.playingAsset),O=H?.media||e.primaryMedia;if(O){const P=m==="primary"?O.currentTime:s(S,m,e.playingAsset,"timelinePos","currentTime"),G=p-P,J=(x?P:O.currentTime)+G;if(J>=0&&(!H||x||J<=H.duration)){O.currentTime=J;return}}}if(R){let H=p;if(m!=="primary"){const P=R[m].start,G=p-P;H=R.start+G}const O=!e.isInterstitial(R);if((!e.isInterstitial(S)||S.event.appendInPlace)&&(O||R.event.appendInPlace)){const P=e.media||(x?k?.media:null);P&&(P.currentTime=H)}else if(S){const P=e.findItemIndex(S);if(I>P){const J=e.schedule.findJumpRestrictedIndex(P+1,I);if(J>P){e.setSchedulePosition(J);return}}let G=0;if(O)e.timelinePos=H,e.checkBuffer();else{var B;const J=R==null||(B=R.event)==null?void 0:B.assetList;if(J){const se=p-(R[m]||R).start;for(let ie=J.length;ie--;){const ne=J[ie];if(ne.duration&&se>=ne.startOffset&&se<ne.startOffset+ne.duration){G=ie;break}}}}e.setSchedulePosition(I,G)}}},h=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const m=t();return e.isInterstitial(m)?m:null},f={get currentTime(){const p=h(),m=e.effectivePlayingItem;return m&&m===p?s(m,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-m.playout.start:0},set currentTime(p){const m=h(),_=e.effectivePlayingItem;_&&_===m&&c(p+_.playout.start,"playout")},get duration(){const p=h();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const m=(p=h())==null?void 0:p.event.assetList;return m?m.map(_=>e.getAssetPlayer(_.identifier)):[]},get playingIndex(){var p;const m=(p=h())==null?void 0:p.event;return m&&e.effectivePlayingAsset?m.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return h()}};this.manager={get events(){var p,m;return((p=e.schedule)==null||(m=p.events)==null?void 0:m.slice(0))||[]},get schedule(){var p,m;return((p=e.schedule)==null||(m=p.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return h()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return a()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){c(p,"primary")},get duration(){return l("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){c(p,"integrated")},get duration(){return l("integrated")},get seekableStart(){var p;return r(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,m=p?.event;if(m&&!m.restrictions.skip){const _=e.findItemIndex(p);if(m.appendInPlace){const E=p.playout.start+p.event.duration;c(E+.001,"playout")}else e.advanceAfterAssetEnded(m,_,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,i;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(r=this.primaryMedia);const a=(i=r)==null?void 0:i.currentTime;if(!(a===void 0||!we(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,s=e.media;if(i&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${ft(r)}`),this.detachedData=r}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var i,s;if(e.media===t)return;let r=null;const a=this.hls,l=e!==a,c=l&&e.interstitial.appendInPlace,h=(i=this.detachedData)==null?void 0:i.mediaSource;let f;if(a.media)c&&(r=a.transferMedia(),this.detachedData=r),f="Primary";else if(h){const _=this.getBufferingPlayer();_?(r=_.transferMedia(),f=`${_}`):f="detached MediaSource"}else f="detached media";if(!r){if(h)r=this.detachedData,this.log(`using detachedData: MediaSource ${ft(r)}`);else if(!this.detachedData||a.media===t){const _=this.playerQueue;_.length>1&&_.forEach(E=>{if(l&&E.interstitial.appendInPlace!==c){const C=E.interstitial;this.clearInterstitial(E.interstitial,null),C.appendInPlace=!1,C.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${C}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=r&&"mediaSource"in r&&((s=r.mediaSource)==null?void 0:s.readyState)!=="closed",m=p&&r?r:t;if(this.log(`${p?"transfering MediaSource":"attaching media"} to ${l?e:"Primary"} from ${f}`),m===r){const _=l&&e.assetId===this.schedule.assetIdAtEnd;m.overrides={duration:this.schedule.duration,endOfStream:!l||_,cueRemoval:!l}}e.attachMedia(m)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,s=this.effectivePlayingItem;if(i===-1){const r=this.hls.startPosition;if(this.timelinePos=r,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(r>=0||!this.primaryLive){const a=this.timelinePos=r>0?r:0,l=e.findItemIndexAtTime(a);this.setSchedulePosition(l)}}else if(s&&!this.playingItem){const r=e.findItemIndex(s);this.setSchedulePosition(r)}}advanceAfterAssetEnded(e,t,i){const s=bu(e,i);if(!e.isAssetPastPlayoutLimit(s))this.setSchedulePosition(t,s);else{const r=this.schedule.items;if(r){const a=t+1,l=r.length;if(a>=l){this.setSchedulePosition(-1);return}const c=e.resumeTime;this.timelinePos<c&&(this.timelinePos=c,this.checkBuffer()),this.setSchedulePosition(a)}}}setScheduleToAssetAtTime(e,t){const i=this.schedule,s=t.parentIdentifier,r=i.getEvent(s);if(r){const a=i.findEventIndex(s),l=i.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,a,l-1)}}setSchedulePosition(e,t){const i=this.schedule.items;if(!i||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const s=e>=0?i[e]:null,r=this.playingItem,a=this.playingLastItem;if(this.isInterstitial(r)){var l;const h=r.event,f=this.playingAsset,p=f?.identifier,m=p?this.getAssetPlayer(p):null;if(m&&p&&(!this.eventItemsMatch(r,s)||t!==void 0&&p!==((l=h.assetList)==null?void 0:l[t].identifier))){var c;const _=h.findAssetIndex(f);if(this.log(`INTERSTITIAL_ASSET_ENDED ${_+1}/${h.assetList.length} ${Mr(f)}`),this.endedAsset=f,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:f,assetListIndex:_,event:h,schedule:i.slice(0),scheduleIndex:e,player:m}),r!==this.playingItem){this.itemsMatch(r,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),_);return}this.retreiveMediaSource(p,s),m.media&&!((c=this.detachedData)!=null&&c.mediaSource)&&m.detachMedia()}if(!this.eventItemsMatch(r,s)&&(this.endedItem=r,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${Es(r)}`),h.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:h,schedule:i.slice(0),scheduleIndex:e}),h.cue.once)){this.updateSchedule();const _=this.schedule.items;if(s&&_){const E=this.findItemIndex(s);this.advanceSchedule(E,_,t,r,a)}return}}this.advanceSchedule(e,i,t,r,a)}advanceSchedule(e,t,i,s,r){const a=e>=0?t[e]:null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(h=>{const f=h.interstitial,p=this.schedule.findEventIndex(f.identifier);(p<e||p>e+1)&&this.clearInterstitial(f,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const h=a.event;if(i===void 0){i=this.schedule.findAssetIndex(h,this.timelinePos);const _=bu(h,i-1);if(h.isAssetPastPlayoutLimit(_)){this.advanceAfterAssetEnded(h,e,i);return}i=_}const f=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let p=this.preloadAssets(h,i);if(this.eventItemsMatch(a,f||s)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${Es(a)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const m=h.assetList[i];if(!m){const _=t[e+1],E=this.media;_&&E&&!this.isInterstitial(_)&&E.currentTime<_.start&&(E.currentTime=this.timelinePos=_.start),this.advanceAfterAssetEnded(h,e,i||0);return}if(p||(p=this.getAssetPlayer(m.identifier)),p===null||p.destroyed){const _=h.assetList.length;this.warn(`asset ${i+1}/${_} player destroyed ${h}`),p=this.createAssetPlayer(h,m,i)}if(!this.eventItemsMatch(a,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(m))return;this.startAssetPlayer(p,i,t,e,l),this.shouldPlay&&rp(p.media)}else a!==null?(this.resumePrimary(a,e,s),this.shouldPlay&&rp(this.hls.media)):r&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Es(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.timelinePos=a),this.attachPrimary(a,e)}if(!i)return;const r=this.schedule.items;r&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Es(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:r.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(i<s.fragmentStart||i>s.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ue.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,s),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((i=s.mainForwardBufferInfo)==null?void 0:i.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const i=this.hls.levels[t.level],s=nt(nt({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=nt(nt({},this.altSelection),{},{audio:i});return}const r=nt(nt({},s),{},{audio:i});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=nt(nt({},this.altSelection),{},{subtitles:i});return}const r=nt(nt({},s),{},{subtitles:i});this.mediaSelection=r}onAudioTrackSwitching(e,t){const i=gf(t);this.playerQueue.forEach(s=>s.hls.setAudioOption(t)||s.hls.setAudioOption(i))}onSubtitleTrackSwitch(e,t){const i=gf(t);this.playerQueue.forEach(s=>s.hls.setSubtitleOption(t)||t.id!==-1&&s.hls.setSubtitleOption(i))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const r=t[s];if(r.cue.post){var i;const a=this.schedule.findEventIndex(r.identifier),l=(i=this.schedule.items)==null?void 0:i[a];this.isInterstitial(l)&&this.eventItemsMatch(l,this.bufferingItem)&&this.bufferedToItem(l,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){const i=this.schedule.items;if(e&&i){const s=this.findItemIndex(e,t);return i[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(r.identifier,null)});const i=e.end+.25,s=Ue.bufferInfo(this.primaryMedia,i,0);(s.end>i||(s.nextStart||0)>i)&&(this.attachPrimary(i,null),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const i=Ue.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,t,e)}updateBufferedPos(e,t,i){const s=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const a=this.playingItem,l=this.findItemIndex(a);let c=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var h,f;const p=this.findItemIndex(r),m=Math.min(p+1,t.length-1),_=t[m];if((c===-1&&r&&e>=r.end||(h=_.event)!=null&&h.appendInPlace&&e+.01>=_.start)&&(c=m),m-l>1&&(r==null||(f=r.event)==null?void 0:f.appendInPlace)===!1)return;if(this.bufferedPos=e,c>p&&c>l)this.bufferedToItem(_);else{const E=this.primaryDetails;this.primaryLive&&E&&e>E.edge-E.targetduration&&_.start<E.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(_)&&this.preloadAssets(_.event,0)}}else i&&a&&!this.itemsMatch(a,r)&&(c===l?this.bufferedToItem(a):c===l+1&&this.bufferedToItem(t[c]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const r=this.getAssetPlayer(s.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:s,events:r}=i;if(!s||!r)return t;const a=this.isInterstitial(e),l=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const c=l?l.remaining:t?t.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Es(e)}`+(t?` (${c.toFixed(2)} remaining)`:"")),this.playbackDisabled||(a?e.event.assetList.forEach(h=>{const f=this.getAssetPlayer(h.identifier);f&&f.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(h=>h.pauseBuffering()))),this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,s=i.assetList.length===0&&!i.assetListLoader,r=i.cue.once;if(s||!r){const a=this.preloadAssets(i,t);if(a!=null&&a.interstitial.appendInPlace){const l=i.assetList[t],c=this.primaryMedia;l&&c&&this.bufferAssetPlayer(a,c)}}}preloadAssets(e,t){const i=e.assetUrl,s=e.assetList.length,r=s===0&&!e.assetListLoader,a=e.cue.once;if(r){const c=e.timelineStart;if(e.appendInPlace){var l;const m=this.playingItem;!this.isInterstitial(m)&&(m==null||(l=m.nextEvent)==null?void 0:l.identifier)===e.identifier&&this.flushFrontBuffer(c+.25)}let h,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const m=f-c;m>0&&(h=Math.round(m*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:s} ${e}${h?` live-start: ${f} start-offset: ${h}`:""}`),i)return this.createAsset(e,0,0,c,e.duration,i);const p=this.assetListLoader.loadAssetList(e,h);p&&(e.assetListLoader=p)}else if(!a&&s){for(let c=t;c<s;c++){const h=e.assetList[c],f=this.getAssetPlayerQueueIndex(h.identifier);(f===-1||this.playerQueue[f].destroyed)&&!h.error&&this.createAssetPlayer(e,h,c)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,s,r,a){const l={parentIdentifier:e.identifier,identifier:Q0(e,a,t),duration:r,startOffset:i,timelineStart:s,uri:a};return this.createAssetPlayer(e,l,t)}createAssetPlayer(e,t,i){const s=this.hls,r=s.userConfig;let a=r.videoPreference;const l=s.loadLevelObj||s.levels[s.currentLevel];(a||l)&&(a=st({},a),l.videoCodec&&(a.videoCodec=l.videoCodec),l.videoRange&&(a.allowedVideoRanges=[l.videoRange]));const c=s.audioTracks[s.audioTrack],h=s.subtitleTracks[s.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const k=this.timelinePos-t.timelineStart;if(k>1){const D=t.duration;D&&k<D&&(f=k)}}const p=t.identifier,m=nt(nt({},r),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:c||r.audioPreference,subtitlePreference:h||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(m.timelineOffset=t.timelineStart));const _=m.cmcd;_!=null&&_.sessionId&&_.contentId&&(m.cmcd=st({},_,{contentId:Fn(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const E=new eC(this.HlsPlayerClass,m,e,t);this.playerQueue.push(E),e.assetList[i]=t;const C=k=>{if(k.live){const N=new Error(`Interstitials MUST be VOD assets ${e}`),B={fatal:!0,type:ke.OTHER_ERROR,details:Y.INTERSTITIAL_ASSET_ITEM_ERROR,error:N};this.handleAssetItemError(B,e,this.schedule.findEventIndex(e.identifier),i,N.message);return}const D=k.edge-k.fragmentStart,x=t.duration;(x===null||D>x)&&(this.log(`Interstitial asset "${p}" duration change ${x} > ${D}`),t.duration=D,this.updateSchedule())};E.on(L.LEVEL_UPDATED,(k,{details:D})=>C(D)),E.on(L.LEVEL_PTS_UPDATED,(k,{details:D})=>C(D));const S=(k,D)=>{const x=this.getAssetPlayer(p);if(x&&D.tracks){x.off(L.BUFFER_CODECS,S),x.tracks=D.tracks;const N=this.primaryMedia;this.bufferingAsset===x.assetItem&&N&&!x.media&&this.bufferAssetPlayer(x,N)}};E.on(L.BUFFER_CODECS,S);const I=()=>{var k;const D=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${D}`),!D)return;const x=this.schedule.findEventIndex(e.identifier),N=(k=this.schedule.items)==null?void 0:k[x];if(this.isInterstitial(N)){const H=e.findAssetIndex(t),O=bu(e,H);if(!e.isAssetPastPlayoutLimit(O))this.bufferedToItem(N,O);else{var B;const P=(B=this.schedule.items)==null?void 0:B[x+1];P&&this.bufferedToItem(P)}}};E.on(L.BUFFERED_TO_END,I);const R=k=>()=>{if(!this.getAssetPlayer(p))return;this.shouldPlay=!0;const x=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,x,k)};return E.once(L.MEDIA_ENDED,R(i)),E.once(L.PLAYOUT_LIMIT_REACHED,R(1/0)),E.on(L.ERROR,(k,D)=>{const x=this.getAssetPlayer(p);if(D.details===Y.BUFFER_STALLED_ERROR){if(x!=null&&x.media){const N=x.currentTime,B=x.duration-N;N&&e.appendInPlace&&B/x.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${p} ${e} at ${x.media.currentTime}`),I()):(this.warn(`Stalled at ${N} of ${N+B} in asset ${p} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${D.error} ${e}`)}),E.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(p))return;const D=new Error(`Asset player destroyed unexpectedly ${p}`),x={fatal:!0,type:ke.OTHER_ERROR,details:Y.INTERSTITIAL_ASSET_ITEM_ERROR,error:D};this.handleAssetItemError(x,e,this.schedule.findEventIndex(e.identifier),i,D.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Mr(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:E}),E}clearInterstitial(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&Es(t)}`);const s=this.playerQueue[i];this.transferMediaFromPlayer(s,t),this.playerQueue.splice(i,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,s,r){const{interstitial:a,assetItem:l,assetId:c}=e,h=a.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=l,(!f||f.identifier!==c)&&(f&&(this.clearAssetPlayer(f.identifier,i[s]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${h} ${Mr(l)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:l,assetListIndex:t,event:a,schedule:i.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var i,s;const{interstitial:r,assetItem:a}=e,l=this.schedule.findEventIndex(r.identifier),c=(i=this.schedule.items)==null?void 0:i[l];if(!c)return;this.setBufferingItem(c),this.bufferingAsset=a;const h=this.getBufferingPlayer();if(h===e)return;const f=r.appendInPlace;if(f&&h?.interstitial.appendInPlace===!1)return;const p=h?.tracks||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(f&&a!==this.playingAsset){if(!e.tracks)return;if(p&&!im(p,e.tracks)){const m=new Error(`Asset ${Mr(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),_={fatal:!0,type:ke.OTHER_ERROR,details:Y.INTERSTITIAL_ASSET_ITEM_ERROR,error:m},E=r.findAssetIndex(a);this.handleAssetItemError(_,r,l,E,m.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,i,s,r){if(e.details===Y.BUFFER_STALLED_ERROR)return;const a=t.assetList[s];this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&Mr(a)} ${e.error}`);const l=a?.identifier,c=this.getAssetPlayerQueueIndex(l),h=this.playerQueue[c]||null,f=this.schedule.items,p=st({},e,{fatal:!1,errorAction:$n(!0),asset:a,assetListIndex:s,event:t,schedule:f,scheduleIndex:i,player:h});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const m=this.playingAsset,_=new Error(r);if(a&&(this.clearAssetPlayer(l,null),a.error=_),!t.assetList.some(E=>!E.error))t.error=_;else{for(let E=s;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):m&&m.identifier===l&&this.advanceAfterAssetEnded(t,i,s)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${i?Es(i):"<none>"} error: ${e.error}`);let s=this.timelinePos;s===-1&&(s=this.hls.startPosition);const r=this.updateItem(i,s);this.itemsMatch(i,r)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));const a=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var i;const s=t.event,r=s.identifier,a=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(r))return;const l=s.timelineStart,c=s.duration;let h=0;a.forEach((E,C)=>{const S=parseFloat(E.DURATION);this.createAsset(s,C,h,l+h,S,E.URI),h+=S}),s.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${c}) ${s}`);const f=this.waitingItem,p=f?.event.identifier===r;this.updateSchedule();const m=(i=this.bufferingItem)==null?void 0:i.event;if(p){var _;const E=this.schedule.findEventIndex(r),C=(_=this.schedule.items)==null?void 0:_[E];if(C){if(!this.playingItem&&this.timelinePos>C.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){s.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${s}`),this.primaryFallback(s);return}this.setBufferingItem(C)}this.setSchedulePosition(E)}else if(m?.identifier===r&&m.appendInPlace){const E=s.assetList[0],C=this.getAssetPlayer(E.identifier),S=this.primaryMedia;E&&C&&S&&this.bufferAssetPlayer(C,S)}}onError(e,t){switch(t.details){case Y.ASSET_LIST_PARSING_ERROR:case Y.ASSET_LIST_LOAD_ERROR:case Y.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&this.primaryFallback(i);break}case Y.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const np=500;class rC extends ac{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",Ie.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ce.IDLE,this.setInterval(np),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:s}=t;if(this.fragContextChanged(i)||(At(i)&&(this.fragPrevious=i),this.state=ce.IDLE),!s)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const l=i.start;for(let h=0;h<r.length;h++)if(l>=r[h].start&&l<=r[h].end){a=r[h];break}const c=i.start+i.duration;a?a.end=c:(a={start:l,end:c},r.push(a)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:s}=t;if(i===0&&s!==Number.POSITIVE_INFINITY){const r=s-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(a=>{for(let l=0;l<a.length;){if(a[l].end<=r){a.shift();continue}else if(a[l].start<r)a[l].start=r;else break;l++}}),this.fragmentTracker.removeFragmentsInRange(i,r,Ie.SUBTITLE)}}onError(e,t){const i=t.frag;i?.type===Ie.SUBTITLE&&(t.details===Y.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ce.STOPPED&&(this.state=ce.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Zm(this.levels,t)){this.levels=t.map(i=>new Un(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const s=new Un(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ie.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==ce.STOPPED&&this.setInterval(np)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:s,levels:r}=this,{details:a,id:l}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${l}`);return}const c=r[l];if(l>=r.length||!c)return;this.log(`Subtitle track ${l} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(a.live||(i=c.details)!=null&&i.live){if(a.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const m=p.fragments[0];if(!c.details)a.hasProgramDateTime&&p.hasProgramDateTime?(Do(a,p),h=a.fragmentStart):m&&(h=m.start,Th(a,h));else{var f;h=this.alignPlaylists(a,c.details,(f=this.levelLastLoaded)==null?void 0:f.details),h===0&&m&&(h=m.start,Th(a,h))}p&&!this.startFragRequested&&this.setStartPosition(p,h)}c.details=a,this.levelLastLoaded=c,l===s&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:a,id:l,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===ce.IDLE&&(ar(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),c.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,s=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&s!=null&&s.key&&s.iv&&Ur(s.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer,nc(s.method)).catch(l=>{throw r.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:t}),l}).then(l=>{const c=performance.now();r.trigger(L.FRAG_DECRYPTED,{frag:t,payload:l,stats:{tstart:a,tdecrypt:c}})}).catch(l=>{this.warn(`${l.name}: ${l.message}`),this.state=ce.IDLE})}}doTick(){if(!this.media){this.state=ce.IDLE;return}if(this.state===ce.IDLE){const{currentTrackId:e,levels:t}=this,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:s}=this,r=this.getLoadPosition(),a=Ue.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,s.maxBufferHole),{end:l,len:c}=a,h=i.details,f=this.hls.maxBufferLength+h.levelTargetDuration;if(c>f)return;const p=h.fragments,m=p.length,_=h.edge;let E=null;const C=this.fragPrevious;if(l<_){const R=s.maxFragLookUpTolerance,k=l>_-R?0:R;E=ar(C,p,Math.max(p[0].start,l),k),!E&&C&&C.start<p[0].start&&(E=p[0])}else E=p[m-1];if(E=this.filterReplacedPrimary(E,i.details),!E)return;const S=E.sn-h.startSN,I=p[S-1];if(I&&I.cc===E.cc&&this.fragmentTracker.getState(I)===Lt.NOT_LOADED&&(E=I),this.fragmentTracker.getState(E)===Lt.NOT_LOADED){const R=this.mapToInitFragWhenRequired(E);R&&this.loadFragment(R,i,l)}}}loadFragment(e,t,i){At(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new nC(this.tracksBuffered[this.currentTrackId]||[])}}class nC{constructor(e){this.buffered=void 0;const t=(i,s,r)=>{if(s=s>>>0,s>r-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${r})`);return e[s][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const aC={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},hv=n=>String.fromCharCode(aC[n]||n),bi=15,Ji=100,oC={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},lC={17:2,18:4,21:6,22:8,23:10,19:13,20:15},uC={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},hC={25:2,26:4,29:6,30:8,31:10,27:13,28:15},cC=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class dC{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;Ze.log(`${this.time} [${e}] ${i}`)}}}const Xs=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class cv{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const s=t[i];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class fC{constructor(){this.uchar=" ",this.penState=new cv}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class pC{constructor(e){this.chars=[],this.pos=0,this.currPenState=new cv,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Ji;t++)this.chars.push(new fC);this.logger=e}equals(e){for(let t=0;t<Ji;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Ji;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Ji;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ji&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ji)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=hv(e);if(this.pos>=Ji){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Ji;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<Ji;i++){const s=this.chars[i].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Su{constructor(e){this.rows=[],this.currRow=bi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<bi;t++)this.rows.push(new pC(e));this.logger=e}reset(){for(let e=0;e<bi;e++)this.rows[e].clear();this.currRow=bi-1}equals(e){let t=!0;for(let i=0;i<bi;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<bi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<bi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+ft(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let l=0;l<bi;l++)this.rows[l].clear();const r=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const l=a.rows[r].cueStartTime,c=this.logger.time;if(l!==null&&c!==null&&l<c)for(let h=0;h<this.nrRollUpRows;h++)this.rows[t-this.nrRollUpRows+h+1].copy(a.rows[r+h])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,a=Math.max(r-1,0);i.setCursor(e.indent),e.color=i.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+ft(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",s=-1;for(let r=0;r<bi;r++){const a=this.rows[r].getTextString();a&&(s=r+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class ap{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Su(i),this.nonDisplayedMemory=new Su(i),this.lastOutputScreen=new Su(i),this.currRollUpRow=this.displayedMemory.rows[bi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[bi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[i]}this.logger.log(2,"MIDROW: "+ft(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class op{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=mC(),this.logger=void 0;const s=this.logger=new dC;this.channels=[null,new ap(e,t,s),new ap(e+1,i,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const s=t[i]&127,r=t[i+1]&127;let a=!1,l=null;if(s===0&&r===0)continue;this.logger.log(3,()=>"["+Xs([t[i],t[i+1]])+"] -> ("+Xs([s,r])+")");const c=this.cmdHistory;if(s>=16&&s<=31){if(gC(s,r,c)){Va(null,null,c),this.logger.log(3,()=>"Repeated command ("+Xs([s,r])+") is dropped");continue}Va(s,r,this.cmdHistory),a=this.parseCmd(s,r),a||(a=this.parseMidrow(s,r)),a||(a=this.parsePAC(s,r)),a||(a=this.parseBackgroundAttributes(s,r))}else Va(null,null,c);if(!a&&(l=this.parseChars(s,r),l)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(l):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!l&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Xs([s,r])+" orig: "+Xs([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(i||s))return!1;const r=e===20||e===21||e===23?1:2,a=this.channels[r];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Xs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(s||r))return!1;const a=e<=23?1:2;t>=64&&t<=95?i=a===1?oC[e]:uC[e]:i=a===1?lC[e]:hC[e];const l=this.channels[a];return l?(l.setPAC(this.interpretPAC(i,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(e,t){let i,s=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19){let a;r===17?a=t+80:r===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+hv(a)+"' in channel "+i),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Xs(s).join(",")),s}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(i||s))return!1;let r;const a={};e===16||e===24?(r=Math.floor((t-32)/2),a.background=cC[r],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const l=e<=23?1:2;return this.channels[l].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Va(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function Va(n,e,t){t.a=n,t.b=e}function gC(n,e,t){return t.a===n&&t.b===e}function mC(){return{a:null,b:null}}var vc=function(){if(Po!=null&&Po.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(l,c){if(typeof c!="string"||!Array.isArray(l))return!1;const h=c.toLowerCase();return~l.indexOf(h)?h:!1}function i(l){return t(n,l)}function s(l){return t(e,l)}function r(l,...c){let h=1;for(;h<arguments.length;h++){const f=arguments[h];for(const p in f)l[p]=f[p]}return l}function a(l,c,h){const f=this,p={enumerable:!0};f.hasBeenReset=!1;let m="",_=!1,E=l,C=c,S=h,I=null,R="",k=!0,D="auto",x="start",N=50,B="middle",H=50,O="middle";Object.defineProperty(f,"id",r({},p,{get:function(){return m},set:function(P){m=""+P}})),Object.defineProperty(f,"pauseOnExit",r({},p,{get:function(){return _},set:function(P){_=!!P}})),Object.defineProperty(f,"startTime",r({},p,{get:function(){return E},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");E=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",r({},p,{get:function(){return C},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");C=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",r({},p,{get:function(){return S},set:function(P){S=""+P,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",r({},p,{get:function(){return I},set:function(P){I=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",r({},p,{get:function(){return R},set:function(P){const G=i(P);if(G===!1)throw new SyntaxError("An invalid or illegal string was specified.");R=G,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",r({},p,{get:function(){return k},set:function(P){k=!!P,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",r({},p,{get:function(){return D},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",r({},p,{get:function(){return x},set:function(P){const G=s(P);if(!G)throw new SyntaxError("An invalid or illegal string was specified.");x=G,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",r({},p,{get:function(){return N},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");N=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",r({},p,{get:function(){return B},set:function(P){const G=s(P);if(!G)throw new SyntaxError("An invalid or illegal string was specified.");B=G,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",r({},p,{get:function(){return H},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");H=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",r({},p,{get:function(){return O},set:function(P){const G=s(P);if(!G)throw new SyntaxError("An invalid or illegal string was specified.");O=G,this.hasBeenReset=!0}})),f.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class vC{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function dv(n){function e(i,s,r,a){return(i|0)*3600+(s|0)*60+(r|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class yC{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function fv(n,e,t,i){const s=i?n.split(i):[n];for(const r in s){if(typeof s[r]!="string")continue;const a=s[r].split(t);if(a.length!==2)continue;const l=a[0],c=a[1];e(l,c)}}const Ah=new vc(0,0,""),Ga=Ah.align==="middle"?"middle":"center";function TC(n,e,t){const i=n;function s(){const l=dv(n);if(l===null)throw new Error("Malformed timestamp: "+i);return n=n.replace(/^[^\sa-zA-Z-]+/,""),l}function r(l,c){const h=new yC;fv(l,function(m,_){let E;switch(m){case"region":for(let C=t.length-1;C>=0;C--)if(t[C].id===_){h.set(m,t[C].region);break}break;case"vertical":h.alt(m,_,["rl","lr"]);break;case"line":E=_.split(","),h.integer(m,E[0]),h.percent(m,E[0])&&h.set("snapToLines",!1),h.alt(m,E[0],["auto"]),E.length===2&&h.alt("lineAlign",E[1],["start",Ga,"end"]);break;case"position":E=_.split(","),h.percent(m,E[0]),E.length===2&&h.alt("positionAlign",E[1],["start",Ga,"end","line-left","line-right","auto"]);break;case"size":h.percent(m,_);break;case"align":h.alt(m,_,["start",Ga,"end","left","right"]);break}},/:/,/\s/),c.region=h.get("region",null),c.vertical=h.get("vertical","");let f=h.get("line","auto");f==="auto"&&Ah.line===-1&&(f=-1),c.line=f,c.lineAlign=h.get("lineAlign","start"),c.snapToLines=h.get("snapToLines",!0),c.size=h.get("size",100),c.align=h.get("align",Ga);let p=h.get("position","auto");p==="auto"&&Ah.position===50&&(p=c.align==="start"||c.align==="left"?0:c.align==="end"||c.align==="right"?100:50),c.position=p}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);n=n.slice(3),a(),e.endTime=s(),a(),r(n,e)}function pv(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class _C{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new vC,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let r=t.buffer,a=0;for(r=pv(r);a<r.length&&r[a]!=="\r"&&r[a]!==`
`;)++a;const l=r.slice(0,a);return r[a]==="\r"&&++a,r[a]===`
`&&++a,t.buffer=r.slice(a),l}function s(r){fv(r,function(a,l){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=i();const l=r.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(l!=null&&l[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=i(),t.state){case"HEADER":/:/.test(r)?s(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new vc(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{TC(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const l=r.indexOf("-->")!==-1;if(!r||l&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const EC=/\r\n|\n\r|\n|\r/g,Cu=function(e,t,i=0){return e.slice(i,i+t.length)===t},bC=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!we(t)||!we(i)||!we(s)||!we(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*s,t+=60*60*1e3*r,t};function yc(n,e,t){return Fn(n.toString())+Fn(e.toString())+Fn(t)}const SC=function(e,t,i){let s=e[t],r=e[s.prevCC];if(!r||!r.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=r)!=null&&a.new;){var a;e.ccOffset+=s.start-r.start,s.new=!1,s=r,r=e[s.prevCC]}e.presentationOffset=i};function CC(n,e,t,i,s,r,a){const l=new _C,c=si(new Uint8Array(n)).trim().replace(EC,`
`).split(`
`),h=[],f=e?US(e.baseTime,e.timescale):0;let p="00:00.000",m=0,_=0,E,C=!0;l.oncue=function(S){const I=t[i];let R=t.ccOffset;const k=(m-f)/9e4;if(I!=null&&I.new&&(_!==void 0?R=t.ccOffset=I.start:SC(t,i,k)),k){if(!e){E=new Error("Missing initPTS for VTT MPEGTS");return}R=k-t.presentationOffset}const D=S.endTime-S.startTime,x=di((S.startTime+R-_)*9e4,s*9e4)/9e4;S.startTime=Math.max(x,0),S.endTime=Math.max(x+D,0);const N=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(N)),S.id||(S.id=yc(S.startTime,S.endTime,N)),S.endTime>0&&h.push(S)},l.onparsingerror=function(S){E=S},l.onflush=function(){if(E){a(E);return}r(h)},c.forEach(S=>{if(C)if(Cu(S,"X-TIMESTAMP-MAP=")){C=!1,S.slice(16).split(",").forEach(I=>{Cu(I,"LOCAL:")?p=I.slice(6):Cu(I,"MPEGTS:")&&(m=parseInt(I.slice(7)))});try{_=bC(p)/1e3}catch(I){E=I}return}else S===""&&(C=!1);l.parse(S+`
`)}),l.flush()}const wu="stpp.ttml.im1t",gv=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,mv=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,wC={left:"start",center:"center",right:"end",start:"start",end:"end"};function lp(n,e,t,i){const s=je(new Uint8Array(n),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const r=s.map(l=>si(l)),a=BS(e.baseTime,1,e.timescale);try{r.forEach(l=>t(AC(l,a)))}catch(l){i(l)}}function AC(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce((p,m)=>(p[m]=s.getAttribute(`ttp:${m}`)||r[m],p),{}),l=s.getAttribute("xml:space")!=="preserve",c=up(Au(s,"styling","style")),h=up(Au(s,"layout","region")),f=Au(s,"body","[begin]");return[].map.call(f,p=>{const m=vv(p,l);if(!m||!p.hasAttribute("begin"))return null;const _=Lu(p.getAttribute("begin"),a),E=Lu(p.getAttribute("dur"),a);let C=Lu(p.getAttribute("end"),a);if(_===null)throw hp(p);if(C===null){if(E===null)throw hp(p);C=_+E}const S=new vc(_-e,C-e,m);S.id=yc(S.startTime,S.endTime,S.text);const I=h[p.getAttribute("region")],R=c[p.getAttribute("style")],k=IC(I,R,c),{textAlign:D}=k;if(D){const x=wC[D];x&&(S.lineAlign=x),S.align=D}return st(S,k),S}).filter(p=>p!==null)}function Au(n,e,t){const i=n.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function up(n){return n.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function vv(n,e){return[].slice.call(n.childNodes).reduce((t,i,s)=>{var r;return i.nodeName==="br"&&s?t+`
`:(r=i.childNodes)!=null&&r.length?vv(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function IC(n,e,t){const i="http://www.w3.org/ns/ttml#styling";let s=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),r.reduce((l,c)=>{const h=Iu(e,i,c)||Iu(n,i,c)||Iu(s,i,c);return h&&(l[c]=h),l},{})}function Iu(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function hp(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Lu(n,e){if(!n)return null;let t=dv(n);return t===null&&(gv.test(n)?t=LC(n,e):mv.test(n)&&(t=kC(n,e))),t}function LC(n,e){const t=gv.exec(n),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function kC(n,e){const t=mv.exec(n),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class Ka{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class RC{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=dp(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Ka(this,"textTrack1"),t=new Ka(this,"textTrack2"),i=new Ka(this,"textTrack3"),s=new Ka(this,"textTrack4");this.cea608Parser1=new op(1,e,t),this.cea608Parser2=new op(3,i,s)}addCues(e,t,i,s,r){let a=!1;for(let l=r.length;l--;){const c=r[l],h=PC(c[0],c[1],t,i);if(h>=0&&(c[0]=Math.min(c[0],t),c[1]=Math.max(c[1],i),a=!0,h/(i-t)>.5))return}if(a||r.push([t,i]),this.config.renderTextTracksNatively){const l=this.captionsTracks[e];this.Cues.newCue(l,t,i,s)}else{const l=this.Cues.newCue(null,t,i,s);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:l,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:r}){const{unparsedVttFrags:a}=this;i===Ie.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:r}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,l):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let s=0;s<i.textTracks.length;s++){const r=i.textTracks[s];if(cp(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:s}=this,{label:r,languageCode:a}=t[e],l=this.getExistingTrack(r,a);if(l)i[e]=l,Fr(i[e]),ov(i[e],s);else{const c=this.createTextTrack("captions",r,a);c&&(c[e]=!0,i[e]=c)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,s={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,i){const s=this.media;if(s)return s.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:s}=this;Object.keys(s).forEach(r=>{Fr(s[r]),delete s[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=dp(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)Fr(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],s=i.some(r=>r.textCodec===wu);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Zm(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const a=this.media,l=a?go(a.textTracks):null;if(this.tracks.forEach((c,h)=>{let f;if(l){let p=null;for(let m=0;m<l.length;m++)if(l[m]&&cp(l[m],c)){p=l[m],l[m]=null;break}p&&(f=p)}if(f)Fr(f);else{const p=yv(c);f=this.createTextTrack(p,c.name,c.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),l!=null&&l.length){const c=l.filter(h=>h!==null).map(h=>h.label);c.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${c.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(l=>({label:l.name,kind:l.type.toLowerCase(),default:l.default,subtitleTrack:l}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const r=`textTrack${s[1]}`,a=this.captionsProperties[r];a&&(a.label=i.name,i.lang&&(a.languageCode=i.lang),a.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Ie.MAIN){var i,s;const{cea608Parser1:r,cea608Parser2:a,lastSn:l}=this,{cc:c,sn:h}=t.frag,f=(i=(s=t.part)==null?void 0:s.index)!=null?i:-1;r&&a&&(h!==l+1||h===l&&f!==this.lastPartIndex+1||c!==this.lastCc)&&(r.reset(),a.reset()),this.lastCc=c,this.lastSn=h,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:i,payload:s}=t;if(i.type===Ie.SUBTITLE)if(s.byteLength){const r=i.decryptdata,a="stats"in t;if(r==null||!r.encrypted||a){const l=this.tracks[i.level],c=this.vttCCs;c[i.cc]||(c[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),l&&l.textCodec===wu?this._parseIMSC1(i,s):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;lp(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),i.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{i.logger.log(`Failed to parse IMSC1: ${s}`),i.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:i,payload:s}=e,{initPTS:r,unparsedVttFrags:a}=this,l=r.length-1;if(!r[i.cc]&&l===-1){a.push(e);return}const c=this.hls,h=(t=i.initSegment)!=null&&t.data?gi(i.initSegment.data,new Uint8Array(s)).buffer:s;CC(h,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,f=>{this._appendCues(f,i.level),c.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},f=>{const p=f.message==="Missing initPTS for VTT MPEGTS";p?a.push(e):this._fallbackToIMSC1(i,s),c.logger.log(`Failed to parse VTT cue: ${f}`),!(p&&l>i.cc)&&c.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:f})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||lp(t,this.initPTS[e.cc],()=>{i.textCodec=wu,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(r=>lv(s,r))}else{const s=this.tracks[t];if(!s)return;const r=s.default?"default":"subtitles"+t;i.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===Ie.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:s}=t;if(!(i.type===Ie.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let r=0;r<s.length;r++){const a=s[r].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const l=this.extractCea608Data(a);this.cea608Parser1.addData(s[r].pts,l[0]),this.cea608Parser2.addData(s[r].pts,l[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:s,type:r}){const{media:a}=this;if(!(!a||a.currentTime<i)){if(!r||r==="video"){const{captionsTracks:l}=this;Object.keys(l).forEach(c=>wh(l[c],t,i))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:l}=this;Object.keys(l).forEach(c=>wh(l[c],t,s))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let s=2;for(let r=0;r<i;r++){const a=e[s++],l=127&e[s++],c=127&e[s++];if(l===0&&c===0)continue;if((4&a)!==0){const f=3&a;(f===0||f===1)&&(t[f].push(l),t[f].push(c))}}return t}}function yv(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function cp(n,e){return!!n&&n.kind===yv(e)&&bh(e,n)}function PC(n,e,t,i){return Math.min(e,i)-Math.max(n,t)}function dp(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const DC=/\s/,xC={newCue(n,e,t,i){const s=[];let r,a,l,c,h;const f=self.VTTCue||self.TextTrackCue;for(let m=0;m<i.rows.length;m++)if(r=i.rows[m],l=!0,c=0,h="",!r.isEmpty()){var p;for(let C=0;C<r.chars.length;C++)DC.test(r.chars[C].uchar)&&l?c++:(h+=r.chars[C].uchar,l=!1);r.cueStartTime=e,e===t&&(t+=1e-4),c>=16?c--:c++;const _=pv(h.trim()),E=yc(e,t,_);n!=null&&(p=n.cues)!=null&&p.getCueById(E)||(a=new f(e,t,_),a.id=E,a.line=m+1,a.align="left",a.position=10+Math.min(80,Math.floor(c*8/32)*10),s.push(a))}return n&&s.length&&(s.sort((m,_)=>m.line==="auto"||_.line==="auto"?0:m.line>8&&_.line>8?_.line-m.line:m.line-_.line),s.forEach(m=>lv(n,m))),s}};function OC(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const MC=/(\d+)-(\d+)\/(\d+)/;class fp{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||UC,this.controller=new self.AbortController,this.stats=new Jh}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const r=FC(e,this.controller.signal),a=e.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:h}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=c&&we(c)?c:h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Vn(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var m;this.response=this.loader=p;const _=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},h-(_-s.loading.start)),!p.ok){const{status:C,statusText:S}=p;throw new $C(S||"fetch, bad network response",C,p)}s.loading.first=_,s.total=BC(p.headers)||s.total;const E=(m=this.callbacks)==null?void 0:m.onProgress;return E&&we(t.highWaterMark)?this.loadProgressively(p,s,e,t.highWaterMark,E):a?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var m,_;const E=this.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const C=p[l];C&&(s.loaded=s.total=C);const S={url:E.url,data:p,code:E.status},I=(m=this.callbacks)==null?void 0:m.onProgress;I&&!we(t.highWaterMark)&&I(s,e,p,E),(_=this.callbacks)==null||_.onSuccess(S,s,e,E)}).catch(p=>{var m;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const _=p&&p.code||0,E=p?p.message:null;(m=this.callbacks)==null||m.onError({code:_,text:E},e,p?p.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,s=0,r){const a=new xm,l=e.body.getReader(),c=()=>l.read().then(h=>{if(h.done)return a.dataLength&&r(t,i,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=h.value,p=f.length;return t.loaded+=p,p<s||a.dataLength?(a.push(f),a.dataLength>=s&&r(t,i,a.flush().buffer,e)):r(t,i,f.buffer,e),c()}).catch(()=>Promise.reject());return c()}}function FC(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(st({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function NC(n){const e=MC.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function BC(n){const e=n.get("Content-Range");if(e){const i=NC(e);if(we(i))return i}const t=n.get("Content-Length");if(t)return parseInt(t)}function UC(n,e){return new self.Request(n.url,e)}class $C extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const HC=/^age:\s*[\d.]+\s*$/im;class Tv{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Jh,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return r(i,t.url)}).catch(a=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),r(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(a=>{var l;(l=this.callbacks)==null||l.onError({code:i.status,text:a.message},t,i,s)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=i.loadPolicy;if(s)for(const l in s)e.setRequestHeader(l,s[l]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=r&&we(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const s=t.readyState,r=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const h=t.status,f=t.responseType==="text"?t.responseText:null;if(h>=200&&h<300){const E=f??t.response;if(E!=null){var a,l;i.loading.end=Math.max(self.performance.now(),i.loading.first);const C=t.responseType==="arraybuffer"?E.byteLength:E.length;i.loaded=i.total=C,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const S=(a=this.callbacks)==null?void 0:a.onProgress;S&&S(i,e,E,t);const I={url:t.responseURL,data:E,code:h};(l=this.callbacks)==null||l.onSuccess(I,i,e,t);return}}const p=r.loadPolicy.errorRetry,m=i.retry,_={url:e.url,data:void 0,code:h};if(Ro(p,m,!1,_))this.retry(p);else{var c;Ze.error(`${h} while loading ${e.url}`),(c=this.callbacks)==null||c.onError({code:h,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Ro(e,t,!0))this.retry(e);else{var i;Ze.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=ic(e,i.retry),i.retry++,Ze.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&HC.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const jC={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},VC=nt(nt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Tv,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:cb,bufferController:e0,capLevelController:gc,errorController:mb,fpsController:q0,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Sm,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:jC},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},GC()),{},{subtitleStreamController:rC,subtitleTrackController:Y0,timelineController:RC,audioStreamController:XS,audioTrackController:QS,emeController:$r,cmcdController:V0,contentSteeringController:K0,interstitialsController:sC});function GC(){return{cueHandler:xC,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function KC(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Ih(n),s=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(a=>{const l=`${a==="level"?"playlist":a}LoadPolicy`,c=e[l]===void 0,h=[];r.forEach(f=>{const p=`${a}Loading${f}`,m=e[p];if(m!==void 0&&c){h.push(p);const _=i[l].default;switch(e[l]={default:_},f){case"TimeOut":_.maxLoadTimeMs=m,_.maxTimeToFirstByteMs=m;break;case"MaxRetry":_.errorRetry.maxNumRetry=m,_.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":_.errorRetry.retryDelayMs=m,_.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":_.errorRetry.maxRetryDelayMs=m,_.timeoutRetry.maxRetryDelayMs=m;break}}}),h.length&&t.warn(`hls.js config: "${h.join('", "')}" setting(s) are deprecated, use "${l}": ${ft(e[l])}`)}),nt(nt({},i),e)}function Ih(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(Ih):Object.keys(n).reduce((e,t)=>(e[t]=Ih(n[t]),e),{}):n}function qC(n,e){const t=n.loader;t!==fp&&t!==Tv?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):OC()&&(n.loader=fp,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const mo=2,WC=.1,zC=.05,YC=100;class XC extends Tm{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(YC),this.mediaSource=t.mediaSource;const i=this.media=t.media;pi(i,"playing",this.onMediaPlaying),pi(i,"waiting",this.onMediaWaiting),pi(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(wi(i,"playing",this.onMediaPlaying),wi(i,"waiting",this.onMediaWaiting),wi(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,s;const r=(i=this.hls)==null?void 0:i.config;if(!r)return;const a=this.media;if(!a)return;const{seeking:l}=a,c=this.seeking&&!l,h=!this.seeking&&l,f=a.paused&&!l||a.ended||a.playbackRate===0;if(this.seeking=l,e!==t){t&&(this.ended=0),this.moved=!0,l||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(h||c){c&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!Ue.getBuffered(a).length){this.nudgeRetry=0;return}const p=Ue.bufferInfo(a,e,0),m=p.nextStart||0,_=this.fragmentTracker;if(l&&_&&this.hls){const N=pp(this.hls.inFlightFragments,e),B=p.len>mo,H=!m||N||m-e>mo&&!_.getPartialFragment(e);if(B||H)return;this.moved=!1}const E=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&_){if(!(p.len>0)&&!m)return;const B=Math.max(m,p.start||0)-e,O=!!(E!=null&&E.live)?E.targetduration*2:mo,P=_.getPartialFragment(e);if(B>0&&(B<=O||P)){a.paused||this._trySkipBufferHole(P);return}}const C=r.detectStallWithCurrentTimeMs,S=self.performance.now(),I=this.waiting;let R=this.stalled;if(R===null)if(I>0&&S-I<C)R=this.stalled=I;else{this.stalled=S;return}const k=S-R;if(!l&&(k>=C||I)&&this.hls){var D;if(((D=this.mediaSource)==null?void 0:D.readyState)==="ended"&&!(E!=null&&E.live)&&Math.abs(e-(E?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const x=Ue.bufferInfo(a,e,r.maxBufferHole);this._tryFixBufferStall(x,k,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&s&&s.length>1&&e>s.end(0)){const r=Ue.bufferedInfo(Ue.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const a=Ue.timeRangesToArray(s),l=Ue.bufferedInfo(a,t,0).bufferedIndex;if(l>-1&&l<a.length-1){const c=Ue.bufferedInfo(a,e,0).bufferedIndex,h=a[l].end,f=a[l+1].start;if((c===-1||c>l)&&f-h<1&&e-h<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${h} -> ${f} buffered index: ${c}`);this.warn(p.message),this.media.currentTime+=1e-6;const m=this.fragmentTracker.getPartialFragment(e)||void 0,_=Ue.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:m,buffer:_.len,bufferInfo:_})}}}}}_tryFixBufferStall(e,t,i){var s,r;const{fragmentTracker:a,media:l}=this,c=(s=this.hls)==null?void 0:s.config;if(!l||!a||!c)return;const h=(r=this.hls)==null?void 0:r.latestLevelDetails,f=a.getPartialFragment(i);if((f||h!=null&&h.live&&i<h.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const p=e.buffered,m=this.adjacentTraversal(e,i);(p&&p.length>1&&e.len>c.maxBufferHole||e.nextStart&&(e.nextStart-i<c.maxBufferHole||m))&&(t>c.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,s=e.nextStart;if(i&&s){const r=i.getFragAtPos(t,Ie.MAIN),a=i.getFragAtPos(s,Ie.MAIN);if(r&&a)return a.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:s,stalled:r}=this;if(!s&&r!==null&&i&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${ft(e)})`);this.warn(a.message),t.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:s}=this,r=(t=this.hls)==null?void 0:t.config;if(!s||!i||!r)return 0;const a=s.currentTime,l=Ue.bufferInfo(s,a,0),c=a<l.start?l.start:l.nextStart;if(c&&this.hls){const f=l.len<=r.maxBufferHole,p=l.len>0&&l.len<1&&s.readyState<3,m=c-a;if(m>0&&(f||p)){if(m>r.maxBufferHole){let E=!1;if(a===0){const C=i.getAppendedFrag(0,Ie.MAIN);C&&c<C.end&&(E=!0)}if(!E){const C=e||i.getAppendedFrag(a,Ie.MAIN);if(C){var h;if(!((h=this.hls.loadLevelObj)!=null&&h.details)||pp(this.hls.inFlightFragments,c))return 0;let I=!1,R=C.end;for(;R<c;){const k=i.getAppendedFrag(R,Ie.MAIN)||i.getPartialFragment(R);if(k)R+=k.duration;else{I=!0;break}}if(I)return 0}}}const _=Math.max(c+zC,a+WC);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${_}`),this.moved=!0,s.currentTime=_,!(e!=null&&e.gap)){const E=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${_}`);this.hls.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:E,reason:E.message,frag:e||void 0,buffer:l.len,bufferInfo:l})}return _}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:s}=this,r=t?.config;if(!i||!r)return 0;const a=i.currentTime;if(this.nudgeRetry++,s<r.nudgeMaxRetry){const l=a+(s+1)*r.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${a} to ${l}`);this.warn(c.message),i.currentTime=l,t.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1,buffer:e.len,bufferInfo:e})}else{const l=new Error(`Playhead still not moving while enough data buffered @${a} after ${r.nudgeMaxRetry} nudges`);this.error(l.message),t.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.BUFFER_STALLED_ERROR,error:l,fatal:!0,buffer:e.len,bufferInfo:e})}}}function pp(n,e){const t=gp(n.main);if(t&&t.start<=e)return t;const i=gp(n.audio);return i&&i.start<=e?i:null}function gp(n){if(!n)return null;switch(n.state){case ce.IDLE:case ce.STOPPED:case ce.ENDED:case ce.ERROR:return null}return n.frag}const QC=.25;function Lh(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function mp(n,e,t,i,s){let r=new n(e,t,"");try{r.value=i,s&&(r.type=s)}catch{r=new n(e,t,ft(s?nt({type:s},i):i))}return r}const qa=(()=>{const n=Lh();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class JC{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Fr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return ov(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:s}}}=this;if(!i&&!s)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Lh();if(a)for(let l=0;l<r.length;l++){const c=r[l].type;if(c===ii.emsg&&!i||!s)continue;const h=$m(r[l].data);if(h){const f=r[l].pts;let p=f+r[l].duration;p>qa&&(p=qa),p-f<=0&&(p=f+QC);for(let _=0;_<h.length;_++){const E=h[_];if(!Hm(E)){this.updateId3CueEnds(f,c);const C=mp(a,f,p,E,c);C&&this.id3Track.addCue(C)}}}}}updateId3CueEnds(e,t){var i;const s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let r=s.length;r--;){const a=s[r];a.type===t&&a.startTime<e&&a.endTime===qa&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:s}){const{id3Track:r,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:l,enableID3MetadataCues:c}}=a;if(r&&(l||c)){let h;s==="audio"?h=f=>f.type===ii.audioId3&&c:s==="video"?h=f=>f.type===ii.emsg&&l:h=f=>f.type===ii.audioId3&&c||f.type===ii.emsg&&l,wh(r,t,i,h)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:i}=this,{dateRanges:s}=e,r=Object.keys(s);let a=this.dateRangeCuesAppended;if(i&&t){var l;if((l=i.cues)!=null&&l.length){const f=Object.keys(a).filter(p=>!r.includes(p));for(let p=f.length;p--;){const m=f[p],_=a[m].cues;delete a[m],Object.keys(_).forEach(E=>{try{const C=_[E];C.removeEventListener("enter",this.onEventCueEnter),i.removeCue(C)}catch{}})}}else a=this.dateRangeCuesAppended={}}const c=e.fragments[e.fragments.length-1];if(r.length===0||!we(c?.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const h=Lh();for(let f=0;f<r.length;f++){const p=r[f],m=s[p],_=m.startTime,E=a[p],C=E?.cues||{};let S=E?.durationKnown||!1,I=qa;const{duration:R,endDate:k}=m;if(k&&R!==null)I=_+R,S=!0;else if(m.endOnNext&&!S){const x=r.reduce((N,B)=>{if(B!==m.id){const H=s[B];if(H.class===m.class&&H.startDate>m.startDate&&(!N||m.startDate<N.startDate))return H}return N},null);x&&(I=x.startTime,S=!0)}const D=Object.keys(m.attr);for(let x=0;x<D.length;x++){const N=D[x];if(!kb(N))continue;const B=C[N];if(B)S&&!E.durationKnown?B.endTime=I:Math.abs(B.startTime-_)>.01&&(B.startTime=_,B.endTime=I);else if(h){let H=m.attr[N];Rb(N)&&(H=sm(H));const P=mp(h,_,I,{key:N,data:H},ii.dateRange);P&&(P.id=p,this.id3Track.addCue(P),C[N]=P,this.hls.config.interstitialsController&&(N==="X-ASSET-LIST"||N==="X-ASSET-URL")&&P.addEventListener("enter",this.onEventCueEnter))}}a[p]={cues:C,dateRange:m,durationKnown:S}}}}class ZC{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:a}=this.config;if(!r||a===1||!i.live)return;const l=this.targetLatency;if(l===null)return;const c=s-l,h=Math.min(this.maxLatency,l+i.targetduration);if(c<h&&c>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,a)),m=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20,_=Math.min(p,Math.max(1,m));this.changeMediaPlaybackRate(t,_)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:s}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:l}=this.config,c=this.hls.userConfig;let h=l&&i||t;(this._targetLatencyUpdated||c.liveSyncDuration||c.liveSyncDurationCount||h===0)&&(h=r!==void 0?r:a*s);const f=s;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const s=i.edge,r=e-t-this.edgeStalled,a=s-i.totalduration,l=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,r),l)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===Y.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,s;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class ew extends pc{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,s=[],r={},a={};let l=!1,c=!1,h=!1;t.levels.forEach(f=>{const p=f.attrs;let{audioCodec:m,videoCodec:_}=f;m&&(f.audioCodec=m=Ao(m,i)||void 0),_&&(_=f.videoCodec=zE(_));const{width:E,height:C,unknownCodecs:S}=f;let I=S?S.length:0;if(S)for(let P=I;P--;){const G=S[P];this.isAudioSupported(G)?(f.audioCodec=m=m?`${m},${G}`:G,I--,qr.audio[m.substring(0,4)]=2):this.isVideoSupported(G)&&(f.videoCodec=_=_?`${_},${G}`:G,I--,qr.video[_.substring(0,4)]=2)}if(l||(l=!!(E&&C)),c||(c=!!_),h||(h=!!m),I||m&&!this.isAudioSupported(m)||_&&!this.isVideoSupported(_)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:R,"FRAME-RATE":k,"HDCP-LEVEL":D,"PATHWAY-ID":x,RESOLUTION:N,"VIDEO-RANGE":B}=p,O=`${`${x||"."}-`}${f.bitrate}-${N}-${k}-${R}-${B}-${D}`;if(r[O])if(r[O].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const P=a[O]+=1;f.attrs["PATHWAY-ID"]=new Array(P+1).join(".");const G=this.createLevel(f);r[O]=G,s.push(G)}else r[O].addGroupId("audio",p.AUDIO),r[O].addGroupId("text",p.SUBTITLES);else{const P=this.createLevel(f);r[O]=P,a[O]=1,s.push(P)}}),this.filterAndSortMediaOptions(s,t,l,c,h)}createLevel(e){const t=new Un(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(s.message),t.supportedResult=fm(s,[])}return t}isAudioSupported(e){return dh(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return dh(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,s,r){let a=[],l=[],c=e;if((i||s)&&r&&(c=c.filter(({videoCodec:S,videoRange:I,width:R,height:k})=>(!!S||!!(R&&k))&&ib(I))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let S="no level with compatible codecs found in manifest",I=S;t.levels.length&&(I=`one or more CODECS in variant not supported: ${ft(t.levels.map(k=>k.attrs.CODECS).filter((k,D,x)=>x.indexOf(k)===D))}`,this.warn(I),S+=` (${I})`);const R=new Error(S);this.hls.trigger(L.ERROR,{type:ke.MEDIA_ERROR,details:Y.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:R,reason:I})}});return}t.audioTracks&&(a=t.audioTracks.filter(S=>!S.audioCodec||this.isAudioSupported(S.audioCodec)),vp(a)),t.subtitles&&(l=t.subtitles,vp(l));const h=c.slice(0);c.sort((S,I)=>{if(S.attrs["HDCP-LEVEL"]!==I.attrs["HDCP-LEVEL"])return(S.attrs["HDCP-LEVEL"]||"")>(I.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&S.height!==I.height)return S.height-I.height;if(S.frameRate!==I.frameRate)return S.frameRate-I.frameRate;if(S.videoRange!==I.videoRange)return Io.indexOf(S.videoRange)-Io.indexOf(I.videoRange);if(S.videoCodec!==I.videoCodec){const R=uf(S.videoCodec),k=uf(I.videoCodec);if(R!==k)return k-R}if(S.uri===I.uri&&S.codecSet!==I.codecSet){const R=wo(S.codecSet),k=wo(I.codecSet);if(R!==k)return k-R}return S.averageBitrate!==I.averageBitrate?S.averageBitrate-I.averageBitrate:0});let f=h[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==h.length)){for(let S=0;S<h.length;S++)if(h[S].pathwayId===c[0].pathwayId){f=h[S];break}}this._levels=c;for(let S=0;S<c.length;S++)if(c[S]===f){var p;this._firstLevel=S;const I=f.bitrate,R=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${I}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){const k=Math.min(I,this.hls.config.abrEwmaDefaultEstimateMax);k>R&&R===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const m=r&&!s,_=this.hls.config,E=!!(_.audioStreamController&&_.audioTrackController),C={levels:c,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:s,altAudio:E&&!m&&a.some(S=>!!S.url)};this.hls.trigger(L.MANIFEST_PARSED,C)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(L.ERROR,{type:ke.OTHER_ERROR,details:Y.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:f,reason:f.message}),p)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,r=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],l=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,i===e&&s&&r===l)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${l?" with Pathway "+l:""} from level ${i}${r?" with Pathway "+r:""}`);const c={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,c);const h=a.details;if(!h||h.live){const f=this.switchParams(a.uri,s?.details,h);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===Ge.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Ie.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(r=>!!i[r]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var i;const{level:s,details:r}=t,a=t.levelInfo;if(!a){var l;this.warn(`Invalid level index ${s}`),(l=t.deliveryDirectives)!=null&&l.skip&&(r.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let c=a.details;c===t.details&&c.advanced&&(c=void 0),this.playlistLoaded(s,t,c)}else(i=t.deliveryDirectives)!=null&&i.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],a=e.details,l=a?.age;this.log(`Loading level index ${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(L.LEVEL_LOADING,{url:i,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((r,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(l=>l.level=-1)),!1));Rm(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=i.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(L.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function vp(n){const e={};n.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function _v(){return self.SourceBuffer||self.WebKitSourceBuffer}function Ev(){if(!Ns())return!1;const e=_v();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function tw(){if(!Ev())return!1;const n=Ns();return typeof n?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Bn(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Bn(e,"audio"))))}function iw(){var n;const e=_v();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const sw=100;class rw extends ac{constructor(e,t,i){super(e,t,i,"stream-controller",Ie.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,r=s?s.currentTime:null;if(r===null||!we(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const a=this.getFwdBufferInfoAtPos(s,r,Ie.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:s}=this;if(this.stopLoad(),this.setInterval(sw),this.level=-1,!this.startFragRequested){let r=s.startLevel;r===-1&&(s.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=s.firstAutoLevel),s.nextLoadLevel=r,this.level=s.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ce.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ce.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ce.WAITING_LEVEL:{const{levels:t,level:i}=this,s=t?.[i],r=s?.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=ce.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ce.IDLE;break}break}case ce.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:s,level:r}=this,a=s?.[r];this.resetStartWhenNotLoaded(a||null),this.state=ce.IDLE}}break}this.state===ce.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[r]))return;const a=i[r],l=this.getMainFwdBufferInfo();if(l===null)return;const c=this.getLevelDetails();if(c&&this._streamEnded(l,c)){const C={};this.altAudio===2&&(C.type="video"),this.hls.trigger(L.BUFFER_EOS,C),this.state=ce.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const h=a.details;if(!h||this.state===ce.WAITING_LEVEL||this.waitForLive(a)){this.level=r,this.state=ce.WAITING_LEVEL,this.startFragRequested=!1;return}const f=l.len,p=this.getMaxBufferLength(a.maxBitrate);if(f>=p)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const m=this.backtrackFragment?this.backtrackFragment.start:l.end;let _=this.getNextFragment(m,h);if(this.couldBacktrack&&!this.fragPrevious&&_&&At(_)&&this.fragmentTracker.getState(_)!==Lt.OK){var E;const S=((E=this.backtrackFragment)!=null?E:_).sn-h.startSN,I=h.fragments[S-1];I&&_.cc===I.cc&&(_=I,this.fragmentTracker.removeFragment(I))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(_&&this.isLoopLoading(_,m)){if(!_.gap){const S=this.audioOnly&&!this.altAudio?ut.AUDIO:ut.VIDEO,I=(S===ut.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;I&&this.afterBufferFlushed(I,S,Ie.MAIN)}_=this.getNextFragmentLoopLoading(_,h,l,Ie.MAIN,p)}_&&(_.initSegment&&!_.initSegment.data&&!this.bitrateTest&&(_=_.initSegment),this.loadFragment(_,a,m))}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);s===Lt.NOT_LOADED||s===Lt.PARTIAL?At(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ie.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const l=this.getMainFwdBufferInfo();if(!l||l.len<r.targetduration*2)return}if(!t.paused&&e){const l=this.hls.nextLoadLevel,c=e[l],h=this.fragLastKbps;h&&this.fragCurrent?i=this.fragCurrent.duration*c.maxBitrate/(1e3*h)+1:i=0}else i=0;const a=this.getBufferedFrag(t.currentTime+i);if(a){const l=this.followingBufferedFrag(a);if(l){this.abortCurrentFrag();const c=l.maxStartPTS?l.maxStartPTS:l.start,h=l.duration,f=Math.max(a.end,c+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ce.KEY_LOADING:case ce.FRAG_LOADING:case ce.FRAG_LOADING_WAITING_RETRY:case ce.PARSING:case ce.PARSED:this.state=ce.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;pi(i,"playing",this.onMediaPlaying),pi(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(wi(i,"playing",this.onMediaPlaying),wi(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,s=!1;t.levels.forEach(r=>{const a=r.audioCodec;a&&(i=i||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&s&&!iw(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==ce.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=ce.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:s,startFragRequested:r}=this,a=t.level,l=t.details,c=l.totalduration;if(!s){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""}, cc [${l.startCC}, ${l.endCC}] duration:${c}`);const h=t.levelInfo,f=this.fragCurrent;f&&(this.state===ce.FRAG_LOADING||this.state===ce.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let p=0;if(l.live||(i=h.details)!=null&&i.live){var m;if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;p=this.alignPlaylists(l,h.details,(m=this.levelLastLoaded)==null?void 0:m.details)}if(h.details=l,this.levelLastLoaded=h,r||this.setStartPosition(l,p),this.hls.trigger(L.LEVEL_UPDATED,{details:l,level:a}),this.state===ce.WAITING_LEVEL){if(this.waitForCdnTuneIn(l))return;this.state=ce.IDLE}r&&l.live&&this.synchronizeToLiveEdge(l),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,l=e.edge,c=r>=a-t.maxFragLookUpTolerance&&r<=l;if(s!==null&&i.duration>s&&(r<s||!c)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!c&&i.readyState<4||r<l-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),i.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${l}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var h;const p=Ue.bufferInfo(i,s,0);if(!(p!=null&&(h=p.buffered)!=null&&h.length)){i.currentTime=s;return}if(p.start<=r){i.currentTime=s;return}const{nextStart:_}=Ue.bufferedInfo(p.buffered,r,0);_&&(i.currentTime=_)}else i.currentTime=s}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:s,payload:r}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const l=a[i.level];if(!l){this.warn(`Level ${i.level} not found on progress`);return}const c=l.details;if(!c){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const h=l.videoCodec,f=c.PTSKnown||!c.live,p=(t=i.initSegment)==null?void 0:t.data,m=this._getAudioCodec(l),_=this.transmuxer=this.transmuxer||new Jm(this.hls,Ie.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=s?s.index:-1,C=E!==-1,S=new rc(i.level,i.sn,i.stats.chunkCount,r.byteLength,E,C),I=this.initPTS[i.cc];_.push(r,p,m,h,i,s,c.totalduration,f,S,I)}onAudioTrackSwitching(e,t){const i=this.hls,s=this.altAudio===2;if(Lo(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.fragmentTracker.removeAllFragments(),i.once(L.BUFFER_FLUSHED,()=>{var a;(a=this.hls)==null||a.trigger(L.AUDIO_TRACK_SWITCHED,t)}),i.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=Lo(t.url,this.hls);if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let s,r,a=!1;for(const l in i){const c=i[l];if(c.id==="main"){if(r=l,s=c,l==="video"){const h=i[l];h&&(this.videoBuffer=h.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:s}=t,r=i.type===Ie.MAIN;if(r){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ce.PARSED&&(this.state=ce.IDLE);return}const l=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*l.total/(l.buffering.end-l.loading.first)),At(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}const a=this.media;a&&(!this._hasEnoughToStart&&Ue.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=ce.ERROR;return}switch(t.details){case Y.FRAG_GAP:case Y.FRAG_PARSING_ERROR:case Y.FRAG_DECRYPT_ERROR:case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ie.MAIN,t);break;case Y.LEVEL_LOAD_ERROR:case Y.LEVEL_LOAD_TIMEOUT:case Y.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ce.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===Ge.LEVEL&&(this.state=ce.IDLE);break;case Y.BUFFER_ADD_CODEC_ERROR:case Y.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Y.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case Y.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ce.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ut.AUDIO||!this.altAudio){const i=(t===ut.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,Ie.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&i&&(i+=s);const r=this.getLevelDetails(),a=Ue.getBuffered(e),l=a.length?a.start(0):0,c=l-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||c>0&&(c<h||this.loadingParts&&c<2*(r?.partTarget||0)))&&(this.log(`adjusting start position by ${c} to match buffer start`),i+=c,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${l}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:s}=this,r=i?.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=ce.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=r.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),s.trigger(L.FRAG_LOADED,i),r.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const i=this.playlistType,{hls:s}=this,{remuxResult:r,chunkMeta:a}=e,l=this.getCurrentContext(a);if(!l){this.resetWhenMissingContext(a);return}const{frag:c,part:h,level:f}=l,{video:p,text:m,id3:_,initSegment:E}=r,{details:C}=f,S=this.altAudio?void 0:r.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=ce.PARSING,E){if(E!=null&&E.tracks){const D=c.initSegment||c;this._bufferInitSegment(f,E.tracks,D,a),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:i,tracks:E.tracks})}const I=E.initPTS,R=E.timescale,k=this.initPTS[c.cc];we(I)&&(!k||k.baseTime!==I||k.timescale!==R)&&(this.initPTS[c.cc]={baseTime:I,timescale:R},s.trigger(L.INIT_PTS_FOUND,{frag:c,id:i,initPTS:I,timescale:R}))}if(p&&C){S&&p.type==="audiovideo"&&this.logMuxedErr(c);const I=C.fragments[c.sn-1-C.startSN],R=c.sn===C.startSN,k=!I||c.cc>I.cc;if(r.independent!==!1){const{startPTS:D,endPTS:x,startDTS:N,endDTS:B}=p;if(h)h.elementaryStreams[p.type]={startPTS:D,endPTS:x,startDTS:N,endDTS:B};else if(p.firstKeyFrame&&p.independent&&a.id===1&&!k&&(this.couldBacktrack=!0),p.dropped&&p.independent){const H=this.getMainFwdBufferInfo(),O=(H?H.end:this.getLoadPosition())+this.config.maxBufferHole,P=p.firstKeyFramePTS?p.firstKeyFramePTS:D;if(!R&&O<P-this.config.maxBufferHole&&!k){this.backtrack(c);return}else k&&(c.gap=!0);c.setElementaryStreamInfo(p.type,c.start,x,c.start,B,!0)}else R&&D-(C.appliedTimelineOffset||0)>mo&&(c.gap=!0);c.setElementaryStreamInfo(p.type,D,x,N,B),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(p,c,h,a,R||k)}else if(R||k)c.gap=!0;else{this.backtrack(c);return}}if(S){const{startPTS:I,endPTS:R,startDTS:k,endDTS:D}=S;h&&(h.elementaryStreams[ut.AUDIO]={startPTS:I,endPTS:R,startDTS:k,endDTS:D}),c.setElementaryStreamInfo(ut.AUDIO,I,R,k,D),this.bufferFragmentData(S,c,h,a)}if(C&&_!=null&&(t=_.samples)!=null&&t.length){const I={id:i,frag:c,details:C,samples:_.samples};s.trigger(L.FRAG_PARSING_METADATA,I)}if(C&&m){const I={id:i,frag:c,details:C,samples:m.samples};s.trigger(L.FRAG_PARSING_USERDATA,I)}}logMuxedErr(e){this.warn(`${At(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,s){if(this.state!==ce.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:r,video:a,audiovideo:l}=t;if(r){const h=e.audioCodec;let f=lo(r.codec,h);f==="mp4a"&&(f="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const m=r.metadata;m&&"channelCount"in m&&(m.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),h&&h!==f&&this.log(`Swapping manifest audio codec "${h}" for "${f}"`),r.levelCodec=f,r.id=Ie.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${f||""}/${h||""}/${r.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Ie.MAIN;const h=a.codec;if(h?.length===4)switch(h){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${h}]${a.codec!==h?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}l&&(this.log(`Init audiovideo buffer, container:${l.container}, codecs[level/parsed]=[${e.codecs}/${l.codec}]`),delete t.video,delete t.audio);const c=Object.keys(t);if(c.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;c.forEach(h=>{const p=t[h].initSegment;p!=null&&p.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:h,data:p,frag:i,part:null,chunkMeta:s,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Ie.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ce.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Ue.isBuffered(e,i)?t=this.getAppendedFrag(i):Ue.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,r=t.level;(!s||t.sn!==s.sn||s.level!==r)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!s||s.level!==r)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return we(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(we(t)){const i=this.getLevelDetails(),s=this.currentFrag||(i?ar(null,i.fragments,t):null);if(s){const r=s.programDateTime;if(r!==null){const a=r+(t-s.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class nw{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const s=this.keyUriToKeyInfo[i].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=Y.KEY_LOAD_ERROR,i,s,r){return new ts({type:ke.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:i,networkDetails:s})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,r=t.length;s<r;s++){const a=t[s];if(e.cc<=a.cc&&(!At(e)||!At(a)||e.sn<a.sn)||!i&&s==r-1)return this.emeController.selectKeySystemFormat(a).then(l=>{if(!this.emeController)return;a.setKeyFormat(l);const c=vh(l);if(c)return this.emeController.getKeySystemAccess([c])})}if(this.config.requireKeySystemAccessOnStart){const s=ho(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,s;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const h=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,h))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let l=this.keyUriToKeyInfo[a];if((i=l)!=null&&i.decryptdata.key)return r.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if((s=l)!=null&&s.keyLoadPromise){var c;switch((c=l.mediaKeySessionContext)==null?void 0:c.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise.then(h=>(r.key=h.keyInfo.decryptdata.key,{frag:e,keyInfo:l}))}}switch(l=this.keyUriToKeyInfo[a]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(i);if(s)return(e.keyLoadPromise=s.then(r=>(e.mediaKeySessionContext=r,i))).catch(r=>{throw e.keyLoadPromise=null,r})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,s=i.loader,r=new s(i);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((a,l)=>{const c={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h=i.keyLoadPolicy.default,f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,_,E,C)=>{const{frag:S,keyInfo:I,url:R}=E;if(!S.decryptdata||I!==this.keyUriToKeyInfo[R])return l(this.createKeyLoadError(S,Y.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),C));I.decryptdata.key=S.decryptdata.key=new Uint8Array(m.data),S.keyLoader=null,I.loader=null,a({frag:S,keyInfo:I})},onError:(m,_,E,C)=>{this.resetLoader(_),l(this.createKeyLoadError(t,Y.KEY_LOAD_ERROR,new Error(`HTTP Error ${m.code} loading key ${m.text}`),E,nt({url:c.url,data:void 0},m)))},onTimeout:(m,_,E)=>{this.resetLoader(_),l(this.createKeyLoadError(t,Y.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(m,_,E)=>{this.resetLoader(_),l(this.createKeyLoadError(t,Y.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};r.load(c,f,p)})}resetLoader(e){const{frag:t,keyInfo:i,url:s}=e,r=i.loader;t.keyLoader===r&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],r&&r.destroy()}}function yp(n){const{type:e}=n;switch(e){case Ge.AUDIO_TRACK:return Ie.AUDIO;case Ge.SUBTITLE_TRACK:return Ie.SUBTITLE;default:return Ie.MAIN}}function ku(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class aw{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,s=t.loader,r=i||s,a=new r(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ge.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:s,pathwayId:r,url:a,deliveryDirectives:l,levelInfo:c}=t;this.load({id:i,level:s,pathwayId:r,responseType:"text",type:Ge.LEVEL,url:a,deliveryDirectives:l,levelOrTrack:c})}onAudioTrackLoading(e,t){const{id:i,groupId:s,url:r,deliveryDirectives:a,track:l}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:Ge.AUDIO_TRACK,url:r,deliveryDirectives:a,levelOrTrack:l})}onSubtitleTrackLoading(e,t){const{id:i,groupId:s,url:r,deliveryDirectives:a,track:l}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:Ge.SUBTITLE_TRACK,url:r,deliveryDirectives:a,levelOrTrack:l})}onLevelsUpdated(e,t){const i=this.loaders[Ge.LEVEL];if(i){const s=i.context;s&&!t.levels.some(r=>r===s.levelOrTrack)&&(i.abort(),delete this.loaders[Ge.LEVEL])}}load(e){var t;const i=this.hls.config;let s=this.getInternalLoader(e);if(s){const h=this.hls.logger,f=s.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?h.log(`[playlist-loader]: ignore ${e.url} ongoing request`):h.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}h.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let r;if(e.type===Ge.MANIFEST?r=i.manifestLoadPolicy.default:r=st({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),we((t=e.deliveryDirectives)==null?void 0:t.part)){let h;if(e.type===Ge.LEVEL&&e.level!==null?h=this.hls.levels[e.level].details:e.type===Ge.AUDIO_TRACK&&e.id!==null?h=this.hls.audioTracks[e.id].details:e.type===Ge.SUBTITLE_TRACK&&e.id!==null&&(h=this.hls.subtitleTracks[e.id].details),h){const f=h.partTarget,p=h.targetduration;if(f&&p){const m=Math.max(f*3,p*.8)*1e3;r=st({},r,{maxTimeToFirstByteMs:Math.min(m,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(m,r.maxTimeToFirstByteMs)})}}}const a=r.errorRetry||r.timeoutRetry||{},l={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(h,f,p,m)=>{const _=this.getInternalLoader(p);this.resetInternalLoader(p.type);const E=h.data;if(E.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(h,p,new Error("no EXTM3U delimiter"),m||null,f);return}f.parsing.start=performance.now(),Gi.isMediaPlaylist(E)||p.type!==Ge.MANIFEST?this.handleTrackOrLevelPlaylist(h,f,p,m||null,_):this.handleMasterPlaylist(h,f,p,m)},onError:(h,f,p,m)=>{this.handleNetworkError(f,p,!1,h,m)},onTimeout:(h,f,p)=>{this.handleNetworkError(f,p,!0,void 0,h)}};s.load(e,l,c)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,s){const r=this.hls,a=e.data,l=ku(e,i),c=Gi.parseMasterPlaylist(a,l);if(c.playlistParsingError){this.handleManifestParsingError(e,i,c.playlistParsingError,s,t);return}const{contentSteering:h,levels:f,sessionData:p,sessionKeys:m,startTimeOffset:_,variableList:E}=c;this.variableList=E;const{AUDIO:C=[],SUBTITLES:S,"CLOSED-CAPTIONS":I}=Gi.parseMasterPlaylistMedia(a,l,c);C.length&&!C.some(k=>!k.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),C.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new pt({}),bitrate:0,url:""})),r.trigger(L.MANIFEST_LOADED,{levels:f,audioTracks:C,subtitles:S,captions:I,contentSteering:h,url:l,stats:t,networkDetails:s,sessionData:p,sessionKeys:m,startTimeOffset:_,variableList:E})}handleTrackOrLevelPlaylist(e,t,i,s,r){const a=this.hls,{id:l,level:c,type:h}=i,f=ku(e,i),p=we(c)?c:we(l)?l:0,m=yp(i),_=Gi.parseLevelPlaylist(e.data,f,p,m,0,this.variableList);if(h===Ge.MANIFEST){const E={attrs:new pt({}),bitrate:0,details:_,name:"",url:f};_.requestScheduled=t.loading.start+Im(_,0),a.trigger(L.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:f,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=_,this.handlePlaylistLoaded(_,e,t,i,s,r)}handleManifestParsingError(e,t,i,s,r){this.hls.trigger(L.ERROR,{type:ke.NETWORK_ERROR,details:Y.MANIFEST_PARSING_ERROR,fatal:t.type===Ge.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:s,stats:r})}handleNetworkError(e,t,i=!1,s,r){let a=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Ge.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Ge.AUDIO_TRACK||e.type===Ge.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const l=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let c=Y.UNKNOWN,h=!1;const f=this.getInternalLoader(e);switch(e.type){case Ge.MANIFEST:c=i?Y.MANIFEST_LOAD_TIMEOUT:Y.MANIFEST_LOAD_ERROR,h=!0;break;case Ge.LEVEL:c=i?Y.LEVEL_LOAD_TIMEOUT:Y.LEVEL_LOAD_ERROR,h=!1;break;case Ge.AUDIO_TRACK:c=i?Y.AUDIO_TRACK_LOAD_TIMEOUT:Y.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case Ge.SUBTITLE_TRACK:c=i?Y.SUBTITLE_TRACK_LOAD_TIMEOUT:Y.SUBTITLE_LOAD_ERROR,h=!1;break}f&&this.resetInternalLoader(e.type);const p={type:ke.NETWORK_ERROR,details:c,fatal:h,url:e.url,loader:f,context:e,error:l,networkDetails:t,stats:r};if(s){const m=t?.url||e.url;p.response=nt({url:m,data:void 0},s)}this.hls.trigger(L.ERROR,p)}handlePlaylistLoaded(e,t,i,s,r,a){const l=this.hls,{type:c,level:h,id:f,groupId:p,deliveryDirectives:m}=s,_=ku(t,s),E=yp(s),C=typeof s.level=="number"&&E===Ie.MAIN?h:void 0;if(!e.fragments.length){const I=e.playlistParsingError=new Error("No Segments found in Playlist");l.trigger(L.ERROR,{type:ke.NETWORK_ERROR,details:Y.LEVEL_EMPTY_ERROR,fatal:!1,url:_,error:I,reason:I.message,response:t,context:s,level:C,parent:E,networkDetails:r,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const S=e.playlistParsingError;if(S){if(this.hls.logger.warn(S),!l.config.ignorePlaylistParsingErrors){l.trigger(L.ERROR,{type:ke.NETWORK_ERROR,details:Y.LEVEL_PARSING_ERROR,fatal:!1,url:_,error:S,reason:S.message,response:t,context:s,level:C,parent:E,networkDetails:r,stats:i});return}e.playlistParsingError=null}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),c){case Ge.MANIFEST:case Ge.LEVEL:l.trigger(L.LEVEL_LOADED,{details:e,levelInfo:s.levelOrTrack||l.levels[0],level:C||0,id:f||0,stats:i,networkDetails:r,deliveryDirectives:m,withoutMultiVariant:c===Ge.MANIFEST});break;case Ge.AUDIO_TRACK:l.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:f||0,groupId:p||"",stats:i,networkDetails:r,deliveryDirectives:m});break;case Ge.SUBTITLE_TRACK:l.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:f||0,groupId:p||"",stats:i,networkDetails:r,deliveryDirectives:m});break}}}class et{static get version(){return Hn}static isMSESupported(){return Ev()}static isSupported(){return tw()}static getMediaSource(){return Ns()}static get Events(){return L}static get MetadataSchema(){return ii}static get ErrorTypes(){return ke}static get ErrorDetails(){return Y}static get DefaultConfig(){return et.defaultConfig?et.defaultConfig:VC}static set DefaultConfig(e){et.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new oc,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=AE(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=KC(et.DefaultConfig,e,t);this.userConfig=e,i.progressive&&qC(i,t);const{abrController:s,bufferController:r,capLevelController:a,errorController:l,fpsController:c}=i,h=new l(this),f=this.abrController=new s(this),p=new vb(this),m=i.interstitialsController,_=m?this.interstitialsController=new m(this,et):null,E=this.bufferController=new r(this,p),C=this.capLevelController=new a(this),S=new c(this),I=new aw(this),R=i.contentSteeringController,k=R?new R(this):null,D=this.levelController=new ew(this,k),x=new JC(this),N=new nw(this.config),B=this.streamController=new rw(this,p,N),H=this.gapController=new XC(this,p);C.setStreamController(B),S.setStreamController(B);const O=[I,D,B];_&&O.splice(1,0,_),k&&O.splice(1,0,k),this.networkControllers=O;const P=[f,E,H,C,S,x,p];this.audioTrackController=this.createController(i.audioTrackController,O);const G=i.audioStreamController;G&&O.push(this.audioStreamController=new G(this,p,N)),this.subtitleTrackController=this.createController(i.subtitleTrackController,O);const J=i.subtitleStreamController;J&&O.push(this.subtititleStreamController=new J(this,p,N)),this.createController(i.timelineController,P),N.emeController=this.emeController=this.createController(i.emeController,P),this.cmcdController=this.createController(i.cmcdController,P),this.latencyController=this.createController(ZC,P),this.coreComponents=P,O.push(h);const se=h.onErrorOut;typeof se=="function"&&this.on(L.ERROR,se,h),this.on(L.MANIFEST_LOADED,I.onManifestLoaded,I)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,s){this._emitter.off(e,t,i,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const s=e===L.ERROR;this.trigger(L.ERROR,{type:ke.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,fatal:s,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:ke.OTHER_ERROR,details:Y.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,s=t?e:{media:i};this._media=i,this.trigger(L.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,s=this._url=Qh.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Ie.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Ie.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Ie.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=X0()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){tb(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let s=0;s<i;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,i)for(let r=s;r--;){const a=e[r].attrs["HDCP-LEVEL"];if(a&&a<=i)return r}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=mm(t);return pm(e,i,navigator.mediaCapabilities)}}et.defaultConfig=void 0;function bv(n,e){return e?`${n}|${e.start}-${e.end}`:n}function Sv(n,e){if(n!==void 0&&e!==void 0&&n<=e)return{start:n,end:e}}const Tp=globalThis||void 0||self;var ow=Object.defineProperty,lw=(n,e,t)=>e in n?ow(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,he=(n,e,t)=>lw(n,typeof e!="symbol"?e+"":e,t);class hi extends Error{constructor(e,t){super(t),he(this,"timestamp"),this.type=e,this.timestamp=performance.now()}}class Mo extends Error{constructor(e){super(),this.type=e}}class uw{constructor(e,t,i){he(this,"requestControls"),he(this,"abortController",new AbortController),he(this,"expectedBytesLength"),he(this,"requestByteRange"),he(this,"onChunkDownloaded"),this.request=e,this.httpConfig=t,this.onChunkDownloaded=i.getEventDispatcher("onChunkDownloaded");const{byteRange:s}=this.request.segment;s&&(this.requestByteRange={...s}),e.loadedBytes!==0&&(this.requestByteRange=this.requestByteRange??{start:0},this.requestByteRange.start=this.requestByteRange.start+e.loadedBytes),this.request.totalBytes&&(this.expectedBytesLength=this.request.totalBytes-this.request.loadedBytes),this.requestControls=this.request.start({downloadSource:"http"},{abort:()=>this.abortController.abort("abort"),notReceivingBytesTimeoutMs:this.httpConfig.httpNotReceivingBytesTimeoutMs}),this.fetch()}async fetch(){var e,t,i,s;const{segment:r}=this.request;try{let a=await((t=(e=this.httpConfig).httpRequestSetup)==null?void 0:t.call(e,r.url,r.byteRange,this.abortController.signal,this.requestByteRange));if(!a){const p=new Headers(this.requestByteRange?{Range:`bytes=${this.requestByteRange.start}-${this.requestByteRange.end??""}`}:void 0);a=new Request(r.url,{headers:p,signal:this.abortController.signal})}if(this.abortController.signal.aborted)throw new DOMException("Request aborted before request fetch","AbortError");const l=await window.fetch(a);if(this.handleResponseHeaders(l),!l.body)return;const{requestControls:c}=this;c.firstBytesReceived();const h=l.body.getReader();for await(const p of hw(h))this.requestControls.addLoadedChunk(p),this.onChunkDownloaded(p.byteLength,"http");if(!(await((s=(i=this.httpConfig).validateHTTPSegment)==null?void 0:s.call(i,r.url,r.byteRange,this.request.data))??!0))throw this.request.clearLoadedBytes(),new hi("http-segment-validation-failed");c.completeOnSuccess()}catch(a){this.handleError(a)}}handleResponseHeaders(e){if(!e.ok)throw e.status===406?(this.request.clearLoadedBytes(),new hi("http-bytes-mismatch",e.statusText)):new hi("http-error",e.statusText);const{requestByteRange:t}=this;if(t)if(e.status===200){if(this.request.segment.byteRange)throw new hi("http-unexpected-status-code");this.request.clearLoadedBytes()}else{if(e.status!==206)throw new hi("http-unexpected-status-code",e.statusText);const i=e.headers.get("Content-Length");if(i&&this.expectedBytesLength!==void 0&&this.expectedBytesLength!==+i)throw this.request.clearLoadedBytes(),new hi("http-bytes-mismatch",e.statusText);const s=e.headers.get("Content-Range"),r=s?dw(s):void 0;if(r){const{from:a,to:l}=r,c=l!==void 0&&a!==void 0?l-a+1:void 0;if(c!==void 0&&this.expectedBytesLength!==c||a!==void 0&&t.start!==a||l!==void 0&&t.end!==void 0&&t.end!==l)throw this.request.clearLoadedBytes(),new hi("http-bytes-mismatch",e.statusText)}}if(e.status===200&&this.request.totalBytes===void 0){const i=e.headers.get("Content-Length");i&&this.request.setTotalBytes(+i)}}handleError(e){if(e instanceof Error){if(e.name!=="abort")return;const t=e instanceof hi?e:new hi("http-error",e.message);this.requestControls.abortOnError(t)}}}async function*hw(n){for(;;){const{done:e,value:t}=await n.read();if(e)break;yield t}}const cw=/^bytes (?:(?:(\d+)|)-(?:(\d+)|)|\*)\/(?:(\d+)|\*)$/;function dw(n){const e=cw.exec(n.trim());if(!e)return;const[,t,i,s]=e;return{from:t?parseInt(t):void 0,to:i?parseInt(i):void 0,total:s?parseInt(s):void 0}}function fw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Cv={exports:{}},_t=Cv.exports={},Bi,Ui;function kh(){throw new Error("setTimeout has not been defined")}function Rh(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Bi=setTimeout:Bi=kh}catch{Bi=kh}try{typeof clearTimeout=="function"?Ui=clearTimeout:Ui=Rh}catch{Ui=Rh}})();function wv(n){if(Bi===setTimeout)return setTimeout(n,0);if((Bi===kh||!Bi)&&setTimeout)return Bi=setTimeout,setTimeout(n,0);try{return Bi(n,0)}catch{try{return Bi.call(null,n,0)}catch{return Bi.call(this,n,0)}}}function pw(n){if(Ui===clearTimeout)return clearTimeout(n);if((Ui===Rh||!Ui)&&clearTimeout)return Ui=clearTimeout,clearTimeout(n);try{return Ui(n)}catch{try{return Ui.call(null,n)}catch{return Ui.call(this,n)}}}var ns=[],jr=!1,rr,vo=-1;function gw(){!jr||!rr||(jr=!1,rr.length?ns=rr.concat(ns):vo=-1,ns.length&&Av())}function Av(){if(!jr){var n=wv(gw);jr=!0;for(var e=ns.length;e;){for(rr=ns,ns=[];++vo<e;)rr&&rr[vo].run();vo=-1,e=ns.length}rr=null,jr=!1,pw(n)}}_t.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];ns.push(new Iv(n,e)),ns.length===1&&!jr&&wv(Av)};function Iv(n,e){this.fun=n,this.array=e}Iv.prototype.run=function(){this.fun.apply(null,this.array)};_t.title="browser";_t.browser=!0;_t.env={};_t.argv=[];_t.version="";_t.versions={};function fs(){}_t.on=fs;_t.addListener=fs;_t.once=fs;_t.off=fs;_t.removeListener=fs;_t.removeAllListeners=fs;_t.emit=fs;_t.prependListener=fs;_t.prependOnceListener=fs;_t.listeners=function(n){return[]};_t.binding=function(n){throw new Error("process.binding is not supported")};_t.cwd=function(){return"/"};_t.chdir=function(n){throw new Error("process.chdir is not supported")};_t.umask=function(){return 0};var mw=Cv.exports;const yo=fw(mw);var vw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Tp<"u"?Tp:typeof self<"u"?self:{};function ur(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Wa={exports:{}},Ru,_p;function yw(){if(_p)return Ru;_p=1;var n=1e3,e=n*60,t=e*60,i=t*24,s=i*7,r=i*365.25;Ru=function(f,p){p=p||{};var m=typeof f;if(m==="string"&&f.length>0)return a(f);if(m==="number"&&isFinite(f))return p.long?c(f):l(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function a(f){if(f=String(f),!(f.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(p){var m=parseFloat(p[1]),_=(p[2]||"ms").toLowerCase();switch(_){case"years":case"year":case"yrs":case"yr":case"y":return m*r;case"weeks":case"week":case"w":return m*s;case"days":case"day":case"d":return m*i;case"hours":case"hour":case"hrs":case"hr":case"h":return m*t;case"minutes":case"minute":case"mins":case"min":case"m":return m*e;case"seconds":case"second":case"secs":case"sec":case"s":return m*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return m;default:return}}}}function l(f){var p=Math.abs(f);return p>=i?Math.round(f/i)+"d":p>=t?Math.round(f/t)+"h":p>=e?Math.round(f/e)+"m":p>=n?Math.round(f/n)+"s":f+"ms"}function c(f){var p=Math.abs(f);return p>=i?h(f,p,i,"day"):p>=t?h(f,p,t,"hour"):p>=e?h(f,p,e,"minute"):p>=n?h(f,p,n,"second"):f+" ms"}function h(f,p,m,_){var E=p>=m*1.5;return Math.round(f/m)+" "+_+(E?"s":"")}return Ru}var Pu,Ep;function Tw(){if(Ep)return Pu;Ep=1;function n(e){i.debug=i,i.default=i,i.coerce=h,i.disable=l,i.enable=r,i.enabled=c,i.humanize=yw(),i.destroy=f,Object.keys(e).forEach(p=>{i[p]=e[p]}),i.names=[],i.skips=[],i.formatters={};function t(p){let m=0;for(let _=0;_<p.length;_++)m=(m<<5)-m+p.charCodeAt(_),m|=0;return i.colors[Math.abs(m)%i.colors.length]}i.selectColor=t;function i(p){let m,_=null,E,C;function S(...I){if(!S.enabled)return;const R=S,k=Number(new Date),D=k-(m||k);R.diff=D,R.prev=m,R.curr=k,m=k,I[0]=i.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let x=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(B,H)=>{if(B==="%%")return"%";x++;const O=i.formatters[H];if(typeof O=="function"){const P=I[x];B=O.call(R,P),I.splice(x,1),x--}return B}),i.formatArgs.call(R,I),(R.log||i.log).apply(R,I)}return S.namespace=p,S.useColors=i.useColors(),S.color=i.selectColor(p),S.extend=s,S.destroy=i.destroy,Object.defineProperty(S,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(E!==i.namespaces&&(E=i.namespaces,C=i.enabled(p)),C),set:I=>{_=I}}),typeof i.init=="function"&&i.init(S),S}function s(p,m){const _=i(this.namespace+(typeof m>"u"?":":m)+p);return _.log=this.log,_}function r(p){i.save(p),i.namespaces=p,i.names=[],i.skips=[];const m=(typeof p=="string"?p:"").trim().replace(" ",",").split(",").filter(Boolean);for(const _ of m)_[0]==="-"?i.skips.push(_.slice(1)):i.names.push(_)}function a(p,m){let _=0,E=0,C=-1,S=0;for(;_<p.length;)if(E<m.length&&(m[E]===p[_]||m[E]==="*"))m[E]==="*"?(C=E,S=_,E++):(_++,E++);else if(C!==-1)E=C+1,S++,_=S;else return!1;for(;E<m.length&&m[E]==="*";)E++;return E===m.length}function l(){const p=[...i.names,...i.skips.map(m=>"-"+m)].join(",");return i.enable(""),p}function c(p){for(const m of i.skips)if(a(p,m))return!1;for(const m of i.names)if(a(p,m))return!0;return!1}function h(p){return p instanceof Error?p.stack||p.message:p}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return i.enable(i.load()),i}return Pu=n,Pu}var bp;function _w(){return bp||(bp=1,function(n,e){e.formatArgs=i,e.save=s,e.load=r,e.useColors=t,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;c.splice(1,0,h,"color: inherit");let f=0,p=0;c[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(f++,m==="%c"&&(p=f))}),c.splice(p,0,h)}e.log=console.debug||console.log||(()=>{});function s(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function r(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof yo<"u"&&"env"in yo&&(c=yo.env.DEBUG),c}function a(){try{return localStorage}catch{}}n.exports=Tw()(e);const{formatters:l}=n.exports;l.j=function(c){try{return JSON.stringify(c)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}(Wa,Wa.exports)),Wa.exports}var Lv=_w();const zi=ur(Lv);var za={exports:{}},Sp;function kv(){if(Sp)return za.exports;Sp=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(x,N,B){return Function.prototype.apply.call(x,N,B)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:t=function(x){return Object.getOwnPropertyNames(x)};function i(D){console&&console.warn&&console.warn(D)}var s=Number.isNaN||function(x){return x!==x};function r(){r.init.call(this)}za.exports=r,za.exports.once=I,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var a=10;function l(D){if(typeof D!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(D){if(typeof D!="number"||D<0||s(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");a=D}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||s(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this};function c(D){return D._maxListeners===void 0?r.defaultMaxListeners:D._maxListeners}r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(x){for(var N=[],B=1;B<arguments.length;B++)N.push(arguments[B]);var H=x==="error",O=this._events;if(O!==void 0)H=H&&O.error===void 0;else if(!H)return!1;if(H){var P;if(N.length>0&&(P=N[0]),P instanceof Error)throw P;var G=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw G.context=P,G}var J=O[x];if(J===void 0)return!1;if(typeof J=="function")e(J,this,N);else for(var se=J.length,ie=E(J,se),B=0;B<se;++B)e(ie[B],this,N);return!0};function h(D,x,N,B){var H,O,P;if(l(N),O=D._events,O===void 0?(O=D._events=Object.create(null),D._eventsCount=0):(O.newListener!==void 0&&(D.emit("newListener",x,N.listener?N.listener:N),O=D._events),P=O[x]),P===void 0)P=O[x]=N,++D._eventsCount;else if(typeof P=="function"?P=O[x]=B?[N,P]:[P,N]:B?P.unshift(N):P.push(N),H=c(D),H>0&&P.length>H&&!P.warned){P.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.emitter=D,G.type=x,G.count=P.length,i(G)}return D}r.prototype.addListener=function(x,N){return h(this,x,N,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(x,N){return h(this,x,N,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(D,x,N){var B={fired:!1,wrapFn:void 0,target:D,type:x,listener:N},H=f.bind(B);return H.listener=N,B.wrapFn=H,H}r.prototype.once=function(x,N){return l(N),this.on(x,p(this,x,N)),this},r.prototype.prependOnceListener=function(x,N){return l(N),this.prependListener(x,p(this,x,N)),this},r.prototype.removeListener=function(x,N){var B,H,O,P,G;if(l(N),H=this._events,H===void 0)return this;if(B=H[x],B===void 0)return this;if(B===N||B.listener===N)--this._eventsCount===0?this._events=Object.create(null):(delete H[x],H.removeListener&&this.emit("removeListener",x,B.listener||N));else if(typeof B!="function"){for(O=-1,P=B.length-1;P>=0;P--)if(B[P]===N||B[P].listener===N){G=B[P].listener,O=P;break}if(O<0)return this;O===0?B.shift():C(B,O),B.length===1&&(H[x]=B[0]),H.removeListener!==void 0&&this.emit("removeListener",x,G||N)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(x){var N,B,H;if(B=this._events,B===void 0)return this;if(B.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):B[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete B[x]),this;if(arguments.length===0){var O=Object.keys(B),P;for(H=0;H<O.length;++H)P=O[H],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(N=B[x],typeof N=="function")this.removeListener(x,N);else if(N!==void 0)for(H=N.length-1;H>=0;H--)this.removeListener(x,N[H]);return this};function m(D,x,N){var B=D._events;if(B===void 0)return[];var H=B[x];return H===void 0?[]:typeof H=="function"?N?[H.listener||H]:[H]:N?S(H):E(H,H.length)}r.prototype.listeners=function(x){return m(this,x,!0)},r.prototype.rawListeners=function(x){return m(this,x,!1)},r.listenerCount=function(D,x){return typeof D.listenerCount=="function"?D.listenerCount(x):_.call(D,x)},r.prototype.listenerCount=_;function _(D){var x=this._events;if(x!==void 0){var N=x[D];if(typeof N=="function")return 1;if(N!==void 0)return N.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function E(D,x){for(var N=new Array(x),B=0;B<x;++B)N[B]=D[B];return N}function C(D,x){for(;x+1<D.length;x++)D[x]=D[x+1];D.pop()}function S(D){for(var x=new Array(D.length),N=0;N<x.length;++N)x[N]=D[N].listener||D[N];return x}function I(D,x){return new Promise(function(N,B){function H(P){D.removeListener(x,O),B(P)}function O(){typeof D.removeListener=="function"&&D.removeListener("error",H),N([].slice.call(arguments))}k(D,x,O,{once:!0}),x!=="error"&&R(D,H,{once:!0})})}function R(D,x,N){typeof D.on=="function"&&k(D,"error",x,N)}function k(D,x,N,B){if(typeof D.on=="function")B.once?D.once(x,N):D.on(x,N);else if(typeof D.addEventListener=="function")D.addEventListener(x,function H(O){B.once&&D.removeEventListener(x,H),N(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof D)}return za.exports}var Ew=kv();const Rv=ur(Ew);var Ya={exports:{}},Du,Cp;function bw(){if(Cp)return Du;Cp=1,Du=n;function n(e,t){if(e&&t)return n(e)(t);if(typeof e!="function")throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(s){i[s]=e[s]}),i;function i(){for(var s=new Array(arguments.length),r=0;r<s.length;r++)s[r]=arguments[r];var a=e.apply(this,s),l=s[s.length-1];return typeof a=="function"&&a!==l&&Object.keys(l).forEach(function(c){a[c]=l[c]}),a}}return Du}var wp;function Sw(){if(wp)return Ya.exports;wp=1;var n=bw();Ya.exports=n(e),Ya.exports.strict=n(t),e.proto=e(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return e(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return t(this)},configurable:!0})});function e(i){var s=function(){return s.called?s.value:(s.called=!0,s.value=i.apply(this,arguments))};return s.called=!1,s}function t(i){var s=function(){if(s.called)throw new Error(s.onceError);return s.called=!0,s.value=i.apply(this,arguments)},r=i.name||"Function wrapped with `once`";return s.onceError=r+" shouldn't be called more than once",s.called=!1,s}return Ya.exports}var Cw=Sw();const ww=ur(Cw);/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var xu,Ap;function Pv(){if(Ap)return xu;Ap=1;let n;return xu=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:vw):e=>(n||(n=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0)),xu}/*! run-parallel. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Ou,Ip;function Aw(){if(Ip)return Ou;Ip=1,Ou=e;const n=Pv();function e(t,i){let s,r,a,l=!0;Array.isArray(t)?(s=[],r=t.length):(a=Object.keys(t),s={},r=a.length);function c(f){function p(){i&&i(f,s),i=null}l?n(p):p()}function h(f,p,m){s[f]=m,(--r===0||p)&&c(p)}r?a?a.forEach(function(f){t[f](function(p,m){h(f,p,m)})}):t.forEach(function(f,p){f(function(m,_){h(p,m,_)})}):c(null),l=!1}return Ou}var Iw=Aw();const Lw=ur(Iw),us=typeof window<"u"?window:self,Ph=us.RTCPeerConnection||us.mozRTCPeerConnection||us.webkitRTCPeerConnection,kw=us.RTCSessionDescription||us.mozRTCSessionDescription||us.webkitRTCSessionDescription,Rw=us.RTCIceCandidate||us.mozRTCIceCandidate||us.webkitRTCIceCandidate;var Mu,Lp;function Pw(){return Lp||(Lp=1,Mu=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}),Mu}var Fu,kp;function Dw(){if(kp)return Fu;kp=1;const n=Pw();return Fu=class{constructor(t){this.hwm=t||16,this.head=new n(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){const i=this.head;this.head=i.next=new n(2*this.head.buffer.length),this.head.push(t)}}shift(){this.length!==0&&this.length--;const t=this.tail.shift();if(t===void 0&&this.tail.next){const i=this.tail.next;return this.tail.next=null,this.tail=i,this.tail.shift()}return t}peek(){const t=this.tail.peek();return t===void 0&&this.tail.next?this.tail.next.peek():t}isEmpty(){return this.length===0}},Fu}var Nu,Rp;function Pp(){return Rp||(Rp=1,Nu=class{constructor(e){this.decoder=new TextDecoder(e==="utf16le"?"utf16-le":e)}get remaining(){return-1}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}}),Nu}var Bu,Dp;function xw(){if(Dp)return Bu;Dp=1;const n=Pp(),e=Pp();Bu=class{constructor(s="utf8"){switch(this.encoding=t(s),this.encoding){case"utf8":this.decoder=new e;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new n(this.encoding)}}get remaining(){return this.decoder.remaining}push(s){return typeof s=="string"?s:this.decoder.decode(s)}write(s){return this.push(s)}end(s){let r="";return s&&(r=this.push(s)),r+=this.decoder.flush(),r}};function t(i){switch(i=i.toLowerCase(),i){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return i;default:throw new Error("Unknown encoding: "+i)}}return Bu}var Uu,xp;function Ow(){if(xp)return Uu;xp=1;const{EventEmitter:n}=kv(),e=new Error("Stream was destroyed"),t=new Error("Premature close"),i=Dw(),s=xw(),r=(1<<29)-1,a=1,l=2,c=4,h=8,f=r^a,p=r^l,m=16,_=32,E=64,C=128,S=256,I=512,R=1024,k=2048,D=4096,x=8192,N=16384,B=32768,H=65536,O=131072,P=S|I,G=m|H,J=E|m,se=D|C,ie=S|O,ne=r^m,ae=r^E,fe=r^(E|H),ee=r^H,oe=r^S,re=r^(C|x),le=r^R,Q=r^P,te=r^B,Se=r^_,be=r^O,Pe=r^ie,Me=1<<18,De=2<<18,$e=4<<18,Ve=8<<18,Je=16<<18,Ye=32<<18,ti=64<<18,Kt=128<<18,Ii=256<<18,Oe=512<<18,Ke=1024<<18,Et=r^(Me|Ii),Ht=r^$e,bt=r^(Me|Oe),Nt=r^Je,mt=r^Ve,mi=r^Kt,Ot=r^De,St=r^Ke,kt=m|Me,qt=r^kt,Rt=N|Ye,It=c|h|l,M=It|a,b=It|Rt,A=Ht&ae,j=Kt|B,q=j&qt,Z=M|q,ue=M|R|N,Fe=M|N|C,at=M|R|C,tt=M|D|C|x,Re=M|m|R|N|H|O,qe=It|R|N,tn=_|M|B|E,Yi=B|a,vi=M|Oe|Ye,Hs=Ve|Je,sn=Ve|Me,Qn=Ve|Je|M|Me,ri=M|Me|Ve|Ke,Jn=$e|Me,ps=Me|Ii,hr=M|Oe|sn|Ye,Zn=Je|It|Oe|Ye,ea=De|M|Kt|$e,gs=Oe|Ye|It,Li=Symbol.asyncIterator||Symbol("asyncIterator");class js{constructor(U,{highWaterMark:ye=16384,map:xe=null,mapWritable:Be,byteLength:ht,byteLengthWritable:it}={}){this.stream=U,this.queue=new i,this.highWaterMark=ye,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=it||ht||da,this.map=Be||xe,this.afterWrite=ki.bind(this),this.afterUpdateNextTick=aa.bind(this)}get ended(){return(this.stream._duplexState&Ye)!==0}push(U){return(this.stream._duplexState&gs)!==0?!1:(this.map!==null&&(U=this.map(U)),this.buffered+=this.byteLength(U),this.queue.push(U),this.buffered<this.highWaterMark?(this.stream._duplexState|=Ve,!0):(this.stream._duplexState|=Hs,!1))}shift(){const U=this.queue.shift();return this.buffered-=this.byteLength(U),this.buffered===0&&(this.stream._duplexState&=mt),U}end(U){typeof U=="function"?this.stream.once("finish",U):U!=null&&this.push(U),this.stream._duplexState=(this.stream._duplexState|Oe)&Ht}autoBatch(U,ye){const xe=[],Be=this.stream;for(xe.push(U);(Be._duplexState&ri)===sn;)xe.push(Be._writableState.shift());if((Be._duplexState&M)!==0)return ye(null);Be._writev(xe,ye)}update(){const U=this.stream;U._duplexState|=De;do{for(;(U._duplexState&ri)===Ve;){const ye=this.shift();U._duplexState|=ps,U._write(ye,this.afterWrite)}(U._duplexState&Jn)===0&&this.updateNonPrimary()}while(this.continueUpdate()===!0);U._duplexState&=Ot}updateNonPrimary(){const U=this.stream;if((U._duplexState&hr)===Oe){U._duplexState=U._duplexState|Me,U._final(sa.bind(this));return}if((U._duplexState&It)===c){(U._duplexState&j)===0&&(U._duplexState|=kt,U._destroy(ms.bind(this)));return}(U._duplexState&Z)===a&&(U._duplexState=(U._duplexState|kt)&f,U._open(oa.bind(this)))}continueUpdate(){return(this.stream._duplexState&Kt)===0?!1:(this.stream._duplexState&=mi,!0)}updateCallback(){(this.stream._duplexState&ea)===$e?this.update():this.updateNextTick()}updateNextTick(){(this.stream._duplexState&Kt)===0&&(this.stream._duplexState|=Kt,(this.stream._duplexState&De)===0&&queueMicrotask(this.afterUpdateNextTick))}}class ta{constructor(U,{highWaterMark:ye=16384,map:xe=null,mapReadable:Be,byteLength:ht,byteLengthReadable:it}={}){this.stream=U,this.queue=new i,this.highWaterMark=ye===0?1:ye,this.buffered=0,this.readAhead=ye>0,this.error=null,this.pipeline=null,this.byteLength=it||ht||da,this.map=Be||xe,this.pipeTo=null,this.afterRead=ra.bind(this),this.afterUpdateNextTick=na.bind(this)}get ended(){return(this.stream._duplexState&N)!==0}pipe(U,ye){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof ye!="function"&&(ye=null),this.stream._duplexState|=I,this.pipeTo=U,this.pipeline=new ia(this.stream,U,ye),ye&&this.stream.on("error",Wt),Gs(U))U._writableState.pipeline=this.pipeline,ye&&U.on("error",Wt),U.on("finish",this.pipeline.finished.bind(this.pipeline));else{const xe=this.pipeline.done.bind(this.pipeline,U),Be=this.pipeline.done.bind(this.pipeline,U,null);U.on("error",xe),U.on("close",Be),U.on("finish",this.pipeline.finished.bind(this.pipeline))}U.on("drain",nn.bind(this)),this.stream.emit("piping",U),U.emit("pipe",this.stream)}push(U){const ye=this.stream;return U===null?(this.highWaterMark=0,ye._duplexState=(ye._duplexState|R)&fe,!1):this.map!==null&&(U=this.map(U),U===null)?(ye._duplexState&=ee,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(U),this.queue.push(U),ye._duplexState=(ye._duplexState|C)&ee,this.buffered<this.highWaterMark)}shift(){const U=this.queue.shift();return this.buffered-=this.byteLength(U),this.buffered===0&&(this.stream._duplexState&=re),U}unshift(U){const ye=[this.map!==null?this.map(U):U];for(;this.buffered>0;)ye.push(this.shift());for(let xe=0;xe<ye.length-1;xe++){const Be=ye[xe];this.buffered+=this.byteLength(Be),this.queue.push(Be)}this.push(ye[ye.length-1])}read(){const U=this.stream;if((U._duplexState&Fe)===C){const ye=this.shift();return this.pipeTo!==null&&this.pipeTo.write(ye)===!1&&(U._duplexState&=Q),(U._duplexState&k)!==0&&U.emit("data",ye),ye}return this.readAhead===!1&&(U._duplexState|=O,this.updateNextTick()),null}drain(){const U=this.stream;for(;(U._duplexState&Fe)===C&&(U._duplexState&P)!==0;){const ye=this.shift();this.pipeTo!==null&&this.pipeTo.write(ye)===!1&&(U._duplexState&=Q),(U._duplexState&k)!==0&&U.emit("data",ye)}}update(){const U=this.stream;U._duplexState|=_;do{for(this.drain();this.buffered<this.highWaterMark&&(U._duplexState&Re)===O;)U._duplexState|=G,U._read(this.afterRead),this.drain();(U._duplexState&tt)===se&&(U._duplexState|=x,U.emit("readable")),(U._duplexState&J)===0&&this.updateNonPrimary()}while(this.continueUpdate()===!0);U._duplexState&=Se}updateNonPrimary(){const U=this.stream;if((U._duplexState&at)===R&&(U._duplexState=(U._duplexState|N)&le,U.emit("end"),(U._duplexState&b)===Rt&&(U._duplexState|=c),this.pipeTo!==null&&this.pipeTo.end()),(U._duplexState&It)===c){(U._duplexState&j)===0&&(U._duplexState|=kt,U._destroy(ms.bind(this)));return}(U._duplexState&Z)===a&&(U._duplexState=(U._duplexState|kt)&f,U._open(oa.bind(this)))}continueUpdate(){return(this.stream._duplexState&B)===0?!1:(this.stream._duplexState&=te,!0)}updateCallback(){(this.stream._duplexState&tn)===E?this.update():this.updateNextTick()}updateNextTickIfOpen(){(this.stream._duplexState&Yi)===0&&(this.stream._duplexState|=B,(this.stream._duplexState&_)===0&&queueMicrotask(this.afterUpdateNextTick))}updateNextTick(){(this.stream._duplexState&B)===0&&(this.stream._duplexState|=B,(this.stream._duplexState&_)===0&&queueMicrotask(this.afterUpdateNextTick))}}class rn{constructor(U){this.data=null,this.afterTransform=on.bind(U),this.afterFinal=null}}class ia{constructor(U,ye,xe){this.from=U,this.to=ye,this.afterPipe=xe,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(U,ye){if(ye&&(this.error=ye),U===this.to&&(this.to=null,this.from!==null)){((this.from._duplexState&N)===0||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(U===this.from&&(this.from=null,this.to!==null)){(U._duplexState&N)===0&&this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function nn(){this.stream._duplexState|=I,this.updateCallback()}function sa(Ee){const U=this.stream;Ee&&U.destroy(Ee),(U._duplexState&It)===0&&(U._duplexState|=Ye,U.emit("finish")),(U._duplexState&b)===Rt&&(U._duplexState|=c),U._duplexState&=bt,(U._duplexState&De)===0?this.update():this.updateNextTick()}function ms(Ee){const U=this.stream;!Ee&&this.error!==e&&(Ee=this.error),Ee&&U.emit("error",Ee),U._duplexState|=h,U.emit("close");const ye=U._readableState,xe=U._writableState;if(ye!==null&&ye.pipeline!==null&&ye.pipeline.done(U,Ee),xe!==null){for(;xe.drains!==null&&xe.drains.length>0;)xe.drains.shift().resolve(!1);xe.pipeline!==null&&xe.pipeline.done(U,Ee)}}function ki(Ee){const U=this.stream;Ee&&U.destroy(Ee),U._duplexState&=Et,this.drains!==null&&an(this.drains),(U._duplexState&Qn)===Je&&(U._duplexState&=Nt,(U._duplexState&ti)===ti&&U.emit("drain")),this.updateCallback()}function ra(Ee){Ee&&this.stream.destroy(Ee),this.stream._duplexState&=ne,this.readAhead===!1&&(this.stream._duplexState&S)===0&&(this.stream._duplexState&=be),this.updateCallback()}function na(){(this.stream._duplexState&_)===0&&(this.stream._duplexState&=te,this.update())}function aa(){(this.stream._duplexState&De)===0&&(this.stream._duplexState&=mi,this.update())}function an(Ee){for(let U=0;U<Ee.length;U++)--Ee[U].writes===0&&(Ee.shift().resolve(!0),U--)}function oa(Ee){const U=this.stream;Ee&&U.destroy(Ee),(U._duplexState&c)===0&&((U._duplexState&ue)===0&&(U._duplexState|=E),(U._duplexState&vi)===0&&(U._duplexState|=$e),U.emit("open")),U._duplexState&=qt,U._writableState!==null&&U._writableState.updateCallback(),U._readableState!==null&&U._readableState.updateCallback()}function on(Ee,U){U!=null&&this.push(U),this._writableState.afterWrite(Ee)}function ln(Ee){this._readableState!==null&&(Ee==="data"&&(this._duplexState|=k|ie,this._readableState.updateNextTick()),Ee==="readable"&&(this._duplexState|=D,this._readableState.updateNextTick())),this._writableState!==null&&Ee==="drain"&&(this._duplexState|=ti,this._writableState.updateNextTick())}class cr extends n{constructor(U){super(),this._duplexState=0,this._readableState=null,this._writableState=null,U&&(U.open&&(this._open=U.open),U.destroy&&(this._destroy=U.destroy),U.predestroy&&(this._predestroy=U.predestroy),U.signal&&U.signal.addEventListener("abort",ot.bind(this))),this.on("newListener",ln)}_open(U){U(null)}_destroy(U){U(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&h)!==0}get destroying(){return(this._duplexState&It)!==0}destroy(U){(this._duplexState&It)===0&&(U||(U=e),this._duplexState=(this._duplexState|c)&A,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=U),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=U),this._duplexState|=l,this._predestroy(),this._duplexState&=p,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class vs extends cr{constructor(U){super(U),this._duplexState|=a|Ye|O,this._readableState=new ta(this,U),U&&(this._readableState.readAhead===!1&&(this._duplexState&=be),U.read&&(this._read=U.read),U.eagerOpen&&this._readableState.updateNextTick(),U.encoding&&this.setEncoding(U.encoding))}setEncoding(U){const ye=new s(U),xe=this._readableState.map||fr;return this._readableState.map=Be,this;function Be(ht){const it=ye.push(ht);return it===""&&(ht.byteLength!==0||ye.remaining>0)?null:xe(it)}}_read(U){U(null)}pipe(U,ye){return this._readableState.updateNextTick(),this._readableState.pipe(U,ye),U}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(U){return this._readableState.updateNextTickIfOpen(),this._readableState.push(U)}unshift(U){return this._readableState.updateNextTickIfOpen(),this._readableState.unshift(U)}resume(){return this._duplexState|=ie,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?Pe:oe,this}static _fromAsyncIterator(U,ye){let xe;const Be=new vs({...ye,read(it){U.next().then(ht).then(it.bind(null,null)).catch(it)},predestroy(){xe=U.return()},destroy(it){if(!xe)return it(null);xe.then(it.bind(null,null)).catch(it)}});return Be;function ht(it){it.done?Be.push(null):Be.push(it.value)}}static from(U,ye){if(ys(U))return U;if(U[Li])return this._fromAsyncIterator(U[Li](),ye);Array.isArray(U)||(U=U===void 0?[]:[U]);let xe=0;return new vs({...ye,read(Be){this.push(xe===U.length?null:U[xe++]),Be(null)}})}static isBackpressured(U){return(U._duplexState&qe)!==0||U._readableState.buffered>=U._readableState.highWaterMark}static isPaused(U){return(U._duplexState&S)===0}[Li](){const U=this;let ye=null,xe=null,Be=null;return this.on("error",Xe=>{ye=Xe}),this.on("readable",ht),this.on("close",it),{[Li](){return this},next(){return new Promise(function(Xe,zt){xe=Xe,Be=zt;const Bt=U.read();Bt!==null?Ti(Bt):(U._duplexState&h)!==0&&Ti(null)})},return(){return Ts(null)},throw(Xe){return Ts(Xe)}};function ht(){xe!==null&&Ti(U.read())}function it(){xe!==null&&Ti(null)}function Ti(Xe){Be!==null&&(ye?Be(ye):Xe===null&&(U._duplexState&N)===0?Be(e):xe({value:Xe,done:Xe===null}),Be=xe=null)}function Ts(Xe){return U.destroy(Xe),new Promise((zt,Bt)=>{if(U._duplexState&h)return zt({value:void 0,done:!0});U.once("close",function(){Xe?Bt(Xe):zt({value:void 0,done:!0})})})}}}class la extends cr{constructor(U){super(U),this._duplexState|=a|N,this._writableState=new js(this,U),U&&(U.writev&&(this._writev=U.writev),U.write&&(this._write=U.write),U.final&&(this._final=U.final),U.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Ke}uncork(){this._duplexState&=St,this._writableState.updateNextTick()}_writev(U,ye){ye(null)}_write(U,ye){this._writableState.autoBatch(U,ye)}_final(U){U(null)}static isBackpressured(U){return(U._duplexState&Zn)!==0}static drained(U){if(U.destroyed)return Promise.resolve(!1);const ye=U._writableState,Be=(yi(U)?Math.min(1,ye.queue.length):ye.queue.length)+(U._duplexState&Ii?1:0);return Be===0?Promise.resolve(!0):(ye.drains===null&&(ye.drains=[]),new Promise(ht=>{ye.drains.push({writes:Be,resolve:ht})}))}write(U){return this._writableState.updateNextTick(),this._writableState.push(U)}end(U){return this._writableState.updateNextTick(),this._writableState.end(U),this}}class un extends vs{constructor(U){super(U),this._duplexState=a|this._duplexState&O,this._writableState=new js(this,U),U&&(U.writev&&(this._writev=U.writev),U.write&&(this._write=U.write),U.final&&(this._final=U.final))}cork(){this._duplexState|=Ke}uncork(){this._duplexState&=St,this._writableState.updateNextTick()}_writev(U,ye){ye(null)}_write(U,ye){this._writableState.autoBatch(U,ye)}_final(U){U(null)}write(U){return this._writableState.updateNextTick(),this._writableState.push(U)}end(U){return this._writableState.updateNextTick(),this._writableState.end(U),this}}class ni extends un{constructor(U){super(U),this._transformState=new rn(this),U&&(U.transform&&(this._transform=U.transform),U.flush&&(this._flush=U.flush))}_write(U,ye){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=U:this._transform(U,this._transformState.afterTransform)}_read(U){if(this._transformState.data!==null){const ye=this._transformState.data;this._transformState.data=null,U(null),this._transform(ye,this._transformState.afterTransform)}else U(null)}destroy(U){super.destroy(U),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(U,ye){ye(null,U)}_flush(U){U(null)}_final(U){this._transformState.afterFinal=U,this._flush(Mt.bind(this))}}class ua extends ni{}function Mt(Ee,U){const ye=this._transformState.afterFinal;if(Ee)return ye(Ee);U!=null&&this.push(U),this.push(null),ye(null)}function ha(...Ee){return new Promise((U,ye)=>dr(...Ee,xe=>{if(xe)return ye(xe);U()}))}function dr(Ee,...U){const ye=Array.isArray(Ee)?[...Ee,...U]:[Ee,...U],xe=ye.length&&typeof ye[ye.length-1]=="function"?ye.pop():null;if(ye.length<2)throw new Error("Pipeline requires at least 2 streams");let Be=ye[0],ht=null,it=null;for(let Xe=1;Xe<ye.length;Xe++)ht=ye[Xe],Gs(Be)?Be.pipe(ht,Ts):(Ti(Be,!0,Xe>1,Ts),Be.pipe(ht)),Be=ht;if(xe){let Xe=!1;const zt=Gs(ht)||!!(ht._writableState&&ht._writableState.autoDestroy);ht.on("error",Bt=>{it===null&&(it=Bt)}),ht.on("finish",()=>{Xe=!0,zt||xe(it)}),zt&&ht.on("close",()=>xe(it||(Xe?null:t)))}return ht;function Ti(Xe,zt,Bt,hn){Xe.on("error",hn),Xe.on("close",cn);function cn(){if(Xe._readableState&&!Xe._readableState.ended||Bt&&Xe._writableState&&!Xe._writableState.ended)return hn(t)}}function Ts(Xe){if(!(!Xe||it)){it=Xe;for(const zt of ye)zt.destroy(Xe)}}}function fr(Ee){return Ee}function Vs(Ee){return!!Ee._readableState||!!Ee._writableState}function Gs(Ee){return typeof Ee._duplexState=="number"&&Vs(Ee)}function el(Ee){return!!Ee._readableState&&Ee._readableState.ended}function jt(Ee){return!!Ee._writableState&&Ee._writableState.ended}function Pt(Ee,U={}){const ye=Ee._readableState&&Ee._readableState.error||Ee._writableState&&Ee._writableState.error;return!U.all&&ye===e?null:ye}function ys(Ee){return Gs(Ee)&&Ee.readable}function pr(Ee){return(Ee._duplexState&a)!==a||(Ee._duplexState&j)!==0}function ca(Ee){return typeof Ee=="object"&&Ee!==null&&typeof Ee.byteLength=="number"}function da(Ee){return ca(Ee)?Ee.byteLength:1024}function Wt(){}function ot(){this.destroy(new Error("Stream aborted."))}function yi(Ee){return Ee._writev!==la.prototype._writev&&Ee._writev!==un.prototype._writev}return Uu={pipeline:dr,pipelinePromise:ha,isStream:Vs,isStreamx:Gs,isEnded:el,isFinished:jt,isDisturbed:pr,getStreamError:Pt,Stream:cr,Writable:la,Readable:vs,Duplex:un,Transform:ni,PassThrough:ua},Uu}var Dv=Ow(),$u,Op;function Mw(){if(Op)return $u;Op=1;function n(t,i){for(const s in i)Object.defineProperty(t,s,{value:i[s],enumerable:!0,configurable:!0});return t}function e(t,i,s){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");s||(s={}),typeof i=="object"&&(s=i,i=""),i&&(s.code=i);try{return n(t,s)}catch{s.message=t.message,s.stack=t.stack;const a=function(){};return a.prototype=Object.create(Object.getPrototypeOf(t)),n(new a,s)}}return $u=e,$u}var Fw=Mw();const gt=ur(Fw);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Fo="0123456789abcdef",xv=[],No=[];for(let n=0;n<256;n++)xv[n]=Fo[n>>4&15]+Fo[n&15],n<16&&(n<10?No[48+n]=n:No[87+n]=n);const Yr=n=>{const e=n.length;let t="",i=0;for(;i<e;)t+=xv[n[i++]];return t},Dh=n=>{const e=n.length>>1,t=e<<1,i=new Uint8Array(e);let s=0,r=0;for(;r<t;)i[s++]=No[n.charCodeAt(r++)]<<4|No[n.charCodeAt(r++)];return i};var Mp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Nw=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Xa=0;Xa<Mp.length;Xa++)Nw[Mp.charCodeAt(Xa)]=Xa;const Bw=new TextDecoder,Ov=(n,e)=>Bw.decode(n),Uw=new TextEncoder,Tc=n=>Uw.encode(n),Rr=n=>{let e="",t,i=0;const s=n.length;for(;i<s;)t=n.charCodeAt(i++),e+=Fo[t>>4]+Fo[t&15];return e},Fp=65536,Nn=n=>{const e=Dh(n);if(e.length<=Fp)return String.fromCharCode(...e);let t="",i=0;for(;i<e.length;)t+=String.fromCharCode(...e.subarray(i,i+=Fp));return t},Np=typeof window<"u"?window:self,xh=Np.crypto||Np.msCrypto||{};xh.subtle||xh.webkitSubtle;const Bo=n=>{const e=new Uint8Array(n);return xh.getRandomValues(e)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const $w=zi("simple-peer"),Hu=64*1024,Hw=5*1e3,jw=5*1e3;function Bp(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function Vw(n){console.warn(n)}let Xn=class Oh extends Dv.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),he(this,"_pc"),this.__objectMode=!!e.objectMode,this._id=Yr(Bo(4)).slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Yr(Bo(20)):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Oh.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Oh.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||Hw,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Ph)throw gt(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Ph(this.config)}catch(t){this.__destroy(gt(t,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(t=>{this.__destroy(gt(t,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this._destroying){if(this.destroyed)throw gt(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new kw(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(t=>{this.__destroy(gt(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.__destroy(gt(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new Rw(e);this._pc.addIceCandidate(t).catch(i=>{!t.address||t.address.endsWith(".local")?Vw("Ignoring unsupported ICE candidate."):this.__destroy(gt(i,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this._destroying){if(this.destroyed)throw gt(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw gt(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(e){this._readableState.ended||this.push(null),e(null)}__destroy(e){this.end(),this._destroy(()=>{},e)}_destroy(e,t){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",t&&(t.message||t)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,t&&this.emit("error",t),e()},0))}_setupData(e){if(!e.channel)return this.__destroy(gt(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Hu),this.channelName=this._channel.label,this._channel.onmessage=i=>{this._onChannelMessage(i)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=i=>{const s=i.error instanceof Error?i.error:new Error(`Datachannel error: ${i.message} ${i.filename}:${i.lineno}:${i.colno}`);this.__destroy(gt(s,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},jw)}_write(e,t){if(this.destroyed)return t(gt(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(i){return this.__destroy(gt(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Hu?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=t):t(null)}else this._debug("write before connect"),this._chunk=e,this._cb=t}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Bp(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const r=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:r.type,sdp:r.sdp})},i=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},s=r=>{this.__destroy(gt(r,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(i).catch(s)}).catch(e=>{this.__destroy(gt(e,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Bp(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{var r;if(this.destroyed)return;const a=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:a.type,sdp:a.sdp}),this.initiator||(r=this._requestMissingTransceivers)==null||r.call(this)},i=()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},s=r=>{this.__destroy(gt(r,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(i).catch(s)}).catch(e=>{this.__destroy(gt(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||this._pc.connectionState==="failed"&&this.__destroy(gt(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.__destroy(gt(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.__destroy(gt(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=i=>(Object.prototype.toString.call(i.values)==="[object Array]"&&i.values.forEach(s=>{Object.assign(i,s)}),i);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(i=>{const s=[];i.forEach(r=>{s.push(t(r))}),e(null,s)},i=>e(i)):this._pc.getStats.length>0?this._pc.getStats(i=>{if(this.destroyed)return;const s=[];i.result().forEach(r=>{const a={};r.names().forEach(l=>{a[l]=r.stat(l)}),a.id=r.id,a.type=r.type,a.timestamp=r.timestamp,s.push(t(a))}),e(null,s)},i=>e(i)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this._destroying||this.getStats((t,i)=>{if(this.destroyed||this._destroying)return;t&&(i=[]);const s={},r={},a={};let l=!1;i.forEach(h=>{(h.type==="remotecandidate"||h.type==="remote-candidate")&&(s[h.id]=h),(h.type==="localcandidate"||h.type==="local-candidate")&&(r[h.id]=h),(h.type==="candidatepair"||h.type==="candidate-pair")&&(a[h.id]=h)});const c=h=>{l=!0;let f=r[h.localCandidateId];f&&(f.ip||f.address)?(this.localAddress=f.ip||f.address,this.localPort=Number(f.port)):f&&f.ipAddress?(this.localAddress=f.ipAddress,this.localPort=Number(f.portNumber)):typeof h.googLocalAddress=="string"&&(f=h.googLocalAddress.split(":"),this.localAddress=f[0],this.localPort=Number(f[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let p=s[h.remoteCandidateId];p&&(p.ip||p.address)?(this.remoteAddress=p.ip||p.address,this.remotePort=Number(p.port)):p&&p.ipAddress?(this.remoteAddress=p.ipAddress,this.remotePort=Number(p.portNumber)):typeof h.googRemoteAddress=="string"&&(p=h.googRemoteAddress.split(":"),this.remoteAddress=p[0],this.remotePort=Number(p[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(i.forEach(h=>{h.type==="transport"&&h.selectedCandidatePairId&&c(a[h.selectedCandidatePairId]),(h.type==="googCandidatePair"&&h.googActiveConnection==="true"||(h.type==="candidatepair"||h.type==="candidate-pair")&&h.selected)&&c(h)}),!l&&(!Object.keys(a).length||Object.keys(r).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(f){return this.__destroy(gt(f,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const h=this._cb;this._cb=null,h(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Hu||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer?t=new Uint8Array(t):this.__objectMode===!1&&(t=Tc(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],$w.apply(null,e)}};Xn.WEBRTC_SUPPORT=!!Ph;Xn.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Xn.channelConfig={};var Gw=Pv();const Mh=ur(Gw),Ki={},Kw=Object.freeze(Object.defineProperty({__proto__:null,default:Ki},Symbol.toStringTag,{value:"Module"})),qw=50,Ww=82,zw=n=>{const e=new URL(n.replace(/^udp:/,"http:"));return n.match(/^udp:/)&&Object.defineProperties(e,{href:{value:e.href.replace(/^http/,"udp")},protocol:{value:e.protocol.replace(/^http/,"udp")},origin:{value:e.origin.replace(/^http/,"udp")}}),e},Fh={DEFAULT_ANNOUNCE_PEERS:qw,MAX_ANNOUNCE_PEERS:Ww,parseUrl:zw,...Kw};/*! simple-websocket. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Yw=zi("simple-websocket"),Rn=typeof Ki!="function"?WebSocket:Ki,Up=64*1024;class Mv extends Dv.Duplex{constructor(e={}){if(typeof e=="string"&&(e={url:e}),e=Object.assign({allowHalfOpen:!1},e),super(e),this.__objectMode=!!e.objectMode,e.objectMode!=null&&delete e.objectMode,e.url==null&&e.socket==null)throw new Error("Missing required `url` or `socket` option");if(e.url!=null&&e.socket!=null)throw new Error("Must specify either `url` or `socket` option, not both");if(this._id=Yr(Bo(4)).slice(0,7),this._debug("new websocket: %o",e),this.connected=!1,this._chunk=null,this._cb=null,this._interval=null,e.socket)this.url=e.socket.url,this._ws=e.socket,this.connected=e.socket.readyState===Rn.OPEN;else{this.url=e.url;try{typeof Ki=="function"?this._ws=new Rn(e.url,{...e,encoding:void 0}):this._ws=new Rn(e.url)}catch(t){Mh(()=>this.destroy(t));return}}this._ws.binaryType="arraybuffer",e.socket&&this.connected?Mh(()=>this._handleOpen()):this._ws.onopen=()=>this._handleOpen(),this._ws.onmessage=t=>this._handleMessage(t),this._ws.onclose=()=>this._handleClose(),this._ws.onerror=t=>this._handleError(t),this._handleFinishBound=()=>this._handleFinish(),this.once("finish",this._handleFinishBound)}send(e){this._ws.send(e)}_final(e){this._readableState.ended||this.push(null),e(null)}_destroy(e){if(!this.destroyed){if(this._writableState.ended||this.end(),this.connected=!1,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._handleFinishBound&&this.removeListener("finish",this._handleFinishBound),this._handleFinishBound=null,this._ws){const t=this._ws,i=()=>{t.onclose=null};if(t.readyState===Rn.CLOSED)i();else try{t.onclose=i,t.close()}catch{i()}t.onopen=null,t.onmessage=null,t.onerror=()=>{}}this._ws=null,e()}}_write(e,t){if(this.destroyed)return t(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(e)}catch(i){return this.destroy(i)}typeof Ki!="function"&&this._ws.bufferedAmount>Up?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=t):t(null)}else this._debug("write before connect"),this._chunk=e,this._cb=t}_handleOpen(){if(!(this.connected||this.destroyed)){if(this.connected=!0,this._chunk){try{this.send(this._chunk)}catch(t){return this.destroy(t)}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}typeof Ki!="function"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}}_handleMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.__objectMode===!1&&(t=Tc(t)),this.push(t)}_handleClose(){this.destroyed||(this._debug("on close"),this.destroy())}_handleError(e){this.destroy(new Error(`Error connecting to ${this.url}`))}_handleFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this.connected?e():this.once("connect",e)}_onInterval(){if(!this._cb||!this._ws||this._ws.bufferedAmount>Up)return;this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Yw.apply(null,e)}}Mv.WEBSOCKET_SUPPORT=!!Rn;class Xw extends Rv{constructor(e,t){super(),this.client=e,this.announceUrl=t,this.interval=null,this.destroyed=!1}setInterval(e){e==null&&(e=this.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(this.interval),e&&(this.interval=setInterval(()=>{this.announce(this.client._defaultAnnounceOpts())},e),this.interval.unref&&this.interval.unref())}}const Ei=zi("bittorrent-tracker:websocket-tracker"),Zi={},Qw=10*1e3,Jw=60*60*1e3,Zw=5*60*1e3,eA=50*1e3;class _c extends Xw{constructor(e,t){super(e,t),Ei("new websocket tracker %s",t),this.peers={},this.socket=null,this.reconnecting=!1,this.retries=0,this.reconnectTimer=null,this.expectingResponse=!1,this._openSocket()}announce(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.announce(e)});return}const t=Object.assign({},e,{action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary});if(this._trackerId&&(t.trackerid=this._trackerId),e.event==="stopped"||e.event==="completed")this._send(t);else{const i=Math.min(e.numwant,5);this._generateOffers(i,s=>{t.numwant=i,t.offers=s,this._send(t)})}}scrape(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.scrape(e)});return}const i={action:"scrape",info_hash:Array.isArray(e.infoHash)&&e.infoHash.length>0?e.infoHash.map(s=>Nn(s)):e.infoHash&&Nn(e.infoHash)||this.client._infoHashBinary};this._send(i)}destroy(e=$p){if(this.destroyed)return e(null);this.destroyed=!0,clearInterval(this.interval),clearTimeout(this.reconnectTimer);for(const r in this.peers){const a=this.peers[r];clearTimeout(a.trackerTimeout),a.destroy()}if(this.peers=null,this.socket&&(this.socket.removeListener("connect",this._onSocketConnectBound),this.socket.removeListener("data",this._onSocketDataBound),this.socket.removeListener("close",this._onSocketCloseBound),this.socket.removeListener("error",this._onSocketErrorBound),this.socket=null),this._onSocketConnectBound=null,this._onSocketErrorBound=null,this._onSocketDataBound=null,this._onSocketCloseBound=null,Zi[this.announceUrl]&&(Zi[this.announceUrl].consumers-=1),Zi[this.announceUrl].consumers>0)return e();let t=Zi[this.announceUrl];delete Zi[this.announceUrl],t.on("error",$p),t.once("close",e);let i;if(!this.expectingResponse)return s();i=setTimeout(s,Fh.DESTROY_TIMEOUT),t.once("data",s);function s(){i&&(clearTimeout(i),i=null),t.removeListener("data",s),t.destroy(),t=null}}_openSocket(){if(this.destroyed=!1,this.peers||(this.peers={}),this._onSocketConnectBound=()=>{this._onSocketConnect()},this._onSocketErrorBound=e=>{this._onSocketError(e)},this._onSocketDataBound=e=>{this._onSocketData(e)},this._onSocketCloseBound=()=>{this._onSocketClose()},this.socket=Zi[this.announceUrl],this.socket)Zi[this.announceUrl].consumers+=1,this.socket.connected&&this._onSocketConnectBound();else{const e=new URL(this.announceUrl);let t;this.client._proxyOpts&&(t=e.protocol==="wss:"?this.client._proxyOpts.httpsAgent:this.client._proxyOpts.httpAgent,!t&&this.client._proxyOpts.socksProxy&&(t=this.client._proxyOpts.socksProxy)),this.socket=Zi[this.announceUrl]=new Mv({url:this.announceUrl,agent:t}),this.socket.consumers=1,this.socket.once("connect",this._onSocketConnectBound)}this.socket.on("data",this._onSocketDataBound),this.socket.once("close",this._onSocketCloseBound),this.socket.once("error",this._onSocketErrorBound)}_onSocketConnect(){this.destroyed||this.reconnecting&&(this.reconnecting=!1,this.retries=0,this.announce(this.client._defaultAnnounceOpts()))}_onSocketData(e){if(!this.destroyed){this.expectingResponse=!1;try{e=JSON.parse(Ov(e))}catch{this.client.emit("warning",new Error("Invalid tracker response"));return}e.action==="announce"?this._onAnnounceResponse(e):e.action==="scrape"?this._onScrapeResponse(e):this._onSocketError(new Error(`invalid action in WS response: ${e.action}`))}}_onAnnounceResponse(e){if(e.info_hash!==this.client._infoHashBinary){Ei("ignoring websocket data from %s for %s (looking for %s: reused socket)",this.announceUrl,Rr(e.info_hash),this.client.infoHash);return}if(e.peer_id&&e.peer_id===this.client._peerIdBinary)return;Ei("received %s from %s for %s",JSON.stringify(e),this.announceUrl,this.client.infoHash);const t=e["failure reason"];if(t)return this.client.emit("warning",new Error(t));const i=e["warning message"];i&&this.client.emit("warning",new Error(i));const s=e.interval||e["min interval"];s&&this.setInterval(s*1e3);const r=e["tracker id"];if(r&&(this._trackerId=r),e.complete!=null){const l=Object.assign({},e,{announce:this.announceUrl,infoHash:Rr(e.info_hash)});this.client.emit("update",l)}let a;if(e.offer&&e.peer_id&&(Ei("creating peer (from remote offer)"),a=this._createPeer(),a.id=Rr(e.peer_id),a.once("signal",l=>{const c={action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary,to_peer_id:e.peer_id,answer:l,offer_id:e.offer_id};this._trackerId&&(c.trackerid=this._trackerId),this._send(c)}),this.client.emit("peer",a),a.signal(e.offer)),e.answer&&e.peer_id){const l=Rr(e.offer_id);a=this.peers[l],a?(a.id=Rr(e.peer_id),this.client.emit("peer",a),a.signal(e.answer),clearTimeout(a.trackerTimeout),a.trackerTimeout=null,delete this.peers[l]):Ei(`got unexpected answer: ${JSON.stringify(e.answer)}`)}}_onScrapeResponse(e){e=e.files||{};const t=Object.keys(e);if(t.length===0){this.client.emit("warning",new Error("invalid scrape response"));return}t.forEach(i=>{const s=Object.assign(e[i],{announce:this.announceUrl,infoHash:Rr(i)});this.client.emit("scrape",s)})}_onSocketClose(){this.destroyed||(this.destroy(),this._startReconnectTimer())}_onSocketError(e){this.destroyed||(this.destroy(),this.client.emit("warning",e),this._startReconnectTimer())}_startReconnectTimer(){const e=Math.floor(Math.random()*Zw)+Math.min(Math.pow(2,this.retries)*Qw,Jw);this.reconnecting=!0,clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(()=>{this.retries++,this._openSocket()},e),this.reconnectTimer.unref&&this.reconnectTimer.unref(),Ei("reconnecting socket in %s ms",e)}_send(e){if(this.destroyed)return;this.expectingResponse=!0;const t=JSON.stringify(e);Ei("send %s",t),this.socket.send(t)}_generateOffers(e,t){const i=this,s=[];Ei("generating %s offers",e);for(let l=0;l<e;++l)r();a();function r(){const l=Yr(Bo(20));Ei("creating peer (from _generateOffers)");const c=i.peers[l]=i._createPeer({initiator:!0});c.once("signal",h=>{s.push({offer:h,offer_id:Nn(l)}),a()}),c.trackerTimeout=setTimeout(()=>{Ei("tracker timeout: destroying peer"),c.trackerTimeout=null,delete i.peers[l],c.destroy()},eA),c.trackerTimeout.unref&&c.trackerTimeout.unref()}function a(){s.length===e&&(Ei("generated %s offers",e),t(s))}}_createPeer(e){const t=this;e=Object.assign({trickle:!1,config:t.client._rtcConfig,wrtc:t.client._wrtc},e);const i=new Xn(e);return i.once("error",s),i.once("connect",r),i;function s(a){t.client.emit("warning",new Error(`Connection error: ${a.message}`)),i.destroy()}function r(){i.removeListener("error",s),i.removeListener("connect",r)}}}_c.prototype.DEFAULT_ANNOUNCE_INTERVAL=30*1e3;_c._socketPool=Zi;function $p(){}const bs=zi("bittorrent-tracker:client");class Nh extends Rv{constructor(e={}){if(super(),!e.peerId)throw new Error("Option `peerId` is required");if(!e.infoHash)throw new Error("Option `infoHash` is required");if(!e.announce)throw new Error("Option `announce` is required");if(!yo.browser&&!e.port)throw new Error("Option `port` is required");this.peerId=typeof e.peerId=="string"?e.peerId:Yr(e.peerId),this._peerIdBuffer=Dh(this.peerId),this._peerIdBinary=Nn(this.peerId),this.infoHash=typeof e.infoHash=="string"?e.infoHash.toLowerCase():Yr(e.infoHash),this._infoHashBuffer=Dh(this.infoHash),this._infoHashBinary=Nn(this.infoHash),bs("new client %s",this.infoHash),this.destroyed=!1,this._port=e.port,this._getAnnounceOpts=e.getAnnounceOpts,this._rtcConfig=e.rtcConfig,this._userAgent=e.userAgent,this._proxyOpts=e.proxyOpts,this._wrtc=typeof e.wrtc=="function"?e.wrtc():e.wrtc;let t=typeof e.announce=="string"?[e.announce]:e.announce==null?[]:e.announce;t=t.map(r=>(ArrayBuffer.isView(r)&&(r=Ov(r)),r[r.length-1]==="/"&&(r=r.substring(0,r.length-1)),r)),t=Array.from(new Set(t));const i=this._wrtc!==!1&&(!!this._wrtc||Xn.WEBRTC_SUPPORT),s=r=>{Mh(()=>{this.emit("warning",r)})};this._trackers=t.map(r=>{let a;try{a=Fh.parseUrl(r)}catch{return s(new Error(`Invalid tracker URL: ${r}`)),null}const l=a.port;if(l<0||l>65535)return s(new Error(`Invalid tracker port: ${r}`)),null;const c=a.protocol;return(c==="http:"||c==="https:")&&typeof Ki=="function"?new Ki(this,r):c==="udp:"&&typeof Ki=="function"?new Ki(this,r):(c==="ws:"||c==="wss:")&&i?c==="ws:"&&typeof window<"u"&&window.location.protocol==="https:"?(s(new Error(`Unsupported tracker protocol: ${r}`)),null):new _c(this,r):(s(new Error(`Unsupported tracker protocol: ${r}`)),null)}).filter(Boolean)}start(e){e=this._defaultAnnounceOpts(e),e.event="started",bs("send `start` %o",e),this._announce(e),this._trackers.forEach(t=>{t.setInterval()})}stop(e){e=this._defaultAnnounceOpts(e),e.event="stopped",bs("send `stop` %o",e),this._announce(e)}complete(e){e||(e={}),e=this._defaultAnnounceOpts(e),e.event="completed",bs("send `complete` %o",e),this._announce(e)}update(e){e=this._defaultAnnounceOpts(e),e.event&&delete e.event,bs("send `update` %o",e),this._announce(e)}_announce(e){this._trackers.forEach(t=>{t.announce(e)})}scrape(e){bs("send `scrape`"),e||(e={}),this._trackers.forEach(t=>{t.scrape(e)})}setInterval(e){bs("setInterval %d",e),this._trackers.forEach(t=>{t.setInterval(e)})}destroy(e){if(this.destroyed)return;this.destroyed=!0,bs("destroy");const t=this._trackers.map(i=>s=>{i.destroy(s)});Lw(t,e),this._trackers=[],this._getAnnounceOpts=null}_defaultAnnounceOpts(e={}){return e.numwant==null&&(e.numwant=Fh.DEFAULT_ANNOUNCE_PEERS),e.uploaded==null&&(e.uploaded=0),e.downloaded==null&&(e.downloaded=0),this._getAnnounceOpts&&(e=Object.assign({},e,this._getAnnounceOpts())),e}}Nh.scrape=(n,e)=>{if(e=ww(e),!n.infoHash)throw new Error("Option `infoHash` is required");if(!n.announce)throw new Error("Option `announce` is required");const t=Object.assign({},n,{infoHash:Array.isArray(n.infoHash)?n.infoHash[0]:n.infoHash,peerId:Tc("01234567890123456789"),port:6881}),i=new Nh(t);i.once("error",e),i.once("warning",e);let s=Array.isArray(n.infoHash)?n.infoHash.length:1;const r={};return i.on("scrape",a=>{if(s-=1,r[a.infoHash]=a,s===0){i.destroy();const l=Object.keys(r);l.length===1?e(null,r[l[0]]):e(null,r)}}),i.scrape({infoHash:n.infoHash}),i};var ju={exports:{}},Hp;function tA(){if(Hp)return ju.exports;Hp=1;function n(I,R,k,D,x,N,B){var H=I+(R&k|~R&D)+(x>>>0)+B;return(H<<N|H>>>32-N)+R}function e(I,R,k,D,x,N,B){var H=I+(R&D|k&~D)+(x>>>0)+B;return(H<<N|H>>>32-N)+R}function t(I,R,k,D,x,N,B){var H=I+(R^k^D)+(x>>>0)+B;return(H<<N|H>>>32-N)+R}function i(I,R,k,D,x,N,B){var H=I+(k^(R|~D))+(x>>>0)+B;return(H<<N|H>>>32-N)+R}function s(I){return(256+(I&255)).toString(16).substr(-2)}function r(I){return String.fromCharCode(I&255)}function a(I){return r(I)+r(I>>>8)+r(I>>>16)+r(I>>>24)}var l=function(I){return unescape(encodeURIComponent(I))};function c(I){for(var R=I.length,k=R<<3,D=new Uint32Array(R+72>>>6<<4),x=0,N=I.length;x<N;++x)D[x>>>2]|=I.charCodeAt(x)<<((x&3)<<3);return D[R>>2]|=128<<(k&31),D[D.length-2]=k,D}var h=ju.exports=function(R){return p(R).toHex()},f=h.fromBytes=function(I){for(var R=c(I),k=1732584193,D=4023233417,x=2562383102,N=271733878,B=7,H=12,O=17,P=22,G=5,J=9,se=14,ie=20,ne=4,ae=11,fe=16,ee=23,oe=6,re=10,le=15,Q=21,te=0,Se=R.length;te<Se;te+=16){var be=k,Pe=D,Me=x,De=N;k=n(k,D,x,N,R[te+0],B,3614090360),N=n(N,k,D,x,R[te+1],H,3905402710),x=n(x,N,k,D,R[te+2],O,606105819),D=n(D,x,N,k,R[te+3],P,3250441966),k=n(k,D,x,N,R[te+4],B,4118548399),N=n(N,k,D,x,R[te+5],H,1200080426),x=n(x,N,k,D,R[te+6],O,2821735955),D=n(D,x,N,k,R[te+7],P,4249261313),k=n(k,D,x,N,R[te+8],B,1770035416),N=n(N,k,D,x,R[te+9],H,2336552879),x=n(x,N,k,D,R[te+10],O,4294925233),D=n(D,x,N,k,R[te+11],P,2304563134),k=n(k,D,x,N,R[te+12],B,1804603682),N=n(N,k,D,x,R[te+13],H,4254626195),x=n(x,N,k,D,R[te+14],O,2792965006),D=n(D,x,N,k,R[te+15],P,1236535329),k=e(k,D,x,N,R[te+1],G,4129170786),N=e(N,k,D,x,R[te+6],J,3225465664),x=e(x,N,k,D,R[te+11],se,643717713),D=e(D,x,N,k,R[te+0],ie,3921069994),k=e(k,D,x,N,R[te+5],G,3593408605),N=e(N,k,D,x,R[te+10],J,38016083),x=e(x,N,k,D,R[te+15],se,3634488961),D=e(D,x,N,k,R[te+4],ie,3889429448),k=e(k,D,x,N,R[te+9],G,568446438),N=e(N,k,D,x,R[te+14],J,3275163606),x=e(x,N,k,D,R[te+3],se,4107603335),D=e(D,x,N,k,R[te+8],ie,1163531501),k=e(k,D,x,N,R[te+13],G,2850285829),N=e(N,k,D,x,R[te+2],J,4243563512),x=e(x,N,k,D,R[te+7],se,1735328473),D=e(D,x,N,k,R[te+12],ie,2368359562),k=t(k,D,x,N,R[te+5],ne,4294588738),N=t(N,k,D,x,R[te+8],ae,2272392833),x=t(x,N,k,D,R[te+11],fe,1839030562),D=t(D,x,N,k,R[te+14],ee,4259657740),k=t(k,D,x,N,R[te+1],ne,2763975236),N=t(N,k,D,x,R[te+4],ae,1272893353),x=t(x,N,k,D,R[te+7],fe,4139469664),D=t(D,x,N,k,R[te+10],ee,3200236656),k=t(k,D,x,N,R[te+13],ne,681279174),N=t(N,k,D,x,R[te+0],ae,3936430074),x=t(x,N,k,D,R[te+3],fe,3572445317),D=t(D,x,N,k,R[te+6],ee,76029189),k=t(k,D,x,N,R[te+9],ne,3654602809),N=t(N,k,D,x,R[te+12],ae,3873151461),x=t(x,N,k,D,R[te+15],fe,530742520),D=t(D,x,N,k,R[te+2],ee,3299628645),k=i(k,D,x,N,R[te+0],oe,4096336452),N=i(N,k,D,x,R[te+7],re,1126891415),x=i(x,N,k,D,R[te+14],le,2878612391),D=i(D,x,N,k,R[te+5],Q,4237533241),k=i(k,D,x,N,R[te+12],oe,1700485571),N=i(N,k,D,x,R[te+3],re,2399980690),x=i(x,N,k,D,R[te+10],le,4293915773),D=i(D,x,N,k,R[te+1],Q,2240044497),k=i(k,D,x,N,R[te+8],oe,1873313359),N=i(N,k,D,x,R[te+15],re,4264355552),x=i(x,N,k,D,R[te+6],le,2734768916),D=i(D,x,N,k,R[te+13],Q,1309151649),k=i(k,D,x,N,R[te+4],oe,4149444226),N=i(N,k,D,x,R[te+11],re,3174756917),x=i(x,N,k,D,R[te+2],le,718787259),D=i(D,x,N,k,R[te+9],Q,3951481745),k=k+be>>>0,D=D+Pe>>>0,x=x+Me>>>0,N=N+De>>>0}var $e=new String(a(k)+a(D)+a(x)+a(N));return $e.toHex=function(){for(var Ve="",Je=0,Ye=$e.length;Je<Ye;++Je)Ve+=s($e.charCodeAt(Je));return Ve},$e},p=h.fromUtf8=function(I){return f(l(I))},m="./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function _(I,R){for(var k="";--R>=0;I>>>=6)k+=m.charAt(I&63);return k}var E=64,C=[0,6,12,1,7,13,2,8,14,3,9,15,4,10,5,11],S=h.salt=function(I){var R="";I||(I=8);do R+=m.charAt(64*Math.random()>>>0);while(--I);return R};return h.crypt=function(I,R){if(I.length>E)throw Error("too long key");R||(R="$1$"+S()),I=l(I);for(var k=l(R.replace(/^\$1\$([^$]+)(?:\$.*)?$/,"$1")),D=f(I+k+I),x=I+"$1$"+k,N=I.length;N>16;N-=16)x+=D;x+=D.slice(0,N);for(var N=I.length;N;N>>=1)x+=N&1?"\0":I.charAt(0);D=f(x);for(var B=0;B<1e3;++B)D=f((B&1?I:D)+(B%3?k:"")+(B%7?I:"")+(B&1?D:I));for(var H="$1$"+k+"$",B=0;B<15;B+=3)H+=_(D.charCodeAt(C[B+0])<<16|D.charCodeAt(C[B+1])<<8|D.charCodeAt(C[B+2]),4);return H+_(D.charCodeAt(C[15]),2)},ju.exports}var iA=tA();const sA=ur(iA),rA="2.2.1",nA=`-PM${uA(rA)}-`,jp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",aA=20;function oA(n){const e=sA.fromUtf8(n).slice(1);return btoa(e)}function lA(n){const e=[n],t=aA-n.length;for(let i=0;i<t;i++)e.push(jp[Math.floor(Math.random()*jp.length)]);return e.join("")}function uA(n){const e=n.split(".");return`${e[0].padStart(2,"0")}${e[1].padStart(2,"0")}`}function Ms(n){return`${n.type}-${n.index}`}function Vp(n){const{externalId:e}=n;return`(${Ms(n.stream)} | ${e})`}function hA(){let n,e;return{promise:new Promise((i,s)=>{n=i,e=s}),resolve:n,reject:e}}function Fv(n,e){e===void 0&&(e=n.reduce((s,r)=>s+r.byteLength,0));const t=new Uint8Array(e);let i=0;for(const s of n)t.set(s,i),i+=s.byteLength;return t}function cA(n){return n[Math.floor(Math.random()*n.length)]}function Gp(n){const e=new TextEncoder,t=new Uint8Array(n.length);return e.encodeInto(n,t),t}function dA(n){const e=new Uint8Array(n.length/2);for(let i=0;i<n.length;i+=2)e[i/2]=parseInt(n.slice(i,i+2),16);return new TextDecoder().decode(e)}function*Kp(n){for(let e=n.length-1;e>=0;e--)yield n[e]}function Nv(n){return!!n&&typeof n=="object"&&!Array.isArray(n)}function fA(n){return Array.isArray(n)}function pA(n){function e(t){if(Nv(t)){const i={};return Object.keys(t).forEach(s=>{if(t[s]!==void 0){const r=e(t[s]);r!==void 0&&(i[s]=r)}}),i}else return t}return e(n)}function Rs(n){if(fA(n))return n.map(e=>Rs(e));if(Nv(n)){const e={};for(const t of Object.keys(n))e[t]=Rs(n[t]);return e}else return n}function gA(n){for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}return n}function Tn(n,e,t={}){return typeof n!="object"||n===null||typeof e!="object"||e===null||Object.keys(e).forEach(i=>{if(i==="__proto__"||i==="constructor"||i==="prototype")throw new Error(`Attempt to modify restricted property '${String(i)}'`);const s=e[i],r=t[i];i in n&&(s===void 0?n[i]=r===void 0?void 0:r:n[i]=s)}),n}function Vu(n){const{defaultConfig:e,baseConfig:t={},specificStreamConfig:i={}}=n,s=Rs({...e,...t,...i}),r=Object.keys(e),a={};return r.forEach(l=>{l in s&&(a[l]=s[l])}),a}var Ls=(n=>(n[n.SegmentsAnnouncement=0]="SegmentsAnnouncement",n[n.SegmentRequest=1]="SegmentRequest",n[n.SegmentData=2]="SegmentData",n[n.SegmentDataSendingCompleted=3]="SegmentDataSendingCompleted",n[n.SegmentAbsent=4]="SegmentAbsent",n[n.CancelSegmentRequest=5]="CancelSegmentRequest",n))(Ls||{}),Vr=(n=>(n[n.Min=-1]="Min",n[n.Int=0]="Int",n[n.SimilarIntArray=1]="SimilarIntArray",n[n.String=2]="String",n[n.Max=3]="Max",n))(Vr||{});function mA(n){return n<0?-n:n}function vA(n){const e=n.toString(2),t=n<0?e.length:e.length+1;return Math.ceil(t/8)}function yA(n){const e=n<0,t=vA(n),i=new Uint8Array(t),s=BigInt(t);n=mA(n);for(let r=0;r<t;r++){const a=8n*(s-1n-BigInt(r)),l=n>>a&0xffn;i[r]=Number(l)}return e&&(i[0]=i[0]|128),i}function TA(n){const e=BigInt(n.length),t=(s,r)=>{const a=8n*(e-1n-BigInt(r));return BigInt(s)<<a};let i=t(n[0]&127,0);for(let s=1;s<e;s++)i=t(n[s],s)|i;return(n[0]&128)>>7!==0&&(i=-i),i}function Bv(n){const e=yA(n),t=0|e.length;return new Uint8Array([t,...e])}function Uv(n){const e=n[0];if(e>>4!==0)throw new Error("Trying to deserialize integer with invalid serialized item code");const i=e&15,s=1,r=s+i;return{number:TA(n.slice(s,r)),byteLength:i+1}}function _A(n){const e=new Map;for(const i of n){const s=i&~0xffn,r=i&0xffn,a=e.get(s)??new Kn;a.length||e.set(s,a),a.push(Number(r))}const t=new Kn;t.push([16,e.size]);for(const[i,s]of e){const{length:r}=s.getBytesChunks(),a=i|BigInt(r)&0xffn;s.unshift(Bv(a)),t.push(s.getBuffer())}return t.getBuffer()}function EA(n){const[e,t]=n;if(e>>4!==1)throw new Error("Trying to deserialize similar int array with invalid serialized item code");let s=2;const r=[];for(let a=0;a<t;a++){const{number:l,byteLength:c}=Uv(n.slice(s));s+=c;const h=l&0xffn,f=l&~0xffn;for(let p=0;p<h;p++){const m=BigInt(n[s]);r.push(f|m),s++}}return{numbers:r,byteLength:s}}function bA(n){const{length:e}=n,t=new Kn;return t.push([32|e>>8&15,e&255]),t.push(new TextEncoder().encode(n)),t.getBuffer()}function SA(n){const[e,t]=n;if(e>>4!==2)throw new Error("Trying to deserialize bytes (sting) with invalid serialized item code.");const s=(e&15)<<8|t,r=n.slice(2,s+2);return{string:new TextDecoder("utf8").decode(r),byteLength:s+2}}class Kn{constructor(){he(this,"bytes",[]),he(this,"_length",0)}push(e){this.addBytes(e,"end")}unshift(e){this.addBytes(e,"start")}addBytes(e,t){let i;e instanceof Uint8Array?i=e:Array.isArray(e)?i=new Uint8Array(e):i=new Uint8Array([e]),this._length+=i.length,this.bytes[t==="start"?"unshift":"push"](i)}getBytesChunks(){return this.bytes}getBuffer(){return Fv(this.bytes,this._length)}get length(){return this._length}}const Wi=4,Xr=Xo("cstr",Wi),qn=Xo("cend",Wi),Bh=Xo("dstr",Wi),Uh=Xo("dend",Wi),CA=[Xr,Bh],wA=[qn,Uh],qp=Xr.length+qn.length;function $v(n){const{length:e}=Xr,t=n.slice(-e);return CA.some(i=>$o(n,i,Wi))&&wA.some(i=>$o(t,i,Wi))}function AA(n){return $o(n,Xr,Wi)}function IA(n){return $o(n.slice(-4),qn,Wi)}class Uo extends Error{constructor(e){super(),this.type=e}}class Hv{constructor(e){he(this,"chunks",new Kn),he(this,"status","joining"),this.onComplete=e}addCommandChunk(e){if(this.status==="completed")return;const t=AA(e);if(!this.chunks.length&&!t)throw new Uo("no-first-chunk");if(this.chunks.length&&t)throw new Uo("incomplete-joining");this.chunks.push(this.unframeCommandChunk(e)),IA(e)&&(this.status="completed",this.onComplete(this.chunks.getBuffer()))}unframeCommandChunk(e){return e.slice(Wi,e.length-Wi)}}class Yo{constructor(e,t){he(this,"bytes",new Kn),he(this,"resultBuffers",[]),he(this,"status","creating"),this.maxChunkLength=t,this.bytes.push(e)}addInteger(e,t){this.bytes.push(e.charCodeAt(0));const i=Bv(BigInt(t));this.bytes.push(i)}addSimilarIntArr(e,t){this.bytes.push(e.charCodeAt(0));const i=_A(t.map(s=>BigInt(s)));this.bytes.push(i)}addString(e,t){this.bytes.push(e.charCodeAt(0));const i=bA(t);this.bytes.push(i)}complete(){if(!this.bytes.length)throw new Error("Buffer is empty");if(this.status==="completed")return;this.status="completed";const e=this.bytes.getBuffer();if(e.length+qp<=this.maxChunkLength){this.resultBuffers.push(Qa(e,Xr,qn));return}let t=Math.ceil(e.length/this.maxChunkLength);Math.ceil(e.length/t)+qp>this.maxChunkLength&&t++;for(const[i,s]of kA(e,t))i===0?this.resultBuffers.push(Qa(s,Xr,Uh)):i===t-1?this.resultBuffers.push(Qa(s,Bh,qn)):this.resultBuffers.push(Qa(s,Bh,Uh))}getResultBuffers(){if(this.status==="creating"||!this.resultBuffers.length)throw new Error("Command is not complete.");return this.resultBuffers}}function jv(n){const[e]=n,t={c:e};let i=1;for(;i<n.length;){const s=String.fromCharCode(n[i]);switch(i++,LA(n[i])){case Vr.Int:{const{number:a,byteLength:l}=Uv(n.slice(i));t[s]=Number(a),i+=l}break;case Vr.SimilarIntArray:{const{numbers:a,byteLength:l}=EA(n.slice(i));t[s]=a.map(c=>Number(c)),i+=l}break;case Vr.String:{const{string:a,byteLength:l}=SA(n.slice(i));t[s]=a,i+=l}break}}return t}function LA(n){const e=n>>4;if(e<=Vr.Min||e>=Vr.Max)throw new Error("Not existing type");return e}function Xo(n,e){if(n.length!==e)throw new Error("Wrong string length");const t=new Uint8Array(e);for(let i=0;i<n.length;i++)t[i]=n.charCodeAt(i);return t}function*kA(n,e){const t=Math.ceil(n.length/e);for(let i=0;i<e;i++)yield[i,n.slice(i*t,(i+1)*t)]}function Qa(n,e,t){const i=new Uint8Array(n.length+e.length+t.length);return i.set(e),i.set(n,e.length),i.set(t,e.length+n.length),i}function $o(n,e,t){for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function RA(n,e){const{c:t,p:i,l:s}=n,r=new Yo(t,e);return s?.length&&r.addSimilarIntArr("l",s),i?.length&&r.addSimilarIntArr("p",i),r.complete(),r.getResultBuffers()}function PA(n,e){const t=new Yo(n.c,e);return t.addInteger("i",n.i),t.addInteger("r",n.r),t.complete(),t.getResultBuffers()}function DA(n,e){const t=new Yo(n.c,e);return t.addInteger("i",n.i),t.addInteger("s",n.s),t.addInteger("r",n.r),t.complete(),t.getResultBuffers()}function xA(n,e){const t=new Yo(n.c,e);return t.addInteger("i",n.i),t.addInteger("r",n.r),n.b&&t.addInteger("b",n.b),t.complete(),t.getResultBuffers()}function Vv(n,e){switch(n.c){case Ls.CancelSegmentRequest:case Ls.SegmentAbsent:case Ls.SegmentDataSendingCompleted:return PA(n,e);case Ls.SegmentRequest:return xA(n,e);case Ls.SegmentsAnnouncement:return RA(n,e);case Ls.SegmentData:return DA(n,e)}}const OA=Object.freeze(Object.defineProperty({__proto__:null,BinaryCommandChunksJoiner:Hv,BinaryCommandJoiningError:Uo,PeerCommandType:Ls,deserializeCommand:jv,isCommandChunk:$v,serializePeerCommand:Vv},Symbol.toStringTag,{value:"Module"}));class MA{constructor(e,t,i,s){he(this,"commandChunks"),he(this,"uploadingContext"),he(this,"onChunkDownloaded"),he(this,"onChunkUploaded"),he(this,"onDataReceived",r=>{$v(r)?this.receivingCommandBytes(r):(this.eventHandlers.onSegmentChunkReceived(r),this.onChunkDownloaded(r.byteLength,"p2p",this.connection.idUtf8))}),this.connection=e,this.peerConfig=t,this.eventHandlers=i,this.onChunkDownloaded=s.getEventDispatcher("onChunkDownloaded"),this.onChunkUploaded=s.getEventDispatcher("onChunkUploaded"),e.on("data",this.onDataReceived)}sendCommand(e){const t=Vv(e,this.peerConfig.webRtcMaxMessageSize);for(const i of t)this.connection.write(i)}stopUploadingSegmentData(){var e;(e=this.uploadingContext)==null||e.stopUploading(),this.uploadingContext=void 0}getUploadingRequestId(){var e;return(e=this.uploadingContext)==null?void 0:e.requestId}async splitSegmentDataToChunksAndUploadAsync(e,t){if(this.uploadingContext)throw new Error("Some segment data is already uploading.");const i=FA(e,this.peerConfig.webRtcMaxMessageSize),{promise:s,resolve:r,reject:a}=hA();let l=!1;const c={stopUploading:()=>{l=!1},requestId:t};this.uploadingContext=c;const h=()=>{if(!l){a();return}for(;;){const f=i.next().value;if(!f){r();break}const p=this.connection.write(f);if(this.onChunkUploaded(f.byteLength,this.connection.idUtf8),!p)break}};try{this.connection.on("drain",h),l=!0,h(),await s}finally{this.connection.off("drain",h),this.uploadingContext===c&&(this.uploadingContext=void 0)}}receivingCommandBytes(e){this.commandChunks||(this.commandChunks=new Hv(t=>{this.commandChunks=void 0;const i=jv(t);this.eventHandlers.onCommandReceived(i)}));try{this.commandChunks.addCommandChunk(e)}catch(t){if(!(t instanceof Uo))return;this.commandChunks=void 0}}}function*FA(n,e){let t=n.byteLength;for(;t>0;){const i=t>=e?e:t,s=n.byteLength-t,r=n.slice(s,s+i);t-=i,yield r}}const{PeerCommandType:ui}=OA;class Ho{constructor(e,t,i,s,r){he(this,"id"),he(this,"peerProtocol"),he(this,"downloadingContext"),he(this,"loadedSegments",new Set),he(this,"httpLoadingSegments",new Set),he(this,"downloadingErrors",[]),he(this,"logger",zi("p2pml-core:peer")),he(this,"onPeerClosed"),he(this,"onCommandReceived",async a=>{var l,c,h;switch(a.c){case ui.SegmentsAnnouncement:this.loadedSegments=new Set(a.l),this.httpLoadingSegments=new Set(a.p),this.eventHandlers.onSegmentsAnnouncement();break;case ui.SegmentRequest:this.peerProtocol.stopUploadingSegmentData(),this.eventHandlers.onSegmentRequested(this,a.i,a.r,a.b);break;case ui.SegmentData:{if(!this.downloadingContext||this.downloadingContext.isSegmentDataCommandReceived)break;const{request:f,controls:p,requestId:m}=this.downloadingContext;if(f.segment.externalId!==a.i||m!==a.r)break;this.downloadingContext.isSegmentDataCommandReceived=!0,p.firstBytesReceived(),f.totalBytes===void 0?f.setTotalBytes(a.s):f.totalBytes-f.loadedBytes!==a.s&&(f.clearLoadedBytes(),this.sendCancelSegmentRequestCommand(f.segment,m),this.cancelSegmentDownloading("peer-response-bytes-length-mismatch"),this.destroy())}break;case ui.SegmentDataSendingCompleted:{const{downloadingContext:f}=this;if(!f?.isSegmentDataCommandReceived)return;const{request:p,controls:m}=f;if(f.request.segment.externalId!==a.i||f.requestId!==a.r){p.clearLoadedBytes(),this.cancelSegmentDownloading("peer-protocol-violation"),this.destroy();return}if(p.loadedBytes!==p.totalBytes){p.clearLoadedBytes(),this.cancelSegmentDownloading("peer-response-bytes-length-mismatch"),this.destroy();return}const C=await((c=(l=this.peerConfig).validateP2PSegment)==null?void 0:c.call(l,p.segment.url,p.segment.byteRange,p.data))??!0;if(this.downloadingContext!==f)return;if(!C){p.clearLoadedBytes(),this.cancelSegmentDownloading("p2p-segment-validation-failed"),this.destroy();return}this.downloadingErrors=[],m.completeOnSuccess(),this.downloadingContext=void 0;break}case ui.SegmentAbsent:((h=this.downloadingContext)==null?void 0:h.request.segment.externalId)===a.i&&this.downloadingContext.requestId===a.r&&(this.cancelSegmentDownloading("peer-segment-absent"),this.loadedSegments.delete(a.i));break;case ui.CancelSegmentRequest:{if(this.peerProtocol.getUploadingRequestId()!==a.r)break;this.peerProtocol.stopUploadingSegmentData();break}}}),he(this,"onSegmentChunkReceived",a=>{var l;if(!((l=this.downloadingContext)!=null&&l.isSegmentDataCommandReceived))return;const{request:c,controls:h}=this.downloadingContext;if(c.totalBytes!==void 0&&c.loadedBytes+a.byteLength>c.totalBytes){c.clearLoadedBytes(),this.cancelSegmentDownloading("peer-response-bytes-length-mismatch"),this.destroy();return}h.addLoadedChunk(a)}),he(this,"onPeerConnectionClosed",()=>{this.destroy()}),he(this,"onConnectionError",a=>{this.logger(`peer connection error ${this.id} %O`,a),this.eventTarget.getEventDispatcher("onPeerError")({peerId:this.id,streamType:this.streamType,error:a});const{code:l}=a;l==="ERR_DATA_CHANNEL"?this.destroy():l==="ERR_CONNECTION_FAILURE"&&this.destroy()}),he(this,"destroy",()=>{this.cancelSegmentDownloading("peer-closed"),this.connection.destroy(),this.eventHandlers.onPeerClosed(this),this.onPeerClosed({peerId:this.id,streamType:this.streamType}),this.logger(`peer closed ${this.id}`)}),this.connection=e,this.eventHandlers=t,this.peerConfig=i,this.streamType=s,this.eventTarget=r,this.onPeerClosed=r.getEventDispatcher("onPeerClose"),this.id=Ho.getPeerIdFromConnection(e),this.peerProtocol=new MA(e,i,{onSegmentChunkReceived:this.onSegmentChunkReceived,onCommandReceived:this.onCommandReceived},r),r.getEventDispatcher("onPeerConnect")({peerId:this.id,streamType:s}),e.on("error",this.onConnectionError),e.on("close",this.onPeerConnectionClosed),e.on("end",this.onPeerConnectionClosed),e.on("finish",this.onPeerConnectionClosed)}get downloadingSegment(){var e;return(e=this.downloadingContext)==null?void 0:e.request.segment}getSegmentStatus(e){const{externalId:t}=e;if(this.loadedSegments.has(t))return"loaded";if(this.httpLoadingSegments.has(t))return"http-loading"}downloadSegment(e){if(this.downloadingContext)throw new Error("Some segment already is downloading");this.downloadingContext={request:e,requestId:Math.floor(Math.random()*1e3),isSegmentDataCommandReceived:!1,controls:e.start({downloadSource:"p2p",peerId:this.id},{notReceivingBytesTimeoutMs:this.peerConfig.p2pNotReceivingBytesTimeoutMs,abort:i=>{if(!this.downloadingContext)return;const{request:s,requestId:r}=this.downloadingContext;this.sendCancelSegmentRequestCommand(s.segment,r),this.downloadingErrors.push(i),this.downloadingContext=void 0,this.downloadingErrors.filter(l=>l.type==="bytes-receiving-timeout").length>=this.peerConfig.p2pErrorRetries&&this.destroy()}})};const t={c:ui.SegmentRequest,r:this.downloadingContext.requestId,i:e.segment.externalId};e.loadedBytes&&(t.b=e.loadedBytes),this.peerProtocol.sendCommand(t)}async uploadSegmentData(e,t,i){const{externalId:s}=e;this.logger(`send segment ${e.externalId} to ${this.id}`);const r={c:ui.SegmentData,i:s,r:t,s:i.byteLength};this.peerProtocol.sendCommand(r);try{await this.peerProtocol.splitSegmentDataToChunksAndUploadAsync(i,t),this.sendSegmentDataSendingCompletedCommand(e,t),this.logger(`segment ${s} has been sent to ${this.id}`)}catch{this.logger(`cancel segment uploading ${s}`)}}cancelSegmentDownloading(e){if(!this.downloadingContext)return;const{request:t,controls:i}=this.downloadingContext,{segment:s}=t;this.logger(`cancel segment request ${s.externalId} (${e})`);const r=new hi(e);i.abortOnError(r),this.downloadingContext=void 0,this.downloadingErrors.push(r)}sendSegmentsAnnouncementCommand(e,t){const i={c:ui.SegmentsAnnouncement,p:t,l:e};this.peerProtocol.sendCommand(i)}sendSegmentAbsentCommand(e,t){this.peerProtocol.sendCommand({c:ui.SegmentAbsent,i:e,r:t})}sendCancelSegmentRequestCommand(e,t){this.peerProtocol.sendCommand({c:ui.CancelSegmentRequest,i:e.externalId,r:t})}sendSegmentDataSendingCompletedCommand(e,t){this.peerProtocol.sendCommand({c:ui.SegmentDataSendingCompleted,r:t,i:e.externalId})}static getPeerIdFromConnection(e){return dA(e.id)}}function NA(){const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),e=/\b(iPad|iPhone|Macintosh).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return n||e}const Gv=class To{constructor(e,t,i,s,r){he(this,"streamShortId"),he(this,"client"),he(this,"_peers",new Map),he(this,"logger",zi("p2pml-core:p2p-tracker-client")),he(this,"onReceivePeerConnection",c=>{const h=Ho.getPeerIdFromConnection(c);let f=this._peers.get(h);if(f?.peer){c.destroy();return}f||(f={potentialConnections:new Set},c.idUtf8=h,this._peers.set(h,f)),f.potentialConnections.add(c),c.on("connect",()=>{if(!f.peer){for(const p of f.potentialConnections)p!==c&&p.destroy();f.potentialConnections.clear(),f.peer=new Ho(c,{onPeerClosed:this.onPeerClosed,onSegmentRequested:this.eventHandlers.onSegmentRequested,onSegmentsAnnouncement:this.eventHandlers.onSegmentsAnnouncement},this.config,this.stream.type,this.eventTarget),this.logger(`connected with peer: ${f.peer.id} ${this.streamShortId}`),this.eventHandlers.onPeerConnected(f.peer)}})}),he(this,"onTrackerClientWarning",c=>{this.logger("tracker warning %s:",this.streamShortId,c),this.eventTarget.getEventDispatcher("onTrackerWarning")({streamType:this.stream.type,warning:c})}),he(this,"onTrackerClientError",c=>{this.logger("tracker error in stream %s:",this.streamShortId,c),this.eventTarget.getEventDispatcher("onTrackerError")({streamType:this.stream.type,error:c})}),he(this,"onPeerClosed",c=>{this.logger(`peer closed: ${c.id}`),this._peers.delete(c.id)}),this.stream=t,this.eventHandlers=i,this.config=s,this.eventTarget=r;const a=oA(e);this.streamShortId=Ms(t);let l=To.PEER_ID_BY_INFO_HASH.get(a);l||(l=lA(s.trackerClientVersionPrefix),To.PEER_ID_BY_INFO_HASH.set(a,l)),this.client=new Nh({infoHash:Gp(a),peerId:Gp(l),announce:NA()?s.announceTrackers.slice(0,1):s.announceTrackers,rtcConfig:this.config.rtcConfig}),this.client.on("peer",this.onReceivePeerConnection),this.client.on("warning",this.onTrackerClientWarning),this.client.on("error",this.onTrackerClientError),this.logger(`create new client; 
stream: ${this.streamShortId}; hash: ${a}
peerId: ${l}`)}start(){this.client.start()}destroy(){this.client.destroy();for(const{peer:e,potentialConnections:t}of this._peers.values()){e?.destroy();for(const i of t)i.destroy()}this._peers.clear(),this.logger("destroy client; stream:",this.streamShortId)}*peers(){for(const e of this._peers.values())e.peer&&(yield e.peer)}static clearPeerIdCache(){To.PEER_ID_BY_INFO_HASH.clear()}};he(Gv,"PEER_ID_BY_INFO_HASH",new Map);let Kv=Gv;const BA="v2";function as(n,e){return`${BA}-${n}-${$A(e)}`}function Wp(n,e){for(const t of n.values()){const i=t.segments.get(e);if(i)return i}}function UA(n,e){for(const t of n.segments.values())if(t.externalId===e)return t}function $A(n){return`${n.type}-${n.index}`}function HA(n){const{segments:e}=n;let t=0;const{size:i}=e;for(const s of e.values()){const r=s.endTime-s.startTime;t+=r}return t/i}function jA(n,e){const{highDemandTimeWindow:t,httpDownloadTimeWindow:i,p2pDownloadTimeWindow:s}=n,r={highDemandTimeWindow:t,httpDownloadTimeWindow:i,p2pDownloadTimeWindow:s};return e<=5?(r.httpDownloadTimeWindow=0,r.p2pDownloadTimeWindow=0):e<=10&&(r.p2pDownloadTimeWindow=r.httpDownloadTimeWindow),r}function Gu(n,e,t,i,s){const{highDemandTimeWindow:r,httpDownloadTimeWindow:a,p2pDownloadTimeWindow:l}=jA(t,s);return{isHighDemand:Ku(n,e,r),isHttpDownloadable:Ku(n,e,a),isP2PDownloadable:Ku(n,e,l)&&i.isSegmentLoadingOrLoadedBySomeone(n)}}function Ku(n,e,t){const{startTime:i,endTime:s}=n,{position:r,rate:a}=e;return!(r+t*a<i||r>s)}class VA{constructor(e,t,i,s,r,a,l){he(this,"trackerClient"),he(this,"isAnnounceMicrotaskCreated",!1),he(this,"onPeerConnected",f=>{if(this.config.isP2PUploadDisabled)return;const{httpLoading:p,loaded:m}=this.getSegmentsAnnouncement();f.sendSegmentsAnnouncementCommand(m,p)}),he(this,"broadcastAnnouncement",(f=!1)=>{if(f){this.sendSegmentsAnnouncement([],[]);return}if(this.isAnnounceMicrotaskCreated||this.config.isP2PUploadDisabled)return;const{loaded:p,httpLoading:m}=this.getSegmentsAnnouncement();this.sendSegmentsAnnouncement(p,m)}),he(this,"sendSegmentsAnnouncement",(f,p)=>{this.isAnnounceMicrotaskCreated=!0,queueMicrotask(()=>{for(const m of this.trackerClient.peers())m.sendSegmentsAnnouncementCommand(f,p);this.isAnnounceMicrotaskCreated=!1})}),he(this,"onSegmentRequested",async(f,p,m,_)=>{const E=UA(this.stream,p);if(!E)return;if(this.config.isP2PUploadDisabled){f.sendSegmentAbsentCommand(p,m);return}const C=this.config.swarmId??this.streamManifestUrl,S=as(C,this.stream),I=await this.segmentStorage.getSegmentData(C,S,E.externalId);if(!I){f.sendSegmentAbsentCommand(p,m);return}await f.uploadSegmentData(E,m,_!==void 0?I.slice(_):I)}),this.streamManifestUrl=e,this.stream=t,this.requests=i,this.segmentStorage=s,this.config=r,this.eventTarget=a,this.onSegmentAnnouncement=l;const c=this.config.swarmId??this.streamManifestUrl,h=as(c,this.stream);this.trackerClient=new Kv(h,this.stream,{onPeerConnected:this.onPeerConnected,onSegmentRequested:this.onSegmentRequested,onSegmentsAnnouncement:this.onSegmentAnnouncement},this.config,this.eventTarget),this.eventTarget.addEventListener(`onStorageUpdated-${h}`,this.broadcastAnnouncement),this.segmentStorage.setSegmentChangeCallback(f=>{this.eventTarget.dispatchEvent(`onStorageUpdated-${f}`)}),this.trackerClient.start()}downloadSegment(e){const t=[];for(const r of this.trackerClient.peers())!r.downloadingSegment&&r.getSegmentStatus(e)==="loaded"&&t.push(r);if(t.length===0)return;const i=cA(t),s=this.requests.getOrCreateRequest(e);i.downloadSegment(s)}isSegmentLoadingOrLoadedBySomeone(e){for(const t of this.trackerClient.peers())if(t.getSegmentStatus(e))return!0;return!1}isSegmentLoadedBySomeone(e){for(const t of this.trackerClient.peers())if(t.getSegmentStatus(e)==="loaded")return!0;return!1}get connectedPeerCount(){let e=0;const t=this.trackerClient.peers();for(;!t.next().done;)e++;return e}getSegmentsAnnouncement(){const e=this.config.swarmId??this.streamManifestUrl,t=as(e,this.stream),i=this.segmentStorage.getStoredSegmentIds(e,t),s=[];for(const r of this.requests.httpRequests()){const a=this.stream.segments.get(r.segment.runtimeId);a&&s.push(a.externalId)}return{loaded:i,httpLoading:s}}destroy(){const e=this.config.swarmId??this.streamManifestUrl,t=as(e,this.stream);this.eventTarget.removeEventListener(`onStorageUpdated-${t}`,this.broadcastAnnouncement),this.trackerClient.destroy()}}class GA{constructor(e,t,i,s,r,a,l){he(this,"loaders",new Map),he(this,"_currentLoaderItem"),he(this,"logger",zi("p2pml-core:p2p-loaders-container")),this.streamManifestUrl=e,this.requests=i,this.segmentStorage=s,this.config=r,this.eventTarget=a,this.onSegmentAnnouncement=l,this._currentLoaderItem=this.findOrCreateLoaderForStream(t),this.logger(`set current p2p loader: ${Ms(t)}`)}createLoader(e){if(this.loaders.has(e.runtimeId))throw new Error("Loader for this stream already exists");const t=new VA(this.streamManifestUrl,e,this.requests,this.segmentStorage,this.config,this.eventTarget,()=>{this._currentLoaderItem.loader===t&&this.onSegmentAnnouncement()}),i=Ms(e);return this.logger(`created new loader: ${i}`),{loader:t,stream:e,loggerInfo:Ms(e)}}findOrCreateLoaderForStream(e){const t=this.loaders.get(e.runtimeId);if(t)return clearTimeout(t.destroyTimeoutId),t.destroyTimeoutId=void 0,t;{const i=this.createLoader(e);return this.loaders.set(e.runtimeId,i),i}}changeCurrentLoader(e){const t=this.config.swarmId??this.streamManifestUrl,i=as(t,this._currentLoaderItem.stream);this.segmentStorage.getStoredSegmentIds(t,i).length?this.setLoaderDestroyTimeout(this._currentLoaderItem):this.destroyAndRemoveLoader(this._currentLoaderItem),this._currentLoaderItem=this.findOrCreateLoaderForStream(e),this.logger(`change current p2p loader: ${Ms(e)}`)}setLoaderDestroyTimeout(e){e.destroyTimeoutId=window.setTimeout(()=>this.destroyAndRemoveLoader(e),this.config.p2pInactiveLoaderDestroyTimeoutMs)}destroyAndRemoveLoader(e){e.loader.destroy(),this.loaders.delete(e.stream.runtimeId),this.logger("destroy p2p loader: ",e.loggerInfo)}get currentLoader(){return this._currentLoaderItem.loader}destroy(){for(const{loader:e,destroyTimeoutId:t}of this.loaders.values())e.destroy(),clearTimeout(t);this.loaders.clear()}}function Ja(n){return{runtimeId:n.runtimeId,externalId:n.externalId,url:n.url,byteRange:n.byteRange,startTime:n.startTime,endTime:n.endTime}}let KA=class{constructor(e,t,i,s,r,a){he(this,"currentAttempt"),he(this,"_failedAttempts",new qA),he(this,"finalData"),he(this,"bytes",[]),he(this,"_loadedBytes",0),he(this,"_totalBytes"),he(this,"_status","not-started"),he(this,"progress"),he(this,"notReceivingBytesTimeout"),he(this,"_abortRequestCallback"),he(this,"_logger"),he(this,"_isHandledByProcessQueue",!1),he(this,"onSegmentError"),he(this,"onSegmentAbort"),he(this,"onSegmentStart"),he(this,"onSegmentLoaded"),he(this,"abortOnTimeout",()=>{var h;if(this.throwErrorIfNotLoadingStatus(),!this.currentAttempt)return;this.setStatus("failed");const f=new hi("bytes-receiving-timeout");(h=this._abortRequestCallback)==null||h.call(this,f),this.logger(`${this.downloadSource} ${this.segment.externalId} failed ${f.type}`),this._failedAttempts.add({...this.currentAttempt,error:f}),this.onSegmentError({segment:Ja(this.segment),error:f,downloadSource:this.currentAttempt.downloadSource,peerId:this.currentAttempt.downloadSource==="p2p"?this.currentAttempt.peerId:void 0,streamType:this.segment.stream.type}),this.notReceivingBytesTimeout.clear(),this.manageBandwidthCalculatorsState("stop"),this.requestProcessQueueCallback()}),he(this,"abortOnError",h=>{this.throwErrorIfNotLoadingStatus(),this.currentAttempt&&(this.setStatus("failed"),this.logger(`${this.downloadSource} ${this.segment.externalId} failed ${h.type}`),this._failedAttempts.add({...this.currentAttempt,error:h}),this.onSegmentError({segment:Ja(this.segment),error:h,downloadSource:this.currentAttempt.downloadSource,peerId:this.currentAttempt.downloadSource==="p2p"?this.currentAttempt.peerId:void 0,streamType:this.segment.stream.type}),this.notReceivingBytesTimeout.clear(),this.manageBandwidthCalculatorsState("stop"),this.requestProcessQueueCallback())}),he(this,"completeOnSuccess",()=>{this.throwErrorIfNotLoadingStatus(),this.currentAttempt&&(this.manageBandwidthCalculatorsState("stop"),this.notReceivingBytesTimeout.clear(),this.setStatus("succeed"),this._totalBytes=this._loadedBytes,this.onSegmentLoaded({segmentUrl:this.segment.url,bytesLength:this.data.byteLength,downloadSource:this.currentAttempt.downloadSource,peerId:this.currentAttempt.downloadSource==="p2p"?this.currentAttempt.peerId:void 0,streamType:this.segment.stream.type}),this.logger(`${this.currentAttempt.downloadSource} ${this.segment.externalId} succeed`),this.requestProcessQueueCallback())}),he(this,"addLoadedChunk",h=>{if(this.throwErrorIfNotLoadingStatus(),!this.currentAttempt||!this.progress)return;this.notReceivingBytesTimeout.restart();const{byteLength:f}=h,{all:p,http:m}=this.bandwidthCalculators;p.addBytes(f),this.currentAttempt.downloadSource==="http"&&m.addBytes(f),this.bytes.push(h),this.progress.lastLoadedChunkTimestamp=performance.now(),this.progress.loadedBytes+=f,this._loadedBytes+=f}),he(this,"firstBytesReceived",()=>{this.throwErrorIfNotLoadingStatus(),this.notReceivingBytesTimeout.restart()}),this.segment=e,this.requestProcessQueueCallback=t,this.bandwidthCalculators=i,this.playback=s,this.playbackConfig=r,this.onSegmentError=a.getEventDispatcher("onSegmentError"),this.onSegmentAbort=a.getEventDispatcher("onSegmentAbort"),this.onSegmentStart=a.getEventDispatcher("onSegmentStart"),this.onSegmentLoaded=a.getEventDispatcher("onSegmentLoaded");const{byteRange:l}=this.segment;if(l){const{end:h,start:f}=l;this._totalBytes=h-f+1}this.notReceivingBytesTimeout=new WA(this.abortOnTimeout);const{type:c}=this.segment.stream;this._logger=zi(`p2pml-core:request-${c}`)}clearLoadedBytes(){this._loadedBytes=0,this.bytes=[],this._totalBytes=void 0,this.finalData=void 0}get status(){return this._status}setStatus(e){this._status=e,this._isHandledByProcessQueue=!1}get downloadSource(){var e;return(e=this.currentAttempt)==null?void 0:e.downloadSource}get loadedBytes(){return this._loadedBytes}get totalBytes(){return this._totalBytes}get data(){return this.finalData||(this.finalData=Fv(this.bytes)),this.finalData}get failedAttempts(){return this._failedAttempts}get isHandledByProcessQueue(){return this._isHandledByProcessQueue}markHandledByProcessQueue(){this._isHandledByProcessQueue=!0}setTotalBytes(e){if(this._totalBytes!==void 0)throw new Error("Request total bytes value is already set");this._totalBytes=e}start(e,t){if(this._status==="succeed")throw new Error(`Request ${this.segment.externalId} has been already succeed.`);if(this._status==="loading")throw new Error(`Request ${this.segment.externalId} has been already started.`);this.setStatus("loading"),this.currentAttempt={...e},this.progress={startFromByte:this._loadedBytes,loadedBytes:0,startTimestamp:performance.now()},this.manageBandwidthCalculatorsState("start");const{notReceivingBytesTimeoutMs:i,abort:s}=t;return this._abortRequestCallback=s,i!==void 0&&this.notReceivingBytesTimeout.start(i),this.logger(`${e.downloadSource} ${this.segment.externalId} started`),this.onSegmentStart({segment:Ja(this.segment),downloadSource:e.downloadSource,peerId:e.downloadSource==="p2p"?e.peerId:void 0}),{firstBytesReceived:this.firstBytesReceived,addLoadedChunk:this.addLoadedChunk,completeOnSuccess:this.completeOnSuccess,abortOnError:this.abortOnError}}abortFromProcessQueue(){var e,t,i,s;this.throwErrorIfNotLoadingStatus(),this.setStatus("aborted"),this.logger(`${(e=this.currentAttempt)==null?void 0:e.downloadSource} ${this.segment.externalId} aborted`),(t=this._abortRequestCallback)==null||t.call(this,new hi("abort")),this.onSegmentAbort({segment:Ja(this.segment),downloadSource:(i=this.currentAttempt)==null?void 0:i.downloadSource,peerId:((s=this.currentAttempt)==null?void 0:s.downloadSource)==="p2p"?this.currentAttempt.peerId:void 0,streamType:this.segment.stream.type}),this._abortRequestCallback=void 0,this.manageBandwidthCalculatorsState("stop"),this.notReceivingBytesTimeout.clear()}throwErrorIfNotLoadingStatus(){if(this._status!=="loading")throw new Error(`Request has been already ${this.status}.`)}logger(e){var t;this._logger.color=((t=this.currentAttempt)==null?void 0:t.downloadSource)==="http"?"green":"red",this._logger(e),this._logger.color=""}manageBandwidthCalculatorsState(e){var t;const{all:i,http:s}=this.bandwidthCalculators,r=e==="start"?"startLoading":"stopLoading";((t=this.currentAttempt)==null?void 0:t.downloadSource)==="http"&&s[r](),i[r]()}};class qA{constructor(){he(this,"attempts",[])}add(e){this.attempts.push(e)}get httpAttemptsCount(){return this.attempts.reduce((e,t)=>t.downloadSource==="http"?e+1:e,0)}get lastAttempt(){return this.attempts[this.attempts.length-1]}clear(){this.attempts=[]}}class WA{constructor(e){he(this,"timeoutId"),he(this,"ms"),this.action=e}start(e){if(this.timeoutId)throw new Error("Timeout is already started.");this.ms=e,this.timeoutId=window.setTimeout(this.action,this.ms)}restart(e){this.timeoutId&&clearTimeout(this.timeoutId),e&&(this.ms=e),this.ms&&(this.timeoutId=window.setTimeout(this.action,this.ms))}clear(){clearTimeout(this.timeoutId),this.timeoutId=void 0}}class zA{constructor(e,t,i,s,r){he(this,"requests",new Map),this.requestProcessQueueCallback=e,this.bandwidthCalculators=t,this.playback=i,this.config=s,this.eventTarget=r}get executingHttpCount(){let e=0;for(const t of this.httpRequests())t.status==="loading"&&e++;return e}get executingP2PCount(){let e=0;for(const t of this.p2pRequests())t.status==="loading"&&e++;return e}get(e){return this.requests.get(e)}getOrCreateRequest(e){let t=this.requests.get(e);return t||(t=new KA(e,this.requestProcessQueueCallback,this.bandwidthCalculators,this.playback,this.config,this.eventTarget),this.requests.set(e,t)),t}remove(e){this.requests.delete(e.segment)}items(){return this.requests.values()}*httpRequests(){for(const e of this.requests.values())e.downloadSource==="http"&&(yield e)}*p2pRequests(){for(const e of this.requests.values())e.downloadSource==="p2p"&&(yield e)}destroy(){for(const e of this.requests.values())e.status==="loading"&&e.abortFromProcessQueue();this.requests.clear()}}class YA{constructor(e,t){he(this,"_status","pending"),he(this,"_shouldBeStartedImmediately",!1),this.segment=e,this.engineCallbacks=t}get status(){return this._status}get shouldBeStartedImmediately(){return this._shouldBeStartedImmediately}resolve(e,t){this._status==="pending"&&(this._status="succeed",this.engineCallbacks.onSuccess({data:e,bandwidth:t}))}reject(){this._status==="pending"&&(this._status="failed",this.engineCallbacks.onError(new Mo("failed")))}abort(){this._status==="pending"&&(this._status="aborted",this.engineCallbacks.onError(new Mo("aborted")))}markAsShouldBeStartedImmediately(){this._shouldBeStartedImmediately=!0}}function*zp(n,e,t,i,s){const{runtimeId:r,stream:a}=n,l=a.segments.get(r);if(!l)return;const c=a.segments.values();let h;do{const p=c.next();if(p.done)return;h=p.value}while(h!==l);const f=Gu(h,e,t,i,s);if(qu(f)){const p=c.next();if(p.done)return;const m=p.value,_=Gu(m,e,t,i,s);if(qu(_))return;f.isHighDemand=!0,yield{segment:h,statuses:f},yield{segment:m,statuses:_}}else yield{segment:h,statuses:f};for(const p of c){const m=Gu(p,e,t,i,s);if(qu(m))break;yield{segment:p,statuses:m}}}function qu(n){const{isHighDemand:e=!1,isHttpDownloadable:t=!1,isP2PDownloadable:i=!1}=n;return!e&&!t&&!i}const XA=6e4,Yp=1e3;class QA{constructor(e,t,i,s,r,a,l){he(this,"requests"),he(this,"engineRequest"),he(this,"p2pLoaders"),he(this,"playback"),he(this,"segmentAvgDuration"),he(this,"logger"),he(this,"storageCleanUpIntervalId"),he(this,"levelChangedTimestamp"),he(this,"lastQueueProcessingTimeStamp"),he(this,"randomHttpDownloadInterval"),he(this,"isProcessQueueMicrotaskCreated",!1),he(this,"requestProcessQueueMicrotask",(h=!0)=>{const f=performance.now();!h&&this.lastQueueProcessingTimeStamp!==void 0&&f-this.lastQueueProcessingTimeStamp<=1e3||this.isProcessQueueMicrotaskCreated||(this.isProcessQueueMicrotaskCreated=!0,queueMicrotask(()=>{try{this.processQueue(),this.lastQueueProcessingTimeStamp=f}finally{this.isProcessQueueMicrotaskCreated=!1}}))}),this.streamManifestUrl=e,this.lastRequestedSegment=t,this.streamDetails=i,this.config=s,this.bandwidthCalculators=r,this.segmentStorage=a,this.eventTarget=l;const c=this.lastRequestedSegment.stream;this.playback={position:this.lastRequestedSegment.startTime,rate:1},this.segmentAvgDuration=HA(c),this.requests=new zA(this.requestProcessQueueMicrotask,this.bandwidthCalculators,this.playback,this.config,this.eventTarget),this.p2pLoaders=new GA(this.streamManifestUrl,this.lastRequestedSegment.stream,this.requests,this.segmentStorage,this.config,this.eventTarget,this.requestProcessQueueMicrotask),this.logger=zi(`p2pml-core:hybrid-loader-${c.type}`),this.logger.color="coral",this.setIntervalLoading()}setIntervalLoading(){const e=this.p2pLoaders.currentLoader.connectedPeerCount,t=Math.random()*Yp*e+Yp;this.randomHttpDownloadInterval=window.setTimeout(()=>{this.loadRandomThroughHttp(),this.setIntervalLoading()},t)}async loadSegment(e,t){var i;this.logger(`requests: ${Vp(e)}`);const{stream:s}=e;s!==this.lastRequestedSegment.stream&&(this.logger(`stream changed to ${Ms(s)}`),this.p2pLoaders.changeCurrentLoader(s)),this.lastRequestedSegment=e;const r=this.config.swarmId??this.streamManifestUrl,a=as(r,s);this.segmentStorage.onSegmentRequested(r,a,e.externalId,e.startTime,e.endTime,s.type,this.streamDetails.isLive);const l=new YA(e,t);try{if(this.segmentStorage.hasSegment(r,a,e.externalId)){const h=await this.segmentStorage.getSegmentData(r,a,e.externalId);if(h){const{queueDownloadRatio:f}=this.generateQueue();l.resolve(h,this.getBandwidth(f));return}}(i=this.engineRequest)==null||i.abort(),this.engineRequest=l}catch{l.reject()}finally{this.requestProcessQueueMicrotask()}}processRequests(e,t){var i;const{stream:s}=this.lastRequestedSegment,{httpErrorRetries:r}=this.config,a=performance.now();for(const l of this.requests.items()){const{downloadSource:c,status:h,segment:f,isHandledByProcessQueue:p}=l,m=((i=this.engineRequest)==null?void 0:i.segment)===f?this.engineRequest:void 0;switch(h){case"loading":!e.has(f.runtimeId)&&!m&&(l.abortFromProcessQueue(),this.requests.remove(l));break;case"succeed":{if(!c)break;c==="http"&&this.p2pLoaders.currentLoader.broadcastAnnouncement(),m&&(m.resolve(l.data,this.getBandwidth(t)),this.engineRequest=void 0),this.requests.remove(l);const E=this.config.swarmId??this.streamManifestUrl,C=as(E,s);this.segmentStorage.storeSegment(E,C,f.externalId,l.data,f.startTime,f.endTime,f.stream.type,this.streamDetails.isLive);break}case"failed":c==="http"&&!p&&this.p2pLoaders.currentLoader.broadcastAnnouncement(),!m&&!s.segments.has(l.segment.runtimeId)&&this.requests.remove(l),l.failedAttempts.httpAttemptsCount>=r&&m&&(this.engineRequest=void 0,m.reject());break;case"not-started":this.requests.remove(l);break;case"aborted":this.requests.remove(l);break}l.markHandledByProcessQueue();const{lastAttempt:_}=l.failedAttempts;_&&a-_.error.timestamp>XA&&l.failedAttempts.clear()}}processQueue(){var e;const{queue:t,queueSegmentIds:i,queueDownloadRatio:s}=this.generateQueue();this.processRequests(i,s);const{simultaneousHttpDownloads:r,simultaneousP2PDownloads:a,httpErrorRetries:l}=this.config;if((e=this.engineRequest)!=null&&e.shouldBeStartedImmediately&&this.engineRequest.status==="pending"&&this.requests.executingHttpCount<r){const{segment:c}=this.engineRequest,h=this.requests.get(c);(!h||h.status==="not-started"||h.status==="failed"&&h.failedAttempts.httpAttemptsCount<this.config.httpErrorRetries)&&this.loadThroughHttp(c)}for(const c of t){const{statuses:h,segment:f}=c,p=this.requests.get(f);if(h.isHighDemand){if(p?.downloadSource==="http"&&p.status==="loading"||p?.downloadSource==="http"&&p.status==="failed"&&p.failedAttempts.httpAttemptsCount>=l)continue;const m=p?.status==="loading"&&p.downloadSource==="p2p";if(this.requests.executingHttpCount<r){m&&p.abortFromProcessQueue(),this.loadThroughHttp(f);continue}if(this.abortLastHttpLoadingInQueueAfterItem(t,f)&&this.requests.executingHttpCount<r){m&&p.abortFromProcessQueue(),this.loadThroughHttp(f);continue}if(m)continue;if(this.requests.executingP2PCount<a){this.loadThroughP2P(f);continue}if(this.abortLastP2PLoadingInQueueAfterItem(t,f)&&this.requests.executingP2PCount<a){this.loadThroughP2P(f);continue}}else if(h.isP2PDownloadable){if(p?.status==="loading")continue;this.requests.executingP2PCount<a?this.loadThroughP2P(f):this.p2pLoaders.currentLoader.isSegmentLoadedBySomeone(f)&&this.abortLastP2PLoadingInQueueAfterItem(t,f)&&this.requests.executingP2PCount<a&&this.loadThroughP2P(f)}}}abortSegmentRequest(e){var t;((t=this.engineRequest)==null?void 0:t.segment.runtimeId)===e&&(this.engineRequest.abort(),this.logger("abort: ",Vp(this.engineRequest.segment)),this.engineRequest=void 0,this.requestProcessQueueMicrotask())}loadThroughHttp(e){const t=this.requests.getOrCreateRequest(e);new uw(t,this.config,this.eventTarget),this.p2pLoaders.currentLoader.broadcastAnnouncement()}loadThroughP2P(e){this.p2pLoaders.currentLoader.downloadSegment(e)}loadRandomThroughHttp(){const e=this.getAvailableStorageCapacityPercent();if(e<=10)return;const{simultaneousHttpDownloads:t,httpErrorRetries:i}=this.config,s=this.p2pLoaders.currentLoader;if(this.requests.executingHttpCount>=t||!s.connectedPeerCount)return;const r=[];for(const{segment:p,statuses:m}of zp(this.lastRequestedSegment,this.playback,this.config,this.p2pLoaders.currentLoader,e)){const _=this.config.swarmId??this.streamManifestUrl,E=as(_,p.stream);if(!m.isHttpDownloadable||m.isP2PDownloadable||this.segmentStorage.hasSegment(_,E,p.externalId))continue;const C=this.requests.get(p);C&&(C.status==="loading"||C.status==="succeed"||C.failedAttempts.httpAttemptsCount>=i)||r.push(p)}if(!r.length||t-this.requests.executingHttpCount===0)return;const l=s.connectedPeerCount+1,c=Math.min(r.length,t*l),h=gA(Array.from({length:c},(p,m)=>m));let f=c/l;for(const p of h){if(this.requests.executingHttpCount>=t)break;if(f>=1||Math.random()<=f){const m=r[p];this.loadThroughHttp(m)}if(f--,f<=0)break}}abortLastHttpLoadingInQueueAfterItem(e,t){for(const{segment:i}of Kp(e)){if(i===t)break;const s=this.requests.get(i);if(s?.downloadSource==="http"&&s.status==="loading")return s.abortFromProcessQueue(),!0}return!1}abortLastP2PLoadingInQueueAfterItem(e,t){for(const{segment:i}of Kp(e)){if(i===t)break;const s=this.requests.get(i);if(s?.downloadSource==="p2p"&&s.status==="loading")return s.abortFromProcessQueue(),!0}return!1}getAvailableStorageCapacityPercent(){const{totalCapacity:e,usedCapacity:t}=this.segmentStorage.getUsage();return 100-t/e*100}generateQueue(){var e;const t=[],i=new Set;let s=0,r=0;const a=this.getAvailableStorageCapacityPercent();for(const l of zp(this.lastRequestedSegment,this.playback,this.config,this.p2pLoaders.currentLoader,a)){s++;const{segment:c}=l,h=this.config.swarmId??this.streamManifestUrl,f=as(h,c.stream);if(this.segmentStorage.hasSegment(h,f,c.externalId)||((e=this.requests.get(c))==null?void 0:e.status)==="succeed"){r++;continue}t.push(l),i.add(c.runtimeId)}return{queue:t,queueSegmentIds:i,maxPossibleLength:s,alreadyLoadedCount:r,queueDownloadRatio:s!==0?r/s:0}}getBandwidth(e){const{http:t,all:i}=this.bandwidthCalculators,{activeLevelBitrate:s}=this.streamDetails;if(this.streamDetails.activeLevelBitrate===0)return i.getBandwidthLoadingOnly(3);const r=Math.max(i.getBandwidth(30,this.levelChangedTimestamp),i.getBandwidth(60,this.levelChangedTimestamp),i.getBandwidth(90,this.levelChangedTimestamp));if(e>=.8||r>=s*.9)return Math.max(i.getBandwidthLoadingOnly(1),i.getBandwidthLoadingOnly(3),i.getBandwidthLoadingOnly(5));const a=Math.max(t.getBandwidthLoadingOnly(1),t.getBandwidthLoadingOnly(3),t.getBandwidthLoadingOnly(5));return Math.max(r,a)}notifyLevelChanged(){this.levelChangedTimestamp=performance.now()}sendBroadcastAnnouncement(e=!1){this.p2pLoaders.currentLoader.broadcastAnnouncement(e)}updatePlayback(e,t){var i;const s=this.playback.rate!==t,r=this.playback.position!==e;if(!s&&!r)return;const a=Math.abs(e-this.playback.position)/this.segmentAvgDuration>.5;r&&(this.playback.position=e),s&&t!==0&&(this.playback.rate=t),a&&(this.logger("position significantly changed"),(i=this.engineRequest)==null||i.markAsShouldBeStartedImmediately()),this.segmentStorage.onPlaybackUpdated(e,t),this.requestProcessQueueMicrotask(a)}updateStream(e){e===this.lastRequestedSegment.stream&&(this.logger(`update stream: ${Ms(e)}`),this.requestProcessQueueMicrotask())}destroy(){var e;clearInterval(this.storageCleanUpIntervalId),clearInterval(this.randomHttpDownloadInterval),this.storageCleanUpIntervalId=void 0,(e=this.engineRequest)==null||e.abort(),this.requests.destroy(),this.p2pLoaders.destroy()}}class Xp{constructor(e=2e4){he(this,"loadingsCount",0),he(this,"bytes",[]),he(this,"loadingOnlyTimestamps",[]),he(this,"timestamps",[]),he(this,"noLoadingsTime",0),he(this,"loadingsStoppedAt",0),this.clearThresholdMs=e}addBytes(e,t=performance.now()){this.bytes.push(e),this.loadingOnlyTimestamps.push(t-this.noLoadingsTime),this.timestamps.push(t)}startLoading(e=performance.now()){this.clearStale(),this.loadingsCount===0&&this.loadingsStoppedAt!==0&&(this.noLoadingsTime+=e-this.loadingsStoppedAt),this.loadingsCount++}stopLoading(e=performance.now()){this.loadingsCount>0&&(this.loadingsCount--,this.loadingsCount===0&&(this.loadingsStoppedAt=e))}getBandwidthLoadingOnly(e,t=Number.NEGATIVE_INFINITY){if(!this.loadingOnlyTimestamps.length)return 0;const i=e*1e3,s=this.loadingOnlyTimestamps[this.loadingOnlyTimestamps.length-1];let r=s;const a=s-i;let l=0;for(let c=this.bytes.length-1;c>=0;c--){const h=this.loadingOnlyTimestamps[c];if(h<a||this.timestamps[c]<t)break;r=h,l+=this.bytes[c]}return l*8e3/(s-r)}getBandwidth(e,t=Number.NEGATIVE_INFINITY,i=performance.now()){if(!this.timestamps.length)return 0;const s=e*1e3,r=i-s;let a=i,l=0;for(let c=this.bytes.length-1;c>=0;c--){const h=this.timestamps[c];if(h<r||h<t)break;a=h,l+=this.bytes[c]}return l*8e3/(i-a)}clearStale(){if(!this.loadingOnlyTimestamps.length)return;const e=this.loadingOnlyTimestamps[this.loadingOnlyTimestamps.length-1]-this.clearThresholdMs;let t=0;for(const i of this.loadingOnlyTimestamps){if(i>e)break;t++}this.bytes.splice(0,t),this.loadingOnlyTimestamps.splice(0,t),this.timestamps.splice(0,t)}}const Za=(n,e)=>`${n}|${e}`,JA=n=>/Android/i.test(n),ZA=n=>/iPad|iPhone/i.test(n),eI=n=>/Android/i.test(n)&&!/Chrome|Firefox/i.test(n),eo=1048576;class tI{constructor(){he(this,"userAgent",navigator.userAgent),he(this,"segmentMemoryStorageLimit",4*1024),he(this,"currentStorageUsage",0),he(this,"cache",new Map),he(this,"logger"),he(this,"coreConfig"),he(this,"mainStreamConfig"),he(this,"secondaryStreamConfig"),he(this,"currentPlayback"),he(this,"lastRequestedSegment"),he(this,"segmentChangeCallback"),this.logger=zi("p2pml-core:segment-memory-storage"),this.logger.color="RebeccaPurple"}async initialize(e,t,i){this.coreConfig=e,this.mainStreamConfig=t,this.secondaryStreamConfig=i,this.setMemoryStorageLimit(),this.logger("initialized")}onPlaybackUpdated(e,t){this.currentPlayback={position:e,rate:t}}onSegmentRequested(e,t,i,s,r,a,l){this.lastRequestedSegment={streamId:t,segmentId:i,startTime:s,endTime:r,swarmId:e,streamType:a,isLiveStream:l}}async storeSegment(e,t,i,s,r,a,l,c){this.clear(c,s.byteLength);const h=Za(t,i);if(this.cache.set(h,{data:s,segmentId:i,streamId:t,startTime:r,endTime:a,streamType:l}),this.increaseStorageUsage(s.byteLength),this.logger(`add segment: ${i} to ${t}`),!this.segmentChangeCallback)throw new Error("dispatchStorageUpdatedEvent is not set");this.segmentChangeCallback(t)}async getSegmentData(e,t,i){const s=Za(t,i),r=this.cache.get(s);if(r!==void 0)return r.data}getUsage(){if(!this.lastRequestedSegment||!this.currentPlayback)return{totalCapacity:this.segmentMemoryStorageLimit,usedCapacity:this.currentStorageUsage};const e=this.currentPlayback.position;let t=0;for(const{endTime:i,data:s}of this.cache.values())e>i||(t+=s.byteLength);return{totalCapacity:this.segmentMemoryStorageLimit,usedCapacity:t/eo}}hasSegment(e,t,i){const s=Za(t,i);return this.cache.get(s)!==void 0}getStoredSegmentIds(e,t){const i=[];for(const{segmentId:s,streamId:r}of this.cache.values())r===t&&i.push(s);return i}clear(e,t){if(!this.currentPlayback||!this.mainStreamConfig||!this.secondaryStreamConfig||!this.coreConfig||!this.isMemoryLimitReached(t)&&!e)return;const s=new Set,r=Array.from(this.cache.values()).sort((a,l)=>a.startTime-l.startTime);for(const a of r){const{streamId:l,segmentId:c,data:h}=a,f=Za(l,c);if(this.shouldRemoveSegment(a,e,this.currentPlayback.position)&&(this.cache.delete(f),s.add(l),this.decreaseStorageUsage(h.byteLength),this.logger(`Removed segment ${c} from stream ${l}`),!this.isMemoryLimitReached(t)&&!e))break}this.sendUpdatesToAffectedStreams(s)}isMemoryLimitReached(e){return this.currentStorageUsage+e/eo>this.segmentMemoryStorageLimit}setSegmentChangeCallback(e){this.segmentChangeCallback=e}sendUpdatesToAffectedStreams(e){e.size!==0&&e.forEach(t=>{if(!this.segmentChangeCallback)throw new Error("dispatchStorageUpdatedEvent is not set");this.segmentChangeCallback(t)})}shouldRemoveSegment(e,t,i){const{endTime:s,streamType:r}=e,a=this.getStreamTimeWindow(r,"highDemandTimeWindow");return i<=s?!1:t?i>a+s:!0}increaseStorageUsage(e){this.currentStorageUsage+=e/eo}decreaseStorageUsage(e){this.currentStorageUsage-=e/eo}setMemoryStorageLimit(){var e;if((e=this.coreConfig)!=null&&e.segmentMemoryStorageLimit){this.segmentMemoryStorageLimit=this.coreConfig.segmentMemoryStorageLimit;return}eI(this.userAgent)||ZA(this.userAgent)?this.segmentMemoryStorageLimit=1024:JA(this.userAgent)&&(this.segmentMemoryStorageLimit=2*1024)}getStreamTimeWindow(e,t){const i=e==="main"?this.mainStreamConfig:this.secondaryStreamConfig;return i?.[t]??0}destroy(){this.cache.clear()}}class iI{constructor(){he(this,"events",new Map)}dispatchEvent(e,...t){const i=this.events.get(e);if(i)for(const s of i)s(...t)}getEventDispatcher(e){let t=this.events.get(e);t||(t=[],this.events.set(e,t));const i=t;return(...s)=>{for(const r of i)r(...s)}}addEventListener(e,t){const i=this.events.get(e);i?i.push(t):this.events.set(e,[t])}removeEventListener(e,t){const i=this.events.get(e);if(i){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}}const Ec=class _o{constructor(e){he(this,"eventTarget",new iI),he(this,"manifestResponseUrl"),he(this,"streams",new Map),he(this,"mainStreamConfig"),he(this,"secondaryStreamConfig"),he(this,"commonCoreConfig"),he(this,"bandwidthCalculators",{all:new Xp,http:new Xp}),he(this,"segmentStorage"),he(this,"mainStreamLoader"),he(this,"secondaryStreamLoader"),he(this,"streamDetails",{isLive:!1,activeLevelBitrate:0});const t=pA(e??{});this.commonCoreConfig=Vu({defaultConfig:_o.DEFAULT_COMMON_CORE_CONFIG,baseConfig:t}),this.mainStreamConfig=Vu({defaultConfig:_o.DEFAULT_STREAM_CONFIG,baseConfig:t,specificStreamConfig:t.mainStream}),this.secondaryStreamConfig=Vu({defaultConfig:_o.DEFAULT_STREAM_CONFIG,baseConfig:t,specificStreamConfig:t.secondaryStream})}getConfig(){return{...Rs(this.commonCoreConfig),mainStream:Rs(this.mainStreamConfig),secondaryStream:Rs(this.secondaryStreamConfig)}}applyDynamicConfig(e){const{mainStream:t,secondaryStream:i}=e,s=Rs(this.mainStreamConfig),r=Rs(this.secondaryStreamConfig);this.overrideAllConfigs(e,t,i),this.processSpecificDynamicConfigParams(s,e,"main"),this.processSpecificDynamicConfigParams(r,e,"secondary")}processSpecificDynamicConfigParams(e,t,i){const s=this.getUpdatedStreamProperty("isP2PDisabled",t,i);s&&e.isP2PDisabled!==s&&this.destroyStreamLoader(i);const r=this.getUpdatedStreamProperty("isP2PUploadDisabled",t,i);if(r!==void 0&&e.isP2PUploadDisabled!==r){const a=i==="main"?this.mainStreamLoader:this.secondaryStreamLoader;a?.sendBroadcastAnnouncement(r)}}getUpdatedStreamProperty(e,t,i){const s=i==="main"?t.mainStream:t.secondaryStream;return s?.[e]??t[e]}addEventListener(e,t){this.eventTarget.addEventListener(e,t)}removeEventListener(e,t){this.eventTarget.removeEventListener(e,t)}setManifestResponseUrl(e){this.manifestResponseUrl=e.split("?")[0]}hasSegment(e){return!!Wp(this.streams,e)}getStream(e){return this.streams.get(e)}addStreamIfNoneExists(e){this.streams.has(e.runtimeId)||this.streams.set(e.runtimeId,{...e,segments:new Map})}updateStream(e,t,i){var s,r;const a=this.streams.get(e);if(a){if(t)for(const l of t)a.segments.has(l.runtimeId)||a.segments.set(l.runtimeId,{...l,stream:a});if(i)for(const l of i)a.segments.delete(l);(s=this.mainStreamLoader)==null||s.updateStream(a),(r=this.secondaryStreamLoader)==null||r.updateStream(a)}}async loadSegment(e,t){if(!this.manifestResponseUrl)throw new Error("Manifest response url is not defined");await this.initializeSegmentStorage();const i=this.identifySegment(e);this.getStreamHybridLoader(i).loadSegment(i,t)}abortSegmentLoading(e){var t,i;(t=this.mainStreamLoader)==null||t.abortSegmentRequest(e),(i=this.secondaryStreamLoader)==null||i.abortSegmentRequest(e)}updatePlayback(e,t){var i,s;(i=this.mainStreamLoader)==null||i.updatePlayback(e,t),(s=this.secondaryStreamLoader)==null||s.updatePlayback(e,t)}setActiveLevelBitrate(e){var t,i;e!==this.streamDetails.activeLevelBitrate&&(this.streamDetails.activeLevelBitrate=e,(t=this.mainStreamLoader)==null||t.notifyLevelChanged(),(i=this.secondaryStreamLoader)==null||i.notifyLevelChanged())}setIsLive(e){this.streamDetails.isLive=e}isSegmentLoadable(e){try{const t=this.identifySegment(e);return!(t.stream.type==="main"&&this.mainStreamConfig.isP2PDisabled||t.stream.type==="secondary"&&this.secondaryStreamConfig.isP2PDisabled)}catch{return!1}}destroy(){var e,t,i;this.streams.clear(),(e=this.mainStreamLoader)==null||e.destroy(),(t=this.secondaryStreamLoader)==null||t.destroy(),(i=this.segmentStorage)==null||i.destroy(),this.mainStreamLoader=void 0,this.secondaryStreamLoader=void 0,this.segmentStorage=void 0,this.manifestResponseUrl=void 0,this.streamDetails={isLive:!1,activeLevelBitrate:0},Kv.clearPeerIdCache()}async initializeSegmentStorage(){if(this.segmentStorage)return;const{isLive:e}=this.streamDetails,t=this.commonCoreConfig.customSegmentStorageFactory;if(t&&typeof t!="function")throw new Error("Storage configuration is invalid");const i=t?t(e):new tI;await i.initialize(this.commonCoreConfig,this.mainStreamConfig,this.secondaryStreamConfig),this.segmentStorage=i}identifySegment(e){if(!this.manifestResponseUrl)throw new Error("Manifest response url is undefined");const t=Wp(this.streams,e);if(!t)throw new Error(`Not found segment with id: ${e}`);return t}overrideAllConfigs(e,t,i){Tn(this.commonCoreConfig,e),Tn(this.mainStreamConfig,e),Tn(this.secondaryStreamConfig,e),t&&Tn(this.mainStreamConfig,t),i&&Tn(this.secondaryStreamConfig,i)}destroyStreamLoader(e){var t,i;e==="main"?((t=this.mainStreamLoader)==null||t.destroy(),this.mainStreamLoader=void 0):((i=this.secondaryStreamLoader)==null||i.destroy(),this.secondaryStreamLoader=void 0)}getStreamHybridLoader(e){return e.stream.type==="main"?(this.mainStreamLoader??(this.mainStreamLoader=this.createNewHybridLoader(e)),this.mainStreamLoader):(this.secondaryStreamLoader??(this.secondaryStreamLoader=this.createNewHybridLoader(e)),this.secondaryStreamLoader)}createNewHybridLoader(e){if(!this.manifestResponseUrl)throw new Error("Manifest response url is not defined");if(!this.segmentStorage)throw new Error("Segment storage is not initialized");const t=e.stream.type==="main"?this.mainStreamConfig:this.secondaryStreamConfig;return new QA(this.manifestResponseUrl,e,this.streamDetails,t,this.bandwidthCalculators,this.segmentStorage,this.eventTarget)}};he(Ec,"DEFAULT_COMMON_CORE_CONFIG",{segmentMemoryStorageLimit:void 0,customSegmentStorageFactory:void 0});he(Ec,"DEFAULT_STREAM_CONFIG",{isP2PUploadDisabled:!1,isP2PDisabled:!1,simultaneousHttpDownloads:2,simultaneousP2PDownloads:3,highDemandTimeWindow:15,httpDownloadTimeWindow:3e3,p2pDownloadTimeWindow:6e3,webRtcMaxMessageSize:64*1024-1,p2pNotReceivingBytesTimeoutMs:2e3,p2pInactiveLoaderDestroyTimeoutMs:30*1e3,httpNotReceivingBytesTimeoutMs:3e3,httpErrorRetries:3,p2pErrorRetries:3,trackerClientVersionPrefix:nA,announceTrackers:["wss://tracker.novage.com.ua","wss://tracker.webtorrent.dev","wss://tracker.openwebtorrent.com"],rtcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"}]},validateP2PSegment:void 0,validateHTTPSegment:void 0,httpRequestSetup:void 0,swarmId:void 0});let sI=Ec;const rI=Lv.debug;var Qs=function(n,e,t,i,s){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t},ct=function(n,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(n):i?i.value:e.get(n)},Pn,Nr,Eo,es,tr,ks,Ps,qv,$h;const nI=10;class aI{constructor(e,t){Pn.add(this),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Nr.set(this,void 0),Eo.set(this,void 0),es.set(this,void 0),tr.set(this,void 0),ks.set(this,void 0),Ps.set(this,void 0),Qs(this,tr,t),Qs(this,Eo,()=>new e.loader(e)),this.stats={aborted:!1,chunkCount:0,loading:{start:0,first:0,end:0},buffering:{start:0,first:0,end:0},parsing:{start:0,end:0},total:1,loaded:1,bwEstimate:0,retry:0}}load(e,t,i){this.context=e,this.config=t,Qs(this,Nr,i);const{stats:s}=this,{rangeStart:r,rangeEnd:a}=e,l=Sv(r,a!==void 0?a-1:void 0);Qs(this,Ps,bv(e.url,l));const c=ct(this,tr,"f").isSegmentLoadable(ct(this,Ps,"f"));if(!ct(this,tr,"f").hasSegment(ct(this,Ps,"f"))||!c){Qs(this,es,ct(this,Eo,"f").call(this)),ct(this,es,"f").stats=this.stats,ct(this,es,"f").load(e,t,i);return}const h=p=>{Qs(this,ks,p);const m=ct(this,ks,"f").data.byteLength;s.loading=oI(ct(this,ks,"f").bandwidth,m,performance.now()),s.total=m,s.loaded=m,i.onProgress&&i.onProgress(this.stats,e,ct(this,ks,"f").data,void 0),i.onSuccess({data:ct(this,ks,"f").data,url:e.url},this.stats,e,void 0)},f=p=>{p instanceof Mo&&p.type==="aborted"&&this.stats.aborted||ct(this,Pn,"m",qv).call(this,p)};ct(this,tr,"f").loadSegment(ct(this,Ps,"f"),{onSuccess:h,onError:f})}abort(){var e,t;ct(this,es,"f")?ct(this,es,"f").abort():(ct(this,Pn,"m",$h).call(this),(t=(e=ct(this,Nr,"f"))==null?void 0:e.onAbort)==null||t.call(e,this.stats,this.context,{}))}destroy(){ct(this,es,"f")?ct(this,es,"f").destroy():(this.stats.aborted||ct(this,Pn,"m",$h).call(this),Qs(this,Nr,null),this.config=null)}}Nr=new WeakMap,Eo=new WeakMap,es=new WeakMap,tr=new WeakMap,ks=new WeakMap,Ps=new WeakMap,Pn=new WeakSet,qv=function(e){var t;const i={code:0,text:""};(e instanceof Mo&&e.type==="failed"||e instanceof Error)&&(i.text=e.message),(t=ct(this,Nr,"f"))==null||t.onError(i,this.context,null,this.stats)},$h=function(){!ct(this,ks,"f")&&ct(this,Ps,"f")&&(this.stats.aborted=!0,ct(this,tr,"f").abortSegmentLoading(ct(this,Ps,"f")))};function oI(n,e,t){const i=e*8e3/n,s=t-i;return{start:s-nI,first:s,end:t}}var lI=function(n,e,t,i,s){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t},_n=function(n,e,t,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(n):i?i.value:e.get(n)},ws;class uI{constructor(e){ws.set(this,void 0),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),lI(this,ws,new e.loader(e)),this.stats=_n(this,ws,"f").stats,this.context=_n(this,ws,"f").context}load(e,t,i){_n(this,ws,"f").load(e,t,i)}abort(){_n(this,ws,"f").abort()}destroy(){_n(this,ws,"f").destroy()}}ws=new WeakMap;class hI{constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.core=e}processMainManifest(e){const{levels:t,audioTracks:i}=e;for(const[s,r]of t.entries()){const{url:a}=r;this.core.addStreamIfNoneExists({runtimeId:Array.isArray(a)?a[0]:a,type:"main",index:s})}for(const[s,r]of i.entries()){const{url:a}=r;this.core.addStreamIfNoneExists({runtimeId:Array.isArray(a)?a[0]:a,type:"secondary",index:s})}}updatePlaylist(e){const{details:{url:t,fragments:i,live:s}}=e,r=this.core.getStream(t);if(!r)return;const a=new Set(r.segments.keys()),l=[];i.forEach((c,h)=>{const{url:f,byteRange:p,sn:m,start:_,end:E}=c;if(m==="initSegment")return;const[C,S]=p,I=Sv(C,S!==void 0?S-1:void 0),R=bv(f,I);a.delete(R),!r.segments.has(R)&&l.push({runtimeId:R,url:f,externalId:s?m:h,byteRange:I,startTime:_,endTime:E})}),!(!l.length&&!a.size)&&this.core.updateStream(t,l,a.values())}}var cI=function(n,e,t,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(n):i?i.value:e.get(n)},dI=function(n,e,t,i,s){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t};function fI(n){var e,t;return t=class extends n{get p2pEngine(){return cI(this,e,"f")}constructor(...s){var r;const a=s[0],{p2p:l,...c}=a??{},h=new Wv(l);super({...c,...h.getConfigForHlsJs()}),e.set(this,void 0),h.bindHls(this),dI(this,e,h),(r=l?.onHlsJsCreated)==null||r.call(l,this)}},e=new WeakMap,t}const pI=120;class Wv{static injectMixin(e){return fI(e)}constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"segmentManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hlsInstanceGetter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentHlsInstance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:rI("p2pml-hlsjs:engine")}),Object.defineProperty(this,"updateMediaElementEventHandlers",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var i;const s=(i=this.currentHlsInstance)==null?void 0:i.media;if(!s)return;const r=t==="register"?"addEventListener":"removeEventListener";s[r]("timeupdate",this.handlePlaybackUpdate),s[r]("seeking",this.handlePlaybackUpdate),s[r]("ratechange",this.handlePlaybackUpdate)}}),Object.defineProperty(this,"handleManifestLoaded",{enumerable:!0,configurable:!0,writable:!0,value:(t,i)=>{const s=i.networkDetails;s instanceof XMLHttpRequest?this.core.setManifestResponseUrl(s.responseURL):s instanceof Response&&this.core.setManifestResponseUrl(s.url),this.segmentManager.processMainManifest(i)}}),Object.defineProperty(this,"handleLevelSwitching",{enumerable:!0,configurable:!0,writable:!0,value:(t,i)=>{i.bitrate&&this.core.setActiveLevelBitrate(i.bitrate)}}),Object.defineProperty(this,"handleLevelUpdated",{enumerable:!0,configurable:!0,writable:!0,value:(t,i)=>{this.currentHlsInstance&&i.details.live&&i.details.fragments[0].type==="main"&&!this.currentHlsInstance.userConfig.liveSyncDuration&&!this.currentHlsInstance.userConfig.liveSyncDurationCount&&i.details.fragments.length>4&&this.updateLiveSyncDurationCount(i),this.core.setIsLive(i.details.live),this.segmentManager.updatePlaylist(i)}}),Object.defineProperty(this,"handleMediaAttached",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.updateMediaElementEventHandlers("register")}}),Object.defineProperty(this,"handleMediaDetached",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.updateMediaElementEventHandlers("unregister")}}),Object.defineProperty(this,"handlePlaybackUpdate",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const i=t.target;this.core.updatePlayback(i.currentTime,i.playbackRate)}}),Object.defineProperty(this,"destroyCore",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.core.destroy()}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.destroyCore(),this.updateHlsEventsHandlers("unregister"),this.updateMediaElementEventHandlers("unregister"),this.currentHlsInstance=void 0}}),this.core=new sI(e?.core),this.segmentManager=new hI(this.core)}addEventListener(e,t){this.core.addEventListener(e,t)}removeEventListener(e,t){this.core.removeEventListener(e,t)}getConfigForHlsJs(){return{fLoader:this.createFragmentLoaderClass(),pLoader:this.createPlaylistLoaderClass()}}getConfig(){return{core:this.core.getConfig()}}applyDynamicConfig(e){e.core&&this.core.applyDynamicConfig(e.core)}bindHls(e){this.hlsInstanceGetter=typeof e=="function"?e:()=>e}initHlsEvents(){var e;const t=(e=this.hlsInstanceGetter)==null?void 0:e.call(this);this.currentHlsInstance!==t&&(this.currentHlsInstance&&this.destroy(),this.currentHlsInstance=t,this.updateHlsEventsHandlers("register"),this.updateMediaElementEventHandlers("register"))}updateHlsEventsHandlers(e){const t=this.currentHlsInstance;if(!t)return;const i=e==="register"?"on":"off";t[i]("hlsManifestLoaded",this.handleManifestLoaded),t[i]("hlsLevelSwitching",this.handleLevelSwitching),t[i]("hlsLevelUpdated",this.handleLevelUpdated),t[i]("hlsAudioTrackLoaded",this.handleLevelUpdated),t[i]("hlsDestroying",this.destroy),t[i]("hlsMediaAttaching",this.destroyCore),t[i]("hlsManifestLoading",this.destroyCore),t[i]("hlsMediaDetached",this.handleMediaDetached),t[i]("hlsMediaAttached",this.handleMediaAttached)}updateLiveSyncDurationCount(e){const t=e.details.targetduration,i=Math.floor(pI/t),s=Math.min(e.details.fragments.length-1,i);this.currentHlsInstance&&this.currentHlsInstance.config.liveSyncDurationCount!==s&&(this.debug(`Setting liveSyncDurationCount to ${s}`),this.currentHlsInstance.config.liveSyncDurationCount=s)}createFragmentLoaderClass(){const{core:e}=this,t=this;return class extends aI{constructor(s){super(s,e)}static getEngine(){return t}}}createPlaylistLoaderClass(){const e=this;return class extends uI{constructor(i){super(i),e.initHlsEvents()}}}}const Qp=Wv.injectMixin(et);let Jp=!1;const gI=function(n){if(!et.isSupported()){ze.info("Hls.js is not supported in this browser.");return}const e=n.getTech("Html5");if(!e){ze.error('No "Html5" tech found in videojs');return}Jp||(Jp=!0,e.registerSourceHandler({canHandleSource:function(t){const i=/^application\/x-mpegURL|application\/vnd\.apple\.mpegurl$/i,s=/\.m3u8/i;return i.test(t.type)?"probably":s.test(t.src)?"maybe":""},handleSource:function(t,i){return i.hlsProvider&&i.hlsProvider.dispose(),i.hlsProvider=new Zp(n,t,i),i.hlsProvider}},0),n.Html5Hlsjs=Zp)},mI=X.getPlugin("plugin");class vI extends mI{constructor(e,t){super(e,t),t&&(e.srOptions_||(e.srOptions_={}),e.srOptions_.hlsjsConfig||(e.srOptions_.hlsjsConfig=t.hlsjsConfig),t.levelLabelHandler&&!e.srOptions_.levelLabelHandler&&(e.srOptions_.levelLabelHandler=t.levelLabelHandler),gI(X))}dispose(){this.player.srOptions_=void 0;const e=this.player.tech(!0);e.hlsProvider&&(e.hlsProvider.dispose(),e.hlsProvider=void 0),super.dispose()}}X.registerPlugin("hlsjs",vI);class Zp{constructor(e,t,i){Qe(this,"videoElement"),Qe(this,"errorCounts",{}),Qe(this,"player"),Qe(this,"tech"),Qe(this,"source"),Qe(this,"vjs"),Qe(this,"maxNetworkErrorRecovery",5),Qe(this,"hls"),Qe(this,"hlsjsConfig",null),Qe(this,"_duration",null),Qe(this,"metadata",null),Qe(this,"isLive",null),Qe(this,"dvrDuration",null),Qe(this,"edgeMargin",null),Qe(this,"liveEnded",!1),Qe(this,"handlers",{play:null,error:null}),Qe(this,"audioMode",!1),this.vjs=e,this.source=t,this.tech=i,this.tech.name_="Hlsjs",this.videoElement=i.el(),this.player=e(i.options_.playerId),this.handlers.error=s=>{let r;const a=(s.currentTarget||s.target).error;if(a){switch(ze.info(a),a.code){case a.MEDIA_ERR_ABORTED:r="You aborted the video playback";break;case a.MEDIA_ERR_DECODE:r="The video playback was aborted due to a corruption problem or because the video used features your browser did not support",this._handleMediaError(a);break;case a.MEDIA_ERR_NETWORK:r="A network error caused the video download to fail part-way";break;case a.MEDIA_ERR_SRC_NOT_SUPPORTED:r="The video could not be loaded, either because the server or network failed or because the format is not supported";break;default:r=a.message}ze.error(`MEDIA_ERROR: ${r}`)}},this.videoElement.addEventListener("error",this.handlers.error),this.initialize()}duration(){return this._duration===1/0?1/0:isNaN(this.videoElement.duration)?this._duration||0:this.videoElement.duration}seekable(){if(this.hls.media){if(!this.isLive)return this.vjs.createTimeRanges(0,this.hls.media.duration);const e=Math.round(this.hls.media.duration-this.dvrDuration),t=Math.round(this.hls.media.duration-this.edgeMargin);return this.vjs.createTimeRanges(e,t)}return this.vjs.createTimeRanges()}dispose(){this.videoElement.removeEventListener("play",this.handlers.play),this.videoElement.removeEventListener("error",this.handlers.error),this.hls.destroy()}_getHumanErrorMsg(e){switch(e.code){default:return e.message}}_handleUnrecoverableError(e){if(this.hls.levels.filter(t=>t.id>-1).length>1){this._removeQuality(this.hls.loadLevel);return}this.hls.destroy(),ze.info("bubbling error up to VIDEOJS"),this.tech.error=()=>({...e,message:this._getHumanErrorMsg(e)}),this.tech.trigger("error")}_handleMediaError(e){if(this.errorCounts[et.ErrorTypes.MEDIA_ERROR]===1){ze.info("trying to recover media error"),this.hls.recoverMediaError();return}if(this.errorCounts[et.ErrorTypes.MEDIA_ERROR]===2){ze.info("2nd try to recover media error (by swapping audio codec"),this.hls.swapAudioCodec(),this.hls.recoverMediaError();return}this.errorCounts[et.ErrorTypes.MEDIA_ERROR]>2&&this._handleUnrecoverableError(e)}_handleNetworkError(e){var t,i;if(navigator.onLine!==!1){if(this.liveEnded){ze.info("Forcing end of live stream after a network error"),(t=this.player)==null||t.handleTechEnded_(),(i=this.hls)==null||i.stopLoad();return}if(this.errorCounts[et.ErrorTypes.NETWORK_ERROR]<=this.maxNetworkErrorRecovery){ze.info("trying to recover network error"),setTimeout(()=>this.hls.startLoad(),1e3),this.hls.once(et.Events.FRAG_LOADED,()=>{this.errorCounts[et.ErrorTypes.NETWORK_ERROR]=0});return}this._handleUnrecoverableError(e)}}_onError(e,t){const i={message:`HLS.js error: ${t.type} - fatal: ${t.fatal} - ${t.details}`};this.errorCounts[t.type]?this.errorCounts[t.type]+=1:this.errorCounts[t.type]=1,/googlebot/i.test(navigator.userAgent)||(t.fatal?ze.error(i.message,{currentTime:this.player.currentTime(),data:t}):ze.clientWarn(i.message)),t.type===et.ErrorTypes.NETWORK_ERROR?(i.code=2,this._handleNetworkError(i)):t.fatal&&t.type===et.ErrorTypes.MEDIA_ERROR&&t.details!==et.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR?(i.code=3,this._handleMediaError(i)):t.fatal&&this._handleUnrecoverableError(i)}buildLevelLabel(e){return this.player.srOptions_.levelLabelHandler(e,this.player)}_removeQuality(e){this.hls.removeLevel(e),this.player.peertubeResolutions().remove(e),this.hls.currentLevel=-1}_notifyVideoQualities(){if(!this.metadata)return;const e=[];if(this.metadata.levels.forEach((i,s)=>{e.push({id:s,height:i.height,width:i.width,bitrate:i.bitrate,label:this.buildLevelLabel(i),selected:i.id===this.hls.manualLevel,selectCallback:()=>this.manuallySelectVideoLevel(s)})}),e.filter(i=>i.height!==0).length!==0&&this.getSeparateAudioTrack()){const i=this.getSeparateAudioTrack();e.push({id:-2,label:this.player.localize("Audio only"),selected:!1,selectCallback:()=>{this.audioMode||(this.audioMode=!0,this.updateToAudioOrVideo(i))}})}e.push({id:-1,label:this.player.localize("Auto"),selected:!0,selectCallback:()=>this.manuallySelectVideoLevel(-1)}),this.player.peertubeResolutions().add(e)}manuallySelectVideoLevel(e){if(this.audioMode){this.audioMode=!1,this.updateToAudioOrVideo(this.source.src,e);return}this.hls.currentLevel=e}_startLoad(){this.hls.startLoad(-1),this.videoElement.removeEventListener("play",this.handlers.play)}_onMetaData(e,t){this.metadata=t,this._notifyVideoQualities()}initialize(){this.liveEnded=!1,this.buildBaseConfig(),["","auto"].includes(this.videoElement.preload)&&!this.videoElement.autoplay&&this.hlsjsConfig.autoStartLoad===void 0&&(this.hlsjsConfig.autoStartLoad=!1),this.hlsjsConfig.autoStartLoad===!1&&(this.handlers.play=this._startLoad.bind(this),this.videoElement.addEventListener("play",this.handlers.play)),this.hls=new Qp({...Pd(this.hlsjsConfig,["p2pMediaLoaderOptions"]),p2p:{core:this.hlsjsConfig.p2pMediaLoaderOptions}}),this.player.trigger("hlsjs-initialized",{hlsjs:this.hls}),this.hls.on(et.Events.ERROR,(e,t)=>this._onError(e,t)),this.hls.on(et.Events.MANIFEST_PARSED,(e,t)=>this._onMetaData(e,t)),this.hls.on(et.Events.LEVEL_LOADED,(e,t)=>{this.hlsjsConfig.liveSyncDuration?this.edgeMargin=this.hlsjsConfig.liveSyncDuration:this.hlsjsConfig.liveSyncDurationCount&&(this.edgeMargin=this.hlsjsConfig.liveSyncDurationCount*t.details.targetduration),this.isLive&&!t.details.live&&(this.liveEnded=!0,this.player.trigger("hlsjs-live-ended")),this.isLive=t.details.live,this.dvrDuration=t.details.totalduration,this._duration=this.isLive?1/0:t.details.totalduration,this.isLive&&(this.maxNetworkErrorRecovery=30)}),this.registerLevelEventSwitch(),this.hls.once(et.Events.FRAG_LOADED,()=>{this.tech.trigger("loadedmetadata")}),this.hls.attachMedia(this.videoElement),this.hls.loadSource(this.source.src)}updateToAudioOrVideo(e,t){this.player.addClass("vjs-updating-resolution");const i=this.player.currentTime();this.dispose(),this.buildBaseConfig(),this.hlsjsConfig.autoStartLoad=!0,this.player.autoplay("play"),this.hls=new Qp({...Pd(this.hlsjsConfig,["p2pMediaLoaderOptions"]),p2p:{core:this.hlsjsConfig.p2pMediaLoaderOptions},startPosition:this.duration()===1/0?void 0:i,startLevel:t}),this.player.trigger("hlsjs-initialized",{hlsjs:this.hls}),this.hls.on(et.Events.ERROR,(s,r)=>this._onError(s,r)),this.registerLevelEventSwitch(),this.hls.attachMedia(this.videoElement),this.hls.loadSource(e),this.player.one("canplay",()=>{this.player.removeClass("vjs-updating-resolution")})}registerLevelEventSwitch(){this.hls.on(et.Events.LEVEL_SWITCHING,(e,t)=>{let i=t.level,s=-1;this.audioMode?i=-2:this.hls.autoLevelEnabled&&(i=-1,s=t.level),this.player.peertubeResolutions().select({id:i,autoResolutionChosenId:s,fireCallback:!1})})}buildBaseConfig(){const e=this.tech.options_,t=this.player.srOptions_,i=t?.hlsjsConfig||e.hlsjsConfig;this.hlsjsConfig=i?{...i}:{}}getSeparateAudioTrack(){if(this.metadata.audioTracks.length!==0)return this.metadata.audioTracks[0].url}}const eg=ds("peertube:player:p2p-media-loader"),yI=X.getPlugin("plugin");class TI extends yI{constructor(e,t){if(super(e),this.options=t,this.statsP2PBytes={pendingDownload:[],pendingUpload:[],peersWithWebSeed:0,peersP2POnly:0,totalDownload:0,totalUpload:0},this.statsHTTPBytes={pendingDownload:[],totalDownload:0},this.liveEnded=!1,!X.Html5Hlsjs){if(e.canPlayType("application/vnd.apple.mpegurl")){this.fallbackToBuiltInIOS();return}const i="HLS.js does not seem to be supported. Cannot fallback to built-in HLS";ze.warn(i);const s={code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED,message:i,MEDIA_ERR_ABORTED:MediaError.MEDIA_ERR_ABORTED,MEDIA_ERR_DECODE:MediaError.MEDIA_ERR_DECODE,MEDIA_ERR_NETWORK:MediaError.MEDIA_ERR_NETWORK,MEDIA_ERR_SRC_NOT_SUPPORTED:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED};e.ready(()=>e.error(s));return}{const i=(r,{hlsjs:a})=>{var l,c;(c=(l=this.hlsjs)==null?void 0:l.p2pEngine)==null||c.destroy(),clearInterval(this.networkInfoInterval),this.hlsjs=a,eg("hls.js initialized, initializing p2p-media-loader plugin",{hlsjs:a}),e.ready(()=>this.initializePlugin())};e.on("hlsjs-initialized",i);const s=()=>{eg("hls.js says the live is ended"),this.liveEnded=!0};e.on("hlsjs-live-ended",s),this.on("dispose",()=>{this.player.off("hlsjs-initialized",i),this.player.off("hlsjs-live-ended",s)})}e.src({type:t.type,src:t.src})}dispose(){var e,t,i,s;(t=(e=this.hlsjs)==null?void 0:e.p2pEngine)==null||t.destroy(),(i=this.hlsjs)==null||i.destroy(),(s=this.options.segmentValidator)==null||s.destroy(),clearInterval(this.networkInfoInterval),super.dispose()}getCurrentLevel(){if(this.hlsjs)return this.hlsjs.levels[this.hlsjs.currentLevel]}getLiveLatency(){return Math.round(this.hlsjs.latency)}getLiveLatencyFromEdge(){return Math.round(this.hlsjs.latency-this.hlsjs.targetLatency)}getHLSJS(){return this.hlsjs}initializePlugin(){this.hlsjs.p2pEngine.addEventListener("onSegmentError",i=>{if(navigator.onLine===!1||this.liveEnded||i.downloadSource!=="http")return;const s=i.segment;ze.clientError(`Segment ${s.runtimeId} error.`,i),this.options.redundancyUrlManager&&this.options.redundancyUrlManager.onSegmentError(s.url)}),this.hlsjs.p2pEngine.addEventListener("onSegmentLoaded",i=>{i.downloadSource==="http"&&this.options.redundancyUrlManager&&this.options.redundancyUrlManager.onSegmentSuccess(i.segmentUrl)});const e=this.options.redundancyUrlManager?this.options.redundancyUrlManager.countBaseUrls():0;this.totalHTTPPeers=1+e,this.statsP2PBytes.peersWithWebSeed=this.totalHTTPPeers,this.runStats();let t=!0;this.hlsjs.on(et.Events.LEVEL_SWITCHED,()=>{const i=this.getCurrentLevel(),s=Math.min(i?.height||0,i?.width||0);this.player.trigger("resolution-change",{resolution:s,initResolutionChange:t}),t=!1}),this.hlsjs.on(et.Events.MANIFEST_PARSED,(i,s)=>{if(Array.isArray(s.levels)&&s.levels.length>=1){const r=s.levels[0];this.player.trigger("video-ratio-changed",{ratio:r.width/r.height})}}),this.hlsjs.on(et.Events.ERROR,(i,s)=>{s.type===et.ErrorTypes.MEDIA_ERROR&&s.details===et.ErrorDetails.BUFFER_STALLED_ERROR&&this.player.trigger("buffer-stalled")})}runStats(){this.connectedPeers=new Set,this.hlsjs.p2pEngine.getConfig().core.mainStream.isP2PDisabled&&this.hlsjs.on(et.Events.FRAG_LOADED,(e,t)=>{const i=t.frag.stats.loaded;this.statsHTTPBytes.pendingDownload.push(i),this.statsHTTPBytes.totalDownload+=i}),this.hlsjs.p2pEngine.addEventListener("onChunkDownloaded",(e,t)=>{const i=t==="p2p"?this.statsP2PBytes:this.statsHTTPBytes;i.pendingDownload.push(e),i.totalDownload+=e}),this.hlsjs.p2pEngine.addEventListener("onChunkUploaded",e=>{this.statsP2PBytes.pendingUpload.push(e),this.statsP2PBytes.totalUpload+=e}),this.hlsjs.p2pEngine.addEventListener("onPeerConnect",e=>{e.streamType==="main"&&(this.connectedPeers.add(e.peerId),this.statsP2PBytes.peersP2POnly=this.connectedPeers.size,this.statsP2PBytes.peersWithWebSeed=this.totalHTTPPeers+this.statsP2PBytes.peersP2POnly)}),this.hlsjs.p2pEngine.addEventListener("onPeerClose",e=>{e.streamType==="main"&&(this.connectedPeers.delete(e.peerId),this.statsP2PBytes.peersP2POnly=this.connectedPeers.size,this.statsP2PBytes.peersWithWebSeed=this.totalHTTPPeers+this.statsP2PBytes.peersP2POnly)}),this.networkInfoInterval=setInterval(()=>{const e=this.arraySum(this.statsP2PBytes.pendingDownload),t=this.arraySum(this.statsP2PBytes.pendingUpload),i=this.arraySum(this.statsHTTPBytes.pendingDownload);return this.statsP2PBytes.pendingDownload=[],this.statsP2PBytes.pendingUpload=[],this.statsHTTPBytes.pendingDownload=[],this.player.trigger("network-info",{source:"p2p-media-loader",bandwidthEstimate:this.hlsjs.bandwidthEstimate/8,http:{downloadSpeed:i,downloaded:this.statsHTTPBytes.totalDownload},p2p:this.options.p2pEnabled?{downloadSpeed:e,uploadSpeed:t,peersWithWebSeed:this.statsP2PBytes.peersWithWebSeed,peersP2POnly:this.statsP2PBytes.peersP2POnly,downloaded:this.statsP2PBytes.totalDownload,uploaded:this.statsP2PBytes.totalUpload}:void 0})},1e3)}arraySum(e){return e.reduce((t,i)=>t+i,0)}fallbackToBuiltInIOS(){ze.info("HLS.js does not seem to be supported. Fallback to built-in HLS."),this.player.src({type:this.options.type,src:Eg(this.options.src,{videoFileToken:this.options.videoFileToken(),reinjectVideoFileToken:"true"})}),this.getResolutionButton().hide()}getResolutionButton(){return this.player.controlBar.getDescendant(["settingsButton"]).menu.getChild("resolutionMenuButton")}}X.registerPlugin("p2pMediaLoader",TI);var _I="2.0.3",Hh=500,tg="user-agent",Qr="",ig="?",jo="function",Fs="undefined",Jr="object",jh="string",Xt="browser",ss="cpu",Hi="device",Ci="engine",fi="os",Gr="result",Te="name",de="type",ve="vendor",_e="version",Qt="architecture",Wn="major",pe="model",Dn="console",He="mobile",rt="tablet",wt="smarttv",Oi="wearable",Wu="xr",xn="embedded",En="inapp",bc="brands",ir="formFactors",Sc="fullVersionList",Kr="platform",Cc="platformVersion",Qo="bitness",$s="sec-ch-ua",EI=$s+"-full-version-list",bI=$s+"-arch",SI=$s+"-"+Qo,CI=$s+"-form-factors",wI=$s+"-"+He,AI=$s+"-"+pe,zv=$s+"-"+Kr,II=zv+"-version",Yv=[bc,Sc,He,pe,Kr,Cc,Qt,ir,Qo],to="Amazon",Pr="Apple",sg="ASUS",rg="BlackBerry",Js="Google",ng="Huawei",ag="Lenovo",og="Honor",io="LG",zu="Microsoft",Yu="Motorola",Xu="Nvidia",lg="OnePlus",Qu="OPPO",bn="Samsung",ug="Sharp",Sn="Sony",Ju="Xiaomi",Zu="Zebra",hg="Chrome",cg="Chromium",Ss="Chromecast",LI="Edge",Cn="Firefox",wn="Opera",eh="Facebook",dg="Sogou",Dr="Mobile ",An=" Browser",Vh="Windows",kI=typeof window!==Fs,Jt=kI&&window.navigator?window.navigator:void 0,Ds=Jt&&Jt.userAgentData?Jt.userAgentData:void 0,RI=function(n,e){var t={},i=e;if(!Vo(e)){i={};for(var s in e)for(var r in e[s])i[r]=e[s][r].concat(i[r]?i[r]:[])}for(var a in n)t[a]=i[a]&&i[a].length%2===0?i[a].concat(n[a]):n[a];return t},Jo=function(n){for(var e={},t=0;t<n.length;t++)e[n[t].toUpperCase()]=n[t];return e},Gh=function(n,e){if(typeof n===Jr&&n.length>0){for(var t in n)if(os(n[t])==os(e))return!0;return!1}return en(n)?os(e).indexOf(os(n))!==-1:!1},Vo=function(n,e){for(var t in n)return/^(browser|cpu|device|engine|os)$/.test(t)||(e?Vo(n[t]):!1)},en=function(n){return typeof n===jh},th=function(n){if(n){for(var e=[],t=Zr(/\\?\"/g,n).split(","),i=0;i<t.length;i++)if(t[i].indexOf(";")>-1){var s=zn(t[i]).split(";v=");e[i]={brand:s[0],version:s[1]}}else e[i]=zn(t[i]);return e}},os=function(n){return en(n)?n.toLowerCase():n},ih=function(n){return en(n)?Zr(/[^\d\.]/g,n).split(".")[0]:void 0},ls=function(n){for(var e in n){var t=n[e];typeof t==Jr&&t.length==2?this[t[0]]=t[1]:this[t]=void 0}return this},Zr=function(n,e){return en(e)?e.replace(n,Qr):e},In=function(n){return Zr(/\\?\"/g,n)},zn=function(n,e){if(en(n))return n=Zr(/^\s\s*/,n),typeof e===Fs?n:n.substring(0,Hh)},sh=function(n,e){if(!(!n||!e))for(var t=0,i,s,r,a,l,c;t<e.length&&!l;){var h=e[t],f=e[t+1];for(i=s=0;i<h.length&&!l&&h[i];)if(l=h[i++].exec(n),l)for(r=0;r<f.length;r++)c=l[++s],a=f[r],typeof a===Jr&&a.length>0?a.length===2?typeof a[1]==jo?this[a[0]]=a[1].call(this,c):this[a[0]]=a[1]:a.length===3?typeof a[1]===jo&&!(a[1].exec&&a[1].test)?this[a[0]]=c?a[1].call(this,c,a[2]):void 0:this[a[0]]=c?c.replace(a[1],a[2]):void 0:a.length===4&&(this[a[0]]=c?a[3].call(this,c.replace(a[1],a[2])):void 0):this[a]=c||void 0;t+=2}},xs=function(n,e){for(var t in e)if(typeof e[t]===Jr&&e[t].length>0){for(var i=0;i<e[t].length;i++)if(Gh(e[t][i],n))return t===ig?void 0:t}else if(Gh(e[t],n))return t===ig?void 0:t;return e.hasOwnProperty("*")?e["*"]:n},fg={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},pg={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":void 0},gg={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[_e,[Te,Dr+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[_e,[Te,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[Te,_e],[/opios[\/ ]+([\w\.]+)/i],[_e,[Te,wn+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[_e,[Te,wn+" GX"]],[/\bopr\/([\w\.]+)/i],[_e,[Te,wn]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[_e,[Te,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[_e,[Te,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[Te,_e],[/quark(?:pc)?\/([-\w\.]+)/i],[_e,[Te,"Quark"]],[/\bddg\/([\w\.]+)/i],[_e,[Te,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[_e,[Te,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[_e,[Te,"WeChat"]],[/konqueror\/([\w\.]+)/i],[_e,[Te,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[_e,[Te,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[_e,[Te,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[_e,[Te,"Smart "+ag+An]],[/(avast|avg)\/([\w\.]+)/i],[[Te,/(.+)/,"$1 Secure"+An],_e],[/\bfocus\/([\w\.]+)/i],[_e,[Te,Cn+" Focus"]],[/\bopt\/([\w\.]+)/i],[_e,[Te,wn+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[_e,[Te,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[_e,[Te,"Dolphin"]],[/coast\/([\w\.]+)/i],[_e,[Te,wn+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[_e,[Te,"MIUI"+An]],[/fxios\/([\w\.-]+)/i],[_e,[Te,Dr+Cn]],[/\bqihoobrowser\/?([\w\.]*)/i],[_e,[Te,"360"]],[/\b(qq)\/([\w\.]+)/i],[[Te,/(.+)/,"$1Browser"],_e],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[Te,/(.+)/,"$1"+An],_e],[/samsungbrowser\/([\w\.]+)/i],[_e,[Te,bn+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[_e,[Te,dg+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[Te,dg+" Mobile"],_e],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[Te,_e],[/(lbbrowser|rekonq)/i],[Te],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[_e,Te],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[Te,eh],_e,[de,En]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[Te,_e,[de,En]],[/\bgsa\/([\w\.]+) .*safari\//i],[_e,[Te,"GSA"],[de,En]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[_e,[Te,"TikTok"],[de,En]],[/\[(linkedin)app\]/i],[Te,[de,En]],[/(chromium)[\/ ]([-\w\.]+)/i],[Te,_e],[/headlesschrome(?:\/([\w\.]+)| )/i],[_e,[Te,hg+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[Te,hg+" WebView"],_e],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[_e,[Te,"Android"+An]],[/chrome\/([\w\.]+) mobile/i],[_e,[Te,Dr+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[Te,_e],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[_e,[Te,Dr+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[Te,Dr+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[_e,Te],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[Te,[_e,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[Te,_e],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[Te,Dr+Cn],_e],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[Te,"Netscape"],_e],[/(wolvic|librewolf)\/([\w\.]+)/i],[Te,_e],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[_e,[Te,Cn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[Te,[_e,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[Te,[_e,/[^\d\.]+./,Qr]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[Qt,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[Qt,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[Qt,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[Qt,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[Qt,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[Qt,/ower/,Qr,os]],[/ sun4\w[;\)]/i],[[Qt,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[Qt,os]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[pe,[ve,bn],[de,rt]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[pe,[ve,bn],[de,He]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[pe,[ve,Pr],[de,He]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[pe,[ve,Pr],[de,rt]],[/(macintosh);/i],[pe,[ve,Pr]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[pe,[ve,ug],[de,He]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[pe,[ve,og],[de,rt]],[/honor([-\w ]+)[;\)]/i],[pe,[ve,og],[de,He]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[pe,[ve,ng],[de,rt]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[pe,[ve,ng],[de,He]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[pe,/_/g," "],[ve,Ju],[de,rt]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[pe,/_/g," "],[ve,Ju],[de,He]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[pe,[ve,Qu],[de,He]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[pe,[ve,xs,{OnePlus:["304","403","203"],"*":Qu}],[de,rt]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[pe,[ve,"BLU"],[de,He]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[pe,[ve,"Vivo"],[de,He]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[pe,[ve,"Realme"],[de,He]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[pe,[ve,Yu],[de,He]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[pe,[ve,Yu],[de,rt]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[pe,[ve,io],[de,rt]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch))(\w+)/i,/\blg-?([\d\w]+) bui/i],[pe,[ve,io],[de,He]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[pe,[ve,ag],[de,rt]],[/(nokia) (t[12][01])/i],[ve,pe,[de,rt]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[pe,/_/g," "],[de,He],[ve,"Nokia"]],[/(pixel (c|tablet))\b/i],[pe,[ve,Js],[de,rt]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[pe,[ve,Js],[de,He]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[pe,[ve,Sn],[de,He]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[pe,"Xperia Tablet"],[ve,Sn],[de,rt]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[pe,[ve,lg],[de,He]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[pe,[ve,to],[de,rt]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[pe,/(.+)/g,"Fire Phone $1"],[ve,to],[de,He]],[/(playbook);[-\w\),; ]+(rim)/i],[pe,ve,[de,rt]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[pe,[ve,rg],[de,He]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[pe,[ve,sg],[de,rt]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[pe,[ve,sg],[de,He]],[/(nexus 9)/i],[pe,[ve,"HTC"],[de,rt]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[ve,[pe,/_/g," "],[de,He]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[pe,[ve,"TCL"],[de,rt]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[pe,[ve,"TCL"],[de,He]],[/(itel) ((\w+))/i],[[ve,os],pe,[de,xs,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[pe,[ve,"Acer"],[de,rt]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[pe,[ve,"Meizu"],[de,He]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[pe,[ve,"Ulefone"],[de,He]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[pe,[ve,"Energizer"],[de,He]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[pe,[ve,"Cat"],[de,He]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[pe,[ve,"Smartfren"],[de,He]],[/droid.+; (a(?:015|06[35]|142p?))/i],[pe,[ve,"Nothing"],[de,He]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[pe,[ve,"Archos"],[de,rt]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[pe,[ve,"Archos"],[de,He]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[ve,pe,[de,rt]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[ve,pe,[de,He]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[ve,pe,[de,rt]],[/(surface duo)/i],[pe,[ve,zu],[de,rt]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[pe,[ve,"Fairphone"],[de,He]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[pe,[ve,Xu],[de,rt]],[/(sprint) (\w+)/i],[ve,pe,[de,He]],[/(kin\.[onetw]{3})/i],[[pe,/\./g," "],[ve,zu],[de,He]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[pe,[ve,Zu],[de,rt]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[pe,[ve,Zu],[de,He]],[/smart-tv.+(samsung)/i],[ve,[de,wt]],[/hbbtv.+maple;(\d+)/i],[[pe,/^/,"SmartTV"],[ve,bn],[de,wt]],[/tcast.+(lg)e?. ([-\w]+)/i],[ve,pe,[de,wt]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[ve,io],[de,wt]],[/(apple) ?tv/i],[ve,[pe,Pr+" TV"],[de,wt]],[/crkey.*devicetype\/chromecast/i],[[pe,Ss+" Third Generation"],[ve,Js],[de,wt]],[/crkey.*devicetype\/([^/]*)/i],[[pe,/^/,"Chromecast "],[ve,Js],[de,wt]],[/fuchsia.*crkey/i],[[pe,Ss+" Nest Hub"],[ve,Js],[de,wt]],[/crkey/i],[[pe,Ss],[ve,Js],[de,wt]],[/(portaltv)/i],[pe,[ve,eh],[de,wt]],[/droid.+aft(\w+)( bui|\))/i],[pe,[ve,to],[de,wt]],[/(shield \w+ tv)/i],[pe,[ve,Xu],[de,wt]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[pe,[ve,ug],[de,wt]],[/(bravia[\w ]+)( bui|\))/i],[pe,[ve,Sn],[de,wt]],[/(mi(tv|box)-?\w+) bui/i],[pe,[ve,Ju],[de,wt]],[/Hbbtv.*(technisat) (.*);/i],[ve,pe,[de,wt]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[ve,zn],[pe,zn],[de,wt]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[pe,[de,wt]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[de,wt]],[/(ouya)/i,/(nintendo) (\w+)/i],[ve,pe,[de,Dn]],[/droid.+; (shield)( bui|\))/i],[pe,[ve,Xu],[de,Dn]],[/(playstation \w+)/i],[pe,[ve,Sn],[de,Dn]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[pe,[ve,zu],[de,Dn]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[pe,[ve,bn],[de,Oi]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[ve,pe,[de,Oi]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[pe,[ve,Qu],[de,Oi]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[pe,[ve,Pr],[de,Oi]],[/(opwwe\d{3})/i],[pe,[ve,lg],[de,Oi]],[/(moto 360)/i],[pe,[ve,Yu],[de,Oi]],[/(smartwatch 3)/i],[pe,[ve,Sn],[de,Oi]],[/(g watch r)/i],[pe,[ve,io],[de,Oi]],[/droid.+; (wt63?0{2,3})\)/i],[pe,[ve,Zu],[de,Oi]],[/droid.+; (glass) \d/i],[pe,[ve,Js],[de,Wu]],[/(pico) (4|neo3(?: link|pro)?)/i],[ve,pe,[de,Wu]],[/(quest( \d| pro)?s?).+vr/i],[pe,[ve,eh],[de,Wu]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[ve,[de,xn]],[/(aeobc)\b/i],[pe,[ve,to],[de,xn]],[/(homepod).+mac os/i],[pe,[ve,Pr],[de,xn]],[/windows iot/i],[[de,xn]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[pe,[de,xs,{mobile:"Mobile",xr:"VR","*":rt}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[de,rt]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[de,He]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[pe,[ve,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[_e,[Te,LI+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[Te,_e],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[_e,[Te,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[Te,_e],[/ladybird\//i],[[Te,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[_e,Te]],os:[[/microsoft (windows) (vista|xp)/i],[Te,_e],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[Te,[_e,xs,fg]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_e,xs,fg],[Te,Vh]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[_e,/_/g,"."],[Te,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[Te,"macOS"],[_e,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[_e,[Te,Ss+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[_e,[Te,Ss+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[_e,[Te,Ss+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[_e,[Te,Ss+" Linux"]],[/crkey\/([\d\.]+)/i],[_e,[Te,Ss]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[_e,Te],[/(ubuntu) ([\w\.]+) like android/i],[[Te,/(.+)/,"$1 Touch"],_e],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/\.; ]?([\d\.]*)/i],[Te,_e],[/\(bb(10);/i],[_e,[Te,rg]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[_e,[Te,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[_e,[Te,Cn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[_e,[Te,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[_e,[Te,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[Te,"Chrome OS"],_e],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[Te,_e],[/(sunos) ?([\w\.\d]*)/i],[[Te,"Solaris"],_e],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[Te,_e]]},so=function(){var n={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return ls.call(n.init,[[Xt,[Te,_e,Wn,de]],[ss,[Qt]],[Hi,[de,pe,ve]],[Ci,[Te,_e]],[fi,[Te,_e]]]),ls.call(n.isIgnore,[[Xt,[_e,Wn]],[Ci,[_e]],[fi,[_e]]]),ls.call(n.isIgnoreRgx,[[Xt,/ ?browser$/i],[fi,/ ?os$/i]]),ls.call(n.toString,[[Xt,[Te,_e]],[ss,[Qt]],[Hi,[ve,pe]],[Ci,[Te,_e]],[fi,[Te,_e]]]),n}(),PI=function(n,e){var t=so.init[e],i=so.isIgnore[e]||0,s=so.isIgnoreRgx[e]||0,r=so.toString[e]||0;function a(){ls.call(this,t)}return a.prototype.getItem=function(){return n},a.prototype.withClientHints=function(){return Ds?Ds.getHighEntropyValues(Yv).then(function(l){return n.setCH(new Xv(l,!1)).parseCH().get()}):n.parseCH().get()},a.prototype.withFeatureCheck=function(){return n.detectFeature().get()},e!=Gr&&(a.prototype.is=function(l){var c=!1;for(var h in this)if(this.hasOwnProperty(h)&&!Gh(i,h)&&os(s?Zr(s,this[h]):this[h])==os(s?Zr(s,l):l)){if(c=!0,l!=Fs)break}else if(l==Fs&&c){c=!c;break}return c},a.prototype.toString=function(){var l=Qr;for(var c in r)typeof this[r[c]]!==Fs&&(l+=(l?" ":Qr)+this[r[c]]);return l||Fs}),Ds||(a.prototype.then=function(l){var c=this,h=function(){for(var p in c)c.hasOwnProperty(p)&&(this[p]=c[p])};h.prototype={is:a.prototype.is,toString:a.prototype.toString};var f=new h;return l(f),f}),new a};function Xv(n,e){if(n=n||{},ls.call(this,Yv),e)ls.call(this,[[bc,th(n[$s])],[Sc,th(n[EI])],[He,/\?1/.test(n[wI])],[pe,In(n[AI])],[Kr,In(n[zv])],[Cc,In(n[II])],[Qt,In(n[bI])],[ir,th(n[CI])],[Qo,In(n[SI])]]);else for(var t in n)this.hasOwnProperty(t)&&typeof n[t]!==Fs&&(this[t]=n[t])}function mg(n,e,t,i){return this.get=function(s){return s?this.data.hasOwnProperty(s)?this.data[s]:void 0:this.data},this.set=function(s,r){return this.data[s]=r,this},this.setCH=function(s){return this.uaCH=s,this},this.detectFeature=function(){if(Jt&&Jt.userAgent==this.ua)switch(this.itemType){case Xt:Jt.brave&&typeof Jt.brave.isBrave==jo&&this.set(Te,"Brave");break;case Hi:!this.get(de)&&Ds&&Ds[He]&&this.set(de,He),this.get(pe)=="Macintosh"&&Jt&&typeof Jt.standalone!==Fs&&Jt.maxTouchPoints&&Jt.maxTouchPoints>2&&this.set(pe,"iPad").set(de,rt);break;case fi:!this.get(Te)&&Ds&&Ds[Kr]&&this.set(Te,Ds[Kr]);break;case Gr:var s=this.data,r=function(a){return s[a].getItem().detectFeature().get()};this.set(Xt,r(Xt)).set(ss,r(ss)).set(Hi,r(Hi)).set(Ci,r(Ci)).set(fi,r(fi))}return this},this.parseUA=function(){return this.itemType!=Gr&&sh.call(this.data,this.ua,this.rgxMap),this.itemType==Xt&&this.set(Wn,ih(this.get(_e))),this},this.parseCH=function(){var s=this.uaCH,r=this.rgxMap;switch(this.itemType){case Xt:case Ci:var a=s[Sc]||s[bc],l;if(a)for(var c in a){var h=a[c].brand||a[c],f=a[c].version;this.itemType==Xt&&!/not.a.brand/i.test(h)&&(!l||/chrom/i.test(l)&&h!=cg)&&(h=xs(h,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"}),this.set(Te,h).set(_e,f).set(Wn,ih(f)),l=h),this.itemType==Ci&&h==cg&&this.set(_e,f)}break;case ss:var p=s[Qt];p&&(p&&s[Qo]=="64"&&(p+="64"),sh.call(this.data,p+";",r));break;case Hi:if(s[He]&&this.set(de,He),s[pe]&&(this.set(pe,s[pe]),!this.get(de)||!this.get(ve))){var m={};sh.call(m,"droid 9; "+s[pe]+")",r),!this.get(de)&&m.type&&this.set(de,m.type),!this.get(ve)&&m.vendor&&this.set(ve,m.vendor)}if(s[ir]){var _;if(typeof s[ir]!="string")for(var E=0;!_&&E<s[ir].length;)_=xs(s[ir][E++],pg);else _=xs(s[ir],pg);this.set(de,_)}break;case fi:var C=s[Kr];if(C){var S=s[Cc];C==Vh&&(S=parseInt(ih(S),10)>=13?"11":"10"),this.set(Te,C).set(_e,S)}this.get(Te)==Vh&&s[pe]=="Xbox"&&this.set(Te,"Xbox").set(_e,void 0);break;case Gr:var I=this.data,R=function(k){return I[k].getItem().setCH(s).parseCH().get()};this.set(Xt,R(Xt)).set(ss,R(ss)).set(Hi,R(Hi)).set(Ci,R(Ci)).set(fi,R(fi))}return this},ls.call(this,[["itemType",n],["ua",e],["uaCH",i],["rgxMap",t],["data",PI(this,n)]]),this}function hs(n,e,t){if(typeof n===Jr?(Vo(n,!0)?(typeof e===Jr&&(t=e),e=n):(t=n,e=void 0),n=void 0):typeof n===jh&&!Vo(e,!0)&&(t=e,e=void 0),t&&typeof t.append===jo){var i={};t.forEach(function(c,h){i[h]=c}),t=i}if(!(this instanceof hs))return new hs(n,e,t).getResult();var s=typeof n===jh?n:t&&t[tg]?t[tg]:Jt&&Jt.userAgent?Jt.userAgent:Qr,r=new Xv(t,!0),a=e?RI(gg,e):gg,l=function(c){return c==Gr?function(){return new mg(c,s,a,r).set("ua",s).set(Xt,this.getBrowser()).set(ss,this.getCPU()).set(Hi,this.getDevice()).set(Ci,this.getEngine()).set(fi,this.getOS()).get()}:function(){return new mg(c,s,a[c],r).parseUA().get()}};return ls.call(this,[["getBrowser",l(Xt)],["getCPU",l(ss)],["getDevice",l(Hi)],["getEngine",l(Ci)],["getOS",l(fi)],["getResult",l(Gr)],["getUA",function(){return s}],["setUA",function(c){return en(c)&&(s=c.length>Hh?zn(c,Hh):c),this}]]).setUA(s),this}hs.VERSION=_I;hs.BROWSER=Jo([Te,_e,Wn,de]);hs.CPU=Jo([Qt]);hs.DEVICE=Jo([pe,ve,de,Dn,He,wt,rt,Oi,xn]);hs.ENGINE=hs.OS=Jo([Te,_e]);const Ft=ds("peertube:player:peertube"),DI=X.getPlugin("plugin");class xI extends DI{constructor(e,t){super(e),this.options=t,this.setUserAgentInfo(),this.menuOpened=!1,this.mouseInControlBar=!1,this.mouseInSettings=!1,this.hasInitialSeek=!1,this.videoViewUrl=t.videoViewUrl,this.authorizationHeader=t.authorizationHeader,this.hasAutoplay=t.hasAutoplay,this.initialInactivityTimeout=this.player.options_.inactivityTimeout,this.currentSubtitle=this.options.subtitle()||$g(),this.initializePlayer(),this.initOnVideoChange(),this.player.removeClass("vjs-can-play"),this.deleteLegacyIndexedDB(),this.player.on("autoplay-failure",()=>{Ft("Autoplay failed"),this.player.removeClass("vjs-has-autoplay"),this.player.poster(t.poster()),(VT()||GT())&&this.player.hasStarted(!1)}),this.player.on("ratechange",()=>{this.currentPlaybackRate=this.player.playbackRate(),this.player.defaultPlaybackRate(this.currentPlaybackRate)}),this.player.one("canplay",()=>{const i=this.player.options_,s=Dg();s!==void 0&&this.player.volume(s);const r=i.muted!==void 0?i.muted:xg();r!==void 0&&this.player.muted(r),this.player.addClass("vjs-can-play")}),this.player.ready(()=>{this.player.on("volumechange",()=>{Mg(this.player.volume()),Fg(this.player.muted())}),this.player.textTracks().addEventListener("change",()=>{const i=this.player.textTracks().tracks_.find(s=>s.kind==="captions"&&s.mode==="showing");if(!i){oh("off"),this.currentSubtitle=void 0;return}this.currentSubtitle!==i.language&&(this.currentSubtitle=i.language,oh(i.language),Hg(i.language))}),this.player.on("video-change",()=>{this.initOnVideoChange(),this.hideFatalError()}),this.updatePlayerSizeClasses(),typeof ResizeObserver<"u"&&(this.resizeObserver=new ResizeObserver(()=>{this.updatePlayerSizeClasses()}),this.resizeObserver.observe(this.player.el()))}),this.player.on("resolution-change",(i,{resolution:s})=>{if(this.player.paused()){this.player.on("play",()=>this.adaptPosterForAudioOnly(s));return}this.adaptPosterForAudioOnly(s)}),this.initOnRatioChange()}dispose(){this.videoViewInterval&&clearInterval(this.videoViewInterval),this.resizeObserver&&this.resizeObserver.disconnect(),super.dispose()}onMenuOpened(){this.menuOpened=!0,this.alterInactivity()}onMenuClosed(){this.menuOpened=!1,this.alterInactivity()}displayFatalError(){if(this.errorModal)return;Ft("Display fatal error"),this.player.loadingSpinner.hide();const e=t=>{const i=this.player.localize.bind(this.player),s=document.createElement("div"),r=document.createElement("h1");r.innerText=i("Failed to play video"),s.appendChild(r);const a=document.createElement("div");a.innerText=i("The video failed to play due to technical issues."),s.appendChild(a);const l=document.createElement("p");return l.classList.add("error-details"),l.innerText=t.message,s.appendChild(l),s};this.errorModal=this.player.createModal(e(this.player.error()),{temporary:!0,uncloseable:!0}),this.errorModal.addClass("vjs-custom-error-display"),this.player.addClass("vjs-error-display-enabled"),/googlebot/i.test(navigator.userAgent)?console.error(this.player.error()):ze.error("Fatal error in player",this.player.error())}hideFatalError(){this.errorModal&&(Ft("Hiding fatal error"),this.player.removeClass("vjs-error-display-enabled"),this.player.removeChild(this.errorModal),this.errorModal.close(),this.errorModal=void 0,this.player.loadingSpinner&&this.player.loadingSpinner.show())}setUserAgentInfo(){const e=hs(window.navigator.userAgent),t=So()?"mobile":"desktop";this.userAgentInfo={client:e.browser.name,os:e.os.name,device:e.device.type||t}}initializePlayer(){So()&&this.player.addClass("vjs-is-mobile"),this.initSmoothProgressBar(),this.patchMenuEscapeKey(),this.player.ready(()=>{this.listenControlBarMouse()}),this.listenFullScreenChange()}initOnVideoChange(){this.hasAutoplay()!==!1?this.player.addClass("vjs-has-autoplay"):this.player.removeClass("vjs-has-autoplay"),this.currentPlaybackRate&&this.currentPlaybackRate!==1&&(Ft("Setting playback rate to "+this.currentPlaybackRate),this.player.playbackRate(this.currentPlaybackRate)),this.player.ready(()=>{this.initCaptions(),this.updateControlBar()}),this.handleStartStopTime(),this.runUserViewing()}initOnRatioChange(){if(!this.options.autoPlayerRatio)return;const e=getComputedStyle(this.player.el()).getPropertyValue(this.options.autoPlayerRatio.cssRatioVariable),t=()=>{this.options.videoRatio()&&(this.adaptPlayerFromRatio({ratio:this.options.videoRatio(),defaultRatio:e}),this.updatePlayerSizeClasses())};t(),this.player.on("video-change",()=>t()),this.player.on("video-ratio-changed",(i,s)=>{this.options.videoRatio()||(this.adaptPlayerFromRatio({ratio:s.ratio,defaultRatio:e}),this.updatePlayerSizeClasses())})}adaptPlayerFromRatio(e){const{ratio:t,defaultRatio:i}=e,s=this.player.el(),r=getComputedStyle(s).getPropertyValue(this.options.autoPlayerRatio.cssPlayerPortraitModeVariable)==="1",a=isNaN(t)||!r&&t<1?i:t;s.style.setProperty(this.options.autoPlayerRatio.cssRatioVariable,a+"")}runUserViewing(){const e=ro(this.options.startTime());let t=e,i,s=!1;this.disableUserViewing(),this.videoViewOnPlayHandler=()=>{Ft("Notify user is watching on play: "+e),this.notifyUserIsWatching(e,i)},this.videoViewOnSeekedHandler=()=>{if(this.hasInitialSeek){this.hasInitialSeek=!1;return}const r=Math.floor(this.player.currentTime());if(r===0&&this.player.loop()){Ft("Disabling viewing notification after first video loop."),this.disableUserViewing();return}const a=r-t;a>0&&a<3||(Ft("Detected seek event for user watching"),i="seek")},this.videoViewOnEndedHandler=()=>{if(s=!0,this.options.isLive())return;const r=Math.floor(this.player.duration());t=r,Ft("Notify user is watching on end: "+r),this.notifyUserIsWatching(r,i),i=void 0},this.player.one("play",this.videoViewOnPlayHandler),this.player.on("seeked",this.videoViewOnSeekedHandler),this.player.one("ended",this.videoViewOnEndedHandler),this.videoViewInterval=setInterval(()=>{if(s)return;const r=Math.floor(this.player.currentTime());r!==t&&(Ft("Notify user is watching: "+r),t=r,this.notifyUserIsWatching(r,i).catch(a=>ze.error("Cannot notify user is watching.",a)),i=void 0)},this.options.videoViewIntervalMs)}disableUserViewing(){this.videoViewInterval&&(clearInterval(this.videoViewInterval),this.videoViewInterval=void 0),this.videoViewOnPlayHandler&&(this.player.off("play",this.videoViewOnPlayHandler),this.videoViewOnPlayHandler=void 0),this.videoViewOnSeekedHandler&&(this.player.off("seeked",this.videoViewOnSeekedHandler),this.videoViewOnSeekedHandler=void 0),this.videoViewOnEndedHandler&&(this.player.off("ended",this.videoViewOnEndedHandler),this.videoViewOnEndedHandler=void 0)}notifyUserIsWatching(e,t){if(this.authorizationHeader()||Vg(this.options.videoUUID(),e),!this.videoViewUrl())return Promise.resolve(!0);const i=Gg(),s={currentTime:e,viewEvent:t,sessionId:i,client:this.userAgentInfo.client||void 0,device:this.userAgentInfo.device||void 0,operatingSystem:this.userAgentInfo.os||void 0},r=new Headers({"Content-type":"application/json; charset=UTF-8"});return this.authorizationHeader()&&r.set("Authorization",this.authorizationHeader()),fetch(this.videoViewUrl(),{method:"POST",body:JSON.stringify(s),headers:r})}adaptPosterForAudioOnly(e){if(Ft("Check if we need to adapt player for audio only",e),e===0){this.player.audioPosterMode(!0),this.player.poster(this.options.poster());return}this.player.audioPosterMode(!1),this.player.poster("")}updatePlayerSizeClasses(){requestAnimationFrame(()=>{if(!this.player)return;Ft("Updating player size classes");const e=this.player.currentWidth(),t=[350,570,750];for(const i of t)e<=i?this.player.addClass("vjs-size-"+i):this.player.removeClass("vjs-size-"+i)})}listenFullScreenChange(){this.player.on("fullscreenchange",()=>{this.player.isFullscreen()&&this.player.focus()})}listenControlBarMouse(){const e=this.player.controlBar,t=e.settingsButton;e.on("mouseenter",()=>{this.mouseInControlBar=!0,this.alterInactivity()}),e.on("mouseleave",()=>{this.mouseInControlBar=!1,this.alterInactivity()}),t.dialog.on("mouseenter",()=>{this.mouseInSettings=!0,this.alterInactivity()}),t.dialog.on("mouseleave",()=>{this.mouseInSettings=!1,this.alterInactivity()})}alterInactivity(){if(this.menuOpened||this.mouseInSettings||this.mouseInControlBar){this.setInactivityTimeout(0);return}this.setInactivityTimeout(this.initialInactivityTimeout),this.player.reportUserActivity(!0)}setInactivityTimeout(e){this.player.cache_.inactivityTimeout=e,this.player.options_.inactivityTimeout=e}initCaptions(){this.currentSubtitle?Ft("Init captions with current subtitle "+this.currentSubtitle):Ft("Init captions without current subtitle"),this.player.tech(!0).clearTracks("text"),this.player.removeClass("vjs-has-captions");for(const e of this.options.videoCaptions())this.player.addRemoteTextTrack({kind:"captions",label:e.automaticallyGenerated?this.player.localize("{1} (auto-generated)",[e.label]):e.label,language:e.language,id:e.language,src:e.src,default:this.currentSubtitle===e.language},!0),this.player.addClass("vjs-has-captions");this.player.trigger("captions-changed")}updateControlBar(){Ft("Updating control bar"),this.options.isLive()?(this.getPlaybackRateButton().hide(),this.player.controlBar.getChild("progressControl").hide(),this.player.controlBar.getChild("currentTimeDisplay").hide(),this.player.controlBar.getChild("timeDivider").hide(),this.player.controlBar.getChild("durationDisplay").hide(),this.player.controlBar.getChild("peerTubeLiveDisplay").show()):(this.getPlaybackRateButton().show(),this.player.controlBar.getChild("progressControl").show(),this.player.controlBar.getChild("currentTimeDisplay").show(),this.player.controlBar.getChild("timeDivider").show(),this.player.controlBar.getChild("durationDisplay").show(),this.player.controlBar.getChild("peerTubeLiveDisplay").hide()),this.options.videoCaptions().length===0?this.getCaptionsButton().hide():this.getCaptionsButton().show()}handleStartStopTime(){this.player.duration(this.options.videoDuration()),this.stopTimeHandler&&(this.player.off("timeupdate",this.stopTimeHandler),this.stopTimeHandler=void 0),this.player.one("canplaythrough",()=>{const e=this.options.startTime();if(e!=null&&(Ft("Start the video at "+e),this.hasInitialSeek=!0,this.player.currentTime(ro(e))),this.options.stopTime()){const t=ro(this.options.stopTime());this.stopTimeHandler=()=>{this.player.currentTime()<=t||(Ft("Stopping the video at "+this.options.stopTime()),this.player.pause(),this.player.trigger("auto-stopped"),this.player.off("timeupdate",this.stopTimeHandler),this.stopTimeHandler=void 0)},this.player.on("timeupdate",this.stopTimeHandler)}})}initSmoothProgressBar(){const e=X.getComponent("SeekBar");e.prototype.getPercent=function(){const s=this.player_.currentTime()/this.player_.duration();return s>=1?1:s},e.prototype.handleMouseMove=function(i){let s=this.calculateDistance(i)*this.player_.duration();s===this.player_.duration()&&(s=s-.1),this.player_.currentTime(s),this.update()}}patchMenuEscapeKey(){const e=X.getComponent("Menu"),t=e.prototype.handleKeyDown;e.prototype.handleKeyDown=function(s){if(s.key==="Escape"){s.preventDefault(),s.stopPropagation(),this.trigger("escaped-key");return}if(s.key==="ArrowRight"){s.preventDefault(),s.stopPropagation(),this.trigger("arrow-right",s.target);return}if(s.key==="ArrowLeft"){s.preventDefault(),s.stopPropagation(),this.trigger("arrow-left");return}t.call(this,s)}}getCaptionsButton(){return this.player.controlBar.getDescendant(["settingsButton"]).menu.getChild("captionsButton")}getPlaybackRateButton(){return this.player.controlBar.getDescendant(["settingsButton"]).menu.getChild("playbackRateMenuButton")}deleteLegacyIndexedDB(){try{if(typeof window.indexedDB>"u"||!window.indexedDB||typeof window.indexedDB.databases!="function")return;window.indexedDB.databases().then(e=>{for(const t of e)window.indexedDB.deleteDatabase(t.name)})}catch(e){Ft("Cannot delete legacy indexed DB",e)}}}X.registerPlugin("peertube",xI);class OI{constructor(e){this.options=e}getChildrenOptions(){return{...this.getPreviousVideo(),playToggle:{},...this.getNextVideo(),...this.getTimeControls(),...this.getProgressControl(),p2PInfoButton:{},muteToggle:{},volumeControl:{},captionToggleButton:{},...this.getSettingsButton(),...this.getPeerTubeLinkButton(),...this.getTheaterButton(),fullscreenToggle:{}}}getSettingsButton(){const e=[];return e.push("playbackRateMenuButton"),e.push("captionsButton"),e.push("resolutionMenuButton"),{settingsButton:{setup:{maxHeightOffset:60},entries:e}}}getTimeControls(){return{peerTubeLiveDisplay:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{}}}getProgressControl(){return{progressControl:{children:{seekBar:{children:{loadProgressBar:{},mouseTimeDisplay:{},playProgressBar:{}}}}}}}getPreviousVideo(){return{previousVideoButton:{type:"previous",handler:()=>this.options.previousVideo().handler(),isDisabled:()=>!this.options.previousVideo().enabled,isDisplayed:()=>this.options.previousVideo().displayControlBarButton}}}getNextVideo(){return{nextVideoButton:{type:"next",handler:()=>this.options.nextVideo().handler(),isDisabled:()=>!this.options.nextVideo().enabled,isDisplayed:()=>this.options.nextVideo().displayControlBarButton}}}getPeerTubeLinkButton(){return{peerTubeLinkButton:{isDisplayed:this.options.peertubeLink,shortUUID:this.options.videoShortUUID,instanceName:this.options.instanceName}}}getTheaterButton(){return{theaterButton:{isDisplayed:()=>this.options.theaterButton}}}}function Kh(n,e){const t=new URL(n),i=new URL(e);return t.hostname==="localhost"&&i.hostname==="localhost"?!0:t.origin===i.origin}class MI{constructor(e=[]){Qe(this,"map",new Map),this.baseUrls=e}onSegmentError(e){if(!this.map.has(e))return;const t=this.map.get(e);this.map.delete(e);const i=NI(t),s=i.length;this.baseUrls=this.baseUrls.filter(r=>r!==i&&r!==i+"/"),s!==this.baseUrls.length&&ze.info(`Removed redundancy of segment URL ${t}.`)}onSegmentSuccess(e){this.map.delete(e)}buildUrl(e){const t=this.baseUrls.length+1,i=this.getRandomInt(t);if(i===t-1)return e;const s=this.baseUrls[i],r=s.endsWith("/")?"":"/",a=s+r+FI(e);return this.map.set(e,a),a}countBaseUrls(){return this.baseUrls.length}getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}}function FI(n){return n.split("/").pop()}function NI(n){const e=n.split("/");return e.pop(),e.join("/")}var Qv={},Zo={};Zo.byteLength=$I;Zo.toByteArray=jI;Zo.fromByteArray=KI;var ji=[],ci=[],BI=typeof Uint8Array<"u"?Uint8Array:Array,rh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var xr=0,UI=rh.length;xr<UI;++xr)ji[xr]=rh[xr],ci[rh.charCodeAt(xr)]=xr;ci[45]=62;ci[95]=63;function Jv(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function $I(n){var e=Jv(n),t=e[0],i=e[1];return(t+i)*3/4-i}function HI(n,e,t){return(e+t)*3/4-t}function jI(n){var e,t=Jv(n),i=t[0],s=t[1],r=new BI(HI(n,i,s)),a=0,l=s>0?i-4:i,c;for(c=0;c<l;c+=4)e=ci[n.charCodeAt(c)]<<18|ci[n.charCodeAt(c+1)]<<12|ci[n.charCodeAt(c+2)]<<6|ci[n.charCodeAt(c+3)],r[a++]=e>>16&255,r[a++]=e>>8&255,r[a++]=e&255;return s===2&&(e=ci[n.charCodeAt(c)]<<2|ci[n.charCodeAt(c+1)]>>4,r[a++]=e&255),s===1&&(e=ci[n.charCodeAt(c)]<<10|ci[n.charCodeAt(c+1)]<<4|ci[n.charCodeAt(c+2)]>>2,r[a++]=e>>8&255,r[a++]=e&255),r}function VI(n){return ji[n>>18&63]+ji[n>>12&63]+ji[n>>6&63]+ji[n&63]}function GI(n,e,t){for(var i,s=[],r=e;r<t;r+=3)i=(n[r]<<16&16711680)+(n[r+1]<<8&65280)+(n[r+2]&255),s.push(VI(i));return s.join("")}function KI(n){for(var e,t=n.length,i=t%3,s=[],r=16383,a=0,l=t-i;a<l;a+=r)s.push(GI(n,a,a+r>l?l:a+r));return i===1?(e=n[t-1],s.push(ji[e>>2]+ji[e<<4&63]+"==")):i===2&&(e=(n[t-2]<<8)+n[t-1],s.push(ji[e>>10]+ji[e>>4&63]+ji[e<<2&63]+"=")),s.join("")}var wc={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */wc.read=function(n,e,t,i,s){var r,a,l=s*8-i-1,c=(1<<l)-1,h=c>>1,f=-7,p=t?s-1:0,m=t?-1:1,_=n[e+p];for(p+=m,r=_&(1<<-f)-1,_>>=-f,f+=l;f>0;r=r*256+n[e+p],p+=m,f-=8);for(a=r&(1<<-f)-1,r>>=-f,f+=i;f>0;a=a*256+n[e+p],p+=m,f-=8);if(r===0)r=1-h;else{if(r===c)return a?NaN:(_?-1:1)*(1/0);a=a+Math.pow(2,i),r=r-h}return(_?-1:1)*a*Math.pow(2,r-i)};wc.write=function(n,e,t,i,s,r){var a,l,c,h=r*8-s-1,f=(1<<h)-1,p=f>>1,m=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=i?0:r-1,E=i?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+p>=1?e+=m/c:e+=m*Math.pow(2,1-p),e*c>=2&&(a++,c/=2),a+p>=f?(l=0,a=f):a+p>=1?(l=(e*c-1)*Math.pow(2,s),a=a+p):(l=e*Math.pow(2,p-1)*Math.pow(2,s),a=0));s>=8;n[t+_]=l&255,_+=E,l/=256,s-=8);for(a=a<<s|l,h+=s;h>0;n[t+_]=a&255,_+=E,a/=256,h-=8);n[t+_-E]|=C*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){const e=Zo,t=wc,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=f,n.SlowBuffer=x,n.INSPECT_MAX_BYTES=50;const s=2147483647;n.kMaxLength=s;const{Uint8Array:r,ArrayBuffer:a,SharedArrayBuffer:l}=globalThis;f.TYPED_ARRAY_SUPPORT=c(),!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const M=new r(1),b={foo:function(){return 42}};return Object.setPrototypeOf(b,r.prototype),Object.setPrototypeOf(M,b),M.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function h(M){if(M>s)throw new RangeError('The value "'+M+'" is invalid for option "size"');const b=new r(M);return Object.setPrototypeOf(b,f.prototype),b}function f(M,b,A){if(typeof M=="number"){if(typeof b=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(M)}return p(M,b,A)}f.poolSize=8192;function p(M,b,A){if(typeof M=="string")return C(M,b);if(a.isView(M))return I(M);if(M==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M);if(St(M,a)||M&&St(M.buffer,a)||typeof l<"u"&&(St(M,l)||M&&St(M.buffer,l)))return R(M,b,A);if(typeof M=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const j=M.valueOf&&M.valueOf();if(j!=null&&j!==M)return f.from(j,b,A);const q=k(M);if(q)return q;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof M[Symbol.toPrimitive]=="function")return f.from(M[Symbol.toPrimitive]("string"),b,A);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M)}f.from=function(M,b,A){return p(M,b,A)},Object.setPrototypeOf(f.prototype,r.prototype),Object.setPrototypeOf(f,r);function m(M){if(typeof M!="number")throw new TypeError('"size" argument must be of type number');if(M<0)throw new RangeError('The value "'+M+'" is invalid for option "size"')}function _(M,b,A){return m(M),M<=0?h(M):b!==void 0?typeof A=="string"?h(M).fill(b,A):h(M).fill(b):h(M)}f.alloc=function(M,b,A){return _(M,b,A)};function E(M){return m(M),h(M<0?0:D(M)|0)}f.allocUnsafe=function(M){return E(M)},f.allocUnsafeSlow=function(M){return E(M)};function C(M,b){if((typeof b!="string"||b==="")&&(b="utf8"),!f.isEncoding(b))throw new TypeError("Unknown encoding: "+b);const A=N(M,b)|0;let j=h(A);const q=j.write(M,b);return q!==A&&(j=j.slice(0,q)),j}function S(M){const b=M.length<0?0:D(M.length)|0,A=h(b);for(let j=0;j<b;j+=1)A[j]=M[j]&255;return A}function I(M){if(St(M,r)){const b=new r(M);return R(b.buffer,b.byteOffset,b.byteLength)}return S(M)}function R(M,b,A){if(b<0||M.byteLength<b)throw new RangeError('"offset" is outside of buffer bounds');if(M.byteLength<b+(A||0))throw new RangeError('"length" is outside of buffer bounds');let j;return b===void 0&&A===void 0?j=new r(M):A===void 0?j=new r(M,b):j=new r(M,b,A),Object.setPrototypeOf(j,f.prototype),j}function k(M){if(f.isBuffer(M)){const b=D(M.length)|0,A=h(b);return A.length===0||M.copy(A,0,0,b),A}if(M.length!==void 0)return typeof M.length!="number"||kt(M.length)?h(0):S(M);if(M.type==="Buffer"&&Array.isArray(M.data))return S(M.data)}function D(M){if(M>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return M|0}function x(M){return+M!=M&&(M=0),f.alloc(+M)}f.isBuffer=function(b){return b!=null&&b._isBuffer===!0&&b!==f.prototype},f.compare=function(b,A){if(St(b,r)&&(b=f.from(b,b.offset,b.byteLength)),St(A,r)&&(A=f.from(A,A.offset,A.byteLength)),!f.isBuffer(b)||!f.isBuffer(A))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(b===A)return 0;let j=b.length,q=A.length;for(let Z=0,ue=Math.min(j,q);Z<ue;++Z)if(b[Z]!==A[Z]){j=b[Z],q=A[Z];break}return j<q?-1:q<j?1:0},f.isEncoding=function(b){switch(String(b).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(b,A){if(!Array.isArray(b))throw new TypeError('"list" argument must be an Array of Buffers');if(b.length===0)return f.alloc(0);let j;if(A===void 0)for(A=0,j=0;j<b.length;++j)A+=b[j].length;const q=f.allocUnsafe(A);let Z=0;for(j=0;j<b.length;++j){let ue=b[j];if(St(ue,r))Z+ue.length>q.length?(f.isBuffer(ue)||(ue=f.from(ue)),ue.copy(q,Z)):r.prototype.set.call(q,ue,Z);else if(f.isBuffer(ue))ue.copy(q,Z);else throw new TypeError('"list" argument must be an Array of Buffers');Z+=ue.length}return q};function N(M,b){if(f.isBuffer(M))return M.length;if(a.isView(M)||St(M,a))return M.byteLength;if(typeof M!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof M);const A=M.length,j=arguments.length>2&&arguments[2]===!0;if(!j&&A===0)return 0;let q=!1;for(;;)switch(b){case"ascii":case"latin1":case"binary":return A;case"utf8":case"utf-8":return bt(M).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A*2;case"hex":return A>>>1;case"base64":return mi(M).length;default:if(q)return j?-1:bt(M).length;b=(""+b).toLowerCase(),q=!0}}f.byteLength=N;function B(M,b,A){let j=!1;if((b===void 0||b<0)&&(b=0),b>this.length||((A===void 0||A>this.length)&&(A=this.length),A<=0)||(A>>>=0,b>>>=0,A<=b))return"";for(M||(M="utf8");;)switch(M){case"hex":return Q(this,b,A);case"utf8":case"utf-8":return fe(this,b,A);case"ascii":return re(this,b,A);case"latin1":case"binary":return le(this,b,A);case"base64":return ae(this,b,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return te(this,b,A);default:if(j)throw new TypeError("Unknown encoding: "+M);M=(M+"").toLowerCase(),j=!0}}f.prototype._isBuffer=!0;function H(M,b,A){const j=M[b];M[b]=M[A],M[A]=j}f.prototype.swap16=function(){const b=this.length;if(b%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let A=0;A<b;A+=2)H(this,A,A+1);return this},f.prototype.swap32=function(){const b=this.length;if(b%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let A=0;A<b;A+=4)H(this,A,A+3),H(this,A+1,A+2);return this},f.prototype.swap64=function(){const b=this.length;if(b%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let A=0;A<b;A+=8)H(this,A,A+7),H(this,A+1,A+6),H(this,A+2,A+5),H(this,A+3,A+4);return this},f.prototype.toString=function(){const b=this.length;return b===0?"":arguments.length===0?fe(this,0,b):B.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(b){if(!f.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:f.compare(this,b)===0},f.prototype.inspect=function(){let b="";const A=n.INSPECT_MAX_BYTES;return b=this.toString("hex",0,A).replace(/(.{2})/g,"$1 ").trim(),this.length>A&&(b+=" ... "),"<Buffer "+b+">"},i&&(f.prototype[i]=f.prototype.inspect),f.prototype.compare=function(b,A,j,q,Z){if(St(b,r)&&(b=f.from(b,b.offset,b.byteLength)),!f.isBuffer(b))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof b);if(A===void 0&&(A=0),j===void 0&&(j=b?b.length:0),q===void 0&&(q=0),Z===void 0&&(Z=this.length),A<0||j>b.length||q<0||Z>this.length)throw new RangeError("out of range index");if(q>=Z&&A>=j)return 0;if(q>=Z)return-1;if(A>=j)return 1;if(A>>>=0,j>>>=0,q>>>=0,Z>>>=0,this===b)return 0;let ue=Z-q,Fe=j-A;const at=Math.min(ue,Fe),tt=this.slice(q,Z),Re=b.slice(A,j);for(let qe=0;qe<at;++qe)if(tt[qe]!==Re[qe]){ue=tt[qe],Fe=Re[qe];break}return ue<Fe?-1:Fe<ue?1:0};function O(M,b,A,j,q){if(M.length===0)return-1;if(typeof A=="string"?(j=A,A=0):A>2147483647?A=2147483647:A<-2147483648&&(A=-2147483648),A=+A,kt(A)&&(A=q?0:M.length-1),A<0&&(A=M.length+A),A>=M.length){if(q)return-1;A=M.length-1}else if(A<0)if(q)A=0;else return-1;if(typeof b=="string"&&(b=f.from(b,j)),f.isBuffer(b))return b.length===0?-1:P(M,b,A,j,q);if(typeof b=="number")return b=b&255,typeof r.prototype.indexOf=="function"?q?r.prototype.indexOf.call(M,b,A):r.prototype.lastIndexOf.call(M,b,A):P(M,[b],A,j,q);throw new TypeError("val must be string, number or Buffer")}function P(M,b,A,j,q){let Z=1,ue=M.length,Fe=b.length;if(j!==void 0&&(j=String(j).toLowerCase(),j==="ucs2"||j==="ucs-2"||j==="utf16le"||j==="utf-16le")){if(M.length<2||b.length<2)return-1;Z=2,ue/=2,Fe/=2,A/=2}function at(Re,qe){return Z===1?Re[qe]:Re.readUInt16BE(qe*Z)}let tt;if(q){let Re=-1;for(tt=A;tt<ue;tt++)if(at(M,tt)===at(b,Re===-1?0:tt-Re)){if(Re===-1&&(Re=tt),tt-Re+1===Fe)return Re*Z}else Re!==-1&&(tt-=tt-Re),Re=-1}else for(A+Fe>ue&&(A=ue-Fe),tt=A;tt>=0;tt--){let Re=!0;for(let qe=0;qe<Fe;qe++)if(at(M,tt+qe)!==at(b,qe)){Re=!1;break}if(Re)return tt}return-1}f.prototype.includes=function(b,A,j){return this.indexOf(b,A,j)!==-1},f.prototype.indexOf=function(b,A,j){return O(this,b,A,j,!0)},f.prototype.lastIndexOf=function(b,A,j){return O(this,b,A,j,!1)};function G(M,b,A,j){A=Number(A)||0;const q=M.length-A;j?(j=Number(j),j>q&&(j=q)):j=q;const Z=b.length;j>Z/2&&(j=Z/2);let ue;for(ue=0;ue<j;++ue){const Fe=parseInt(b.substr(ue*2,2),16);if(kt(Fe))return ue;M[A+ue]=Fe}return ue}function J(M,b,A,j){return Ot(bt(b,M.length-A),M,A,j)}function se(M,b,A,j){return Ot(Nt(b),M,A,j)}function ie(M,b,A,j){return Ot(mi(b),M,A,j)}function ne(M,b,A,j){return Ot(mt(b,M.length-A),M,A,j)}f.prototype.write=function(b,A,j,q){if(A===void 0)q="utf8",j=this.length,A=0;else if(j===void 0&&typeof A=="string")q=A,j=this.length,A=0;else if(isFinite(A))A=A>>>0,isFinite(j)?(j=j>>>0,q===void 0&&(q="utf8")):(q=j,j=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Z=this.length-A;if((j===void 0||j>Z)&&(j=Z),b.length>0&&(j<0||A<0)||A>this.length)throw new RangeError("Attempt to write outside buffer bounds");q||(q="utf8");let ue=!1;for(;;)switch(q){case"hex":return G(this,b,A,j);case"utf8":case"utf-8":return J(this,b,A,j);case"ascii":case"latin1":case"binary":return se(this,b,A,j);case"base64":return ie(this,b,A,j);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ne(this,b,A,j);default:if(ue)throw new TypeError("Unknown encoding: "+q);q=(""+q).toLowerCase(),ue=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ae(M,b,A){return b===0&&A===M.length?e.fromByteArray(M):e.fromByteArray(M.slice(b,A))}function fe(M,b,A){A=Math.min(M.length,A);const j=[];let q=b;for(;q<A;){const Z=M[q];let ue=null,Fe=Z>239?4:Z>223?3:Z>191?2:1;if(q+Fe<=A){let at,tt,Re,qe;switch(Fe){case 1:Z<128&&(ue=Z);break;case 2:at=M[q+1],(at&192)===128&&(qe=(Z&31)<<6|at&63,qe>127&&(ue=qe));break;case 3:at=M[q+1],tt=M[q+2],(at&192)===128&&(tt&192)===128&&(qe=(Z&15)<<12|(at&63)<<6|tt&63,qe>2047&&(qe<55296||qe>57343)&&(ue=qe));break;case 4:at=M[q+1],tt=M[q+2],Re=M[q+3],(at&192)===128&&(tt&192)===128&&(Re&192)===128&&(qe=(Z&15)<<18|(at&63)<<12|(tt&63)<<6|Re&63,qe>65535&&qe<1114112&&(ue=qe))}}ue===null?(ue=65533,Fe=1):ue>65535&&(ue-=65536,j.push(ue>>>10&1023|55296),ue=56320|ue&1023),j.push(ue),q+=Fe}return oe(j)}const ee=4096;function oe(M){const b=M.length;if(b<=ee)return String.fromCharCode.apply(String,M);let A="",j=0;for(;j<b;)A+=String.fromCharCode.apply(String,M.slice(j,j+=ee));return A}function re(M,b,A){let j="";A=Math.min(M.length,A);for(let q=b;q<A;++q)j+=String.fromCharCode(M[q]&127);return j}function le(M,b,A){let j="";A=Math.min(M.length,A);for(let q=b;q<A;++q)j+=String.fromCharCode(M[q]);return j}function Q(M,b,A){const j=M.length;(!b||b<0)&&(b=0),(!A||A<0||A>j)&&(A=j);let q="";for(let Z=b;Z<A;++Z)q+=qt[M[Z]];return q}function te(M,b,A){const j=M.slice(b,A);let q="";for(let Z=0;Z<j.length-1;Z+=2)q+=String.fromCharCode(j[Z]+j[Z+1]*256);return q}f.prototype.slice=function(b,A){const j=this.length;b=~~b,A=A===void 0?j:~~A,b<0?(b+=j,b<0&&(b=0)):b>j&&(b=j),A<0?(A+=j,A<0&&(A=0)):A>j&&(A=j),A<b&&(A=b);const q=this.subarray(b,A);return Object.setPrototypeOf(q,f.prototype),q};function Se(M,b,A){if(M%1!==0||M<0)throw new RangeError("offset is not uint");if(M+b>A)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(b,A,j){b=b>>>0,A=A>>>0,j||Se(b,A,this.length);let q=this[b],Z=1,ue=0;for(;++ue<A&&(Z*=256);)q+=this[b+ue]*Z;return q},f.prototype.readUintBE=f.prototype.readUIntBE=function(b,A,j){b=b>>>0,A=A>>>0,j||Se(b,A,this.length);let q=this[b+--A],Z=1;for(;A>0&&(Z*=256);)q+=this[b+--A]*Z;return q},f.prototype.readUint8=f.prototype.readUInt8=function(b,A){return b=b>>>0,A||Se(b,1,this.length),this[b]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(b,A){return b=b>>>0,A||Se(b,2,this.length),this[b]|this[b+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(b,A){return b=b>>>0,A||Se(b,2,this.length),this[b]<<8|this[b+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(b,A){return b=b>>>0,A||Se(b,4,this.length),(this[b]|this[b+1]<<8|this[b+2]<<16)+this[b+3]*16777216},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(b,A){return b=b>>>0,A||Se(b,4,this.length),this[b]*16777216+(this[b+1]<<16|this[b+2]<<8|this[b+3])},f.prototype.readBigUInt64LE=Rt(function(b){b=b>>>0,Oe(b,"offset");const A=this[b],j=this[b+7];(A===void 0||j===void 0)&&Ke(b,this.length-8);const q=A+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24,Z=this[++b]+this[++b]*2**8+this[++b]*2**16+j*2**24;return BigInt(q)+(BigInt(Z)<<BigInt(32))}),f.prototype.readBigUInt64BE=Rt(function(b){b=b>>>0,Oe(b,"offset");const A=this[b],j=this[b+7];(A===void 0||j===void 0)&&Ke(b,this.length-8);const q=A*2**24+this[++b]*2**16+this[++b]*2**8+this[++b],Z=this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+j;return(BigInt(q)<<BigInt(32))+BigInt(Z)}),f.prototype.readIntLE=function(b,A,j){b=b>>>0,A=A>>>0,j||Se(b,A,this.length);let q=this[b],Z=1,ue=0;for(;++ue<A&&(Z*=256);)q+=this[b+ue]*Z;return Z*=128,q>=Z&&(q-=Math.pow(2,8*A)),q},f.prototype.readIntBE=function(b,A,j){b=b>>>0,A=A>>>0,j||Se(b,A,this.length);let q=A,Z=1,ue=this[b+--q];for(;q>0&&(Z*=256);)ue+=this[b+--q]*Z;return Z*=128,ue>=Z&&(ue-=Math.pow(2,8*A)),ue},f.prototype.readInt8=function(b,A){return b=b>>>0,A||Se(b,1,this.length),this[b]&128?(255-this[b]+1)*-1:this[b]},f.prototype.readInt16LE=function(b,A){b=b>>>0,A||Se(b,2,this.length);const j=this[b]|this[b+1]<<8;return j&32768?j|4294901760:j},f.prototype.readInt16BE=function(b,A){b=b>>>0,A||Se(b,2,this.length);const j=this[b+1]|this[b]<<8;return j&32768?j|4294901760:j},f.prototype.readInt32LE=function(b,A){return b=b>>>0,A||Se(b,4,this.length),this[b]|this[b+1]<<8|this[b+2]<<16|this[b+3]<<24},f.prototype.readInt32BE=function(b,A){return b=b>>>0,A||Se(b,4,this.length),this[b]<<24|this[b+1]<<16|this[b+2]<<8|this[b+3]},f.prototype.readBigInt64LE=Rt(function(b){b=b>>>0,Oe(b,"offset");const A=this[b],j=this[b+7];(A===void 0||j===void 0)&&Ke(b,this.length-8);const q=this[b+4]+this[b+5]*2**8+this[b+6]*2**16+(j<<24);return(BigInt(q)<<BigInt(32))+BigInt(A+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24)}),f.prototype.readBigInt64BE=Rt(function(b){b=b>>>0,Oe(b,"offset");const A=this[b],j=this[b+7];(A===void 0||j===void 0)&&Ke(b,this.length-8);const q=(A<<24)+this[++b]*2**16+this[++b]*2**8+this[++b];return(BigInt(q)<<BigInt(32))+BigInt(this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+j)}),f.prototype.readFloatLE=function(b,A){return b=b>>>0,A||Se(b,4,this.length),t.read(this,b,!0,23,4)},f.prototype.readFloatBE=function(b,A){return b=b>>>0,A||Se(b,4,this.length),t.read(this,b,!1,23,4)},f.prototype.readDoubleLE=function(b,A){return b=b>>>0,A||Se(b,8,this.length),t.read(this,b,!0,52,8)},f.prototype.readDoubleBE=function(b,A){return b=b>>>0,A||Se(b,8,this.length),t.read(this,b,!1,52,8)};function be(M,b,A,j,q,Z){if(!f.isBuffer(M))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>q||b<Z)throw new RangeError('"value" argument is out of bounds');if(A+j>M.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(b,A,j,q){if(b=+b,A=A>>>0,j=j>>>0,!q){const Fe=Math.pow(2,8*j)-1;be(this,b,A,j,Fe,0)}let Z=1,ue=0;for(this[A]=b&255;++ue<j&&(Z*=256);)this[A+ue]=b/Z&255;return A+j},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(b,A,j,q){if(b=+b,A=A>>>0,j=j>>>0,!q){const Fe=Math.pow(2,8*j)-1;be(this,b,A,j,Fe,0)}let Z=j-1,ue=1;for(this[A+Z]=b&255;--Z>=0&&(ue*=256);)this[A+Z]=b/ue&255;return A+j},f.prototype.writeUint8=f.prototype.writeUInt8=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,1,255,0),this[A]=b&255,A+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,2,65535,0),this[A]=b&255,this[A+1]=b>>>8,A+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,2,65535,0),this[A]=b>>>8,this[A+1]=b&255,A+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,4,4294967295,0),this[A+3]=b>>>24,this[A+2]=b>>>16,this[A+1]=b>>>8,this[A]=b&255,A+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,4,4294967295,0),this[A]=b>>>24,this[A+1]=b>>>16,this[A+2]=b>>>8,this[A+3]=b&255,A+4};function Pe(M,b,A,j,q){Ii(b,j,q,M,A,7);let Z=Number(b&BigInt(4294967295));M[A++]=Z,Z=Z>>8,M[A++]=Z,Z=Z>>8,M[A++]=Z,Z=Z>>8,M[A++]=Z;let ue=Number(b>>BigInt(32)&BigInt(4294967295));return M[A++]=ue,ue=ue>>8,M[A++]=ue,ue=ue>>8,M[A++]=ue,ue=ue>>8,M[A++]=ue,A}function Me(M,b,A,j,q){Ii(b,j,q,M,A,7);let Z=Number(b&BigInt(4294967295));M[A+7]=Z,Z=Z>>8,M[A+6]=Z,Z=Z>>8,M[A+5]=Z,Z=Z>>8,M[A+4]=Z;let ue=Number(b>>BigInt(32)&BigInt(4294967295));return M[A+3]=ue,ue=ue>>8,M[A+2]=ue,ue=ue>>8,M[A+1]=ue,ue=ue>>8,M[A]=ue,A+8}f.prototype.writeBigUInt64LE=Rt(function(b,A=0){return Pe(this,b,A,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeBigUInt64BE=Rt(function(b,A=0){return Me(this,b,A,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeIntLE=function(b,A,j,q){if(b=+b,A=A>>>0,!q){const at=Math.pow(2,8*j-1);be(this,b,A,j,at-1,-at)}let Z=0,ue=1,Fe=0;for(this[A]=b&255;++Z<j&&(ue*=256);)b<0&&Fe===0&&this[A+Z-1]!==0&&(Fe=1),this[A+Z]=(b/ue>>0)-Fe&255;return A+j},f.prototype.writeIntBE=function(b,A,j,q){if(b=+b,A=A>>>0,!q){const at=Math.pow(2,8*j-1);be(this,b,A,j,at-1,-at)}let Z=j-1,ue=1,Fe=0;for(this[A+Z]=b&255;--Z>=0&&(ue*=256);)b<0&&Fe===0&&this[A+Z+1]!==0&&(Fe=1),this[A+Z]=(b/ue>>0)-Fe&255;return A+j},f.prototype.writeInt8=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,1,127,-128),b<0&&(b=255+b+1),this[A]=b&255,A+1},f.prototype.writeInt16LE=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,2,32767,-32768),this[A]=b&255,this[A+1]=b>>>8,A+2},f.prototype.writeInt16BE=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,2,32767,-32768),this[A]=b>>>8,this[A+1]=b&255,A+2},f.prototype.writeInt32LE=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,4,2147483647,-2147483648),this[A]=b&255,this[A+1]=b>>>8,this[A+2]=b>>>16,this[A+3]=b>>>24,A+4},f.prototype.writeInt32BE=function(b,A,j){return b=+b,A=A>>>0,j||be(this,b,A,4,2147483647,-2147483648),b<0&&(b=4294967295+b+1),this[A]=b>>>24,this[A+1]=b>>>16,this[A+2]=b>>>8,this[A+3]=b&255,A+4},f.prototype.writeBigInt64LE=Rt(function(b,A=0){return Pe(this,b,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeBigInt64BE=Rt(function(b,A=0){return Me(this,b,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function De(M,b,A,j,q,Z){if(A+j>M.length)throw new RangeError("Index out of range");if(A<0)throw new RangeError("Index out of range")}function $e(M,b,A,j,q){return b=+b,A=A>>>0,q||De(M,b,A,4),t.write(M,b,A,j,23,4),A+4}f.prototype.writeFloatLE=function(b,A,j){return $e(this,b,A,!0,j)},f.prototype.writeFloatBE=function(b,A,j){return $e(this,b,A,!1,j)};function Ve(M,b,A,j,q){return b=+b,A=A>>>0,q||De(M,b,A,8),t.write(M,b,A,j,52,8),A+8}f.prototype.writeDoubleLE=function(b,A,j){return Ve(this,b,A,!0,j)},f.prototype.writeDoubleBE=function(b,A,j){return Ve(this,b,A,!1,j)},f.prototype.copy=function(b,A,j,q){if(!f.isBuffer(b))throw new TypeError("argument should be a Buffer");if(j||(j=0),!q&&q!==0&&(q=this.length),A>=b.length&&(A=b.length),A||(A=0),q>0&&q<j&&(q=j),q===j||b.length===0||this.length===0)return 0;if(A<0)throw new RangeError("targetStart out of bounds");if(j<0||j>=this.length)throw new RangeError("Index out of range");if(q<0)throw new RangeError("sourceEnd out of bounds");q>this.length&&(q=this.length),b.length-A<q-j&&(q=b.length-A+j);const Z=q-j;return this===b&&typeof r.prototype.copyWithin=="function"?this.copyWithin(A,j,q):r.prototype.set.call(b,this.subarray(j,q),A),Z},f.prototype.fill=function(b,A,j,q){if(typeof b=="string"){if(typeof A=="string"?(q=A,A=0,j=this.length):typeof j=="string"&&(q=j,j=this.length),q!==void 0&&typeof q!="string")throw new TypeError("encoding must be a string");if(typeof q=="string"&&!f.isEncoding(q))throw new TypeError("Unknown encoding: "+q);if(b.length===1){const ue=b.charCodeAt(0);(q==="utf8"&&ue<128||q==="latin1")&&(b=ue)}}else typeof b=="number"?b=b&255:typeof b=="boolean"&&(b=Number(b));if(A<0||this.length<A||this.length<j)throw new RangeError("Out of range index");if(j<=A)return this;A=A>>>0,j=j===void 0?this.length:j>>>0,b||(b=0);let Z;if(typeof b=="number")for(Z=A;Z<j;++Z)this[Z]=b;else{const ue=f.isBuffer(b)?b:f.from(b,q),Fe=ue.length;if(Fe===0)throw new TypeError('The value "'+b+'" is invalid for argument "value"');for(Z=0;Z<j-A;++Z)this[Z+A]=ue[Z%Fe]}return this};const Je={};function Ye(M,b,A){Je[M]=class extends A{constructor(){super(),Object.defineProperty(this,"message",{value:b.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${M}]`,this.stack,delete this.name}get code(){return M}set code(q){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:q,writable:!0})}toString(){return`${this.name} [${M}]: ${this.message}`}}}Ye("ERR_BUFFER_OUT_OF_BOUNDS",function(M){return M?`${M} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ye("ERR_INVALID_ARG_TYPE",function(M,b){return`The "${M}" argument must be of type number. Received type ${typeof b}`},TypeError),Ye("ERR_OUT_OF_RANGE",function(M,b,A){let j=`The value of "${M}" is out of range.`,q=A;return Number.isInteger(A)&&Math.abs(A)>2**32?q=ti(String(A)):typeof A=="bigint"&&(q=String(A),(A>BigInt(2)**BigInt(32)||A<-(BigInt(2)**BigInt(32)))&&(q=ti(q)),q+="n"),j+=` It must be ${b}. Received ${q}`,j},RangeError);function ti(M){let b="",A=M.length;const j=M[0]==="-"?1:0;for(;A>=j+4;A-=3)b=`_${M.slice(A-3,A)}${b}`;return`${M.slice(0,A)}${b}`}function Kt(M,b,A){Oe(b,"offset"),(M[b]===void 0||M[b+A]===void 0)&&Ke(b,M.length-(A+1))}function Ii(M,b,A,j,q,Z){if(M>A||M<b){const ue=typeof b=="bigint"?"n":"";let Fe;throw b===0||b===BigInt(0)?Fe=`>= 0${ue} and < 2${ue} ** ${(Z+1)*8}${ue}`:Fe=`>= -(2${ue} ** ${(Z+1)*8-1}${ue}) and < 2 ** ${(Z+1)*8-1}${ue}`,new Je.ERR_OUT_OF_RANGE("value",Fe,M)}Kt(j,q,Z)}function Oe(M,b){if(typeof M!="number")throw new Je.ERR_INVALID_ARG_TYPE(b,"number",M)}function Ke(M,b,A){throw Math.floor(M)!==M?(Oe(M,A),new Je.ERR_OUT_OF_RANGE("offset","an integer",M)):b<0?new Je.ERR_BUFFER_OUT_OF_BOUNDS:new Je.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${b}`,M)}const Et=/[^+/0-9A-Za-z-_]/g;function Ht(M){if(M=M.split("=")[0],M=M.trim().replace(Et,""),M.length<2)return"";for(;M.length%4!==0;)M=M+"=";return M}function bt(M,b){b=b||1/0;let A;const j=M.length;let q=null;const Z=[];for(let ue=0;ue<j;++ue){if(A=M.charCodeAt(ue),A>55295&&A<57344){if(!q){if(A>56319){(b-=3)>-1&&Z.push(239,191,189);continue}else if(ue+1===j){(b-=3)>-1&&Z.push(239,191,189);continue}q=A;continue}if(A<56320){(b-=3)>-1&&Z.push(239,191,189),q=A;continue}A=(q-55296<<10|A-56320)+65536}else q&&(b-=3)>-1&&Z.push(239,191,189);if(q=null,A<128){if((b-=1)<0)break;Z.push(A)}else if(A<2048){if((b-=2)<0)break;Z.push(A>>6|192,A&63|128)}else if(A<65536){if((b-=3)<0)break;Z.push(A>>12|224,A>>6&63|128,A&63|128)}else if(A<1114112){if((b-=4)<0)break;Z.push(A>>18|240,A>>12&63|128,A>>6&63|128,A&63|128)}else throw new Error("Invalid code point")}return Z}function Nt(M){const b=[];for(let A=0;A<M.length;++A)b.push(M.charCodeAt(A)&255);return b}function mt(M,b){let A,j,q;const Z=[];for(let ue=0;ue<M.length&&!((b-=2)<0);++ue)A=M.charCodeAt(ue),j=A>>8,q=A%256,Z.push(q),Z.push(j);return Z}function mi(M){return e.toByteArray(Ht(M))}function Ot(M,b,A,j){let q;for(q=0;q<j&&!(q+A>=b.length||q>=M.length);++q)b[q+A]=M[q];return q}function St(M,b){return M instanceof b||M!=null&&M.constructor!=null&&M.constructor.name!=null&&M.constructor.name===b.name}function kt(M){return M!==M}const qt=function(){const M="0123456789abcdef",b=new Array(256);for(let A=0;A<16;++A){const j=A*16;for(let q=0;q<16;++q)b[j+q]=M[A]+M[q]}return b}();function Rt(M){return typeof BigInt>"u"?It:M}function It(){throw new Error("BigInt not supported")}})(Qv);const qI=Qv.Buffer,WI=ds("peertube:player:segment-validator"),zI=10;class YI{constructor(e){Qe(this,"destroyed",!1),Qe(this,"segmentJSONPromise"),this.options=e}async validate(e,t,i,s=1){if(this.destroyed)return!1;this.loadSha256SegmentsPromiseIfNeeded();const r=RT(e).split("/").pop(),a=(await this.segmentJSONPromise)[r];if(!a&&s>zI)return ze.clientError(`Unknown segment name ${r} in segment validator`),!1;if(!a)return ze.info(`Refetching sha segments for ${r}`),await HT(500),this.loadSha256SegmentsPromise(),this.validate(e,t,i,s+1);let l,c="";if(typeof a=="string"?l=a:(c=t.start+"-"+t.end,l=a[c]),l===void 0)return ze.clientError(`Unknown segment name ${r}/${c} in segment validator`),!1;WI(`Validating ${r}`+(c?` range ${c}`:""));const h=await this.sha256Hex(i);if(h!==l)return ze.clientError(`Hashes does not correspond for segment ${r}/${c} (expected: ${l} instead of ${h})`),!0}destroy(){this.destroyed=!0}loadSha256SegmentsPromiseIfNeeded(){this.segmentJSONPromise||this.loadSha256SegmentsPromise()}loadSha256SegmentsPromise(){this.segmentJSONPromise=this.fetchSha256Segments()}fetchSha256Segments(){let e={};return Kh(this.options.serverUrl,this.options.segmentsSha256Url)&&(this.options.requiresPassword?e={"x-peertube-video-password":this.options.videoPassword()}:this.options.requiresUserAuth&&(e={Authorization:this.options.authorizationHeader()})),fetch(this.options.segmentsSha256Url,{headers:e}).then(t=>t.json()).catch(t=>(ze.clientError("Cannot get sha256 segments",t),{}))}async sha256Hex(e){if(!e)return;if(window.crypto.subtle)return window.crypto.subtle.digest("SHA-256",e).then(i=>this.bufferToHex(i));const t=(await ST(()=>import("./index-CmBpR0aG-DX6lmGuN.js"),__vite__mapDeps([0,1,2,3])).then(i=>i.i)).default;return new t.sha256().update(qI.from(e)).digest("hex")}bufferToHex(e){if(!e)return"";let t="";const i="0123456789abcdef";return new Uint8Array(e).forEach(r=>{t+=i[r>>4]+i[r&15]}),t}}const XI=ds("peertube:player:hls");class QI{constructor(e){this.options=e}async getPluginOptions(){const e=this.options.hls.segmentsSha256Url;e||ze.info("No segmentsSha256Url found. Disabling P2P & redundancy.");const t=e?new MI(this.options.hls.redundancyBaseUrls):null,i=e?new YI({segmentsSha256Url:e,authorizationHeader:this.options.authorizationHeader,requiresUserAuth:this.options.requiresUserAuth,serverUrl:this.options.serverUrl,requiresPassword:this.options.requiresPassword,videoPassword:this.options.videoPassword}):null,s=await this.options.pluginsManager.runHook("filter:internal.player.p2p-media-loader.options.result",this.getP2PMediaLoaderOptions({redundancyUrlManager:t,segmentValidator:i})),r={requiresUserAuth:this.options.requiresUserAuth,videoFileToken:this.options.videoFileToken,p2pEnabled:e&&this.options.p2pEnabled,redundancyUrlManager:t,type:"application/x-mpegURL",src:this.options.hls.playlistUrl,segmentValidator:i},a={hlsjsConfig:this.getHLSJSOptions(s),levelLabelHandler:(l,c)=>{const h=Math.min(l.height||0,l.width||0),f=this.options.hls.videoFiles.find(m=>m.resolution.id===h),p=BT({resolution:h,height:f?.height??l.height,width:f?.width??l.width});return c.localize(Ag(p,f?.fps??l.frameRate))}};return XI("Creating HLS player options",{hlsjs:a,p2pMediaLoader:r,loaderOptions:s}),{p2pMediaLoader:r,hlsjs:a}}getP2PMediaLoaderOptions(e){var t;const{redundancyUrlManager:i,segmentValidator:s}=e;let r=!1;(((t=navigator?.connection)==null?void 0:t.type)==="cellular"||or.getItem("peertube-videojs-p2p-consume-only")==="true")&&(ze.info("We are on a cellular connection: disabling seeding."),r=!0);const a=this.options.hls.trackerAnnounce.filter(h=>h.startsWith("ws")),l=this.options.isLive?this.getP2PMediaLoaderLiveOptions():this.getP2PMediaLoaderVODOptions();return{loader:{announceTrackers:a,rtcConfig:N_(this.options.stunServers),httpRequestSetup:(h,f,p,m)=>{const{requiresUserAuth:_,requiresPassword:E}=this.options,C=i?i.buildUrl(h):h,S=new Headers;return m&&S.set("Range",`bytes=${m.start}-${m.end??""}`),Kh(this.options.serverUrl,C)&&(E?S.set("x-peertube-video-password",this.options.videoPassword()):_&&S.set("Authorization",this.options.authorizationHeader())),Promise.resolve(new Request(C,{headers:S,signal:p}))},validateP2PSegment:s?s.validate.bind(s):null,validateHTTPSegment:s?s.validate.bind(s):null,isP2PDisabled:!this.options.p2pEnabled,isP2PUploadDisabled:r,swarmId:this.options.hls.playlistUrl,...l}}}getP2PMediaLoaderLiveOptions(){const e={highDemandTimeWindow:4};switch(this.options.liveOptions.latencyMode){case ka.SMALL_LATENCY:return{...e,isP2PDisabled:!0};case ka.HIGH_LATENCY:return e;default:return e}}getP2PMediaLoaderVODOptions(){return{highDemandTimeWindow:15,segmentMemoryStorageLimit:1024}}getHLSJSOptions(e){const t=this.options.isLive?this.getHLSLiveOptions():this.getHLSVODOptions(),i={capLevelToPlayerSize:!0,autoStartLoad:!1,p2pMediaLoaderOptions:e.loader,xhrSetup:(r,a)=>{const{requiresUserAuth:l,requiresPassword:c}=this.options;Kh(this.options.serverUrl,a)&&(c?r.setRequestHeader("x-peertube-video-password",this.options.videoPassword()):l&&r.setRequestHeader("Authorization",this.options.authorizationHeader()))},...t},s=Ug();return s?{...i,abrEwmaDefaultEstimate:s*8,backBufferLength:90,startLevel:-1,testBandwidth:!1,debug:!1,enableWorker:!1}:i}getHLSLiveOptions(){switch(this.options.liveOptions.latencyMode){case ka.SMALL_LATENCY:return{liveSyncDurationCount:2};case ka.HIGH_LATENCY:return{liveSyncDurationCount:10};default:return{liveSyncDurationCount:5}}}getHLSVODOptions(){return{liveSyncDurationCount:5}}}class JI{constructor(e){this.options=e}getPluginOptions(){var e;return{videoFileToken:this.options.videoFileToken,videoFiles:this.options.webVideo.videoFiles.length!==0?this.options.webVideo.videoFiles:((e=this.options.hls)==null?void 0:e.videoFiles)||[]}}}const ZI=X.getComponent("ClickableComponent");class Zv extends ZI{constructor(e,t){super(e,t)}createEl(){this.wrapper=super.createEl("div",{className:"vjs-playlist-button",tabIndex:-1});const e=super.createEl("div",{className:"vjs-playlist-icon",tabIndex:-1});return this.playlistInfoElement=super.createEl("div",{className:"vjs-playlist-info",tabIndex:-1}),this.wrapper.appendChild(e),this.wrapper.appendChild(this.playlistInfoElement),this.update(),this.wrapper}update(){this.playlistInfoElement.innerText=this.options_.getCurrentPosition()+"/"+this.options_.playlist.videosLength,this.wrapper.title=this.player().localize("Playlist: {1}",[this.options_.playlist.displayName])}handleClick(){this.options_.playlistMenu.open()}}X.registerComponent("PlaylistButton",Zv);const ey=X.getComponent("Component");class ty extends ey{constructor(e,t){super(e,t),this.emitTapEvents(),this.element=t.element,this.clickHandler=()=>this.switchPlaylistItem(),this.keyDownHandler=i=>this.handleKeyDown(i),this.on(["click","tap"],this.clickHandler),this.on("keydown",this.keyDownHandler)}dispose(){this.off(["click","tap"],this.clickHandler),this.off("keydown",this.keyDownHandler),super.dispose()}createEl(){const e=super.createEl("li",{className:"vjs-playlist-menu-item"});this.options_.element.video||e.classList.add("vjs-disabled");const t=super.createEl("div",{className:"item-position-block"}),i=super.createEl("div",{className:"item-position",innerText:this.options_.element.position});return t.appendChild(i),e.appendChild(t),this.options_.element.video?this.buildAvailableVideo(e,t,this.options_):this.buildUnavailableVideo(e),e}setSelected(e){e?this.addClass("vjs-selected"):this.removeClass("vjs-selected")}getElement(){return this.element}buildAvailableVideo(e,t,i){const s=i.element,r=super.createEl("div",{className:"item-player"});t.appendChild(r);const a=super.createEl("img",{src:window.location.origin+s.video.thumbnailPath}),l=super.createEl("div",{className:"info-block"}),c=super.createEl("div",{innerText:s.video.name,className:"title"}),h=super.createEl("div",{innerText:s.video.channel.displayName,className:"channel"});if(l.appendChild(c),l.appendChild(h),s.startTimestamp||s.stopTimestamp){let f="";s.startTimestamp&&(f+=Os(s.startTimestamp)),s.stopTimestamp&&(f+=" - "+Os(s.stopTimestamp));const p=super.createEl("div",{innerText:f,className:"timestamps"});l.append(p)}e.append(a),e.append(l)}buildUnavailableVideo(e){const t=super.createEl("div",{className:"item-unavailable",innerText:this.player().localize("Unavailable video")});e.appendChild(t)}handleKeyDown(e){(e.code==="Space"||e.code==="Enter")&&this.switchPlaylistItem()}switchPlaylistItem(){this.options_.onClicked()}}ey.registerComponent("PlaylistMenuItem",ty);const iy=X.getComponent("Component");class sy extends iy{constructor(e,t){super(e,t),this.menuItems=[],this.userInactiveHandler=()=>{this.close()},this.onMouseEnter=()=>{this.player().off("userinactive",this.userInactiveHandler)},this.onMouseLeave=()=>{this.player().one("userinactive",this.userInactiveHandler)},this.onPlayerCick=i=>{let s=i.target;do{if(s.classList.contains("vjs-playlist-menu")||s.classList.contains("vjs-playlist-button"))return;s=s.parentElement}while(s);this.close()},this.el().addEventListener("mouseenter",this.onMouseEnter),this.el().addEventListener("mouseleave",this.onMouseLeave),this.player().on("click",this.onPlayerCick)}dispose(){this.el().removeEventListener("mouseenter",this.onMouseEnter),this.el().removeEventListener("mouseleave",this.onMouseLeave),this.player().off("userinactive",this.userInactiveHandler),this.player().off("click",this.onPlayerCick);for(const e of this.menuItems)e.dispose();super.dispose()}createEl(){this.menuItems=[];const e=super.createEl("div",{className:"vjs-playlist-menu",tabIndex:-1}),t=super.createEl("div",{className:"header"}),i=super.createEl("div"),s=super.createEl("div",{innerText:this.options_.playlist.displayName,className:"title"}),r=this.options_.playlist.videoChannel,a=super.createEl("div",{innerText:r?this.player().localize("By {1}",[r.displayName]):"",className:"channel"});i.appendChild(s),i.appendChild(a);const l=super.createEl("div",{className:"cross"});l.addEventListener("click",()=>this.close()),t.appendChild(i),t.appendChild(l);const c=super.createEl("ol");for(const h of this.options_.elements){const f=new ty(this.player(),{element:h,onClicked:()=>this.onItemClicked(h)});c.appendChild(f.el()),this.menuItems.push(f)}return e.appendChild(t),e.appendChild(c),this.update(),e}update(){this.updateSelected(this.options_.getCurrentPosition())}open(){this.player().addClass("playlist-menu-displayed")}close(){this.player().removeClass("playlist-menu-displayed")}updateSelected(e){for(const t of this.menuItems)t.setSelected(t.getElement().position===e)}onItemClicked(e){this.options_.onItemClicked(e)}}iy.registerComponent("PlaylistMenu",sy);const eL=X.getPlugin("plugin");class tL extends eL{constructor(e,t){super(e,t),this.player.addClass("vjs-playlist"),this.playlistMenu=new sy(e,t),this.playlistButton=new Zv(e,{...t,playlistMenu:this.playlistMenu}),e.addChild(this.playlistMenu,t),e.addChild(this.playlistButton,t)}dispose(){this.player.removeClass("vjs-playlist"),this.playlistMenu.dispose(),this.playlistButton.dispose(),this.player.removeChild(this.playlistMenu),this.player.removeChild(this.playlistButton),super.dispose()}}X.registerPlugin("playlist",tL);const iL=X.getPlugin("plugin");class sL extends iL{constructor(e){super(e),this.resolutions=[],e.on("video-change",()=>{this.resolutions=[],this.trigger("resolutions-removed")})}add(e){for(const t of e)this.resolutions.push(t);this.currentSelection=this.getSelected(),this.sort(),this.trigger("resolutions-added")}remove(e){this.resolutions=this.resolutions.filter(t=>t.id!==e),this.trigger("resolutions-removed")}getResolutions(){return this.resolutions}getSelected(){return this.resolutions.find(e=>e.selected)}getAutoResolutionChosen(){return this.resolutions.find(e=>e.id===this.autoResolutionChosenId)}select(e){var t;const{id:i,autoResolutionChosenId:s,fireCallback:r}=e;if(!(((t=this.currentSelection)==null?void 0:t.id)===i&&this.autoResolutionChosenId===s)){s!==void 0&&(this.autoResolutionChosenId=s);for(const a of this.resolutions)a.selected=a.id===i,a.selected&&(this.currentSelection=a,r&&a.selectCallback());this.trigger("resolutions-changed")}}sort(){this.resolutions.sort((e,t)=>e.id===-1?1:t.id===-1||e.height>t.height?-1:e.height===t.height?0:1)}}X.registerPlugin("peertubeResolutions",sL);const rL=X.getComponent("Menu"),nL=X.getComponent("Component");class ry extends rL{stepForward(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)}focus(e){e===void 0&&(this.focusedChild_=-1,e=0),this._focus(e)}_focus(e){const t=this.children().slice();if(t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0){e<0?e=0:e>=t.length&&(e=t.length-1);const s=t[e].el();if(s.classList.contains("vjs-hidden"))return this.focusedChild_<e?e===t.length-1?void 0:this.focus(e+1):e===0?void 0:this.focus(e-1);this.focusedChild_=e,s.focus()}}}nL.registerComponent("MenuFocusFixed",ry);const aL=X.getComponent("MenuItem");class ny extends aL{constructor(e,t){super(e,{...t,selectable:!0}),this.autoResolutionChosen="",this.resolutionId=t.resolutionId,this.label=t.label,this.updateSelectionHandler=()=>this.updateSelection(),e.peertubeResolutions().on("resolutions-changed",this.updateSelectionHandler)}dispose(){this.player().peertubeResolutions().off("resolutions-changed",this.updateSelectionHandler),super.dispose()}handleClick(e){super.handleClick(e),this.player().peertubeResolutions().select({id:this.resolutionId,fireCallback:!0})}updateSelection(){var e;const t=this.player().peertubeResolutions().getSelected();this.resolutionId===-1&&(this.autoResolutionChosen=(e=this.player().peertubeResolutions().getAutoResolutionChosen())==null?void 0:e.label),this.selected(this.resolutionId===t.id)}getLabel(){return this.resolutionId===-1?this.label+" <small>"+this.autoResolutionChosen+"</small>":this.label}}X.registerComponent("ResolutionMenuItem",ny);const oL=X.getComponent("Menu"),lL=X.getComponent("MenuButton");class uL extends lL{constructor(e,t){super(e,t),this.controlText("Quality"),e.peertubeResolutions().on("resolutions-added",()=>this.update()),e.peertubeResolutions().on("resolutions-removed",()=>this.update()),e.peertubeResolutions().on("resolutions-changed",()=>{setTimeout(()=>this.trigger("label-updated"))})}createEl(){const e=super.createEl();return this.labelEl_=X.dom.createEl("div",{className:"vjs-resolution-value"}),e.appendChild(this.labelEl_),e}updateARIAAttributes(){this.el().setAttribute("aria-label","Quality")}createMenu(){const e=new oL(this.player_,{menuButton:this}),t=this.player().peertubeResolutions().getResolutions();for(const i of t){const s=i.label==="0p"?this.player().localize("Audio only"):i.label,r=new ny(this.player_,{id:i.id+"",resolutionId:i.id,label:s,selected:i.selected});e.addItem(r)}return e}update(){super.update(),this.trigger("resolution-menu-changed")}buildCSSClass(){return"vjs-resolution-button "+super.buildCSSClass()}buildWrapperCSSClass(){return"vjs-resolution-control "+super.buildWrapperCSSClass()}}X.registerComponent("ResolutionMenuButton",uL);const ay=X.getComponent("Component");class hL extends ay{constructor(e){super(e),this.hide()}createEl(){const e=this.player().id(),t="TTsettingsDialogLabel-"+e,i="TTsettingsDialogDescription-"+e;return super.createEl("div",{className:"vjs-settings-dialog vjs-modal-overlay",id:"vjs-settings-dialog-"+e,tabIndex:-1},{role:"dialog","aria-labelledby":t,"aria-describedby":i})}show(){this.player().addClass("vjs-settings-dialog-opened"),super.show()}hide(){this.player().removeClass("vjs-settings-dialog-opened"),super.hide()}}ay.registerComponent("SettingsDialog",hL);const vg=ds("peertube:player:settings"),yg=X.getComponent("MenuItem"),cL=X.getComponent("Component");class Ac extends yg{constructor(e,t){super(e,t),this.settingsButton=t.menuButton,this.dialog=this.settingsButton.dialog,this.mainMenu=this.settingsButton.menu,this.panel=this.dialog.getChild("settingsPanel"),this.panelChild=this.panel.getChild("settingsPanelChild"),this.panelChildEl=this.panelChild.el(),this.size=null,this.menuToLoad="mainmenu";const i=zg(t.entry),s=X.getComponent(i);if(!s)throw new Error(`Component ${i} does not exist`);const r=Object.assign({},t,{entry:t.menuButton,menuButton:this});this.subMenu=new s(this.player(),r);const a=this.subMenu.buildCSSClass().split(" ")[0];this.settingsSubMenuEl_.className+=" "+a,this.eventHandlers(),e.ready(()=>{setTimeout(()=>{this.player_&&(this.build(),i==="PlaybackRateMenuButton"&&(e.on("ratechange",this.submenuClickHandler),e.on("playbackrateschange",()=>{setTimeout(()=>this.rebuildAfterMenuChange())})),i==="CaptionsButton"&&(e.on("captions-changed",()=>{setTimeout(()=>this.rebuildAfterMenuChange())}),e.on("texttrackchange",this.submenuClickHandler)),i==="ResolutionMenuButton"&&this.subMenu.on("resolution-menu-changed",()=>{this.rebuildAfterMenuChange()}),this.reset())},0)})}dispose(){this.settingsSubMenuEl_.removeEventListener("transitionend",this.transitionEndHandler),super.dispose()}eventHandlers(){this.submenuClickHandler=this.onSubmenuClick.bind(this),this.transitionEndHandler=this.onTransitionEnd.bind(this)}onSubmenuClick(e){let t=null;if(e.type==="tap"?t=e.target:t=e.currentTarget||e.target,t?.classList.contains("vjs-back-button")){this.loadMainMenu();return}setTimeout(()=>this.update(e),0),this.subMenu.menu.removeClass("vjs-hidden")}createEl(){const e=X.dom.createEl("li",{className:"vjs-menu-item",tabIndex:0});return this.settingsSubMenuTitleEl_=X.dom.createEl("div",{className:"vjs-settings-sub-menu-title"}),e.appendChild(this.settingsSubMenuTitleEl_),this.settingsSubMenuValueEl_=X.dom.createEl("div",{className:"vjs-settings-sub-menu-value"}),e.appendChild(this.settingsSubMenuValueEl_),this.settingsSubMenuEl_=X.dom.createEl("div",{className:"vjs-settings-sub-menu"}),e}handleClick(e){this.menuToLoad="submenu",X.dom.removeClass(this.el(),"open"),super.handleClick(e),this.mainMenu.el().style.opacity="0",X.dom.hasClass(this.settingsSubMenuEl_,"vjs-hidden")?(X.dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),setTimeout(()=>{this.settingsSubMenuEl_.style.opacity="1",this.settingsSubMenuEl_.style.marginRight="0px"},0),this.settingsButton.setDialogSize(this.size),this.subMenu.menu.focus()):X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}createBackButton(){const e=this.subMenu.menu.addChild("MenuItem",{},0);e.setAttribute("aria-label",this.player().localize("Go back")),e.addClass("vjs-back-button"),e.el().innerHTML=this.player().localize(this.subMenu.controlText())}onTransitionEnd(e){e.propertyName==="margin-right"&&this.menuToLoad==="mainmenu"&&(X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0")}reset(){X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0",this.setMargin()}loadMainMenu(){const e=this.mainMenu.el();this.menuToLoad="mainmenu",this.mainMenu.show(),e.style.opacity="0";const t=this.mainMenu;this.settingsButton.setDialogSize([t.width(),t.height()]),setTimeout(()=>{this.setMargin(),e.style.opacity="1",this.mainMenu.focus()},0)}build(){this.subMenu.on("label-updated",()=>{this.update()}),this.settingsSubMenuTitleEl_.innerHTML=this.player().localize(this.subMenu.controlText()),this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el()),this.panelChildEl.appendChild(this.settingsSubMenuEl_),this.update(),this.createBackButton(),this.setSize(),this.bindClickEvents(),this.bindKeyEvents(),this.settingsSubMenuEl_.addEventListener("transitionend",this.transitionEndHandler,!1)}update(e){if(this.subMenu.name()==="PlaybackRateMenuButton")this.settingsSubMenuValueEl_.innerHTML=this.subMenu.labelEl_.textContent;else for(const i of this.subMenu.menu.children_){if(!(i instanceof yg))continue;const s=i;if(s.isSelected_){if(typeof s.getLabel=="function"){this.settingsSubMenuValueEl_.innerHTML=s.getLabel();break}this.settingsSubMenuValueEl_.innerHTML=this.player().localize(s.options_.label)}}let t=null;e&&e.type==="tap"?t=e.target:e&&(t=e.currentTarget),t&&!t.classList.contains("vjs-back-button")&&this.settingsButton.hideDialog()}bindClickEvents(){for(const e of this.subMenu.menu.children())e instanceof cL&&e.on(["tap","click"],this.submenuClickHandler)}bindKeyEvents(){this.subMenu.menu.on("escaped-key",()=>{this.trigger("escaped-key")}),this.subMenu.menu.on("arrow-left",()=>{vg("Detected arrow left on sub menu "+this.subMenu.name()),this.loadMainMenu()})}setSize(){this.dialog.removeClass("vjs-hidden"),X.dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),this.size=this.settingsButton.getComponentSize(this.settingsSubMenuEl_),this.setMargin(),this.dialog.addClass("vjs-hidden"),X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}setMargin(){if(!this.size)return;const[e]=this.size;this.settingsSubMenuEl_.style.marginRight=`-${e}px`}hideSubMenu(){this.el()&&X.dom.hasClass(this.el(),"open")&&(X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),X.dom.removeClass(this.el(),"open"))}rebuildAfterMenuChange(){vg("Rebuilding menu "+this.subMenu.name()+" after change"),this.settingsSubMenuEl_.innerHTML="",this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el()),this.update(),this.createBackButton(),this.setSize(),this.bindClickEvents(),this.bindKeyEvents()}}Ac.prototype.contentElType="button";X.registerComponent("SettingsMenuItem",Ac);const dL=ds("peertube:player:settings"),fL=X.getComponent("Button"),oy=X.getComponent("Component");class pL extends fL{constructor(e,t){super(e,t),this.settingsButtonOptions=t,this.controlText("Settings"),this.dialog=this.player().addChild("settingsDialog"),this.dialogEl=this.dialog.el(),this.menu=null,this.panel=this.dialog.addChild("settingsPanel"),this.panelChild=this.panel.addChild("settingsPanelChild"),this.addClass("vjs-settings"),this.setAttribute("aria-controls","vjs-settings-dialog-"+this.player().id()),this.addSettingsItemHandler=this.onAddSettingsItem.bind(this),this.disposeSettingsItemHandler=this.onDisposeSettingsItem.bind(this),this.documentClickHandler=this.onDocumentClick.bind(this),this.userInactiveHandler=this.onUserInactive.bind(this),this.buildMenu(),this.bindEvents(),this.player().one("play",()=>this.hideDialog())}onDocumentClick(e){var t,i,s;const r=e.target;(t=r?.classList)!=null&&t.contains("vjs-settings")||(s=(i=r?.parentElement)==null?void 0:i.classList)!=null&&s.contains("vjs-settings")||this.dialog.hasClass("vjs-hidden")||this.hideDialog()}onDisposeSettingsItem(e,t){if(t===void 0){const i=this.menu.children();for(;i.length>0;)i[0].dispose(),this.menu.removeChild(i[0]);this.addClass("vjs-hidden")}else{const i=this.menu.getChild(t);i&&(i.dispose(),this.menu.removeChild(i))}this.hideDialog(),this.settingsButtonOptions.entries.length===0&&this.addClass("vjs-hidden")}dispose(){document.removeEventListener("click",this.documentClickHandler),this.isInIframe()&&window.removeEventListener("blur",this.documentClickHandler),super.dispose()}onAddSettingsItem(e,t){const[i,s]=t;this.addMenuItem(i,s),this.removeClass("vjs-hidden")}onUserInactive(){this.dialog.hasClass("vjs-hidden")||this.hideDialog()}bindEvents(){document.addEventListener("click",this.documentClickHandler),this.isInIframe()&&window.addEventListener("blur",this.documentClickHandler),this.player().on("addsettingsitem",this.addSettingsItemHandler),this.player().on("disposesettingsitem",this.disposeSettingsItemHandler),this.player().on("userinactive",this.userInactiveHandler)}buildCSSClass(){return`vjs-icon-settings ${super.buildCSSClass()}`}handleClick(){this.dialog.hasClass("vjs-hidden")?this.showDialog():this.hideDialog()}showDialog(){this.player().peertube().onMenuOpened(),this.menu.el().style.opacity="1",this.dialog.show(),this.el().setAttribute("aria-expanded","true"),this.setDialogSize(this.getComponentSize(this.menu)),this.menu.focus()}hideDialog(){this.player_.peertube().onMenuClosed(),this.dialog.hide(),this.el().setAttribute("aria-expanded","false"),this.setDialogSize(this.getComponentSize(this.menu)),this.menu.el().style.opacity="1",this.resetChildren()}getComponentSize(e){let t=null,i=null;if(e instanceof oy){const s=e.el();t=s.offsetWidth,i=s.offsetHeight}else t=e.offsetWidth,i=e.offsetHeight;return[t,i]}setDialogSize([e,t]){if(typeof t!="number")return;const i=this.settingsButtonOptions.setup.maxHeightOffset,s=this.player().el().offsetHeight-i,r=this.panel.el();t>s?(t=s,e+=15,r.style.maxHeight=`${t}px`):r.style.maxHeight!==""&&(r.style.maxHeight=""),this.dialogEl.style.width=`${e}px`,this.dialogEl.style.height=`${t}px`}buildMenu(){this.menu=new ry(this.player()),this.menu.on("escaped-key",()=>{this.hideDialog(),this.focus()}),this.menu.on("arrow-right",(t,i)=>{dL("Detected arrow right on menu item",i),i.click()}),this.menu.addClass("vjs-main-menu");const e=this.settingsButtonOptions.entries;if(e.length===0){this.addClass("vjs-hidden"),this.panelChild.addChild(this.menu);return}for(const t of e)this.addMenuItem(t,this.settingsButtonOptions);this.panelChild.addChild(this.menu)}addMenuItem(e,t){const i=function(){X.dom.hasClass(this.el_,"open")?X.dom.removeClass(this.el_,"open"):X.dom.addClass(this.el_,"open")};t.name=zg(e);const s=Object.assign({},t,{entry:e,menuButton:this}),r=new Ac(this.player(),s);this.menu.addChild(r),r.on("click",X.bind(this,this.hideChildren)),r.on("click",i),r.on("escaped-key",()=>{this.hideDialog(),this.focus()})}resetChildren(){for(const e of this.menu.children())e.reset()}hideChildren(){for(const e of this.menu.children())e.hideSubMenu()}isInIframe(){return window.self!==window.top}}oy.registerComponent("SettingsButton",pL);const ly=X.getComponent("Component");class gL extends ly{createEl(){return super.createEl("div",{className:"vjs-settings-panel",tabIndex:-1})}}ly.registerComponent("SettingsPanel",gL);const uy=X.getComponent("Component");class mL extends uy{createEl(){return super.createEl("div",{className:"vjs-settings-panel-child",tabIndex:-1})}}uy.registerComponent("SettingsPanelChild",mL);const vL=X.getComponent("Component");class hy extends vL{constructor(e,t){super(e,t),this.metadataStore={},this.intervalMs=300,this.playerNetworkInfo={}}createEl(){this.containerEl=X.dom.createEl("div",{className:"vjs-stats-content"}),this.containerEl.style.display="none",this.infoListEl=X.dom.createEl("div",{className:"vjs-stats-list"});const e=X.dom.createEl("button",{className:"vjs-stats-close",tabindex:"0",title:"Close stats",innerText:"[x]"},{"aria-label":"Close stats"});return e.onclick=()=>this.hide(),this.containerEl.appendChild(e),this.containerEl.appendChild(this.infoListEl),this.populateInfoBlocks(),this.onNetworkInfoHandler=(t,i)=>{this.mode=i.source;const s=i.p2p,r=i.http;this.playerNetworkInfo.downloadSpeed=Zt((s?.downloadSpeed||0)+(r.downloadSpeed||0)).join(" "),this.playerNetworkInfo.uploadSpeed=Zt(s?.uploadSpeed||0).join(" "),this.playerNetworkInfo.totalDownloaded=Zt((s?.downloaded||0)+r.downloaded).join(" "),this.playerNetworkInfo.totalUploaded=Zt(s?.uploaded||0).join(" "),this.playerNetworkInfo.numPeers=s?.peersWithWebSeed,i.source==="p2p-media-loader"&&(this.playerNetworkInfo.averageBandwidth=Zt(i.bandwidthEstimate).join(" ")+"/s",this.playerNetworkInfo.downloadedFromServer=Zt(r.downloaded).join(" "),this.playerNetworkInfo.downloadedFromPeers=Zt(s?.downloaded||0).join(" "))},this.player().on("network-info",this.onNetworkInfoHandler),this.containerEl}dispose(){this.updateInterval&&clearInterval(this.updateInterval),this.player().off("network-info",this.onNetworkInfoHandler),super.dispose()}toggle(){this.updateInterval?this.hide():this.show()}show(){this.containerEl.style.display="block",this.updateInterval=setInterval(async()=>{if(this.mode)try{const e=this.mode==="p2p-media-loader"?this.buildHLSOptions():await this.buildWebVideoOptions();this.populateInfoValues(e)}catch(e){ze.error("Cannot update stats.",e),clearInterval(this.updateInterval)}},this.intervalMs)}hide(){clearInterval(this.updateInterval),this.containerEl.style.display="none"}buildHLSOptions(){const e=this.player_.p2pMediaLoader(),t=e.getCurrentLevel(),i=t?.videoCodec||t?.audioCodec?`${t?.videoCodec||""} / ${t?.audioCodec||""}`:void 0,s=t?.height?`${t.height}p${t?.attrs["FRAME-RATE"]||""}`:void 0,r=this.timeRangesToString(this.player().buffered());let a,l,c;return this.options_.videoIsLive?(l=Os(e.getLiveLatency()),c=Os(e.getLiveLatencyFromEdge())):a=this.player().bufferedPercent(),{playerNetworkInfo:this.playerNetworkInfo,resolution:s,codecs:i,buffer:r,latency:l,latencyFromEdge:c,progress:a}}async buildWebVideoOptions(){var e;const t=this.player_.webVideo().getCurrentVideoFile();this.metadataStore[t.fileUrl]||(this.metadataStore[t.fileUrl]=await fetch(t.metadataUrl).then(h=>h.json()));const i=this.metadataStore[t.fileUrl];let s="unknown",r="unknown";if((e=i?.streams)!=null&&e[0]){const h=i.streams[0];s=h.color_space!=="unknown"?h.color_space:"bt709",r=h.codec_name||"avc1"}const a=t?.resolution.label+t?.fps,l=this.timeRangesToString(this.player_.buffered()),c=this.player_.bufferedPercent();return{playerNetworkInfo:this.playerNetworkInfo,progress:c,colorSpace:s,codecs:r,resolution:a,buffer:l}}populateInfoBlocks(){this.playerMode=this.buildInfoRow(this.player().localize("Player mode")),this.p2p=this.buildInfoRow(this.player().localize("P2P")),this.uuid=this.buildInfoRow(this.player().localize("Video UUID")),this.viewport=this.buildInfoRow(this.player().localize("Viewport / Frames")),this.resolution=this.buildInfoRow(this.player().localize("Resolution")),this.volume=this.buildInfoRow(this.player().localize("Volume")),this.codecs=this.buildInfoRow(this.player().localize("Codecs")),this.color=this.buildInfoRow(this.player().localize("Color")),this.connection=this.buildInfoRow(this.player().localize("Connection Speed")),this.network=this.buildInfoRow(this.player().localize("Network Activity")),this.transferred=this.buildInfoRow(this.player().localize("Total Transfered")),this.download=this.buildInfoRow(this.player().localize("Download Breakdown")),this.bufferProgress=this.buildInfoRow(this.player().localize("Buffer Progress")),this.bufferState=this.buildInfoRow(this.player().localize("Buffer State")),this.liveLatency=this.buildInfoRow(this.player().localize("Live Latency")),this.infoListEl.appendChild(this.playerMode.root),this.infoListEl.appendChild(this.p2p.root),this.infoListEl.appendChild(this.uuid.root),this.infoListEl.appendChild(this.viewport.root),this.infoListEl.appendChild(this.resolution.root),this.infoListEl.appendChild(this.volume.root),this.infoListEl.appendChild(this.codecs.root),this.infoListEl.appendChild(this.color.root),this.infoListEl.appendChild(this.connection.root),this.infoListEl.appendChild(this.network.root),this.infoListEl.appendChild(this.transferred.root),this.infoListEl.appendChild(this.download.root),this.infoListEl.appendChild(this.bufferProgress.root),this.infoListEl.appendChild(this.bufferState.root),this.infoListEl.appendChild(this.liveLatency.root)}populateInfoValues(e){const{playerNetworkInfo:t,progress:i,colorSpace:s,codecs:r,resolution:a,buffer:l,latency:c,latencyFromEdge:h}=e,{downloadedFromServer:f,downloadedFromPeers:p}=t,m=this.player(),_=m.getVideoPlaybackQuality(),E=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),C=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),S=(window.devicePixelRatio||1).toFixed(2),I=`${E}x${C}*${S}`,{droppedVideoFrames:R,totalVideoFrames:k}=_,D=m.localize("{1} / {2} dropped of {3}",[I,R+"",k+""]),x=m.duration();let N=`${Math.round(m.volume()*100)}`;m.muted()&&(N+=m.localize(" (muted)"));const B=t.downloadSpeed?`${t.downloadSpeed} ⇓ / ${t.uploadSpeed} ⇑`:void 0;let H=t.totalDownloaded?`${t.totalDownloaded} ⇓`:"";t.totalUploaded&&(H+=`/ ${t.totalUploaded} ⇑`);const O=t.downloadedFromServer?m.localize("{1} from servers · {2} from peers",[f,p]):void 0,P=i!==void 0?`${(i*100).toFixed(1)}% (${(i*x).toFixed(1)}s)`:void 0,G=this.options_.p2pEnabled&&this.mode==="p2p-media-loader";this.setInfoValue(this.playerMode,this.mode==="p2p-media-loader"?"P2P Media Loader (v2)":"Web Video"),this.setInfoValue(this.p2p,m.localize(G?"enabled":"disabled")),this.setInfoValue(this.uuid,this.options_.videoUUID),this.setInfoValue(this.viewport,D),this.setInfoValue(this.resolution,a),this.setInfoValue(this.volume,N),this.setInfoValue(this.codecs,r),this.setInfoValue(this.color,s),this.setInfoValue(this.transferred,H),this.setInfoValue(this.connection,t.averageBandwidth),this.setInfoValue(this.network,B),this.setInfoValue(this.download,O),this.setInfoValue(this.bufferProgress,P),this.setInfoValue(this.bufferState,l),c&&h&&this.setInfoValue(this.liveLatency,m.localize("{1} (from edge: {2})",[c,h]))}setInfoValue(e,t){if(!t){e.root.style.display="none";return}e.root.style.display="block",e.value.innerText!==t&&(e.value.innerText=t)}buildInfoRow(e){const t=X.dom.createEl("div");t.style.display="none";const i=X.dom.createEl("div",{innerText:e}),s=X.dom.createEl("span");return t.appendChild(i),t.appendChild(s),{root:t,value:s}}timeRangesToString(e){let t="";for(let i=0;i<e.length;i++){const s=Math.floor(e.start(i)),r=Math.floor(e.end(i));t+=`[${Os(s)}, ${Os(r)}] `}return t}}X.registerComponent("StatsCard",hy);const yL=X.getPlugin("plugin");class TL extends yL{constructor(e,t){super(e),this.player.ready(()=>{e.addClass("vjs-stats-for-nerds")}),this.statsCard=new hy(e,t),e.addChild(this.statsCard)}dispose(){this.statsCard&&(this.statsCard.dispose(),this.player.removeChild(this.statsCard)),super.dispose()}show(){this.statsCard.show()}}X.registerPlugin("stats",TL);function _L(n){return`
    <div class="vjs-upnext-top">
      <span class="vjs-upnext-headtext">${n.headText}</span>
      <div class="vjs-upnext-title"></div>
    </div>
    <div class="vjs-upnext-autoplay-icon">
      <svg height="100%" version="1.1" viewbox="0 0 98 98" width="100%">
        <circle class="vjs-upnext-svg-autoplay-circle" cx="49" cy="49" fill="#000" fill-opacity="0.8" r="48"></circle>
        <circle class="vjs-upnext-svg-autoplay-ring" cx="-49" cy="49" fill-opacity="0" r="46.5"
                stroke="#FFFFFF" stroke-width="4" transform="rotate(-90)"
        ></circle>
        <polygon class="vjs-upnext-svg-autoplay-triangle" fill="#fff" points="32,27 72,49 32,71"></polygon></svg>
    </div>
    <span class="vjs-upnext-bottom">
      <span class="vjs-upnext-cancel">
        <button class="vjs-upnext-cancel-button" tabindex="0" aria-label="Cancel autoplay">${n.cancelText}</button>
      </span>
      <span class="vjs-upnext-suspended">${n.suspendedText}</span>
    </span>
  `}const EL=X.getComponent("Component");class cy extends EL{constructor(e,t){super(e,t),this.dashOffsetTotal=586,this.dashOffsetStart=293,this.interval=50,this.upNextEvents=new X.EventTarget,this.ticks=0,this.totalTicks=this.options_.timeout/this.interval,this.onEndedHandler=()=>{this.options_.isDisplayed()&&(e.addClass("vjs-upnext--showing"),this.showCard(i=>{e.removeClass("vjs-upnext--showing"),this.container.style.display="none",i||this.options_.next()}))},this.onPlayingHandler=()=>{this.upNextEvents.trigger("playing")},e.on(["auto-stopped","ended"],this.onEndedHandler),e.on("playing",this.onPlayingHandler)}dispose(){this.onEndedHandler&&this.player().off(["auto-stopped","ended"],this.onEndedHandler),this.onPlayingHandler&&this.player().off("playing",this.onPlayingHandler),this.timeout&&clearTimeout(this.timeout),super.dispose()}createEl(){const e=super.createEl("div",{className:"vjs-upnext-content",innerHTML:_L(this.options_)});return this.container=e,e.style.display="none",this.autoplayRing=e.getElementsByClassName("vjs-upnext-svg-autoplay-ring")[0],this.title=e.getElementsByClassName("vjs-upnext-title")[0],this.cancelButton=e.getElementsByClassName("vjs-upnext-cancel-button")[0],this.suspendedMessage=e.getElementsByClassName("vjs-upnext-suspended")[0],this.nextButton=e.getElementsByClassName("vjs-upnext-autoplay-icon")[0],this.cancelButton.onclick=()=>{this.upNextEvents.trigger("cancel")},this.nextButton.onclick=()=>{this.upNextEvents.trigger("next")},e}showCard(e){if(this.autoplayRing.setAttribute("stroke-dasharray",`${this.dashOffsetStart}`),this.autoplayRing.setAttribute("stroke-dashoffset",`${-this.dashOffsetStart}`),this.title.innerText=this.options_.getTitle(),this.totalTicks===0)return e(!1);this.upNextEvents.one("cancel",()=>{clearTimeout(this.timeout),this.timeout=void 0,e(!0)}),this.upNextEvents.one("playing",()=>{clearTimeout(this.timeout),this.timeout=void 0,e(!0)}),this.upNextEvents.one("next",()=>{clearTimeout(this.timeout),this.timeout=void 0,e(!1)});const t=r=>{const a=Math.max(-this.dashOffsetTotal,-this.dashOffsetStart-r*this.dashOffsetTotal/2/100);this.autoplayRing.setAttribute("stroke-dashoffset",""+a)},i=()=>{t(this.ticks++*100/this.totalTicks)},s=()=>{this.options_.isSuspended()?(this.suspendedMessage.innerText=this.options_.suspendedText,t(0),this.ticks=0,this.timeout=setTimeout(s.bind(this),300)):this.ticks>=this.totalTicks?(clearTimeout(this.timeout),this.timeout=void 0,e(!1)):(this.suspendedMessage.innerText="",i(),this.timeout=setTimeout(s.bind(this),this.interval))};this.container.style.display="block",this.timeout=setTimeout(s.bind(this),this.interval)}}X.registerComponent("EndCard",cy);const bL=X.getPlugin("plugin");class SL extends bL{constructor(e,t){super(e);const i={next:t.next,getTitle:t.getTitle,timeout:t.timeout,cancelText:e.localize("Cancel"),headText:e.localize("Up Next"),suspendedText:e.localize("Autoplay is suspended"),isDisplayed:t.isDisplayed,isSuspended:t.isSuspended};this.player.ready(()=>{e.addClass("vjs-upnext")});const s=new cy(e,i);e.addChild(s),this.on("dispose",()=>e.removeChild(s))}}X.registerPlugin("upnext",SL);const Tg=ds("peertube:player:web-video-plugin"),CL=X.getPlugin("plugin");class wL extends CL{constructor(e,t){super(e,t),this.videoFiles=t.videoFiles,this.videoFileToken=t.videoFileToken;const i=this.pickAverageVideoFile();i&&this.updateVideoFile({videoFile:i,isUserResolutionChange:!1}),this.onLoadedMetadata=()=>{e.trigger("video-ratio-changed",{ratio:this.player.videoWidth()/this.player.videoHeight()})},e.on("loadedmetadata",this.onLoadedMetadata),e.ready(()=>{if(this.videoFiles.length===0){this.player.addClass("disabled");return}this.buildQualities(),this.setupNetworkInfoInterval()})}dispose(){this.networkInfoInterval&&clearInterval(this.networkInfoInterval),this.onLoadedMetadata&&this.player.off("loadedmetadata",this.onLoadedMetadata),this.onErrorHandler&&this.player.off("error",this.onErrorHandler),this.onPlayHandler&&this.player.off("canplay",this.onPlayHandler),super.dispose()}getCurrentResolutionId(){var e;return(e=this.currentVideoFile)==null?void 0:e.resolution.id}updateVideoFile(e){this.currentVideoFile=e.videoFile,Tg("Updating web video file to "+this.currentVideoFile.fileUrl);const t=this.player.paused(),i=this.player.playbackRate(),s=this.player.currentTime();this.onErrorHandler||(this.onErrorHandler=()=>this.player.peertube().displayFatalError(),this.player.one("error",this.onErrorHandler));let r=this.currentVideoFile.fileUrl;this.videoFileToken()&&(r=Eg(r,{videoFileToken:this.videoFileToken()}));const a=this.player.autoplay();e.isUserResolutionChange&&(this.player.autoplay(!1),this.player.addClass("vjs-updating-resolution")),this.player.src(r),this.onPlayHandler=()=>{var l;this.player.playbackRate(i),this.player.currentTime(s),this.player.trigger("resolution-change",{resolution:(l=this.currentVideoFile)==null?void 0:l.resolution.id,initResolutionChange:!e.isUserResolutionChange}),e.isUserResolutionChange&&(this.player.trigger("web-video-source-change"),this.tryToPlay().then(()=>{t&&this.player.pause(),this.player.autoplay(a)}))},this.player.one("canplay",this.onPlayHandler)}getCurrentVideoFile(){return this.currentVideoFile}tryToPlay(){Tg("Try to play manually the video");const e=this.player.play();if(e!==void 0)return e.catch(t=>{t.message.includes("The play() request was interrupted by a call to pause()")||(ze.warn(t),this.player.pause(),this.player.posterImage.show(),this.player.removeClass("vjs-has-autoplay"),this.player.removeClass("vjs-playing-audio-only-content"))}).finally(()=>{this.player.removeClass("vjs-updating-resolution")})}pickAverageVideoFile(){if(!this.videoFiles||this.videoFiles.length===0)return;if(this.videoFiles.length===1)return this.videoFiles[0];const e=this.videoFiles.filter(t=>t.resolution.id!==0);return e[Math.floor(e.length/2)]}buildQualities(){const e=this.videoFiles.map(t=>{var i;return{id:t.resolution.id,label:this.player.localize(Ag(t.resolution.label,t.fps)),height:t.resolution.id,selected:t.id===((i=this.currentVideoFile)==null?void 0:i.id),selectCallback:()=>this.updateVideoFile({videoFile:t,isUserResolutionChange:!0})}});this.player.peertubeResolutions().add(e)}setupNetworkInfoInterval(){this.networkInfoInterval=setInterval(()=>{var e;return this.player.trigger("network-info",{source:"web-video",http:{downloaded:this.player.bufferedPercent()*((e=this.currentVideoFile)==null?void 0:e.size)}})},1e3)}}X.registerPlugin("webVideo",wL);const dy=X.getComponent("CaptionsButton");dy.prototype.controlText_="Subtitles/CC";dy.prototype.label_=" ";const AL=X.getComponent("PlaybackRateMenuButton");AL.prototype.controlText_="Speed";const _g=X.getComponent("PlayProgressBar");_g.prototype.options_.children.includes("timeTooltip")!==!0&&_g.prototype.options_.children.push("timeTooltip");class IL{constructor(e){Qe(this,"pluginsManager"),Qe(this,"videojsDecodeErrors",0),Qe(this,"player"),Qe(this,"currentLoadOptions"),this.options=e,this.pluginsManager=e.pluginsManager}unload(){this.player&&(this.disposeDynamicPluginsIfNeeded(),this.player.reset())}async load(e){this.currentLoadOptions=e,this.setPoster(""),this.disposeDynamicPluginsIfNeeded(),await this.buildPlayerIfNeeded(),this.currentLoadOptions.mode==="p2p-media-loader"?await this.loadP2PMediaLoader():this.loadWebVideo(),this.loadDynamicPlugins(),this.options.controlBar===!1?this.player.controlBar.hide():this.player.controlBar.show(),this.player.autoplay(this.getAutoPlayValue(this.currentLoadOptions.autoplay)),this.player.autoplay()||this.setPoster(e.poster),this.player.trigger("video-change")}getPlayer(){return this.player}destroy(){this.player&&this.player.dispose()}setPoster(e){var t;if(!this.player){this.options.playerElement().poster=e;return}(t=this.player)==null||t.poster(e),this.options.playerElement().poster=""}enable(){this.player&&(this.player.el().style.pointerEvents="auto")}disable(){this.player&&(this.player.isFullscreen()&&this.player.exitFullscreen(),this.player.hasStarted(!1),this.player.removeClass("vjs-has-autoplay"),this.player.bigPlayButton.hide(),this.player.el().style.pointerEvents="none")}setCurrentTime(e){if(this.player.paused()){this.currentLoadOptions.startTime=e,this.player.play();return}this.player.currentTime(e),this.player.userActive(!0)}async loadP2PMediaLoader(){const e=new QI({...$l(this.options,["pluginsManager","serverUrl","authorizationHeader","stunServers"]),...$l(this.currentLoadOptions,["videoPassword","requiresUserAuth","videoFileToken","requiresPassword","isLive","p2pEnabled","liveOptions","hls"])}),{hlsjs:t,p2pMediaLoader:i}=await e.getPluginOptions();this.player.hlsjs(t),this.player.p2pMediaLoader(i)}loadWebVideo(){const e=new JI($l(this.currentLoadOptions,["videoFileToken","webVideo","hls"]));this.player.webVideo(e.getPluginOptions())}async buildPlayerIfNeeded(){if(this.player)return;await $T.loadLocaleInVideoJS(this.options.serverUrl,this.options.language,X);const e=await this.pluginsManager.runHook("filter:internal.player.videojs.options.result",this.getVideojsOptions());this.player=X(this.options.playerElement(),e),this.player.ready(()=>{isNaN(+this.options.playbackRate)||this.player.playbackRate(+this.options.playbackRate);let t=!1;const i=()=>{t||(t=!0,this.currentLoadOptions.mode==="p2p-media-loader"?this.tryToRecoverHLSError(this.player.error()):this.maybeFallbackToWebVideo())};this.player.on("video-change",()=>t=!1),this.player.on("error",()=>i()),this.player.on("network-info",(s,r)=>{r.source!=="p2p-media-loader"||isNaN(r.bandwidthEstimate)||Bg(r.bandwidthEstimate)}),this.player.contextMenu(this.getContextMenuOptions()),this.displayNotificationWhenOffline()})}disposeDynamicPluginsIfNeeded(){this.player&&(this.player.usingPlugin("peertubeMobile")&&this.player.peertubeMobile().dispose(),this.player.usingPlugin("peerTubeHotkeysPlugin")&&this.player.peerTubeHotkeysPlugin().dispose(),this.player.usingPlugin("playlist")&&this.player.playlist().dispose(),this.player.usingPlugin("bezels")&&this.player.bezels().dispose(),this.player.usingPlugin("upnext")&&this.player.upnext().dispose(),this.player.usingPlugin("stats")&&this.player.stats().dispose(),this.player.usingPlugin("storyboard")&&this.player.storyboard().dispose(),this.player.usingPlugin("chapters")&&this.player.chapters().dispose(),this.player.usingPlugin("peertubeNSFW")&&this.player.peertubeNSFW().dispose(),this.player.usingPlugin("peertubeDock")&&this.player.peertubeDock().dispose(),this.player.usingPlugin("p2pMediaLoader")&&this.player.p2pMediaLoader().dispose(),this.player.usingPlugin("hlsjs")&&this.player.hlsjs().dispose(),this.player.usingPlugin("webVideo")&&this.player.webVideo().dispose())}loadDynamicPlugins(){So()&&this.player.peertubeMobile(),this.player.bezels(),this.player.stats({videoUUID:this.currentLoadOptions.videoUUID,videoIsLive:this.currentLoadOptions.isLive,mode:this.currentLoadOptions.mode,p2pEnabled:this.currentLoadOptions.p2pEnabled}),this.options.enableHotkeys===!0&&this.player.peerTubeHotkeysPlugin({isLive:this.currentLoadOptions.isLive}),this.currentLoadOptions.playlist&&this.player.playlist(this.currentLoadOptions.playlist),this.currentLoadOptions.upnext&&this.player.upnext({timeout:this.currentLoadOptions.upnext.timeout,getTitle:()=>this.currentLoadOptions.nextVideo.getVideoTitle(),next:()=>this.currentLoadOptions.nextVideo.handler(),isDisplayed:()=>this.currentLoadOptions.nextVideo.enabled&&this.currentLoadOptions.upnext.isEnabled(),isSuspended:()=>this.currentLoadOptions.upnext.isSuspended(this.player)}),this.currentLoadOptions.storyboard&&this.player.storyboard(this.currentLoadOptions.storyboard),this.currentLoadOptions.videoChapters&&this.player.chapters({chapters:this.currentLoadOptions.videoChapters}),this.currentLoadOptions.dock&&this.player.peertubeDock(this.currentLoadOptions.dock),this.currentLoadOptions.nsfwWarning&&this.player.peertubeNSFW(this.currentLoadOptions.nsfwWarning)}async tryToRecoverHLSError(e){if(e.code===MediaError.MEDIA_ERR_DECODE){if(this.videojsDecodeErrors===0&&this.options.errorNotifier(this.player.localize("The video failed to play, will try to fast forward.")),this.videojsDecodeErrors===20){this.maybeFallbackToWebVideo();return}ze.info("Fast forwarding HLS to recover from an error.",{err:e,videoShortUUID:this.currentLoadOptions.videoShortUUID,currentTime:this.player.currentTime(),resolution:this.player.videoHeight()}),this.videojsDecodeErrors++,await this.load({...this.currentLoadOptions,mode:"p2p-media-loader",startTime:this.player.currentTime()+2,autoplay:!0})}else this.maybeFallbackToWebVideo()}async maybeFallbackToWebVideo(){if(this.currentLoadOptions.mode==="web-video"){this.player.peertube().displayFatalError();return}ze.info("Fallback to web-video."),await this.load({...this.currentLoadOptions,mode:"web-video",startTime:this.player.currentTime(),autoplay:!0})}getVideojsOptions(){const e={preloadTextTracks:!1,nativeTextTracks:!1},t={peertube:{hasAutoplay:()=>this.getAutoPlayValue(this.currentLoadOptions.autoplay),videoViewUrl:()=>this.currentLoadOptions.videoViewUrl,videoViewIntervalMs:this.options.videoViewIntervalMs,authorizationHeader:this.options.authorizationHeader,videoDuration:()=>this.currentLoadOptions.duration,startTime:()=>this.currentLoadOptions.startTime,stopTime:()=>this.currentLoadOptions.stopTime,videoCaptions:()=>this.currentLoadOptions.videoCaptions,isLive:()=>this.currentLoadOptions.isLive,videoUUID:()=>this.currentLoadOptions.videoUUID,subtitle:()=>this.currentLoadOptions.subtitle,videoRatio:()=>this.currentLoadOptions.videoRatio,poster:()=>this.currentLoadOptions.poster,autoPlayerRatio:this.options.autoPlayerRatio},metrics:{mode:()=>this.currentLoadOptions.mode,metricsUrl:()=>this.options.metricsUrl,metricsInterval:()=>this.options.metricsInterval,videoUUID:()=>this.currentLoadOptions.videoUUID}},i=new OI({...this.options,videoShortUUID:()=>this.currentLoadOptions.videoShortUUID,p2pEnabled:()=>this.currentLoadOptions.p2pEnabled,nextVideo:()=>this.currentLoadOptions.nextVideo,previousVideo:()=>this.currentLoadOptions.previousVideo});return{html5:e,textTrackSettings:!1,controls:this.options.controls!==void 0?this.options.controls:!0,loop:this.options.loop!==void 0?this.options.loop:!1,muted:this.options.muted!==void 0?this.options.muted:void 0,autoplay:this.getAutoPlayValue(this.currentLoadOptions.autoplay),poster:this.currentLoadOptions.poster,inactivityTimeout:this.options.inactivityTimeout,playbackRates:[.25,.5,.75,1,1.25,1.5,1.75,2],plugins:t,controlBar:{children:i.getChildrenOptions()},language:this.options.language&&!wg(this.options.language)?this.options.language:void 0}}getAutoPlayValue(e){return e!==!0?!1:this.currentLoadOptions.forceAutoplay?"any":"play"}displayNotificationWhenOffline(){const e=document.createElement("div");e.classList.add("vjs-peertube-offline-notification"),e.innerText=this.player.localize("You seem to be offline and the video may not work");let t=!1;const i=()=>{t&&(this.player.el().removeChild(e),t=!1,ze.info("The browser is online"))},s=()=>{t||(this.player.el().appendChild(e),t=!0,ze.info("The browser is offline"))};window.addEventListener("online",i),window.addEventListener("offline",s),this.player.on("dispose",()=>{window.removeEventListener("online",i),window.removeEventListener("offline",s)})}getContextMenuOptions(){return{content:()=>{const t=this,i=this.player,s=t.currentLoadOptions.videoShortUUID,r=i.options_.loop,a=[{icon:"repeat",label:i.localize("Play in loop")+(r?'<span class="vjs-icon-tick-white"></span>':""),listener:function(){i.options_.loop=!r}},{label:i.localize("Copy the video URL"),listener:function(){Hl(nh({shortUUID:s}),i.el())}},{label:i.localize("Copy the video URL at the current time"),listener:function(){const l=nh({shortUUID:s});Hl(bg({url:l,startTime:i.currentTime()}),i.el())}},{icon:"code",label:i.localize("Copy embed code"),listener:()=>{Hl(jT({embedUrl:t.currentLoadOptions.embedUrl,embedTitle:t.currentLoadOptions.embedTitle}),i.el())}}];return a.push({icon:"info",label:i.localize("Stats for nerds"),listener:()=>{i.stats().show()}}),a.map(l=>({...l,label:`<span class="vjs-icon-${l.icon||"link-2"}"></span>`+l.label}))}}}}const HL=Object.freeze(Object.defineProperty({__proto__:null,PeerTubePlayer:IL,cleanupVideoWatch:d_,getAverageBandwidthInStore:Ug,getPlayerSessionId:Gg,getStoredLastSubtitle:$g,getStoredMute:xg,getStoredPreferredSubtitle:jg,getStoredTheater:Og,getStoredVideoWatchHistory:zh,getStoredVolume:Dg,saveAverageBandwidth:Bg,saveLastSubtitle:oh,saveMuteInStore:Fg,savePreferredSubtitle:Hg,saveTheaterInStore:Ng,saveVideoWatchHistory:Vg,saveVolumeInStore:Mg,videojs:X},Symbol.toStringTag,{value:"Module"}));export{kg as g,HL as p};
