import{c as de,j as ce}from"./chunk-RT7DTAS6.js";import{B as le,a as oe,c as ie,g as re,m as ae}from"./chunk-WO4VNXA3.js";import{a as _e}from"./chunk-PE7TFI7A.js";import{Bb as O,Bc as Z,Cb as c,Da as B,Dc as J,E as X,H as F,Ha as a,Ic as ee,Kg as se,Mb as P,Na as b,Nb as j,Ob as D,Oc as te,Og as me,Pb as z,Qb as U,Ra as G,Rc as ne,Sa as K,Ub as I,Vb as L,Wb as V,X as W,Xb as Q,Ya as s,Zb as A,_b as q,aa as R,c as $,db as N,eb as l,ha as C,ia as f,jb as v,jc as Y,nb as u,ob as g,oc as T,pb as S,qb as M,rb as h,sb as H,ta as d,tb as E,xb as x}from"./chunk-F7FAPFPY.js";import{i as k,j as y}from"./chunk-AI7IVZV2.js";var pe=["previewEl"],ue=["textarea"],ge=["previewElement"],we=(e,r)=>({maximized:e,monospace:r}),Ce=e=>({"input-error":e}),fe=e=>({"scale-y--1":e}),Me=e=>({"ellipsis-multiline-3":e});function he(e,r){if(e&1&&S(0,"div",null,2)(2,"div",15),e&2){let n=c();a(2),l("innerHTML",n.previewHTML,B);}}function xe(e,r){e&1&&H(0);}function ve(e,r){if(e&1&&(u(0,"div",16),s(1,xe,1,0,"ng-container",17),g()),e&2){c();let n=D(1);a(),l("ngTemplateOutlet",n);}}function Ee(e,r){e&1&&(M(0),x(1,4),h());}function Te(e,r){e&1&&(M(0),x(1,5),h());}function Se(e,r){if(e&1){let n=E();u(0,"button",21),O("click",function(){C(n);let o=c(2);return f(o.previewCollapsed=!o.previewCollapsed);}),S(1,"my-global-icon",22),s(2,Ee,2,0,"ng-container")(3,Te,2,0,"ng-container"),g();}if(e&2){let n=c(2);N("aria-expanded",!n.previewCollapsed)("aria-controls",n.inputId()+"-collapse"),a(),l("ngClass",A(4,fe,!n.previewCollapsed)),a(),v(n.previewCollapsed?2:3);}}function Oe(e,r){e&1&&(M(0),x(1,6),h());}function Re(e,r){e&1&&(M(0),x(1,7),h());}function be(e,r){if(e&1){let n=E();u(0,"div",18),s(1,Se,4,6,"button",19),u(2,"button",20),O("click",function(){C(n);let o=c();return f(o.onMaximizeClick());}),s(3,Oe,2,0,"ng-container")(4,Re,2,0,"ng-container"),g()();}if(e&2){let n=c();a(),l("ngIf",!n.maximized),a(),l("disabled",n.disabled),a(),v(n.maximized?3:4);}}function Pe(e,r){e&1&&H(0);}function Ae(e,r){if(e&1){let n=E();u(0,"div",23,3),V("ngbCollapseChange",function(o){C(n);let i=c();return L(i.previewCollapsed,o)||(i.previewCollapsed=o),f(o);}),s(3,Pe,1,0,"ng-container",17),g();}if(e&2){let n=c(),t=D(1);l("ngClass",A(4,Me,n.truncated)),I("ngbCollapse",n.previewCollapsed),l("id",n.inputId()+"-collapse"),a(3),l("ngTemplateOutlet",t);}}function ke(e,r){e&1&&(M(0),x(1,8),h(),S(2,"span",27));}function ye(e,r){e&1&&(M(0),x(1,9),h(),S(2,"span",28));}function Ne(e,r){if(e&1){let n=E();u(0,"button",26),O("click",function(){C(n);let o=c(2);return f(o.truncated=!o.truncated);}),s(1,ke,3,0)(2,ye,3,0),g();}if(e&2){let n=c(2);a(),v(n.truncated?1:2);}}function He(e,r){if(e&1&&(u(0,"div",29),z(1),g()),e&2){let n=c(2);a(),U(n.formError());}}function De(e,r){if(e&1&&s(0,Ne,3,1,"button",24)(1,He,2,1,"div",25),e&2){let n=c();v(n.withShowMoreButton()&&(!n.truncated||n.hasEllipsis())?0:-1),a(),l("ngIf",n.formError());}}var Qe=(()=>{let r=class r{viewportScroller=R(ne);screenService=R(se);markdownService=R(me);previewEl=b("previewEl");content=G("");formError=d(void 0);markdownType=d("text");customMarkdownRenderer=d(void 0);debounceTime=d(150);markdownVideo=d(void 0);inputId=d.required();dir=d(void 0);withPreview=d(!0,{transform:T});withHtml=d(!1,{transform:T});withEmoji=d(!1,{transform:T});withShowMoreButton=d(!1,{transform:T});monospace=d(!1,{transform:T});textareaElement=b("textarea");previewElement=b("previewElement");previewHTML="";maximized=!1;disabled=!1;previewCollapsed=!0;truncated=!1;contentChanged=new $();scrollPosition;ngOnInit(){this.contentChanged.pipe(X(this.debounceTime()),F()).subscribe(()=>this.updatePreviews()),this.contentChanged.next(this.content()),this.truncated=this.withShowMoreButton();}ngOnDestroy(){this.unlockBodyScroll();}propagateChange=t=>{};writeValue(t){this.content.set(t),this.contentChanged.next(this.content());}registerOnChange(t){this.propagateChange=t;}registerOnTouched(){}onModelChange(){let t=this.content();this.propagateChange(t),this.contentChanged.next(t);}onMaximizeClick(){this.disabled||(this.maximized=!this.maximized,this.screenService.isInTouchScreen()||this.textareaElement().nativeElement.focus(),this.maximized?this.lockBodyScroll():this.unlockBodyScroll());}setDisabledState(t){this.disabled=t;}hasEllipsis(){let t=this.previewEl()?.nativeElement;return t?t.offsetHeight<t.scrollHeight:!1;}lockBodyScroll(){this.scrollPosition=this.viewportScroller.getScrollPosition(),document.getElementById("content").classList.add("lock-scroll");}unlockBodyScroll(){document.getElementById("content").classList.remove("lock-scroll"),this.scrollPosition&&this.viewportScroller.scrollToPosition(this.scrollPosition);}updatePreviews(){return y(this,null,function*(){let t=this.content();t!=null&&(this.previewHTML=yield this.markdownRender(t));});}markdownRender(t){return y(this,null,function*(){let o,i=this.customMarkdownRenderer(),_=this.markdownType();if(i){let m=yield i(t);if(m instanceof HTMLElement){setTimeout(()=>{let p=this.previewElement()?.nativeElement;p&&(p.innerHTML="",p.appendChild(m));});return;}o=m;}else _==="text"?o=yield this.markdownService.textMarkdownToHTML({markdown:t,withEmoji:this.withEmoji(),withHtml:this.withHtml()}):_==="enhanced"?o=yield this.markdownService.enhancedMarkdownToHTML({markdown:t,withEmoji:this.withEmoji(),withHtml:this.withHtml()}):_==="to-unsafe-html"&&(o=yield this.markdownService.markdownToUnsafeHTML({markdown:t}));let w=this.markdownVideo();return w&&(o=this.markdownService.processVideoTimestamps(w.shortUUID,o)),o;});}};k(r,"\u0275fac",function(o){return new(o||r)();}),k(r,"\u0275cmp",K({type:r,selectors:[["my-markdown-textarea"]],viewQuery:function(o,i){o&1&&(P(i.previewEl,pe,5),P(i.textareaElement,ue,5),P(i.previewElement,ge,5)),o&2&&j(3);},inputs:{content:[1,"content"],formError:[1,"formError"],markdownType:[1,"markdownType"],customMarkdownRenderer:[1,"customMarkdownRenderer"],debounceTime:[1,"debounceTime"],markdownVideo:[1,"markdownVideo"],inputId:[1,"inputId"],dir:[1,"dir"],withPreview:[1,"withPreview"],withHtml:[1,"withHtml"],withEmoji:[1,"withEmoji"],withShowMoreButton:[1,"withShowMoreButton"],monospace:[1,"monospace"]},outputs:{content:"contentChange"},features:[Q([{provide:oe,useExisting:W(()=>r),multi:!0}])],decls:10,vars:16,consts:()=>{let t;t="\u986F\u793A\u9810\u89BD";let o;o="\u96B1\u85CF\u9810\u89BD";let i;i="\u96E2\u958B\u5168\u87A2\u5E55\u7DE8\u8F2F\u5668";let _;_="\u5168\u87A2\u5E55\u7DE8\u8F2F\u5668";let w;w="\u986F\u793A\u66F4\u591A";let m;return m="\u986F\u793A\u8F03\u5C11",[["previewContent",""],["textarea",""],["previewElement",""],["collapse","ngbCollapse","previewEl",""],t,o,i,_,w,m,[1,"root",3,"ngClass"],[3,"ngModelChange","ngModel","ngClass","id","name","dir"],["class","preview-maximized muted-2",4,"ngIf"],["class","buttons mt-3",4,"ngIf"],["class","preview-collapse preview mt-3 muted-2",3,"ngClass","ngbCollapse","id","ngbCollapseChange",4,"ngIf"],[3,"innerHTML"],[1,"preview-maximized","muted-2"],[4,"ngTemplateOutlet"],[1,"buttons","mt-3"],["type","button","class","peertube-button secondary-button",3,"click",4,"ngIf"],["type","button",1,"maximize-button","button-as-link",3,"click","disabled"],["type","button",1,"peertube-button","secondary-button",3,"click"],["iconName","arrow-down",3,"ngClass"],[1,"preview-collapse","preview","mt-3","muted-2",3,"ngbCollapseChange","ngClass","ngbCollapse","id"],["type","button",1,"button-unstyle","show-more-toggle"],["class","form-error","role","alert",4,"ngIf"],["type","button",1,"button-unstyle","show-more-toggle",3,"click"],[1,"chevron-down"],[1,"chevron-up"],["role","alert",1,"form-error"]];},template:function(o,i){if(o&1){let _=E();s(0,he,3,1,"ng-template",null,0,Y),u(2,"div",10)(3,"textarea",11,1),V("ngModelChange",function(m){return C(_),L(i.content,m)||(i.content=m),f(m);}),O("ngModelChange",function(){return C(_),f(i.onModelChange());}),z(5,"  "),g(),s(6,ve,2,1,"div",12)(7,be,5,3,"div",13)(8,Ae,4,6,"div",14),g(),s(9,De,2,2);}o&2&&(a(2),l("ngClass",q(11,we,i.maximized,i.monospace())),a(),I("ngModel",i.content),l("ngClass",A(14,Ce,i.formError()))("id",i.inputId())("name",i.inputId())("dir",i.dir()),N("disabled",i.disabled||null),a(3),l("ngIf",i.maximized),a(),l("ngIf",i.withPreview()),a(),l("ngIf",!i.maximized),a(),v(i.maximized?-1:9));},dependencies:[te,Z,J,ee,le,ie,re,ae,ce,de,_e],styles:[`.root[_ngcontent-%COMP%]{display:flex;flex-direction:column}.root[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) var(--input-x-padding);width:100%;max-width:100%;color:var(--input-fg);background-color:var(--input-bg);border:1px solid var(--input-border-color);border-radius:var(--input-border-radius);line-height:24px}.root[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder);font-size:14px}.root[_ngcontent-%COMP%]   textarea[readonly][_ngcontent-%COMP%]{color:var(--fg-300)}.root[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .root[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100);outline:0}.root[_ngcontent-%COMP%]   textarea[disabled][_ngcontent-%COMP%]{color:var(--fg-300);opacity:.8}@media screen and (max-width: calc(100% + 40px)){.root[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%}}.root[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{color:var(--textarea-fg)!important;background-color:var(--textarea-bg)!important;height:170px;padding:var(--textarea-y-padding) var(--textarea-x-padding)}.root[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%], .root[_ngcontent-%COMP%]   .preview-maximized[_ngcontent-%COMP%]{word-break:break-word;word-wrap:break-word;overflow-wrap:break-word;-webkit-hyphens:auto;hyphens:auto}.root[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{gap:1rem;display:flex;flex-wrap:wrap;justify-content:flex-end}.root.maximized[_ngcontent-%COMP%]{z-index:17499;position:fixed;top:var(--header-height);width:calc(100% - var(--menu-width) - var(--x-margin-content) * 2);height:calc(100vh - var(--header-height));display:grid;grid-template-rows:auto 1fr;grid-template-columns:1fr 1fr;background-color:var(--bg)}@supports (inset-inline-start: calc(var(--menu-width) + var(--x-margin-content))){.root.maximized[_ngcontent-%COMP%]{inset-inline-start:calc(var(--menu-width) + var(--x-margin-content))}}@supports not (inset-inline-start: calc(var(--menu-width) + var(--x-margin-content))){.root.maximized[_ngcontent-%COMP%]{left:calc(var(--menu-width) + var(--x-margin-content))}}.root.maximized[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{grid-row:1;grid-column:1/3;border-bottom:2px solid var(--primary);padding:20px 0;width:100%!important}.root.maximized[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .root.maximized[_ngcontent-%COMP%]   .preview-maximized[_ngcontent-%COMP%]{height:100%!important;max-height:none!important;border-radius:0;padding:1rem}.root.maximized[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{grid-column:1;grid-row:2;border:0;border-right:1px dashed var(--input-border-color);resize:none;box-shadow:none!important}.root.maximized[_ngcontent-%COMP%]   .preview-maximized[_ngcontent-%COMP%]{grid-column:2;grid-row:2;display:block;overflow-y:auto;word-wrap:break-word;scrollbar-color:var(--fg-300) var(--bg)}.show-more-toggle[_ngcontent-%COMP%]{font-weight:700;color:var(--fg-300);margin-top:1rem;font-size:.875rem}@media screen and (max-width: 800px){.maximize-button[_ngcontent-%COMP%]{display:none}}.monospace[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{font-family:monospace;font-size:14px}
/*# sourceMappingURL=markdown-textarea.component-HA4DFMYZ.css.map */`]}));let e=r;return e;})();export{Qe as a};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-5GTHDKWY.js.map