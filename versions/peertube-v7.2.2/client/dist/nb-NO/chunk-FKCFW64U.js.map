{"version":3,"mappings":"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","names":["ɵɵelementStart","ɵɵi18n","ɵɵelementEnd","ie","n","_","_e","re","ae","le","se","Ne","r","b","ɵɵlistener","hide_r2","ɵɵrestoreView","_r1","close","ɵɵresetView","ɵɵelement","ɵɵtemplate","InstanceConfigWarningModalComponent_ng_template_0_li_10_Template","InstanceConfigWarningModalComponent_ng_template_0_li_11_Template","InstanceConfigWarningModalComponent_ng_template_0_li_12_Template","InstanceConfigWarningModalComponent_ng_template_0_li_13_Template","InstanceConfigWarningModalComponent_ng_template_0_li_14_Template","InstanceConfigWarningModalComponent_ng_template_0_li_15_Template","InstanceConfigWarningModalComponent_ng_template_0_li_16_Template","ɵɵi18nStart","ɵɵi18nEnd","ɵɵtwoWayListener","$event","ctx_r2","ɵɵnextContext","i0","ɵɵtwoWayBindingSet","stopDisplayModal","p","ɵɵadvance","ɵɵproperty","about","instance","name","toLowerCase","isDefaultShortDescription","shortDescription","administrator","maintenanceLifetime","businessModel","moderationInformation","terms","ɵɵtwoWayProperty","InstanceConfigWarningModalComponent","userService","inject","UserService","location","Location","modalService","NgbModal","notifier","Notifier","modal","viewChild","created","output","LS_KEYS","NO_INSTANCE_CONFIG_WARNING_MODAL","ngOnInit","emit","shouldOpenByUser","user","hasOpenModals","noInstanceConfigWarningModal","peertubeLocalStorage","getItem","shouldOpen","serverConfig","signup","allowed","show","path","startsWith","open","centered","result","finally","doNotOpenAgain","description","setItem","updateMyProfile","subscribe","next","logger","info","error","err","message","M","selectors","viewQuery","rf","ctx","X","N","te","e","v","outputs","decls","vars","consts","t","$localize","T","InstanceConfigWarningModalComponent_ng_template_0_Template","ɵɵtemplateRefExtractor","dependencies","CommonModule","NgIf","FormsModule","NgControlStatus","NgModel","GlobalIconComponent","PeertubeCheckboxComponent","styles","_InstanceConfigWarningModalComponent","Te"],"ignoreList":[],"sources":["src/app/modal/instance-config-warning-modal.component.html","src/app/modal/instance-config-warning-modal.component.ts"],"sourcesContent":["<ng-template #modal let-hide=\"close\">\n  <div class=\"modal-header\">\n    <h4 i18n class=\"modal-title\">Configuration warning!</h4>\n    <button class=\"border-0 p-0\" title=\"Close this modal\" i18n-title (click)=\"hide()\">\n      <my-global-icon iconName=\"cross\"></my-global-icon>\n    </button>\n  </div>\n\n  <div class=\"modal-body\">\n    <img class=\"mascot\" src=\"/client/assets/images/mascot/oh.svg\" alt=\"mascot\" />\n\n    <p i18n>You enabled user registration on your instance but did not configure the following fields:</p>\n\n    <ul>\n      <li i18n *ngIf=\"about.instance.name.toLowerCase() === 'peertube'\">Instance name</li>\n      <li i18n *ngIf=\"isDefaultShortDescription(about.instance.shortDescription)\">Instance short description</li>\n\n      <li i18n *ngIf=\"!about.instance.administrator\">Who you are</li>\n      <li i18n *ngIf=\"!about.instance.maintenanceLifetime\">How long you plan to maintain your instance</li>\n      <li i18n *ngIf=\"!about.instance.businessModel\">How you plan to pay for keeping your instance running</li>\n\n      <li i18n *ngIf=\"!about.instance.moderationInformation\">How you will moderate your instance</li>\n      <li i18n *ngIf=\"!about.instance.terms\">Instance terms</li>\n    </ul>\n\n    <p i18n>\n      Please consider configuring these fields to help people to choose <strong>the appropriate instance</strong>.\n      Without them, your instance may not be referenced on the <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://joinpeertube.org\">JoinPeerTube website</a>.\n    </p>\n  </div>\n\n  <div class=\"modal-footer inputs\">\n    <my-peertube-checkbox\n      inputName=\"stopDisplayModal\" [(ngModel)]=\"stopDisplayModal\"\n      i18n-labelText labelText=\"Don't show me this warning anymore\"\n    >\n    </my-peertube-checkbox>\n\n    <input\n      type=\"button\" role=\"button\" i18n-value value=\"Close\" class=\"peertube-button secondary-button\"\n      (click)=\"hide()\" (key.enter)=\"hide()\"\n    >\n\n    <a i18n class=\"peertube-button-link primary-button\" ngbAutofocus\n       href=\"/admin/settings/config/edit-custom\" target=\"_blank\" rel=\"noopener noreferrer\">\n       Configure\n    </a>\n  </div>\n\n</ng-template>\n","import { CommonModule, Location } from '@angular/common'\nimport { Component, ElementRef, OnInit, inject, output, viewChild } from '@angular/core'\nimport { FormsModule } from '@angular/forms'\nimport { Notifier, User, UserService } from '@app/core'\nimport { PeertubeCheckboxComponent } from '@app/shared/shared-forms/peertube-checkbox.component'\nimport { GlobalIconComponent } from '@app/shared/shared-icons/global-icon.component'\nimport { NgbModal } from '@ng-bootstrap/ng-bootstrap'\nimport { About, ServerConfig } from '@peertube/peertube-models'\nimport { logger } from '@root-helpers/logger'\nimport { peertubeLocalStorage } from '@root-helpers/peertube-web-storage'\n\n@Component({\n  selector: 'my-instance-config-warning-modal',\n  templateUrl: './instance-config-warning-modal.component.html',\n  styleUrls: [ './instance-config-warning-modal.component.scss' ],\n  imports: [ CommonModule, FormsModule, GlobalIconComponent, PeertubeCheckboxComponent ]\n})\nexport class InstanceConfigWarningModalComponent implements OnInit {\n  private userService = inject(UserService)\n  private location = inject(Location)\n  private modalService = inject(NgbModal)\n  private notifier = inject(Notifier)\n\n  readonly modal = viewChild<ElementRef>('modal')\n\n  readonly created = output()\n\n  stopDisplayModal = false\n  about: About\n\n  private LS_KEYS = {\n    NO_INSTANCE_CONFIG_WARNING_MODAL: 'no_instance_config_warning_modal'\n  }\n\n  ngOnInit (): void {\n    this.created.emit()\n  }\n\n  shouldOpenByUser (user: User) {\n    if (this.modalService.hasOpenModals()) return false\n    if (user.noInstanceConfigWarningModal === true) return false\n    if (peertubeLocalStorage.getItem(this.LS_KEYS.NO_INSTANCE_CONFIG_WARNING_MODAL) === 'true') return false\n\n    return true\n  }\n\n  shouldOpen (serverConfig: ServerConfig, about: About) {\n    if (!serverConfig.signup.allowed) return false\n\n    return serverConfig.instance.name.toLowerCase() === 'peertube' ||\n      !about.instance.terms ||\n      !about.instance.administrator ||\n      !about.instance.maintenanceLifetime\n  }\n\n  show (about: About) {\n    if (this.location.path().startsWith('/admin/settings/config/edit-custom')) return\n\n    this.about = about\n\n    const ref = this.modalService.open(this.modal(), { centered: true })\n\n    ref.result.finally(() => {\n      if (this.stopDisplayModal === true) this.doNotOpenAgain()\n    })\n  }\n\n  isDefaultShortDescription (description: string) {\n    return description === 'PeerTube, an ActivityPub-federated video streaming platform using P2P directly in your web browser.'\n  }\n\n  private doNotOpenAgain () {\n    peertubeLocalStorage.setItem(this.LS_KEYS.NO_INSTANCE_CONFIG_WARNING_MODAL, 'true')\n\n    this.userService.updateMyProfile({ noInstanceConfigWarningModal: true })\n      .subscribe({\n        next: () => logger.info('We will not open the instance config warning modal again.'),\n\n        error: err => this.notifier.error(err.message)\n      })\n  }\n}\n"]}