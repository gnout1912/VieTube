import{m as B,o as J,p as K}from"./chunk-RT7DTAS6.js";import{B as j,c as q,g as Q,m as W}from"./chunk-WO4VNXA3.js";import{a as Z}from"./chunk-PE7TFI7A.js";import{$f as oe,Bb as f,Bc as z,Cb as S,Cc as H,Dc as U,E as w,H as y,Ha as s,Ob as N,Pb as A,Qb as x,Rb as k,Sa as V,Ub as D,Vb as $,Wb as L,Ya as b,Zb as M,aa as C,c as I,eb as c,ha as d,ia as _,kd as G,nb as u,ob as h,oc as E,od as X,pb as m,qb as P,qg as Y,rb as O,sa as R,ta as g,tb as v}from"./chunk-F7FAPFPY.js";import{a as T,g as re,i as F}from"./chunk-AI7IVZV2.js";var te=re(oe());var ae=i=>({"has-icon":i}),le=i=>({"first-in-group":i}),se=i=>({"no-visible":i});function ce(i,r){if(i&1){let l=v();u(0,"button",12),f("click",function(){let t=d(l).$implicit,n=S(3);return _(n.onFilterClick(t));}),m(1,"my-global-icon",13),A(2),h();}if(i&2){let l=r.$implicit,e=S(3);s(),c("ngClass",M(2,se,!e.isFilterEnabled(l))),s(),k(" ",l.label," ");}}function ue(i,r){if(i&1&&(P(0),u(1,"h6",10),A(2),h(),b(3,ce,3,4,"button",11),O()),i&2){let l=r.$implicit;s(2),x(l.title),s(),c("ngForOf",l.children);}}function pe(i,r){if(i&1&&(P(0),m(1,"button",7),u(2,"div",8),b(3,ue,4,2,"ng-container",9),h(),O()),i&2){let l=S();s(3),c("ngForOf",l.filters());}}function he(i,r){if(i&1){let l=v();u(0,"button",14),f("click",function(){d(l);let t=S();return _(t.onSearchClick());}),m(1,"my-global-icon",15),h();}}var ee=(0,te.default)("peertube:AdvancedInputFilterComponent"),Pe=(()=>{let r=class r{route=C(G);restService=C(Y);router=C(X);filters=g([]);emitOnInit=g(!0,{transform:E});icon=g(!1,{transform:E});placeholder=g("B\u1ED9 l\u1ECDc...");inputId=g("table-filter");search=R();searchValue;enabledFilters=new Set();searchStream;viewInitialized=!1;emitSearchAfterViewInit=!1;ngOnInit(){this.initSearchStream(),this.listenToRouteSearchChange();}ngAfterViewInit(){this.viewInitialized=!0,this.emitOnInit()&&this.emitSearchAfterViewInit&&this.emitSearch();}onInputSearch(e){this.scheduleSearchUpdate(e.target.value);}onSearchClick(){this.scheduleSearchUpdate(this.searchValue);}onResetTableFilter(){this.immediateSearchUpdate("");}hasFilters(){let e=this.filters();return e&&e.length!==0;}isFilterEnabled(e){return this.enabledFilters.has(e.value);}onFilterClick(e){let t=this.isFilterEnabled(e)?this.removeFilterToSearch(this.searchValue,e):this.addFilterToSearch(this.searchValue,e);this.setQueryParams(t);}scheduleSearchUpdate(e){this.searchValue=e,this.searchStream.next(this.searchValue);}immediateSearchUpdate(e){this.searchValue=e,this.setQueryParams(this.searchValue),this.parseFilters(this.searchValue),this.emitSearch();}listenToRouteSearchChange(){this.route.queryParams.subscribe(e=>{let t=e.search||"";ee('On route search change "%s".',t),this.searchValue!==t&&(this.searchValue=t,this.parseFilters(this.searchValue),this.emitSearch());});}initSearchStream(){this.searchStream=new I(),this.searchStream.pipe(w(300),y()).subscribe(()=>{this.setQueryParams(this.searchValue),this.parseFilters(this.searchValue),this.emitSearch();});}emitSearch(){if(!this.viewInitialized){this.emitSearchAfterViewInit=!0;return;}ee('On search "%s".',this.searchValue),this.search.emit(this.searchValue);}setQueryParams(e){let t=e?{search:e.trim()}:{};this.router.navigate(["."],{relativeTo:this.route,queryParams:T(T({},this.route.snapshot.queryParams),t)});}removeFilterToSearch(e,t){return e.replace(t.value,"");}addFilterToSearch(e,t){let n=this.restService.tokenizeString(t.value),o=[],p=this.restService.tokenizeString(e);for(let a of n){let ne=a.split(":").shift();p=p.filter(ie=>!ie.startsWith(ne)),o.push(a);}return p.concat(o).join(" ");}parseFilters(e){let t=this.restService.tokenizeString(e);this.enabledFilters=new Set();for(let n of this.filters())for(let o of n.children)this.restService.tokenizeString(o.value).every(a=>t.includes(a))&&this.enabledFilters.add(o.value);}};F(r,"\u0275fac",function(t){return new(t||r)();}),F(r,"\u0275cmp",V({type:r,selectors:[["my-advanced-input-filter"]],inputs:{filters:[1,"filters"],emitOnInit:[1,"emitOnInit"],icon:[1,"icon"],placeholder:[1,"placeholder"],inputId:[1,"inputId"]},outputs:{search:"search"},decls:7,vars:12,consts:()=>{let e;e="T\xECm ki\u1EBFm";let t;t="X\xF3a b\u1ED9 l\u1ECDc";let n;return n="M\u1EDF b\u1ED9 l\u1ECDc",[["input",""],["ngbDropdown","","placement","bottom-left auto","container","body",1,"input-group","has-clear","flex-nowrap",3,"ngClass"],[4,"ngIf"],["class","button-unstyle search-button","title",e,3,"click",4,"ngIf"],["type","text",1,"last-in-group",3,"ngModelChange","keyup","name","id","placeholder","ngClass","ngModel"],["title",t,1,"p-0","border-0","form-control-clear",3,"click"],["iconName","cross"],["title",n,"ngbDropdownToggle","",1,"input-group-text","c-hand"],["role","menu","ngbDropdownMenu",""],[4,"ngFor","ngForOf"],[1,"dropdown-header"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item",3,"click"],["iconName","tick",3,"ngClass"],["title",e,1,"button-unstyle","search-button",3,"click"],["iconName","search"]];},template:function(t,n){if(t&1){let o=v();u(0,"div",1),b(1,pe,4,1,"ng-container",2)(2,he,2,0,"button",3),u(3,"input",4,0),L("ngModelChange",function(a){return d(o),$(n.searchValue,a)||(n.searchValue=a),_(a);}),f("keyup",function(a){return d(o),_(n.onInputSearch(a));}),h(),u(5,"button",5),f("click",function(){d(o);let a=N(4);return n.onResetTableFilter(),_(a.focus());}),m(6,"my-global-icon",6),h()();}t&2&&(c("ngClass",M(8,ae,n.icon())),s(),c("ngIf",n.hasFilters()),s(),c("ngIf",n.icon()),s(),c("name",n.inputId())("id",n.inputId())("placeholder",n.placeholder())("ngClass",M(10,le,!n.hasFilters())),D("ngModel",n.searchValue));},dependencies:[K,U,J,B,H,Z,z,j,q,Q,W],styles:[`.input-group[_ngcontent-%COMP%]{width:fit-content}.dropdown-item[_ngcontent-%COMP%]{font-size:14px}input[_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) var(--input-x-padding);width:250px;max-width:250px;color:var(--input-fg);background-color:var(--input-bg);border:1px solid var(--input-border-color);border-radius:var(--input-border-radius);line-height:24px}input[_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder);font-size:14px}input[readonly][_ngcontent-%COMP%]{color:var(--fg-300)}input[_ngcontent-%COMP%]:focus, input[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100);outline:0}input[disabled][_ngcontent-%COMP%]{color:var(--fg-300);opacity:.8}@media screen and (max-width: 290px){input[_ngcontent-%COMP%]{width:100%}}.has-icon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-inline-start:46px}.search-button[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:20px;color:var(--fg-200)}.search-button[_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%]{display:inline-block;width:19px;height:19px;line-height:19px}.input-group-text[_ngcontent-%COMP%]{background-color:transparent;transition:.3s ease-out}.input-group-text[_ngcontent-%COMP%]:hover{background-color:var(--input-bg)}.form-control-clear[_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%]{display:inline-block;width:19px;height:19px;line-height:19px}div[role=menu][_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%]{opacity:1;display:inline-block;width:19px;height:19px;line-height:19px;margin-inline-end:.125rem}div[role=menu][_ngcontent-%COMP%]   my-global-icon.no-visible[_ngcontent-%COMP%]{width:0;height:0;margin-inline-end:calc(1.25625rem + .075vw)}@media (min-width: 1200px){div[role=menu][_ngcontent-%COMP%]   my-global-icon.no-visible[_ngcontent-%COMP%]{margin-inline-end:1.3125rem}}div[role=menu][_ngcontent-%COMP%]{max-height:50vh;overflow:auto}
/*# sourceMappingURL=advanced-input-filter.component-AEFHEQDJ.css.map */`]}));let i=r;return i;})();export{Pe as a};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-APIXYPUO.js.map