import{a as de}from"./chunk-RJFLITAD.js";import{h as Ft}from"./chunk-DJO6R22E.js";import{a as vt}from"./chunk-WUGJOXHJ.js";import{a as Ot,b as Rt}from"./chunk-EFI4VIXO.js";import{B as ht}from"./chunk-UFXFCZP3.js";import{c as q}from"./chunk-2O3IZ566.js";import{a as St}from"./chunk-S5ARXDTR.js";import{b as Ct}from"./chunk-WZVFW7AN.js";import{c as at}from"./chunk-RT7DTAS6.js";import{A as Je,B as Y,C as Ze,a as Xe,c as We,g as Q,h as Qe,m as Ye,p as je,q as Ke,t as qe}from"./chunk-WO4VNXA3.js";import{a as K}from"./chunk-PE7TFI7A.js";import{$f as ae,Ab as B,Ag as mt,Bb as R,Bc as W,Cb as c,Cc as Ue,D as Ne,Dc as b,E as be,Eg as pt,Ff as le,Gf as dt,Ha as a,Kg as Et,Ld as et,Oc as ze,Pb as A,Q as Le,Qb as V,Rb as $,Re as lt,Sa as D,Sg as ft,Ub as we,Vb as xe,Wb as ke,X as Ve,Xb as X,Xf as _t,Ya as p,Yd as j,Zb as H,_d as tt,aa as f,c as ie,db as $e,eb as d,ha as I,he as it,ia as M,ie as nt,j as Me,jb as y,je as ot,kb as He,kd as Ge,ke as st,lb as oe,le as rt,lf as re,lg as ct,mb as se,n as De,nb as r,ng as gt,ob as l,oc as v,og as ut,pb as E,pd as Be,qb as h,r as ye,rb as C,s as Pe,sa as ne,ta as u,tb as L,vb as P,wb as N,xb as m,xg as w,yb as z,zb as G}from"./chunk-F7FAPFPY.js";import{a as Te,b as Ie,g as te,i as F}from"./chunk-AI7IVZV2.js";var Pt=te(ae());var Mt=te(ae());function bt(i,t){if(i&1){let n=L();r(0,"my-select-checkbox-default-all",1),ke("ngModelChange",function(o){I(n);let s=c();return xe(s.selectedCategories,o)||(s.selectedCategories=o),M(o);}),R("ngModelChange",function(){I(n);let o=c();return M(o.onModelChange());}),l();}if(i&2){let n=c();d("inputId",n.inputId()),we("ngModel",n.selectedCategories),d("availableItems",n.availableCategories);}}var Tt=(()=>{let t=class t{server=f(w);inputId=u.required();selectedCategories;availableCategories;ngOnInit(){this.server.getVideoCategories().subscribe(e=>{this.availableCategories=e.map(o=>({label:o.label,id:o.id+""}));});}propagateChange=e=>{};writeValue(e){this.selectedCategories=e?e.map(o=>o+""):null;}registerOnChange(e){this.propagateChange=e;}registerOnTouched(){}onModelChange(){this.propagateChange(this.selectedCategories?this.selectedCategories.map(e=>e+""):null);}};F(t,"\u0275fac",function(o){return new(o||t)();}),F(t,"\u0275cmp",D({type:t,selectors:[["my-select-categories"]],inputs:{inputId:[1,"inputId"]},features:[X([{provide:Xe,useExisting:Ve(()=>t),multi:!0}])],decls:1,vars:1,consts:()=>{let e;e="\u0623\u0636\u0641 \u0641\u0626\u0629 \u062C\u062F\u064A\u062F\u0629";let o;o="\u0643\u0644 \u0627\u0644\u0641\u0626\u0627\u062A";let s;return s="",[["placeholder",e,"allSelectedLabel",o,"selectedLabel",s,3,"inputId","ngModel","availableItems","ngModelChange",4,"ngIf"],["placeholder",e,"allSelectedLabel",o,"selectedLabel",s,3,"ngModelChange","inputId","ngModel","availableItems"]];},template:function(o,s){o&1&&p(0,bt,1,3,"my-select-checkbox-default-all",0),o&2&&d("ngIf",s.availableCategories);},dependencies:[Ot,Y,Q,Ye,b],encapsulation:2}));let i=t;return i;})();var Lt=i=>({active:i}),Vt=i=>({"opacity-0":i}),$t=(i,t)=>t.key+(t.value||"");function Ht(i,t){if(i&1&&(r(0,"my-button",24),A(1),l()),i&2){let n=t.$implicit;d("icon",n.iconName)("ptQueryParams",n.filters)("active",n.isActive()),a(),$("",n.label," ");}}function wt(i,t){if(i&1&&(h(0),P(1,13),E(2,"strong"),N(),C()),i&2){let n=c(2);a(2),z(n.instanceName),G(1);}}function xt(i,t){if(i&1&&(h(0),P(1,14),E(2,"strong")(3,"strong"),N(),C()),i&2){let n=c(2);a(3),z(n.instanceName)(n.totalFollowing)(n.totalFollowing),G(1);}}function kt(i,t){if(i&1&&(r(0,"div",59),p(1,wt,3,1,"ng-container")(2,xt,4,3,"ng-container"),l()),i&2){let n=c();d("ngClass",H(2,Vt,n.totalFollowing===void 0)),a(),y(n.filters().scope==="local"||n.totalFollowing===0?1:2);}}function Ut(i,t){if(i&1&&(r(0,"span"),A(1),l()),i&2){let n=c(2).$implicit;a(),$("",n.label,": ");}}function zt(i,t){if(i&1&&(r(0,"div",60),p(1,Ut,2,1,"span",61),r(2,"strong"),A(3),l()()),i&2){let n=c().$implicit,e=c();a(),d("ngIf",n.value),a(2),V(e.getFilterValue(n)||n.label);}}function Gt(i,t){if(i&1&&p(0,zt,4,2,"div",60),i&2){let n=t.$implicit;y(n.key!=="scope"?0:-1);}}function Bt(i,t){i&1&&(h(0),m(1,15),C());}function Xt(i,t){i&1&&(h(0),m(1,16),C());}function Wt(i,t){if(i&1&&(r(0,"div",37)(1,"div",38),h(2),m(3,17),C(),r(4,"div",39)(5,"div"),P(6,18),E(7,"a",62),N(),l(),r(8,"div"),m(9,19),l()()(),r(10,"div",41)(11,"label",63),m(12,20),l(),E(13,"my-select-options",64),l()()),i&2){let n=c();a(7),z(n.instanceName)(n.totalFollowing)(n.totalFollowing),G(6),a(6),d("items",n.availableScopes);}}function Qt(i,t){i&1&&(r(0,"div",37)(1,"div",38),m(2,21),l(),r(3,"div",41),E(4,"my-peertube-checkbox",65),l()());}var It=(0,Mt.default)("peertube:videos:VideoFiltersHeaderComponent"),Dt=(()=>{let t=class t{auth=f(ct);serverService=f(w);fb=f(Je);modalService=f(vt);redirectService=f(mt);server=f(w);followService=f(de);filters=u(void 0);displayModerationBlock=u(!1);hideScope=u(!1);areFiltersCollapsed=!0;form;sortItems=[];availableScopes=[];quickFilters=[];instanceName;totalFollowing;videoCategories=[];videoLanguages=[];ngOnInit(){this.instanceName=this.server.getHTMLConfig().instance.name,this.form=this.fb.group({sort:[""],languageOneOf:[""],categoryOneOf:[""],scope:[""],allVideos:[""],live:[""]}),this.patchForm(!1),this.filters().onChange(()=>{this.patchForm(!1);}),this.form.valueChanges.subscribe(e=>{It("Loading values from form",{values:e}),this.filters().load(e,!0);}),this.serverService.getVideoCategories().subscribe(e=>this.videoCategories=e),this.serverService.getVideoLanguages().subscribe(e=>this.videoLanguages=e),this.followService.getFollowing({pagination:{count:1,start:0},state:"accepted"}).subscribe(({total:e})=>this.totalFollowing=e),this.availableScopes=[{id:"local",label:"Only videos from this platform"},{id:"federated",label:"Videos from all platforms"}],this.buildSortItems(),this.buildQuickFilters();}canSeeAllVideos(){return!this.auth.isLoggedIn()||!this.displayModerationBlock()?!1:this.auth.getUser().hasRight(et.SEE_ALL_VIDEOS);}buildQuickFilters(){let e=this.redirectService.getDefaultTrendingSort();this.quickFilters=[{label:"\u0623\u064F\u0636\u064A\u0641\u062A \u062D\u062F\u064A\u062B\u064B\u0627",iconName:"add",isActive:()=>this.filters().sort==="-publishedAt",filters:{sort:"-publishedAt"}},{label:"\u0627\u0644\u0645\u064F\u062A\u062F\u0627\u0648\u0644",iconName:"trending",isActive:()=>this.filters().sort===e,filters:{sort:e}}];}buildSortItems(){this.sortItems=[{id:"-publishedAt",label:"Recently Added"},{id:"-originallyPublishedAt",label:"Original Publication Date"},{id:"name",label:"\u0627\u0644\u0627\u0633\u0645"}],this.isTrendingSortEnabled("most-viewed")&&this.sortItems.push({id:"-trending",label:"Recent Views"}),this.isTrendingSortEnabled("hot")&&this.sortItems.push({id:"-hot",label:"Hot"}),this.isTrendingSortEnabled("most-liked")&&this.sortItems.push({id:"-likes",label:"\u0627\u0644\u0625\u0639\u062C\u0627\u0628\u0627\u062A"}),this.sortItems.push({id:"-views",label:"Global Views"});}isTrendingSortEnabled(e){return this.serverService.getHTMLConfig().trending.videos.algorithms.enabled.includes(e);}getFilterValue(e){if((e.key==="categoryOneOf"||e.key==="languageOneOf")&&Array.isArray(e.rawValue)){if(e.rawValue.length>2)return e.rawValue.length;let o=e.key==="categoryOneOf"?this.videoCategories:this.videoLanguages;return e.rawValue.map(_=>_==="_unknown"?"\u0645\u062C\u0647\u0648\u0644":o.find(O=>O.id+""===_)?.label).join(", ");}return e.value;}onAccountSettingsClick(e){this.auth.isLoggedIn()||(e.preventDefault(),e.stopPropagation(),this.modalService.openQuickSettingsSubject.next());}patchForm(e){let o=this.filters().toFormObject();this.form.patchValue(o,{emitEvent:e}),It("Patch form",{values:o});}};F(t,"\u0275fac",function(o){return new(o||t)();}),F(t,"\u0275cmp",D({type:t,selectors:[["my-video-filters-header"]],inputs:{filters:[1,"filters"],displayModerationBlock:[1,"displayModerationBlock"],hideScope:[1,"hideScope"]},features:[X([de])],decls:68,vars:14,consts:()=>{let e;e="Sort by:";let o;o="Content preferences";let s;s="You always use the same preferences?";let _;_=" Update your "+"\uFFFD#30\uFFFD"+"default settings"+"\uFFFD/#30\uFFFD"+"";let O;O="\u0627\u0644\u0644\u063A\u0627\u062A";let T;T="\u0645\u062D\u062A\u0648\u0649 \u062D\u0633\u0627\u0633";let _e;_e=" Update your policy in "+"\uFFFD#43\uFFFD"+"your settings"+"\uFFFD/#43\uFFFD"+". ";let ce;ce="Content type";let ge;ge="\u0627\u0644\u0641\u0626\u0627\u062A";let ue;ue="\u0627\u0644\u0646\u0648\u0639";let me;me="VOD & Live videos";let pe;pe="\u0641\u064A\u062F\u064A\u0648\u0647\u0627\u062A \u0645\u0628\u0627\u0634\u0631\u0629";let Ee;Ee="\u0641\u064A\u062F\u064A\u0648\u0647\u0627\u062A VOD";let fe;fe="Videos on "+"\uFFFD#2\uFFFD"+""+"\uFFFD0\uFFFD"+""+"\uFFFD/#2\uFFFD"+"";let x;x="{VAR_PLURAL, plural, =1 {other platform} other {other platforms}}",x=B(x,{VAR_PLURAL:"\uFFFD2\uFFFD"});let k;k=" Videos on "+"[\uFFFD#2\uFFFD|\uFFFD#3\uFFFD]"+""+"\uFFFD0\uFFFD"+""+"[\uFFFD/#2\uFFFD|\uFFFD/#3\uFFFD]"+" and "+"[\uFFFD#2\uFFFD|\uFFFD#3\uFFFD]"+""+"\uFFFD1\uFFFD"+""+"[\uFFFD/#2\uFFFD|\uFFFD/#3\uFFFD]"+" "+x+" ",k=B(k);let Se;Se="More filters";let he;he="Hide filters";let Ce;Ce="Platforms order";let U;U="{VAR_PLURAL, plural, =1 {other platform} other {other platforms}}",U=B(U,{VAR_PLURAL:"\uFFFD2\uFFFD"});let Oe;Oe=""+"\uFFFD0\uFFFD"+" platform subscribes to content from "+"\uFFFD#7\uFFFD"+""+"\uFFFD1\uFFFD"+" "+U+""+"\uFFFD/#7\uFFFD"+". ";let Re;Re="Set your display preferences here.";let ve;ve="Displayed videos";let Fe;Fe="Display all videos (private, unlisted, password protected, not yet published or sensitive videos)";let Ae;return Ae="\u0627\u0644\u0625\u0634\u0631\u0627\u0641",[e,o,s,_,O,T,_e,ce,ge,ue,me,pe,Ee,fe,k,Se,he,Ce,Oe,Re,ve,Ae,[1,"root",3,"formGroup"],[1,"d-flex","flex-wrap","mb-3"],["theme","secondary","ptRouterLink",".","ptQueryParamsHandling","merge",1,"me-2","mb-2",3,"icon","ptQueryParams","active"],[1,"d-flex","flex-wrap-reverse","align-items-start","justify-content-between"],[1,"gap-3"],["class","scope-info",3,"ngClass",4,"ngIf"],[1,"filters-summary"],[1,"d-inline-block","active-filters"],["aria-controls","collapseBasic",1,"filters-toggle","peertube-button-like-link",3,"click","ngClass"],["iconName","chevrons-up"],[1,"d-flex","flex-wrap","align-items-center","mb-2"],["for","sort-videos",1,"select-label"],["inputId","sort-videos","formControlName","sort",1,"d-inline-block","me-2",3,"items"],[3,"ngbCollapse","animation"],[1,"filters"],[1,"section"],[1,"section-title"],[1,"with-description"],["routerLink","/my-account/settings","fragment","video-languages-subtitles",3,"click"],[1,"form-group"],["for","languageOneOf"],["inputId","languageOneOf","formControlName","languageOneOf",3,"maxLanguages"],["role","radiogroup",1,"form-group"],["for","nsfw"],[1,"form-group-description"],["routerLink","/my-account/settings","fragment","video-sensitive-content-policy",3,"click"],["class","section",4,"ngIf"],["for","categoryOneOf"],["inputId","categoryOneOf","formControlName","categoryOneOf"],["for","type"],[1,"peertube-radio-container"],["formControlName","live","type","radio","name","live","id","liveBoth","value","both"],["for","liveBoth"],["formControlName","live","type","radio","name","live","id","liveTrue","value","true"],["for","liveTrue"],["formControlName","live","type","radio","name","live","id","liveFalse","value","false"],["for","liveFalse"],[1,"scope-info",3,"ngClass"],[1,"d-inline-block","active-filter"],[4,"ngIf"],["routerLink","/about/follows","target","_blank"],["for","scope"],["inputId","scope","formControlName","scope",1,"scope-select",3,"items"],["formControlName","allVideos","inputName","allVideos","labelText",Fe]];},template:function(o,s){o&1&&(r(0,"div",22)(1,"div",23),oe(2,Ht,2,4,"my-button",24,He),l(),r(4,"div",25)(5,"div",26),p(6,kt,3,4,"div",27),r(7,"div",28)(8,"div",29),oe(9,Gt,1,1,null,null,$t),l(),r(11,"button",30),R("click",function(){return s.areFiltersCollapsed=!s.areFiltersCollapsed;}),p(12,Bt,2,0,"ng-container")(13,Xt,2,0,"ng-container"),E(14,"my-global-icon",31),l()()(),r(15,"div",32)(16,"label",33),m(17,0),l(),E(18,"my-select-options",34),l()(),r(19,"div",35)(20,"div",36)(21,"div",37)(22,"div",38),h(23),m(24,1),C(),r(25,"div",39)(26,"span"),m(27,2),l(),r(28,"span"),P(29,3),r(30,"a",40),R("click",function(O){return s.onAccountSettingsClick(O);}),l(),N(),l()()(),r(31,"div",41)(32,"label",42),m(33,4),l(),E(34,"my-select-languages",43),l(),r(35,"div",44)(36,"label",45),m(37,5),l(),r(38,"div",46)(39,"div"),A(40),l(),r(41,"div"),P(42,6),r(43,"a",47),R("click",function(O){return s.onAccountSettingsClick(O);}),l(),N(),l()()()(),p(44,Wt,14,4,"div",48),r(45,"div",37)(46,"div",38),m(47,7),l(),r(48,"div",41)(49,"label",49),m(50,8),l(),E(51,"my-select-categories",50),l(),r(52,"div",44)(53,"label",51),m(54,9),l(),r(55,"div",52),E(56,"input",53),r(57,"label",54),m(58,10),l()(),r(59,"div",52),E(60,"input",55),r(61,"label",56),m(62,11),l()(),r(63,"div",52),E(64,"input",57),r(65,"label",58),m(66,12),l()()()(),p(67,Qt,5,0,"div",48),l()()()),o&2&&(d("formGroup",s.form),a(2),se(s.quickFilters),a(4),d("ngIf",!s.hideScope()),a(3),se(s.filters().getActiveFilters()),a(2),d("ngClass",H(12,Lt,!s.areFiltersCollapsed)),$e("aria-expanded",!s.areFiltersCollapsed),a(),y(s.areFiltersCollapsed?12:13),a(6),d("items",s.sortItems),a(),d("ngbCollapse",s.areFiltersCollapsed)("animation",!0),a(15),d("maxLanguages",20),a(6),V(s.filters().getNSFWSettingsLabel()),a(4),d("ngIf",s.totalFollowing&&!s.hideScope()),a(23),d("ngIf",s.canSeeAllVideos()));},dependencies:[Be,Y,We,je,Q,Qe,Ze,Ke,qe,W,b,K,at,Rt,Tt,Ct,ht,q],styles:[`@charset "UTF-8";.root[_ngcontent-%COMP%]{margin-bottom:1rem;min-height:140px}.scope-info[_ngcontent-%COMP%]{font-size:20px;color:var(--fg-350)}.select-label[_ngcontent-%COMP%]{font-weight:400;margin-bottom:0;color:var(--fg-200);font-size:1rem;margin-inline-end:.5rem}.section[_ngcontent-%COMP%]{min-width:1px;margin-inline-end:calc(1.425rem + 2.1vw)}@media (min-width: 1200px){.section[_ngcontent-%COMP%]{margin-inline-end:3rem}}.section-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:var(--fg-300);margin-bottom:.5rem}.section-title[_ngcontent-%COMP%]   .with-description[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.section-title[_ngcontent-%COMP%]   .with-description[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:inherit}.form-group-description[_ngcontent-%COMP%]{color:var(--fg-300)}.filters[_ngcontent-%COMP%]{--input-bg: var(--input-bg-in-secondary);--input-border-color: var(--input-bg-in-secondary);display:flex;flex-wrap:wrap;background-color:var(--bg-secondary-400);border-radius:14px;padding:calc(1.275rem + .3vw)}@media (min-width: 1200px){.filters[_ngcontent-%COMP%]{padding:1.5rem}}.filters[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%] + label[_ngcontent-%COMP%]{font-weight:400}.filters[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.filters[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]:not(.select-label){display:block;color:var(--fg-300);font-size:18px}.active-filters[_ngcontent-%COMP%]   .active-filter[_ngcontent-%COMP%]:not(:last-child):after{content:"\\2022";font-weight:400;display:inline-block;margin:0 5px}.filters-summary[_ngcontent-%COMP%]{color:var(--fg-200)}.filters-toggle[_ngcontent-%COMP%]{padding:var(--input-y-padding) .5rem calc(var(--input-y-padding) + .75rem) .75rem;margin-inline-start:.75rem}.filters-toggle[_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%]{color:var(--secondary-icon-color);margin-inline-start:.3125rem}.filters-toggle.active[_ngcontent-%COMP%]{background-color:var(--bg-secondary-400);border-start-start-radius:14px;border-start-end-radius:14px}.filters-toggle.active[_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%]{position:relative;top:-1px}.filters-toggle[_ngcontent-%COMP%]:not(.active)   my-global-icon[_ngcontent-%COMP%]     svg{transform:rotate(180deg)}.scope-select[_ngcontent-%COMP%]{min-width:250px;max-width:300px;height:min-content}my-select-languages[_ngcontent-%COMP%], my-select-categories[_ngcontent-%COMP%], my-select-options[_ngcontent-%COMP%]{max-width:300px;display:inline-block}.update-your-settings[_ngcontent-%COMP%]{font-size:12px;margin-bottom:10px}.update-your-settings[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary);text-decoration:underline}@media screen and (max-width: 800px){.scope-select[_ngcontent-%COMP%]{min-width:auto;max-width:90%}.filters-toggle[_ngcontent-%COMP%]{margin-top:.5rem;margin-inline-start:0}.filters-summary[_ngcontent-%COMP%]{display:flex;flex-direction:column}.filters[_ngcontent-%COMP%]{border-start-start-radius:0;border-start-end-radius:0}}
/*# sourceMappingURL=video-filters-header.component-TWLD6574.css.map */`]}));let i=t;return i;})();var yt=te(ae());var J=(0,yt.default)("peertube:videos:VideoFilters"),Z=class i{sort;languageOneOf;categoryOneOf;scope;allVideos;live;search;nsfwPolicy;nsfwFlagsDisplayed;nsfwFlagsHidden;nsfwFlagsWarned;nsfwFlagsBlurred;defaultValues=new Map([["sort","-publishedAt"],["languageOneOf",void 0],["categoryOneOf",void 0],["scope","federated"],["allVideos",!1],["live","both"],["search",""]]);activeFilters=[];onChangeCallbacks=[];oldFormObjectString;customizedByUser=!1;hiddenFields=[];constructor(t,n,e=[]){this.setDefaultSort(t),this.setDefaultScope(n),this.hiddenFields=e,this.reset({triggerChange:!1});}onChange(t){this.onChangeCallbacks.push(t);}triggerChange(){if(this.onChangeCallbacks.length===0)return;let t=JSON.stringify(this.toFormObject()),n=!!this.oldFormObjectString&&t===this.oldFormObjectString;if(J("Checking if we need to trigger change",{changes:!n}),!n){this.oldFormObjectString=t;for(let e of this.onChangeCallbacks)e();}}setDefaultScope(t){this.defaultValues.set("scope",t);}setDefaultSort(t){this.defaultValues.set("sort",t);}setNSFWPolicy(t){this.nsfwPolicy=t.nsfwPolicy,this.nsfwFlagsDisplayed=t.nsfwFlagsDisplayed,this.nsfwFlagsHidden=t.nsfwFlagsHidden,this.nsfwFlagsWarned=t.nsfwFlagsWarned,this.nsfwFlagsBlurred=t.nsfwFlagsBlurred;}reset(t){let{specificKey:n,triggerChange:e=!0}=t;J("Reset video filters",{specificKey:n});for(let[o,s]of this.defaultValues)n&&n!==o||(this[o]=s);this.buildActiveFilters(),e&&this.triggerChange();}load(t,n){J("Loading object in video filters",{obj:t,customizedByUser:n}),this.reset({triggerChange:!1}),n&&(this.customizedByUser=n),t.sort!==void 0&&(this.sort=t.sort),t.languageOneOf!==void 0&&(this.languageOneOf=le(t.languageOneOf)),t.categoryOneOf!==void 0&&(this.categoryOneOf=le(t.categoryOneOf)),t.scope!==void 0&&(this.scope=t.scope),t.allVideos!==void 0&&(this.allVideos=dt(t.allVideos)),t.live!==void 0&&(this.live=t.live),t.search!==void 0&&(this.search=t.search),this.buildActiveFilters(),this.triggerChange();}clone(){J("Cloning video filters",{videoFilters:this});let t=new i(this.defaultValues.get("sort"),this.defaultValues.get("scope"),this.hiddenFields);return t.setNSFWPolicy({nsfwPolicy:this.nsfwPolicy,nsfwFlagsDisplayed:this.nsfwFlagsDisplayed,nsfwFlagsHidden:this.nsfwFlagsHidden,nsfwFlagsWarned:this.nsfwFlagsWarned,nsfwFlagsBlurred:this.nsfwFlagsBlurred}),t.load(this.toUrlObject(),this.customizedByUser),t;}hasBeenCustomizedByUser(){return this.customizedByUser;}buildActiveFilters(){this.activeFilters=[],this.activeFilters.push({key:"nsfw",canRemove:!1,label:"\u0645\u062D\u062A\u0648\u0649 \u062D\u0633\u0627\u0633",value:this.getNSFWValue()}),this.activeFilters.push({key:"scope",canRemove:!1,label:"\u062D\u064A\u0632",value:this.scope==="federated"?"All platforms":"This platform"}),this.languageOneOf&&this.languageOneOf.length!==0&&this.activeFilters.push({key:"languageOneOf",canRemove:!0,label:"\u0627\u0644\u0644\u063A\u0627\u062A",value:this.languageOneOf.map(t=>t.toUpperCase()).join(", "),rawValue:this.languageOneOf}),this.categoryOneOf&&this.categoryOneOf.length!==0&&this.activeFilters.push({key:"categoryOneOf",canRemove:!0,label:"\u0627\u0644\u0641\u0626\u0627\u062A",value:this.categoryOneOf.join(", "),rawValue:this.categoryOneOf}),this.allVideos&&this.activeFilters.push({key:"allVideos",canRemove:!0,label:"\u0643\u0644 \u0627\u0644\u0641\u064A\u062F\u064A\u0648\u0647\u0627\u062A"}),this.live==="true"?this.activeFilters.push({key:"live",canRemove:!0,label:"Only lives"}):this.live==="false"&&this.activeFilters.push({key:"live",canRemove:!0,label:"Only VOD"}),this.activeFilters=this.activeFilters.filter(t=>this.hiddenFields.includes(t.key)===!1);}getActiveFilters(){return this.activeFilters;}toFormObject(){let t={};for(let[n]of this.defaultValues)t[n]=this[n];return t;}toUrlObject(){let t={};for(let[n,e]of this.defaultValues)this[n]!==e&&(t[n]=this[n]);return t;}toVideosAPIObject(){let t,n,e;this.scope==="local"&&(t=!0),this.allVideos&&(n=tt.NOT_PUBLISHED_STATE,e=lt());let o;return this.live==="true"?o=!0:this.live==="false"&&(o=!1),Ie(Te({},this.buildNSFWVideosAPIObject()),{sort:this.sort,languageOneOf:this.languageOneOf,categoryOneOf:this.categoryOneOf,search:this.search,isLocal:t,include:n,privacyOneOf:e,isLive:o});}buildNSFWVideosAPIObject(){if(this.allVideos)return{nsfw:"both",nsfwFlagsExcluded:j.NONE};let t=this.nsfwPolicy==="do_not_list"?"false":"both",n=j.NONE,e=j.NONE;return this.nsfwPolicy==="do_not_list"?(n|=this.nsfwFlagsDisplayed,n|=this.nsfwFlagsWarned,n|=this.nsfwFlagsBlurred):e|=this.nsfwFlagsHidden,{nsfw:t,nsfwFlagsIncluded:n,nsfwFlagsExcluded:e};}getNSFWSettingsLabel(){let t=this.getGlobalNSFWLabel();return this.hasCustomNSFWFlags()&&(t+=" Some videos with a specific sensitive content category have a different policy."),t;}getGlobalNSFWLabel(){return this.nsfwPolicy==="do_not_list"?"Sensitive content hidden.":this.nsfwPolicy==="warn"?"Sensitive content has a warning.":this.nsfwPolicy==="blur"?"Sensitive content has a warning and the thumbnail is blurred.":"Sensitive content is displayed.";}getNSFWValue(){return this.hasCustomNSFWFlags()?this.nsfwPolicy==="do_not_list"?"hidden (with exceptions)":this.nsfwPolicy==="warn"?"warned (with exceptions)":this.nsfwPolicy==="blur"?"blurred (with exceptions)":"displayed (with exceptions)":this.nsfwPolicy==="do_not_list"?"\u0645\u062E\u0641\u064A":this.nsfwPolicy==="warn"?"warned":this.nsfwPolicy==="blur"?"\u0645\u0637\u0645\u0648\u0633":"\u0645\u0639\u0631\u0648\u0636";}hasCustomNSFWFlags(){return this.nsfwFlagsDisplayed||this.nsfwFlagsHidden||this.nsfwFlagsWarned||this.nsfwFlagsBlurred;}};var Yt=i=>({"display-as-row":i});function jt(i,t){if(i&1&&(r(0,"my-button",12),A(1),l()),i&2){let n=c().$implicit;d("ptRouterLink",n.routerLink)("icon",n.iconName),a(),V(n.label);}}function Kt(i,t){if(i&1&&(h(0),p(1,jt,2,3,"my-button",12),C()),i&2){let n=t.$implicit;a(),y(n.routerLink?1:-1);}}function qt(i,t){if(i&1&&(r(0,"div",10),p(1,Kt,2,1,"ng-container",11),l()),i&2){let n=c();a(),d("ngForOf",n.headerActions());}}function Jt(i,t){if(i&1&&E(0,"my-video-filters-header",13),i&2){let n=c();d("displayModerationBlock",n.displayModerationBlock)("hideScope",n.hideScopeFilter())("filters",n.filters);}}function Zt(i,t){i&1&&(r(0,"div",14),m(1,0),l());}function ei(i,t){if(i&1){let n=L();h(0),r(1,"div",18)(2,"my-video-miniature",19),R("videoBlocked",function(){let o=I(n).$implicit,s=c(2);return M(s.removeVideoFromArray(o));})("videoRemoved",function(){let o=I(n).$implicit,s=c(2);return M(s.removeVideoFromArray(o));}),l()(),C();}if(i&2){let n=t.$implicit,e=c(2);a(2),d("video",n)("user",e.user)("displayAsRow",e.displayAsRow())("displayVideoActions",e.displayVideoActions())("displayOptions",e.displayOptions);}}function ti(i,t){i&1&&(r(0,"h2",15),E(1,"my-global-icon",20),A(2," Videos "),l());}function ii(i,t){if(i&1&&(h(0),r(1,"h2",15),E(2,"my-global-icon",16),h(3),m(4,1),C(),l(),p(5,ei,3,5,"ng-container",9)(6,ti,3,0,"h2",17),C()),i&2){let n=c();a(5),d("ngForOf",n.highlightedLives)("ngForTrackBy",n.videoById),a(),d("ngIf",!n.groupByDate());}}function ni(i,t){if(i&1&&(r(0,"h2",15),A(1),l()),i&2){let n=c().$implicit,e=c();a(),$(" ",e.getCurrentGroupedDateLabel(n)," ");}}function oi(i,t){if(i&1){let n=L();h(0),p(1,ni,2,1,"h2",17),r(2,"div",18)(3,"my-video-miniature",19),R("videoBlocked",function(){let o=I(n).$implicit,s=c();return M(s.removeVideoFromArray(o));})("videoRemoved",function(){let o=I(n).$implicit,s=c();return M(s.removeVideoFromArray(o));}),l()(),C();}if(i&2){let n=t.$implicit,e=c();a(),d("ngIf",e.getCurrentGroupedDateLabel(n)),a(2),d("video",n)("user",e.user)("displayAsRow",e.displayAsRow())("displayVideoActions",e.displayVideoActions())("displayOptions",e.displayOptions);}}var ee=(0,Pt.default)("peertube:videos:VideosListComponent"),S=function(i){return i[i.UNKNOWN=0]="UNKNOWN",i[i.TODAY=1]="TODAY",i[i.YESTERDAY=2]="YESTERDAY",i[i.THIS_WEEK=3]="THIS_WEEK",i[i.THIS_MONTH=4]="THIS_MONTH",i[i.LAST_MONTH=5]="LAST_MONTH",i[i.OLDER=6]="OLDER",i;}(S||{}),Zi=(()=>{let t=class t{notifier=f(_t);userService=f(ft);route=f(Ge);screenService=f(Et);peertubeRouter=f(pt);getVideosObservableFunction=u(void 0);getSyndicationItemsFunction=u(void 0);defaultSort=u(void 0);defaultScope=u("federated");displayFilters=u(!1,{transform:v});displayBy=u(!0,{transform:v});hideScopeFilter=u(!1,{transform:v});loadUserVideoPreferences=u(!1,{transform:v});displayAsRow=u(!1,{transform:v});displayVideoActions=u(!0,{transform:v});groupByDate=u(!1,{transform:v});highlightLives=u(!1,{transform:v});headerActions=u([]);disabled=u(!1,{transform:v});filtersChanged=ne();videosLoaded=ne();videos=[];highlightedLives=[];filters;syndicationItems;onVideosDataSubject=new ie();hasDoneFirstQuery=!1;user;displayOptions={date:!0,views:!0,by:!0,avatar:!0,privacyLabel:!0};displayModerationBlock=!0;routeSub;userSub;resizeSub;pagination={currentPage:1,itemsPerPage:25,totalItems:null};groupedDateLabels={[S.UNKNOWN]:null,[S.TODAY]:"Today's videos",[S.YESTERDAY]:"Yesterday's videos",[S.THIS_WEEK]:"This week's videos",[S.THIS_MONTH]:"This month's videos",[S.LAST_MONTH]:"Last month's videos",[S.OLDER]:"Older videos"};groupedDates={};lastQueryLength;videoRequests=new ie();alreadyDoneSearch=!1;ngOnInit(){this.displayOptions.by=this.displayBy(),this.displayOptions.avatar=this.displayBy(),this.subscribeToVideoRequests();let e=this.hideScopeFilter()?["scope"]:[];this.filters=new Z(this.defaultSort(),this.defaultScope(),e),this.resizeSub=Pe(window,"resize").pipe(be(500)).subscribe(()=>this.calcPageSizes()),this.calcPageSizes(),this.userService.getAnonymousOrLoggedUser().subscribe(o=>{this.user=o,this.loadUserVideoPreferences()&&this.loadUserSettings(o),this.subscribeToAnonymousUpdate(),this.subscribeToQueryParamsChange();}),this.filters.load(this.route.snapshot.queryParams),this.filters.onChange(()=>{ee("Filters changed",this.filters),this.videos=[],this.highlightedLives=[],this.updateUrl(),this.reloadSyndicationItems(),this.reloadVideos(),this.filtersChanged.emit(this.filters);}),this.reloadSyndicationItems(),this.reloadVideos();}ngOnDestroy(){this.resizeSub&&this.resizeSub.unsubscribe(),this.routeSub&&this.routeSub.unsubscribe(),this.userSub&&this.userSub.unsubscribe();}videoById(e,o){return o.id;}onNearOfBottom(){this.disabled()||this.lastQueryLength!==void 0&&this.lastQueryLength<this.pagination.itemsPerPage||(this.pagination.currentPage+=1,this.loadMoreVideos());}loadMoreVideos(e=!1){let o,s;e&&(this.hasDoneFirstQuery=!1,this.videos=[],this.highlightedLives=[],this.highlightLives()&&(!this.filters.live||this.filters.live==="both")&&(o=this.filters.clone(),o.live="true",s=this.filters.clone(),s.live="false")),this.videoRequests.next({reset:e,obsVideos:this.getVideosObservableFunction()(this.pagination,s??this.filters),obsHighlightedLives:o?this.getVideosObservableFunction()(this.pagination,o):Me({data:this.highlightedLives})});}reloadVideos(){ut(this.pagination),this.loadMoreVideos(!0);}removeVideoFromArray(e){this.videos.some(o=>o.id===e.id)&&(this.videos=this.videos.filter(o=>o.id!==e.id),gt(this.pagination)),this.highlightedLives=this.highlightedLives.filter(o=>o.id!==e.id);}calcPageSizes(){this.screenService.isInMobileView()&&(this.pagination.itemsPerPage=5);}loadUserSettings(e){this.filters.setNSFWPolicy(e),this.filters.load({languageOneOf:e.videoLanguages});}reloadSyndicationItems(){Promise.resolve(this.getSyndicationItemsFunction()(this.filters)).then(e=>{!e||e.length===0?this.syndicationItems=void 0:this.syndicationItems=e;}).catch(e=>re.error("Cannot get syndication items.",e));}updateUrl(){let e=this.filters.toUrlObject();ee("Will inject URL query",{queryParams:e}),(Object.keys(e).length!==0||this.filters.hasBeenCustomizedByUser())&&this.peertubeRouter.silentNavigate([],e);}subscribeToAnonymousUpdate(){this.userSub=this.userService.listenAnonymousUpdate().pipe(Le(()=>this.userService.getAnonymousOrLoggedUser())).subscribe(e=>{ee("User changed",{user:e}),this.user=e,this.loadUserVideoPreferences()&&this.loadUserSettings(e),this.hasDoneFirstQuery&&this.reloadVideos();});}subscribeToQueryParamsChange(){this.routeSub=this.route.queryParams.subscribe(e=>{if(Object.keys(e).length===0&&!this.filters.hasBeenCustomizedByUser())return;let o=e.search;o?this.alreadyDoneSearch=!0:this.alreadyDoneSearch&&(o=""),ee("Query params changed",e),this.filters.load(e);});}subscribeToVideoRequests(){this.videoRequests.pipe(Ne(({reset:e,obsHighlightedLives:o,obsVideos:s})=>ye([o,s]).pipe(De(([_,O])=>({highlightedLives:_.data,videos:O.data,reset:e}))))).subscribe({next:({videos:e,highlightedLives:o,reset:s})=>{this.hasDoneFirstQuery=!0,this.lastQueryLength=e.length,s&&(this.videos=[],this.highlightedLives=o),this.videos=this.videos.concat(e),this.groupByDate()&&this.buildGroupedDateLabels(),this.onVideosDataSubject.next(e),this.videosLoaded.emit(this.videos);},error:e=>{let o="\u0644\u0627 \u064A\u0645\u0643\u0646 \u062A\u062D\u0645\u064A\u0644 \u0645\u0632\u064A\u062F \u0645\u0646 \u0627\u0644\u0641\u064A\u062F\u064A\u0648\u0647\u0627\u062A. \u0623\u0639\u062F \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629 \u0644\u0627\u062D\u0642\u0627.";re.error(o,e),this.notifier.error(o);}});}buildGroupedDateLabels(){let e=S.UNKNOWN,o=[{value:S.TODAY,validator:_=>it(_)},{value:S.YESTERDAY,validator:_=>nt(_)},{value:S.THIS_WEEK,validator:_=>rt(_)},{value:S.THIS_MONTH,validator:_=>ot(_)},{value:S.LAST_MONTH,validator:_=>st(_)},{value:S.OLDER,validator:()=>!0}],s=!0;for(let _ of this.videos){let O=_.publishedAt;for(let T of o)if(e<=T.value&&T.validator(O)){e!==T.value&&(T.value!==S.OLDER&&(s=!1),e=T.value,this.groupedDates[_.id]=e);break;}}s&&(this.groupedDates={});}getCurrentGroupedDateLabel(e){if(this.groupByDate()!==!1)return this.groupedDateLabels[this.groupedDates[e.id]];}};F(t,"\u0275fac",function(o){return new(o||t)();}),F(t,"\u0275cmp",D({type:t,selectors:[["my-videos-list"]],inputs:{getVideosObservableFunction:[1,"getVideosObservableFunction"],getSyndicationItemsFunction:[1,"getSyndicationItemsFunction"],defaultSort:[1,"defaultSort"],defaultScope:[1,"defaultScope"],displayFilters:[1,"displayFilters"],displayBy:[1,"displayBy"],hideScopeFilter:[1,"hideScopeFilter"],loadUserVideoPreferences:[1,"loadUserVideoPreferences"],displayAsRow:[1,"displayAsRow"],displayVideoActions:[1,"displayVideoActions"],groupByDate:[1,"groupByDate"],highlightLives:[1,"highlightLives"],headerActions:[1,"headerActions"],disabled:[1,"disabled"]},outputs:{filtersChanged:"filtersChanged",videosLoaded:"videosLoaded"},decls:8,vars:10,consts:()=>{let e;e="\u0644\u0627 \u0646\u062A\u0627\u0626\u062C.";let o;return o="Current lives",[e,o,[1,"margin-content"],[1,"videos-header"],["class","action-block mb-4",4,"ngIf"],["class","d-block",3,"displayModerationBlock","hideScope","filters",4,"ngIf"],["class","no-results",4,"ngIf"],["myInfiniteScroller","",1,"videos",3,"nearOfBottom","dataObservable","ngClass"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"action-block","mb-4"],[4,"ngFor","ngForOf"],["theme","secondary",3,"ptRouterLink","icon"],[1,"d-block",3,"displayModerationBlock","hideScope","filters"],[1,"no-results"],[1,"date-title"],["iconName","live",1,"pt-icon","me-1","top--1px"],["class","date-title",4,"ngIf"],[1,"video-wrapper"],[3,"videoBlocked","videoRemoved","video","user","displayAsRow","displayVideoActions","displayOptions"],["iconName","videos",1,"pt-icon","me-1"]];},template:function(o,s){o&1&&(r(0,"div",2)(1,"div",3),p(2,qt,2,1,"div",4),l(),p(3,Jt,1,3,"my-video-filters-header",5)(4,Zt,2,0,"div",6),r(5,"div",7),R("nearOfBottom",function(){return s.onNearOfBottom();}),p(6,ii,7,3,"ng-container",8)(7,oi,4,6,"ng-container",9),l()()),o&2&&(a(2),d("ngIf",s.headerActions().length!==0),a(),d("ngIf",s.displayFilters()),a(),d("ngIf",s.hasDoneFirstQuery&&s.videos.length===0&&s.highlightedLives.length===0),a(),d("dataObservable",s.onVideosDataSubject.asObservable())("ngClass",H(8,Yt,s.displayAsRow())),a(),d("ngIf",s.highlightedLives.length!==0),a(),d("ngForOf",s.videos)("ngForTrackBy",s.videoById));},dependencies:[ze,W,Ue,b,q,Dt,St,Ft,K],styles:[`.videos[_ngcontent-%COMP%]{min-height:50vh}.videos-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto}.videos-header[_ngcontent-%COMP%]   .action-block[_ngcontent-%COMP%]{grid-column:3;grid-row:1/3}.date-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:20px;font-size:1rem;grid-column:1/-1}.date-title[_ngcontent-%COMP%]:not(:first-child){margin-top:.5rem;padding-top:20px;border-top:1px solid var(--bg-secondary-400)}.margin-content[_ngcontent-%COMP%]{--grid-videos-miniature-margins: var(--x-margin-content);margin-inline-start:var(--grid-videos-miniature-margins)!important;margin-inline-end:var(--grid-videos-miniature-margins)!important}@media screen and (max-width: 500px){.margin-content[_ngcontent-%COMP%]{--grid-videos-miniature-margins: 0;width:auto}}@media screen and (min-width: 500px){.margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]{--co-miniature-min-width: 255px;--co-miniature-max-width: 280px;display:grid;column-gap:30px;grid-template-columns:repeat(auto-fill,minmax(var(--co-miniature-min-width),1fr))}.margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]{margin:0 auto;width:100%}.margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%]{display:block;min-width:var(--co-miniature-min-width);max-width:var(--co-miniature-max-width)}}@media screen and (min-width: 500px) and (min-width: 1800px){.margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%], .margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]{column-gap:2%}}.display-as-row.videos[_ngcontent-%COMP%]{margin-inline-start:var(--x-margin-content);margin-inline-end:var(--x-margin-content)}.display-as-row.videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]{margin-bottom:1rem}@media screen and (max-width: 500px){my-video-filters-header[_ngcontent-%COMP%]{display:inline-block;margin-inline-start:1rem;margin-inline-end:1rem}.date-title[_ngcontent-%COMP%]{text-align:center}.videos-header[_ngcontent-%COMP%]{text-align:center;width:100%;margin-bottom:1rem;display:block}}
/*# sourceMappingURL=videos-list.component-BHM3QTKY.css.map */`]}));let i=t;return i;})();export{Zi as a};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-47BTBF55.js.map