import{a as fe}from"./chunk-47BTBF55.js";import{h as ve}from"./chunk-DJO6R22E.js";import{c as E}from"./chunk-BFVCLNOF.js";import{a as _e}from"./chunk-6TRYPH2T.js";import{c as ge}from"./chunk-2O3IZ566.js";import{a as pe}from"./chunk-S5ARXDTR.js";import{B as $,Bb as O,Bc as H,Cb as f,Cc as J,Cg as de,Dc as K,Df as se,Ha as s,He as oe,Mb as G,Na as F,Nb as Q,Oc as Y,Pb as h,Q as _,Qb as P,Qg as me,S as w,Sa as M,Sg as ue,Tc as Z,Xc as ee,Xf as ae,Y as N,Ya as v,Zb as X,aa as l,c as R,eb as d,ha as k,ia as T,j as V,jb as q,kd as te,kg as ce,lb as W,mb as j,mf as re,n as I,nb as c,nc as U,ob as a,pb as x,pd as ne,r as D,re as ie,tb as A,xb as g,xg as le,yb as z,zb as B}from"./chunk-F7FAPFPY.js";import{a as S,b as L,i as m}from"./chunk-AI7IVZV2.js";var p=class p{authHttp=l(ee);restExtractor=l(ce);videosService=l(E);serverService=l(le);getVideosOverview(i){let n=new Z();return n=n.append("page",i+""),this.authHttp.get(p.BASE_OVERVIEW_URL+"videos",{params:n}).pipe(_(e=>this.updateVideosOverview(e)),$(e=>this.restExtractor.handleError(e)));}updateVideosOverview(i){let n=[],e={tags:[],categories:[],channels:[]};for(let t of ie(i))for(let r of i[t])n.push(V(r.videos).pipe(_(u=>this.videosService.extractVideos({total:0,data:u})),I(u=>u.data),w(u=>{e[t].push(se(r,{videos:u}));})));return n.length===0?V(e):D(n).pipe(_(()=>this.serverService.getServerLocale().pipe(w(t=>{for(let r of e.categories)r.category.label=oe(r.category.label,t);}))),I(()=>e));}};m(p,"BASE_OVERVIEW_URL",re.apiUrl+"/api/v1/overviews/"),m(p,"\u0275fac",function(n){return new(n||p)();}),m(p,"\u0275prov",N({token:p,factory:p.Éµfac}));var b=p;var he=["quickAccessContent"],Ce=o=>({"see-all-quick-links":o}),ye=(o,i)=>i.label;function Me(o,i){o&1&&(c(0,"div",7),g(1,2),a());}function Pe(o,i){if(o&1&&(c(0,"a",11),h(1),a()),o&2){let n=i.$implicit;d("routerLink",n.routerLink)("queryParams",n.queryParams),s(),P(n.label);}}function Ee(o,i){if(o&1){let n=A();c(0,"button",15),O("click",function(){k(n);let t=f(2);return T(t.seeAllQuickLinks=!0);}),g(1,4),a();}}function be(o,i){if(o&1&&x(0,"my-actor-avatar",25),o&2){let n=f().$implicit;d("actor",n.channel);}}function Se(o,i){if(o&1&&(c(0,"div",26),x(1,"my-video-miniature",27),a()),o&2){let n=i.$implicit,e=f(3);s(),d("video",n)("user",e.userMiniature)("displayVideoActions",!0);}}function Ve(o,i){if(o&1&&(c(0,"div",16)(1,"div",17)(2,"h1",18),v(3,be,1,1,"my-actor-avatar",19),c(4,"a",20),h(5),a(),c(6,"span",21),h(7,"\xB7"),a(),c(8,"span",22),g(9,5),a()(),c(10,"my-button",23),h(11),a()(),v(12,Se,2,3,"div",24),a()),o&2){let n=i.$implicit;s(3),d("ngIf",n.channel),s(),d("queryParams",n.queryParams),s(),P(n.label),s(4),z(n.type),B(9),s(),d("routerLink",n.routerLink)("queryParams",n.queryParams),s(),P(n.buttonLabel),s(),d("ngForOf",n.videos);}}function Ie(o,i){if(o&1){let n=A();c(0,"div",8)(1,"div",9,0)(3,"span",10),g(4,3),a(),W(5,Pe,2,3,"a",11,ye),a(),v(7,Ee,2,0,"button",12),a(),c(8,"div",13),O("nearOfBottom",function(){k(n);let t=f();return T(t.onNearOfBottom());}),v(9,Ve,13,8,"div",14),a();}if(o&2){let n=f();s(),d("ngClass",X(4,Ce,n.seeAllQuickLinks)),s(4),j(n.quickAccessLinks),s(2),d("ngIf",!n.seeAllQuickLinks&&n.quickAccessOverflow),s(),d("dataObservable",n.onDataSubject.asObservable()),s(),d("ngForOf",n.objects);}}var Ze=(()=>{let i=class i{notifier=l(ae);userService=l(ue);overviewService=l(b);cd=l(U);quickAccessContent=F("quickAccessContent");onDataSubject=new R();notResults=!1;userMiniature;objects=[];quickAccessLinks=[];seeAllQuickLinks=!1;quickAccessOverflow=!1;disabled=!1;loaded=!1;currentPage=1;maxPage=20;lastWasEmpty=!1;isLoading=!1;checkQuickAccessOverflow=!1;userSub;ngOnInit(){this.loadMoreResults(),this.userService.getAnonymousOrLoggedUser().subscribe(e=>this.userMiniature=e),this.userSub=this.userService.listenAnonymousUpdate().pipe(_(()=>this.userService.getAnonymousOrLoggedUser())).subscribe(e=>{this.userMiniature=e,this.objects=[],this.loadMoreResults();});}ngOnDestroy(){this.userSub&&this.userSub.unsubscribe();}ngAfterViewChecked(){if(this.quickAccessOverflow||!this.checkQuickAccessOverflow)return;this.checkQuickAccessOverflow=!1;let e=this.quickAccessContent().nativeElement;this.quickAccessOverflow=e.scrollWidth>e.clientWidth,this.cd.detectChanges();}disableForReuse(){this.disabled=!0;}enabledForReuse(){this.disabled=!1;}onNearOfBottom(){this.currentPage>=this.maxPage||this.lastWasEmpty||this.isLoading||this.disabled||(this.currentPage++,this.loadMoreResults());}loadMoreResults(){this.isLoading=!0,this.overviewService.getVideosOverview(this.currentPage).subscribe({next:e=>{if(this.isLoading=!1,e.tags.length===0&&e.channels.length===0&&e.categories.length===0){this.lastWasEmpty=!0,this.loaded===!1&&(this.notResults=!0);return;}this.loaded=!0,this.onDataSubject.next(e);for(let t of e.categories)this.objects.push({buttonLabel:"Selaa \""+t.category.label+"\" videoita",label:t.category.label,routerLink:["/search"],queryParams:{categoryOneOf:[t.category.id]},videos:t.videos,type:"kategoria"});for(let t of e.tags)this.objects.push({buttonLabel:"Selaa \"#"+t.tag+"\" videoita",label:`#${t.tag}`,routerLink:["/search"],queryParams:{tagsOneOf:[t.tag]},videos:t.videos,type:"tagi"});for(let t of e.channels)this.objects.push({buttonLabel:"N\xE4yt\xE4 kanava",label:t.videos[0].byVideoChannel,routerLink:["/c",t.videos[0].byVideoChannel],queryParams:{},videos:t.videos,channel:t.channel,type:"kanava"});this.quickAccessLinks=this.objects.map(t=>t),this.checkQuickAccessOverflow=!0;},error:e=>{this.notifier.error(e.message),this.isLoading=!1;}});}};m(i,"\u0275fac",function(t){return new(t||i)();}),m(i,"\u0275cmp",M({type:i,selectors:[["my-video-overview"]],viewQuery:function(t,r){t&1&&G(r.quickAccessContent,he,5),t&2&&Q();},decls:4,vars:1,consts:()=>{let e;e="L\xF6yd\xF6t";let t;t="Ei hakutuloksia.";let r;r="Siirry suoraan:";let u;u="Enemm\xE4n";let C;return C="\n          "+"\uFFFD0\uFFFD"+"\n        ",[["quickAccessContent",""],e,t,r,u,C,[1,"visually-hidden"],[1,"margin-content","no-results"],[1,"margin-content","quick-access","mt-3"],[1,"quick-access-links",3,"ngClass"],[1,"me-2","fg-100"],[1,"me-2",3,"routerLink","queryParams"],["type","button","class","peertube-button tertiary-button",3,"click",4,"ngIf"],["myInfiniteScroller","",1,"margin-content","videos-margin-content",3,"nearOfBottom","dataObservable"],["class","section videos",4,"ngFor","ngForOf"],["type","button",1,"peertube-button","tertiary-button",3,"click"],[1,"section","videos"],[1,"section-header","d-flex","flex-wrap","justify-content-between","align-items-start","mb-3"],[1,"section-title"],["size","40px","actorType","channel",3,"actor",4,"ngIf"],["routerLink","/search",1,"text-fg","border-highlight","text-decoration-none",3,"queryParams"],[1,"fg-100","fs-7","mx-2"],[1,"fg-100","fs-7"],["theme","primary",1,"ms-2","d-none-mw",3,"routerLink","queryParams"],["class","video-wrapper",4,"ngFor","ngForOf"],["size","40px","actorType","channel",3,"actor"],[1,"video-wrapper"],[3,"video","user","displayVideoActions"]];},template:function(t,r){t&1&&(c(0,"h1",6),g(1,1),a(),v(2,Me,2,0,"div",7)(3,Ie,10,6)),t&2&&(s(2),q(r.notResults?2:3));},dependencies:[pe,ne,ve,ge,Y,H,J,K,_e],styles:[`.section-header[_ngcontent-%COMP%]{grid-column:1/-1}.section-title[_ngcontent-%COMP%], .section-header[_ngcontent-%COMP%]{display:flex;align-items:center}.section-title[_ngcontent-%COMP%]{font-size:calc(1.275rem + .3vw);margin-bottom:calc(1.325rem + .9vw)}@media (min-width: 1200px){.section-title[_ngcontent-%COMP%]{font-size:1.5rem}}@media (min-width: 1200px){.section-title[_ngcontent-%COMP%]{margin-bottom:2rem}}.margin-content.videos-margin-content[_ngcontent-%COMP%]{--grid-videos-miniature-margins: var(--x-margin-content);margin-inline-start:var(--grid-videos-miniature-margins)!important;margin-inline-end:var(--grid-videos-miniature-margins)!important}@media screen and (max-width: 500px){.margin-content.videos-margin-content[_ngcontent-%COMP%]{--grid-videos-miniature-margins: 0;width:auto}}@media screen and (min-width: 500px){.margin-content.videos-margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]{--co-miniature-min-width: 255px;--co-miniature-max-width: 280px;display:grid;column-gap:30px;grid-template-columns:repeat(auto-fill,minmax(var(--co-miniature-min-width),1fr));grid-template-rows:repeat(2,auto);overflow:hidden;grid-auto-rows:0}.margin-content.videos-margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]{margin:0 auto;width:100%}.margin-content.videos-margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .video-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-miniature[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]   .playlist-wrapper[_ngcontent-%COMP%]   my-video-playlist-miniature[_ngcontent-%COMP%]{display:block;min-width:var(--co-miniature-min-width);max-width:var(--co-miniature-max-width)}}@media screen and (min-width: 500px) and (min-width: 1800px){.margin-content.videos-margin-content[_ngcontent-%COMP%]   .videos[_ngcontent-%COMP%], .margin-content.videos-margin-content[_ngcontent-%COMP%]   .playlists[_ngcontent-%COMP%]{column-gap:2%}}.quick-access[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:start;white-space:nowrap}.quick-access-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--fg-300);text-decoration:underline}.quick-access-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{opacity:.8}.quick-access-links[_ngcontent-%COMP%]:not(.see-all-quick-links){overflow:hidden;text-overflow:ellipsis}.see-all-quick-links[_ngcontent-%COMP%]{white-space:normal;display:flex;flex-wrap:wrap}.section[_ngcontent-%COMP%]{margin-top:calc(1.375rem + 1.5vw)}@media (min-width: 1200px){.section[_ngcontent-%COMP%]{margin-top:2.5rem}}@media screen and (max-width: 500px){.section[_ngcontent-%COMP%]{max-height:initial;overflow:initial}.section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin-inline-start:var(--x-margin-content)}}my-actor-avatar[_ngcontent-%COMP%]{width:40px;height:40px;margin-inline-end:.625rem}
/*# sourceMappingURL=video-overview.component-ICIG244M.css.map */`]}));let o=i;return o;})();var lt=(()=>{let i=class i{route=l(te);videoService=l(E);hooks=l(me);meta=l(de);getVideosObservableFunction=this.getVideosObservable.bind(this);getSyndicationItemsFunction=this.getSyndicationItems.bind(this);title;groupByDate;defaultSort;defaultScope;loadUserVideoPreferences=!0;displayFilters=!0;disabled=!1;routeSub;ngOnInit(){this.defaultSort="-publishedAt",this.defaultScope="federated",this.routeSub=this.route.params.subscribe(()=>this.update());}ngOnDestroy(){this.routeSub&&this.routeSub.unsubscribe();}getVideosObservable(e,t){let r=L(S({},t.toVideosAPIObject()),{videoPagination:S({},e),skipCount:!0});return this.hooks.wrapObsFun(this.videoService.listVideos.bind(this.videoService),r,"common","filter:api.browse-videos.videos.list.params","filter:api.browse-videos.videos.list.result");}getSyndicationItems(e){let t=e.toVideosAPIObject();return this.videoService.getVideoFeedUrls(t.sort,t.isLocal);}onFiltersChanged(e){this.buildTitle(e.scope,e.sort),this.updateGroupByDate(e.sort),this.meta.setTitle(this.title);}disableForReuse(){this.disabled=!0;}enabledForReuse(){this.disabled=!1,this.update();}update(){this.buildTitle(),this.updateGroupByDate(this.defaultSort),this.meta.setTitle(this.title);}updateGroupByDate(e){this.groupByDate=e==="-publishedAt"||e==="publishedAt";}buildTitle(e=this.defaultScope,t=this.defaultSort){let r=this.getSanitizedSort(t);if(e==="local"){this.title="Paikalliset videot";return;}if(r==="publishedAt"){this.title="Viimeksi lis\xE4tty";return;}if(["hot","trending","likes","views"].includes(r)){this.title="Trendaavat";return;}}getSanitizedSort(e){return e.replace(/^-/,"");}};m(i,"\u0275fac",function(t){return new(t||i)();}),m(i,"\u0275cmp",M({type:i,selectors:[["ng-component"]],decls:3,vars:6,consts:()=>{let e;return e="Selaa videoita",[e,[1,"visually-hidden"],["displayFilters","true","loadUserVideoPreferences","true","highlightLives","true",3,"filtersChanged","getVideosObservableFunction","getSyndicationItemsFunction","defaultSort","defaultScope","groupByDate","disabled"]];},template:function(t,r){t&1&&(c(0,"h1",1),g(1,0),a(),c(2,"my-videos-list",2),O("filtersChanged",function(C){return r.onFiltersChanged(C);}),a()),t&2&&(s(2),d("getVideosObservableFunction",r.getVideosObservableFunction)("getSyndicationItemsFunction",r.getSyndicationItemsFunction)("defaultSort",r.defaultSort)("defaultScope",r.defaultScope)("groupByDate",r.groupByDate)("disabled",r.disabled));},dependencies:[fe],encapsulation:2}));let o=i;return o;})();export{b as a,Ze as b,lt as c};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-37VQK6GQ.js.map