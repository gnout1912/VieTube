import{b as le}from"./chunk-EFI4VIXO.js";import{a as ce}from"./chunk-ID3GIFOG.js";import{B as re}from"./chunk-UFXFCZP3.js";import{b as G,c as oe}from"./chunk-25AA3I7H.js";import{b as se}from"./chunk-WZVFW7AN.js";import{a as ae}from"./chunk-6JJL547V.js";import{B as D,C as F,g as M,h as y,n as O,q as I,t as A}from"./chunk-WO4VNXA3.js";import{Bb as P,Cb as v,Db as ee,Dc as R,Eb as te,Ha as u,K as Z,Sa as h,Sg as H,Tg as ie,Wa as q,Xf as U,Ya as f,Yd as E,aa as _,eb as l,jb as J,la as Q,lg as $,nb as i,ob as o,pb as d,qb as T,rb as b,ta as S,vb as K,wb as Y,wf as ne,xb as p,xg as L}from"./chunk-F7FAPFPY.js";import{a as w,i as m}from"./chunk-AI7IVZV2.js";function ue(s,a){if(s&1&&d(0,"input",6),s&2){let g=v();l("disabled",!g.form.valid);}}var Pe=(()=>{let a=class a extends oe{formReactiveService=_(G);authService=_($);notifier=_(U);userService=_(H);themeService=_(ie);serverService=_(L);user=S(void 0);reactiveUpdate=S(!1);notifyOnUpdate=S(!0);userInformationLoaded=S(void 0);availableThemes;formValuesWatcher;serverConfig;get instanceName(){return this.serverConfig.instance.name;}ngOnInit(){this.serverConfig=this.serverService.getHTMLConfig(),this.availableThemes=[{id:"instance-default",label:""+this.instanceName+" tema",description:this.getDefaultInstanceThemeLabel()},this.themeService.getDefaultThemeItem(),...this.themeService.buildAvailableThemes()],this.buildForm({theme:null}),this.userInformationLoaded().subscribe(()=>{this.form.patchValue({theme:this.user().theme}),this.reactiveUpdate()&&(this.formValuesWatcher=this.form.valueChanges.subscribe(()=>this.updateInterfaceSettings()));});}ngOnDestroy(){this.formValuesWatcher?.unsubscribe();}updateInterfaceSettings(){let t={theme:this.form.value.theme};if(this.authService.isLoggedIn()){this.userService.updateMyProfile(t).subscribe({next:()=>{this.authService.refreshUserInformation(),this.notifyOnUpdate()&&this.notifier.success("Configuraci\xF3 de la interf\xEDcie actualitzada.");},error:n=>this.notifier.error(n.message)});return;}this.userService.updateMyAnonymousProfile(t),this.notifyOnUpdate()&&this.notifier.success("Configuraci\xF3 de la interf\xEDcie actualitzada.");}getDefaultInstanceThemeLabel(){let e=this.serverConfig.theme.default;return e==="default"?this.themeService.getDefaultThemeItem().label:e;}};m(a,"\u0275fac",(()=>{let e;return function(n){return(e||(e=Q(a)))(n||a);};})()),m(a,"\u0275cmp",h({type:a,selectors:[["my-user-interface-settings"]],inputs:{user:[1,"user"],reactiveUpdate:[1,"reactiveUpdate"],notifyOnUpdate:[1,"notifyOnUpdate"],userInformationLoaded:[1,"userInformationLoaded"]},features:[q],decls:6,vars:3,consts:()=>{let e;e="Desar la configuraci\xF3 de la interf\xEDcie";let t;return t="Tema",[t,[3,"ngSubmit","formGroup"],[1,"form-group"],["for","theme"],["inputId","theme","formControlName","theme",3,"items"],["type","submit","class","peertube-button primary-button","value",e,3,"disabled",4,"ngIf"],["type","submit","value",e,1,"peertube-button","primary-button",3,"disabled"]];},template:function(t,n){t&1&&(i(0,"form",1),P("ngSubmit",function(){return n.updateInterfaceSettings();}),i(1,"div",2)(2,"label",3),p(3,0),o(),d(4,"my-select-options",4),o(),f(5,ue,1,1,"input",5),o()),t&2&&(l("formGroup",n.form),u(4),l("items",n.availableThemes),u(),l("ngIf",!n.reactiveUpdate()));},dependencies:[D,O,M,y,F,I,A,R,re],styles:[`.peertube-select-container[_ngcontent-%COMP%]{padding:0;margin:0;position:relative;height:min-content;width:340px}@media screen and (max-width: 310px){.peertube-select-container[_ngcontent-%COMP%]{width:100%}}.peertube-select-container[_ngcontent-%COMP%]:after{top:50%;right:calc(0% + 15px);content:" ";height:0;width:0;position:absolute;pointer-events:none;border:5px solid rgba(0,0,0,0);border-top-color:var(--fg-300);margin-top:-2px;z-index:100}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{line-height:24px}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:inherit;background-color:transparent;border:1px solid var(--bg-secondary-500)!important}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:active, .peertube-select-container[_ngcontent-%COMP%]   select.active[_ngcontent-%COMP%], .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{color:inherit;background-color:var(--bg-secondary-500);border-color:var(--bg-secondary-500)}.peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:active, .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:focus-visible, .peertube-select-container[_ngcontent-%COMP%]   select.btn.show[_ngcontent-%COMP%]{color:inherit!important;background-color:var(--bg-secondary-500)!important;border-color:var(--bg-secondary-500)!important}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover{color:inherit;background-color:var(--bg-secondary-450)}.peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{pointer-events:none;opacity:.8}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:not(.icon-only)   my-global-icon[_ngcontent-%COMP%]{color:var(--secondary-icon-color)}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) calc(var(--input-x-padding) + 23px) var(--input-y-padding) var(--input-x-padding);position:relative;border:1px solid var(--input-border-color)!important;-webkit-appearance:none;appearance:none;text-overflow:ellipsis;color:var(--input-fg);background:var(--input-bg);border-radius:var(--input-border-radius)}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100)}.peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{opacity:.5}
/*# sourceMappingURL=user-interface-settings.component-EQFLSZ4E.css.map */`]}));let s=a;return s;})();var Se=[[["inner-title"]]],pe=["inner-title"];function ge(s,a){if(s&1&&(i(0,"div",21),p(1,5),o(),i(2,"div",22),p(3,6),o(),i(4,"div",23),d(5,"my-select-radio",24),o(),i(6,"div",23),d(7,"my-select-radio",25),o()),s&2){let g=v();u(5),l("items",g.nsfwFlagItems),u(2),l("items",g.nsfwFlagItems);}}function me(s,a){if(s&1&&d(0,"input",26),s&2){let g=v();l("disabled",!g.form.valid);}}var Ve=(()=>{let a=class a{formReactiveService=_(G);authService=_($);notifier=_(U);userService=_(H);serverService=_(L);user=S(null);reactiveUpdate=S(!1);notifyOnUpdate=S(!0);userInformationLoaded=S(void 0);form;formErrors={};validationMessages={};nsfwItems=[{id:"do_not_list",label:"Amagar"},{id:"blur",label:"Difuminar"},{id:"warn",label:"Avisar"},{id:"display",label:"Mostrar"}];nsfwFlagItems=[{id:"default",label:"Per defecte"},{id:"do_not_list",label:"Amagar"},{id:"blur",label:"Difuminar"},{id:"warn",label:"Avisar"},{id:"display",label:"Mostrar"}];formValuesWatcher;ngOnInit(){this.buildForm(),this.updateNSFWDefaultLabel(this.user().nsfwPolicy),this.form.controls.nsfwPolicy.valueChanges.subscribe(e=>this.updateNSFWDefaultLabel(e)),this.userInformationLoaded().pipe(Z()).subscribe(()=>{let t=this.serverService.getHTMLConfig().instance.defaultNSFWPolicy;this.form.patchValue({nsfwPolicy:this.user().nsfwPolicy||t,nsfwFlagViolent:this.buildNSFWFormFlag(E.VIOLENT),nsfwFlagSex:this.buildNSFWFormFlag(E.EXPLICIT_SEX),p2pEnabled:this.user().p2pEnabled,autoPlayVideo:this.user().autoPlayVideo===!0,autoPlayNextVideo:this.user().autoPlayNextVideo,videoLanguages:this.user().videoLanguages}),this.reactiveUpdate()&&this.handleReactiveUpdate();});}ngOnDestroy(){this.formValuesWatcher?.unsubscribe();}buildForm(){let e={nsfwPolicy:null,nsfwFlagViolent:null,nsfwFlagSex:null,p2pEnabled:null,autoPlayVideo:null,autoPlayNextVideo:null,videoLanguages:null},{form:t,formErrors:n,validationMessages:r}=this.formReactiveService.buildForm(e);this.form=t,this.formErrors=n,this.validationMessages=r;}updateDetails(e){let t=this.form.value.videoLanguages;if(Array.isArray(t)&&t.length>20){this.notifier.error("S'han activat massa idiomes. Si us plau, activeu-los tots o manteniu-los per sota de 20 idiomes activats.");return;}let n=this.form.value,r={nsfwPolicy:n.nsfwPolicy,p2pEnabled:n.p2pEnabled,autoPlayVideo:n.autoPlayVideo,autoPlayNextVideo:n.autoPlayNextVideo,nsfwFlagsDisplayed:this.buildNSFWUpdateFlag("display"),nsfwFlagsHidden:this.buildNSFWUpdateFlag("do_not_list"),nsfwFlagsWarned:this.buildNSFWUpdateFlag("warn"),nsfwFlagsBlurred:this.buildNSFWUpdateFlag("blur"),videoLanguages:t};if(e){let N=e.includes("nsfwFlagViolent")||e.includes("nsfwFlagSex")?[...e,"nsfwFlagsDisplayed","nsfwFlagsHidden","nsfwFlagsWarned","nsfwFlagsBlurred"]:e;r=ne(r,N);}return this.authService.isLoggedIn()?this.updateLoggedProfile(r):this.updateAnonymousProfile(r);}isNsfwFlagsEnabled(){return this.serverService.getHTMLConfig().nsfwFlagsSettings.enabled;}handleReactiveUpdate(){let e=w({},this.form.value);this.formValuesWatcher=this.form.valueChanges.subscribe(t=>{let n=Object.keys(t).find(r=>t[r]!==e[r]);e=w({},this.form.value),this.updateDetails([n]);});}updateLoggedProfile(e){this.userService.updateMyProfile(e).subscribe({next:()=>{this.authService.refreshUserInformation(),this.notifyOnUpdate()&&this.notifier.success("Configuraci\xF3 de v\xEDdeo actualitzada.");},error:t=>this.notifier.error(t.message)});}updateAnonymousProfile(e){this.userService.updateMyAnonymousProfile(e),this.notifyOnUpdate()&&this.notifier.success("Configuraci\xF3 de pantalla/v\xEDdeo actualitzada.");}buildNSFWFormFlag(e){let t=this.user();return(t.nsfwFlagsDisplayed&e)===e?"display":(t.nsfwFlagsWarned&e)===e?"warn":(t.nsfwFlagsBlurred&e)===e?"blur":(t.nsfwFlagsHidden&e)===e?"do_not_list":"default";}buildNSFWUpdateFlag(e){let t=E.NONE;return this.form.value.nsfwFlagViolent===e&&(t|=E.VIOLENT),this.form.value.nsfwFlagSex===e&&(t|=E.EXPLICIT_SEX),t;}updateNSFWDefaultLabel(e){let t=this.nsfwFlagItems.find(r=>r.id==="default"),n=this.nsfwItems.find(r=>r.id===e).label;t.label="Predeterminada ("+n+")";}};m(a,"\u0275fac",function(t){return new(t||a)();}),m(a,"\u0275cmp",h({type:a,selectors:[["my-user-video-settings"]],inputs:{user:[1,"user"],reactiveUpdate:[1,"reactiveUpdate"],notifyOnUpdate:[1,"notifyOnUpdate"],userInformationLoaded:[1,"userInformationLoaded"]},ngContentSelectors:pe,decls:34,vars:6,consts:()=>{let e;e="Pol\xEDtica sobre v\xEDdeos amb contingut sensible";let t;t="Ajuda a compartir els v\xEDdeos que s'estan reproduint";let n;n="Reproduir v\xEDdeos autom\xE0ticament";let r;r="Reproduir el seg\xFCent v\xEDdeo autom\xE0ticament";let C;C="Desa la configuraci\xF3 de v\xEDdeo";let N;N="Mostra nom\xE9s v\xEDdeos en els idiomes/subt\xEDtols seg\xFCents";let x;x="A les p\xE0gines Afegits recentment, Tend\xE8ncies, Locals, M\xE9s populars i Cerca";let V;V="El "+"\uFFFD#22\uFFFD"+"sistema de compartici\xF3"+"\uFFFD/#22\uFFFD"+" implica que la informaci\xF3 t\xE8cnica del vostre sistema (com la vostra adre\xE7a IP p\xFAblica) es pot enviar a d'altres nodes, per\xF2 ajuda molt a reduir la c\xE0rrega del servidor.";let z;z="En una p\xE0gina de v\xEDdeo, comen\xE7ar a reproduir immediatament.";let X;X="Quan s'acabi un v\xEDdeo reprodu\xEFu-ne el seg\xFCent suggerit.";let W;W="Contingut violent";let k;k="Material sexualment expl\xEDcit";let j;j="Anul\xB7lar la pol\xEDtica de contingut sensible per a determinats v\xEDdeos";let B;return B="Aquests criteris subjectius es poden aplicar opcionalment a determinats v\xEDdeos. La classificaci\xF3 d'alguns v\xEDdeos pot diferir del vostre criteri personal.",[N,x,V,z,X,j,B,[3,"ngSubmit","formGroup"],[1,"form-group"],["id","video-sensitive-content-policy",1,"anchor"],["inputId","nsfwPolicy","isGroup","true","label",e,"formControlName","nsfwPolicy",3,"items"],["id","video-languages-subtitles",1,"anchor"],[1,"pt-label-container"],["for","videoLanguages"],["inputId","videoLanguages","formControlName","videoLanguages",3,"maxLanguages"],["inputName","p2pEnabled","formControlName","p2pEnabled","labelText",t,3,"recommended"],["ngProjectAs","description",5,["description"]],["href","https://docs.joinpeertube.org/admin/privacy-guide#peertube-p2p-privacy","target","_blank",1,"link-primary"],["inputName","autoPlayVideo","formControlName","autoPlayVideo","labelText",n],["inputName","autoPlayNextVideo","formControlName","autoPlayNextVideo","labelText",r],["type","submit","value",C,"class","peertube-button primary-button mt-3",3,"disabled",4,"ngIf"],[1,"label"],[1,"form-group-description"],[1,"form-group","mb-3"],["inputId","nsfwFlagViolent","isGroup","true","labelSecondary","true","label",W,"formControlName","nsfwFlagViolent",3,"items"],["inputId","nsfwFlagSex","isGroup","true","labelSecondary","true","label",k,"formControlName","nsfwFlagSex",3,"items"],["type","submit","value",C,1,"peertube-button","primary-button","mt-3",3,"disabled"]];},template:function(t,n){t&1&&(ee(Se),i(0,"form",7),P("ngSubmit",function(){return n.updateDetails();}),i(1,"div",8),d(2,"div",9),i(3,"div",8),d(4,"my-select-radio",10),o(),f(5,ge,8,2),o(),i(6,"div",8),d(7,"div",11),i(8,"div",12)(9,"label",13),p(10,0),o(),i(11,"my-help"),T(12),p(13,1),b(),o()(),i(14,"div"),d(15,"my-select-languages",14),o()(),te(16),i(17,"div",8)(18,"my-peertube-checkbox",15),T(19,16),i(20,"span"),K(21,2),d(22,"a",17),Y(),o(),b(),o()(),i(23,"div",8)(24,"my-peertube-checkbox",18),T(25,16),i(26,"span"),p(27,3),o(),b(),o()(),i(28,"div",8)(29,"my-peertube-checkbox",19),T(30,16),i(31,"span"),p(32,4),o(),b(),o()(),f(33,me,1,1,"input",20),o()),t&2&&(l("formGroup",n.form),u(4),l("items",n.nsfwItems),u(),J(n.isNsfwFlagsEnabled()?5:-1),u(10),l("maxLanguages",20),u(3),l("recommended",!0),u(15),l("ngIf",!n.reactiveUpdate()));},dependencies:[D,O,M,y,F,I,A,ae,le,se,R,ce],styles:[`.peertube-select-container[_ngcontent-%COMP%]{padding:0;margin:0;position:relative;height:min-content;width:340px}@media screen and (max-width: 310px){.peertube-select-container[_ngcontent-%COMP%]{width:100%}}.peertube-select-container[_ngcontent-%COMP%]:after{top:50%;right:calc(0% + 15px);content:" ";height:0;width:0;position:absolute;pointer-events:none;border:5px solid rgba(0,0,0,0);border-top-color:var(--fg-300);margin-top:-2px;z-index:100}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{line-height:24px}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:inherit;background-color:transparent;border:1px solid var(--bg-secondary-500)!important}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:active, .peertube-select-container[_ngcontent-%COMP%]   select.active[_ngcontent-%COMP%], .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{color:inherit;background-color:var(--bg-secondary-500);border-color:var(--bg-secondary-500)}.peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:active, .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:focus-visible, .peertube-select-container[_ngcontent-%COMP%]   select.btn.show[_ngcontent-%COMP%]{color:inherit!important;background-color:var(--bg-secondary-500)!important;border-color:var(--bg-secondary-500)!important}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover{color:inherit;background-color:var(--bg-secondary-450)}.peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{pointer-events:none;opacity:.8}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:not(.icon-only)   my-global-icon[_ngcontent-%COMP%]{color:var(--secondary-icon-color)}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) calc(var(--input-x-padding) + 23px) var(--input-y-padding) var(--input-x-padding);position:relative;border:1px solid var(--input-border-color)!important;-webkit-appearance:none;appearance:none;text-overflow:ellipsis;color:var(--input-fg);background:var(--input-bg);border-radius:var(--input-border-radius)}.peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100)}.peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{opacity:.5}my-select-languages[_ngcontent-%COMP%]{display:block;width:340px;max-width:100%}
/*# sourceMappingURL=user-video-settings.component-4U57E7ZA.css.map */`]}));let s=a;return s;})();export{Pe as a,Ve as b};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-HO54TQU6.js.map