import{a as pt,b as ye,c as ut,d as T,e as Le,f as Z,g as mt,h as ee}from"./chunk-GL5D7JZI.js";import{a as dt}from"./chunk-XX2DH643.js";import{a as _t}from"./chunk-NHSB3FQP.js";import{a as J}from"./chunk-TBYV5OLF.js";import{a as Ee}from"./chunk-E244FAMK.js";import"./chunk-54JNDI5J.js";import"./chunk-AYTBY3KG.js";import"./chunk-MLUQ7CKS.js";import{a as lt}from"./chunk-5OMW7VPY.js";import"./chunk-CWRM6WWY.js";import"./chunk-ZO2H6O7A.js";import"./chunk-4MNDFPOM.js";import"./chunk-GUE2RQOD.js";import"./chunk-FJ2ZROHN.js";import"./chunk-EBEN7JLX.js";import"./chunk-HRQFMPLQ.js";import{a as ct}from"./chunk-GUGTEC7W.js";import"./chunk-GAPJZSX5.js";import"./chunk-7EJTRMSK.js";import"./chunk-VM462Q6H.js";import"./chunk-75CL7ZAD.js";import"./chunk-TOPWIQ4B.js";import"./chunk-5GTHDKWY.js";import{a as gt}from"./chunk-RXNERS4P.js";import{a as be}from"./chunk-UPLS62YG.js";import"./chunk-DEVNJA25.js";import{a as st}from"./chunk-SDLUASD2.js";import"./chunk-IESFBSCZ.js";import"./chunk-ID3GIFOG.js";import"./chunk-UFXFCZP3.js";import"./chunk-V73D6FBB.js";import{c as pe}from"./chunk-BFVCLNOF.js";import"./chunk-3PB3Q4OH.js";import"./chunk-24ZAFI2J.js";import{a as ce}from"./chunk-JVRBW57G.js";import"./chunk-ANGOORPW.js";import"./chunk-25AA3I7H.js";import{c as at}from"./chunk-2O3IZ566.js";import"./chunk-YDZGE3V5.js";import{a as he}from"./chunk-UI5MIAKJ.js";import"./chunk-C5UL7A6S.js";import"./chunk-WZVFW7AN.js";import{a as de}from"./chunk-6JJL547V.js";import{A as Ze,B as et,E as Se,u as Ye,w as je,x as Ke,y as Je}from"./chunk-RT7DTAS6.js";import{B as q,C as Y,c as le,g as Q,m as W,p as We}from"./chunk-WO4VNXA3.js";import{a as K}from"./chunk-PE7TFI7A.js";import{$f as me,Bb as P,Bc as ze,Bf as nt,Bg as ot,Cb as l,Cg as it,Dc as ae,Fa as He,Fd as ue,Ha as d,Ic as Xe,Mb as G,Na as F,Nb as ie,Ob as re,Pb as w,Q as oe,Qb as te,Qg as $,Rb as Oe,Rd as qe,Sa as k,Sg as rt,Ub as y,Vb as L,Wb as V,Xb as Fe,Xf as j,Y as $e,Ya as f,Zb as Ge,aa as _,eb as m,ha as g,ia as u,jb as h,jc as Ve,kd as B,lg as Ie,md as Qe,n as ne,nb as a,ob as s,od as se,pb as O,pd as ve,qb as x,r as fe,rb as U,sa as N,ta as E,tb as v,vb as z,vg as _e,wb as X,xb as C,xf as tt,xg as D,yb as Pe,zb as Me}from"./chunk-F7FAPFPY.js";import{g as ge,i as S,j as H}from"./chunk-AI7IVZV2.js";var Ct=ge(me());var yt=["torrentfileInput"];function Lt(i,r){if(i&1){let n=v();a(0,"div",8),P("fileDropped",function(e){g(n);let o=l();return u(o.setTorrentFile(e));}),a(1,"div",9),O(2,"my-global-icon",10),a(3,"div",11)(4,"span"),C(5,1),s(),a(6,"input",12,0),P("change",function(){g(n);let e=l();return u(e.fileChange());}),s()(),O(8,"div",13),a(9,"div",14)(10,"label",15),C(11,2),s(),a(12,"my-help"),x(13),C(14,3),U(),s(),a(15,"input",16),V("ngModelChange",function(e){g(n);let o=l();return L(o.firstStepMagnetUri,e)||(o.firstStepMagnetUri=e),u(e);}),s()(),a(16,"div",17)(17,"label",18),C(18,4),s(),a(19,"my-select-channel",19),V("ngModelChange",function(e){g(n);let o=l();return L(o.firstStepChannelId,e)||(o.firstStepChannelId=e),u(e);}),s()(),a(20,"input",20),P("click",function(){g(n);let e=l();return u(e.importVideo());}),s()()();}if(i&2){let n=l();d(3),m("ngbTooltip","(extensions: .torrent)"),d(12),y("ngModel",n.firstStepMagnetUri),d(4),m("items",n.userChannels()),y("ngModel",n.firstStepChannelId),d(),m("disabled",!n.isMagnetUrlValid()||n.isImportingVideo);}}function Vt(i,r){if(i&1){let n=v();a(0,"my-video-manage-container",21),P("videoUpdated",function(){g(n);let e=l();return u(e.onVideoUpdated());}),a(1,"my-alert",22),C(2,5),s()();}}var Tt=(0,Ct.default)("peertube:video-publish"),ft=(()=>{let r=class r{loadingBar=_(he);notifier=_(j);videoService=_(pe);videoImportService=_(be);hooks=_($);serverService=_(D);manageController=_(T);route=_(B);userChannels=E.required();userQuota=E.required();highestPrivacy=E.required();firstStepDone=N();firstStepError=N();torrentfileInput=F("torrentfileInput");firstStep=!0;firstStepChannelId;firstStepMagnetUri="";isImportingVideo=!1;ngOnInit(){this.firstStepChannelId=this.userChannels()[0].id;}ngAfterViewInit(){this.hooks.runAction("action:video-torrent-import.init","video-edit");}canDeactivate(){if(this.firstStep)return{canDeactivate:!0};let t="";return this.manageController.hasPendingChanges()&&(t="El vostre v\xEDdeo s'est\xE0 important. Per\xF2 hi ha canvis no desats: esteu segurs que voleu sortir d'aquesta p\xE0gina?"),{canDeactivate:!t,text:t};}onVideoUpdated(){this.notifier.success("S'han desat els canvis.");}reset(){this.firstStep=!0,this.isImportingVideo=!1,this.firstStepMagnetUri="";}isMagnetUrlValid(){return!!this.firstStepMagnetUri;}fileChange(){let t=this.torrentfileInput().nativeElement.files[0];t&&this.importVideo(t);}setTorrentFile(t){this.torrentfileInput().nativeElement.files=t,this.fileChange();}importVideo(t){if(this.isImportingVideo)return;this.isImportingVideo=!0;let e=this.serverService.getHTMLConfig(),o=Z.createFromImport(e,{torrentfile:t,magnetUri:this.firstStepMagnetUri,channelId:this.firstStepChannelId,support:this.userChannels().find(c=>c.id===this.firstStepChannelId).support??""});this.manageController.setConfig({manageType:"import-torrent",serverConfig:this.serverService.getHTMLConfig()}),this.manageController.setVideoEdit(o),this.loadingBar.useRef().start(),this.videoImportService.importVideo(o.toVideoImportCreate(this.highestPrivacy())).pipe(oe(({video:c})=>this.videoService.getVideo({videoId:c.uuid}))).subscribe({next:c=>H(this,null,function*(){yield o.loadFromAPI({video:c}),this.loadingBar.useRef().complete(),Tt("Torrent/magnet import created"),this.manageController.silentRedirectOnManage(o.getVideoAttributes().shortUUID,this.route),this.firstStep=!1,this.isImportingVideo=!1,this.firstStepDone.emit(o.getVideoAttributes().name);}),error:c=>{this.loadingBar.useRef().complete(),this.firstStepError.emit();let p=c.message;c.body?.code===ue.INCORRECT_FILES_IN_TORRENT&&(p="Nom\xE9s s'admeten torrents d'un sol fitxer."),this.notifier.error(p),this.isImportingVideo=!1;}});}};S(r,"\u0275fac",function(e){return new(e||r)();}),S(r,"\u0275cmp",k({type:r,selectors:[["my-video-import-torrent"]],viewQuery:function(e,o){e&1&&G(o.torrentfileInput,yt,5),e&2&&ie();},inputs:{userChannels:[1,"userChannels"],userQuota:[1,"userQuota"],highestPrivacy:[1,"highestPrivacy"]},outputs:{firstStepDone:"firstStepDone",firstStepError:"firstStepError"},decls:2,vars:1,consts:()=>{let t;t="Triar el torrent per importar";let e;e="O";let o;o="Importar";let c;c="Triar el torrent per importar";let p;p="Apegar l'URI magnet";let M;M="Podeu importar qualsevol fitxer torrent que apunti a un fitxer multim\xE8dia. Assegureu-vos que teniu els drets de difusi\xF3 dels continguts a qu\xE8 apunteu, altrament podr\xEDeu tindre problemes legals i causar-los a la inst\xE0ncia.";let b;b="Canal";let A;return A="Enhorabona, el v\xEDdeo s'importar\xE0 amb BitTorrent! Ja podeu afegir informaci\xF3 sobre aquest v\xEDdeo.",[["torrentfileInput",""],c,p,M,b,A,["myDragDrop","",1,"upload-video-container"],["canUpdate","true","canWatch","false","cancelLink","/my-library/videos"],["myDragDrop","",1,"upload-video-container",3,"fileDropped"],[1,"first-step-block"],["iconName","upload","aria-hidden","true",1,"upload-icon"],[1,"button-file","primary-button","form-control",3,"ngbTooltip"],["aria-label",t,"type","file","name","torrentfile","id","torrentfile","accept",".torrent",3,"change"],["data-content",e,1,"torrent-or-magnet"],[1,"form-group","form-group-magnet-uri"],["for","magnetUri"],["type","text","id","magnetUri",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group"],["for","first-step-channel"],["inputId","first-step-channel",3,"ngModelChange","items","ngModel"],["type","button","value",o,1,"peertube-button","primary-button",3,"click","disabled"],["canUpdate","true","canWatch","false","cancelLink","/my-library/videos",3,"videoUpdated"],["type","primary"]];},template:function(e,o){e&1&&f(0,Lt,21,5,"div",6)(1,Vt,3,0,"my-video-manage-container",7),e&2&&h(o.firstStep?0:1);},dependencies:[K,Se,de,q,le,Q,W,Le,J,Y,ce,ee],styles:[`.alert.alert-danger[_ngcontent-%COMP%]{text-align:center}.alert.alert-danger[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-weight:600}.first-step-block[_ngcontent-%COMP%]{--input-bg: var(--bg-secondary-500);display:flex;flex-direction:column;align-items:center}.first-step-block[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{width:90px;margin-bottom:25px;color:var(--fg-300)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]{padding:0;margin:0;position:relative;height:min-content;width:275px}@media screen and (max-width: 245px){.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]:after{top:50%;right:calc(0% + 15px);content:" ";height:0;width:0;position:absolute;pointer-events:none;border:5px solid rgba(0,0,0,0);border-top-color:var(--fg-300);margin-top:-2px;z-index:100}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{line-height:24px}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:inherit;background-color:transparent;border:1px solid var(--bg-secondary-500)!important}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:active, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.active[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{color:inherit;background-color:var(--bg-secondary-500);border-color:var(--bg-secondary-500)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:active, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:focus-visible, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn.show[_ngcontent-%COMP%]{color:inherit!important;background-color:var(--bg-secondary-500)!important;border-color:var(--bg-secondary-500)!important}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover{color:inherit;background-color:var(--bg-secondary-450)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{pointer-events:none;opacity:.8}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:not(.icon-only)   my-global-icon[_ngcontent-%COMP%]{color:var(--secondary-icon-color)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) calc(var(--input-x-padding) + 23px) var(--input-y-padding) var(--input-x-padding);position:relative;border:1px solid var(--input-border-color)!important;-webkit-appearance:none;appearance:none;text-overflow:ellipsis;color:var(--input-fg);background:var(--input-bg);border-radius:var(--input-border-radius)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{opacity:.5}.first-step-block[_ngcontent-%COMP%]   my-select-channel[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   my-select-options[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-radio-container[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{display:block;width:275px}@media screen and (max-width: 275px){.first-step-block[_ngcontent-%COMP%]   my-select-channel[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   my-select-options[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-radio-container[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{white-space:nowrap}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{display:block;font-size:16px;padding:var(--input-y-padding) var(--input-x-padding);width:275px;max-width:275px;color:var(--input-fg);background-color:var(--input-bg);border:1px solid var(--input-border-color);border-radius:var(--input-border-radius);line-height:24px}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder);font-size:14px}.first-step-block[_ngcontent-%COMP%]   input[type=text][readonly][_ngcontent-%COMP%]{color:var(--fg-300)}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100);outline:0}.first-step-block[_ngcontent-%COMP%]   input[type=text][disabled][_ngcontent-%COMP%]{color:var(--fg-300);opacity:.8}@media screen and (max-width: 315px){.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .button-file[_ngcontent-%COMP%]{width:max-content}
/*# sourceMappingURL=common-publish-4SUPW5GK.css.map */`,`.first-step-block[_ngcontent-%COMP%]   .torrent-or-magnet[_ngcontent-%COMP%]{width:95%;border-top:.05rem solid var(--secondary-icon-color);height:.05rem;text-align:center;display:block;position:relative}.first-step-block[_ngcontent-%COMP%]   .torrent-or-magnet[data-content][_ngcontent-%COMP%]{margin:.8rem 0}.first-step-block[_ngcontent-%COMP%]   .torrent-or-magnet[data-content][_ngcontent-%COMP%]:after{background:var(--bg-secondary-400);color:var(--secondary-icon-color);content:attr(data-content);display:inline-block;font-size:.7rem;padding:0 .4rem;transform:translateY(-.65rem)}.first-step-block[_ngcontent-%COMP%]   .torrent-or-magnet[data-content][_ngcontent-%COMP%]{margin:1.5rem 0}.first-step-block[_ngcontent-%COMP%]   .form-group-magnet-uri[_ngcontent-%COMP%]{margin-bottom:40px}
/*# sourceMappingURL=video-import-torrent.component-QEW5M4S2.css.map */`]}));let i=r;return i;})();var Pt=ge(me());function At(i,r){i&1&&(a(0,"div",17),z(1,3),O(2,"a",18),X(),s());}function Nt(i,r){if(i&1){let n=v();a(0,"div",5)(1,"div",7),O(2,"my-global-icon",8),a(3,"div",9)(4,"label",10),C(5,0),s(),a(6,"my-help"),x(7),z(8,1),O(9,"a",11),X(),U(),s(),a(10,"input",12),V("ngModelChange",function(e){g(n);let o=l();return L(o.targetUrl,e)||(o.targetUrl=e),u(e);}),s(),f(11,At,3,0,"div",13),s(),a(12,"div",9)(13,"label",14),C(14,2),s(),a(15,"my-select-channel",15),V("ngModelChange",function(e){g(n);let o=l();return L(o.firstStepChannelId,e)||(o.firstStepChannelId=e),u(e);}),s()(),a(16,"input",16),P("click",function(){g(n);let e=l();return u(e.importVideo());}),s()()();}if(i&2){let n=l();d(10),y("ngModel",n.targetUrl),d(),m("ngIf",n.isChannelSyncEnabled()),d(4),m("items",n.userChannels()),y("ngModel",n.firstStepChannelId),d(),m("disabled",!n.isTargetUrlValid()||n.isImportingVideo);}}function Dt(i,r){if(i&1){let n=v();a(0,"my-video-manage-container",19),P("videoUpdated",function(){g(n);let e=l();return u(e.onVideoUpdated());}),a(1,"my-alert",20),C(2,4),s()();}if(i&2){let n=l();d(2),Pe(n.targetUrl),Me(2);}}var xt=(0,Pt.default)("peertube:video-publish"),Mt=(()=>{let r=class r{loadingBar=_(he);notifier=_(j);videoService=_(pe);videoImportService=_(be);hooks=_($);serverService=_(D);manageController=_(T);route=_(B);chapterService=_(gt);captionService=_(st);userChannels=E.required();userQuota=E.required();highestPrivacy=E.required();firstStepDone=N();firstStepError=N();targetUrl="";firstStep=!0;firstStepChannelId;isImportingVideo=!1;ngOnInit(){this.firstStepChannelId=this.userChannels()[0].id;}ngAfterViewInit(){this.hooks.runAction("action:video-url-import.init","video-edit");}canDeactivate(){if(this.firstStep)return{canDeactivate:!0};let t="";return this.manageController.hasPendingChanges()&&(t="El vostre v\xEDdeo s'est\xE0 important. Per\xF2 hi ha canvis no desats: esteu segurs que voleu sortir d'aquesta p\xE0gina?"),{canDeactivate:!t,text:t};}onVideoUpdated(){this.notifier.success("S'han desat els canvis.");}reset(){this.firstStep=!0,this.isImportingVideo=!1;}isTargetUrlValid(){return this.targetUrl?.match(/https?:\/\//);}isChannelSyncEnabled(){return this.serverService.getHTMLConfig().import.videoChannelSynchronization.enabled;}importVideo(){if(this.isImportingVideo)return;this.isImportingVideo=!0;let t=this.serverService.getHTMLConfig(),e=Z.createFromImport(t,{targetUrl:this.targetUrl,channelId:this.firstStepChannelId,support:this.userChannels().find(o=>o.id===this.firstStepChannelId).support??""});this.manageController.setConfig({manageType:"import-url",serverConfig:this.serverService.getHTMLConfig()}),this.manageController.setVideoEdit(e),this.loadingBar.useRef().start(),this.videoImportService.importVideo(e.toVideoImportCreate(this.highestPrivacy())).pipe(oe(o=>fe([this.captionService.listCaptions(o.video.uuid),this.chapterService.getChapters({videoId:o.video.uuid}),this.videoService.getVideo({videoId:o.video.uuid})]).pipe(ne(([{data:c},{chapters:p},M])=>({captions:c,chapters:p,video:M}))))).subscribe({next:M=>H(this,[M],function*({video:o,captions:c,chapters:p}){yield e.loadFromAPI({video:o,captions:c,chapters:p}),this.loadingBar.useRef().complete(),xt("URL import created"),this.manageController.silentRedirectOnManage(e.getVideoAttributes().shortUUID,this.route),this.firstStep=!1,this.isImportingVideo=!1,this.firstStepDone.emit(e.getVideoAttributes().name);}),error:o=>{this.loadingBar.useRef().complete(),this.isImportingVideo=!1,this.firstStepError.emit(),this.notifier.error(o.message);}});}};S(r,"\u0275fac",function(e){return new(e||r)();}),S(r,"\u0275cmp",k({type:r,selectors:[["my-video-import-url"]],inputs:{userChannels:[1,"userChannels"],userQuota:[1,"userQuota"],highestPrivacy:[1,"highestPrivacy"]},outputs:{firstStepDone:"firstStepDone",firstStepError:"firstStepError"},decls:2,vars:1,consts:()=>{let t;t="Importar";let e;e="URL";let o;o="Podeu importar qualsevol URL "+"\uFFFD#9\uFFFD"+"compatible amb youtube-dl"+"\uFFFD/#9\uFFFD"+" o que apunti a un fitxer multim\xE8dia. Heu d'assegurar-vos que teniu drets de distribuci\xF3 del contingut al qual apunta l'adre\xE7a, ja que, en cas contrari, us podria causar problemes legals a vosaltres i a la vostra inst\xE0ncia. ";let c;c="Canal";let p;p="Tamb\xE9 podeu sincronitzar un canal remot a "+"\uFFFD#2\uFFFD"+"la vostra biblioteca"+"\uFFFD/#2\uFFFD"+"";let M;return M="Enhorabona, s'est\xE0 important el v\xEDdeo darrere de "+"\uFFFD0\uFFFD"+"! Ja podeu afegir informaci\xF3 sobre aquest v\xEDdeo. ",[e,o,c,p,M,[1,"upload-video-container"],["canUpdate","true","canWatch","false","cancelLink","/my-library/videos"],[1,"first-step-block"],["iconName","upload","aria-hidden","true",1,"upload-icon"],[1,"form-group"],["for","targetUrl"],["href","https://rg3.github.io/youtube-dl/supportedsites.html","target","_blank","rel","noopener noreferrer"],["type","text","id","targetUrl",1,"form-control",3,"ngModelChange","ngModel"],["class","form-group-description",4,"ngIf"],["for","first-step-channel"],["inputId","first-step-channel",3,"ngModelChange","items","ngModel"],["type","button","value",t,1,"peertube-button","primary-button",3,"click","disabled"],[1,"form-group-description"],["routerLink","/my-library/video-channel-syncs",1,"text-decoration-underline"],["canUpdate","true","canWatch","false","cancelLink","/my-library/videos",3,"videoUpdated"],["type","primary"]];},template:function(e,o){e&1&&f(0,Nt,17,5,"div",5)(1,Dt,3,1,"my-video-manage-container",6),e&2&&h(o.firstStep?0:1);},dependencies:[ae,K,de,q,le,Q,W,ve,J,Y,ce,ee],styles:[`.alert.alert-danger[_ngcontent-%COMP%]{text-align:center}.alert.alert-danger[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-weight:600}.first-step-block[_ngcontent-%COMP%]{--input-bg: var(--bg-secondary-500);display:flex;flex-direction:column;align-items:center}.first-step-block[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{width:90px;margin-bottom:25px;color:var(--fg-300)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]{padding:0;margin:0;position:relative;height:min-content;width:275px}@media screen and (max-width: 245px){.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]:after{top:50%;right:calc(0% + 15px);content:" ";height:0;width:0;position:absolute;pointer-events:none;border:5px solid rgba(0,0,0,0);border-top-color:var(--fg-300);margin-top:-2px;z-index:100}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{line-height:24px}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:inherit;background-color:transparent;border:1px solid var(--bg-secondary-500)!important}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:active, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.active[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{color:inherit;background-color:var(--bg-secondary-500);border-color:var(--bg-secondary-500)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:active, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:focus-visible, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn.show[_ngcontent-%COMP%]{color:inherit!important;background-color:var(--bg-secondary-500)!important;border-color:var(--bg-secondary-500)!important}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover{color:inherit;background-color:var(--bg-secondary-450)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{pointer-events:none;opacity:.8}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:not(.icon-only)   my-global-icon[_ngcontent-%COMP%]{color:var(--secondary-icon-color)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) calc(var(--input-x-padding) + 23px) var(--input-y-padding) var(--input-x-padding);position:relative;border:1px solid var(--input-border-color)!important;-webkit-appearance:none;appearance:none;text-overflow:ellipsis;color:var(--input-fg);background:var(--input-bg);border-radius:var(--input-border-radius)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{opacity:.5}.first-step-block[_ngcontent-%COMP%]   my-select-channel[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   my-select-options[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-radio-container[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{display:block;width:275px}@media screen and (max-width: 275px){.first-step-block[_ngcontent-%COMP%]   my-select-channel[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   my-select-options[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-radio-container[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{white-space:nowrap}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{display:block;font-size:16px;padding:var(--input-y-padding) var(--input-x-padding);width:275px;max-width:275px;color:var(--input-fg);background-color:var(--input-bg);border:1px solid var(--input-border-color);border-radius:var(--input-border-radius);line-height:24px}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder);font-size:14px}.first-step-block[_ngcontent-%COMP%]   input[type=text][readonly][_ngcontent-%COMP%]{color:var(--fg-300)}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100);outline:0}.first-step-block[_ngcontent-%COMP%]   input[type=text][disabled][_ngcontent-%COMP%]{color:var(--fg-300);opacity:.8}@media screen and (max-width: 315px){.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .button-file[_ngcontent-%COMP%]{width:max-content}
/*# sourceMappingURL=common-publish-4SUPW5GK.css.map */`]}));let i=r;return i;})();var Ot=ge(me());function Ut(i,r){if(i&1){let n=v();a(0,"div",4)(1,"div",6),O(2,"my-global-icon",7),a(3,"div",8)(4,"label",9),C(5,0),s(),a(6,"my-select-channel",10),V("ngModelChange",function(e){g(n);let o=l();return L(o.firstStepChannelId,e)||(o.firstStepChannelId=e),u(e);}),s()(),a(7,"div",11)(8,"div",12)(9,"input",13),V("ngModelChange",function(e){g(n);let o=l();return L(o.firstStepPermanentLive,e)||(o.firstStepPermanentLive=e),u(e);}),s(),a(10,"label",14),C(11,1),s(),a(12,"span",15),w(13),s()(),a(14,"div",12)(15,"input",16),V("ngModelChange",function(e){g(n);let o=l();return L(o.firstStepPermanentLive,e)||(o.firstStepPermanentLive=e),u(e);}),s(),a(16,"label",17),C(17,2),s(),a(18,"span",15),C(19,3),s()()(),a(20,"input",18),P("click",function(){g(n);let e=l();return u(e.goLive());}),s()()();}if(i&2){let n=l();d(6),m("items",n.userChannels()),y("ngModel",n.firstStepChannelId),d(3),y("ngModel",n.firstStepPermanentLive),m("value",!1),d(4),te(n.getNormalLiveDescription()),d(2),y("ngModel",n.firstStepPermanentLive),m("value",!0),d(4),Pe(n.getPermanentLiveDescription()),Me(19),d(),m("disabled",n.firstStepPermanentLive!==!0&&n.firstStepPermanentLive!==!1);}}function Rt(i,r){if(i&1){let n=v();a(0,"my-video-manage-container",19),P("videoUpdated",function(){g(n);let e=l();return u(e.onVideoUpdated());}),s();}}var kt=(0,Ot.default)("peertube:video-publish"),vt=(()=>{let r=class r{notifier=_(j);serverService=_(D);liveVideoService=_(Ee);hooks=_($);manageController=_(T);route=_(B);userChannels=E.required();userQuota=E.required();highestPrivacy=E.required();firstStepDone=N();firstStepError=N();firstStep=!0;firstStepChannelId;firstStepPermanentLive;isGoingLive=!1;ngOnInit(){this.firstStepChannelId=this.userChannels()[0].id;}ngAfterViewInit(){this.hooks.runAction("action:go-live.init","video-edit");}canDeactivate(){if(this.firstStep)return{canDeactivate:!0};let t="";return this.manageController.hasPendingChanges()&&(t="El vostre directe us est\xE0 esperant a la biblioteca. Per\xF2 hi ha canvis no desats: confirmeu la sortida d'aquesta p\xE0gina?"),{canDeactivate:!t,text:t};}reset(){this.firstStep=!0,this.isGoingLive=!1;}goLive(){if(this.isGoingLive)return;this.isGoingLive=!0;let t=this.serverService.getHTMLConfig(),e=Z.createFromLive(t,{name:"Directe",channelId:this.firstStepChannelId,support:this.userChannels().find(o=>o.id===this.firstStepChannelId).support??"",permanentLive:this.firstStepPermanentLive,latencyMode:qe.DEFAULT,saveReplay:this.isReplayAllowed(),replaySettings:{privacy:this.highestPrivacy()}});this.manageController.setConfig({manageType:"go-live",serverConfig:this.serverService.getHTMLConfig()}),this.manageController.setVideoEdit(e),this.liveVideoService.goLive(e.toLiveCreate(this.highestPrivacy())).pipe(oe(({video:o})=>this.liveVideoService.getVideoLive(o.uuid).pipe(ne(c=>({live:c,video:o}))))).subscribe({next:b=>H(this,[b],function*({video:{id:o,uuid:c,shortUUID:p},live:M}){e.loadAfterPublish({video:{id:o,uuid:c,shortUUID:p}}),yield e.loadFromAPI({live:M}),kt("Live published"),this.manageController.silentRedirectOnManage(p,this.route),this.firstStep=!1,this.isGoingLive=!1,this.firstStepDone.emit(e.getVideoAttributes().name);}),error:o=>{this.firstStepError.emit();let c=o.message,p=o.body;p?.code===ue.MAX_INSTANCE_LIVES_LIMIT_REACHED?c="No es pot crear el directe perqu\xE8 aquesta plataforma en t\xE9 massa":p?.code===ue.MAX_USER_LIVES_LIMIT_REACHED&&(c="No es pot crear el directe perqu\xE8 ja en tens massa"),this.notifier.error(c),this.isGoingLive=!1;}});}onVideoUpdated(){this.notifier.success("S'han desat els canvis.");}getNormalLiveDescription(){return this.isReplayAllowed()?"Emeteu nom\xE9s una vegada, la retransmissi\xF3 substituir\xE0 el vostre directe":"Emeteu nom\xE9s una vegada";}getPermanentLiveDescription(){return this.isReplayAllowed()?"Emeteu diverses vegades, les repeticions seran v\xEDdeos separats":"Emeteu diverses vegades fent servir el mateix URL";}isReplayAllowed(){return this.serverService.getHTMLConfig().live.allowReplay;}};S(r,"\u0275fac",function(e){return new(e||r)();}),S(r,"\u0275cmp",k({type:r,selectors:[["my-video-go-live"]],inputs:{userChannels:[1,"userChannels"],userQuota:[1,"userQuota"],highestPrivacy:[1,"highestPrivacy"]},outputs:{firstStepDone:"firstStepDone",firstStepError:"firstStepError"},decls:2,vars:1,consts:()=>{let t;t="Emetre en directe";let e;e="Canal";let o;o="Directe normal";let c;c="Directe permanent/recurrent";let p;return p=""+"\uFFFD0\uFFFD"+"",[e,o,c,p,[1,"upload-video-container"],["canUpdate","true","canWatch","true","cancelLink","/my-library/videos"],[1,"first-step-block"],["iconName","upload","aria-hidden","true",1,"upload-icon"],[1,"form-group"],["for","first-step-channel"],["inputId","first-step-channel",3,"ngModelChange","items","ngModel"],[1,"form-group","live-type"],[1,"peertube-radio-container"],["type","radio","id","permanentLiveFalse",3,"ngModelChange","ngModel","value"],["for","permanentLiveFalse",1,"radio"],[1,"form-group-description"],["type","radio","id","permanentLiveTrue",3,"ngModelChange","ngModel","value"],["for","permanentLiveTrue",1,"radio"],["type","button","value",t,1,"peertube-button","primary-button",3,"click","disabled"],["canUpdate","true","canWatch","true","cancelLink","/my-library/videos",3,"videoUpdated"]];},template:function(e,o){e&1&&f(0,Ut,21,9,"div",4)(1,Rt,1,0,"my-video-manage-container",5),e&2&&h(o.firstStep?0:1);},dependencies:[K,J,q,le,We,Q,W,Y,ee],styles:[`.alert.alert-danger[_ngcontent-%COMP%]{text-align:center}.alert.alert-danger[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-weight:600}.first-step-block[_ngcontent-%COMP%]{--input-bg: var(--bg-secondary-500);display:flex;flex-direction:column;align-items:center}.first-step-block[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{width:90px;margin-bottom:25px;color:var(--fg-300)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]{padding:0;margin:0;position:relative;height:min-content;width:275px}@media screen and (max-width: 245px){.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]:after{top:50%;right:calc(0% + 15px);content:" ";height:0;width:0;position:absolute;pointer-events:none;border:5px solid rgba(0,0,0,0);border-top-color:var(--fg-300);margin-top:-2px;z-index:100}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{line-height:24px}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:inherit;background-color:transparent;border:1px solid var(--bg-secondary-500)!important}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:active, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.active[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{color:inherit;background-color:var(--bg-secondary-500);border-color:var(--bg-secondary-500)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:active, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:focus-visible, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn.show[_ngcontent-%COMP%]{color:inherit!important;background-color:var(--bg-secondary-500)!important;border-color:var(--bg-secondary-500)!important}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover{color:inherit;background-color:var(--bg-secondary-450)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{pointer-events:none;opacity:.8}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:not(.icon-only)   my-global-icon[_ngcontent-%COMP%]{color:var(--secondary-icon-color)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) calc(var(--input-x-padding) + 23px) var(--input-y-padding) var(--input-x-padding);position:relative;border:1px solid var(--input-border-color)!important;-webkit-appearance:none;appearance:none;text-overflow:ellipsis;color:var(--input-fg);background:var(--input-bg);border-radius:var(--input-border-radius)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{opacity:.5}.first-step-block[_ngcontent-%COMP%]   my-select-channel[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   my-select-options[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-radio-container[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{display:block;width:275px}@media screen and (max-width: 275px){.first-step-block[_ngcontent-%COMP%]   my-select-channel[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   my-select-options[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-radio-container[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{white-space:nowrap}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{display:block;font-size:16px;padding:var(--input-y-padding) var(--input-x-padding);width:275px;max-width:275px;color:var(--input-fg);background-color:var(--input-bg);border:1px solid var(--input-border-color);border-radius:var(--input-border-radius);line-height:24px}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder);font-size:14px}.first-step-block[_ngcontent-%COMP%]   input[type=text][readonly][_ngcontent-%COMP%]{color:var(--fg-300)}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100);outline:0}.first-step-block[_ngcontent-%COMP%]   input[type=text][disabled][_ngcontent-%COMP%]{color:var(--fg-300);opacity:.8}@media screen and (max-width: 315px){.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .button-file[_ngcontent-%COMP%]{width:max-content}
/*# sourceMappingURL=common-publish-4SUPW5GK.css.map */`,`.live-type[_ngcontent-%COMP%]{margin-top:15px}
/*# sourceMappingURL=video-go-live.component-WMDHYGSU.css.map */`]}));let i=r;return i;})();var ht=ge(me());var wt=["videoFileInput"];function Bt(i,r){if(i&1){let n=v();x(0),a(1,"div",16)(2,"label",17),C(3,3),s(),a(4,"div",18),z(5,4),O(6,"br"),X(),s(),a(7,"my-preview-upload",19),V("ngModelChange",function(e){g(n);let o=l(2);return L(o.audioPreviewFile,e)||(o.audioPreviewFile=e),u(e);}),s()(),a(8,"div",20)(9,"my-button",21),P("click",function(){g(n);let e=l(2);return u(e.uploadAudio());}),s()(),U();}if(i&2){let n=l(2);d(7),y("ngModel",n.audioPreviewFile),d(2),m("label",n.getAudioUploadLabel());}}function $t(i,r){if(i&1){let n=v();a(0,"div",7),P("fileDropped",function(e){g(n);let o=l();return u(o.onFileDropped(e));}),a(1,"div",8),O(2,"my-global-icon",9),a(3,"div",10)(4,"span"),C(5,1),s(),a(6,"input",11,0),P("change",function(e){g(n);let o=l();return u(o.onFileChange(e));}),s()(),a(8,"div",12)(9,"label",13),C(10,2),s(),a(11,"my-select-channel",14),V("ngModelChange",function(e){g(n);let o=l();return L(o.firstStepChannelId,e)||(o.firstStepChannelId=e),u(e);}),s()(),f(12,Bt,10,2,"ng-container",15),s()();}if(i&2){let n=l();d(3),m("ngbTooltip","(extensions: "+n.getVideoExtensions()+")"),d(3),m("accept",n.getVideoExtensions()),d(5),m("items",n.userChannels()),y("ngModel",n.firstStepChannelId),d(),m("ngIf",n.uploadingAudioFile);}}function Ht(i,r){if(i&1){let n=v();a(0,"my-video-manage-container",22),P("videoUpdated",function(){g(n);let e=l();return u(e.onVideoUpdated());}),s();}if(i&2){let n=l();m("canUpdate",n.hasUploadedFile())("canWatch",n.hasUploadedFile())("cancelLink",n.getCancelLink());}}var St=(0,ht.default)("peertube:video-publish"),It=(()=>{let r=class r{notifier=_(j);serverService=_(D);hooks=_($);metaService=_(it);route=_(B);videoUploadService=_(ye);manageController=_(T);router=_(se);canDeactivateGuard=_(_e);userChannels=E.required();userQuota=E.required();highestPrivacy=E.required();firstStepDone=N();firstStepError=N();videoFileInput=F("videoFileInput");uploadingAudioFile=!1;audioPreviewFile;firstStep=!0;firstStepChannelId;hasFirstUpdated=!1;videoEdit;uploadEventsSubscription;ngOnInit(){this.uploadEventsSubscription=this.manageController.getUploadEventsObs().subscribe(t=>{if(this.updateTitle(),t.status==="cancelled"){St("Upload cancelled",t),this.firstStepError.emit(),this.firstStep=!0,this.manageController.silentRedirectOnAbortUpload(this.route);return;}if(t.status==="complete"){let{id:e,uuid:o,shortUUID:c}=t.response.video;this.videoEdit.loadAfterPublish({video:{id:e,uuid:o,shortUUID:c}}),St("Upload complete",t),this.manageController.silentRedirectOnManage(c,this.route);return;}}),this.firstStepChannelId=this.userChannels()[0].id;}ngAfterViewInit(){this.hooks.runAction("action:video-upload.init","video-edit");}ngOnDestroy(){this.uploadEventsSubscription?.unsubscribe(),this.manageController.cancelUploadIfNeeded();}canDeactivate(){if(this.firstStep)return{canDeactivate:!0};let t="";return this.hasUploadedFile()!==!0?t="El v\xEDdeo encara no s'ha carregat, confirmeu que voleu sortir d'aquesta p\xE0gina?":this.manageController.hasPendingChanges()&&(t="El vostre v\xEDdeo s'ha penjat a la biblioteca. Per\xF2 hi ha canvis no desats: confirmeu que voleu sortir d'aquesta p\xE0gina?"),{canDeactivate:!t,text:t};}updateTitle(){this.hasUploadedFile()?this.metaService.setTitle("Publicar"):this.uploadingAudioFile||!this.firstStep?this.metaService.setTitle(`${this.manageController.getUploadPercents()}% - Publish`):this.metaService.update(this.route.snapshot.data.meta);}getVideoExtensions(){return this.videoUploadService.getVideoExtensions().join(", ");}onFileDropped(t){let e=this.videoFileInput();e.nativeElement.files=t,this.onFileChange({target:e.nativeElement});}onFileChange(t){this.resetUploadState();let e=t.target.files[0];if(e&&this.manageController.checkUserQuota(e)){if(this.videoUploadService.isAudioFile(e.name)){this.uploadingAudioFile=!0;return;}this.firstStep=!1,this.uploadFile(e);}}resetUploadState(){this.firstStep=!0,this.videoEdit=void 0,this.uploadingAudioFile=!1;}uploadAudio(){this.uploadFile(this.getInputVideoFile(),this.audioPreviewFile);}getAudioUploadLabel(){let t=this.getInputVideoFile();return t?"Pujar "+t.name+" ":"Pujar";}onVideoUpdated(){this.notifier.success("S'han desat els canvis.");}hasUploadedFile(){return this.videoEdit?!!this.videoEdit.getVideoAttributes().id:!1;}getCancelLink(){return this.hasUploadedFile()?"/my-library/videos":"/videos/publish";}reset(){this.resetUploadState(),this.manageController.cancelUploadIfNeeded(),this.updateTitle();}getInputVideoFile(){return this.videoFileInput().nativeElement.files[0];}uploadFile(t,e){let o=this.serverService.getHTMLConfig();this.videoEdit=Z.createFromUpload(o,{name:this.buildVideoFilename(t.name),channelId:this.firstStepChannelId,support:this.userChannels().find(c=>c.id===this.firstStepChannelId).support??""}),this.manageController.setConfig({manageType:"upload",serverConfig:this.serverService.getHTMLConfig()}),this.manageController.setVideoEdit(this.videoEdit),this.manageController.uploadNewVideo({privacy:this.highestPrivacy(),file:t,previewfile:e}),this.manageController.silentRedirectOnUploading(this.route),this.firstStep=!1,this.firstStepDone.emit(this.videoEdit.getVideoAttributes().name),this.updateTitle();}buildVideoFilename(t){let e=t.replace(/\.[^/.]+$/,""),o=e.length<3?t:e,c=110;return o.length>c&&(o=tt(o,{length:c,omission:""})),o;}};S(r,"\u0275fac",function(e){return new(e||r)();}),S(r,"\u0275cmp",k({type:r,selectors:[["my-video-upload"]],viewQuery:function(e,o){e&1&&G(o.videoFileInput,wt,5),e&2&&ie();},inputs:{userChannels:[1,"userChannels"],userQuota:[1,"userQuota"],highestPrivacy:[1,"highestPrivacy"]},outputs:{firstStepDone:"firstStepDone",firstStepError:"firstStepError"},decls:2,vars:1,consts:()=>{let t;t="Arxiu pujat! El vostre v\xEDdeo ja est\xE0 disponible a la vostra biblioteca privada.";let e;e="Trieu el fitxer a pujar";let o;o="Trieu el fitxer a pujar";let c;c="Canal";let p;p="Editar";let M;M="Imatge de fons del v\xEDdeo";let b;return b="Imatge que es fusionar\xE0 amb el vostre fitxer d\u2019\xE0udio. "+"\uFFFD#6\uFFFD\uFFFD/#6\uFFFD"+" La imatge escollida ser\xE0 definitiva i no es podr\xE0 modificar. ",[["videoFileInput",""],o,c,M,b,["myDragDrop","",1,"upload-video-container"],["uploadedLabel",t,3,"canUpdate","canWatch","cancelLink"],["myDragDrop","",1,"upload-video-container",3,"fileDropped"],[1,"first-step-block"],["iconName","upload","aria-hidden","true",1,"upload-icon"],[1,"button-file","primary-button","form-control",3,"ngbTooltip"],["aria-label",e,"id","videofile","type","file",3,"change","accept"],[1,"form-group","form-group-channel"],["for","first-step-channel"],["inputId","first-step-channel",3,"ngModelChange","items","ngModel"],[4,"ngIf"],[1,"form-group","audio-preview"],["for","previewfileUpload"],[1,"audio-image-info"],["inputLabel",p,"inputName","previewfileUpload","previewWidth","360px","previewHeight","200px",3,"ngModelChange","ngModel"],[1,"form-group","upload-audio-button"],["theme","primary","icon","upload",3,"click","label"],["uploadedLabel",t,3,"videoUpdated","canUpdate","canWatch","cancelLink"]];},template:function(e,o){e&1&&f(0,$t,13,5,"div",5)(1,Ht,1,3,"my-video-manage-container",6),e&2&&h(o.firstStep?0:1);},dependencies:[ae,Le,K,Se,J,q,Q,W,_t,at,Y,ee],styles:[`.alert.alert-danger[_ngcontent-%COMP%]{text-align:center}.alert.alert-danger[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-weight:600}.first-step-block[_ngcontent-%COMP%]{--input-bg: var(--bg-secondary-500);display:flex;flex-direction:column;align-items:center}.first-step-block[_ngcontent-%COMP%]   .upload-icon[_ngcontent-%COMP%]{width:90px;margin-bottom:25px;color:var(--fg-300)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]{padding:0;margin:0;position:relative;height:min-content;width:275px}@media screen and (max-width: 245px){.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]:after{top:50%;right:calc(0% + 15px);content:" ";height:0;width:0;position:absolute;pointer-events:none;border:5px solid rgba(0,0,0,0);border-top-color:var(--fg-300);margin-top:-2px;z-index:100}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{line-height:24px}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:inherit;background-color:transparent;border:1px solid var(--bg-secondary-500)!important}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:active, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.active[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{color:inherit;background-color:var(--bg-secondary-500);border-color:var(--bg-secondary-500)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:active, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn[_ngcontent-%COMP%]:focus-visible, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select.btn.show[_ngcontent-%COMP%]{color:inherit!important;background-color:var(--bg-secondary-500)!important;border-color:var(--bg-secondary-500)!important}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover{color:inherit;background-color:var(--bg-secondary-450)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{pointer-events:none;opacity:.8}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:not(.icon-only)   my-global-icon[_ngcontent-%COMP%]{color:var(--secondary-icon-color)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) calc(var(--input-x-padding) + 23px) var(--input-y-padding) var(--input-x-padding);position:relative;border:1px solid var(--input-border-color)!important;-webkit-appearance:none;appearance:none;text-overflow:ellipsis;color:var(--input-fg);background:var(--input-bg);border-radius:var(--input-border-radius)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100)}.first-step-block[_ngcontent-%COMP%]   .peertube-select-container[_ngcontent-%COMP%]   select[disabled][_ngcontent-%COMP%]{opacity:.5}.first-step-block[_ngcontent-%COMP%]   my-select-channel[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   my-select-options[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-radio-container[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{display:block;width:275px}@media screen and (max-width: 275px){.first-step-block[_ngcontent-%COMP%]   my-select-channel[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   my-select-options[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .peertube-radio-container[_ngcontent-%COMP%], .first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .form-group-description[_ngcontent-%COMP%]{white-space:nowrap}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{display:block;font-size:16px;padding:var(--input-y-padding) var(--input-x-padding);width:275px;max-width:275px;color:var(--input-fg);background-color:var(--input-bg);border:1px solid var(--input-border-color);border-radius:var(--input-border-radius);line-height:24px}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder);font-size:14px}.first-step-block[_ngcontent-%COMP%]   input[type=text][readonly][_ngcontent-%COMP%]{color:var(--fg-300)}.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus, .first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100);outline:0}.first-step-block[_ngcontent-%COMP%]   input[type=text][disabled][_ngcontent-%COMP%]{color:var(--fg-300);opacity:.8}@media screen and (max-width: 315px){.first-step-block[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{width:100%}}.first-step-block[_ngcontent-%COMP%]   .button-file[_ngcontent-%COMP%]{width:max-content}
/*# sourceMappingURL=common-publish-4SUPW5GK.css.map */`,`.first-step-block[_ngcontent-%COMP%]   .form-group-channel[_ngcontent-%COMP%]{margin-bottom:20px;margin-top:35px}.first-step-block[_ngcontent-%COMP%]   .audio-image-info[_ngcontent-%COMP%]{margin-bottom:10px}.first-step-block[_ngcontent-%COMP%]   .audio-preview[_ngcontent-%COMP%]{margin:30px 0}
/*# sourceMappingURL=video-upload.component-ZERFFFA4.css.map */`]}));let i=r;return i;})();var Ft=["videoUpload"],Gt=["videoImportUrl"],zt=["videoImportTorrent"],Xt=["videoGoLive"],Qt=i=>({"hide-nav":i});function Wt(i,r){i&1&&(a(0,"a",22),C(1,8),s());}function qt(i,r){if(i&1&&(f(0,Wt,2,0,"a",22),a(1,"a",23),C(2,7),s()),i&2){let n=l();h(n.isContactFormEnabled?0:-1);}}function Yt(i,r){}function jt(i,r){if(i&1&&(a(0,"my-alert",24)(1,"div"),w(2),s(),f(3,Yt,0,0,"ng-template",27),s()),i&2){let n=l(2),t=re(1);d(2),te(n.uploadMessages==null?null:n.uploadMessages.autoBlock),d(),m("ngTemplateOutlet",t);}}function Kt(i,r){i&1&&(a(0,"my-alert",25)(1,"div"),z(2,9),O(3,"strong"),X(),s(),a(4,"div"),z(5,10),O(6,"a",28),X(),s()());}function Jt(i,r){i&1&&O(0,"my-channels-setup-message");}function Zt(i,r){if(i&1&&(a(0,"div"),w(1),s()),i&2){let n=l(3);d(),te(n.uploadMessages==null?null:n.uploadMessages.quotaLeft);}}function en(i,r){if(i&1&&(a(0,"div"),w(1),s()),i&2){let n=l(3);d(),te(n.uploadMessages==null?null:n.uploadMessages.quotaLeftDaily);}}function tn(i,r){}function nn(i,r){if(i&1&&(a(0,"my-alert",26),f(1,Zt,2,1,"div",29)(2,en,2,1,"div",29)(3,tn,0,0,"ng-template",27),s()),i&2){let n=l(2),t=re(1);d(),m("ngIf",n.hasNoQuotaLeft),d(),m("ngIf",n.hasNoQuotaLeftDaily),d(),m("ngTemplateOutlet",t);}}function on(i,r){if(i&1&&(f(0,jt,4,2,"my-alert",24)(1,Kt,7,0,"my-alert",25)(2,Jt,1,0,"my-channels-setup-message"),O(3,"my-user-quota"),f(4,nn,4,3,"my-alert",26)),i&2){let n=l();h(n.user.isAutoBlocked(n.serverConfig)?0:-1),d(),h(n.isRootUser()?1:2),d(3),h(n.hasNoQuotaLeft||n.hasNoQuotaLeftDaily?4:-1);}}function rn(i,r){}function an(i,r){if(i&1&&(a(0,"div",21)(1,"my-alert",30)(2,"div"),w(3),s(),f(4,rn,0,0,"ng-template",27),s(),a(5,"div",31),O(6,"img",32),s()()),i&2){let n=l(),t=re(1);d(3),te(n.uploadMessages==null?null:n.uploadMessages.noQuota),d(),m("ngTemplateOutlet",t);}}function sn(i,r){}function ln(i,r){if(i&1&&f(0,sn,0,0,"ng-template",27),i&2){l(2);let n=re(3);m("ngTemplateOutlet",n);}}function _n(i,r){if(i&1){let n=v();a(0,"my-video-upload",42,3),P("firstStepDone",function(e){g(n);let o=l(2);return u(o.onFirstStepDone("upload",e));})("firstStepError",function(){g(n);let e=l(2);return u(e.onError());}),s();}if(i&2){let n=l(2);m("userChannels",n.userChannels)("userQuota",n.userQuota)("highestPrivacy",n.highestPrivacy);}}function cn(i,r){i&1&&(a(0,"a",35)(1,"span"),C(2,12),s()());}function dn(i,r){if(i&1&&(a(0,"div",38)(1,"span"),C(2,13),s(),a(3,"div",43),C(4,14),s(),a(5,"my-help",44),w(6),s()()),i&2){let n=l(2);d(6),Oe(" Import with URL is not available on ",n.instanceName,". ");}}function pn(i,r){if(i&1){let n=v();a(0,"my-video-import-url",42,4),P("firstStepDone",function(e){g(n);let o=l(2);return u(o.onFirstStepDone("import-url",e));})("firstStepError",function(){g(n);let e=l(2);return u(e.onError());}),s();}if(i&2){let n=l(2);m("userChannels",n.userChannels)("userQuota",n.userQuota)("highestPrivacy",n.highestPrivacy);}}function gn(i,r){i&1&&(a(0,"a",35)(1,"span"),C(2,15),s()());}function un(i,r){if(i&1&&(a(0,"div",38)(1,"span"),C(2,16),s(),a(3,"div",43),C(4,17),s(),a(5,"my-help",45),w(6),s()()),i&2){let n=l(2);d(6),Oe(" Import with torrent is not available on ",n.instanceName,". ");}}function mn(i,r){if(i&1){let n=v();a(0,"my-video-import-torrent",42,5),P("firstStepDone",function(e){g(n);let o=l(2);return u(o.onFirstStepDone("import-torrent",e));})("firstStepError",function(){g(n);let e=l(2);return u(e.onError());}),s();}if(i&2){let n=l(2);m("userChannels",n.userChannels)("userQuota",n.userQuota)("highestPrivacy",n.highestPrivacy);}}function Cn(i,r){i&1&&(a(0,"a",35)(1,"span"),C(2,18),s()());}function fn(i,r){if(i&1&&(a(0,"div",38)(1,"span"),C(2,19),s(),a(3,"div",43),C(4,20),s(),a(5,"my-help",46),w(6),s()()),i&2){let n=l(2);d(6),Oe(" Live streaming is not available on ",n.instanceName,". ");}}function Pn(i,r){if(i&1){let n=v();a(0,"my-video-go-live",42,6),P("firstStepDone",function(e){g(n);let o=l(2);return u(o.onFirstStepDone("go-live",e));})("firstStepError",function(){g(n);let e=l(2);return u(e.onError());}),s();}if(i&2){let n=l(2);m("userChannels",n.userChannels)("userQuota",n.userQuota)("highestPrivacy",n.highestPrivacy);}}function Mn(i,r){if(i&1){let n=v();a(0,"div",21),f(1,ln,1,1,null,27),a(2,"div",33,2),P("activeIdChange",function(e){g(n);let o=l();return u(o.onNavChange(e));}),x(4,34),a(5,"a",35)(6,"span"),C(7,11),s()(),f(8,_n,2,3,"ng-template",36),U(),x(9,37),f(10,cn,3,0,"a",35)(11,dn,7,1,"div",38)(12,pn,2,3,"ng-template",36),U(),x(13,39),f(14,gn,3,0,"a",35)(15,un,7,1,"div",38)(16,mn,2,3,"ng-template",36),U(),x(17,40),f(18,Cn,3,0,"a",35)(19,fn,7,1,"div",38)(20,Pn,2,3,"ng-template",36),U(),s(),O(21,"div",41),s();}if(i&2){let n=re(3),t=l();d(),h(t.isInSecondStep()?-1:1),d(),m("activeId",t.activeNav)("ngClass",Ge(7,Qt,t.isInSecondStep())),d(8),h(t.isVideoImportHttpEnabled()?10:11),d(4),h(t.isVideoImportTorrentEnabled()?14:15),d(4),h(t.isVideoLiveEnabled()?18:19),d(3),m("ngbNavOutlet",n);}}var Et=(()=>{let r=class r{auth=_(Ie);hooks=_($);serverService=_(D);route=_(B);router=_(se);manageController=_(T);videoService=_(pe);canDeactivateGuard=_(_e);videoUpload=F("videoUpload");videoImportUrl=F("videoImportUrl");videoImportTorrent=F("videoImportTorrent");videoGoLive=F("videoGoLive");user=null;secondStepType;videoName;activeNav;uploadMessages;hasNoQuotaLeft=!1;hasNoQuotaLeftDaily=!1;serverConfig;highestPrivacy;userChannels;userQuota;privacies;publishedIdQuery;uploadingQuery;get isContactFormEnabled(){return this.serverConfig.email.enabled&&this.serverConfig.contactForm.enabled;}get instanceName(){return this.serverConfig.instance.name;}ngOnInit(){let t=this.route.snapshot.data.resolverData,{videoChannels:e,userQuota:o,privacies:c}=t;this.userChannels=e,this.userQuota=o,this.privacies=c,this.user=this.auth.getUser(),this.serverConfig=this.serverService.getHTMLConfig(),this.highestPrivacy=this.videoService.getHighestAvailablePrivacy(c),this.route.snapshot.fragment&&this.onNavChange(this.route.snapshot.fragment),this.buildUploadMessages(),this.user.videoQuota!==-1&&o.videoQuotaUsed>this.user.videoQuota*.9&&(this.hasNoQuotaLeft=!0),this.user.videoQuotaDaily!==-1&&o.videoQuotaUsedDaily>this.user.videoQuotaDaily*.9&&(this.hasNoQuotaLeftDaily=!0),this.reset(),this.route.queryParams.subscribe(p=>{p.publishedId?this.publishedIdQuery=p.publishedId:p.uploading?this.uploadingQuery=p.uploading:(this.publishedIdQuery||this.uploadingQuery)&&this.tryToReset();});}tryToReset(){return H(this,null,function*(){let t=[this.videoUpload(),this.videoImportUrl(),this.videoImportTorrent(),this.videoGoLive()];for(let e of t)if(e){if(!(yield this.canDeactivateGuard.canDeactivate(e))){this.publishedIdQuery?this.manageController.silentRedirectOnManage(this.publishedIdQuery,this.route):this.uploadingQuery&&this.manageController.silentRedirectOnUploading(this.route);return;}e.reset();}this.reset();});}reset(){this.secondStepType=void 0,this.videoName=void 0,this.publishedIdQuery=void 0,this.uploadingQuery=void 0,this.manageController.setStore({userChannels:this.userChannels,userQuota:this.userQuota,privacies:this.privacies,videoEdit:void 0});}buildUploadMessages(){return H(this,null,function*(){let t="Ho sentim, la funci\xF3 de pujada est\xE0 deshabilitada per al vostre compte. Si voleu afegir v\xEDdeos, una persona administradora ha de desblocar-vos la quota.",e="Els v\xEDdeos penjats al servidor es revisen abans de publicar-se per al vostre compte. Si voleu afegir v\xEDdeos sense la verificaci\xF3 de moderaci\xF3, l'administraci\xF3 ha de deshabilitar el bloqueig autom\xE0tic dels vostres v\xEDdeos.",o="La vostra quota di\xE0ria de v\xEDdeo \xE9s insuficient. Si voleu afegir m\xE9s v\xEDdeos, heu d'esperar 24 hores o l'administraci\xF3 ha d'augmentar la vostra quota di\xE0ria.",c="La vostra quota de v\xEDdeo \xE9s insuficient, si voleu afegir m\xE9s v\xEDdeos, l'administraci\xF3 ha d'augmentar-la.",p={noQuota:t,autoBlock:e,quotaLeftDaily:o,quotaLeft:c};this.uploadMessages=yield this.hooks.wrapObject(p,"common","filter:upload.messages.create.result");});}onNavChange(t){this.activeNav=t,this.manageController.setConfig({manageType:t,serverConfig:this.serverConfig}),this.router.navigate([],{fragment:this.activeNav});}onFirstStepDone(t,e){this.secondStepType=t,this.videoName=e;}onError(){this.videoName=void 0,this.secondStepType=void 0;}onUnload(t){let{text:e,canDeactivate:o}=this.canDeactivate();if(!o)return t.returnValue=e,e;}canDeactivate(){return this.secondStepType==="upload"?this.videoUpload().canDeactivate():this.secondStepType==="import-url"?this.videoImportUrl().canDeactivate():this.secondStepType==="import-torrent"?this.videoImportTorrent().canDeactivate():this.secondStepType==="go-live"?this.videoGoLive().canDeactivate():{canDeactivate:!0};}isVideoImportHttpEnabled(){return this.serverConfig.import.videos.http.enabled;}isVideoImportTorrentEnabled(){return this.serverConfig.import.videos.torrent.enabled;}isVideoLiveEnabled(){return this.serverConfig.live.enabled;}isInSecondStep(){return!!this.secondStepType;}isRootUser(){return this.user.username==="root";}};S(r,"\u0275fac",function(e){return new(e||r)();}),S(r,"\u0275cmp",k({type:r,selectors:[["my-video-publish"]],viewQuery:function(e,o){e&1&&(G(o.videoUpload,Ft,5),G(o.videoImportUrl,Gt,5),G(o.videoImportTorrent,zt,5),G(o.videoGoLive,Xt,5)),e&2&&ie(4);},hostBindings:function(e,o){e&1&&P("beforeunload",function(p){return o.onUnload(p);},!1,He);},features:[Fe([T])],decls:6,vars:1,consts:()=>{let t;t="Llegir les normes de la inst\xE0ncia per a obtindre ajuda";let e;e="Contacteu amb nosaltres";let o;o="Recomanem que no feu servir el compte de "+"\uFFFD#3\uFFFD"+"root"+"\uFFFD/#3\uFFFD"+" per publicar els vostres v\xEDdeos perqu\xE8 \xE9s el compte de super-administraci\xF3 de la inst\xE0ncia.";let c;c="En lloc d'aix\xF2, "+"\uFFFD#6\uFFFD"+"creeu un compte dedicat"+"\uFFFD/#6\uFFFD"+" per a penjar els vostres v\xEDdeos.";let p;p="Pujar un fitxer";let M;M="Importar amb URL";let b;b="Funci\xF3 no disponible";let A;A="Importar amb URL";let R;R="NO DISPONIBLE";let Ne;Ne="Importar amb torrent";let De;De="Funci\xF3 no disponible";let xe;xe="Importar amb torrent";let Ue;Ue="NO DISPONIBLE";let Re;Re="Emetre en directe";let ke;ke="Funci\xF3 no disponible";let we;we="Emetre en directe";let Be;return Be="NO DISPONIBLE",[["helpButtons",""],["infoMessages",""],["nav","ngbNav"],["videoUpload",""],["videoImportUrl",""],["videoImportTorrent",""],["videoGoLive",""],t,e,o,c,p,M,A,R,Ne,xe,Ue,Re,we,Be,[1,"margin-content"],["routerLink","/about/contact",1,"peertube-button-link","primary-button","mt-3","me-3"],["routerLink","/about/instance",1,"peertube-button-link","primary-button","mt-3"],["type","primary",1,"upload-message","auto-blocked"],["type","warning",1,"upload-message","root-user","root-user","root-user"],["type","warning",1,"upload-message","quota-left"],[3,"ngTemplateOutlet"],["routerLink","/admin/overview/users",1,"text-decoration-underline","alert-link"],[4,"ngIf"],["type","warning",1,"upload-message","upload-disabled"],[1,"upload-image"],["src","/client/assets/images/mascot/defeated.svg","alt","defeated mascot"],["ngbNav","",1,"nav-tabs","video-add-nav",3,"activeIdChange","activeId","ngClass"],["ngbNavItem","upload"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","import-url"],[1,"unavailable-nav-link"],["ngbNavItem","import-torrent"],["ngbNavItem","go-live"],[1,"nav-content",3,"ngbNavOutlet"],[3,"firstStepDone","firstStepError","userChannels","userQuota","highestPrivacy"],[1,"pt-badge","badge-secondary","ms-2","me-1"],["helpTitle",b,"container","body"],["helpTitle",De,"container","body"],["helpTitle",ke,"container","body"]];},template:function(e,o){e&1&&f(0,qt,3,1,"ng-template",null,0,Ve)(2,on,5,3,"ng-template",null,1,Ve)(4,an,7,2,"div",21)(5,Mn,22,9,"div",21),e&2&&(d(4),h(o.user.hasUploadDisabled()?4:5));},dependencies:[ae,ve,Xe,lt,ct,Ke,ze,je,Ze,Je,Ye,et,ce,vt,ft,Mt,It,de],styles:[`.upload-message[_ngcontent-%COMP%]{display:block;width:100%;text-align:center;margin-bottom:0}.upload-message[_ngcontent-%COMP%]:last-child{margin-bottom:1rem}.upload-image[_ngcontent-%COMP%]{width:100%;text-align:center}.upload-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-top:2rem;margin-bottom:75px;width:220px;height:auto}[_nghost-%COMP%]     .video-add-nav{border-bottom:0 solid #fff;margin:20px 0 0!important}[_nghost-%COMP%]     .video-add-nav.hide-nav{display:none!important}[_nghost-%COMP%]     .video-add-nav a.nav-link, [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link{margin-bottom:0;min-height:40px!important;padding:0 30px!important;border:0 solid transparent}[_nghost-%COMP%]     .video-add-nav a.nav-link, [_nghost-%COMP%]     .video-add-nav a.nav-link:hover, [_nghost-%COMP%]     .video-add-nav a.nav-link:focus, [_nghost-%COMP%]     .video-add-nav a.nav-link:active, [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link, [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link:hover, [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link:focus, [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link:active{text-decoration:none}[_nghost-%COMP%]     .video-add-nav a.nav-link:focus:not(:focus-visible), [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link:focus:not(:focus-visible){outline:none}[_nghost-%COMP%]     .video-add-nav a.nav-link span, [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link span{border-bottom:2px solid transparent}[_nghost-%COMP%]     .video-add-nav a.nav-link.active, [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link.active{border-color:#fff;border-bottom-color:transparent}[_nghost-%COMP%]     .video-add-nav a.nav-link.active span, [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link.active span{border-bottom-color:var(--border-primary)}[_nghost-%COMP%]     .video-add-nav a.nav-link:hover:not(.active), [_nghost-%COMP%]     .video-add-nav .unavailable-nav-link:hover:not(.active){border-color:transparent}[_nghost-%COMP%]     .video-add-nav{overflow-x:auto;flex-wrap:unset;white-space:nowrap}[_nghost-%COMP%]     .video-add-nav a.nav-link.active{background-color:var(--bg-secondary-400)!important}[_nghost-%COMP%]     .upload-video-container{border:0 solid #fff;border-top:transparent;background-color:var(--bg-secondary-400);border-bottom-left-radius:3px;border-bottom-right-radius:3px;width:100%;min-height:440px;padding-bottom:20px;display:flex;justify-content:center;padding-top:20px}[_nghost-%COMP%]     .upload-video-container.dragover{border:3px dashed var(--primary)}
/*# sourceMappingURL=video-publish.component-FPVBLW7U.css.map */`]}));let i=r;return i;})();var Ae=(()=>{let r=class r{authService=_(Ie);serverService=_(D);userService=_(rt);resolve(){return fe([nt(this.authService),this.userService.getMyVideoQuotaUsed(),this.serverService.getVideoPrivacies()]).pipe(ne(([t,e,o])=>({videoChannels:t,userQuota:e,privacies:o})));}};S(r,"\u0275fac",function(e){return new(e||r)();}),S(r,"\u0275prov",$e({token:r,factory:r.fac}));let i=r;return i;})();var bt=ge(me());var On=(0,bt.default)("peertube:video-publish"),Ti=[{path:"",component:Et,canActivate:[ot,()=>{let i=new URLSearchParams(window.location.search).get("publishedId"),r=_(se);if(i){let n=window.location.pathname.match(/^\/videos\/publish\/(.*)$/),t=n?`/${n[1]}`:"";return On("Redirecting to video manage page",{publishedId:i,match:n,suffixUrl:t}),new Qe(r.parseUrl(`/videos/manage/${i}${t}`));}return!0;}],canDeactivate:[_e],providers:[Ae,T,dt,Ee,pt,ye,ut],resolve:{resolverData:Ae},children:mt}];export{Ti as default};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-AKYZEIXO.js.map