import{a as Be,b as Qe}from"./chunk-MTBIXD7U.js";import"./chunk-GFNWPGXC.js";import{a as qe}from"./chunk-CPDI5TQZ.js";import{a as He,b as Ye}from"./chunk-XHL23EQD.js";import"./chunk-EBEN7JLX.js";import"./chunk-IESFBSCZ.js";import{a as je}from"./chunk-HH4YHD3C.js";import{b as We}from"./chunk-3PB3Q4OH.js";import{a as Ue}from"./chunk-JVRBW57G.js";import{g as $}from"./chunk-BOZAQTZE.js";import{b as Ge,c as Ke}from"./chunk-25AA3I7H.js";import"./chunk-6JJL547V.js";import{s as we}from"./chunk-RT7DTAS6.js";import{B as xe,C as Ae,c as Se,g as Le,h as Me,m as Pe,n as Te,q as Ie,t as he,y as ye}from"./chunk-WO4VNXA3.js";import{a as ze}from"./chunk-PE7TFI7A.js";import{Ab as A,Ag as De,Bb as N,Bc as fe,Cb as u,Cc as Ce,Dc as Ne,Ea as oe,Fd as G,Ha as l,Hg as w,Le as ve,Mb as y,Na as M,Nb as _e,Ob as x,Pb as F,Qb as ce,Qg as Xe,Rb as v,Sa as ie,Sg as Ve,Ub as ue,Vb as de,Wa as re,Wb as me,Xf as be,Ya as m,Zb as ge,aa as g,eb as c,ha as p,ia as f,jb as ae,jc as pe,kd as Oe,la as te,lg as ke,mf as $e,nb as r,ob as i,od as Ee,pb as C,pd as Fe,qb as P,rb as T,tb as E,vb as I,wb as h,xb as d,yb as se,zb as le,zg as Re}from"./chunk-F7FAPFPY.js";import{i as L}from"./chunk-AI7IVZV2.js";var Ze=["forgotPasswordModal"],en=["otpTokenInput"],nn=["instanceAboutAccordion"],tn=n=>({"input-error":n});function on(n,s){if(n&1){let t=E();r(0,"p"),I(1,7),r(2,"a",38),N("click",function(o){p(t),u();let a=x(17),O=u();return f(O.onTermsClick(o,a));}),i(),C(3,"a",39)(4,"a",40),h(),i();}}function rn(n,s){if(n&1){let t=E();r(0,"p"),I(1,8),r(2,"a",38),N("click",function(o){p(t),u();let a=x(17),O=u();return f(O.onTermsClick(o,a));}),i(),C(3,"a",39)(4,"a",40),h(),i();}}function an(n,s){n&1&&(r(0,"my-alert",41),I(1,9),C(2,"a",42),h(),i());}function sn(n,s){n&1&&(r(0,"a",44),d(1,10),i());}function ln(n,s){if(n&1&&(r(0,"my-alert",41),F(1),m(2,sn,2,0,"a",43),i()),n&2){let t=u(2);l(),v(" ",t.error," "),l(),c("ngIf",t.error==="User email is not verified.");}}function _n(n,s){if(n&1&&(r(0,"div",51),F(1),i()),n&2){let t=u(3);l(),ce(t.formErrors.username);}}function cn(n,s){if(n&1&&(P(0),r(1,"div",45)(2,"div")(3,"label",46),d(4,11),i(),C(5,"input",47),i(),m(6,_n,2,1,"div",48),i(),r(7,"div",45)(8,"label",49),d(9,12),i(),C(10,"my-input-text",50),i(),T()),n&2){let t=u(2);l(5),c("ngClass",ge(3,tn,t.formErrors.username)),l(),c("ngIf",t.formErrors.username),l(4),c("formError",t.formErrors.password);}}function un(n,s){if(n&1&&(r(0,"div",45)(1,"p"),d(2,13),i(),r(3,"label",52),d(4,14),i(),C(5,"my-input-text",53,3),i()),n&2){let t=u(2);l(5),c("show",!0)("formError",t.formErrors["otp-token"]);}}function dn(n,s){n&1&&(P(0),r(1,"span",56),F(2,"\xB7"),i(),r(3,"a",57),d(4,16),i(),T());}function mn(n,s){if(n&1){let t=E();r(0,"div",54)(1,"button",55),N("click",function(){p(t);let o=u(2);return f(o.openForgotPasswordModal());}),d(2,15),i(),m(3,dn,5,0,"ng-container",24),i();}if(n&2){let t=u(2);l(3),c("ngIf",t.signupAllowed);}}function gn(n,s){if(n&1&&(r(0,"a",61),F(1),i()),n&2){let t=s.$implicit,e=u(3);c("href",e.getAuthHref(t),oe),l(),v(" ",t.authDisplayName," ");}}function pn(n,s){if(n&1&&(r(0,"div",58)(1,"div",59),d(2,17),i(),r(3,"div"),m(4,gn,2,2,"a",60),i()()),n&2){let t=u(2);l(4),c("ngForOf",t.getExternalLogins());}}function fn(n,s){if(n&1){let t=E();P(0),r(1,"my-alert",25)(2,"h5",26),d(3,6),i(),m(4,on,5,0,"p")(5,rn,5,0,"p"),i(),m(6,an,3,0,"my-alert",27)(7,ln,3,2,"my-alert",27),r(8,"div",28)(9,"div",29)(10,"form",30),N("ngSubmit",function(){p(t);let o=u();return f(o.login());}),m(11,cn,11,5,"ng-container",24)(12,un,7,2,"div",31),C(13,"input",32),m(14,mn,4,1,"div",33),i(),m(15,pn,5,1,"div",34),i(),r(16,"div",35,1),C(18,"my-instance-banner",36),r(19,"my-instance-about-accordion",37,2),N("init",function(o){p(t);let a=u();return f(a.onInstanceAboutAccordionInit(o));}),i()()(),T();}if(n&2){let t=u();l(4),ae(t.signupAllowed?4:5),l(2),c("ngIf",t.externalAuthError),l(),c("ngIf",t.error),l(3),c("formGroup",t.form),l(),c("ngIf",!t.otpStep),l(),c("ngIf",t.otpStep),l(),c("disabled",!t.form.valid),l(),c("ngIf",!t.otpStep),l(),c("ngIf",t.hasExternalLogins()),l(4),c("displayInstanceName",!1)("panels",t.instanceInformationPanels);}}function Cn(n,s){n&1&&(r(0,"my-alert",41),d(1,20),i());}function Nn(n,s){n&1&&(r(0,"div",74),d(1,21),i());}function On(n,s){if(n&1){let t=E();r(0,"div",62)(1,"h4",63),d(2,18),i(),r(3,"button",64),N("click",function(){p(t);let o=u();return f(o.hideForgotPasswordModal());}),C(4,"my-global-icon",65),i()(),r(5,"div",66),m(6,Cn,2,0,"my-alert",27)(7,Nn,2,0,"div",67),r(8,"div",68)(9,"label",69),d(10,19),i(),r(11,"input",70,4),me("ngModelChange",function(o){p(t);let a=u();return de(a.forgotPasswordEmail,o)||(a.forgotPasswordEmail=o),f(o);}),i()()(),r(13,"div",71)(14,"input",72),N("click",function(){p(t);let o=u();return f(o.hideForgotPasswordModal());})("key.enter",function(){p(t);let o=u();return f(o.hideForgotPasswordModal());}),i(),r(15,"input",73),N("click",function(){p(t);let o=u();return f(o.askResetPassword());}),i()();}if(n&2){let t=x(12),e=u();l(6),c("ngIf",e.isEmailDisabled()),l(),c("ngIf",!e.isEmailDisabled()),l(),c("hidden",e.isEmailDisabled()),l(3),ue("ngModel",e.forgotPasswordEmail),l(4),c("disabled",!t.validity.valid);}}var Je=(()=>{let s=class s extends Ke{formReactiveService=g(Ge);route=g(Oe);modalService=g(we);authService=g(ke);userService=g(Ve);redirectService=g(De);notifier=g(be);hooks=g(Xe);storage=g(Re);router=g(Ee);forgotPasswordModal=M("forgotPasswordModal");otpTokenInput=M("otpTokenInput");instanceAboutAccordion=M("instanceAboutAccordion");accordion;error=null;forgotPasswordEmail="";isAuthenticatedWithExternalAuth=!1;externalAuthError=!1;externalLogins=[];instanceBannerUrl;instanceInformationPanels={terms:!0,administrators:!1,features:!1,moderation:!1,codeOfConduct:!1};otpStep=!1;openedForgotPasswordModal;serverConfig;get signupAllowed(){return this.serverConfig.signup.allowed===!0;}get instanceName(){return this.serverConfig.instance.name;}onTermsClick(e,o){e.preventDefault();let a=this.instanceAboutAccordion();a&&(a.expandTerms(),o.scrollIntoView({behavior:"smooth"}));}isEmailDisabled(){return this.serverConfig.email.enabled===!1;}ngOnInit(){let e=this.route.snapshot;if(this.buildForm({username:He,password:Ye,"otp-token":{VALIDATORS:[],MESSAGES:$.MESSAGES}}),this.serverConfig=e.data.serverConfig,e.queryParams.externalAuthToken){this.loadExternalAuthToken(e.queryParams.username,e.queryParams.externalAuthToken);return;}if(e.queryParams.externalAuthError){this.externalAuthError=!0;return;}let o=this.redirectService.getPreviousUrl();o&&o!=="/"&&this.storage.setItem(s.SESSION_STORAGE_REDIRECT_URL_KEY,o);}ngAfterViewInit(){this.hooks.runAction("action:login.init","login");}getExternalLogins(){return this.serverConfig.plugin.registeredExternalAuths;}hasExternalLogins(){return this.getExternalLogins().length!==0;}getAuthHref(e){return ve($e.apiUrl,e);}login(){this.error=null;let e={username:this.form.value.username,password:this.form.value.password,otpToken:this.form.value["otp-token"]};this.authService.login(e).pipe().subscribe({next:()=>this.redirectService.redirectToPreviousRoute(),error:o=>{this.handleError(o);}});}askResetPassword(){this.userService.askResetPassword(this.forgotPasswordEmail).subscribe({next:()=>{let e="S'enviar\xE0 un correu amb les instruccions per restablir la contrasenya a "+this.forgotPasswordEmail+".\nL'enlla\xE7 caducar\xE0 al cap d'una hora.";this.notifier.success(e),this.hideForgotPasswordModal();},error:e=>this.notifier.error(e.message)});}openForgotPasswordModal(){this.openedForgotPasswordModal=this.modalService.open(this.forgotPasswordModal());}hideForgotPasswordModal(){this.openedForgotPasswordModal.close();}onInstanceAboutAccordionInit(e){this.accordion=e.accordion();}loadExternalAuthToken(e,o){this.isAuthenticatedWithExternalAuth=!0,this.authService.login({username:e,password:null,token:o}).subscribe({next:()=>{let a=this.storage.getItem(s.SESSION_STORAGE_REDIRECT_URL_KEY);if(a)return this.storage.removeItem(s.SESSION_STORAGE_REDIRECT_URL_KEY),this.router.navigateByUrl(a);this.redirectService.redirectToLatestSessionRoute();},error:a=>{this.handleError(a),this.isAuthenticatedWithExternalAuth=!1;}});}handleError(e){if(this.authService.isOTPMissingError(e)){this.otpStep=!0,setTimeout(()=>{this.form.get("otp-token").setValidators($.VALIDATORS),this.otpTokenInput().focus();});return;}if(e.message.includes("credentials are invalid")){this.error="Identificador o contrasenya incorrectes.";return;}if(e.message.includes("blocked")){this.error="El vostre compte est\xE0 blocat.";return;}if(e.body?.code===G.ACCOUNT_WAITING_FOR_APPROVAL){this.error="Aquest compte est\xE0 pendent d'aprovaci\xF3 de la moderaci\xF3.";return;}if(e.body?.code===G.ACCOUNT_APPROVAL_REJECTED){this.error="S'ha rebutjat l'aprovaci\xF3 del registre per a aquest compte.";return;}this.error=e.message;}};L(s,"SESSION_STORAGE_REDIRECT_URL_KEY","login-previous-url"),L(s,"\u0275fac",(()=>{let e;return function(a){return(e||(e=te(s)))(a||s);};})()),L(s,"\u0275cmp",ie({type:s,selectors:[["my-login"]],viewQuery:function(o,a){o&1&&(y(a.forgotPasswordModal,Ze,5),y(a.otpTokenInput,en,5),y(a.instanceAboutAccordion,nn,5)),o&2&&_e(3);},features:[re],decls:6,vars:2,consts:()=>{let e;e="Connecteu-vos a "+"\uFFFD0\uFFFD"+"";let o;o="Iniciar sessi\xF3";let a;a="Iniciar sessi\xF3 amb un compte et permet publicar contingut";let O;O="Aquesta inst\xE0ncia permet el registre. No obstant, consulteu les "+"\uFFFD#2\uFFFD"+"Condicions del servei"+"[\uFFFD/#2\uFFFD|\uFFFD/#3\uFFFD|\uFFFD/#4\uFFFD]"+""+"\uFFFD#3\uFFFD"+"Condicions del servei"+"[\uFFFD/#2\uFFFD|\uFFFD/#3\uFFFD|\uFFFD/#4\uFFFD]"+" abans de crear un compte. Tamb\xE9 podeu cercar una altra inst\xE0ncia que d'adapti a les vostres necessitats a: "+"\uFFFD#4\uFFFD"+"https://joinpeertube.org/instances"+"[\uFFFD/#2\uFFFD|\uFFFD/#3\uFFFD|\uFFFD/#4\uFFFD]"+". ",O=A(O);let S;S="Actualment, aquesta inst\xE0ncia no permet el registre d'usuari, podeu consultar les "+"\uFFFD#2\uFFFD"+"Condicions del servei"+"[\uFFFD/#2\uFFFD|\uFFFD/#3\uFFFD|\uFFFD/#4\uFFFD]"+""+"\uFFFD#3\uFFFD"+"Condicions del servei"+"[\uFFFD/#2\uFFFD|\uFFFD/#3\uFFFD|\uFFFD/#4\uFFFD]"+" per obtenir m\xE9s detalls o trobar una inst\xE0ncia que us ofereixi la possibilitat de registrar-vos per obtenir un compte i penjar-hi els vostres v\xEDdeos. Trobeu el vostre entre diverses inst\xE0ncies a: "+"\uFFFD#4\uFFFD"+"https://joinpeertube.org/instances"+"[\uFFFD/#2\uFFFD|\uFFFD/#3\uFFFD|\uFFFD/#4\uFFFD]"+". ",S=A(S);let b;b="Hi ha hagut un problema amb el proc\xE9s extern d'identificaci\xF3. Poseu-vos en contacte amb "+"\uFFFD#2\uFFFD"+"l'administraci\xF3"+"\uFFFD/#2\uFFFD"+". ";let k;k="Sol\xB7licitar un nou correu electr\xF2nic de verificaci\xF3";let R;R="Exemple: joan@exemple.cat";let D;D="Contrasenya";let X;X="Identificador o adre\xE7a electr\xF2nica";let V;V="Contrasenya";let z;z="Introdu\xEFu el codi de verificaci\xF3 generat per l'aplicaci\xF3 al vostre tel\xE8fon:";let U;U="Fitxa d'autenticaci\xF3 de dos factors";let K;K="Premeu aqu\xED per restablir la contrasenya";let j;j="He oblidat la contrasenya";let W;W="Crear un compte";let q;q="O identifiqueu-vos amb";let H;H="Tancar aquesta finestra modal";let Y;Y="Adre\xE7a electr\xF2nica";let B;B="Cancel\xB7lar";let Q;Q="Restablir";let J;J="Contrasenya oblidada";let Z;Z="Adre\xE7a electr\xF2nica";let ee;ee="No podem recuperar la vostra contrasenya perqu\xE8 l'administraci\xF3 de la vostra inst\xE0ncia no ha configurat el sistema de correu electr\xF2nic de PeerTube.";let ne;return ne="Inseriu la vostra adre\xE7a electr\xF2nica i us hi enviarem un enlla\xE7 per a restablir la contrasenya.",[["forgotPasswordModal",""],["instanceInformation",""],["instanceAboutAccordion",""],["otpTokenInput",""],["forgotPasswordEmailInput",""],e,a,O,S,b,k,X,V,z,U,j,W,q,J,Z,ee,ne,[1,"margin-content"],[1,"title-page"],[4,"ngIf"],["type","primary"],[1,"alert-heading"],["type","danger",4,"ngIf"],[1,"wrapper"],[1,"login-form-and-externals"],["myPluginSelector","","pluginSelectorId","login-form",1,"w-100","m-0",3,"ngSubmit","formGroup"],["class","form-group",4,"ngIf"],["type","submit","value",o,1,"peertube-button","primary-button","w-100",3,"disabled"],["class","additional-links d-flex justify-content-center mt-4 mb-5 text-center",4,"ngIf"],["class","external-login-blocks",4,"ngIf"],[1,"instance-information"],["rounded","true"],["pluginScope","login","pluginHook","filter:login.instance-about-plugin-panels.create.result",3,"init","displayInstanceName","panels"],["href","/about/instance#terms",1,"link-primary","terms-anchor","d-inline",3,"click"],["target","_blank","routerLink","/about/instance",1,"terms-link"],["href","https://joinpeertube.org/instances","target","_blank","rel","noopener noreferrer",1,"link-primary"],["type","danger"],["routerLink","/about",1,"link-primary"],["class","ms-1 link-primary","routerLink","/verify-account/ask-send-email",4,"ngIf"],["routerLink","/verify-account/ask-send-email",1,"ms-1","link-primary"],[1,"form-group"],["for","username"],["type","text","id","username","placeholder",R,"required","","formControlName","username","myAutofocus","","autocomplete","username",1,"form-control",3,"ngClass"],["class","form-error","role","alert",4,"ngIf"],["for","password"],["formControlName","password","inputId","password","placeholder",D,"autocomplete","current-password",3,"formError"],["role","alert",1,"form-error"],["for","otp-token"],["formControlName","otp-token","inputId","otp-token","autocomplete","otp-token",3,"show","formError"],[1,"additional-links","d-flex","justify-content-center","mt-4","mb-5","text-center"],["type","button","title",K,1,"button-unstyle","link-primary","mx-3",3,"click"],[1,"lh-1"],["routerLink","/signup",1,"link-primary","mx-3"],[1,"external-login-blocks"],[1,"fw-semibold"],["class","external-login-block","role","button",3,"href",4,"ngFor","ngForOf"],["role","button",1,"external-login-block",3,"href"],[1,"modal-header"],[1,"modal-title"],["type","button","title",H,1,"border-0","p-0",3,"click"],["iconName","cross"],[1,"modal-body","text-start"],["class","mb-4",4,"ngIf"],[1,"form-group",3,"hidden"],["for","forgot-password-email"],["type","email","id","forgot-password-email","placeholder",Y,"required","",3,"ngModelChange","ngModel"],[1,"modal-footer","inputs"],["type","button","role","button","value",B,1,"peertube-button","secondary-button","d-none","d-sm-block",3,"click","key.enter"],["type","submit","value",Q,1,"peertube-button","primary-button",3,"click","disabled"],[1,"mb-4"]];},template:function(o,a){o&1&&(r(0,"div",22)(1,"h1",23),d(2,5),i(),m(3,fn,21,11,"ng-container",24),i(),m(4,On,16,5,"ng-template",null,0,pe)),o&2&&(l(2),se(a.instanceName),le(2),l(),c("ngIf",!a.externalAuthError&&!a.isAuthenticatedWithExternalAuth));},dependencies:[Ne,Fe,xe,Te,Se,Le,Me,ye,Pe,je,Ae,Ie,he,qe,fe,We,Ce,Qe,Be,ze,Ue],styles:[`label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-size:1.125rem}input[type=text][_ngcontent-%COMP%], input[type=email][_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) var(--input-x-padding);width:100%;max-width:100%;color:var(--input-fg);background-color:var(--input-bg);border:1px solid var(--input-border-color);border-radius:var(--input-border-radius);line-height:24px}input[type=text][_ngcontent-%COMP%]::placeholder, input[type=email][_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder);font-size:14px}input[type=text][readonly][_ngcontent-%COMP%], input[type=email][readonly][_ngcontent-%COMP%]{color:var(--fg-300)}input[type=text][_ngcontent-%COMP%]:focus, input[type=text][_ngcontent-%COMP%]:focus-visible, input[type=email][_ngcontent-%COMP%]:focus, input[type=email][_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100);outline:0}input[type=text][disabled][_ngcontent-%COMP%], input[type=email][disabled][_ngcontent-%COMP%]{color:var(--fg-300);opacity:.8}@media screen and (max-width: calc(100% + 40px)){input[type=text][_ngcontent-%COMP%], input[type=email][_ngcontent-%COMP%]{width:100%}}.wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;flex-wrap:wrap}.wrapper[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1 1}.wrapper[_ngcontent-%COMP%], my-alert[_ngcontent-%COMP%]{max-width:1200px}my-alert[_ngcontent-%COMP%]{display:block;margin-bottom:2rem}.login-form-and-externals[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;max-width:450px;margin-inline-start:.625rem;margin-inline-end:.625rem;margin-bottom:calc(1.375rem + 1.5vw)}@media (min-width: 1200px){.login-form-and-externals[_ngcontent-%COMP%]{margin-bottom:2.5rem}}.external-login-blocks[_ngcontent-%COMP%]{min-width:200px;text-align:center}.external-login-blocks[_ngcontent-%COMP%]   .external-login-block[_ngcontent-%COMP%]{cursor:pointer;border:1px solid #d1d7e0;border-radius:5px;color:var(--fg);margin:10px 10px 0 0;display:flex;justify-content:center;align-items:center;min-height:35px;min-width:100px}.external-login-blocks[_ngcontent-%COMP%]   .external-login-block[_ngcontent-%COMP%], .external-login-blocks[_ngcontent-%COMP%]   .external-login-block[_ngcontent-%COMP%]:hover, .external-login-blocks[_ngcontent-%COMP%]   .external-login-block[_ngcontent-%COMP%]:focus, .external-login-blocks[_ngcontent-%COMP%]   .external-login-block[_ngcontent-%COMP%]:active{text-decoration:none}.external-login-blocks[_ngcontent-%COMP%]   .external-login-block[_ngcontent-%COMP%]:focus:not(:focus-visible){outline:none}.external-login-blocks[_ngcontent-%COMP%]   .external-login-block[_ngcontent-%COMP%]:hover{background-color:#d1d7e080}.instance-information[_ngcontent-%COMP%]{max-width:600px;margin-inline-start:.625rem;margin-inline-end:.625rem;margin-bottom:calc(1.375rem + 1.5vw);min-width:calc(3.325rem + 24.9vw)}@media (min-width: 1200px){.instance-information[_ngcontent-%COMP%]{margin-bottom:2.5rem}}@media (min-width: 1200px){.instance-information[_ngcontent-%COMP%]{min-width:22rem}}.terms-anchor[_ngcontent-%COMP%]{display:inline}.terms-link[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 800px){.wrapper[_ngcontent-%COMP%]{flex-direction:column-reverse}.wrapper[_ngcontent-%COMP%]   .login-form-and-externals[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%]   .instance-information[_ngcontent-%COMP%]{width:100%;max-width:450px;min-width:unset;align-self:center;margin-inline-start:0;margin-inline-end:0}.wrapper[_ngcontent-%COMP%]   .instance-information[_ngcontent-%COMP%]     .accordion{display:none}.wrapper[_ngcontent-%COMP%]   .terms-anchor[_ngcontent-%COMP%]{display:none}.wrapper[_ngcontent-%COMP%]   .terms-link[_ngcontent-%COMP%]{display:inline}}
/*# sourceMappingURL=login.component-XEJMWRJH.css.map */`]}));let n=s;return n;})();var Hn=[{path:"",component:Je,data:{meta:{title:"Iniciar sessi\xF3"}},providers:[w],resolve:{serverConfig:w}}];export{Hn as default};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-WRCDCDZL.js.map