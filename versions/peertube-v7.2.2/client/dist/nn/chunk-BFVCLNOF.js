import{a as re,b as ie}from"./chunk-ANGOORPW.js";import{d as x}from"./chunk-UI5MIAKJ.js";import{a as te}from"./chunk-C5UL7A6S.js";import{Ad as w,B as a,C as A,D as R,Fd as W,Q as U,Sc as z,Sg as T,Tc as S,Tf as q,Vf as Y,Wc as j,Xc as b,Y as F,Yd as V,Zd as f,aa as h,ae as G,ce as M,i as O,j as k,k as $,kg as D,lg as K,mf as v,n as m,qg as Q,sg as Z,te as J,ve as X,xg as ee,zd as E}from"./chunk-F7FAPFPY.js";import{a as y,b as L,c as _,i as p}from"./chunk-AI7IVZV2.js";var H=class extends x{support;tags;downloadEnabled;commentsEnabled;commentsPolicy;likesPercent;dislikesPercent;trackerUrls;inputFileUpdatedAt;constructor(e,t={}){super(e,t),this.channel=new te(e.channel),this.account=new Y(e.account),this.tags=e.tags,this.support=e.support,this.commentsPolicy=e.commentsPolicy,this.downloadEnabled=e.downloadEnabled,this.inputFileUpdatedAt=e.inputFileUpdatedAt,this.trackerUrls=e.trackerUrls,this.buildLikeAndDislikePercents();}buildLikeAndDislikePercents(){this.likesPercent=this.likes/(this.likes+this.dislikes)*100,this.dislikesPercent=this.dislikes/(this.likes+this.dislikes)*100;}getHlsPlaylist(){return this.streamingPlaylists.find(e=>e.type===G.HLS);}hasHlsPlaylist(){return!!this.getHlsPlaylist();}};var o=class o{auth=h(K);authHttp=h(b);restExtractor=h(D);restService=h(Q);serverService=h(ee);confirmService=h(Z);userService=h(T);getVideoViewUrl(e){return`${o.BASE_VIDEO_URL}/${e}/views`;}getVideo(e){let t=B.buildVideoPasswordHeader(e.videoPassword);return this.serverService.getServerLocale().pipe(U(r=>this.authHttp.get(`${o.BASE_VIDEO_URL}/${e.videoId}`,{headers:t}).pipe(m(i=>({videoHash:i,translations:r})))),m(({videoHash:r,translations:i})=>new H(r,i)),a(r=>this.restExtractor.handleError(r)));}updateVideo(e,t){let r=q(t);return this.authHttp.put(`${o.BASE_VIDEO_URL}/${e}`,r).pipe(a(i=>this.restExtractor.handleError(i)));}uploadVideo(e){let t=new j("POST",`${o.BASE_VIDEO_URL}/upload`,e,{reportProgress:!0});return this.authHttp.request(t).pipe(a(r=>this.restExtractor.handleError(r)));}removeVideo(e){let t=M(e);return O(t).pipe(R(r=>this.authHttp.delete(`${o.BASE_VIDEO_URL}/${r}`)),A(),a(r=>this.restExtractor.handleError(r)));}listMyVideos(e){let{videoPagination:t,restPagination:r,sort:i,channelNameOneOf:s,privacyOneOf:n,search:d}=e,l=t?this.restService.componentToRestPagination(t):r,u=new S();u=this.restService.addRestGetParams(u,l,this.buildListSort(i));let g={};return J(e.isLive)&&(g.isLive=e.isLive),e.search&&(g.search=d),e.privacyOneOf&&(g.privacyOneOf=n),u=this.restService.addObjectParams(u,g),s!==void 0&&s.length!==0&&(u=this.restService.addArrayParams(u,"channelNameOneOf",s)),this.authHttp.get(T.BASE_USERS_URL+"me/videos",{params:u}).pipe(U(P=>this.extractVideos(P)),a(P=>this.restExtractor.handleError(P)));}listAccountVideos(e){return this.listVideos(L(y({},e),{account:e.account}));}listChannelVideos(e){return this.listVideos(L(y({},e),{videoChannel:e.videoChannel}));}listVideos(e){let d=e,{account:t,videoChannel:r}=d,i=_(d,["account","videoChannel"]),s=new S();s=this.buildVideoListParams(y({params:s},i));let n;return r?n=ie.BASE_VIDEO_CHANNEL_URL+r.nameWithHost+"/videos":t?n=re.BASE_ACCOUNT_URL+t.nameWithHost+"/videos":n=o.BASE_VIDEO_URL,this.authHttp.get(n,{params:s}).pipe(U(l=>this.extractVideos(l)),a(l=>this.restExtractor.handleError(l)));}buildVideoListParams(e){let N=e,{params:t,videoPagination:r,sort:i,categoryOneOf:s,languageOneOf:n,privacyOneOf:d,skipCount:l,search:u,nsfw:g,nsfwFlagsExcluded:P,nsfwFlagsIncluded:se}=N,ne=_(N,["params","videoPagination","sort","categoryOneOf","languageOneOf","privacyOneOf","skipCount","search","nsfw","nsfwFlagsExcluded","nsfwFlagsIncluded"]),oe=r?this.restService.componentToRestPagination(r):void 0,c=this.restService.addRestGetParams(t,oe,this.buildListSort(i));return l&&(c=c.set("skipCount",l+"")),n!==void 0&&(c=this.restService.addArrayParams(c,"languageOneOf",n)),s!==void 0&&(c=this.restService.addArrayParams(c,"categoryOneOf",s)),d!==void 0&&(c=this.restService.addArrayParams(c,"privacyOneOf",d)),u&&(c=c.set("search",u)),c=this.buildNSFWParams(c,{nsfw:g,nsfwFlagsExcluded:P,nsfwFlagsIncluded:se}),this.restService.addObjectParams(c,ne);}buildNSFWParams(e,t={}){let{nsfw:r,nsfwFlagsExcluded:i,nsfwFlagsIncluded:s}=t,n=this.auth.isLoggedIn()?void 0:this.userService.getAnonymousUser(),d=n?n.nsfwFlagsHidden:void 0,l=n?n.nsfwFlagsDisplayed|n.nsfwFlagsBlurred|n.nsfwFlagsWarned:void 0;return r!==void 0?e=e.set("nsfw",r):n?.nsfwPolicy&&(e=e.set("nsfw",this.nsfwPolicyToParam(n.nsfwPolicy))),i!==void 0?e=e.set("nsfwFlagsExcluded",i):d!==void 0&&(e=e.set("nsfwFlagsExcluded",d)),s!==void 0?e=e.set("nsfwFlagsIncluded",s):l!==void 0&&(e=e.set("nsfwFlagsIncluded",l)),e;}buildListSort(e){let t=this.restService.buildSortString(e);if(typeof t=="string")return this.auth.isLoggedIn()&&(t==="hot"||t==="-hot")?t.replace("hot","best"):t;}buildBaseFeedUrls(e,t=o.BASE_FEEDS_URL){let r=[{type:w.VIDEOS,format:E.RSS,label:"media rss 2.0",url:t+E.RSS.toLowerCase()},{type:w.VIDEOS,format:E.ATOM,label:"atom 1.0",url:t+E.ATOM.toLowerCase()},{type:w.VIDEOS,format:E.JSON,label:"json 1.0",url:t+E.JSON.toLowerCase()}];if(e&&e.keys().length!==0)for(let i of r)i.url+="?"+e.toString();return r;}getVideoFeedUrls(e,t,r){let i=this.restService.addRestGetParams(new S(),void 0,e);if(t&&(i=i.set("isLocal",t)),r)for(let s of r)i=i.append("categoryOneOf[]",s+"");return this.buildBaseFeedUrls(i);}getAccountFeedUrls(e){let t=this.restService.addRestGetParams(new S());return t=t.set("accountId",e.toString()),this.buildBaseFeedUrls(t);}getVideoChannelFeedUrls(e){let t=this.restService.addRestGetParams(new S());t=t.set("videoChannelId",e.toString());let r=this.buildBaseFeedUrls(t);return r.push({type:w.PODCAST,format:E.PODCAST,label:"podcast rss 2.0",url:o.PODCAST_FEEDS_URL+`?videoChannelId=${e}`}),r;}getVideoSubscriptionFeedUrls(e,t){let r=this.restService.addRestGetParams(new S());return r=r.set("accountId",e.toString()),r=r.set("token",t),this.buildBaseFeedUrls(r,o.BASE_SUBSCRIPTION_FEEDS_URL);}getVideoFileMetadata(e){return this.authHttp.get(e).pipe(a(t=>this.restExtractor.handleError(t)));}removeVideoFiles(e,t){return O(e).pipe(R(r=>this.authHttp.delete(o.BASE_VIDEO_URL+"/"+r+"/"+t)),A(),a(r=>this.restExtractor.handleError(r)));}removeFile(e,t,r){return this.authHttp.delete(o.BASE_VIDEO_URL+"/"+e+"/"+r+"/"+t).pipe(a(i=>this.restExtractor.handleError(i)));}removeSourceFile(e){return this.authHttp.delete(o.BASE_VIDEO_URL+"/"+e+"/source/file").pipe(a(t=>this.restExtractor.handleError(t)));}runTranscoding(e){let{videos:t,type:r,forceTranscoding:i}=e,s={transcodingType:r,forceTranscoding:i};return O(t).pipe(R(n=>this.authHttp.post(o.BASE_VIDEO_URL+"/"+n.uuid+"/transcoding",s).pipe(a(d=>{if(d.error?.code===W.VIDEO_ALREADY_BEING_TRANSCODED&&!i){let l="PeerTube considers video \""+n.name+"\" is already being transcoded."+" If you think PeerTube is wrong (video in broken state after a crash etc.), you can force transcoding on this video."+" Do you still want to run transcoding?";return O(this.confirmService.confirm(l,"Force transcoding")).pipe(U(u=>u===!1?$(()=>d):this.runTranscoding({videos:[n],type:r,forceTranscoding:!0})));}return $(()=>d);}))),A(),a(n=>this.restExtractor.handleError(n)));}generateDownloadUrl(e){let{video:t,files:r,videoFileToken:i}=e;return X({baseUrl:v.originServerUrl,videoFiles:r.map(s=>s.id),videoUUID:t.uuid,videoFileToken:i});}getStoryboards(e,t){let r=B.buildVideoPasswordHeader(t);return this.authHttp.get(o.BASE_VIDEO_URL+"/"+e+"/storyboards",{headers:r}).pipe(m(({storyboards:i})=>i),a(i=>i.status===404?k([]):this.restExtractor.handleError(i)));}getSource(e){return this.authHttp.get(o.BASE_VIDEO_URL+"/"+e+"/source").pipe(a(t=>t.status===404?k(void 0):this.restExtractor.handleError(t)));}setVideoLike(e,t){return this.setVideoRate(e,"like",t);}setVideoDislike(e,t){return this.setVideoRate(e,"dislike",t);}unsetVideoLike(e,t){return this.setVideoRate(e,"none",t);}getUserVideoRating(e){let t=T.BASE_USERS_URL+"me/videos/"+e+"/rating";return this.authHttp.get(t).pipe(a(r=>this.restExtractor.handleError(r)));}extractVideos(e){return this.serverService.getServerLocale().pipe(m(t=>{let r=e.data,i=e.total,s=[];for(let n of r)s.push(new x(n,t));return{total:i,data:s};}));}explainedPrivacyLabels(e,t=f.PUBLIC){let r={[f.PRIVATE]:"Only I can see this video",[f.UNLISTED]:"Only shareable via a private link",[f.PUBLIC]:"Anyone can see this video",[f.INTERNAL]:"Only users of this platform can see this video",[f.PASSWORD_PROTECTED]:"Only users with the appropriate password can see this video"};return{videoPrivacies:e.map(s=>L(y({},s),{description:r[s.id]})),defaultPrivacyId:e.find(s=>s.id===t)?.id||e[0].id};}buildNSFWTooltip(e){let t=[];return(e.nsfwFlags&V.VIOLENT)===V.VIOLENT&&t.push("violence"),(e.nsfwFlags&V.EXPLICIT_SEX)===V.EXPLICIT_SEX&&t.push("explicit sex"),t.length===0?"This video contains sensitive content":"This video contains sensitive content: "+t.join(" - ")+"";}getHighestAvailablePrivacy(e){let t=[f.PRIVATE,f.INTERNAL,f.UNLISTED,f.PUBLIC];for(let r of t)if(e.find(i=>i.id===r))return r;throw new Error("No highest privacy available");}nsfwPolicyToParam(e){return e==="do_not_list"?"false":"both";}buildDefaultOwnerDisplayType(e){let t=e.account.name;return e.channel.displayName===`Default ${t} channel`||e.channel.displayName===`Main ${t} channel`||e.channel.name.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/)?"account":"videoChannel";}setVideoRate(e,t,r){let i=`${o.BASE_VIDEO_URL}/${e}/rate`,s={rating:t},n=B.buildVideoPasswordHeader(r);return this.authHttp.put(i,s,{headers:n}).pipe(a(d=>this.restExtractor.handleError(d)));}};p(o,"BASE_VIDEO_URL",v.apiUrl+"/api/v1/videos"),p(o,"BASE_FEEDS_URL",v.apiUrl+"/feeds/videos."),p(o,"PODCAST_FEEDS_URL",v.apiUrl+"/feeds/podcast/videos.xml"),p(o,"BASE_SUBSCRIPTION_FEEDS_URL",v.apiUrl+"/feeds/subscriptions."),p(o,"\u0275fac",function(t){return new(t||o)();}),p(o,"\u0275prov",F({token:o,factory:o.Éµfac}));var C=o;var B=(()=>{let e=class e{authHttp=h(b);restExtractor=h(D);static buildVideoPasswordHeader(r){return r?new z().set("x-peertube-video-password",r):void 0;}getVideoPasswords(r){return this.authHttp.get(`${C.BASE_VIDEO_URL}/${r.videoUUID}/passwords`).pipe(m(i=>i.data),a(i=>this.restExtractor.handleError(i)));}};p(e,"\u0275fac",function(i){return new(i||e)();}),p(e,"\u0275prov",F({token:e,factory:e.Éµfac}));let I=e;return I;})();export{H as a,B as b,C as c};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-BFVCLNOF.js.map