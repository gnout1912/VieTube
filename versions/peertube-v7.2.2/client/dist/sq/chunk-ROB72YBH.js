import{a as u}from"./chunk-OPOGZMDG.js";import{d as V}from"./chunk-UI5MIAKJ.js";import{a as h}from"./chunk-C5UL7A6S.js";import{B as n,Kd as i,Ld as T,Mg as k,S as I,Tc as _,Uf as R,Vc as d,Vf as O,Xc as v,Y as A,aa as s,kg as S,lf as N,lg as f,mf as b,n as E,qg as g}from"./chunk-F7FAPFPY.js";import{i as l}from"./chunk-AI7IVZV2.js";var m=class{id;type;read;video;videoImport;comment;abuse;videoBlacklist;account;actorFollow;plugin;peertube;registration;videoCaption;createdAt;updatedAt;videoUrl;commentUrl;commentReviewUrl;commentReviewQueryParams={};abuseUrl;abuseQueryParams={};videoAutoBlacklistUrl;accountUrl;registrationsUrl;videoImportIdentifier;videoImportUrl;instanceFollowUrl;peertubeVersionLink;pluginUrl;pluginQueryParams={};constructor(t,r){this.id=t.id,this.type=t.type,this.read=t.read;try{switch(this.video=t.video,this.video&&this.setVideoChannelAvatarUrl(this.video.channel),this.videoImport=t.videoImport,this.comment=t.comment,this.comment&&this.setAccountAvatarUrl(this.comment.account),this.abuse=t.abuse,this.videoBlacklist=t.videoBlacklist,this.account=t.account,this.account&&this.setAccountAvatarUrl(this.account),this.actorFollow=t.actorFollow,this.actorFollow&&this.setAccountAvatarUrl(this.actorFollow.follower),this.plugin=t.plugin,this.peertube=t.peertube,this.registration=t.registration,this.videoCaption=t.videoCaption,this.createdAt=t.createdAt,this.updatedAt=t.updatedAt,this.type){case i.NEW_VIDEO_FROM_SUBSCRIPTION:case i.NEW_LIVE_FROM_SUBSCRIPTION:this.videoUrl=this.buildVideoUrl(this.video);break;case i.UNBLACKLIST_ON_MY_VIDEO:this.videoUrl=this.buildVideoUrl(this.video);break;case i.NEW_COMMENT_ON_MY_VIDEO:case i.COMMENT_MENTION:if(!this.comment)break;this.accountUrl=this.buildAccountUrl(this.comment.account),this.commentUrl=this.buildCommentUrl(this.comment),this.commentReviewUrl="/my-account/videos/comments",this.commentReviewQueryParams.search="heldForReview:true";break;case i.NEW_ABUSE_FOR_MODERATORS:this.abuseUrl="/admin/moderation/abuses/list",this.abuseQueryParams.search="#"+this.abuse.id,this.abuse.video?this.videoUrl=this.buildVideoUrl(this.abuse.video):this.abuse.comment?this.commentUrl=this.buildCommentUrl(this.abuse.comment):this.abuse.account&&(this.accountUrl=this.buildAccountUrl(this.abuse.account));break;case i.ABUSE_STATE_CHANGE:this.abuseUrl="/my-account/abuses",this.abuseQueryParams.search="#"+this.abuse.id;break;case i.ABUSE_NEW_MESSAGE:this.abuseUrl=r.hasRight(T.MANAGE_ABUSES)?"/admin/moderation/abuses/list":"/my-account/abuses",this.abuseQueryParams.search="#"+this.abuse.id;break;case i.VIDEO_AUTO_BLACKLIST_FOR_MODERATORS:this.videoAutoBlacklistUrl="/admin/moderation/video-auto-blacklist/list",this.videoBlacklist||(this.videoBlacklist={id:null,video:this.video}),this.videoUrl=this.buildVideoUrl(this.videoBlacklist.video);break;case i.BLACKLIST_ON_MY_VIDEO:this.videoUrl=this.buildVideoUrl(this.videoBlacklist.video);break;case i.MY_VIDEO_PUBLISHED:this.videoUrl=this.buildVideoUrl(this.video);break;case i.MY_VIDEO_IMPORT_SUCCESS:this.videoImportUrl=this.buildVideoImportUrl(),this.videoImportIdentifier=this.buildVideoImportIdentifier(this.videoImport),this.videoImport.video&&(this.videoUrl=this.buildVideoUrl(this.videoImport.video));break;case i.MY_VIDEO_IMPORT_ERROR:this.videoImportUrl=this.buildVideoImportUrl(),this.videoImportIdentifier=this.buildVideoImportIdentifier(this.videoImport);break;case i.NEW_USER_REGISTRATION:this.accountUrl=this.buildAccountUrl(this.account);break;case i.NEW_USER_REGISTRATION_REQUEST:this.registrationsUrl="/admin/moderation/registrations/list";break;case i.NEW_FOLLOW:this.accountUrl=this.buildAccountUrl(this.actorFollow.follower);break;case i.NEW_INSTANCE_FOLLOWER:this.instanceFollowUrl="/admin/settings/follows/followers-list";break;case i.AUTO_INSTANCE_FOLLOWING:this.instanceFollowUrl="/admin/settings/follows/following-list";break;case i.NEW_PEERTUBE_VERSION:this.peertubeVersionLink="https://joinpeertube.org/news";break;case i.NEW_PLUGIN_VERSION:this.pluginUrl="/admin/settings/plugins/list-installed",this.pluginQueryParams.pluginType=this.plugin.type+"";break;case i.MY_VIDEO_TRANSCRIPTION_GENERATED:this.videoUrl=this.buildVideoUrl(this.videoCaption.video);break;case i.MY_VIDEO_STUDIO_EDITION_FINISHED:this.videoUrl=this.buildVideoUrl(this.video);break}}catch(o){this.type=null,N.error(o)}}buildVideoUrl(t){return V.buildWatchUrl(t)}buildAccountUrl(t){return"/a/"+R.CREATE_BY_STRING(t.name,t.host)}buildVideoImportUrl(){return"/my-library/video-imports"}buildVideoImportIdentifier(t){return t.video?.name||t.targetUrl||t.magnetUri||t.torrentName}buildCommentUrl(t){return[this.buildVideoUrl(t.video),{threadId:t.threadId}]}setAccountAvatarUrl(t){t.avatarUrl=h.GET_ACTOR_AVATAR_URL(t,48)||O.GET_DEFAULT_AVATAR_URL(48)}setVideoChannelAvatarUrl(t){t.avatarUrl=h.GET_ACTOR_AVATAR_URL(t,48)||h.GET_DEFAULT_AVATAR_URL(48)}};var e=class e{authHttp=s(v);auth=s(f);restExtractor=s(S);restService=s(g);peertubeSocket=s(k);listMyNotifications(t){let{pagination:r,ignoreLoadingBar:o,unread:c,sort:p}=t,a=new _;a=this.restService.addRestGetParams(a,this.restService.componentToRestPagination(r),p),c&&(a=a.append("unread",`${c}`));let L=o?new d().set(u,!0):void 0;return this.authHttp.get(e.BASE_NOTIFICATIONS_URL,{params:a,context:L}).pipe(E(U=>this.restExtractor.applyToResultListData(U,this.formatNotification.bind(this))),n(U=>this.restExtractor.handleError(U)))}countUnreadNotifications(){return this.listMyNotifications({pagination:{currentPage:1,itemsPerPage:0},ignoreLoadingBar:!0,unread:!0}).pipe(E(t=>t.total))}markAsRead(t){let r=e.BASE_NOTIFICATIONS_URL+"/read",o={ids:[t.id]},c=new d().set(u,!0);return this.authHttp.post(r,o,{context:c}).pipe(I(()=>this.peertubeSocket.dispatchNotificationEvent("read")),n(p=>this.restExtractor.handleError(p)))}markAllAsRead(){let t=e.BASE_NOTIFICATIONS_URL+"/read-all",r=new d().set(u,!0);return this.authHttp.post(t,{},{context:r}).pipe(I(()=>this.peertubeSocket.dispatchNotificationEvent("read-all")),n(o=>this.restExtractor.handleError(o)))}updateNotificationSettings(t){let r=e.BASE_NOTIFICATION_SETTINGS;return this.authHttp.put(r,t).pipe(n(o=>this.restExtractor.handleError(o)))}formatNotification(t){return new m(t,this.auth.getUser())}};l(e,"BASE_NOTIFICATIONS_URL",b.apiUrl+"/api/v1/users/me/notifications"),l(e,"BASE_NOTIFICATION_SETTINGS",b.apiUrl+"/api/v1/users/me/notification-settings"),l(e,"\u0275fac",function(r){return new(r||e)}),l(e,"\u0275prov",A({token:e,factory:e.\u0275fac}));var C=e;export{C as a};
/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*/
//# sourceMappingURL=chunk-ROB72YBH.js.map
