import{b as E}from"./chunk-BFVCLNOF.js";import{d as L}from"./chunk-UI5MIAKJ.js";import{B as n,C as x,D as I,Hf as C,Sf as D,Tc as f,Uf as w,Xc as g,Y as V,aa as R,i as S,kg as T,mf as A,n as h,qg as F,zd as c}from"./chunk-F7FAPFPY.js";import{i as m}from"./chunk-AI7IVZV2.js";var l=class{id;url;text;threadId;inReplyToCommentId;videoId;createdAt;updatedAt;deletedAt;isDeleted;heldForReview;account;totalRepliesFromVideoAuthor;totalReplies;by;isLocal;constructor(t){this.id=t.id,this.url=t.url,this.text=t.text,this.threadId=t.threadId,this.inReplyToCommentId=t.inReplyToCommentId,this.videoId=t.videoId,this.createdAt=new Date(t.createdAt.toString()),this.updatedAt=new Date(t.updatedAt.toString()),this.deletedAt=t.deletedAt?new Date(t.deletedAt.toString()):null,this.isDeleted=t.isDeleted,this.heldForReview=t.heldForReview,this.account=t.account,this.totalRepliesFromVideoAuthor=t.totalRepliesFromVideoAuthor,this.totalReplies=t.totalReplies,this.account&&(this.by=w.CREATE_BY_STRING(this.account.name,this.account.host),this.isLocal=this.account.host.trim()===D())}},U=class{id;url;text;textHtml;threadId;inReplyToCommentId;createdAt;updatedAt;account;localUrl;video;heldForReview;automaticTags;by;constructor(t,e){this.id=t.id,this.url=t.url,this.text=t.text,this.textHtml=e,this.heldForReview=t.heldForReview,this.threadId=t.threadId,this.inReplyToCommentId=t.inReplyToCommentId,this.createdAt=new Date(t.createdAt.toString()),this.updatedAt=new Date(t.updatedAt.toString()),this.automaticTags=t.automaticTags,this.video={id:t.video.id,uuid:t.video.uuid,name:t.video.name,localUrl:L.buildWatchUrl(t.video)},this.localUrl=this.video.localUrl+";threadId="+this.threadId,this.account=t.account,this.account&&(this.by=w.CREATE_BY_STRING(this.account.name,this.account.host),this.account.localUrl="/a/"+this.by)}};var i=class i{authHttp=R(g);restExtractor=R(T);restService=R(F);addCommentThread(t,e,r){let o=E.buildVideoPasswordHeader(r),a=i.BASE_VIDEO_URL+t+"/comment-threads",s=C(e,"text");return this.authHttp.post(a,s,{headers:o}).pipe(h(d=>this.extractVideoComment(d.comment)),n(d=>this.restExtractor.handleError(d)))}addCommentReply(t){let{videoId:e,inReplyToCommentId:r,comment:o,videoPassword:a}=t,s=E.buildVideoPasswordHeader(a),d=i.BASE_VIDEO_URL+e+"/comments/"+r,p=C(o,"text");return this.authHttp.post(d,p,{headers:s}).pipe(h(u=>this.extractVideoComment(u.comment)),n(u=>this.restExtractor.handleError(u)))}approveComments(t){return S(t).pipe(I(({videoId:e,commentId:r})=>{let o=i.BASE_VIDEO_URL+e+"/comments/"+r+"/approve";return this.authHttp.post(o,{}).pipe(n(a=>this.restExtractor.handleError(a)))}),x())}listVideoCommentsOfMyVideos(t){let{pagination:e,sort:r,search:o}=t,a=i.BASE_ME_URL+"videos/comments",s=new f;return s=this.restService.addRestGetParams(s,e,r),o&&(s=this.buildParamsFromSearch(o,s)),this.authHttp.get(a,{params:s}).pipe(n(d=>this.restExtractor.handleError(d)))}listAdminVideoComments(t){let{pagination:e,sort:r,search:o}=t,a=i.BASE_VIDEO_URL+"comments",s=new f;return s=this.restService.addRestGetParams(s,e,r),o&&(s=this.buildParamsFromSearch(o,s)),this.authHttp.get(a,{params:s}).pipe(n(d=>this.restExtractor.handleError(d)))}getVideoCommentThreads(t){let{videoId:e,videoPassword:r,componentPagination:o,sort:a}=t,s=E.buildVideoPasswordHeader(r),d=this.restService.componentToRestPagination(o),p=new f;p=this.restService.addRestGetParams(p,d,a);let u=i.BASE_VIDEO_URL+e+"/comment-threads";return this.authHttp.get(u,{params:p,headers:s}).pipe(h(v=>this.extractVideoComments(v)),n(v=>this.restExtractor.handleError(v)))}getVideoThreadComments(t){let{videoId:e,threadId:r,videoPassword:o}=t,a=`${i.BASE_VIDEO_URL+e}/comment-threads/${r}`,s=E.buildVideoPasswordHeader(o);return this.authHttp.get(a,{headers:s}).pipe(h(d=>this.extractVideoCommentTree(d)),n(d=>this.restExtractor.handleError(d)))}deleteVideoComment(t,e){let r=`${i.BASE_VIDEO_URL+t}/comments/${e}`;return this.authHttp.delete(r).pipe(n(o=>this.restExtractor.handleError(o)))}deleteVideoComments(t){return S(t).pipe(I(e=>this.deleteVideoComment(e.videoId,e.commentId)),x())}getVideoCommentsFeeds(t){let e=[{format:c.RSS,label:"rss 2.0",url:i.BASE_FEEDS_URL+c.RSS.toLowerCase()},{format:c.ATOM,label:"atom 1.0",url:i.BASE_FEEDS_URL+c.ATOM.toLowerCase()},{format:c.JSON,label:"json 1.0",url:i.BASE_FEEDS_URL+c.JSON.toLowerCase()}];if(t!==void 0)for(let r of e)r.url+="?videoId="+t.uuid;return e}extractVideoComment(t){return new l(t)}extractVideoComments(t){let e=t.data,r=t.total,o=[];for(let a of e)o.push(new l(a));return{data:o,total:r,totalNotDeletedComments:t.totalNotDeletedComments}}extractVideoCommentTree(t){if(!t)return null;let e={comment:new l(t.comment),children:t.children.map(o=>this.extractVideoCommentTree(o))},r=e.children.length===0?!e.comment.isDeleted:e.children.some(o=>o.hasDisplayedChildren);return Object.assign(e,{hasDisplayedChildren:r})}buildParamsFromSearch(t,e){let r=this.restService.parseQueryStringFilter(t,{isLocal:{prefix:"local:",isBoolean:!0},onLocalVideo:{prefix:"localVideo:",isBoolean:!0},isHeldForReview:{prefix:"heldForReview:",isBoolean:!0},autoTagOneOf:{prefix:"autoTag:",multiple:!0},searchAccount:{prefix:"account:"},searchVideo:{prefix:"video:"}});return this.restService.addObjectParams(e,r)}};m(i,"BASE_FEEDS_URL",A.apiUrl+"/feeds/video-comments."),m(i,"BASE_VIDEO_URL",A.apiUrl+"/api/v1/videos/"),m(i,"BASE_ME_URL",A.apiUrl+"/api/v1/users/me/"),m(i,"\u0275fac",function(e){return new(e||i)}),m(i,"\u0275prov",V({token:i,factory:i.\u0275fac}));var b=i;export{l as a,U as b,b as c};
/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*/
//# sourceMappingURL=chunk-SS3SQE34.js.map
