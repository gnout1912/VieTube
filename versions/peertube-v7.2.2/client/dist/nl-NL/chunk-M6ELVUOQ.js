import{a as ce}from"./chunk-2RZHLGS2.js";import{b as me}from"./chunk-5PLTSPIA.js";import{a as _e}from"./chunk-MLUQ7CKS.js";import{b as le,c as de}from"./chunk-25AA3I7H.js";import{b as pe}from"./chunk-WZVFW7AN.js";import{B as ie,C as ne,c as Z,g as q,h as J,m as K,n as Q,q as ee,t as te}from"./chunk-WO4VNXA3.js";import{a as re}from"./chunk-PE7TFI7A.js";import{$f as ye,Bb as P,Bc as W,Cb as p,Cc as U,Dc as j,E as k,Ha as s,Ob as D,Pb as w,Rb as V,Sa as H,Ub as O,Vb as E,Vd as oe,Wa as G,Wb as M,Xf as ae,Ya as f,Zb as A,aa as C,c as R,eb as r,ga as $,ha as u,ia as y,la as F,lg as se,nb as d,nc as X,ne as N,ob as a,pb as T,qb as B,rb as z,sa as Y,ta as I,tb as v,x as L,xb as S}from"./chunk-F7FAPFPY.js";import{g as ue,i as x}from"./chunk-AI7IVZV2.js";var ge=ue(ye());var Pe=l=>({"has-optional-row":l}),he=l=>({invisible:l}),Ce=l=>({"input-error":l});function fe(l,_){if(l&1){let n=v();B(0),d(1,"my-peertube-checkbox",27),P("click",function(e){let i=u(n).$implicit,o=D(3),m=D(5),g=p(2).$implicit,h=p();return y(h.toggleOptionalPlaylist(e,g,i,o.timestamp(),m.timestamp()));}),a(),d(2,"my-timestamp-input",28,0),M("ngModelChange",function(e){let i=u(n).$implicit;return E(i.startTimestamp,e)||(i.startTimestamp=e),y(e);}),P("inputBlur",function(){let e=u(n).$implicit,i=p(2).$implicit,o=p();return y(o.onElementTimestampUpdate(i,e));}),a(),d(4,"my-timestamp-input",29,1),M("ngModelChange",function(e){let i=u(n).$implicit;return E(i.stopTimestamp,e)||(i.stopTimestamp=e),y(e);}),P("inputBlur",function(){let e=u(n).$implicit,i=p(2).$implicit,o=p();return y(o.onElementTimestampUpdate(i,e));}),a(),z();}if(l&2){let n=_.$implicit,t=p(2).$implicit,e=p();s(),r("inputName",e.getOptionalInputName(t,n))("ngModel",n.enabled),s(),r("maxTimestamp",e.video().duration),O("ngModel",n.startTimestamp),s(2),r("maxTimestamp",e.video().duration),O("ngModel",n.stopTimestamp);}}function Te(l,_){if(l&1&&(d(0,"div",24)(1,"div",25),S(2,4),a(),d(3,"div",25),S(4,5),a(),f(5,fe,6,6,"ng-container",26),a()),l&2){let n=p().$implicit,t=p();s(5),r("ngForOf",t.buildOptionalRowElements(n));}}function Se(l,_){if(l&1){let n=v();d(0,"div",18)(1,"button",19),P("click",function(e){let i=u(n).$implicit,o=p();return y(o.toggleMainPlaylist(e,i));}),T(2,"my-peertube-checkbox",20),d(3,"label",21),w(4),a(),d(5,"button",22),P("click",function(e){let i=u(n).$implicit,o=p();return e.stopPropagation(),y(o.toggleOptionalRow(i));}),T(6,"my-global-icon",16),a()(),f(7,Te,6,1,"div",23),a();}if(l&2){let n=_.$implicit,t=p();r("ngClass",A(8,Pe,n.optionalRowDisplayed)),s(2),r("disabled",t.isPresentMultipleTimes(n)||n.optionalRowDisplayed)("inputName",t.getPrimaryInputName(n))("ngModel",t.isPrimaryCheckboxChecked(n)),s(),r("for",t.getPrimaryInputName(n)),s(),V(" ",n.displayName," "),s(),r("ngClass",A(10,he,!t.isPrimaryCheckboxChecked(n))),s(2),r("ngIf",n.optionalRowDisplayed);}}function ve(l,_){if(l&1&&(d(0,"div",36),w(1),a()),l&2){let n=p(2);s(),V(" ",n.formErrors.displayName," ");}}function Oe(l,_){if(l&1){let n=v();d(0,"form",30),P("ngSubmit",function(){u(n);let e=p();return y(e.createPlaylist());}),d(1,"div",31)(2,"label",32),S(3,6),a(),T(4,"input",33),f(5,ve,2,1,"div",34),a(),T(6,"input",35),a();}if(l&2){let n=p();r("formGroup",n.form),s(4),r("ngClass",A(4,Ce,n.formErrors.displayName)),s(),r("ngIf",n.formErrors.displayName),s(),r("disabled",!n.form.valid);}}var b=(0,ge.default)("peertube:playlists:VideoAddToPlaylistComponent"),ze=(()=>{let _=class _ extends de{formReactiveService=C(le);authService=C(se);notifier=C(ae);videoPlaylistService=C(me);cd=C(X);video=I(void 0);currentVideoTimestamp=I(void 0);videoExistsInPlaylistChange=Y();isNewPlaylistBlockOpened=!1;videoPlaylistSearch;videoPlaylistSearchChanged=new R();videoPlaylists=[];disabled=!1;listenToPlaylistChangeSub;playlistsData=[];pendingAddId;get user(){return this.authService.getUser();}ngOnInit(){this.buildForm({displayName:ce}),this.videoPlaylistService.listenToMyAccountPlaylistsChange().subscribe(t=>{this.playlistsData=t.data,this.videoPlaylistService.runVideoExistsInPlaylistCheck(this.video().id);}),this.videoPlaylistSearchChanged.pipe(k(500)).subscribe(()=>this.load());}ngOnChanges(t){t.video&&this.reload();}ngOnDestroy(){this.unsubscribePlaylistChanges();}disableForReuse(){this.disabled=!0;}enabledForReuse(){this.disabled=!1;}reload(){b("Reloading component"),this.videoPlaylists=[],this.videoPlaylistSearch=void 0,this.load(),this.cd.markForCheck();}load(){b("Loading component"),this.listenToVideoPlaylistChange(),this.videoPlaylistService.listMyPlaylistWithCache(this.user,this.videoPlaylistSearch).subscribe(t=>{this.playlistsData=t.data,this.videoPlaylistService.runVideoExistsInPlaylistCheck(this.video().id);});}openCreateBlock(t){t.preventDefault(),this.isNewPlaylistBlockOpened=!0;}toggleMainPlaylist(t,e){if(t.preventDefault(),!(this.isPresentMultipleTimes(e)||e.optionalRowDisplayed)){if(e.elements.length===0){let i={enabled:!0,playlistElementId:void 0,startTimestamp:0,stopTimestamp:this.video().duration};this.addVideoInPlaylist(e,i);}else this.removeVideoFromPlaylist(e,e.elements[0].playlistElementId),e.elements=[];this.cd.markForCheck();}}toggleOptionalPlaylist(t,e,i,o,m){if(t.preventDefault(),i.enabled)this.removeVideoFromPlaylist(e,i.playlistElementId),i.enabled=!1,this.isPrimaryCheckboxChecked(e)===!1&&(e.optionalRowDisplayed=!1);else{let g={enabled:!0,playlistElementId:void 0,startTimestamp:o,stopTimestamp:m};this.addVideoInPlaylist(e,g);}this.cd.markForCheck();}createPlaylist(){let e={displayName:this.form.value.displayName,privacy:oe.PRIVATE};this.videoPlaylistService.createVideoPlaylist(e).subscribe({next:()=>{this.isNewPlaylistBlockOpened=!1,this.cd.markForCheck();},error:i=>this.notifier.error(i.message)});}onVideoPlaylistSearchChanged(){this.videoPlaylistSearchChanged.next();}isPrimaryCheckboxChecked(t){return this.pendingAddId===t.id||t.elements.filter(e=>e.enabled).length!==0;}toggleOptionalRow(t){t.optionalRowDisplayed=!t.optionalRowDisplayed,this.cd.markForCheck();}getPrimaryInputName(t){return"in-playlist-primary-"+t.id;}getOptionalInputName(t,e){let i=e?"-"+e.playlistElementId:"";return"in-playlist-optional-"+t.id+i;}buildOptionalRowElements(t){let e=t.elements,i=e.length===0?void 0:e[e.length-1];return(!i||i.enabled===!0)&&e.push({enabled:!1,startTimestamp:0,stopTimestamp:this.video().duration}),e;}isPresentMultipleTimes(t){return t.elements.filter(e=>e.enabled===!0).length>1;}onElementTimestampUpdate(t,e){if(!e.playlistElementId||e.enabled===!1)return;let i={startTimestamp:e.startTimestamp,stopTimestamp:e.stopTimestamp};this.videoPlaylistService.updateVideoOfPlaylist(t.id,e.playlistElementId,i,this.video().id).subscribe({next:()=>{this.notifier.success("Tijdstempels bijgewerkt"),this.videoExistsInPlaylistChange.emit();},error:o=>this.notifier.error(o.message),complete:()=>this.cd.markForCheck()});}isOptionalRowDisplayed(t){let e=t.elements.filter(i=>i.enabled);if(e.length>1)return!0;if(e.length===1){let i=e[0];if(i.startTimestamp&&i.startTimestamp!==0||i.stopTimestamp&&i.stopTimestamp!==this.video().duration)return!0;}return!1;}removeVideoFromPlaylist(t,e){this.videoPlaylistService.removeVideoFromPlaylist(t.id,e,this.video().id).subscribe({next:()=>{this.notifier.success("Video verwijderd van\n          "+t.displayName+"\n        "),this.videoExistsInPlaylistChange.emit();},error:i=>this.notifier.error(i.message),complete:()=>this.cd.markForCheck()});}listenToVideoPlaylistChange(){this.unsubscribePlaylistChanges(),this.listenToPlaylistChangeSub=this.videoPlaylistService.listenToVideoPlaylistChange(this.video().id).pipe(L(()=>this.disabled===!1)).subscribe(t=>this.rebuildPlaylists(t));}unsubscribePlaylistChanges(){this.listenToPlaylistChangeSub&&(this.listenToPlaylistChangeSub.unsubscribe(),this.listenToPlaylistChangeSub=void 0);}rebuildPlaylists(t){let e=this.video();b("Got existing results for %d.",e.id,t);let i=this.videoPlaylists;this.videoPlaylists=[];for(let o of this.playlistsData){let m=t.filter(c=>c.playlistId===o.id),g={id:o.id,optionalRowDisplayed:!1,displayName:o.displayName,elements:m.map(c=>({enabled:!0,playlistElementId:c.playlistElementId,startTimestamp:c.startTimestamp||0,stopTimestamp:c.stopTimestamp||this.video().duration}))},h=i.find(c=>c.id===o.id);g.optionalRowDisplayed=h?h.optionalRowDisplayed:this.isOptionalRowDisplayed(g),this.videoPlaylists.push(g);}b("Rebuilt playlist state for video %d.",e.id,this.videoPlaylists),this.cd.markForCheck();}addVideoInPlaylist(t,e){let i={videoId:this.video().id};e.startTimestamp&&(i.startTimestamp=e.startTimestamp),e.stopTimestamp&&e.stopTimestamp!==this.video().duration&&(i.stopTimestamp=e.stopTimestamp),this.pendingAddId=t.id,this.videoPlaylistService.addVideoInPlaylist(t.id,i).subscribe({next:o=>{let m=i.startTimestamp||i.stopTimestamp?"Video toegevoegd in "+t.displayName+" op tijdstempels "+this.formatTimestamp(e)+"":"Video toegevoegd in\n          "+t.displayName+"\n        ";this.notifier.success(m),e&&(e.playlistElementId=o.videoPlaylistElement.id),this.videoExistsInPlaylistChange.emit();},error:o=>{this.pendingAddId=void 0,this.cd.markForCheck(),this.notifier.error(o.message);},complete:()=>{this.pendingAddId=void 0,this.cd.markForCheck();}});}formatTimestamp(t){let e=t.startTimestamp?N(t.startTimestamp):"",i=t.stopTimestamp?N(t.stopTimestamp):"";return`(${e}-${i})`;}};x(_,"\u0275fac",(()=>{let t;return function(i){return(t||(t=F(_)))(i||_);};})()),x(_,"\u0275cmp",H({type:_,selectors:[["my-video-add-to-playlist"]],inputs:{video:[1,"video"],currentVideoTimestamp:[1,"currentVideoTimestamp"]},outputs:{videoExistsInPlaylistChange:"videoExistsInPlaylistChange"},features:[G,$],decls:14,vars:4,consts:()=>{let t;t="Afspeellijsten doorzoeken";let e;e="Opslaan in";let i;i="Een priv\xE9-afspeellijst aanmaken";let o;o="Beginnen bij";let m;m="Stoppen bij";let g;g="Aanmaken";let h;return h="Weergavenaam",[["startAt",""],["stopAt",""],e,i,o,m,h,[1,"root"],[1,"header"],[1,"first-row"],[1,"title"],[1,"input-container"],["type","text","placeholder",t,3,"ngModelChange","ngModel"],[1,"playlists"],["class","playlist dropdown-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"new-playlist-button","dropdown-item",3,"click","hidden"],["iconName","add","aria-hidden","true"],["class","new-playlist-block",3,"formGroup","ngSubmit",4,"ngIf"],[1,"playlist","dropdown-item",3,"ngClass"],[1,"primary-row","button-unstyle",3,"click"],[3,"disabled","inputName","ngModel"],[1,"display-name",3,"for"],[1,"optional-row-icon","button-unstyle",3,"click","ngClass"],["class","optional-rows",4,"ngIf"],[1,"optional-rows"],[1,"header-label"],[4,"ngFor","ngForOf"],[3,"click","inputName","ngModel"],[1,"me-2",3,"ngModelChange","inputBlur","maxTimestamp","ngModel"],[3,"ngModelChange","inputBlur","maxTimestamp","ngModel"],[1,"new-playlist-block",3,"ngSubmit","formGroup"],[1,"form-group"],["for","displayName"],["type","text","id","displayName","formControlName","displayName",1,"form-control",3,"ngClass"],["class","form-error","role","alert",4,"ngIf"],["type","submit","value",g,1,"peertube-button","primary-button",3,"disabled"],["role","alert",1,"form-error"]];},template:function(e,i){e&1&&(d(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10),S(4,2),a()()(),d(5,"div",11)(6,"input",12),M("ngModelChange",function(m){return E(i.videoPlaylistSearch,m)||(i.videoPlaylistSearch=m),m;}),P("ngModelChange",function(){return i.onVideoPlaylistSearchChanged();}),a()(),d(7,"div",13),f(8,Se,8,12,"div",14),a(),d(9,"button",15),P("click",function(m){return i.openCreateBlock(m);}),T(10,"my-global-icon",16),d(11,"span"),S(12,3),a()(),f(13,Oe,7,6,"form",17),a()),e&2&&(s(6),O("ngModel",i.videoPlaylistSearch),s(2),r("ngForOf",i.videoPlaylists),s(),r("hidden",i.isNewPlaylistBlockOpened),s(4),r("ngIf",i.isNewPlaylistBlockOpened));},dependencies:[ie,Q,Z,q,J,K,U,W,pe,re,j,_e,ne,ee,te],styles:[`my-timestamp-input[_ngcontent-%COMP%]{width:100px}.header[_ngcontent-%COMP%], .dropdown-item[_ngcontent-%COMP%], .input-container[_ngcontent-%COMP%], .new-playlist-block[_ngcontent-%COMP%]{padding:8px 24px}.dropdown-item[_ngcontent-%COMP%]:active{color:inherit}.header[_ngcontent-%COMP%]{min-width:240px;margin-bottom:10px;border-bottom:1px solid var(--bg-secondary-400)}.header[_ngcontent-%COMP%]   .first-row[_ngcontent-%COMP%]{display:flex;align-items:center}.header[_ngcontent-%COMP%]   .first-row[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:18px;flex-grow:1}.playlists[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto}.playlist[_ngcontent-%COMP%]{padding:0}.playlist[_ngcontent-%COMP%] > .primary-row[_ngcontent-%COMP%]{padding:8px 10px 8px 24px}.playlist[_ngcontent-%COMP%] > .optional-rows[_ngcontent-%COMP%]{padding-inline-start:calc(1.275rem + .3vw)}@media (min-width: 1200px){.playlist[_ngcontent-%COMP%] > .optional-rows[_ngcontent-%COMP%]{padding-inline-start:1.5rem}}.playlist.has-optional-row[_ngcontent-%COMP%]:hover{background-color:inherit}.primary-row[_ngcontent-%COMP%]{display:flex;width:100%}.primary-row[_ngcontent-%COMP%]   my-peertube-checkbox[_ngcontent-%COMP%]{align-self:center;margin-inline-end:.625rem}.primary-row[_ngcontent-%COMP%]   .display-name[_ngcontent-%COMP%]{display:flex;align-items:flex-end;flex-grow:1;margin:0;font-weight:400;cursor:pointer;font-size:1rem}.primary-row[_ngcontent-%COMP%]   .optional-row-icon[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:14px;cursor:pointer;margin-inline-start:.5rem}.primary-row[_ngcontent-%COMP%]   .optional-row-icon[_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%]{position:relative;top:1px;width:19px;height:19px;color:var(--fg-400);margin-inline-end:0}.primary-row[_ngcontent-%COMP%]   .optional-row-icon[_ngcontent-%COMP%]:hover{opacity:.8}.optional-rows[_ngcontent-%COMP%]{display:grid;grid-template-columns:35px 105px 105px;row-gap:3px;column-gap:10px;align-items:center}.optional-rows[_ngcontent-%COMP%]   my-peertube-checkbox[_ngcontent-%COMP%]{margin-inline-start:auto}.optional-rows[_ngcontent-%COMP%]   .header-label[_ngcontent-%COMP%]{font-size:13px;color:var(--fg-300);padding-left:2px}.optional-rows[_ngcontent-%COMP%]   .header-label[_ngcontent-%COMP%]:nth-child(1){grid-column:2}.optional-rows[_ngcontent-%COMP%]   .header-label[_ngcontent-%COMP%]:nth-child(2){grid-column:3}.new-playlist-button[_ngcontent-%COMP%], .new-playlist-block[_ngcontent-%COMP%]{padding-top:10px;border-top:1px solid var(--bg-secondary-400)}.new-playlist-button[_ngcontent-%COMP%]{cursor:pointer}.new-playlist-button[_ngcontent-%COMP%]   my-global-icon[_ngcontent-%COMP%]{position:relative;left:-1px;top:-1px;width:21px;height:21px;line-height:21px;display:inline-block;color:var(--fg-400);margin-inline-end:.8125rem}input[type=text][_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) var(--input-x-padding);width:200px;max-width:200px;color:var(--input-fg);background-color:var(--input-bg);border:1px solid var(--input-border-color);border-radius:var(--input-border-radius);line-height:24px}input[type=text][_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder);font-size:14px}input[type=text][readonly][_ngcontent-%COMP%]{color:var(--fg-300)}input[type=text][_ngcontent-%COMP%]:focus, input[type=text][_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100);outline:0}input[type=text][disabled][_ngcontent-%COMP%]{color:var(--fg-300);opacity:.8}@media screen and (max-width: 240px){input[type=text][_ngcontent-%COMP%]{width:100%}}
/*# sourceMappingURL=video-add-to-playlist.component-Z72DBBRM.css.map */`],changeDetection:0}));let l=_;return l;})();export{ze as a};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-M6ELVUOQ.js.map