import{a as Ue,b as ht,c as Qp,j as mt,k as Jp,l as Zp,m as eg}from"./chunk-AI7IVZV2.js";var nE=Object.defineProperty,aE=(r,e,t)=>e in r?nE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Qe=(r,e,t)=>aE(r,typeof e!="symbol"?e+"":e,t),oE={"filter:api.trending-videos.videos.list.params":!0,"filter:api.trending-videos.videos.list.result":!0,"filter:api.most-liked-videos.videos.list.params":!0,"filter:api.most-liked-videos.videos.list.result":!0,"filter:api.local-videos.videos.list.params":!0,"filter:api.local-videos.videos.list.result":!0,"filter:api.recently-added-videos.videos.list.params":!0,"filter:api.recently-added-videos.videos.list.result":!0,"filter:api.browse-videos.videos.list.params":!0,"filter:api.browse-videos.videos.list.result":!0,"filter:api.user-subscriptions-videos.videos.list.params":!0,"filter:api.user-subscriptions-videos.videos.list.result":!0,"filter:api.video-watch.video.get.params":!0,"filter:api.video-watch.video.get.result":!0,"filter:api.video-watch.video-playlist-elements.get.params":!0,"filter:api.video-watch.video-playlist-elements.get.result":!0,"filter:api.video-watch.video-threads.list.params":!0,"filter:api.video-watch.video-threads.list.result":!0,"filter:api.video-watch.video-thread-replies.list.params":!0,"filter:api.video-watch.video-thread-replies.list.result":!0,"filter:api.search.videos.list.params":!0,"filter:api.search.videos.list.result":!0,"filter:api.search.video-channels.list.params":!0,"filter:api.search.video-channels.list.result":!0,"filter:api.search.video-playlists.list.params":!0,"filter:api.search.video-playlists.list.result":!0,"filter:api.signup.registration.create.params":!0,"filter:api.my-library.video-playlist-elements.list.params":!0,"filter:api.my-library.video-playlist-elements.list.result":!0,"filter:internal.video-watch.player.build-options.params":!0,"filter:internal.video-watch.player.build-options.result":!0,"filter:internal.video-watch.player.load-options.params":!0,"filter:internal.video-watch.player.load-options.result":!0,"filter:internal.common.svg-icons.get-content.params":!0,"filter:internal.common.svg-icons.get-content.result":!0,"filter:left-menu.links.create.result":!0,"filter:upload.messages.create.result":!0,"filter:login.instance-about-plugin-panels.create.result":!0,"filter:signup.instance-about-plugin-panels.create.result":!0,"filter:share.video-embed-code.build.params":!0,"filter:share.video-embed-code.build.result":!0,"filter:share.video-playlist-embed-code.build.params":!0,"filter:share.video-playlist-embed-code.build.result":!0,"filter:share.video-embed-url.build.params":!0,"filter:share.video-embed-url.build.result":!0,"filter:share.video-playlist-embed-url.build.params":!0,"filter:share.video-playlist-embed-url.build.result":!0,"filter:share.video-url.build.params":!0,"filter:share.video-url.build.result":!0,"filter:share.video-playlist-url.build.params":!0,"filter:share.video-playlist-url.build.result":!0,"filter:video-watch.video-plugin-metadata.result":!0,"filter:internal.player.videojs.options.result":!0,"filter:internal.player.p2p-media-loader.options.result":!0,"filter:admin-users-list.bulk-actions.create.result":!0,"filter:admin-video-comments-list.actions.create.result":!0,"filter:admin-video-comments-list.bulk-actions.create.result":!0,"filter:user-moderation.actions.create.result":!0,"filter:admin-abuse-list.actions.create.result":!0},lE={"action:application.init":!0,"action:video-watch.init":!0,"action:video-watch.video.loaded":!0,"action:video-watch.player.loaded":!0,"action:video-watch.video-threads.loaded":!0,"action:video-watch.video-thread-replies.loaded":!0,"action:video-channel-create.init":!0,"action:video-channel-update.init":!0,"action:video-channel-update.video-channel.loaded":!0,"action:video-channel-videos.init":!0,"action:video-channel-videos.video-channel.loaded":!0,"action:video-channel-videos.videos.loaded":!0,"action:video-channel-playlists.init":!0,"action:video-channel-playlists.video-channel.loaded":!0,"action:video-channel-playlists.playlists.loaded":!0,"action:video-edit.init":!0,"action:video-edit.form.updated":!0,"action:login.init":!0,"action:search.init":!0,"action:router.navigation-end":!0,"action:signup.register.init":!0,"action:admin-plugin-settings.init":!0,"action:video-upload.init":!0,"action:video-url-import.init":!0,"action:video-torrent-import.init":!0,"action:go-live.init":!0,"action:auth-user.logged-in":!0,"action:auth-user.logged-out":!0,"action:auth-user.information-loaded":!0,"action:modal.video-download.shown":!0,"action:modal.share.shown":!0,"action:embed.player.loaded":!0};Object.assign({},oE,lE);var uE={"filter:api.videos.list.params":!0,"filter:api.videos.list.result":!0,"filter:api.video-playlist.videos.list.params":!0,"filter:api.video-playlist.videos.list.result":!0,"filter:api.accounts.videos.list.params":!0,"filter:api.accounts.videos.list.result":!0,"filter:api.video-channels.videos.list.params":!0,"filter:api.video-channels.videos.list.result":!0,"filter:api.user.me.videos.list.params":!0,"filter:api.user.me.videos.list.result":!0,"filter:api.overviews.videos.list.params":!0,"filter:api.overviews.videos.list.result":!0,"filter:api.user.me.subscription-videos.list.params":!0,"filter:api.user.me.subscription-videos.list.result":!0,"filter:api.search.videos.local.list.params":!0,"filter:api.search.videos.local.list.result":!0,"filter:api.search.videos.index.list.params":!0,"filter:api.search.videos.index.list.result":!0,"filter:api.search.video-channels.local.list.params":!0,"filter:api.search.video-channels.local.list.result":!0,"filter:api.search.video-channels.index.list.params":!0,"filter:api.search.video-channels.index.list.result":!0,"filter:api.search.video-playlists.local.list.params":!0,"filter:api.search.video-playlists.local.list.result":!0,"filter:api.search.video-playlists.index.list.params":!0,"filter:api.search.video-playlists.index.list.result":!0,"filter:api.video.get.result":!0,"filter:api.video-channels.list.params":!0,"filter:api.video-channels.list.result":!0,"filter:api.video-channel.get.result":!0,"filter:api.video.upload.accept.result":!0,"filter:api.live-video.create.accept.result":!0,"filter:api.video.pre-import-url.accept.result":!0,"filter:api.video.pre-import-torrent.accept.result":!0,"filter:api.video.post-import-url.accept.result":!0,"filter:api.video.post-import-torrent.accept.result":!0,"filter:api.video.update-file.accept.result":!0,"filter:api.video.user-import.accept.result":!0,"filter:api.video-thread.create.accept.result":!0,"filter:api.video-comment-reply.create.accept.result":!0,"filter:api.video.upload.video-attribute.result":!0,"filter:api.video.import-url.video-attribute.result":!0,"filter:api.video.import-torrent.video-attribute.result":!0,"filter:api.video.live.video-attribute.result":!0,"filter:api.video.user-import.video-attribute.result":!0,"filter:api.video-threads.list.params":!0,"filter:api.video-threads.list.result":!0,"filter:api.video-thread-comments.list.params":!0,"filter:api.video-thread-comments.list.result":!0,"filter:api.server.stats.get.result":!0,"filter:video.auto-blacklist.result":!0,"filter:api.user.signup.allowed.result":!0,"filter:api.user.request-signup.allowed.result":!0,"filter:api.download.video.allowed.result":!0,"filter:api.download.generated-video.allowed.result":!0,"filter:api.download.torrent.allowed.result":!0,"filter:html.embed.video.allowed.result":!0,"filter:html.embed.video-playlist.allowed.result":!0,"filter:html.client.json-ld.result":!0,"filter:job-queue.process.params":!0,"filter:job-queue.process.result":!0,"filter:transcoding.manual.resolutions-to-transcode.result":!0,"filter:transcoding.auto.resolutions-to-transcode.result":!0,"filter:activity-pub.remote-video-comment.create.accept.result":!0,"filter:activity-pub.activity.context.build.result":!0,"filter:activity-pub.video.json-ld.build.result":!0,"filter:feed.podcast.rss.create-custom-xmlns.result":!0,"filter:feed.podcast.channel.create-custom-tags.result":!0,"filter:feed.podcast.video.create-custom-tags.result":!0,"filter:api.user.me.get.result":!0,"filter:oauth.password-grant.get-user.params":!0,"filter:api.email-verification.ask-send-verify-email.body":!0,"filter:api.users.ask-reset-password.body":!0,"filter:email.subject.result":!0,"filter:email.template-path.result":!0},hE={"action:application.listening":!0,"action:notifier.notification.created":!0,"action:api.video.updated":!0,"action:api.video.deleted":!0,"action:api.video.uploaded":!0,"action:api.video.viewed":!0,"action:api.video.file-updated":!0,"action:api.video-channel.created":!0,"action:api.video-channel.updated":!0,"action:api.video-channel.deleted":!0,"action:api.live-video.created":!0,"action:live.video.state.updated":!0,"action:api.video-thread.created":!0,"action:api.video-comment-reply.created":!0,"action:api.video-comment.deleted":!0,"action:api.video-caption.created":!0,"action:api.video-caption.deleted":!0,"action:api.user.blocked":!0,"action:api.user.unblocked":!0,"action:api.user.registered":!0,"action:api.user.requested-registration":!0,"action:api.user.created":!0,"action:api.user.deleted":!0,"action:api.user.updated":!0,"action:api.user.oauth2-got-token":!0,"action:api.video-playlist-element.created":!0,"action:activity-pub.remote-video.created":!0,"action:activity-pub.remote-video.updated":!0};Object.assign({},uE,hE);var qa={HIGH_LATENCY:2,SMALL_LATENCY:3},Ht={H_NOVIDEO:0,H_144P:144,H_240P:240,H_360P:360,H_480P:480,H_720P:720,H_1080P:1080,H_1440P:1440,H_4K:2160},Wa={VIOLENT:1,EXPLICIT_SEX:2};function _o(r){if(!r)return 0;if(typeof r=="number")return Math.floor(r);let e=new RegExp("^((?<hours>\\d+)h)?((?<minutes>\\d+)m)?((?<seconds>\\d+)s?)?$"),t=r.match(e);if(t){let a=parseInt(t.groups.hours||"0",10),l=parseInt(t.groups.minutes||"0",10),c=parseInt(t.groups.seconds||"0",10);return a*3600+l*60+c}let i=r.split(":").reverse(),s={0:1,1:60,2:3600},n=0;for(let a=0;a<i.length;a++){let l=parseInt(i[a],10);if(isNaN(l))return 0;n+=s[a]*l}return n}function Ms(r){var e;let t,i="short",s;typeof r=="number"?t=r:(t=r.seconds,i=(e=r.format)!==null&&e!==void 0?e:"short",s=r.symbol);let n="";if(t===0&&i!=="full")return"0s";let a=m=>i==="locale-string"?m.toLocaleString():m,l=s||"h",c=s||"m",h=i==="full"?"":"s",f=Math.floor(t/3600);f>=1&&f<10&&i==="full"?n="0"+f+l:f>=1?n=a(f)+l:i==="full"&&(n="00"+l),t%=3600;let p=Math.floor(t/60);return p>=1&&p<10&&i==="full"?n+="0"+p+c:p>=1?n+=a(p)+c:i==="full"&&(n+="00"+c),t=Math.round(t)%60,t>=1&&t<10&&i==="full"?n+="0"+t+h:t>=1?n+=a(t)+h:i==="full"&&(n+="00"),n}function ku(r,e){let t={};for(let i of e)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t}function tg(r,e){let t={},i=new Set(e);for(let[s,n]of Object.entries(r))i.has(s)||(t[s]=n);return t}function Bv(r,e){let t=new URL(r);for(let i of Object.keys(e))t.searchParams.append(i,e[i]);return t.toString()}function cE(r){let e=new URL(r);return e.searchParams.forEach((t,i)=>e.searchParams.delete(i)),e.toString()}function dE(r){return"/w/"+r.shortUUID}function Wh(r,e){return window.location.origin+dE(r)}function Uv(r){let{url:e}=r,t=new URLSearchParams;if(r.startTime!==void 0&&r.startTime!==null){let i=Math.floor(r.startTime);t.set("start",Ms(i))}if(r.stopTime){let i=Math.floor(r.stopTime);t.set("stop",Ms(i))}return r.subtitle&&t.set("subtitle",r.subtitle),r.loop===!0&&t.set("loop","1"),r.autoplay===!0&&t.set("autoplay","1"),r.muted===!0&&t.set("muted","1"),r.title===!1&&t.set("title","0"),r.warningTitle===!1&&t.set("warningTitle","0"),r.controls===!1&&t.set("controls","0"),r.controlBar===!1&&t.set("controlBar","0"),r.peertubeLink===!1&&t.set("peertubeLink","0"),r.p2p!==void 0&&t.set("p2p",r.p2p?"1":"0"),r.api!==void 0&&t.set("api",r.api?"1":"0"),r.version!==void 0&&t.set("v",r.version+""),fE(e,t)}function fE(r,e){let t=!1;return e.forEach(()=>{t=!0}),t?r+"?"+e.toString():r}var pE={"en-US":"English",ar:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629","ca-ES":"Catal\xE0","cs-CZ":"\u010Ce\u0161tina","de-DE":"Deutsch","el-GR":"\u03B5\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",eo:"Esperanto","es-ES":"Espa\xF1ol","eu-ES":"Euskara","fa-IR":"\u0641\u0627\u0631\u0633\u06CC","fi-FI":"Suomi","fr-FR":"Fran\xE7ais",gd:"G\xE0idhlig","gl-ES":"Galego",hr:"Hrvatski","hu-HU":"Magyar",is:"\xCDslenska","it-IT":"Italiano","ja-JP":"\u65E5\u672C\u8A9E",kab:"Taqbaylit","nb-NO":"Norsk bokm\xE5l","nl-NL":"Nederlands",nn:"Norsk nynorsk",oc:"Occitan","pl-PL":"Polski","pt-BR":"Portugu\xEAs (Brasil)","pt-PT":"Portugu\xEAs (Portugal)","ru-RU":"P\u0443\u0441\u0441\u043A\u0438\u0439","sk-SK":"Sloven\u010Dina",sq:"Shqip","sv-SE":"Svenska","th-TH":"\u0E44\u0E17\u0E22",tok:"Toki Pona","tr-TR":"T\xFCrk\xE7e","uk-UA":"\u0443\u043A\u0440\u0430\u0457\u0301\u043D\u0441\u044C\u043A\u0430 \u043C\u043E\u0301\u0432\u0430","vi-VN":"Ti\u1EBFng Vi\u1EC7t","zh-Hans-CN":"\u7B80\u4F53\u4E2D\u6587\uFF08\u4E2D\u56FD\uFF09","zh-Hant-TW":"\u7E41\u9AD4\u4E2D\u6587\uFF08\u53F0\u7063\uFF09"},$v={"ar-001":"ar",ca:"ca-ES",cs:"cs-CZ",de:"de-DE",el:"el-GR",en:"en-US",es:"es-ES",eu:"eu-ES",fa:"fa-IR",fi:"fi-FI",fr:"fr-FR",gl:"gl-ES",hu:"hu-HU",it:"it-IT",ja:"ja-JP",nb:"nb-NO",nl:"nl-NL",pl:"pl-PL",pt:"pt-BR",ru:"ru-RU",sk:"sk-SK",sv:"sv-SE",th:"th-TH",tr:"tr-TR",uk:"uk-UA",vi:"vi-VN","zh-CN":"zh-Hans-CN","zh-Hans":"zh-Hans-CN","zh-Hant":"zh-Hant-TW","zh-TW":"zh-Hant-TW",zh:"zh-Hans-CN"},Hv=Object.keys(pE).concat(Object.keys($v));function gE(){return"en-US"}function jv(r){return Fo(r)===Fo(gE())}Hv.map(r=>"/"+r);function mE(r){return Hv.includes(r)}function Fo(r){return r&&($v[r]||r)}function vE(r){return r.includes("-")===!1?r:r.split("-")[0]}var yE=new Set([Ht.H_NOVIDEO,Ht.H_144P,Ht.H_240P,Ht.H_360P,Ht.H_480P,Ht.H_720P,Ht.H_1080P,Ht.H_1440P,Ht.H_4K]),ig={3840:Ht.H_4K,1920:Ht.H_1080P,1280:Ht.H_720P,854:Ht.H_480P,640:Ht.H_360P,426:Ht.H_240P,256:Ht.H_144P};function TE(r){let{height:e,width:t}=r;if(r.resolution===0)return"Audio only";let i=r.resolution;if(!yE.has(i)&&typeof e=="number"&&typeof t=="number"){let s=Math.max(e,t);ig[s]&&(i=ig[s])}return`${i}p`}function Vv(r,e){return e&&e>=50?r+e:r}var ws=new Map;function sg(r){return new Proxy(r,{set:function(e,t,i){return Object.prototype.hasOwnProperty.call(zn,t)?r[t]=i:r.setItem(t,i),!0},get:function(e,t){if(typeof r[t]=="function")return r[t];if(ws.has(t))return r.getItem(t)}})}var zn=class{getItem(e){let t=String(e);return ws.has(e)?String(ws.get(t)):null}setItem(e,t){ws.set(String(e),String(t))}removeItem(e){ws.delete(e)}clear(){ws.clear()}key(e){if(arguments.length===0)throw new TypeError('Failed to execute "key" on "Storage": 1 argument required, but only 0 present.');return Array.from(ws.keys())[e]}get length(){return ws.size}},fr,fa;function Gv(){let r=new zn,e=new zn;fr=sg(r),fa=sg(e)}try{fr=localStorage,fa=sessionStorage}catch{Gv()}(!fr||!fa)&&Gv();var Ji={ACCESS_TOKEN:"access_token",REFRESH_TOKEN:"refresh_token",TOKEN_TYPE:"token_type"},zh=class r{constructor(e){Qe(this,"accessToken"),Qe(this,"refreshToken"),Qe(this,"tokenType"),e&&(this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,e.tokenType==="bearer"?this.tokenType="Bearer":this.tokenType=e.tokenType)}static getUserTokens(e){let t=e.getItem(Ji.ACCESS_TOKEN),i=e.getItem(Ji.REFRESH_TOKEN),s=e.getItem(Ji.TOKEN_TYPE);return!t||!i||!s?null:new r({accessToken:t,refreshToken:i,tokenType:s})}static saveToLocalStorage(e,t){e.setItem(Ji.ACCESS_TOKEN,t.accessToken),e.setItem(Ji.REFRESH_TOKEN,t.refreshToken),e.setItem(Ji.TOKEN_TYPE,t.tokenType)}static flushLocalStorage(e){e.removeItem(Ji.ACCESS_TOKEN),e.removeItem(Ji.REFRESH_TOKEN),e.removeItem(Ji.TOKEN_TYPE)}},_E=class{constructor(){Qe(this,"hooks",[])}info(e,t){this.runHooks("info",e,t),t?console.log(e,t):console.log(e)}warn(e,t){this.runHooks("warn",e,t),this.clientWarn(e,t)}clientWarn(e,t){t?console.warn(e,t):console.warn(e)}error(e,t){this.runHooks("error",e,t),this.clientError(e,t)}clientError(e,t){t?console.error(e,t):console.error(e)}addHook(e,t){this.hooks.push({level:e,hook:t})}registerServerSending(e){this.addHook("warn",(t,i)=>this.sendClientLog(e,this.buildServerLogPayload("warn",t,i))),this.addHook("error",(t,i)=>this.sendClientLog(e,this.buildServerLogPayload("error",t,i)))}sendClientLog(e,t){if(!t)return;let i=new Headers({Accept:"application/json","Content-Type":"application/json"});try{let s=zh.getUserTokens(fr);s&&i.set("Authorization",`${s.tokenType} ${s.accessToken}`)}catch(s){console.error("Cannot set tokens to client log sender.",{err:s})}fetch(e+"/api/v1/server/logs/client",{headers:i,method:"POST",body:JSON.stringify(t)}).catch(s=>console.error("Cannot send client warn/error to server.",s))}buildServerLogPayload(e,t,i){return t?{message:this.buildMessageServerLogPayload(t),userAgent:navigator.userAgent,url:window.location.href,level:e,stackTrace:this.buildStackServerLogPayload(t,i),meta:this.buildMetaServerLogPayload(i)}:null}buildMessageServerLogPayload(e){return typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}buildStackServerLogPayload(e,t){if(e instanceof Error)return this.buildStack(e);if(t instanceof Error)return this.buildStack(t);if(t?.err instanceof Error)return this.buildStack(t.err)}buildMetaServerLogPayload(e){if(!e||e instanceof Error)return;let t;try{t=JSON.stringify(e,(i,s)=>{if(i!=="err")return s})}catch(i){console.error("Cannot stringify meta.",i)}return t}runHooks(e,t,i){for(let s of this.hooks)s.level===e&&s.hook(t,i)}buildStack(e){return`${e.message}
${e.stack||""}`}},ze=window.logger||new _E;window.logger=ze;var Kv=class Ur{static getServerTranslations(e,t){let i=Ur.getLocalePath(e,t);return i?fetch(i+"/server.json").then(s=>s.json()).catch(s=>{ze.error("Cannot get server translations",s)}):Promise.resolve(void 0)}static loadLocaleInVideoJS(e,t,i){let s=Ur.getLocalePath(e,t);if(!s)return Promise.resolve(void 0);let n;Ur.videojsLocaleCache[s]?n=Promise.resolve(Ur.videojsLocaleCache[s]):n=fetch(s+"/player.json").then(l=>l.json()).then(l=>(Ur.videojsLocaleCache[s]=l,l)).catch(l=>{ze.error("Cannot get player translations",l)});let a=Fo(t);return n.then(l=>i.addLanguage(vE(a),l))}static getLocalePath(e,t){let i=Fo(t);if(!(!mE(i)||jv(i)))return e+"/client/locales/"+i}};Qe(Kv,"videojsLocaleCache",{});var EE=Kv;function Ru(r,e){e||(e=document.body);let t=document.createElement("textarea");t.value=r,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",e.appendChild(t),t.select(),document.execCommand("copy"),e.removeChild(t)}function bE(r){return new Promise(e=>{setTimeout(()=>e(),r)})}function SE(r){let{embedUrl:e,embedTitle:t,aspectRatio:i,responsive:s=!1}=r,n=document.createElement("iframe");if(n.title=t,n.width=s?"100%":"560",n.height=s?"100%":"315",n.src=e,n.frameBorder="0",n.allowFullscreen=!0,n.sandbox.add("allow-same-origin","allow-scripts","allow-popups","allow-forms"),s){let a=document.createElement("div");return a.style.position="relative",a.style.paddingTop=i?(1/i*100).toFixed(2)+"%":"56.25%",n.style.position="absolute",n.style.inset="0",a.appendChild(n),a.outerHTML}return n.outerHTML}function CE(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:!!(navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel"))}function wE(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function No(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}var Bo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qv(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function AE(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var s=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return r[i]}})}),t}var Pu,rg;function Ml(){if(rg)return Pu;rg=1;var r;return typeof window<"u"?r=window:typeof Bo<"u"?r=Bo:typeof self<"u"?r=self:r={},Pu=r,Pu}var IE={},LE=Object.freeze(Object.defineProperty({__proto__:null,default:IE},Symbol.toStringTag,{value:"Module"})),kE=AE(LE),Du,ng;function Wv(){if(ng)return Du;ng=1;var r=typeof Bo<"u"?Bo:typeof window<"u"?window:{},e=kE,t;return typeof document<"u"?t=document:(t=r["__GLOBAL_DOCUMENT_CACHE@4"],t||(t=r["__GLOBAL_DOCUMENT_CACHE@4"]=e)),Du=t,Du}var xu={exports:{}},ag;function zv(){return ag||(ag=1,function(r){function e(){return r.exports=e=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var n in s)({}).hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},r.exports.__esModule=!0,r.exports.default=r.exports,e.apply(null,arguments)}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports}(xu)),xu.exports}var za={exports:{}},og;function RE(){return og||(og=1,function(r,e){function t(c){if(c&&typeof c=="object"){var h=c.which||c.keyCode||c.charCode;h&&(c=h)}if(typeof c=="number")return a[c];var f=String(c),p=i[f.toLowerCase()];if(p)return p;var p=s[f.toLowerCase()];if(p)return p;if(f.length===1)return f.charCodeAt(0)}t.isEventKey=function(h,f){if(h&&typeof h=="object"){var p=h.which||h.keyCode||h.charCode;if(p==null)return!1;if(typeof f=="string"){var m=i[f.toLowerCase()];if(m)return m===p;var m=s[f.toLowerCase()];if(m)return m===p}else if(typeof f=="number")return f===p;return!1}},e=r.exports=t;var i=e.code=e.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},s=e.aliases={windows:91,"\u21E7":16,"\u2325":18,"\u2303":17,"\u2318":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(n=97;n<123;n++)i[String.fromCharCode(n)]=n-32;for(var n=48;n<58;n++)i[n-48]=n;for(n=1;n<13;n++)i["f"+n]=n+111;for(n=0;n<10;n++)i["numpad "+n]=n+96;var a=e.names=e.title={};for(n in i)a[i[n]]=n;for(var l in s)i[l]=s[l]}(za,za.exports)),za.exports}var Ou={exports:{}},lg;function PE(){return lg||(lg=1,function(r){function e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports}(Ou)),Ou.exports}var Mu={exports:{}},Fu={exports:{}},ug;function Cf(){return ug||(ug=1,function(r){function e(t,i){return r.exports=e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,n){return s.__proto__=n,s},r.exports.__esModule=!0,r.exports.default=r.exports,e(t,i)}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports}(Fu)),Fu.exports}var hg;function DE(){return hg||(hg=1,function(r){var e=Cf();function t(i,s){i.prototype=Object.create(s.prototype),i.prototype.constructor=i,e(i,s)}r.exports=t,r.exports.__esModule=!0,r.exports.default=r.exports}(Mu)),Mu.exports}var Nu,cg;function xE(){if(cg)return Nu;cg=1,Nu=r;function r(e,t){var i,s=null;try{i=JSON.parse(e,t)}catch(n){s=n}return[s,i]}return Nu}var Ya={exports:{}},Bu,dg;function OE(){if(dg)return Bu;dg=1,Bu=e;var r=Object.prototype.toString;function e(t){if(!t)return!1;var i=r.call(t);return i==="[object Function]"||typeof t=="function"&&i!=="[object RegExp]"||typeof window<"u"&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}return Bu}var Uu,fg;function ME(){if(fg)return Uu;fg=1;var r=Ml(),e=function(s,n){return n===void 0&&(n=!1),function(a,l,c){if(a){s(a);return}if(l.statusCode>=400&&l.statusCode<=599){var h=c;if(n)if(r.TextDecoder){var f=t(l.headers&&l.headers["content-type"]);try{h=new TextDecoder(f).decode(c)}catch{}}else h=String.fromCharCode.apply(null,new Uint8Array(c));s({cause:h});return}s(null,c)}};function t(i){return i===void 0&&(i=""),i.toLowerCase().split(";").reduce(function(s,n){var a=n.split("="),l=a[0],c=a[1];return l.trim()==="charset"?c.trim():s},"utf-8")}return Uu=e,Uu}var pg;function FE(){if(pg)return Ya.exports;pg=1;var r=Ml(),e=zv(),t=OE();l.httpHandler=ME();var i=function(m){var _={};return m&&m.trim().split(`
`).forEach(function(E){var S=E.indexOf(":"),C=E.slice(0,S).trim().toLowerCase(),I=E.slice(S+1).trim();typeof _[C]>"u"?_[C]=I:Array.isArray(_[C])?_[C].push(I):_[C]=[_[C],I]}),_};Ya.exports=l,Ya.exports.default=l,l.XMLHttpRequest=r.XMLHttpRequest||f,l.XDomainRequest="withCredentials"in new l.XMLHttpRequest?l.XMLHttpRequest:r.XDomainRequest,s(["get","put","post","patch","head","delete"],function(p){l[p==="delete"?"del":p]=function(m,_,E){return _=a(m,_,E),_.method=p.toUpperCase(),c(_)}});function s(p,m){for(var _=0;_<p.length;_++)m(p[_])}function n(p){for(var m in p)if(p.hasOwnProperty(m))return!1;return!0}function a(p,m,_){var E=p;return t(m)?(_=m,typeof p=="string"&&(E={uri:p})):E=e({},m,{uri:p}),E.callback=_,E}function l(p,m,_){return m=a(p,m,_),c(m)}function c(p){if(typeof p.callback>"u")throw new Error("callback argument missing");var m=!1,_=function(te,re,ne){m||(m=!0,p.callback(te,re,ne))};function E(){R.readyState===4&&setTimeout(I,0)}function S(){var ie=void 0;if(R.response?ie=R.response:ie=R.responseText||h(R),P)try{ie=JSON.parse(ie)}catch{}return ie}function C(ie){return clearTimeout(G),ie instanceof Error||(ie=new Error(""+(ie||"Unknown XMLHttpRequest Error"))),ie.statusCode=0,_(ie,Q)}function I(){if(!D){var ie;clearTimeout(G),p.useXDR&&R.status===void 0?ie=200:ie=R.status===1223?204:R.status;var te=Q,re=null;return ie!==0?(te={body:S(),statusCode:ie,method:N,headers:{},url:x,rawRequest:R},R.getAllResponseHeaders&&(te.headers=i(R.getAllResponseHeaders()))):re=new Error("Internal XMLHttpRequest Error"),_(re,te,te.body)}}var R=p.xhr||null;R||(p.cors||p.useXDR?R=new l.XDomainRequest:R=new l.XMLHttpRequest);var k,D,x=R.url=p.uri||p.url,N=R.method=p.method||"GET",B=p.body||p.data,H=R.headers=p.headers||{},O=!!p.sync,P=!1,G,Q={body:void 0,headers:{},statusCode:0,method:N,url:x,rawRequest:R};if("json"in p&&p.json!==!1&&(P=!0,H.accept||H.Accept||(H.Accept="application/json"),N!=="GET"&&N!=="HEAD"&&(H["content-type"]||H["Content-Type"]||(H["Content-Type"]="application/json"),B=JSON.stringify(p.json===!0?B:p.json))),R.onreadystatechange=E,R.onload=I,R.onerror=C,R.onprogress=function(){},R.onabort=function(){D=!0},R.ontimeout=C,R.open(N,x,!O,p.username,p.password),O||(R.withCredentials=!!p.withCredentials),!O&&p.timeout>0&&(G=setTimeout(function(){if(!D){D=!0,R.abort("timeout");var ie=new Error("XMLHttpRequest timeout");ie.code="ETIMEDOUT",C(ie)}},p.timeout)),R.setRequestHeader)for(k in H)H.hasOwnProperty(k)&&R.setRequestHeader(k,H[k]);else if(p.headers&&!n(p.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in p&&(R.responseType=p.responseType),"beforeSend"in p&&typeof p.beforeSend=="function"&&p.beforeSend(R),R.send(B||null),R}function h(p){try{if(p.responseType==="document")return p.responseXML;var m=p.responseXML&&p.responseXML.documentElement.nodeName==="parsererror";if(p.responseType===""&&!m)return p.responseXML}catch{}return null}function f(){}return Ya.exports}var $u={exports:{}},Hu,gg;function NE(){if(gg)return Hu;gg=1;var r=Wv(),e=Object.create||function(){function O(){}return function(P){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return O.prototype=P,new O}}();function t(O,P){this.name="ParsingError",this.code=O.code,this.message=P||O.message}t.prototype=e(Error.prototype),t.prototype.constructor=t,t.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function i(O){function P(Q,ie,te,re){return(Q|0)*3600+(ie|0)*60+(te|0)+(re|0)/1e3}var G=O.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return G?G[3]?P(G[1],G[2],G[3].replace(":",""),G[4]):G[1]>59?P(G[1],G[2],0,G[4]):P(0,G[1],G[2],G[4]):null}function s(){this.values=e(null)}s.prototype={set:function(O,P){!this.get(O)&&P!==""&&(this.values[O]=P)},get:function(O,P,G){return G?this.has(O)?this.values[O]:P[G]:this.has(O)?this.values[O]:P},has:function(O){return O in this.values},alt:function(O,P,G){for(var Q=0;Q<G.length;++Q)if(P===G[Q]){this.set(O,P);break}},integer:function(O,P){/^-?\d+$/.test(P)&&this.set(O,parseInt(P,10))},percent:function(O,P){return P.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(P=parseFloat(P),P>=0&&P<=100)?(this.set(O,P),!0):!1}};function n(O,P,G,Q){var ie=Q?O.split(Q):[O];for(var te in ie)if(typeof ie[te]=="string"){var re=ie[te].split(G);if(re.length===2){var ne=re[0].trim(),de=re[1].trim();P(ne,de)}}}function a(O,P,G){var Q=O;function ie(){var ne=i(O);if(ne===null)throw new t(t.Errors.BadTimeStamp,"Malformed timestamp: "+Q);return O=O.replace(/^[^\sa-zA-Z-]+/,""),ne}function te(ne,de){var Z=new s;n(ne,function(ae,se){switch(ae){case"region":for(var oe=G.length-1;oe>=0;oe--)if(G[oe].id===se){Z.set(ae,G[oe].region);break}break;case"vertical":Z.alt(ae,se,["rl","lr"]);break;case"line":var Y=se.split(","),ee=Y[0];Z.integer(ae,ee),Z.percent(ae,ee)&&Z.set("snapToLines",!1),Z.alt(ae,ee,["auto"]),Y.length===2&&Z.alt("lineAlign",Y[1],["start","center","end"]);break;case"position":Y=se.split(","),Z.percent(ae,Y[0]),Y.length===2&&Z.alt("positionAlign",Y[1],["start","center","end"]);break;case"size":Z.percent(ae,se);break;case"align":Z.alt(ae,se,["start","center","end","left","right"]);break}},/:/,/\s/),de.region=Z.get("region",null),de.vertical=Z.get("vertical","");try{de.line=Z.get("line","auto")}catch{}de.lineAlign=Z.get("lineAlign","start"),de.snapToLines=Z.get("snapToLines",!0),de.size=Z.get("size",100);try{de.align=Z.get("align","center")}catch{de.align=Z.get("align","middle")}try{de.position=Z.get("position","auto")}catch{de.position=Z.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},de.align)}de.positionAlign=Z.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},de.align)}function re(){O=O.replace(/^\s+/,"")}if(re(),P.startTime=ie(),re(),O.substr(0,3)!=="-->")throw new t(t.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+Q);O=O.substr(3),re(),P.endTime=ie(),re(),te(O,P)}var l=r.createElement&&r.createElement("textarea"),c={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},h={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},f={v:"title",lang:"lang"},p={rt:"ruby"};function m(O,P){function G(){if(!P)return null;function ee(Ee){return P=P.substr(Ee.length),Ee}var be=P.match(/^([^<]*)(<[^>]*>?)?/);return ee(be[1]?be[1]:be[2])}function Q(ee){return l.innerHTML=ee,ee=l.textContent,l.textContent="",ee}function ie(ee,be){return!p[be.localName]||p[be.localName]===ee.localName}function te(ee,be){var Ee=c[ee];if(!Ee)return null;var Re=O.document.createElement(Ee),Oe=f[ee];return Oe&&be&&(Re[Oe]=be.trim()),Re}for(var re=O.document.createElement("div"),ne=re,de,Z=[];(de=G())!==null;){if(de[0]==="<"){if(de[1]==="/"){Z.length&&Z[Z.length-1]===de.substr(2).replace(">","")&&(Z.pop(),ne=ne.parentNode);continue}var ae=i(de.substr(1,de.length-2)),se;if(ae){se=O.document.createProcessingInstruction("timestamp",ae),ne.appendChild(se);continue}var oe=de.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!oe||(se=te(oe[1],oe[3]),!se)||!ie(ne,se))continue;if(oe[2]){var Y=oe[2].split(".");Y.forEach(function(ee){var be=/^bg_/.test(ee),Ee=be?ee.slice(3):ee;if(h.hasOwnProperty(Ee)){var Re=be?"background-color":"color",Oe=h[Ee];se.style[Re]=Oe}}),se.className=Y.join(" ")}Z.push(oe[1]),ne.appendChild(se),ne=se;continue}ne.appendChild(O.document.createTextNode(Q(de)))}return re}var _=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function E(O){for(var P=0;P<_.length;P++){var G=_[P];if(O>=G[0]&&O<=G[1])return!0}return!1}function S(O){var P=[],G="",Q;if(!O||!O.childNodes)return"ltr";function ie(ne,de){for(var Z=de.childNodes.length-1;Z>=0;Z--)ne.push(de.childNodes[Z])}function te(ne){if(!ne||!ne.length)return null;var de=ne.pop(),Z=de.textContent||de.innerText;if(Z){var ae=Z.match(/^.*(\n|\r)/);return ae?(ne.length=0,ae[0]):Z}if(de.tagName==="ruby")return te(ne);if(de.childNodes)return ie(ne,de),te(ne)}for(ie(P,O);G=te(P);)for(var re=0;re<G.length;re++)if(Q=G.charCodeAt(re),E(Q))return"rtl";return"ltr"}function C(O){if(typeof O.line=="number"&&(O.snapToLines||O.line>=0&&O.line<=100))return O.line;if(!O.track||!O.track.textTrackList||!O.track.textTrackList.mediaElement)return-1;for(var P=O.track,G=P.textTrackList,Q=0,ie=0;ie<G.length&&G[ie]!==P;ie++)G[ie].mode==="showing"&&Q++;return++Q*-1}function I(){}I.prototype.applyStyles=function(O,P){P=P||this.div;for(var G in O)O.hasOwnProperty(G)&&(P.style[G]=O[G])},I.prototype.formatStyle=function(O,P){return O===0?0:O+P};function R(O,P,G){I.call(this),this.cue=P,this.cueDiv=m(O,P.text);var Q={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:P.vertical===""?"horizontal-tb":P.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(Q,this.cueDiv),this.div=O.document.createElement("div"),Q={direction:S(this.cueDiv),writingMode:P.vertical===""?"horizontal-tb":P.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:P.align==="middle"?"center":P.align,font:G.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(Q),this.div.appendChild(this.cueDiv);var ie=0;switch(P.positionAlign){case"start":case"line-left":ie=P.position;break;case"center":ie=P.position-P.size/2;break;case"end":case"line-right":ie=P.position-P.size;break}P.vertical===""?this.applyStyles({left:this.formatStyle(ie,"%"),width:this.formatStyle(P.size,"%")}):this.applyStyles({top:this.formatStyle(ie,"%"),height:this.formatStyle(P.size,"%")}),this.move=function(te){this.applyStyles({top:this.formatStyle(te.top,"px"),bottom:this.formatStyle(te.bottom,"px"),left:this.formatStyle(te.left,"px"),right:this.formatStyle(te.right,"px"),height:this.formatStyle(te.height,"px"),width:this.formatStyle(te.width,"px")})}}R.prototype=e(I.prototype),R.prototype.constructor=R;function k(O){var P,G,Q,ie;if(O.div){G=O.div.offsetHeight,Q=O.div.offsetWidth,ie=O.div.offsetTop;var te=(te=O.div.childNodes)&&(te=te[0])&&te.getClientRects&&te.getClientRects();O=O.div.getBoundingClientRect(),P=te?Math.max(te[0]&&te[0].height||0,O.height/te.length):0}this.left=O.left,this.right=O.right,this.top=O.top||ie,this.height=O.height||G,this.bottom=O.bottom||ie+(O.height||G),this.width=O.width||Q,this.lineHeight=P!==void 0?P:O.lineHeight}k.prototype.move=function(O,P){switch(P=P!==void 0?P:this.lineHeight,O){case"+x":this.left+=P,this.right+=P;break;case"-x":this.left-=P,this.right-=P;break;case"+y":this.top+=P,this.bottom+=P;break;case"-y":this.top-=P,this.bottom-=P;break}},k.prototype.overlaps=function(O){return this.left<O.right&&this.right>O.left&&this.top<O.bottom&&this.bottom>O.top},k.prototype.overlapsAny=function(O){for(var P=0;P<O.length;P++)if(this.overlaps(O[P]))return!0;return!1},k.prototype.within=function(O){return this.top>=O.top&&this.bottom<=O.bottom&&this.left>=O.left&&this.right<=O.right},k.prototype.overlapsOppositeAxis=function(O,P){switch(P){case"+x":return this.left<O.left;case"-x":return this.right>O.right;case"+y":return this.top<O.top;case"-y":return this.bottom>O.bottom}},k.prototype.intersectPercentage=function(O){var P=Math.max(0,Math.min(this.right,O.right)-Math.max(this.left,O.left)),G=Math.max(0,Math.min(this.bottom,O.bottom)-Math.max(this.top,O.top)),Q=P*G;return Q/(this.height*this.width)},k.prototype.toCSSCompatValues=function(O){return{top:this.top-O.top,bottom:O.bottom-this.bottom,left:this.left-O.left,right:O.right-this.right,height:this.height,width:this.width}},k.getSimpleBoxPosition=function(O){var P=O.div?O.div.offsetHeight:O.tagName?O.offsetHeight:0,G=O.div?O.div.offsetWidth:O.tagName?O.offsetWidth:0,Q=O.div?O.div.offsetTop:O.tagName?O.offsetTop:0;O=O.div?O.div.getBoundingClientRect():O.tagName?O.getBoundingClientRect():O;var ie={left:O.left,right:O.right,top:O.top||Q,height:O.height||P,bottom:O.bottom||Q+(O.height||P),width:O.width||G};return ie};function D(O,P,G,Q){function ie(Ee,Re){for(var Oe,Pe=new k(Ee),Be=1,Ve=0;Ve<Re.length;Ve++){for(;Ee.overlapsOppositeAxis(G,Re[Ve])||Ee.within(G)&&Ee.overlapsAny(Q);)Ee.move(Re[Ve]);if(Ee.within(G))return Ee;var Je=Ee.intersectPercentage(G);Be>Je&&(Oe=new k(Ee),Be=Je),Ee=new k(Pe)}return Oe||Pe}var te=new k(P),re=P.cue,ne=C(re),de=[];if(re.snapToLines){var Z;switch(re.vertical){case"":de=["+y","-y"],Z="height";break;case"rl":de=["+x","-x"],Z="width";break;case"lr":de=["-x","+x"],Z="width";break}var ae=te.lineHeight,se=ae*Math.round(ne),oe=G[Z]+ae,Y=de[0];Math.abs(se)>oe&&(se=se<0?-1:1,se*=Math.ceil(oe/ae)*ae),ne<0&&(se+=re.vertical===""?G.height:G.width,de=de.reverse()),te.move(Y,se)}else{var ee=te.lineHeight/G.height*100;switch(re.lineAlign){case"center":ne-=ee/2;break;case"end":ne-=ee;break}switch(re.vertical){case"":P.applyStyles({top:P.formatStyle(ne,"%")});break;case"rl":P.applyStyles({left:P.formatStyle(ne,"%")});break;case"lr":P.applyStyles({right:P.formatStyle(ne,"%")});break}de=["+y","-x","+x","-y"],te=new k(P)}var be=ie(te,de);P.move(be.toCSSCompatValues(G))}function x(){}x.StringDecoder=function(){return{decode:function(O){if(!O)return"";if(typeof O!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(O))}}},x.convertCueToDOMTree=function(O,P){return!O||!P?null:m(O,P)};var N=.05,B="sans-serif",H="1.5%";return x.processCues=function(O,P,G){if(!O||!P||!G)return null;for(;G.firstChild;)G.removeChild(G.firstChild);var Q=O.document.createElement("div");Q.style.position="absolute",Q.style.left="0",Q.style.right="0",Q.style.top="0",Q.style.bottom="0",Q.style.margin=H,G.appendChild(Q);function ie(ae){for(var se=0;se<ae.length;se++)if(ae[se].hasBeenReset||!ae[se].displayState)return!0;return!1}if(!ie(P)){for(var te=0;te<P.length;te++)Q.appendChild(P[te].displayState);return}var re=[],ne=k.getSimpleBoxPosition(Q),de=Math.round(ne.height*N*100)/100,Z={font:de+"px "+B};(function(){for(var ae,se,oe=0;oe<P.length;oe++)se=P[oe],ae=new R(O,se,Z),Q.appendChild(ae.div),D(O,ae,ne,re),se.displayState=ae.div,re.push(k.getSimpleBoxPosition(ae))})()},x.Parser=function(O,P,G){G||(G=P,P={}),P||(P={}),this.window=O,this.vttjs=P,this.state="INITIAL",this.buffer="",this.decoder=G||new TextDecoder("utf8"),this.regionList=[]},x.Parser.prototype={reportOrThrowError:function(O){if(O instanceof t)this.onparsingerror&&this.onparsingerror(O);else throw O},parse:function(O){var P=this;O&&(P.buffer+=P.decoder.decode(O,{stream:!0}));function G(){for(var ae=P.buffer,se=0;se<ae.length&&ae[se]!=="\r"&&ae[se]!==`
`;)++se;var oe=ae.substr(0,se);return ae[se]==="\r"&&++se,ae[se]===`
`&&++se,P.buffer=ae.substr(se),oe}function Q(ae){var se=new s;if(n(ae,function(Y,ee){switch(Y){case"id":se.set(Y,ee);break;case"width":se.percent(Y,ee);break;case"lines":se.integer(Y,ee);break;case"regionanchor":case"viewportanchor":var be=ee.split(",");if(be.length!==2)break;var Ee=new s;if(Ee.percent("x",be[0]),Ee.percent("y",be[1]),!Ee.has("x")||!Ee.has("y"))break;se.set(Y+"X",Ee.get("x")),se.set(Y+"Y",Ee.get("y"));break;case"scroll":se.alt(Y,ee,["up"]);break}},/=/,/\s/),se.has("id")){var oe=new(P.vttjs.VTTRegion||P.window.VTTRegion);oe.width=se.get("width",100),oe.lines=se.get("lines",3),oe.regionAnchorX=se.get("regionanchorX",0),oe.regionAnchorY=se.get("regionanchorY",100),oe.viewportAnchorX=se.get("viewportanchorX",0),oe.viewportAnchorY=se.get("viewportanchorY",100),oe.scroll=se.get("scroll",""),P.onregion&&P.onregion(oe),P.regionList.push({id:se.get("id"),region:oe})}}function ie(ae){var se=new s;n(ae,function(oe,Y){switch(oe){case"MPEGT":se.integer(oe+"S",Y);break;case"LOCA":se.set(oe+"L",i(Y));break}},/[^\d]:/,/,/),P.ontimestampmap&&P.ontimestampmap({MPEGTS:se.get("MPEGTS"),LOCAL:se.get("LOCAL")})}function te(ae){ae.match(/X-TIMESTAMP-MAP/)?n(ae,function(se,oe){switch(se){case"X-TIMESTAMP-MAP":ie(oe);break}},/=/):n(ae,function(se,oe){switch(se){case"Region":Q(oe);break}},/:/)}try{var re;if(P.state==="INITIAL"){if(!/\r\n|\n/.test(P.buffer))return this;re=G();var ne=re.match(/^WEBVTT([ \t].*)?$/);if(!ne||!ne[0])throw new t(t.Errors.BadSignature);P.state="HEADER"}for(var de=!1;P.buffer;){if(!/\r\n|\n/.test(P.buffer))return this;switch(de?de=!1:re=G(),P.state){case"HEADER":/:/.test(re)?te(re):re||(P.state="ID");continue;case"NOTE":re||(P.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(re)){P.state="NOTE";break}if(!re)continue;P.cue=new(P.vttjs.VTTCue||P.window.VTTCue)(0,0,"");try{P.cue.align="center"}catch{P.cue.align="middle"}if(P.state="CUE",re.indexOf("-->")===-1){P.cue.id=re;continue}case"CUE":try{a(re,P.cue,P.regionList)}catch(ae){P.reportOrThrowError(ae),P.cue=null,P.state="BADCUE";continue}P.state="CUETEXT";continue;case"CUETEXT":var Z=re.indexOf("-->")!==-1;if(!re||Z&&(de=!0)){P.oncue&&P.oncue(P.cue),P.cue=null,P.state="ID";continue}P.cue.text&&(P.cue.text+=`
`),P.cue.text+=re.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":re||(P.state="ID");continue}}}catch(ae){P.reportOrThrowError(ae),P.state==="CUETEXT"&&P.cue&&P.oncue&&P.oncue(P.cue),P.cue=null,P.state=P.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var O=this;try{if(O.buffer+=O.decoder.decode(),(O.cue||O.state==="HEADER")&&(O.buffer+=`

`,O.parse()),O.state==="INITIAL")throw new t(t.Errors.BadSignature)}catch(P){O.reportOrThrowError(P)}return O.onflush&&O.onflush(),this}},Hu=x,Hu}var ju,mg;function BE(){if(mg)return ju;mg=1;var r="auto",e={"":1,lr:1,rl:1},t={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function i(a){if(typeof a!="string")return!1;var l=e[a.toLowerCase()];return l?a.toLowerCase():!1}function s(a){if(typeof a!="string")return!1;var l=t[a.toLowerCase()];return l?a.toLowerCase():!1}function n(a,l,c){this.hasBeenReset=!1;var h="",f=!1,p=a,m=l,_=c,E=null,S="",C=!0,I="auto",R="start",k="auto",D="auto",x=100,N="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return h},set:function(B){h=""+B}},pauseOnExit:{enumerable:!0,get:function(){return f},set:function(B){f=!!B}},startTime:{enumerable:!0,get:function(){return p},set:function(B){if(typeof B!="number")throw new TypeError("Start time must be set to a number.");p=B,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return m},set:function(B){if(typeof B!="number")throw new TypeError("End time must be set to a number.");m=B,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return _},set:function(B){_=""+B,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return E},set:function(B){E=B,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return S},set:function(B){var H=i(B);if(H===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");S=H,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return C},set:function(B){C=!!B,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return I},set:function(B){if(typeof B!="number"&&B!==r)throw new SyntaxError("Line: an invalid number or illegal string was specified.");I=B,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return R},set:function(B){var H=s(B);H?(R=H,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return k},set:function(B){if(B<0||B>100)throw new Error("Position must be between 0 and 100.");k=B,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return D},set:function(B){var H=s(B);H?(D=H,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return x},set:function(B){if(B<0||B>100)throw new Error("Size must be between 0 and 100.");x=B,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return N},set:function(B){var H=s(B);if(!H)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");N=H,this.hasBeenReset=!0}}}),this.displayState=void 0}return n.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},ju=n,ju}var Vu,vg;function UE(){if(vg)return Vu;vg=1;var r={"":!0,up:!0};function e(s){if(typeof s!="string")return!1;var n=r[s.toLowerCase()];return n?s.toLowerCase():!1}function t(s){return typeof s=="number"&&s>=0&&s<=100}function i(){var s=100,n=3,a=0,l=100,c=0,h=100,f="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return s},set:function(p){if(!t(p))throw new Error("Width must be between 0 and 100.");s=p}},lines:{enumerable:!0,get:function(){return n},set:function(p){if(typeof p!="number")throw new TypeError("Lines must be set to a number.");n=p}},regionAnchorY:{enumerable:!0,get:function(){return l},set:function(p){if(!t(p))throw new Error("RegionAnchorX must be between 0 and 100.");l=p}},regionAnchorX:{enumerable:!0,get:function(){return a},set:function(p){if(!t(p))throw new Error("RegionAnchorY must be between 0 and 100.");a=p}},viewportAnchorY:{enumerable:!0,get:function(){return h},set:function(p){if(!t(p))throw new Error("ViewportAnchorY must be between 0 and 100.");h=p}},viewportAnchorX:{enumerable:!0,get:function(){return c},set:function(p){if(!t(p))throw new Error("ViewportAnchorX must be between 0 and 100.");c=p}},scroll:{enumerable:!0,get:function(){return f},set:function(p){var m=e(p);m===!1?console.warn("Scroll: an invalid or illegal string was specified."):f=m}}})}return Vu=i,Vu}var yg;function $E(){if(yg)return $u.exports;yg=1;var r=Ml(),e=$u.exports={WebVTT:NE(),VTTCue:BE(),VTTRegion:UE()};r.vttjs=e,r.WebVTT=e.WebVTT;var t=e.VTTCue,i=e.VTTRegion,s=r.VTTCue,n=r.VTTRegion;return e.shim=function(){r.VTTCue=t,r.VTTRegion=i},e.restore=function(){r.VTTCue=s,r.VTTRegion=n},r.VTTCue||e.shim(),$u.exports}var Gu={exports:{}},Ku={exports:{}},Tg;function HE(){return Tg||(Tg=1,function(r){function e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(r.exports=e=function(){return!!t},r.exports.__esModule=!0,r.exports.default=r.exports)()}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports}(Ku)),Ku.exports}var _g;function jE(){return _g||(_g=1,function(r){var e=HE(),t=Cf();function i(s,n,a){if(e())return Reflect.construct.apply(null,arguments);var l=[null];l.push.apply(l,n);var c=new(s.bind.apply(s,l));return a&&t(c,a.prototype),c}r.exports=i,r.exports.__esModule=!0,r.exports.default=r.exports}(Gu)),Gu.exports}var qu={exports:{}},Eg;function VE(){return Eg||(Eg=1,function(r){var e=Cf();function t(i,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(s&&s.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),s&&e(i,s)}r.exports=t,r.exports.__esModule=!0,r.exports.default=r.exports}(qu)),qu.exports}var Wu,bg;function GE(){if(bg)return Wu;bg=1;var r=Ml(),e=Wv(),t=zv(),i=RE(),s=PE(),n=DE(),a=xE(),l=FE(),c=$E(),h=jE(),f=VE();function p(v){return v&&typeof v=="object"&&"default"in v?v:{default:v}}for(var m=p(r),_=p(e),E=p(t),S=p(i),C=p(s),I=p(n),R=p(a),k=p(l),D=p(c),x=p(h),N=p(f),B="7.21.7",H={},O=function(T,g){return H[T]=H[T]||[],g&&(H[T]=H[T].concat(g)),H[T]},P=function(T,g){O(T,g)},G=function(T,g){var d=O(T).indexOf(g);return d<=-1?!1:(H[T]=H[T].slice(),H[T].splice(d,1),!0)},Q=function(T,g){O(T,[].concat(g).map(function(d){var o=function u(){return G(T,u),d.apply(void 0,arguments)};return o}))},ie={prefixed:!0},te=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],re=te[0],ne,de=0;de<te.length;de++)if(te[de][1]in _.default){ne=te[de];break}if(ne){for(var Z=0;Z<ne.length;Z++)ie[re[Z]]=ne[Z];ie.prefixed=ne[0]!==re[0]}var ae=[],se=function(T,g){return function(d,o,u){var y=g.levels[o],w=new RegExp("^("+y+")$");if(d!=="log"&&u.unshift(d.toUpperCase()+":"),u.unshift(T+":"),ae){ae.push([].concat(u));var F=ae.length-1e3;ae.splice(0,F>0?F:0)}if(m.default.console){var $=m.default.console[d];!$&&d==="debug"&&($=m.default.console.info||m.default.console.log),!(!$||!y||!w.test(d))&&$[Array.isArray(u)?"apply":"call"](m.default.console,u)}}};function oe(v){var T="info",g,d=function(){for(var u=arguments.length,y=new Array(u),w=0;w<u;w++)y[w]=arguments[w];g("log",T,y)};return g=se(v,d),d.createLogger=function(o){return oe(v+": "+o)},d.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:T},d.level=function(o){if(typeof o=="string"){if(!d.levels.hasOwnProperty(o))throw new Error('"'+o+'" in not a valid log level');T=o}return T},d.history=function(){return ae?[].concat(ae):[]},d.history.filter=function(o){return(ae||[]).filter(function(u){return new RegExp(".*"+o+".*").test(u[0])})},d.history.clear=function(){ae&&(ae.length=0)},d.history.disable=function(){ae!==null&&(ae.length=0,ae=null)},d.history.enable=function(){ae===null&&(ae=[])},d.error=function(){for(var o=arguments.length,u=new Array(o),y=0;y<o;y++)u[y]=arguments[y];return g("error",T,u)},d.warn=function(){for(var o=arguments.length,u=new Array(o),y=0;y<o;y++)u[y]=arguments[y];return g("warn",T,u)},d.debug=function(){for(var o=arguments.length,u=new Array(o),y=0;y<o;y++)u[y]=arguments[y];return g("debug",T,u)},d}var Y=oe("VIDEOJS"),ee=Y.createLogger,be=Object.prototype.toString,Ee=function(T){return Be(T)?Object.keys(T):[]};function Re(v,T){Ee(v).forEach(function(g){return T(v[g],g)})}function Oe(v,T,g){return g===void 0&&(g=0),Ee(v).reduce(function(d,o){return T(d,v[o],o)},g)}function Pe(v){for(var T=arguments.length,g=new Array(T>1?T-1:0),d=1;d<T;d++)g[d-1]=arguments[d];return Object.assign?E.default.apply(void 0,[v].concat(g)):(g.forEach(function(o){o&&Re(o,function(u,y){v[y]=u})}),v)}function Be(v){return!!v&&typeof v=="object"}function Ve(v){return Be(v)&&be.call(v)==="[object Object]"&&v.constructor===Object}function Je(v,T){if(!v||!T)return"";if(typeof m.default.getComputedStyle=="function"){var g;try{g=m.default.getComputedStyle(v)}catch{return""}return g?g.getPropertyValue(T)||g[T]:""}return""}var Ye=m.default.navigator&&m.default.navigator.userAgent||"",ni=/AppleWebKit\/([\d.]+)/i.exec(Ye),Wt=ni?parseFloat(ni.pop()):null,Ri=/iPod/i.test(Ye),xe=function(){var v=Ye.match(/OS (\d+)_/i);return v&&v[1]?v[1]:null}(),Ke=/Android/i.test(Ye),St=function(){var v=Ye.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!v)return null;var T=v[1]&&parseFloat(v[1]),g=v[2]&&parseFloat(v[2]);return T&&g?parseFloat(v[1]+"."+v[2]):T||null}(),Vt=Ke&&St<5&&Wt<537,Ct=/Firefox/i.test(Ye),Ut=/Edg/i.test(Ye),yt=!Ut&&(/Chrome/i.test(Ye)||/CriOS/i.test(Ye)),Ti=function(){var v=Ye.match(/(Chrome|CriOS)\/(\d+)/);return v&&v[2]?parseFloat(v[2]):null}(),Ft=function(){var v=/MSIE\s(\d+)\.\d/.exec(Ye),T=v&&parseFloat(v[1]);return!T&&/Trident\/7.0/i.test(Ye)&&/rv:11.0/.test(Ye)&&(T=11),T}(),wt=/Safari/i.test(Ye)&&!yt&&!Ke&&!Ut,Pt=/Windows/i.test(Ye),zt=!!(le()&&("ontouchstart"in m.default||m.default.navigator.maxTouchPoints||m.default.DocumentTouch&&m.default.document instanceof m.default.DocumentTouch)),Dt=/iPad/i.test(Ye)||wt&&zt&&!/iPhone/i.test(Ye),kt=/iPhone/i.test(Ye)&&!Dt,M=kt||Dt||Ri,b=(wt||M)&&!yt,A=Object.freeze({__proto__:null,IS_IPOD:Ri,IOS_VERSION:xe,IS_ANDROID:Ke,ANDROID_VERSION:St,IS_NATIVE_ANDROID:Vt,IS_FIREFOX:Ct,IS_EDGE:Ut,IS_CHROME:yt,CHROME_VERSION:Ti,IE_VERSION:Ft,IS_SAFARI:wt,IS_WINDOWS:Pt,TOUCH_ENABLED:zt,IS_IPAD:Dt,IS_IPHONE:kt,IS_IOS:M,IS_ANY_SAFARI:b});function j(v){return typeof v=="string"&&!!v.trim()}function q(v){if(v.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function J(v){return new RegExp("(^|\\s)"+v+"($|\\s)")}function le(){return _.default===m.default.document}function Me(v){return Be(v)&&v.nodeType===1}function nt(){try{return m.default.parent!==m.default.self}catch{return!0}}function et(v){return function(T,g){if(!j(T))return _.default[v](null);j(g)&&(g=_.default.querySelector(g));var d=Me(g)?g:_.default;return d[v]&&d[v](T)}}function ke(v,T,g,d){v===void 0&&(v="div"),T===void 0&&(T={}),g===void 0&&(g={});var o=_.default.createElement(v);return Object.getOwnPropertyNames(T).forEach(function(u){var y=T[u];u.indexOf("aria-")!==-1||u==="role"||u==="type"?(Y.warn(`Setting attributes in the second argument of createEl()
has been deprecated. Use the third argument instead.
`+("createEl(type, properties, attributes). Attempting to set "+u+" to "+y+".")),o.setAttribute(u,y)):u==="textContent"?qe(o,y):(o[u]!==y||u==="tabIndex")&&(o[u]=y)}),Object.getOwnPropertyNames(g).forEach(function(u){o.setAttribute(u,g[u])}),d&&fn(o,d),o}function qe(v,T){return typeof v.textContent>"u"?v.innerText=T:v.textContent=T,v}function hn(v,T){T.firstChild?T.insertBefore(v,T.firstChild):T.appendChild(v)}function Qi(v,T){return q(T),v.classList?v.classList.contains(T):J(T).test(v.className)}function _i(v,T){return v.classList?v.classList.add(T):Qi(v,T)||(v.className=(v.className+" "+T).trim()),v}function js(v,T){return v?(v.classList?v.classList.remove(T):(q(T),v.className=v.className.split(/\s+/).filter(function(g){return g!==T}).join(" ")),v):(Y.warn("removeClass was called with an element that doesn't exist"),null)}function cn(v,T,g){var d=Qi(v,T);if(typeof g=="function"&&(g=g(v,T)),typeof g!="boolean"&&(g=!d),g!==d)return g?_i(v,T):js(v,T),v}function pa(v,T){Object.getOwnPropertyNames(T).forEach(function(g){var d=T[g];d===null||typeof d>"u"||d===!1?v.removeAttribute(g):v.setAttribute(g,d===!0?"":d)})}function ui(v){var T={},g=",autoplay,controls,playsinline,loop,muted,default,defaultMuted,";if(v&&v.attributes&&v.attributes.length>0)for(var d=v.attributes,o=d.length-1;o>=0;o--){var u=d[o].name,y=d[o].value;(typeof v[u]=="boolean"||g.indexOf(","+u+",")!==-1)&&(y=y!==null),T[u]=y}return T}function ga(v,T){return v.getAttribute(T)}function gs(v,T,g){v.setAttribute(T,g)}function mr(v,T){v.removeAttribute(T)}function ma(){_.default.body.focus(),_.default.onselectstart=function(){return!1}}function va(){_.default.onselectstart=function(){return!0}}function ms(v){if(v&&v.getBoundingClientRect&&v.parentNode){var T=v.getBoundingClientRect(),g={};return["bottom","height","left","right","top","width"].forEach(function(d){T[d]!==void 0&&(g[d]=T[d])}),g.height||(g.height=parseFloat(Je(v,"height"))),g.width||(g.width=parseFloat(Je(v,"width"))),g}}function Pi(v){if(!v||v&&!v.offsetParent)return{left:0,top:0,width:0,height:0};for(var T=v.offsetWidth,g=v.offsetHeight,d=0,o=0;v.offsetParent&&v!==_.default[ie.fullscreenElement];)d+=v.offsetLeft,o+=v.offsetTop,v=v.offsetParent;return{left:d,top:o,width:T,height:g}}function Vs(v,T){var g={x:0,y:0};if(M)for(var d=v;d&&d.nodeName.toLowerCase()!=="html";){var o=Je(d,"transform");if(/^matrix/.test(o)){var u=o.slice(7,-1).split(/,\s/).map(Number);g.x+=u[4],g.y+=u[5]}else if(/^matrix3d/.test(o)){var y=o.slice(9,-1).split(/,\s/).map(Number);g.x+=y[12],g.y+=y[13]}d=d.parentNode}var w={},F=Pi(T.target),$=Pi(v),K=$.width,W=$.height,V=T.offsetY-($.top-F.top),pe=T.offsetX-($.left-F.left);return T.changedTouches&&(pe=T.changedTouches[0].pageX-$.left,V=T.changedTouches[0].pageY+$.top,M&&(pe-=g.x,V-=g.y)),w.y=1-Math.max(0,Math.min(1,V/W)),w.x=Math.max(0,Math.min(1,pe/K)),w}function ya(v){return Be(v)&&v.nodeType===3}function dn(v){for(;v.firstChild;)v.removeChild(v.firstChild);return v}function Ta(v){return typeof v=="function"&&(v=v()),(Array.isArray(v)?v:[v]).map(function(T){if(typeof T=="function"&&(T=T()),Me(T)||ya(T))return T;if(typeof T=="string"&&/\S/.test(T))return _.default.createTextNode(T)}).filter(function(T){return T})}function fn(v,T){return Ta(T).forEach(function(g){return v.appendChild(g)}),v}function _a(v,T){return fn(dn(v),T)}function vs(v){return v.button===void 0&&v.buttons===void 0||v.button===0&&v.buttons===void 0||v.type==="mouseup"&&v.button===0&&v.buttons===0?!0:!(v.button!==0||v.buttons!==1)}var Di=et("querySelector"),Ea=et("querySelectorAll"),ba=Object.freeze({__proto__:null,isReal:le,isEl:Me,isInFrame:nt,createEl:ke,textContent:qe,prependTo:hn,hasClass:Qi,addClass:_i,removeClass:js,toggleClass:cn,setAttributes:pa,getAttributes:ui,getAttribute:ga,setAttribute:gs,removeAttribute:mr,blockTextSelection:ma,unblockTextSelection:va,getBoundingClientRect:ms,findPosition:Pi,getPointerPosition:Vs,isTextNode:ya,emptyEl:dn,normalizeContent:Ta,appendContent:fn,insertContent:_a,isSingleLeftClick:vs,$:Di,$$:Ea}),Sa=!1,pn,Ca=function(){if(pn.options.autoSetup!==!1){var T=Array.prototype.slice.call(_.default.getElementsByTagName("video")),g=Array.prototype.slice.call(_.default.getElementsByTagName("audio")),d=Array.prototype.slice.call(_.default.getElementsByTagName("video-js")),o=T.concat(g,d);if(o&&o.length>0)for(var u=0,y=o.length;u<y;u++){var w=o[u];if(w&&w.getAttribute){if(w.player===void 0){var F=w.getAttribute("data-setup");F!==null&&pn(w)}}else{gn(1);break}}else Sa||gn(1)}};function gn(v,T){le()&&(T&&(pn=T),m.default.setTimeout(Ca,v))}function mn(){Sa=!0,m.default.removeEventListener("load",mn)}le()&&(_.default.readyState==="complete"?mn():m.default.addEventListener("load",mn));var vr=function(T){var g=_.default.createElement("style");return g.className=T,g},ys=function(T,g){T.styleSheet?T.styleSheet.cssText=g:T.textContent=g},wa=3,vn=wa;function hi(){return vn++}var Aa;m.default.WeakMap||(Aa=function(){function v(){this.vdata="vdata"+Math.floor(m.default.performance&&m.default.performance.now()||Date.now()),this.data={}}var T=v.prototype;return T.set=function(d,o){var u=d[this.vdata]||hi();return d[this.vdata]||(d[this.vdata]=u),this.data[u]=o,this},T.get=function(d){var o=d[this.vdata];if(o)return this.data[o];Y("We have no data for this element",d)},T.has=function(d){var o=d[this.vdata];return o in this.data},T.delete=function(d){var o=d[this.vdata];o&&(delete this.data[o],delete d[this.vdata])},v}());var Nt=m.default.WeakMap?new WeakMap:new Aa;function Ia(v,T){if(Nt.has(v)){var g=Nt.get(v);g.handlers[T].length===0&&(delete g.handlers[T],v.removeEventListener?v.removeEventListener(T,g.dispatcher,!1):v.detachEvent&&v.detachEvent("on"+T,g.dispatcher)),Object.getOwnPropertyNames(g.handlers).length<=0&&(delete g.handlers,delete g.dispatcher,delete g.disabled),Object.getOwnPropertyNames(g).length===0&&Nt.delete(v)}}function yr(v,T,g,d){g.forEach(function(o){v(T,o,d)})}function Tr(v){if(v.fixed_)return v;function T(){return!0}function g(){return!1}if(!v||!v.isPropagationStopped||!v.isImmediatePropagationStopped){var d=v||m.default.event;v={};for(var o in d)o!=="layerX"&&o!=="layerY"&&o!=="keyLocation"&&o!=="webkitMovementX"&&o!=="webkitMovementY"&&o!=="path"&&(o==="returnValue"&&d.preventDefault||(v[o]=d[o]));if(v.target||(v.target=v.srcElement||_.default),v.relatedTarget||(v.relatedTarget=v.fromElement===v.target?v.toElement:v.fromElement),v.preventDefault=function(){d.preventDefault&&d.preventDefault(),v.returnValue=!1,d.returnValue=!1,v.defaultPrevented=!0},v.defaultPrevented=!1,v.stopPropagation=function(){d.stopPropagation&&d.stopPropagation(),v.cancelBubble=!0,d.cancelBubble=!0,v.isPropagationStopped=T},v.isPropagationStopped=g,v.stopImmediatePropagation=function(){d.stopImmediatePropagation&&d.stopImmediatePropagation(),v.isImmediatePropagationStopped=T,v.stopPropagation()},v.isImmediatePropagationStopped=g,v.clientX!==null&&v.clientX!==void 0){var u=_.default.documentElement,y=_.default.body;v.pageX=v.clientX+(u&&u.scrollLeft||y&&y.scrollLeft||0)-(u&&u.clientLeft||y&&y.clientLeft||0),v.pageY=v.clientY+(u&&u.scrollTop||y&&y.scrollTop||0)-(u&&u.clientTop||y&&y.clientTop||0)}v.which=v.charCode||v.keyCode,v.button!==null&&v.button!==void 0&&(v.button=v.button&1?0:v.button&4?1:v.button&2?2:0)}return v.fixed_=!0,v}var Gs,Ks=function(){if(typeof Gs!="boolean"){Gs=!1;try{var T=Object.defineProperty({},"passive",{get:function(){Gs=!0}});m.default.addEventListener("test",null,T),m.default.removeEventListener("test",null,T)}catch{}}return Gs},Vl=["touchstart","touchmove"];function Gt(v,T,g){if(Array.isArray(T))return yr(Gt,v,T,g);Nt.has(v)||Nt.set(v,{});var d=Nt.get(v);if(d.handlers||(d.handlers={}),d.handlers[T]||(d.handlers[T]=[]),g.guid||(g.guid=hi()),d.handlers[T].push(g),d.dispatcher||(d.disabled=!1,d.dispatcher=function(u,y){if(!d.disabled){u=Tr(u);var w=d.handlers[u.type];if(w)for(var F=w.slice(0),$=0,K=F.length;$<K&&!u.isImmediatePropagationStopped();$++)try{F[$].call(v,u,y)}catch(W){Y.error(W)}}}),d.handlers[T].length===1)if(v.addEventListener){var o=!1;Ks()&&Vl.indexOf(T)>-1&&(o={passive:!0}),v.addEventListener(T,d.dispatcher,o)}else v.attachEvent&&v.attachEvent("on"+T,d.dispatcher)}function xt(v,T,g){if(Nt.has(v)){var d=Nt.get(v);if(d.handlers){if(Array.isArray(T))return yr(xt,v,T,g);var o=function($,K){d.handlers[K]=[],Ia($,K)};if(T===void 0){for(var u in d.handlers)Object.prototype.hasOwnProperty.call(d.handlers||{},u)&&o(v,u);return}var y=d.handlers[T];if(y){if(!g){o(v,T);return}if(g.guid)for(var w=0;w<y.length;w++)y[w].guid===g.guid&&y.splice(w--,1);Ia(v,T)}}}}function Ts(v,T,g){var d=Nt.has(v)?Nt.get(v):{},o=v.parentNode||v.ownerDocument;if(typeof T=="string"?T={type:T,target:v}:T.target||(T.target=v),T=Tr(T),d.dispatcher&&d.dispatcher.call(v,T,g),o&&!T.isPropagationStopped()&&T.bubbles===!0)Ts.call(null,o,T,g);else if(!o&&!T.defaultPrevented&&T.target&&T.target[T.type]){Nt.has(T.target)||Nt.set(T.target,{});var u=Nt.get(T.target);T.target[T.type]&&(u.disabled=!0,typeof T.target[T.type]=="function"&&T.target[T.type](),u.disabled=!1)}return!T.defaultPrevented}function _r(v,T,g){if(Array.isArray(T))return yr(_r,v,T,g);var d=function o(){xt(v,T,o),g.apply(this,arguments)};d.guid=g.guid=g.guid||hi(),Gt(v,T,d)}function La(v,T,g){var d=function o(){xt(v,T,o),g.apply(this,arguments)};d.guid=g.guid=g.guid||hi(),Gt(v,T,d)}var ka=Object.freeze({__proto__:null,fixEvent:Tr,on:Gt,off:xt,trigger:Ts,one:_r,any:La}),Yt=30,at=function(T,g,d){g.guid||(g.guid=hi());var o=g.bind(T);return o.guid=d?d+"_"+g.guid:g.guid,o},Ei=function(T,g){var d=m.default.performance.now(),o=function(){var y=m.default.performance.now();y-d>=g&&(T.apply(void 0,arguments),d=y)};return o},_e=function(T,g,d,o){o===void 0&&(o=m.default);var u,y=function(){o.clearTimeout(u),u=null},w=function(){var $=this,K=arguments,W=function(){u=null,W=null,T.apply($,K)};o.clearTimeout(u),u=o.setTimeout(W,g)};return w.cancel=y,w},U=function(){};U.prototype.allowedEvents_={},U.prototype.on=function(v,T){var g=this.addEventListener;this.addEventListener=function(){},Gt(this,v,T),this.addEventListener=g},U.prototype.addEventListener=U.prototype.on,U.prototype.off=function(v,T){xt(this,v,T)},U.prototype.removeEventListener=U.prototype.off,U.prototype.one=function(v,T){var g=this.addEventListener;this.addEventListener=function(){},_r(this,v,T),this.addEventListener=g},U.prototype.any=function(v,T){var g=this.addEventListener;this.addEventListener=function(){},La(this,v,T),this.addEventListener=g},U.prototype.trigger=function(v){var T=v.type||v;typeof v=="string"&&(v={type:T}),v=Tr(v),this.allowedEvents_[T]&&this["on"+T]&&this["on"+T](v),Ts(this,v)},U.prototype.dispatchEvent=U.prototype.trigger;var ve;U.prototype.queueTrigger=function(v){var T=this;ve||(ve=new Map);var g=v.type||v,d=ve.get(this);d||(d=new Map,ve.set(this,d));var o=d.get(g);d.delete(g),m.default.clearTimeout(o);var u=m.default.setTimeout(function(){d.delete(g),d.size===0&&(d=null,ve.delete(T)),T.trigger(v)},0);d.set(g,u)};var De=function(T){return typeof T.name=="function"?T.name():typeof T.name=="string"?T.name:T.name_?T.name_:T.constructor&&T.constructor.name?T.constructor.name:typeof T},Ne=function(T){return T instanceof U||!!T.eventBusEl_&&["on","one","off","trigger"].every(function(g){return typeof T[g]=="function"})},ut=function(T,g){Ne(T)?g():(T.eventedCallbacks||(T.eventedCallbacks=[]),T.eventedCallbacks.push(g))},tt=function(T){return typeof T=="string"&&/\S/.test(T)||Array.isArray(T)&&!!T.length},bi=function(T,g,d){if(!T||!T.nodeName&&!Ne(T))throw new Error("Invalid target for "+De(g)+"#"+d+"; must be a DOM node or evented object.")},_s=function(T,g,d){if(!tt(T))throw new Error("Invalid event type for "+De(g)+"#"+d+"; must be a non-empty string or array.")},Xe=function(T,g,d){if(typeof T!="function")throw new Error("Invalid listener for "+De(g)+"#"+d+"; must be a function.")},Xt=function(T,g,d){var o=g.length<3||g[0]===T||g[0]===T.eventBusEl_,u,y,w;return o?(u=T.eventBusEl_,g.length>=3&&g.shift(),y=g[0],w=g[1]):(u=g[0],y=g[1],w=g[2]),bi(u,T,d),_s(y,T,d),Xe(w,T,d),w=at(T,w),{isTargetingSelf:o,target:u,type:y,listener:w}},$t=function(T,g,d,o){bi(T,T,g),T.nodeName?ka[g](T,d,o):T[g](d,o)},yn={on:function(){for(var T=this,g=arguments.length,d=new Array(g),o=0;o<g;o++)d[o]=arguments[o];var u=Xt(this,d,"on"),y=u.isTargetingSelf,w=u.target,F=u.type,$=u.listener;if($t(w,"on",F,$),!y){var K=function(){return T.off(w,F,$)};K.guid=$.guid;var W=function(){return T.off("dispose",K)};W.guid=$.guid,$t(this,"on","dispose",K),$t(w,"on","dispose",W)}},one:function(){for(var T=this,g=arguments.length,d=new Array(g),o=0;o<g;o++)d[o]=arguments[o];var u=Xt(this,d,"one"),y=u.isTargetingSelf,w=u.target,F=u.type,$=u.listener;if(y)$t(w,"one",F,$);else{var K=function W(){T.off(w,F,W);for(var V=arguments.length,pe=new Array(V),we=0;we<V;we++)pe[we]=arguments[we];$.apply(null,pe)};K.guid=$.guid,$t(w,"one",F,K)}},any:function(){for(var T=this,g=arguments.length,d=new Array(g),o=0;o<g;o++)d[o]=arguments[o];var u=Xt(this,d,"any"),y=u.isTargetingSelf,w=u.target,F=u.type,$=u.listener;if(y)$t(w,"any",F,$);else{var K=function W(){T.off(w,F,W);for(var V=arguments.length,pe=new Array(V),we=0;we<V;we++)pe[we]=arguments[we];$.apply(null,pe)};K.guid=$.guid,$t(w,"any",F,K)}},off:function(T,g,d){if(!T||tt(T))xt(this.eventBusEl_,T,g);else{var o=T,u=g;bi(o,this,"off"),_s(u,this,"off"),Xe(d,this,"off"),d=at(this,d),this.off("dispose",d),o.nodeName?(xt(o,u,d),xt(o,"dispose",d)):Ne(o)&&(o.off(u,d),o.off("dispose",d))}},trigger:function(T,g){bi(this.eventBusEl_,this,"trigger");var d=T&&typeof T!="string"?T.type:T;if(!tt(d)){var o="Invalid event type for "+De(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(T)(this.log||Y).error(o);else throw new Error(o)}return Ts(this.eventBusEl_,T,g)}};function Tn(v,T){T===void 0&&(T={});var g=T,d=g.eventBusKey;if(d){if(!v[d].nodeName)throw new Error('The eventBusKey "'+d+'" does not refer to an element.');v.eventBusEl_=v[d]}else v.eventBusEl_=ke("span",{className:"vjs-event-bus"});return Pe(v,yn),v.eventedCallbacks&&v.eventedCallbacks.forEach(function(o){o()}),v.on("dispose",function(){v.off(),[v,v.el_,v.eventBusEl_].forEach(function(o){o&&Nt.has(o)&&Nt.delete(o)}),m.default.setTimeout(function(){v.eventBusEl_=null},0)}),v}var YT={state:{},setState:function(T){var g=this;typeof T=="function"&&(T=T());var d;return Re(T,function(o,u){g.state[u]!==o&&(d=d||{},d[u]={from:g.state[u],to:o}),g.state[u]=o}),d&&Ne(this)&&this.trigger({changes:d,type:"statechanged"}),d}};function zf(v,T){return Pe(v,YT),v.state=Pe({},v.state,T),typeof v.handleStateChanged=="function"&&Ne(v)&&v.on("statechanged",v.handleStateChanged),v}var Ra=function(T){return typeof T!="string"?T:T.replace(/./,function(g){return g.toLowerCase()})},Tt=function(T){return typeof T!="string"?T:T.replace(/./,function(g){return g.toUpperCase()})},XT=function(T,g){return Tt(T)===Tt(g)};function dt(){for(var v={},T=arguments.length,g=new Array(T),d=0;d<T;d++)g[d]=arguments[d];return g.forEach(function(o){o&&Re(o,function(u,y){if(!Ve(u)){v[y]=u;return}Ve(v[y])||(v[y]={}),v[y]=dt(v[y],u)})}),v}var QT=function(){function v(){this.map_={}}var T=v.prototype;return T.has=function(d){return d in this.map_},T.delete=function(d){var o=this.has(d);return delete this.map_[d],o},T.set=function(d,o){return this.map_[d]=o,this},T.forEach=function(d,o){for(var u in this.map_)d.call(o,this.map_[u],u,this)},v}(),JT=m.default.Map?m.default.Map:QT,ZT=function(){function v(){this.set_={}}var T=v.prototype;return T.has=function(d){return d in this.set_},T.delete=function(d){var o=this.has(d);return delete this.set_[d],o},T.add=function(d){return this.set_[d]=1,this},T.forEach=function(d,o){for(var u in this.set_)d.call(o,u,u,this)},v}(),Gl=m.default.Set?m.default.Set:ZT,ge=function(){function v(g,d,o){var u=this;if(!g&&this.play?this.player_=g=this:this.player_=g,this.isDisposed_=!1,this.parentComponent_=null,this.options_=dt({},this.options_),d=this.options_=dt(this.options_,d),this.id_=d.id||d.el&&d.el.id,!this.id_){var y=g&&g.id&&g.id()||"no_player";this.id_=y+"_component_"+hi()}this.name_=d.name||null,d.el?this.el_=d.el:d.createEl!==!1&&(this.el_=this.createEl()),d.className&&this.el_&&d.className.split(" ").forEach(function(w){return u.addClass(w)}),d.evented!==!1&&(Tn(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),zf(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Gl,this.setIntervalIds_=new Gl,this.rafIds_=new Gl,this.namedRafs_=new JT,this.clearingTimersOnDispose_=!1,d.initChildren!==!1&&this.initChildren(),this.ready(o),d.reportTouchActivity!==!1&&this.enableTouchActivity()}var T=v.prototype;return T.dispose=function(d){if(d===void 0&&(d={}),!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var o=this.children_.length-1;o>=0;o--)this.children_[o].dispose&&this.children_[o].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(d.restoreEl?this.el_.parentNode.replaceChild(d.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}},T.isDisposed=function(){return!!this.isDisposed_},T.player=function(){return this.player_},T.options=function(d){return d?(this.options_=dt(this.options_,d),this.options_):this.options_},T.el=function(){return this.el_},T.createEl=function(d,o,u){return ke(d,o,u)},T.localize=function(d,o,u){u===void 0&&(u=d);var y=this.player_.language&&this.player_.language(),w=this.player_.languages&&this.player_.languages(),F=w&&w[y],$=y&&y.split("-")[0],K=w&&w[$],W=u;return F&&F[d]?W=F[d]:K&&K[d]&&(W=K[d]),o&&(W=W.replace(/\{(\d+)\}/g,function(V,pe){var we=o[pe-1],We=we;return typeof we>"u"&&(We=V),We})),W},T.handleLanguagechange=function(){},T.contentEl=function(){return this.contentEl_||this.el_},T.id=function(){return this.id_},T.name=function(){return this.name_},T.children=function(){return this.children_},T.getChildById=function(d){return this.childIndex_[d]},T.getChild=function(d){if(d)return this.childNameIndex_[d]},T.getDescendant=function(){for(var d=arguments.length,o=new Array(d),u=0;u<d;u++)o[u]=arguments[u];o=o.reduce(function(F,$){return F.concat($)},[]);for(var y=this,w=0;w<o.length;w++)if(y=y.getChild(o[w]),!y||!y.getChild)return;return y},T.addChild=function(d,o,u){o===void 0&&(o={}),u===void 0&&(u=this.children_.length);var y,w;if(typeof d=="string"){w=Tt(d);var F=o.componentClass||w;o.name=w;var $=v.getComponent(F);if(!$)throw new Error("Component "+F+" does not exist");if(typeof $!="function")return null;y=new $(this.player_||this,o)}else y=d;if(y.parentComponent_&&y.parentComponent_.removeChild(y),this.children_.splice(u,0,y),y.parentComponent_=this,typeof y.id=="function"&&(this.childIndex_[y.id()]=y),w=w||y.name&&Tt(y.name()),w&&(this.childNameIndex_[w]=y,this.childNameIndex_[Ra(w)]=y),typeof y.el=="function"&&y.el()){var K=null;this.children_[u+1]&&(this.children_[u+1].el_?K=this.children_[u+1].el_:Me(this.children_[u+1])&&(K=this.children_[u+1])),this.contentEl().insertBefore(y.el(),K)}return y},T.removeChild=function(d){if(typeof d=="string"&&(d=this.getChild(d)),!(!d||!this.children_)){for(var o=!1,u=this.children_.length-1;u>=0;u--)if(this.children_[u]===d){o=!0,this.children_.splice(u,1);break}if(o){d.parentComponent_=null,this.childIndex_[d.id()]=null,this.childNameIndex_[Tt(d.name())]=null,this.childNameIndex_[Ra(d.name())]=null;var y=d.el();y&&y.parentNode===this.contentEl()&&this.contentEl().removeChild(d.el())}}},T.initChildren=function(){var d=this,o=this.options_.children;if(o){var u=this.options_,y=function(K){var W=K.name,V=K.opts;if(u[W]!==void 0&&(V=u[W]),V!==!1){V===!0&&(V={}),V.playerOptions=d.options_.playerOptions;var pe=d.addChild(W,V);pe&&(d[W]=pe)}},w,F=v.getComponent("Tech");Array.isArray(o)?w=o:w=Object.keys(o),w.concat(Object.keys(this.options_).filter(function($){return!w.some(function(K){return typeof K=="string"?$===K:$===K.name})})).map(function($){var K,W;return typeof $=="string"?(K=$,W=o[K]||d.options_[K]||{}):(K=$.name,W=$),{name:K,opts:W}}).filter(function($){var K=v.getComponent($.opts.componentClass||Tt($.name));return K&&!F.isTech(K)}).forEach(y)}},T.buildCSSClass=function(){return""},T.ready=function(d,o){if(o===void 0&&(o=!1),!!d){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(d);return}o?d.call(this):this.setTimeout(d,1)}},T.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var d=this.readyQueue_;this.readyQueue_=[],d&&d.length>0&&d.forEach(function(o){o.call(this)},this),this.trigger("ready")},1)},T.$=function(d,o){return Di(d,o||this.contentEl())},T.$$=function(d,o){return Ea(d,o||this.contentEl())},T.hasClass=function(d){return Qi(this.el_,d)},T.addClass=function(d){_i(this.el_,d)},T.removeClass=function(d){js(this.el_,d)},T.toggleClass=function(d,o){cn(this.el_,d,o)},T.show=function(){this.removeClass("vjs-hidden")},T.hide=function(){this.addClass("vjs-hidden")},T.lockShowing=function(){this.addClass("vjs-lock-showing")},T.unlockShowing=function(){this.removeClass("vjs-lock-showing")},T.getAttribute=function(d){return ga(this.el_,d)},T.setAttribute=function(d,o){gs(this.el_,d,o)},T.removeAttribute=function(d){mr(this.el_,d)},T.width=function(d,o){return this.dimension("width",d,o)},T.height=function(d,o){return this.dimension("height",d,o)},T.dimensions=function(d,o){this.width(d,!0),this.height(o)},T.dimension=function(d,o,u){if(o!==void 0){(o===null||o!==o)&&(o=0),(""+o).indexOf("%")!==-1||(""+o).indexOf("px")!==-1?this.el_.style[d]=o:o==="auto"?this.el_.style[d]="":this.el_.style[d]=o+"px",u||this.trigger("componentresize");return}if(!this.el_)return 0;var y=this.el_.style[d],w=y.indexOf("px");return parseInt(w!==-1?y.slice(0,w):this.el_["offset"+Tt(d)],10)},T.currentDimension=function(d){var o=0;if(d!=="width"&&d!=="height")throw new Error("currentDimension only accepts width or height value");if(o=Je(this.el_,d),o=parseFloat(o),o===0||isNaN(o)){var u="offset"+Tt(d);o=this.el_[u]}return o},T.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},T.currentWidth=function(){return this.currentDimension("width")},T.currentHeight=function(){return this.currentDimension("height")},T.focus=function(){this.el_.focus()},T.blur=function(){this.el_.blur()},T.handleKeyDown=function(d){this.player_&&(S.default.isEventKey(d,"Tab")||d.stopPropagation(),this.player_.handleKeyDown(d))},T.handleKeyPress=function(d){this.handleKeyDown(d)},T.emitTapEvents=function(){var d=0,o=null,u=10,y=200,w;this.on("touchstart",function($){$.touches.length===1&&(o={pageX:$.touches[0].pageX,pageY:$.touches[0].pageY},d=m.default.performance.now(),w=!0)}),this.on("touchmove",function($){if($.touches.length>1)w=!1;else if(o){var K=$.touches[0].pageX-o.pageX,W=$.touches[0].pageY-o.pageY,V=Math.sqrt(K*K+W*W);V>u&&(w=!1)}});var F=function(){w=!1};this.on("touchleave",F),this.on("touchcancel",F),this.on("touchend",function($){if(o=null,w===!0){var K=m.default.performance.now()-d;K<y&&($.preventDefault(),this.trigger("tap"))}})},T.enableTouchActivity=function(){if(!(!this.player()||!this.player().reportUserActivity)){var d=at(this.player(),this.player().reportUserActivity),o;this.on("touchstart",function(){d(),this.clearInterval(o),o=this.setInterval(d,250)});var u=function(w){d(),this.clearInterval(o)};this.on("touchmove",d),this.on("touchend",u),this.on("touchcancel",u)}},T.setTimeout=function(d,o){var u=this,y;return d=at(this,d),this.clearTimersOnDispose_(),y=m.default.setTimeout(function(){u.setTimeoutIds_.has(y)&&u.setTimeoutIds_.delete(y),d()},o),this.setTimeoutIds_.add(y),y},T.clearTimeout=function(d){return this.setTimeoutIds_.has(d)&&(this.setTimeoutIds_.delete(d),m.default.clearTimeout(d)),d},T.setInterval=function(d,o){d=at(this,d),this.clearTimersOnDispose_();var u=m.default.setInterval(d,o);return this.setIntervalIds_.add(u),u},T.clearInterval=function(d){return this.setIntervalIds_.has(d)&&(this.setIntervalIds_.delete(d),m.default.clearInterval(d)),d},T.requestAnimationFrame=function(d){var o=this;if(!this.supportsRaf_)return this.setTimeout(d,1e3/60);this.clearTimersOnDispose_();var u;return d=at(this,d),u=m.default.requestAnimationFrame(function(){o.rafIds_.has(u)&&o.rafIds_.delete(u),d()}),this.rafIds_.add(u),u},T.requestNamedAnimationFrame=function(d,o){var u=this;if(!this.namedRafs_.has(d)){this.clearTimersOnDispose_(),o=at(this,o);var y=this.requestAnimationFrame(function(){o(),u.namedRafs_.has(d)&&u.namedRafs_.delete(d)});return this.namedRafs_.set(d,y),d}},T.cancelNamedAnimationFrame=function(d){this.namedRafs_.has(d)&&(this.cancelAnimationFrame(this.namedRafs_.get(d)),this.namedRafs_.delete(d))},T.cancelAnimationFrame=function(d){return this.supportsRaf_?(this.rafIds_.has(d)&&(this.rafIds_.delete(d),m.default.cancelAnimationFrame(d)),d):this.clearTimeout(d)},T.clearTimersOnDispose_=function(){var d=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(o){var u=o[0],y=o[1];d[u].forEach(function(w,F){return d[y](F)})}),d.clearingTimersOnDispose_=!1}))},v.registerComponent=function(d,o){if(typeof d!="string"||!d)throw new Error('Illegal component name, "'+d+'"; must be a non-empty string.');var u=v.getComponent("Tech"),y=u&&u.isTech(o),w=v===o||v.prototype.isPrototypeOf(o.prototype);if(y||!w){var F;throw y?F="techs must be registered using Tech.registerTech()":F="must be a Component subclass",new Error('Illegal component, "'+d+'"; '+F+".")}d=Tt(d),v.components_||(v.components_={});var $=v.getComponent("Player");if(d==="Player"&&$&&$.players){var K=$.players,W=Object.keys(K);if(K&&W.length>0&&W.map(function(V){return K[V]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return v.components_[d]=o,v.components_[Ra(d)]=o,o},v.getComponent=function(d){if(!(!d||!v.components_))return v.components_[d]},v}();ge.prototype.supportsRaf_=typeof m.default.requestAnimationFrame=="function"&&typeof m.default.cancelAnimationFrame=="function",ge.registerComponent("Component",ge);function e_(v,T,g){if(typeof T!="number"||T<0||T>g)throw new Error("Failed to execute '"+v+"' on 'TimeRanges': The index provided ("+T+") is non-numeric or out of bounds (0-"+g+").")}function Yf(v,T,g,d){return e_(v,d,g.length-1),g[d][T]}function Kl(v){var T;return v===void 0||v.length===0?T={length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:T={length:v.length,start:Yf.bind(null,"start",0,v),end:Yf.bind(null,"end",1,v)},m.default.Symbol&&m.default.Symbol.iterator&&(T[m.default.Symbol.iterator]=function(){return(v||[]).values()}),T}function qs(v,T){return Array.isArray(v)?Kl(v):v===void 0||T===void 0?Kl():Kl([[v,T]])}function Xf(v,T){var g=0,d,o;if(!T)return 0;(!v||!v.length)&&(v=qs(0,0));for(var u=0;u<v.length;u++)d=v.start(u),o=v.end(u),o>T&&(o=T),g+=o-d;return g/T}function Kt(v){if(v instanceof Kt)return v;typeof v=="number"?this.code=v:typeof v=="string"?this.message=v:Be(v)&&(typeof v.code=="number"&&(this.code=v.code),Pe(this,v)),this.message||(this.message=Kt.defaultMessages[this.code]||"")}Kt.prototype.code=0,Kt.prototype.message="",Kt.prototype.status=null,Kt.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],Kt.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var Er=0;Er<Kt.errorTypes.length;Er++)Kt[Kt.errorTypes[Er]]=Er,Kt.prototype[Kt.errorTypes[Er]]=Er;function _n(v){return v!=null&&typeof v.then=="function"}function xi(v){_n(v)&&v.then(null,function(T){})}var ql=function(T){var g=["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(d,o,u){return T[o]&&(d[o]=T[o]),d},{cues:T.cues&&Array.prototype.map.call(T.cues,function(d){return{startTime:d.startTime,endTime:d.endTime,text:d.text,id:d.id}})});return g},t_=function(T){var g=T.$$("track"),d=Array.prototype.map.call(g,function(u){return u.track}),o=Array.prototype.map.call(g,function(u){var y=ql(u.track);return u.src&&(y.src=u.src),y});return o.concat(Array.prototype.filter.call(T.textTracks(),function(u){return d.indexOf(u)===-1}).map(ql))},i_=function(T,g){return T.forEach(function(d){var o=g.addRemoteTextTrack(d).track;!d.src&&d.cues&&d.cues.forEach(function(u){return o.addCue(u)})}),g.textTracks()},Qf={textTracksToJson:t_,jsonToTextTracks:i_,trackToJson_:ql},Wl="vjs-modal-dialog",br=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.handleKeyDown_=function(y){return u.handleKeyDown(y)},u.close_=function(y){return u.close(y)},u.opened_=u.hasBeenOpened_=u.hasBeenFilled_=!1,u.closeable(!u.options_.uncloseable),u.content(u.options_.content),u.contentEl_=ke("div",{className:Wl+"-content"},{role:"document"}),u.descEl_=ke("p",{className:Wl+"-description vjs-control-text",id:u.el().getAttribute("aria-describedby")}),qe(u.descEl_,u.description()),u.el_.appendChild(u.descEl_),u.el_.appendChild(u.contentEl_),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},g.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,v.prototype.dispose.call(this)},g.buildCSSClass=function(){return Wl+" vjs-hidden "+v.prototype.buildCSSClass.call(this)},g.label=function(){return this.localize(this.options_.label||"Modal Window")},g.description=function(){var o=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(o+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),o},g.open=function(){if(!this.opened_){var o=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!o.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&o.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=o.controls(),o.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},g.opened=function(o){return typeof o=="boolean"&&this[o?"open":"close"](),this.opened_},g.close=function(){if(this.opened_){var o=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&o.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&o.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},g.closeable=function(o){if(typeof o=="boolean"){var u=this.closeable_=!!o,y=this.getChild("closeButton");if(u&&!y){var w=this.contentEl_;this.contentEl_=this.el_,y=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=w,this.on(y,"close",this.close_)}!u&&y&&(this.off(y,"close",this.close_),this.removeChild(y),y.dispose())}return this.closeable_},g.fill=function(){this.fillWith(this.content())},g.fillWith=function(o){var u=this.contentEl(),y=u.parentNode,w=u.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,y.removeChild(u),this.empty(),_a(u,o),this.trigger("modalfill"),w?y.insertBefore(u,w):y.appendChild(u);var F=this.getChild("closeButton");F&&y.appendChild(F.el_)},g.empty=function(){this.trigger("beforemodalempty"),dn(this.contentEl()),this.trigger("modalempty")},g.content=function(o){return typeof o<"u"&&(this.content_=o),this.content_},g.conditionalFocus_=function(){var o=_.default.activeElement,u=this.player_.el_;this.previouslyActiveEl_=null,(u.contains(o)||u===o)&&(this.previouslyActiveEl_=o,this.focus())},g.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},g.handleKeyDown=function(o){if(o.stopPropagation(),S.default.isEventKey(o,"Escape")&&this.closeable()){o.preventDefault(),this.close();return}if(S.default.isEventKey(o,"Tab")){for(var u=this.focusableEls_(),y=this.el_.querySelector(":focus"),w,F=0;F<u.length;F++)if(y===u[F]){w=F;break}_.default.activeElement===this.el_&&(w=0),o.shiftKey&&w===0?(u[u.length-1].focus(),o.preventDefault()):!o.shiftKey&&w===u.length-1&&(u[0].focus(),o.preventDefault())}},g.focusableEls_=function(){var o=this.el_.querySelectorAll("*");return Array.prototype.filter.call(o,function(u){return(u instanceof m.default.HTMLAnchorElement||u instanceof m.default.HTMLAreaElement)&&u.hasAttribute("href")||(u instanceof m.default.HTMLInputElement||u instanceof m.default.HTMLSelectElement||u instanceof m.default.HTMLTextAreaElement||u instanceof m.default.HTMLButtonElement)&&!u.hasAttribute("disabled")||u instanceof m.default.HTMLIFrameElement||u instanceof m.default.HTMLObjectElement||u instanceof m.default.HTMLEmbedElement||u.hasAttribute("tabindex")&&u.getAttribute("tabindex")!==-1||u.hasAttribute("contenteditable")})},T}(ge);br.prototype.options_={pauseOnOpen:!0,temporary:!0},ge.registerComponent("ModalDialog",br);var Sr=function(v){I.default(T,v);function T(d){var o;d===void 0&&(d=[]),o=v.call(this)||this,o.tracks_=[],Object.defineProperty(C.default(o),"length",{get:function(){return this.tracks_.length}});for(var u=0;u<d.length;u++)o.addTrack(d[u]);return o}var g=T.prototype;return g.addTrack=function(o){var u=this,y=this.tracks_.length;""+y in this||Object.defineProperty(this,y,{get:function(){return this.tracks_[y]}}),this.tracks_.indexOf(o)===-1&&(this.tracks_.push(o),this.trigger({track:o,type:"addtrack",target:this})),o.labelchange_=function(){u.trigger({track:o,type:"labelchange",target:u})},Ne(o)&&o.addEventListener("labelchange",o.labelchange_)},g.removeTrack=function(o){for(var u,y=0,w=this.length;y<w;y++)if(this[y]===o){u=this[y],u.off&&u.off(),this.tracks_.splice(y,1);break}u&&this.trigger({track:u,type:"removetrack",target:this})},g.getTrackById=function(o){for(var u=null,y=0,w=this.length;y<w;y++){var F=this[y];if(F.id===o){u=F;break}}return u},T}(U);Sr.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(var s_ in Sr.prototype.allowedEvents_)Sr.prototype["on"+s_]=null;var zl=function(T,g){for(var d=0;d<T.length;d++)!Object.keys(T[d]).length||g.id===T[d].id||(T[d].enabled=!1)},r_=function(v){I.default(T,v);function T(d){var o;d===void 0&&(d=[]);for(var u=d.length-1;u>=0;u--)if(d[u].enabled){zl(d,d[u]);break}return o=v.call(this,d)||this,o.changing_=!1,o}var g=T.prototype;return g.addTrack=function(o){var u=this;o.enabled&&zl(this,o),v.prototype.addTrack.call(this,o),o.addEventListener&&(o.enabledChange_=function(){u.changing_||(u.changing_=!0,zl(u,o),u.changing_=!1,u.trigger("change"))},o.addEventListener("enabledchange",o.enabledChange_))},g.removeTrack=function(o){v.prototype.removeTrack.call(this,o),o.removeEventListener&&o.enabledChange_&&(o.removeEventListener("enabledchange",o.enabledChange_),o.enabledChange_=null)},T}(Sr),Yl=function(T,g){for(var d=0;d<T.length;d++)!Object.keys(T[d]).length||g.id===T[d].id||(T[d].selected=!1)},n_=function(v){I.default(T,v);function T(d){var o;d===void 0&&(d=[]);for(var u=d.length-1;u>=0;u--)if(d[u].selected){Yl(d,d[u]);break}return o=v.call(this,d)||this,o.changing_=!1,Object.defineProperty(C.default(o),"selectedIndex",{get:function(){for(var w=0;w<this.length;w++)if(this[w].selected)return w;return-1},set:function(){}}),o}var g=T.prototype;return g.addTrack=function(o){var u=this;o.selected&&Yl(this,o),v.prototype.addTrack.call(this,o),o.addEventListener&&(o.selectedChange_=function(){u.changing_||(u.changing_=!0,Yl(u,o),u.changing_=!1,u.trigger("change"))},o.addEventListener("selectedchange",o.selectedChange_))},g.removeTrack=function(o){v.prototype.removeTrack.call(this,o),o.removeEventListener&&o.selectedChange_&&(o.removeEventListener("selectedchange",o.selectedChange_),o.selectedChange_=null)},T}(Sr),Jf=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.addTrack=function(o){var u=this;v.prototype.addTrack.call(this,o),this.queueChange_||(this.queueChange_=function(){return u.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return u.trigger("selectedlanguagechange")}),o.addEventListener("modechange",this.queueChange_);var y=["metadata","chapters"];y.indexOf(o.kind)===-1&&o.addEventListener("modechange",this.triggerSelectedlanguagechange_)},g.removeTrack=function(o){v.prototype.removeTrack.call(this,o),o.removeEventListener&&(this.queueChange_&&o.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&o.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},T}(Sr),a_=function(){function v(g){g===void 0&&(g=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var d=0,o=g.length;d<o;d++)this.addTrackElement_(g[d])}var T=v.prototype;return T.addTrackElement_=function(d){var o=this.trackElements_.length;""+o in this||Object.defineProperty(this,o,{get:function(){return this.trackElements_[o]}}),this.trackElements_.indexOf(d)===-1&&this.trackElements_.push(d)},T.getTrackElementByTrack_=function(d){for(var o,u=0,y=this.trackElements_.length;u<y;u++)if(d===this.trackElements_[u].track){o=this.trackElements_[u];break}return o},T.removeTrackElement_=function(d){for(var o=0,u=this.trackElements_.length;o<u;o++)if(d===this.trackElements_[o]){this.trackElements_[o].track&&typeof this.trackElements_[o].track.off=="function"&&this.trackElements_[o].track.off(),typeof this.trackElements_[o].off=="function"&&this.trackElements_[o].off(),this.trackElements_.splice(o,1);break}},v}(),Zf=function(){function v(g){v.prototype.setCues_.call(this,g),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var T=v.prototype;return T.setCues_=function(d){var o=this.length||0,u=0,y=d.length;this.cues_=d,this.length_=d.length;var w=function($){""+$ in this||Object.defineProperty(this,""+$,{get:function(){return this.cues_[$]}})};if(o<y)for(u=o;u<y;u++)w.call(this,u)},T.getCueById=function(d){for(var o=null,u=0,y=this.length;u<y;u++){var w=this[u];if(w.id===d){o=w;break}}return o},v}(),o_={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},l_={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},u_={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},ep={disabled:"disabled",hidden:"hidden",showing:"showing"},Xl=function(v){I.default(T,v);function T(g){var d;g===void 0&&(g={}),d=v.call(this)||this;var o={id:g.id||"vjs_track_"+hi(),kind:g.kind||"",language:g.language||""},u=g.label||"",y=function($){Object.defineProperty(C.default(d),$,{get:function(){return o[$]},set:function(){}})};for(var w in o)y(w);return Object.defineProperty(C.default(d),"label",{get:function(){return u},set:function($){$!==u&&(u=$,this.trigger("labelchange"))}}),d}return T}(U),Ql=function(T){var g=["protocol","hostname","port","pathname","search","hash","host"],d=_.default.createElement("a");d.href=T;for(var o={},u=0;u<g.length;u++)o[g[u]]=d[g[u]];return o.protocol==="http:"&&(o.host=o.host.replace(/:80$/,"")),o.protocol==="https:"&&(o.host=o.host.replace(/:443$/,"")),o.protocol||(o.protocol=m.default.location.protocol),o.host||(o.host=m.default.location.host),o},tp=function(T){if(!T.match(/^https?:\/\//)){var g=_.default.createElement("a");g.href=T,T=g.href}return T},Jl=function(T){if(typeof T=="string"){var g=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/,d=g.exec(T);if(d)return d.pop().toLowerCase()}return""},Pa=function(T,g){g===void 0&&(g=m.default.location);var d=Ql(T),o=d.protocol===":"?g.protocol:d.protocol,u=o+d.host!==g.protocol+g.host;return u},h_=Object.freeze({__proto__:null,parseUrl:Ql,getAbsoluteURL:tp,getFileExtension:Jl,isCrossOrigin:Pa}),ip=function(T,g){var d=new m.default.WebVTT.Parser(m.default,m.default.vttjs,m.default.WebVTT.StringDecoder()),o=[];d.oncue=function(u){g.addCue(u)},d.onparsingerror=function(u){o.push(u)},d.onflush=function(){g.trigger({type:"loadeddata",target:g})},d.parse(T),o.length>0&&(m.default.console&&m.default.console.groupCollapsed&&m.default.console.groupCollapsed("Text Track parsing errors for "+g.src),o.forEach(function(u){return Y.error(u)}),m.default.console&&m.default.console.groupEnd&&m.default.console.groupEnd()),d.flush()},sp=function(T,g){var d={uri:T},o=Pa(T);o&&(d.cors=o);var u=g.tech_.crossOrigin()==="use-credentials";u&&(d.withCredentials=u),k.default(d,at(this,function(y,w,F){if(y)return Y.error(y,w);g.loaded_=!0,typeof m.default.WebVTT!="function"?g.tech_&&g.tech_.any(["vttjsloaded","vttjserror"],function($){if($.type==="vttjserror"){Y.error("vttjs failed to load, stopping trying to process "+g.src);return}return ip(F,g)}):ip(F,g)}))},En=function(v){I.default(T,v);function T(d){var o;if(d===void 0&&(d={}),!d.tech)throw new Error("A tech was not provided.");var u=dt(d,{kind:u_[d.kind]||"subtitles",language:d.language||d.srclang||""}),y=ep[u.mode]||"disabled",w=u.default;(u.kind==="metadata"||u.kind==="chapters")&&(y="hidden"),o=v.call(this,u)||this,o.tech_=u.tech,o.cues_=[],o.activeCues_=[],o.preload_=o.tech_.preloadTextTracks!==!1;var F=new Zf(o.cues_),$=new Zf(o.activeCues_),K=!1;o.timeupdateHandler=at(C.default(o),function(V){if(V===void 0&&(V={}),!this.tech_.isDisposed()){if(!this.tech_.isReady_){V.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,K&&(this.trigger("cuechange"),K=!1),V.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});var W=function(){o.stopTracking()};return o.tech_.one("dispose",W),y!=="disabled"&&o.startTracking(),Object.defineProperties(C.default(o),{default:{get:function(){return w},set:function(){}},mode:{get:function(){return y},set:function(pe){ep[pe]&&y!==pe&&(y=pe,!this.preload_&&y!=="disabled"&&this.cues.length===0&&sp(this.src,this),this.stopTracking(),y!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?F:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(this.cues.length===0)return $;for(var pe=this.tech_.currentTime(),we=[],We=0,Xs=this.cues.length;We<Xs;We++){var Mi=this.cues[We];(Mi.startTime<=pe&&Mi.endTime>=pe||Mi.startTime===Mi.endTime&&Mi.startTime<=pe&&Mi.startTime+.5>=pe)&&we.push(Mi)}if(K=!1,we.length!==this.activeCues_.length)K=!0;else for(var Lu=0;Lu<we.length;Lu++)this.activeCues_.indexOf(we[Lu])===-1&&(K=!0);return this.activeCues_=we,$.setCues_(this.activeCues_),$},set:function(){}}}),u.src?(o.src=u.src,o.preload_||(o.loaded_=!0),(o.preload_||u.kind!=="subtitles"&&u.kind!=="captions")&&sp(o.src,C.default(o))):o.loaded_=!0,o}var g=T.prototype;return g.startTracking=function(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)},g.stopTracking=function(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)},g.addCue=function(o){var u=o;if(!("getCueAsHTML"in u)){u=new m.default.vttjs.VTTCue(o.startTime,o.endTime,o.text);for(var y in o)y in u||(u[y]=o[y]);u.id=o.id,u.originalCue_=o}for(var w=this.tech_.textTracks(),F=0;F<w.length;F++)w[F]!==this&&w[F].removeCue(u);this.cues_.push(u),this.cues.setCues_(this.cues_)},g.removeCue=function(o){for(var u=this.cues_.length;u--;){var y=this.cues_[u];if(y===o||y.originalCue_&&y.originalCue_===o){this.cues_.splice(u,1),this.cues.setCues_(this.cues_);break}}},T}(Xl);En.prototype.allowedEvents_={cuechange:"cuechange"};var rp=function(v){I.default(T,v);function T(g){var d;g===void 0&&(g={});var o=dt(g,{kind:l_[g.kind]||""});d=v.call(this,o)||this;var u=!1;return Object.defineProperty(C.default(d),"enabled",{get:function(){return u},set:function(w){typeof w!="boolean"||w===u||(u=w,this.trigger("enabledchange"))}}),o.enabled&&(d.enabled=o.enabled),d.loaded_=!0,d}return T}(Xl),np=function(v){I.default(T,v);function T(g){var d;g===void 0&&(g={});var o=dt(g,{kind:o_[g.kind]||""});d=v.call(this,o)||this;var u=!1;return Object.defineProperty(C.default(d),"selected",{get:function(){return u},set:function(w){typeof w!="boolean"||w===u||(u=w,this.trigger("selectedchange"))}}),o.selected&&(d.selected=o.selected),d}return T}(Xl),ap=0,c_=1,op=2,d_=3,Cr=function(v){I.default(T,v);function T(g){var d;g===void 0&&(g={}),d=v.call(this)||this;var o,u=new En(g);return d.kind=u.kind,d.src=u.src,d.srclang=u.language,d.label=u.label,d.default=u.default,Object.defineProperties(C.default(d),{readyState:{get:function(){return o}},track:{get:function(){return u}}}),o=ap,u.addEventListener("loadeddata",function(){o=op,d.trigger({type:"load",target:C.default(d)})}),d}return T}(U);Cr.prototype.allowedEvents_={load:"load"},Cr.NONE=ap,Cr.LOADING=c_,Cr.LOADED=op,Cr.ERROR=d_;var ci={audio:{ListClass:r_,TrackClass:rp,capitalName:"Audio"},video:{ListClass:n_,TrackClass:np,capitalName:"Video"},text:{ListClass:Jf,TrackClass:En,capitalName:"Text"}};Object.keys(ci).forEach(function(v){ci[v].getterName=v+"Tracks",ci[v].privateName=v+"Tracks_"});var wr={remoteText:{ListClass:Jf,TrackClass:En,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:a_,TrackClass:Cr,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},qt=E.default({},ci,wr);wr.names=Object.keys(wr),ci.names=Object.keys(ci),qt.names=[].concat(wr.names).concat(ci.names);function f_(v,T,g,d,o){o===void 0&&(o={});var u=v.textTracks();o.kind=T,g&&(o.label=g),d&&(o.language=d),o.tech=v;var y=new qt.text.TrackClass(o);return u.addTrack(y),y}var ot=function(v){I.default(T,v);function T(d,o){var u;return d===void 0&&(d={}),o===void 0&&(o=function(){}),d.reportTouchActivity=!1,u=v.call(this,null,d,o)||this,u.onDurationChange_=function(y){return u.onDurationChange(y)},u.trackProgress_=function(y){return u.trackProgress(y)},u.trackCurrentTime_=function(y){return u.trackCurrentTime(y)},u.stopTrackingCurrentTime_=function(y){return u.stopTrackingCurrentTime(y)},u.disposeSourceHandler_=function(y){return u.disposeSourceHandler(y)},u.queuedHanders_=new Set,u.hasStarted_=!1,u.on("playing",function(){this.hasStarted_=!0}),u.on("loadstart",function(){this.hasStarted_=!1}),qt.names.forEach(function(y){var w=qt[y];d&&d[w.getterName]&&(u[w.privateName]=d[w.getterName])}),u.featuresProgressEvents||u.manualProgressOn(),u.featuresTimeupdateEvents||u.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(y){d["native"+y+"Tracks"]===!1&&(u["featuresNative"+y+"Tracks"]=!1)}),d.nativeCaptions===!1||d.nativeTextTracks===!1?u.featuresNativeTextTracks=!1:(d.nativeCaptions===!0||d.nativeTextTracks===!0)&&(u.featuresNativeTextTracks=!0),u.featuresNativeTextTracks||u.emulateTextTracks(),u.preloadTextTracks=d.preloadTextTracks!==!1,u.autoRemoteTextTracks_=new qt.text.ListClass,u.initTrackListeners(),d.nativeControlsForTouch||u.emitTapEvents(),u.constructor&&(u.name_=u.constructor.name||"Unknown Tech"),u}var g=T.prototype;return g.triggerSourceset=function(o){var u=this;this.isReady_||this.one("ready",function(){return u.setTimeout(function(){return u.triggerSourceset(o)},1)}),this.trigger({src:o,type:"sourceset"})},g.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},g.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},g.trackProgress=function(o){this.stopTrackingProgress(),this.progressInterval=this.setInterval(at(this,function(){var u=this.bufferedPercent();this.bufferedPercent_!==u&&this.trigger("progress"),this.bufferedPercent_=u,u===1&&this.stopTrackingProgress()}),500)},g.onDurationChange=function(o){this.duration_=this.duration()},g.buffered=function(){return qs(0,0)},g.bufferedPercent=function(){return Xf(this.buffered(),this.duration_)},g.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},g.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},g.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},g.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},g.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},g.dispose=function(){this.clearTracks(ci.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),v.prototype.dispose.call(this)},g.clearTracks=function(o){var u=this;o=[].concat(o),o.forEach(function(y){for(var w=u[y+"Tracks"]()||[],F=w.length;F--;){var $=w[F];y==="text"&&u.removeRemoteTextTrack($),w.removeTrack($)}})},g.cleanupAutoTextTracks=function(){for(var o=this.autoRemoteTextTracks_||[],u=o.length;u--;){var y=o[u];this.removeRemoteTextTrack(y)}},g.reset=function(){},g.crossOrigin=function(){},g.setCrossOrigin=function(){},g.error=function(o){return o!==void 0&&(this.error_=new Kt(o),this.trigger("error")),this.error_},g.played=function(){return this.hasStarted_?qs(0,0):qs()},g.play=function(){},g.setScrubbing=function(){},g.scrubbing=function(){},g.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},g.initTrackListeners=function(){var o=this;ci.names.forEach(function(u){var y=ci[u],w=function(){o.trigger(u+"trackchange")},F=o[y.getterName]();F.addEventListener("removetrack",w),F.addEventListener("addtrack",w),o.on("dispose",function(){F.removeEventListener("removetrack",w),F.removeEventListener("addtrack",w)})})},g.addWebVttScript_=function(){var o=this;if(!m.default.WebVTT)if(_.default.body.contains(this.el())){if(!this.options_["vtt.js"]&&Ve(D.default)&&Object.keys(D.default).length>0){this.trigger("vttjsloaded");return}var u=_.default.createElement("script");u.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",u.onload=function(){o.trigger("vttjsloaded")},u.onerror=function(){o.trigger("vttjserror")},this.on("dispose",function(){u.onload=null,u.onerror=null}),m.default.WebVTT=!0,this.el().parentNode.appendChild(u)}else this.ready(this.addWebVttScript_)},g.emulateTextTracks=function(){var o=this,u=this.textTracks(),y=this.remoteTextTracks(),w=function(V){return u.addTrack(V.track)},F=function(V){return u.removeTrack(V.track)};y.on("addtrack",w),y.on("removetrack",F),this.addWebVttScript_();var $=function(){return o.trigger("texttrackchange")},K=function(){$();for(var V=0;V<u.length;V++){var pe=u[V];pe.removeEventListener("cuechange",$),pe.mode==="showing"&&pe.addEventListener("cuechange",$)}};K(),u.addEventListener("change",K),u.addEventListener("addtrack",K),u.addEventListener("removetrack",K),this.on("dispose",function(){y.off("addtrack",w),y.off("removetrack",F),u.removeEventListener("change",K),u.removeEventListener("addtrack",K),u.removeEventListener("removetrack",K);for(var W=0;W<u.length;W++){var V=u[W];V.removeEventListener("cuechange",$)}})},g.addTextTrack=function(o,u,y){if(!o)throw new Error("TextTrack kind is required but was not provided");return f_(this,o,u,y)},g.createRemoteTextTrack=function(o){var u=dt(o,{tech:this});return new wr.remoteTextEl.TrackClass(u)},g.addRemoteTextTrack=function(o,u){var y=this;o===void 0&&(o={});var w=this.createRemoteTextTrack(o);return u!==!0&&u!==!1&&(Y.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),u=!0),this.remoteTextTrackEls().addTrackElement_(w),this.remoteTextTracks().addTrack(w.track),u!==!0&&this.ready(function(){return y.autoRemoteTextTracks_.addTrack(w.track)}),w},g.removeRemoteTextTrack=function(o){var u=this.remoteTextTrackEls().getTrackElementByTrack_(o);this.remoteTextTrackEls().removeTrackElement_(u),this.remoteTextTracks().removeTrack(o),this.autoRemoteTextTracks_.removeTrack(o)},g.getVideoPlaybackQuality=function(){return{}},g.requestPictureInPicture=function(){var o=this.options_.Promise||m.default.Promise;if(o)return o.reject()},g.disablePictureInPicture=function(){return!0},g.setDisablePictureInPicture=function(){},g.requestVideoFrameCallback=function(o){var u=this,y=hi();return!this.isReady_||this.paused()?(this.queuedHanders_.add(y),this.one("playing",function(){u.queuedHanders_.has(y)&&(u.queuedHanders_.delete(y),o())})):this.requestNamedAnimationFrame(y,o),y},g.cancelVideoFrameCallback=function(o){this.queuedHanders_.has(o)?this.queuedHanders_.delete(o):this.cancelNamedAnimationFrame(o)},g.setPoster=function(){},g.playsinline=function(){},g.setPlaysinline=function(){},g.overrideNativeAudioTracks=function(){},g.overrideNativeVideoTracks=function(){},g.canPlayType=function(){return""},T.canPlayType=function(){return""},T.canPlaySource=function(o,u){return T.canPlayType(o.type)},T.isTech=function(o){return o.prototype instanceof T||o instanceof T||o===T},T.registerTech=function(o,u){if(T.techs_||(T.techs_={}),!T.isTech(u))throw new Error("Tech "+o+" must be a Tech");if(!T.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!T.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return o=Tt(o),T.techs_[o]=u,T.techs_[Ra(o)]=u,o!=="Tech"&&T.defaultTechOrder_.push(o),u},T.getTech=function(o){if(o){if(T.techs_&&T.techs_[o])return T.techs_[o];if(o=Tt(o),m.default&&m.default.videojs&&m.default.videojs[o])return Y.warn("The "+o+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),m.default.videojs[o]}},T}(ge);qt.names.forEach(function(v){var T=qt[v];ot.prototype[T.getterName]=function(){return this[T.privateName]=this[T.privateName]||new T.ListClass,this[T.privateName]}}),ot.prototype.featuresVolumeControl=!0,ot.prototype.featuresMuteControl=!0,ot.prototype.featuresFullscreenResize=!1,ot.prototype.featuresPlaybackRate=!1,ot.prototype.featuresProgressEvents=!1,ot.prototype.featuresSourceset=!1,ot.prototype.featuresTimeupdateEvents=!1,ot.prototype.featuresNativeTextTracks=!1,ot.prototype.featuresVideoFrameCallback=!1,ot.withSourceHandlers=function(v){v.registerSourceHandler=function(g,d){var o=v.sourceHandlers;o||(o=v.sourceHandlers=[]),d===void 0&&(d=o.length),o.splice(d,0,g)},v.canPlayType=function(g){for(var d=v.sourceHandlers||[],o,u=0;u<d.length;u++)if(o=d[u].canPlayType(g),o)return o;return""},v.selectSourceHandler=function(g,d){for(var o=v.sourceHandlers||[],u,y=0;y<o.length;y++)if(u=o[y].canHandleSource(g,d),u)return o[y];return null},v.canPlaySource=function(g,d){var o=v.selectSourceHandler(g,d);return o?o.canHandleSource(g,d):""};var T=["seekable","seeking","duration"];T.forEach(function(g){var d=this[g];typeof d=="function"&&(this[g]=function(){return this.sourceHandler_&&this.sourceHandler_[g]?this.sourceHandler_[g].apply(this.sourceHandler_,arguments):d.apply(this,arguments)})},v.prototype),v.prototype.setSource=function(g){var d=v.selectSourceHandler(g,this.options_);d||(v.nativeSourceHandler?d=v.nativeSourceHandler:Y.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),d!==v.nativeSourceHandler&&(this.currentSource_=g),this.sourceHandler_=d.handleSource(g,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},v.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},ge.registerComponent("Tech",ot),ot.registerTech("Tech",ot),ot.defaultTechOrder_=[];var Ws={},Zl={},Da={};function p_(v,T){Ws[v]=Ws[v]||[],Ws[v].push(T)}function g_(v,T,g){v.setTimeout(function(){return zs(T,Ws[T.type],g,v)},1)}function m_(v,T){v.forEach(function(g){return g.setTech&&g.setTech(T)})}function v_(v,T,g){return v.reduceRight(eu(g),T[g]())}function y_(v,T,g,d){return T[g](v.reduce(eu(g),d))}function lp(v,T,g,d){d===void 0&&(d=null);var o="call"+Tt(g),u=v.reduce(eu(o),d),y=u===Da,w=y?null:T[g](u);return E_(v,g,w,y),w}var T_={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},__={setCurrentTime:1,setMuted:1,setVolume:1},up={play:1,pause:1};function eu(v){return function(T,g){return T===Da?Da:g[v]?g[v](T):T}}function E_(v,T,g,d){for(var o=v.length-1;o>=0;o--){var u=v[o];u[T]&&u[T](d,g)}}function b_(v){Zl[v.id()]=null}function S_(v,T){var g=Zl[v.id()],d=null;if(g==null)return d=T(v),Zl[v.id()]=[[T,d]],d;for(var o=0;o<g.length;o++){var u=g[o],y=u[0],w=u[1];y===T&&(d=w)}return d===null&&(d=T(v),g.push([T,d])),d}function zs(v,T,g,d,o,u){v===void 0&&(v={}),T===void 0&&(T=[]),o===void 0&&(o=[]),u===void 0&&(u=!1);var y=T,w=y[0],F=y.slice(1);if(typeof w=="string")zs(v,Ws[w],g,d,o,u);else if(w){var $=S_(d,w);if(!$.setSource)return o.push($),zs(v,F,g,d,o,u);$.setSource(Pe({},v),function(K,W){if(K)return zs(v,F,g,d,o,u);o.push($),zs(W,v.type===W.type?F:Ws[W.type],g,d,o,u)})}else F.length?zs(v,F,g,d,o,u):u?g(v,o):zs(v,Ws["*"],g,d,o,!0)}var C_={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},xa=function(T){T===void 0&&(T="");var g=Jl(T),d=C_[g.toLowerCase()];return d||""},w_=function(T,g){if(!g)return"";if(T.cache_.source.src===g&&T.cache_.source.type)return T.cache_.source.type;var d=T.cache_.sources.filter(function(w){return w.src===g});if(d.length)return d[0].type;for(var o=T.$$("source"),u=0;u<o.length;u++){var y=o[u];if(y.type&&y.src&&y.src===g)return y.type}return xa(g)},A_=function v(T){if(Array.isArray(T)){var g=[];T.forEach(function(d){d=v(d),Array.isArray(d)?g=g.concat(d):Be(d)&&g.push(d)}),T=g}else typeof T=="string"&&T.trim()?T=[hp({src:T})]:Be(T)&&typeof T.src=="string"&&T.src&&T.src.trim()?T=[hp(T)]:T=[];return T};function hp(v){if(!v.type){var T=xa(v.src);T&&(v.type=T)}return v}var I_=function(v){I.default(T,v);function T(g,d,o){var u,y=dt({createEl:!1},d);if(u=v.call(this,g,y,o)||this,!d.playerOptions.sources||d.playerOptions.sources.length===0)for(var w=0,F=d.playerOptions.techOrder;w<F.length;w++){var $=Tt(F[w]),K=ot.getTech($);if($||(K=ge.getComponent($)),K&&K.isSupported()){g.loadTech_($);break}}else g.src(d.playerOptions.sources);return u}return T}(ge);ge.registerComponent("MediaLoader",I_);var Oa=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.options_.controlText&&u.controlText(u.options_.controlText),u.handleMouseOver_=function(y){return u.handleMouseOver(y)},u.handleMouseOut_=function(y){return u.handleMouseOut(y)},u.handleClick_=function(y){return u.handleClick(y)},u.handleKeyDown_=function(y){return u.handleKeyDown(y)},u.emitTapEvents(),u.enable(),u}var g=T.prototype;return g.createEl=function(o,u,y){o===void 0&&(o="div"),u===void 0&&(u={}),y===void 0&&(y={}),u=Pe({className:this.buildCSSClass(),tabIndex:0},u),o==="button"&&Y.error("Creating a ClickableComponent with an HTML element of "+o+" is not supported; use a Button instead."),y=Pe({role:"button"},y),this.tabIndex_=u.tabIndex;var w=ke(o,u,y);return w.appendChild(ke("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(w),w},g.dispose=function(){this.controlTextEl_=null,v.prototype.dispose.call(this)},g.createControlTextEl=function(o){return this.controlTextEl_=ke("span",{className:"vjs-control-text"},{"aria-live":"polite"}),o&&o.appendChild(this.controlTextEl_),this.controlText(this.controlText_,o),this.controlTextEl_},g.controlText=function(o,u){if(u===void 0&&(u=this.el()),o===void 0)return this.controlText_||"Need Text";var y=this.localize(o);this.controlText_=o,qe(this.controlTextEl_,y),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&u.setAttribute("title",y)},g.buildCSSClass=function(){return"vjs-control vjs-button "+v.prototype.buildCSSClass.call(this)},g.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},g.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},g.handleLanguagechange=function(){this.controlText(this.controlText_)},g.handleClick=function(o){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},g.handleKeyDown=function(o){S.default.isEventKey(o,"Space")||S.default.isEventKey(o,"Enter")?(o.preventDefault(),o.stopPropagation(),this.trigger("click")):v.prototype.handleKeyDown.call(this,o)},T}(ge);ge.registerComponent("ClickableComponent",Oa);var L_=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update(),u.update_=function(y){return u.update(y)},d.on("posterchange",u.update_),u}var g=T.prototype;return g.dispose=function(){this.player().off("posterchange",this.update_),v.prototype.dispose.call(this)},g.createEl=function(){var o=ke("div",{className:"vjs-poster",tabIndex:-1});return o},g.update=function(o){var u=this.player().poster();this.setSrc(u),u?this.show():this.hide()},g.setSrc=function(o){var u="";o&&(u='url("'+o+'")'),this.el_.style.backgroundImage=u},g.handleClick=function(o){if(this.player_.controls()){var u=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;this.player_.tech(!0)&&!((Ft||Ut)&&u)&&this.player_.tech(!0).focus(),this.player_.paused()?xi(this.player_.play()):this.player_.pause()}},T}(Oa);ge.registerComponent("PosterImage",L_);var di="#222",cp="#ccc",k_={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function tu(v,T){var g;if(v.length===4)g=v[1]+v[1]+v[2]+v[2]+v[3]+v[3];else if(v.length===7)g=v.slice(1);else throw new Error("Invalid color code provided, "+v+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(g.slice(0,2),16)+","+parseInt(g.slice(2,4),16)+","+parseInt(g.slice(4,6),16)+","+T+")"}function iu(v,T,g){try{v.style[T]=g}catch{return}}var R_=function(v){I.default(T,v);function T(d,o,u){var y;y=v.call(this,d,o,u)||this;var w=function($){return y.updateDisplay($)};return d.on("loadstart",function(F){return y.toggleDisplay(F)}),d.on("texttrackchange",w),d.on("loadedmetadata",function(F){return y.preselectTrack(F)}),d.ready(at(C.default(y),function(){if(d.tech_&&d.tech_.featuresNativeTextTracks){this.hide();return}d.on("fullscreenchange",w),d.on("playerresize",w),m.default.addEventListener("orientationchange",w),d.on("dispose",function(){return m.default.removeEventListener("orientationchange",w)});for(var F=this.options_.playerOptions.tracks||[],$=0;$<F.length;$++)this.player_.addRemoteTextTrack(F[$],!0);this.preselectTrack()})),y}var g=T.prototype;return g.preselectTrack=function(){for(var o={captions:1,subtitles:1},u=this.player_.textTracks(),y=this.player_.cache_.selectedLanguage,w,F,$,K=0;K<u.length;K++){var W=u[K];y&&y.enabled&&y.language&&y.language===W.language&&W.kind in o?W.kind===y.kind?$=W:$||($=W):y&&!y.enabled?($=null,w=null,F=null):W.default&&(W.kind==="descriptions"&&!w?w=W:W.kind in o&&!F&&(F=W))}$?$.mode="showing":F?F.mode="showing":w&&(w.mode="showing")},g.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})},g.clearDisplay=function(){typeof m.default.WebVTT=="function"&&m.default.WebVTT.processCues(m.default,[],this.el_)},g.updateDisplay=function(){var o=this.player_.textTracks(),u=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),u){for(var y=[],w=0;w<o.length;++w){var F=o[w];F.mode==="showing"&&y.push(F)}this.updateForTrack(y);return}for(var $=null,K=null,W=o.length;W--;){var V=o[W];V.mode==="showing"&&(V.kind==="descriptions"?$=V:K=V)}K?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(K)):$&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack($))},g.updateDisplayState=function(o){for(var u=this.player_.textTrackSettings.getValues(),y=o.activeCues,w=y.length;w--;){var F=y[w];if(F){var $=F.displayState;if(u.color&&($.firstChild.style.color=u.color),u.textOpacity&&iu($.firstChild,"color",tu(u.color||"#fff",u.textOpacity)),u.backgroundColor&&($.firstChild.style.backgroundColor=u.backgroundColor),u.backgroundOpacity&&iu($.firstChild,"backgroundColor",tu(u.backgroundColor||"#000",u.backgroundOpacity)),u.windowColor&&(u.windowOpacity?iu($,"backgroundColor",tu(u.windowColor,u.windowOpacity)):$.style.backgroundColor=u.windowColor),u.edgeStyle&&(u.edgeStyle==="dropshadow"?$.firstChild.style.textShadow="2px 2px 3px "+di+", 2px 2px 4px "+di+", 2px 2px 5px "+di:u.edgeStyle==="raised"?$.firstChild.style.textShadow="1px 1px "+di+", 2px 2px "+di+", 3px 3px "+di:u.edgeStyle==="depressed"?$.firstChild.style.textShadow="1px 1px "+cp+", 0 1px "+cp+", -1px -1px "+di+", 0 -1px "+di:u.edgeStyle==="uniform"&&($.firstChild.style.textShadow="0 0 4px "+di+", 0 0 4px "+di+", 0 0 4px "+di+", 0 0 4px "+di)),u.fontPercent&&u.fontPercent!==1){var K=m.default.parseFloat($.style.fontSize);$.style.fontSize=K*u.fontPercent+"px",$.style.height="auto",$.style.top="auto"}u.fontFamily&&u.fontFamily!=="default"&&(u.fontFamily==="small-caps"?$.firstChild.style.fontVariant="small-caps":$.firstChild.style.fontFamily=k_[u.fontFamily])}}},g.updateForTrack=function(o){if(Array.isArray(o)||(o=[o]),!(typeof m.default.WebVTT!="function"||o.every(function(pe){return!pe.activeCues}))){for(var u=[],y=0;y<o.length;++y)for(var w=o[y],F=0;F<w.activeCues.length;++F)u.push(w.activeCues[F]);m.default.WebVTT.processCues(m.default,u,this.el_);for(var $=0;$<o.length;++$){for(var K=o[$],W=0;W<K.activeCues.length;++W){var V=K.activeCues[W].displayState;_i(V,"vjs-text-track-cue"),_i(V,"vjs-text-track-cue-"+(K.language?K.language:$)),K.language&&gs(V,"lang",K.language)}this.player_.textTrackSettings&&this.updateDisplayState(K)}}},T}(ge);ge.registerComponent("TextTrackDisplay",R_);var P_=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(){var o=this.player_.isAudio(),u=this.localize(o?"Audio Player":"Video Player"),y=ke("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[u])}),w=v.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return w.appendChild(y),w},T}(ge);ge.registerComponent("LoadingSpinner",P_);var Si=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(o,u,y){u===void 0&&(u={}),y===void 0&&(y={}),o="button",u=Pe({className:this.buildCSSClass()},u),y=Pe({type:"button"},y);var w=ke(o,u,y);return w.appendChild(ke("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(w),w},g.addChild=function(o,u){u===void 0&&(u={});var y=this.constructor.name;return Y.warn("Adding an actionable (user controllable) child to a Button ("+y+") is not supported; use a ClickableComponent instead."),ge.prototype.addChild.call(this,o,u)},g.enable=function(){v.prototype.enable.call(this),this.el_.removeAttribute("disabled")},g.disable=function(){v.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},g.handleKeyDown=function(o){if(S.default.isEventKey(o,"Space")||S.default.isEventKey(o,"Enter")){o.stopPropagation();return}v.prototype.handleKeyDown.call(this,o)},T}(Oa);ge.registerComponent("Button",Si);var dp=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.mouseused_=!1,u.on("mousedown",function(y){return u.handleMouseDown(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-big-play-button"},g.handleClick=function(o){var u=this.player_.play();if(this.mouseused_&&o.clientX&&o.clientY){var y=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;xi(u),this.player_.tech(!0)&&!((Ft||Ut)&&y)&&this.player_.tech(!0).focus();return}var w=this.player_.getChild("controlBar"),F=w&&w.getChild("playToggle");if(!F){this.player_.tech(!0).focus();return}var $=function(){return F.focus()};_n(u)?u.then($,function(){}):this.setTimeout($,1)},g.handleKeyDown=function(o){this.mouseused_=!1,v.prototype.handleKeyDown.call(this,o)},g.handleMouseDown=function(o){this.mouseused_=!0},T}(Si);dp.prototype.controlText_="Play Video",ge.registerComponent("BigPlayButton",dp);var D_=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.controlText(o&&o.controlText||u.localize("Close")),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-close-button "+v.prototype.buildCSSClass.call(this)},g.handleClick=function(o){this.trigger({type:"close",bubbles:!1})},g.handleKeyDown=function(o){S.default.isEventKey(o,"Esc")?(o.preventDefault(),o.stopPropagation(),this.trigger("click")):v.prototype.handleKeyDown.call(this,o)},T}(Si);ge.registerComponent("CloseButton",D_);var fp=function(v){I.default(T,v);function T(d,o){var u;return o===void 0&&(o={}),u=v.call(this,d,o)||this,o.replay=o.replay===void 0||o.replay,u.on(d,"play",function(y){return u.handlePlay(y)}),u.on(d,"pause",function(y){return u.handlePause(y)}),o.replay&&u.on(d,"ended",function(y){return u.handleEnded(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-play-control "+v.prototype.buildCSSClass.call(this)},g.handleClick=function(o){this.player_.paused()?xi(this.player_.play()):this.player_.pause()},g.handleSeeked=function(o){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(o):this.handlePlay(o)},g.handlePlay=function(o){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},g.handlePause=function(o){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},g.handleEnded=function(o){var u=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",function(y){return u.handleSeeked(y)})},T}(Si);fp.prototype.controlText_="Play",ge.registerComponent("PlayToggle",fp);var pp=function(T,g){T=T<0?0:T;var d=Math.floor(T%60),o=Math.floor(T/60%60),u=Math.floor(T/3600),y=Math.floor(g/60%60),w=Math.floor(g/3600);return(isNaN(T)||T===1/0)&&(u=o=d="-"),u=u>0||w>0?u+":":"",o=((u||y>=10)&&o<10?"0"+o:o)+":",d=d<10?"0"+d:d,u+o+d},su=pp;function x_(v){su=v}function O_(){su=pp}function Ar(v,T){return T===void 0&&(T=v),su(v,T)}var Ir=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,["timeupdate","ended"],function(y){return u.updateContent(y)}),u.updateTextNode_(),u}var g=T.prototype;return g.createEl=function(){var o=this.buildCSSClass(),u=v.prototype.createEl.call(this,"div",{className:o+" vjs-time-control vjs-control"}),y=ke("span",{className:"vjs-control-text",textContent:this.localize(this.labelText_)+"\xA0"},{role:"presentation"});return u.appendChild(y),this.contentEl_=ke("span",{className:o+"-display"},{"aria-live":"off",role:"presentation"}),u.appendChild(this.contentEl_),u},g.dispose=function(){this.contentEl_=null,this.textNode_=null,v.prototype.dispose.call(this)},g.updateTextNode_=function(o){var u=this;o===void 0&&(o=0),o=Ar(o),this.formattedTime_!==o&&(this.formattedTime_=o,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){if(u.contentEl_){var y=u.textNode_;y&&u.contentEl_.firstChild!==y&&(y=null,Y.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),u.textNode_=_.default.createTextNode(u.formattedTime_),u.textNode_&&(y?u.contentEl_.replaceChild(u.textNode_,y):u.contentEl_.appendChild(u.textNode_))}}))},g.updateContent=function(o){},T}(ge);Ir.prototype.labelText_="Time",Ir.prototype.controlText_="Time",ge.registerComponent("TimeDisplay",Ir);var ru=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-current-time"},g.updateContent=function(o){var u;this.player_.ended()?u=this.player_.duration():u=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(u)},T}(Ir);ru.prototype.labelText_="Current Time",ru.prototype.controlText_="Current Time",ge.registerComponent("CurrentTimeDisplay",ru);var nu=function(v){I.default(T,v);function T(d,o){var u;u=v.call(this,d,o)||this;var y=function(F){return u.updateContent(F)};return u.on(d,"durationchange",y),u.on(d,"loadstart",y),u.on(d,"loadedmetadata",y),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-duration"},g.updateContent=function(o){var u=this.player_.duration();this.updateTextNode_(u)},T}(Ir);nu.prototype.labelText_="Duration",nu.prototype.controlText_="Duration",ge.registerComponent("DurationDisplay",nu);var M_=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),u=v.prototype.createEl.call(this,"div"),y=v.prototype.createEl.call(this,"span",{textContent:"/"});return u.appendChild(y),o.appendChild(u),o},T}(ge);ge.registerComponent("TimeDivider",M_);var au=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,"durationchange",function(y){return u.updateContent(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-remaining-time"},g.createEl=function(){var o=v.prototype.createEl.call(this);return this.options_.displayNegative!==!1&&o.insertBefore(ke("span",{},{"aria-hidden":!0},"-"),this.contentEl_),o},g.updateContent=function(o){if(typeof this.player_.duration()=="number"){var u;this.player_.ended()?u=0:this.player_.remainingTimeDisplay?u=this.player_.remainingTimeDisplay():u=this.player_.remainingTime(),this.updateTextNode_(u)}},T}(Ir);au.prototype.labelText_="Remaining Time",au.prototype.controlText_="Remaining Time",ge.registerComponent("RemainingTimeDisplay",au);var F_=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.updateShowing(),u.on(u.player(),"durationchange",function(y){return u.updateShowing(y)}),u}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=ke("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(ke("span",{className:"vjs-control-text",textContent:this.localize("Stream Type")+"\xA0"})),this.contentEl_.appendChild(_.default.createTextNode(this.localize("LIVE"))),o.appendChild(this.contentEl_),o},g.dispose=function(){this.contentEl_=null,v.prototype.dispose.call(this)},g.updateShowing=function(o){this.player().duration()===1/0?this.show():this.hide()},T}(ge);ge.registerComponent("LiveDisplay",F_);var gp=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.updateLiveEdgeStatus(),u.player_.liveTracker&&(u.updateLiveEdgeStatusHandler_=function(y){return u.updateLiveEdgeStatus(y)},u.on(u.player_.liveTracker,"liveedgechange",u.updateLiveEdgeStatusHandler_)),u}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=ke("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),o.appendChild(this.textEl_),o},g.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},g.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},g.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,v.prototype.dispose.call(this)},T}(Si);gp.prototype.controlText_="Seek to live, currently playing live",ge.registerComponent("SeekToLive",gp);var Ma=function(T,g,d){return T=Number(T),Math.min(d,Math.max(g,isNaN(T)?g:T))},ou=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.handleMouseDown_=function(y){return u.handleMouseDown(y)},u.handleMouseUp_=function(y){return u.handleMouseUp(y)},u.handleKeyDown_=function(y){return u.handleKeyDown(y)},u.handleClick_=function(y){return u.handleClick(y)},u.handleMouseMove_=function(y){return u.handleMouseMove(y)},u.update_=function(y){return u.update(y)},u.bar=u.getChild(u.options_.barName),u.vertical(!!u.options_.vertical),u.enable(),u}var g=T.prototype;return g.enabled=function(){return this.enabled_},g.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},g.disable=function(){if(this.enabled()){var o=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(o,"mousemove",this.handleMouseMove_),this.off(o,"mouseup",this.handleMouseUp_),this.off(o,"touchmove",this.handleMouseMove_),this.off(o,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},g.createEl=function(o,u,y){return u===void 0&&(u={}),y===void 0&&(y={}),u.className=u.className+" vjs-slider",u=Pe({tabIndex:0},u),y=Pe({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},y),v.prototype.createEl.call(this,o,u,y)},g.handleMouseDown=function(o){var u=this.bar.el_.ownerDocument;o.type==="mousedown"&&o.preventDefault(),o.type==="touchstart"&&!yt&&o.preventDefault(),ma(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(u,"mousemove",this.handleMouseMove_),this.on(u,"mouseup",this.handleMouseUp_),this.on(u,"touchmove",this.handleMouseMove_),this.on(u,"touchend",this.handleMouseUp_),this.handleMouseMove(o,!0)},g.handleMouseMove=function(o){},g.handleMouseUp=function(){var o=this.bar.el_.ownerDocument;va(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(o,"mousemove",this.handleMouseMove_),this.off(o,"mouseup",this.handleMouseUp_),this.off(o,"touchmove",this.handleMouseMove_),this.off(o,"touchend",this.handleMouseUp_),this.update()},g.update=function(){var o=this;if(!(!this.el_||!this.bar)){var u=this.getProgress();return u===this.progress_||(this.progress_=u,this.requestNamedAnimationFrame("Slider#update",function(){var y=o.vertical()?"height":"width";o.bar.el().style[y]=(u*100).toFixed(2)+"%"})),u}},g.getProgress=function(){return Number(Ma(this.getPercent(),0,1).toFixed(4))},g.calculateDistance=function(o){var u=Vs(this.el_,o);return this.vertical()?u.y:u.x},g.handleKeyDown=function(o){S.default.isEventKey(o,"Left")||S.default.isEventKey(o,"Down")?(o.preventDefault(),o.stopPropagation(),this.stepBack()):S.default.isEventKey(o,"Right")||S.default.isEventKey(o,"Up")?(o.preventDefault(),o.stopPropagation(),this.stepForward()):v.prototype.handleKeyDown.call(this,o)},g.handleClick=function(o){o.stopPropagation(),o.preventDefault()},g.vertical=function(o){if(o===void 0)return this.vertical_||!1;this.vertical_=!!o,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")},T}(ge);ge.registerComponent("Slider",ou);var lu=function(T,g){return Ma(T/g*100,0,100).toFixed(2)+"%"},N_=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.partEls_=[],u.on(d,"progress",function(y){return u.update(y)}),u}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),u=ke("span",{className:"vjs-control-text"}),y=ke("span",{textContent:this.localize("Loaded")}),w=_.default.createTextNode(": ");return this.percentageEl_=ke("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),o.appendChild(u),u.appendChild(y),u.appendChild(w),u.appendChild(this.percentageEl_),o},g.dispose=function(){this.partEls_=null,this.percentageEl_=null,v.prototype.dispose.call(this)},g.update=function(o){var u=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var y=u.player_.liveTracker,w=u.player_.buffered(),F=y&&y.isLive()?y.seekableEnd():u.player_.duration(),$=u.player_.bufferedEnd(),K=u.partEls_,W=lu($,F);u.percent_!==W&&(u.el_.style.width=W,qe(u.percentageEl_,W),u.percent_=W);for(var V=0;V<w.length;V++){var pe=w.start(V),we=w.end(V),We=K[V];We||(We=u.el_.appendChild(ke()),K[V]=We),!(We.dataset.start===pe&&We.dataset.end===we)&&(We.dataset.start=pe,We.dataset.end=we,We.style.left=lu(pe,$),We.style.width=lu(we-pe,$))}for(var Xs=K.length;Xs>w.length;Xs--)u.el_.removeChild(K[Xs-1]);K.length=w.length})},T}(ge);ge.registerComponent("LoadProgressBar",N_);var B_=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=Ei(at(C.default(u),u.update),Yt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},g.update=function(o,u,y){var w=Pi(this.el_),F=ms(this.player_.el()),$=o.width*u;if(!(!F||!w)){var K=o.left-F.left+$,W=o.width-$+(F.right-o.right),V=w.width/2;K<V?V+=V-K:W<V&&(V=W),V<0?V=0:V>w.width&&(V=w.width),V=Math.round(V),this.el_.style.right="-"+V+"px",this.write(y)}},g.write=function(o){qe(this.el_,o)},g.updateTime=function(o,u,y,w){var F=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var $,K=F.player_.duration();if(F.player_.liveTracker&&F.player_.liveTracker.isLive()){var W=F.player_.liveTracker.liveWindow(),V=W-u*W;$=(V<1?"":"-")+Ar(V,W)}else $=Ar(y,K);F.update(o,u,$),w&&w()})},T}(ge);ge.registerComponent("TimeTooltip",B_);var uu=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=Ei(at(C.default(u),u.update),Yt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},g.update=function(o,u){var y=this.getChild("timeTooltip");if(y){var w=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();y.updateTime(o,u,w)}},T}(ge);uu.prototype.options_={children:[]},!M&&!Ke&&uu.prototype.options_.children.push("timeTooltip"),ge.registerComponent("PlayProgressBar",uu);var mp=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=Ei(at(C.default(u),u.update),Yt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},g.update=function(o,u){var y=this,w=u*this.player_.duration();this.getChild("timeTooltip").updateTime(o,u,w,function(){y.el_.style.left=o.width*u+"px"})},T}(ge);mp.prototype.options_={children:["timeTooltip"]},ge.registerComponent("MouseTimeDisplay",mp);var Fa=5,vp=12,hu=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.setEventHandlers_(),u}var g=T.prototype;return g.setEventHandlers_=function(){var o=this;this.update_=at(this,this.update),this.update=Ei(this.update_,Yt),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(u){return o.enableInterval_(u)},this.disableIntervalHandler_=function(u){return o.disableInterval_(u)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in _.default&&"visibilityState"in _.default&&this.on(_.default,"visibilitychange",this.toggleVisibility_)},g.toggleVisibility_=function(o){_.default.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(o)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())},g.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,Yt))},g.disableInterval_=function(o){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&o&&o.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)},g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},g.update=function(o){var u=this;if(_.default.visibilityState!=="hidden"){var y=v.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var w=u.player_.ended()?u.player_.duration():u.getCurrentTime_(),F=u.player_.liveTracker,$=u.player_.duration();F&&F.isLive()&&($=u.player_.liveTracker.liveCurrentTime()),u.percent_!==y&&(u.el_.setAttribute("aria-valuenow",(y*100).toFixed(2)),u.percent_=y),(u.currentTime_!==w||u.duration_!==$)&&(u.el_.setAttribute("aria-valuetext",u.localize("progress bar timing: currentTime={1} duration={2}",[Ar(w,$),Ar($,$)],"{1} of {2}")),u.currentTime_=w,u.duration_=$),u.bar&&u.bar.update(ms(u.el()),u.getProgress())}),y}},g.userSeek_=function(o){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(o)},g.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},g.getPercent=function(){var o=this.getCurrentTime_(),u,y=this.player_.liveTracker;return y&&y.isLive()?(u=(o-y.seekableStart())/y.liveWindow(),y.atLiveEdge()&&(u=1)):u=o/this.player_.duration(),u},g.handleMouseDown=function(o){vs(o)&&(o.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),v.prototype.handleMouseDown.call(this,o))},g.handleMouseMove=function(o,u){if(u===void 0&&(u=!1),!!vs(o)){!u&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);var y,w=this.calculateDistance(o),F=this.player_.liveTracker;if(!F||!F.isLive())y=w*this.player_.duration(),y===this.player_.duration()&&(y=y-.1);else{if(w>=.99){F.seekToLiveEdge();return}var $=F.seekableStart(),K=F.liveCurrentTime();if(y=$+w*F.liveWindow(),y>=K&&(y=K),y<=$&&(y=$+.1),y===1/0)return}this.userSeek_(y)}},g.enable=function(){v.prototype.enable.call(this);var o=this.getChild("mouseTimeDisplay");o&&o.show()},g.disable=function(){v.prototype.disable.call(this);var o=this.getChild("mouseTimeDisplay");o&&o.hide()},g.handleMouseUp=function(o){v.prototype.handleMouseUp.call(this,o),o&&o.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?xi(this.player_.play()):this.update_()},g.stepForward=function(){this.userSeek_(this.player_.currentTime()+Fa)},g.stepBack=function(){this.userSeek_(this.player_.currentTime()-Fa)},g.handleAction=function(o){this.player_.paused()?this.player_.play():this.player_.pause()},g.handleKeyDown=function(o){var u=this.player_.liveTracker;if(S.default.isEventKey(o,"Space")||S.default.isEventKey(o,"Enter"))o.preventDefault(),o.stopPropagation(),this.handleAction(o);else if(S.default.isEventKey(o,"Home"))o.preventDefault(),o.stopPropagation(),this.userSeek_(0);else if(S.default.isEventKey(o,"End"))o.preventDefault(),o.stopPropagation(),u&&u.isLive()?this.userSeek_(u.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(S.default(o))){o.preventDefault(),o.stopPropagation();var y=(S.default.codes[S.default(o)]-S.default.codes[0])*10/100;u&&u.isLive()?this.userSeek_(u.seekableStart()+u.liveWindow()*y):this.userSeek_(this.player_.duration()*y)}else S.default.isEventKey(o,"PgDn")?(o.preventDefault(),o.stopPropagation(),this.userSeek_(this.player_.currentTime()-Fa*vp)):S.default.isEventKey(o,"PgUp")?(o.preventDefault(),o.stopPropagation(),this.userSeek_(this.player_.currentTime()+Fa*vp)):v.prototype.handleKeyDown.call(this,o)},g.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in _.default&&"visibilityState"in _.default&&this.off(_.default,"visibilitychange",this.toggleVisibility_),v.prototype.dispose.call(this)},T}(ou);hu.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},!M&&!Ke&&hu.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),ge.registerComponent("SeekBar",hu);var yp=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.handleMouseMove=Ei(at(C.default(u),u.handleMouseMove),Yt),u.throttledHandleMouseSeek=Ei(at(C.default(u),u.handleMouseSeek),Yt),u.handleMouseUpHandler_=function(y){return u.handleMouseUp(y)},u.handleMouseDownHandler_=function(y){return u.handleMouseDown(y)},u.enable(),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},g.handleMouseMove=function(o){var u=this.getChild("seekBar");if(u){var y=u.getChild("playProgressBar"),w=u.getChild("mouseTimeDisplay");if(!(!y&&!w)){var F=u.el(),$=Pi(F),K=Vs(F,o).x;K=Ma(K,0,1),w&&w.update($,K),y&&y.update($,u.getProgress())}}},g.handleMouseSeek=function(o){var u=this.getChild("seekBar");u&&u.handleMouseMove(o)},g.enabled=function(){return this.enabled_},g.disable=function(){if(this.children().forEach(function(u){return u.disable&&u.disable()}),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){var o=this.getChild("seekBar");this.player_.scrubbing(!1),o.videoWasPlaying&&xi(this.player_.play())}},g.enable=function(){this.children().forEach(function(o){return o.enable&&o.enable()}),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},g.removeListenersAddedOnMousedownAndTouchstart=function(){var o=this.el_.ownerDocument;this.off(o,"mousemove",this.throttledHandleMouseSeek),this.off(o,"touchmove",this.throttledHandleMouseSeek),this.off(o,"mouseup",this.handleMouseUpHandler_),this.off(o,"touchend",this.handleMouseUpHandler_)},g.handleMouseDown=function(o){var u=this.el_.ownerDocument,y=this.getChild("seekBar");y&&y.handleMouseDown(o),this.on(u,"mousemove",this.throttledHandleMouseSeek),this.on(u,"touchmove",this.throttledHandleMouseSeek),this.on(u,"mouseup",this.handleMouseUpHandler_),this.on(u,"touchend",this.handleMouseUpHandler_)},g.handleMouseUp=function(o){var u=this.getChild("seekBar");u&&u.handleMouseUp(o),this.removeListenersAddedOnMousedownAndTouchstart()},T}(ge);yp.prototype.options_={children:["seekBar"]},ge.registerComponent("ProgressControl",yp);var Tp=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,["enterpictureinpicture","leavepictureinpicture"],function(y){return u.handlePictureInPictureChange(y)}),u.on(d,["disablepictureinpicturechanged","loadedmetadata"],function(y){return u.handlePictureInPictureEnabledChange(y)}),u.on(d,["loadedmetadata","audioonlymodechange","audiopostermodechange"],function(){var y=d.currentType().substring(0,5)==="audio";y||d.audioPosterMode()||d.audioOnlyMode()?(d.isInPictureInPicture()&&d.exitPictureInPicture(),u.hide()):u.show()}),u.disable(),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-picture-in-picture-control "+v.prototype.buildCSSClass.call(this)},g.handlePictureInPictureEnabledChange=function(){_.default.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1?this.enable():this.disable()},g.handlePictureInPictureChange=function(o){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},g.handleClick=function(o){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},T}(Si);Tp.prototype.controlText_="Picture-in-Picture",ge.registerComponent("PictureInPictureToggle",Tp);var _p=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,"fullscreenchange",function(y){return u.handleFullscreenChange(y)}),_.default[d.fsApi_.fullscreenEnabled]===!1&&u.disable(),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-fullscreen-control "+v.prototype.buildCSSClass.call(this)},g.handleFullscreenChange=function(o){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},g.handleClick=function(o){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},T}(Si);_p.prototype.controlText_="Fullscreen",ge.registerComponent("FullscreenToggle",_p);var U_=function(T,g){g.tech_&&!g.tech_.featuresVolumeControl&&T.addClass("vjs-hidden"),T.on(g,"loadstart",function(){g.tech_.featuresVolumeControl?T.removeClass("vjs-hidden"):T.addClass("vjs-hidden")})},$_=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this,"div",{className:"vjs-volume-level"});return o.appendChild(v.prototype.createEl.call(this,"span",{className:"vjs-control-text"})),o},T}(ge);ge.registerComponent("VolumeLevel",$_);var H_=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=Ei(at(C.default(u),u.update),Yt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},g.update=function(o,u,y,w){if(!y){var F=ms(this.el_),$=ms(this.player_.el()),K=o.width*u;if(!$||!F)return;var W=o.left-$.left+K,V=o.width-K+($.right-o.right),pe=F.width/2;W<pe?pe+=pe-W:V<pe&&(pe=V),pe<0?pe=0:pe>F.width&&(pe=F.width),this.el_.style.right="-"+pe+"px"}this.write(w+"%")},g.write=function(o){qe(this.el_,o)},g.updateVolume=function(o,u,y,w,F){var $=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",function(){$.update(o,u,y,w.toFixed(0)),F&&F()})},T}(ge);ge.registerComponent("VolumeLevelTooltip",H_);var Ep=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.update=Ei(at(C.default(u),u.update),Yt),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},g.update=function(o,u,y){var w=this,F=100*u;this.getChild("volumeLevelTooltip").updateVolume(o,u,y,F,function(){y?w.el_.style.bottom=o.height*u+"px":w.el_.style.left=o.width*u+"px"})},T}(ge);Ep.prototype.options_={children:["volumeLevelTooltip"]},ge.registerComponent("MouseVolumeLevelDisplay",Ep);var Na=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on("slideractive",function(y){return u.updateLastVolume_(y)}),u.on(d,"volumechange",function(y){return u.updateARIAAttributes(y)}),d.ready(function(){return u.updateARIAAttributes()}),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},g.handleMouseDown=function(o){vs(o)&&v.prototype.handleMouseDown.call(this,o)},g.handleMouseMove=function(o){var u=this.getChild("mouseVolumeLevelDisplay");if(u){var y=this.el(),w=ms(y),F=this.vertical(),$=Vs(y,o);$=F?$.y:$.x,$=Ma($,0,1),u.update(w,$,F)}vs(o)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(o)))},g.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},g.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},g.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},g.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},g.updateARIAAttributes=function(o){var u=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",u),this.el_.setAttribute("aria-valuetext",u+"%")},g.volumeAsPercentage_=function(){return Math.round(this.player_.volume()*100)},g.updateLastVolume_=function(){var o=this,u=this.player_.volume();this.one("sliderinactive",function(){o.player_.volume()===0&&o.player_.lastVolume_(u)})},T}(ou);Na.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},!M&&!Ke&&Na.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),Na.prototype.playerEvent="volumechange",ge.registerComponent("VolumeBar",Na);var bp=function(v){I.default(T,v);function T(d,o){var u;return o===void 0&&(o={}),o.vertical=o.vertical||!1,(typeof o.volumeBar>"u"||Ve(o.volumeBar))&&(o.volumeBar=o.volumeBar||{},o.volumeBar.vertical=o.vertical),u=v.call(this,d,o)||this,U_(C.default(u),d),u.throttledHandleMouseMove=Ei(at(C.default(u),u.handleMouseMove),Yt),u.handleMouseUpHandler_=function(y){return u.handleMouseUp(y)},u.on("mousedown",function(y){return u.handleMouseDown(y)}),u.on("touchstart",function(y){return u.handleMouseDown(y)}),u.on("mousemove",function(y){return u.handleMouseMove(y)}),u.on(u.volumeBar,["focus","slideractive"],function(){u.volumeBar.addClass("vjs-slider-active"),u.addClass("vjs-slider-active"),u.trigger("slideractive")}),u.on(u.volumeBar,["blur","sliderinactive"],function(){u.volumeBar.removeClass("vjs-slider-active"),u.removeClass("vjs-slider-active"),u.trigger("sliderinactive")}),u}var g=T.prototype;return g.createEl=function(){var o="vjs-volume-horizontal";return this.options_.vertical&&(o="vjs-volume-vertical"),v.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+o})},g.handleMouseDown=function(o){var u=this.el_.ownerDocument;this.on(u,"mousemove",this.throttledHandleMouseMove),this.on(u,"touchmove",this.throttledHandleMouseMove),this.on(u,"mouseup",this.handleMouseUpHandler_),this.on(u,"touchend",this.handleMouseUpHandler_)},g.handleMouseUp=function(o){var u=this.el_.ownerDocument;this.off(u,"mousemove",this.throttledHandleMouseMove),this.off(u,"touchmove",this.throttledHandleMouseMove),this.off(u,"mouseup",this.handleMouseUpHandler_),this.off(u,"touchend",this.handleMouseUpHandler_)},g.handleMouseMove=function(o){this.volumeBar.handleMouseMove(o)},T}(ge);bp.prototype.options_={children:["volumeBar"]},ge.registerComponent("VolumeControl",bp);var j_=function(T,g){g.tech_&&!g.tech_.featuresMuteControl&&T.addClass("vjs-hidden"),T.on(g,"loadstart",function(){g.tech_.featuresMuteControl?T.removeClass("vjs-hidden"):T.addClass("vjs-hidden")})},Sp=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,j_(C.default(u),d),u.on(d,["loadstart","volumechange"],function(y){return u.update(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-mute-control "+v.prototype.buildCSSClass.call(this)},g.handleClick=function(o){var u=this.player_.volume(),y=this.player_.lastVolume_();if(u===0){var w=y<.1?.1:y;this.player_.volume(w),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())},g.update=function(o){this.updateIcon_(),this.updateControlText_()},g.updateIcon_=function(){var o=this.player_.volume(),u=3;M&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),o===0||this.player_.muted()?u=0:o<.33?u=1:o<.67&&(u=2);for(var y=0;y<4;y++)js(this.el_,"vjs-vol-"+y);_i(this.el_,"vjs-vol-"+u)},g.updateControlText_=function(){var o=this.player_.muted()||this.player_.volume()===0,u=o?"Unmute":"Mute";this.controlText()!==u&&this.controlText(u)},T}(Si);Sp.prototype.controlText_="Mute",ge.registerComponent("MuteToggle",Sp);var Cp=function(v){I.default(T,v);function T(d,o){var u;return o===void 0&&(o={}),typeof o.inline<"u"?o.inline=o.inline:o.inline=!0,(typeof o.volumeControl>"u"||Ve(o.volumeControl))&&(o.volumeControl=o.volumeControl||{},o.volumeControl.vertical=!o.inline),u=v.call(this,d,o)||this,u.handleKeyPressHandler_=function(y){return u.handleKeyPress(y)},u.on(d,["loadstart"],function(y){return u.volumePanelState_(y)}),u.on(u.muteToggle,"keyup",function(y){return u.handleKeyPress(y)}),u.on(u.volumeControl,"keyup",function(y){return u.handleVolumeControlKeyUp(y)}),u.on("keydown",function(y){return u.handleKeyPress(y)}),u.on("mouseover",function(y){return u.handleMouseOver(y)}),u.on("mouseout",function(y){return u.handleMouseOut(y)}),u.on(u.volumeControl,["slideractive"],u.sliderActive_),u.on(u.volumeControl,["sliderinactive"],u.sliderInactive_),u}var g=T.prototype;return g.sliderActive_=function(){this.addClass("vjs-slider-active")},g.sliderInactive_=function(){this.removeClass("vjs-slider-active")},g.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},g.createEl=function(){var o="vjs-volume-panel-horizontal";return this.options_.inline||(o="vjs-volume-panel-vertical"),v.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+o})},g.dispose=function(){this.handleMouseOut(),v.prototype.dispose.call(this)},g.handleVolumeControlKeyUp=function(o){S.default.isEventKey(o,"Esc")&&this.muteToggle.focus()},g.handleMouseOver=function(o){this.addClass("vjs-hover"),Gt(_.default,"keyup",this.handleKeyPressHandler_)},g.handleMouseOut=function(o){this.removeClass("vjs-hover"),xt(_.default,"keyup",this.handleKeyPressHandler_)},g.handleKeyPress=function(o){S.default.isEventKey(o,"Esc")&&this.handleMouseOut()},T}(ge);Cp.prototype.options_={children:["muteToggle","volumeControl"]},ge.registerComponent("VolumePanel",Cp);var wp=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,o&&(u.menuButton_=o.menuButton),u.focusedChild_=-1,u.on("keydown",function(y){return u.handleKeyDown(y)}),u.boundHandleBlur_=function(y){return u.handleBlur(y)},u.boundHandleTapClick_=function(y){return u.handleTapClick(y)},u}var g=T.prototype;return g.addEventListenerForItem=function(o){o instanceof ge&&(this.on(o,"blur",this.boundHandleBlur_),this.on(o,["tap","click"],this.boundHandleTapClick_))},g.removeEventListenerForItem=function(o){o instanceof ge&&(this.off(o,"blur",this.boundHandleBlur_),this.off(o,["tap","click"],this.boundHandleTapClick_))},g.removeChild=function(o){typeof o=="string"&&(o=this.getChild(o)),this.removeEventListenerForItem(o),v.prototype.removeChild.call(this,o)},g.addItem=function(o){var u=this.addChild(o);u&&this.addEventListenerForItem(u)},g.createEl=function(){var o=this.options_.contentElType||"ul";this.contentEl_=ke(o,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var u=v.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return u.appendChild(this.contentEl_),Gt(u,"click",function(y){y.preventDefault(),y.stopImmediatePropagation()}),u},g.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,v.prototype.dispose.call(this)},g.handleBlur=function(o){var u=o.relatedTarget||_.default.activeElement;if(!this.children().some(function(w){return w.el()===u})){var y=this.menuButton_;y&&y.buttonPressed_&&u!==y.el().firstChild&&y.unpressButton()}},g.handleTapClick=function(o){if(this.menuButton_){this.menuButton_.unpressButton();var u=this.children();if(!Array.isArray(u))return;var y=u.filter(function(w){return w.el()===o.target})[0];if(!y)return;y.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}},g.handleKeyDown=function(o){S.default.isEventKey(o,"Left")||S.default.isEventKey(o,"Down")?(o.preventDefault(),o.stopPropagation(),this.stepForward()):(S.default.isEventKey(o,"Right")||S.default.isEventKey(o,"Up"))&&(o.preventDefault(),o.stopPropagation(),this.stepBack())},g.stepForward=function(){var o=0;this.focusedChild_!==void 0&&(o=this.focusedChild_+1),this.focus(o)},g.stepBack=function(){var o=0;this.focusedChild_!==void 0&&(o=this.focusedChild_-1),this.focus(o)},g.focus=function(o){o===void 0&&(o=0);var u=this.children().slice(),y=u.length&&u[0].hasClass("vjs-menu-title");y&&u.shift(),u.length>0&&(o<0?o=0:o>=u.length&&(o=u.length-1),this.focusedChild_=o,u[o].el_.focus())},T}(ge);ge.registerComponent("Menu",wp);var cu=function(v){I.default(T,v);function T(d,o){var u;o===void 0&&(o={}),u=v.call(this,d,o)||this,u.menuButton_=new Si(d,o),u.menuButton_.controlText(u.controlText_),u.menuButton_.el_.setAttribute("aria-haspopup","true");var y=Si.prototype.buildCSSClass();u.menuButton_.el_.className=u.buildCSSClass()+" "+y,u.menuButton_.removeClass("vjs-control"),u.addChild(u.menuButton_),u.update(),u.enabled_=!0;var w=function($){return u.handleClick($)};return u.handleMenuKeyUp_=function(F){return u.handleMenuKeyUp(F)},u.on(u.menuButton_,"tap",w),u.on(u.menuButton_,"click",w),u.on(u.menuButton_,"keydown",function(F){return u.handleKeyDown(F)}),u.on(u.menuButton_,"mouseenter",function(){u.addClass("vjs-hover"),u.menu.show(),Gt(_.default,"keyup",u.handleMenuKeyUp_)}),u.on("mouseleave",function(F){return u.handleMouseLeave(F)}),u.on("keydown",function(F){return u.handleSubmenuKeyDown(F)}),u}var g=T.prototype;return g.update=function(){var o=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=o,this.addChild(o),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))},g.createMenu=function(){var o=new wp(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var u=ke("li",{className:"vjs-menu-title",textContent:Tt(this.options_.title),tabIndex:-1}),y=new ge(this.player_,{el:u});o.addItem(y)}if(this.items=this.createItems(),this.items)for(var w=0;w<this.items.length;w++)o.addItem(this.items[w]);return o},g.createItems=function(){},g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},g.buildWrapperCSSClass=function(){var o="vjs-menu-button";this.options_.inline===!0?o+="-inline":o+="-popup";var u=Si.prototype.buildCSSClass();return"vjs-menu-button "+o+" "+u+" "+v.prototype.buildCSSClass.call(this)},g.buildCSSClass=function(){var o="vjs-menu-button";return this.options_.inline===!0?o+="-inline":o+="-popup","vjs-menu-button "+o+" "+v.prototype.buildCSSClass.call(this)},g.controlText=function(o,u){return u===void 0&&(u=this.menuButton_.el()),this.menuButton_.controlText(o,u)},g.dispose=function(){this.handleMouseLeave(),v.prototype.dispose.call(this)},g.handleClick=function(o){this.buttonPressed_?this.unpressButton():this.pressButton()},g.handleMouseLeave=function(o){this.removeClass("vjs-hover"),xt(_.default,"keyup",this.handleMenuKeyUp_)},g.focus=function(){this.menuButton_.focus()},g.blur=function(){this.menuButton_.blur()},g.handleKeyDown=function(o){S.default.isEventKey(o,"Esc")||S.default.isEventKey(o,"Tab")?(this.buttonPressed_&&this.unpressButton(),S.default.isEventKey(o,"Tab")||(o.preventDefault(),this.menuButton_.focus())):(S.default.isEventKey(o,"Up")||S.default.isEventKey(o,"Down"))&&(this.buttonPressed_||(o.preventDefault(),this.pressButton()))},g.handleMenuKeyUp=function(o){(S.default.isEventKey(o,"Esc")||S.default.isEventKey(o,"Tab"))&&this.removeClass("vjs-hover")},g.handleSubmenuKeyPress=function(o){this.handleSubmenuKeyDown(o)},g.handleSubmenuKeyDown=function(o){(S.default.isEventKey(o,"Esc")||S.default.isEventKey(o,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),S.default.isEventKey(o,"Tab")||(o.preventDefault(),this.menuButton_.focus()))},g.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),M&&nt())return;this.menu.focus()}},g.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},g.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},g.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},T}(ge);ge.registerComponent("MenuButton",cu);var du=function(v){I.default(T,v);function T(g,d){var o,u=d.tracks;if(o=v.call(this,g,d)||this,o.items.length<=1&&o.hide(),!u)return C.default(o);var y=at(C.default(o),o.update);return u.addEventListener("removetrack",y),u.addEventListener("addtrack",y),u.addEventListener("labelchange",y),o.player_.on("ready",y),o.player_.on("dispose",function(){u.removeEventListener("removetrack",y),u.removeEventListener("addtrack",y),u.removeEventListener("labelchange",y)}),o}return T}(cu);ge.registerComponent("TrackButton",du);var V_=["Tab","Esc","Up","Down","Right","Left"],bn=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.selectable=o.selectable,u.isSelected_=o.selected||!1,u.multiSelectable=o.multiSelectable,u.selected(u.isSelected_),u.selectable?u.multiSelectable?u.el_.setAttribute("role","menuitemcheckbox"):u.el_.setAttribute("role","menuitemradio"):u.el_.setAttribute("role","menuitem"),u}var g=T.prototype;return g.createEl=function(o,u,y){this.nonIconControl=!0;var w=v.prototype.createEl.call(this,"li",Pe({className:"vjs-menu-item",tabIndex:-1},u),y);return w.replaceChild(ke("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),w.querySelector(".vjs-icon-placeholder")),w},g.handleKeyDown=function(o){V_.some(function(u){return S.default.isEventKey(o,u)})||v.prototype.handleKeyDown.call(this,o)},g.handleClick=function(o){this.selected(!0)},g.selected=function(o){this.selectable&&(o?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},T}(Oa);ge.registerComponent("MenuItem",bn);var Sn=function(v){I.default(T,v);function T(d,o){var u,y=o.track,w=d.textTracks();o.label=y.label||y.language||"Unknown",o.selected=y.mode==="showing",u=v.call(this,d,o)||this,u.track=y,u.kinds=(o.kinds||[o.kind||u.track.kind]).filter(Boolean);var F=function(){for(var V=arguments.length,pe=new Array(V),we=0;we<V;we++)pe[we]=arguments[we];u.handleTracksChange.apply(C.default(u),pe)},$=function(){for(var V=arguments.length,pe=new Array(V),we=0;we<V;we++)pe[we]=arguments[we];u.handleSelectedLanguageChange.apply(C.default(u),pe)};if(d.on(["loadstart","texttrackchange"],F),w.addEventListener("change",F),w.addEventListener("selectedlanguagechange",$),u.on("dispose",function(){d.off(["loadstart","texttrackchange"],F),w.removeEventListener("change",F),w.removeEventListener("selectedlanguagechange",$)}),w.onchange===void 0){var K;u.on(["tap","click"],function(){if(typeof m.default.Event!="object")try{K=new m.default.Event("change")}catch{}K||(K=_.default.createEvent("Event"),K.initEvent("change",!0,!0)),w.dispatchEvent(K)})}return u.handleTracksChange(),u}var g=T.prototype;return g.handleClick=function(o){var u=this.track,y=this.player_.textTracks();if(v.prototype.handleClick.call(this,o),!!y)for(var w=0;w<y.length;w++){var F=y[w];this.kinds.indexOf(F.kind)!==-1&&(F===u?F.mode!=="showing"&&(F.mode="showing"):F.mode!=="disabled"&&(F.mode="disabled"))}},g.handleTracksChange=function(o){var u=this.track.mode==="showing";u!==this.isSelected_&&this.selected(u)},g.handleSelectedLanguageChange=function(o){if(this.track.mode==="showing"){var u=this.player_.cache_.selectedLanguage;if(u&&u.enabled&&u.language===this.track.language&&u.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},g.dispose=function(){this.track=null,v.prototype.dispose.call(this)},T}(bn);ge.registerComponent("TextTrackMenuItem",Sn);var Ap=function(v){I.default(T,v);function T(d,o){return o.track={player:d,kind:o.kind,kinds:o.kinds,default:!1,mode:"disabled"},o.kinds||(o.kinds=[o.kind]),o.label?o.track.label=o.label:o.track.label=o.kinds.join(" and ")+" off",o.selectable=!0,o.multiSelectable=!1,v.call(this,d,o)||this}var g=T.prototype;return g.handleTracksChange=function(o){for(var u=this.player().textTracks(),y=!0,w=0,F=u.length;w<F;w++){var $=u[w];if(this.options_.kinds.indexOf($.kind)>-1&&$.mode==="showing"){y=!1;break}}y!==this.isSelected_&&this.selected(y)},g.handleSelectedLanguageChange=function(o){for(var u=this.player().textTracks(),y=!0,w=0,F=u.length;w<F;w++){var $=u[w];if(["captions","descriptions","subtitles"].indexOf($.kind)>-1&&$.mode==="showing"){y=!1;break}}y&&(this.player_.cache_.selectedLanguage={enabled:!1})},T}(Sn);ge.registerComponent("OffTextTrackMenuItem",Ap);var Lr=function(v){I.default(T,v);function T(d,o){return o===void 0&&(o={}),o.tracks=d.textTracks(),v.call(this,d,o)||this}var g=T.prototype;return g.createItems=function(o,u){o===void 0&&(o=[]),u===void 0&&(u=Sn);var y;this.label_&&(y=this.label_+" off"),o.push(new Ap(this.player_,{kinds:this.kinds_,kind:this.kind_,label:y})),this.hideThreshold_+=1;var w=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var F=0;F<w.length;F++){var $=w[F];if(this.kinds_.indexOf($.kind)>-1){var K=new u(this.player_,{track:$,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});K.addClass("vjs-"+$.kind+"-menu-item"),o.push(K)}}return o},T}(du);ge.registerComponent("TextTrackButton",Lr);var Ip=function(v){I.default(T,v);function T(d,o){var u,y=o.track,w=o.cue,F=d.currentTime();return o.selectable=!0,o.multiSelectable=!1,o.label=w.text,o.selected=w.startTime<=F&&F<w.endTime,u=v.call(this,d,o)||this,u.track=y,u.cue=w,u}var g=T.prototype;return g.handleClick=function(o){v.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime)},T}(bn);ge.registerComponent("ChaptersTrackMenuItem",Ip);var fu=function(v){I.default(T,v);function T(d,o,u){var y;return y=v.call(this,d,o,u)||this,y.selectCurrentItem_=function(){y.items.forEach(function(w){w.selected(y.track_.activeCues[0]===w.cue)})},y}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-chapters-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-chapters-button "+v.prototype.buildWrapperCSSClass.call(this)},g.update=function(o){if(!(o&&o.track&&o.track.kind!=="chapters")){var u=this.findChaptersTrack();u!==this.track_?(this.setTrack(u),v.prototype.update.call(this)):(!this.items||u&&u.cues&&u.cues.length!==this.items.length)&&v.prototype.update.call(this)}},g.setTrack=function(o){if(this.track_!==o){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var u=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);u&&u.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=o,this.track_){this.track_.mode="hidden";var y=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);y&&y.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}},g.findChaptersTrack=function(){for(var o=this.player_.textTracks()||[],u=o.length-1;u>=0;u--){var y=o[u];if(y.kind===this.kind_)return y}},g.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(Tt(this.kind_))},g.createMenu=function(){return this.options_.title=this.getMenuCaption(),v.prototype.createMenu.call(this)},g.createItems=function(){var o=[];if(!this.track_)return o;var u=this.track_.cues;if(!u)return o;for(var y=0,w=u.length;y<w;y++){var F=u[y],$=new Ip(this.player_,{track:this.track_,cue:F});o.push($)}return o},T}(Lr);fu.prototype.kind_="chapters",fu.prototype.controlText_="Chapters",ge.registerComponent("ChaptersButton",fu);var pu=function(v){I.default(T,v);function T(d,o,u){var y;y=v.call(this,d,o,u)||this;var w=d.textTracks(),F=at(C.default(y),y.handleTracksChange);return w.addEventListener("change",F),y.on("dispose",function(){w.removeEventListener("change",F)}),y}var g=T.prototype;return g.handleTracksChange=function(o){for(var u=this.player().textTracks(),y=!1,w=0,F=u.length;w<F;w++){var $=u[w];if($.kind!==this.kind_&&$.mode==="showing"){y=!0;break}}y?this.disable():this.enable()},g.buildCSSClass=function(){return"vjs-descriptions-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+v.prototype.buildWrapperCSSClass.call(this)},T}(Lr);pu.prototype.kind_="descriptions",pu.prototype.controlText_="Descriptions",ge.registerComponent("DescriptionsButton",pu);var gu=function(v){I.default(T,v);function T(d,o,u){return v.call(this,d,o,u)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-subtitles-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+v.prototype.buildWrapperCSSClass.call(this)},T}(Lr);gu.prototype.kind_="subtitles",gu.prototype.controlText_="Subtitles",ge.registerComponent("SubtitlesButton",gu);var mu=function(v){I.default(T,v);function T(d,o){var u;return o.track={player:d,kind:o.kind,label:o.kind+" settings",selectable:!1,default:!1,mode:"disabled"},o.selectable=!1,o.name="CaptionSettingsMenuItem",u=v.call(this,d,o)||this,u.addClass("vjs-texttrack-settings"),u.controlText(", opens "+o.kind+" settings dialog"),u}var g=T.prototype;return g.handleClick=function(o){this.player().getChild("textTrackSettings").open()},T}(Sn);ge.registerComponent("CaptionSettingsMenuItem",mu);var vu=function(v){I.default(T,v);function T(d,o,u){return v.call(this,d,o,u)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-captions-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-captions-button "+v.prototype.buildWrapperCSSClass.call(this)},g.createItems=function(){var o=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(o.push(new mu(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),v.prototype.createItems.call(this,o)},T}(Lr);vu.prototype.kind_="captions",vu.prototype.controlText_="Captions",ge.registerComponent("CaptionsButton",vu);var Lp=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(o,u,y){var w=v.prototype.createEl.call(this,o,u,y),F=w.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(F.appendChild(ke("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),F.appendChild(ke("span",{className:"vjs-control-text",textContent:" "+this.localize("Captions")}))),w},T}(Sn);ge.registerComponent("SubsCapsMenuItem",Lp);var yu=function(v){I.default(T,v);function T(d,o){var u;return o===void 0&&(o={}),u=v.call(this,d,o)||this,u.label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(u.player_.language_)>-1&&(u.label_="captions"),u.menuButton_.controlText(Tt(u.label_)),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-subs-caps-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+v.prototype.buildWrapperCSSClass.call(this)},g.createItems=function(){var o=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(o.push(new mu(this.player_,{kind:this.label_})),this.hideThreshold_+=1),o=v.prototype.createItems.call(this,o,Lp),o},T}(Lr);yu.prototype.kinds_=["captions","subtitles"],yu.prototype.controlText_="Subtitles",ge.registerComponent("SubsCapsButton",yu);var kp=function(v){I.default(T,v);function T(d,o){var u,y=o.track,w=d.audioTracks();o.label=y.label||y.language||"Unknown",o.selected=y.enabled,u=v.call(this,d,o)||this,u.track=y,u.addClass("vjs-"+y.kind+"-menu-item");var F=function(){for(var K=arguments.length,W=new Array(K),V=0;V<K;V++)W[V]=arguments[V];u.handleTracksChange.apply(C.default(u),W)};return w.addEventListener("change",F),u.on("dispose",function(){w.removeEventListener("change",F)}),u}var g=T.prototype;return g.createEl=function(o,u,y){var w=v.prototype.createEl.call(this,o,u,y),F=w.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="main-desc"&&(F.appendChild(ke("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),F.appendChild(ke("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),w},g.handleClick=function(o){if(v.prototype.handleClick.call(this,o),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks)for(var u=this.player_.audioTracks(),y=0;y<u.length;y++){var w=u[y];w!==this.track&&(w.enabled=w===this.track)}},g.handleTracksChange=function(o){this.selected(this.track.enabled)},T}(bn);ge.registerComponent("AudioTrackMenuItem",kp);var Rp=function(v){I.default(T,v);function T(d,o){return o===void 0&&(o={}),o.tracks=d.audioTracks(),v.call(this,d,o)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-audio-button "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-audio-button "+v.prototype.buildWrapperCSSClass.call(this)},g.createItems=function(o){o===void 0&&(o=[]),this.hideThreshold_=1;for(var u=this.player_.audioTracks(),y=0;y<u.length;y++){var w=u[y];o.push(new kp(this.player_,{track:w,selectable:!0,multiSelectable:!1}))}return o},T}(du);Rp.prototype.controlText_="Audio Track",ge.registerComponent("AudioTrackButton",Rp);var Tu=function(v){I.default(T,v);function T(d,o){var u,y=o.rate,w=parseFloat(y,10);return o.label=y,o.selected=w===d.playbackRate(),o.selectable=!0,o.multiSelectable=!1,u=v.call(this,d,o)||this,u.label=y,u.rate=w,u.on(d,"ratechange",function(F){return u.update(F)}),u}var g=T.prototype;return g.handleClick=function(o){v.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},g.update=function(o){this.selected(this.player().playbackRate()===this.rate)},T}(bn);Tu.prototype.contentElType="button",ge.registerComponent("PlaybackRateMenuItem",Tu);var Pp=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.menuButton_.el_.setAttribute("aria-describedby",u.labelElId_),u.updateVisibility(),u.updateLabel(),u.on(d,"loadstart",function(y){return u.updateVisibility(y)}),u.on(d,"ratechange",function(y){return u.updateLabel(y)}),u.on(d,"playbackrateschange",function(y){return u.handlePlaybackRateschange(y)}),u}var g=T.prototype;return g.createEl=function(){var o=v.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=ke("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),o.appendChild(this.labelEl_),o},g.dispose=function(){this.labelEl_=null,v.prototype.dispose.call(this)},g.buildCSSClass=function(){return"vjs-playback-rate "+v.prototype.buildCSSClass.call(this)},g.buildWrapperCSSClass=function(){return"vjs-playback-rate "+v.prototype.buildWrapperCSSClass.call(this)},g.createItems=function(){for(var o=this.playbackRates(),u=[],y=o.length-1;y>=0;y--)u.push(new Tu(this.player(),{rate:o[y]+"x"}));return u},g.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},g.handleClick=function(o){var u=this.player().playbackRate(),y=this.playbackRates(),w=y.indexOf(u),F=(w+1)%y.length;this.player().playbackRate(y[F])},g.handlePlaybackRateschange=function(o){this.update()},g.playbackRates=function(){var o=this.player();return o.playbackRates&&o.playbackRates()||[]},g.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},g.updateVisibility=function(o){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},g.updateLabel=function(o){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")},T}(cu);Pp.prototype.controlText_="Playback Rate",ge.registerComponent("PlaybackRateMenuButton",Pp);var Dp=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-spacer "+v.prototype.buildCSSClass.call(this)},g.createEl=function(o,u,y){return o===void 0&&(o="div"),u===void 0&&(u={}),y===void 0&&(y={}),u.className||(u.className=this.buildCSSClass()),v.prototype.createEl.call(this,o,u,y)},T}(ge);ge.registerComponent("Spacer",Dp);var G_=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-custom-control-spacer "+v.prototype.buildCSSClass.call(this)},g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),textContent:"\xA0"})},T}(Dp);ge.registerComponent("CustomControlSpacer",G_);var Ba=function(v){I.default(T,v);function T(){return v.apply(this,arguments)||this}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},T}(ge);Ba.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in _.default&&Ba.prototype.options_.children.splice(Ba.prototype.options_.children.length-1,0,"pictureInPictureToggle"),ge.registerComponent("ControlBar",Ba);var xp=function(v){I.default(T,v);function T(d,o){var u;return u=v.call(this,d,o)||this,u.on(d,"error",function(y){return u.open(y)}),u}var g=T.prototype;return g.buildCSSClass=function(){return"vjs-error-display "+v.prototype.buildCSSClass.call(this)},g.content=function(){var o=this.player().error();return o?this.localize(o.message):""},T}(br);xp.prototype.options_=E.default({},br.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),ge.registerComponent("ErrorDisplay",xp);var _u="vjs-text-track-settings",Op=["#000","Black"],Mp=["#00F","Blue"],Fp=["#0FF","Cyan"],Np=["#0F0","Green"],Bp=["#F0F","Magenta"],Up=["#F00","Red"],$p=["#FFF","White"],Hp=["#FF0","Yellow"],Eu=["1","Opaque"],bu=["0.5","Semi-Transparent"],jp=["0","Transparent"],Ys={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[Op,$p,Up,Np,Mp,Hp,Bp,Fp]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[Eu,bu,jp]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[$p,Op,Up,Np,Mp,Hp,Bp,Fp]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(T){return T==="1.00"?null:Number(T)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[Eu,bu]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[jp,bu,Eu]}};Ys.windowColor.options=Ys.backgroundColor.options;function Vp(v,T){if(T&&(v=T(v)),v&&v!=="none")return v}function K_(v,T){var g=v.options[v.options.selectedIndex].value;return Vp(g,T)}function q_(v,T,g){if(T){for(var d=0;d<v.options.length;d++)if(Vp(v.options[d].value,g)===T){v.selectedIndex=d;break}}}var W_=function(v){I.default(T,v);function T(d,o){var u;return o.temporary=!1,u=v.call(this,d,o)||this,u.updateDisplay=u.updateDisplay.bind(C.default(u)),u.fill(),u.hasBeenOpened_=u.hasBeenFilled_=!0,u.endDialog=ke("p",{className:"vjs-control-text",textContent:u.localize("End of dialog window.")}),u.el().appendChild(u.endDialog),u.setDefaults(),o.persistTextTrackSettings===void 0&&(u.options_.persistTextTrackSettings=u.options_.playerOptions.persistTextTrackSettings),u.on(u.$(".vjs-done-button"),"click",function(){u.saveSettings(),u.close()}),u.on(u.$(".vjs-default-button"),"click",function(){u.setDefaults(),u.updateDisplay()}),Re(Ys,function(y){u.on(u.$(y.selector),"change",u.updateDisplay)}),u.options_.persistTextTrackSettings&&u.restoreSettings(),u}var g=T.prototype;return g.dispose=function(){this.endDialog=null,v.prototype.dispose.call(this)},g.createElSelect_=function(o,u,y){var w=this;u===void 0&&(u=""),y===void 0&&(y="label");var F=Ys[o],$=F.id.replace("%s",this.id_),K=[u,$].join(" ").trim();return["<"+y+' id="'+$+'" class="'+(y==="label"?"vjs-label":"")+'">',this.localize(F.label),"</"+y+">",'<select aria-labelledby="'+K+'">'].concat(F.options.map(function(W){var V=$+"-"+W[1].replace(/\W+/g,"");return['<option id="'+V+'" value="'+W[0]+'" ','aria-labelledby="'+K+" "+V+'">',w.localize(W[1]),"</option>"].join("")})).concat("</select>").join("")},g.createElFgColor_=function(){var o="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+o+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",o),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",o),"</span>","</fieldset>"].join("")},g.createElBgColor_=function(){var o="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+o+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",o),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",o),"</span>","</fieldset>"].join("")},g.createElWinColor_=function(){var o="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+o+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",o),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",o),"</span>","</fieldset>"].join("")},g.createElColors_=function(){return ke("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},g.createElFont_=function(){return ke("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},g.createElControls_=function(){var o=this.localize("restore all settings to the default values");return ke("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+o+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+o+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},g.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},g.label=function(){return this.localize("Caption Settings Dialog")},g.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},g.buildCSSClass=function(){return v.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},g.getValues=function(){var o=this;return Oe(Ys,function(u,y,w){var F=K_(o.$(y.selector),y.parser);return F!==void 0&&(u[w]=F),u},{})},g.setValues=function(o){var u=this;Re(Ys,function(y,w){q_(u.$(y.selector),o[w],y.parser)})},g.setDefaults=function(){var o=this;Re(Ys,function(u){var y=u.hasOwnProperty("default")?u.default:0;o.$(u.selector).selectedIndex=y})},g.restoreSettings=function(){var o;try{o=JSON.parse(m.default.localStorage.getItem(_u))}catch(u){Y.warn(u)}o&&this.setValues(o)},g.saveSettings=function(){if(this.options_.persistTextTrackSettings){var o=this.getValues();try{Object.keys(o).length?m.default.localStorage.setItem(_u,JSON.stringify(o)):m.default.localStorage.removeItem(_u)}catch(u){Y.warn(u)}}},g.updateDisplay=function(){var o=this.player_.getChild("textTrackDisplay");o&&o.updateDisplay()},g.conditionalBlur_=function(){this.previouslyActiveEl_=null;var o=this.player_.controlBar,u=o&&o.subsCapsButton,y=o&&o.captionsButton;u?u.focus():y&&y.focus()},T}(br);ge.registerComponent("TextTrackSettings",W_);var z_=function(v){I.default(T,v);function T(d,o){var u,y=o.ResizeObserver||m.default.ResizeObserver;o.ResizeObserver===null&&(y=!1);var w=dt({createEl:!y,reportTouchActivity:!1},o);return u=v.call(this,d,w)||this,u.ResizeObserver=o.ResizeObserver||m.default.ResizeObserver,u.loadListener_=null,u.resizeObserver_=null,u.debouncedHandler_=_e(function(){u.resizeHandler()},100,!1,C.default(u)),y?(u.resizeObserver_=new u.ResizeObserver(u.debouncedHandler_),u.resizeObserver_.observe(d.el())):(u.loadListener_=function(){if(!(!u.el_||!u.el_.contentWindow)){var F=u.debouncedHandler_,$=u.unloadListener_=function(){xt(this,"resize",F),xt(this,"unload",$),$=null};Gt(u.el_.contentWindow,"unload",$),Gt(u.el_.contentWindow,"resize",F)}},u.one("load",u.loadListener_)),u}var g=T.prototype;return g.createEl=function(){return v.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})},g.resizeHandler=function(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")},g.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,v.prototype.dispose.call(this)},T}(ge);ge.registerComponent("ResizeManager",z_);var Y_={trackingThreshold:20,liveTolerance:15},X_=function(v){I.default(T,v);function T(d,o){var u,y=dt(Y_,o,{createEl:!1});return u=v.call(this,d,y)||this,u.handleVisibilityChange_=function(w){return u.handleVisibilityChange(w)},u.trackLiveHandler_=function(){return u.trackLive_()},u.handlePlay_=function(w){return u.handlePlay(w)},u.handleFirstTimeupdate_=function(w){return u.handleFirstTimeupdate(w)},u.handleSeeked_=function(w){return u.handleSeeked(w)},u.seekToLiveEdge_=function(w){return u.seekToLiveEdge(w)},u.reset_(),u.on(u.player_,"durationchange",function(w){return u.handleDurationchange(w)}),u.on(u.player_,"canplay",function(){return u.toggleTracking()}),Ft&&"hidden"in _.default&&"visibilityState"in _.default&&u.on(_.default,"visibilitychange",u.handleVisibilityChange_),u}var g=T.prototype;return g.handleVisibilityChange=function(){this.player_.duration()===1/0&&(_.default.hidden?this.stopTracking():this.startTracking())},g.trackLive_=function(){var o=this.player_.seekable();if(!(!o||!o.length)){var u=Number(m.default.performance.now().toFixed(4)),y=this.lastTime_===-1?0:(u-this.lastTime_)/1e3;this.lastTime_=u,this.pastSeekEnd_=this.pastSeekEnd()+y;var w=this.liveCurrentTime(),F=this.player_.currentTime(),$=this.player_.paused()||this.seekedBehindLive_||Math.abs(w-F)>this.options_.liveTolerance;(!this.timeupdateSeen_||w===1/0)&&($=!1),$!==this.behindLiveEdge_&&(this.behindLiveEdge_=$,this.trigger("liveedgechange"))}},g.handleDurationchange=function(){this.toggleTracking()},g.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},g.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,Yt),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},g.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},g.handleSeeked=function(){var o=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&o>2,this.nextSeekedFromUser_=!1,this.trackLive_()},g.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},g.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},g.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},g.stopTracking=function(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))},g.seekableEnd=function(){for(var o=this.player_.seekable(),u=[],y=o?o.length:0;y--;)u.push(o.end(y));return u.length?u.sort()[u.length-1]:1/0},g.seekableStart=function(){for(var o=this.player_.seekable(),u=[],y=o?o.length:0;y--;)u.push(o.start(y));return u.length?u.sort()[0]:0},g.liveWindow=function(){var o=this.liveCurrentTime();return o===1/0?0:o-this.seekableStart()},g.isLive=function(){return this.isTracking()},g.atLiveEdge=function(){return!this.behindLiveEdge()},g.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},g.pastSeekEnd=function(){var o=this.seekableEnd();return this.lastSeekEnd_!==-1&&o!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=o,this.pastSeekEnd_},g.behindLiveEdge=function(){return this.behindLiveEdge_},g.isTracking=function(){return typeof this.trackingInterval_=="number"},g.seekToLiveEdge=function(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},g.dispose=function(){this.off(_.default,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),v.prototype.dispose.call(this)},T}(ge);ge.registerComponent("LiveTracker",X_);var Su=function(T){var g=T.el();if(g.hasAttribute("src"))return T.triggerSourceset(g.src),!0;var d=T.$$("source"),o=[],u="";if(!d.length)return!1;for(var y=0;y<d.length;y++){var w=d[y].src;w&&o.indexOf(w)===-1&&o.push(w)}return o.length?(o.length===1&&(u=o[0]),T.triggerSourceset(u),!0):!1},Q_=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(T){var g=_.default.createElement(this.nodeName.toLowerCase());g.innerHTML=T;for(var d=_.default.createDocumentFragment();g.childNodes.length;)d.appendChild(g.childNodes[0]);return this.innerText="",m.default.Element.prototype.appendChild.call(this,d),this.innerHTML}}),Gp=function(T,g){for(var d={},o=0;o<T.length&&(d=Object.getOwnPropertyDescriptor(T[o],g),!(d&&d.set&&d.get));o++);return d.enumerable=!0,d.configurable=!0,d},J_=function(T){return Gp([T.el(),m.default.HTMLMediaElement.prototype,m.default.Element.prototype,Q_],"innerHTML")},Kp=function(T){var g=T.el();if(!g.resetSourceWatch_){var d={},o=J_(T),u=function(w){return function(){for(var F=arguments.length,$=new Array(F),K=0;K<F;K++)$[K]=arguments[K];var W=w.apply(g,$);return Su(T),W}};["append","appendChild","insertAdjacentHTML"].forEach(function(y){g[y]&&(d[y]=g[y],g[y]=u(d[y]))}),Object.defineProperty(g,"innerHTML",dt(o,{set:u(o.set)})),g.resetSourceWatch_=function(){g.resetSourceWatch_=null,Object.keys(d).forEach(function(y){g[y]=d[y]}),Object.defineProperty(g,"innerHTML",o)},T.one("sourceset",g.resetSourceWatch_)}},Z_=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?tp(m.default.Element.prototype.getAttribute.call(this,"src")):""},set:function(T){return m.default.Element.prototype.setAttribute.call(this,"src",T),T}}),eE=function(T){return Gp([T.el(),m.default.HTMLMediaElement.prototype,Z_],"src")},tE=function(T){if(T.featuresSourceset){var g=T.el();if(!g.resetSourceset_){var d=eE(T),o=g.setAttribute,u=g.load;Object.defineProperty(g,"src",dt(d,{set:function(w){var F=d.set.call(g,w);return T.triggerSourceset(g.src),F}})),g.setAttribute=function(y,w){var F=o.call(g,y,w);return/src/i.test(y)&&T.triggerSourceset(g.src),F},g.load=function(){var y=u.call(g);return Su(T)||(T.triggerSourceset(""),Kp(T)),y},g.currentSrc?T.triggerSourceset(g.currentSrc):Su(T)||Kp(T),g.resetSourceset_=function(){g.resetSourceset_=null,g.load=u,g.setAttribute=o,Object.defineProperty(g,"src",d),g.resetSourceWatch_&&g.resetSourceWatch_()}}}},Cu=function(T,g,d,o){o===void 0&&(o=!0);var u=function(F){return Object.defineProperty(T,g,{value:F,enumerable:!0,writable:!0})},y={configurable:!0,enumerable:!0,get:function(){var F=d();return u(F),F}};return o&&(y.set=u),Object.defineProperty(T,g,y)},Se=function(v){I.default(T,v);function T(d,o){var u;u=v.call(this,d,o)||this;var y=d.source,w=!1;if(u.featuresVideoFrameCallback=u.featuresVideoFrameCallback&&u.el_.tagName==="VIDEO",y&&(u.el_.currentSrc!==y.src||d.tag&&d.tag.initNetworkState_===3)?u.setSource(y):u.handleLateInit_(u.el_),d.enableSourceset&&u.setupSourcesetHandling_(),u.isScrubbing_=!1,u.el_.hasChildNodes()){for(var F=u.el_.childNodes,$=F.length,K=[];$--;){var W=F[$],V=W.nodeName.toLowerCase();V==="track"&&(u.featuresNativeTextTracks?(u.remoteTextTrackEls().addTrackElement_(W),u.remoteTextTracks().addTrack(W.track),u.textTracks().addTrack(W.track),!w&&!u.el_.hasAttribute("crossorigin")&&Pa(W.src)&&(w=!0)):K.push(W))}for(var pe=0;pe<K.length;pe++)u.el_.removeChild(K[pe])}return u.proxyNativeTracks_(),u.featuresNativeTextTracks&&w&&Y.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),u.restoreMetadataTracksInIOSNativePlayer_(),(zt||kt||Vt)&&d.nativeControlsForTouch===!0&&u.setControls(!0),u.proxyWebkitFullscreen_(),u.triggerReady(),u}var g=T.prototype;return g.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),T.disposeMediaElement(this.el_),this.options_=null,v.prototype.dispose.call(this)},g.setupSourcesetHandling_=function(){tE(this)},g.restoreMetadataTracksInIOSNativePlayer_=function(){var o=this.textTracks(),u,y=function(){u=[];for(var $=0;$<o.length;$++){var K=o[$];K.kind==="metadata"&&u.push({track:K,storedMode:K.mode})}};y(),o.addEventListener("change",y),this.on("dispose",function(){return o.removeEventListener("change",y)});var w=function F(){for(var $=0;$<u.length;$++){var K=u[$];K.track.mode==="disabled"&&K.track.mode!==K.storedMode&&(K.track.mode=K.storedMode)}o.removeEventListener("change",F)};this.on("webkitbeginfullscreen",function(){o.removeEventListener("change",y),o.removeEventListener("change",w),o.addEventListener("change",w)}),this.on("webkitendfullscreen",function(){o.removeEventListener("change",y),o.addEventListener("change",y),o.removeEventListener("change",w)})},g.overrideNative_=function(o,u){var y=this;if(u===this["featuresNative"+o+"Tracks"]){var w=o.toLowerCase();this[w+"TracksListeners_"]&&Object.keys(this[w+"TracksListeners_"]).forEach(function(F){var $=y.el()[w+"Tracks"];$.removeEventListener(F,y[w+"TracksListeners_"][F])}),this["featuresNative"+o+"Tracks"]=!u,this[w+"TracksListeners_"]=null,this.proxyNativeTracksForType_(w)}},g.overrideNativeAudioTracks=function(o){this.overrideNative_("Audio",o)},g.overrideNativeVideoTracks=function(o){this.overrideNative_("Video",o)},g.proxyNativeTracksForType_=function(o){var u=this,y=ci[o],w=this.el()[y.getterName],F=this[y.getterName]();if(!(!this["featuresNative"+y.capitalName+"Tracks"]||!w||!w.addEventListener)){var $={change:function(V){var pe={type:"change",target:F,currentTarget:F,srcElement:F};F.trigger(pe),o==="text"&&u[wr.remoteText.getterName]().trigger(pe)},addtrack:function(V){F.addTrack(V.track)},removetrack:function(V){F.removeTrack(V.track)}},K=function(){for(var V=[],pe=0;pe<F.length;pe++){for(var we=!1,We=0;We<w.length;We++)if(w[We]===F[pe]){we=!0;break}we||V.push(F[pe])}for(;V.length;)F.removeTrack(V.shift())};this[y.getterName+"Listeners_"]=$,Object.keys($).forEach(function(W){var V=$[W];w.addEventListener(W,V),u.on("dispose",function(pe){return w.removeEventListener(W,V)})}),this.on("loadstart",K),this.on("dispose",function(W){return u.off("loadstart",K)})}},g.proxyNativeTracks_=function(){var o=this;ci.names.forEach(function(u){o.proxyNativeTracksForType_(u)})},g.createEl=function(){var o=this.options_.tag;if(!o||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(o){var u=o.cloneNode(!0);o.parentNode&&o.parentNode.insertBefore(u,o),T.disposeMediaElement(o),o=u}else{o=_.default.createElement("video");var y=this.options_.tag&&ui(this.options_.tag),w=dt({},y);(!zt||this.options_.nativeControlsForTouch!==!0)&&delete w.controls,pa(o,Pe(w,{id:this.options_.techId,class:"vjs-tech"}))}o.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&gs(o,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(o.disablePictureInPicture=this.options_.disablePictureInPicture);for(var F=["loop","muted","playsinline","autoplay"],$=0;$<F.length;$++){var K=F[$],W=this.options_[K];typeof W<"u"&&(W?gs(o,K,K):mr(o,K),o[K]=W)}return o},g.handleLateInit_=function(o){if(!(o.networkState===0||o.networkState===3)){if(o.readyState===0){var u=!1,y=function(){u=!0};this.on("loadstart",y);var w=function(){u||this.trigger("loadstart")};this.on("loadedmetadata",w),this.ready(function(){this.off("loadstart",y),this.off("loadedmetadata",w),u||this.trigger("loadstart")});return}var F=["loadstart"];F.push("loadedmetadata"),o.readyState>=2&&F.push("loadeddata"),o.readyState>=3&&F.push("canplay"),o.readyState>=4&&F.push("canplaythrough"),this.ready(function(){F.forEach(function($){this.trigger($)},this)})}},g.setScrubbing=function(o){this.isScrubbing_=o},g.scrubbing=function(){return this.isScrubbing_},g.setCurrentTime=function(o){try{this.isScrubbing_&&this.el_.fastSeek&&b?this.el_.fastSeek(o):this.el_.currentTime=o}catch(u){Y(u,"Video is not ready. (Video.js)")}},g.duration=function(){var o=this;if(this.el_.duration===1/0&&Ke&&yt&&this.el_.currentTime===0){var u=function y(){o.el_.currentTime>0&&(o.el_.duration===1/0&&o.trigger("durationchange"),o.off("timeupdate",y))};return this.on("timeupdate",u),NaN}return this.el_.duration||NaN},g.width=function(){return this.el_.offsetWidth},g.height=function(){return this.el_.offsetHeight},g.proxyWebkitFullscreen_=function(){var o=this;if("webkitDisplayingFullscreen"in this.el_){var u=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},y=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",u),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",y),this.on("dispose",function(){o.off("webkitbeginfullscreen",y),o.off("webkitendfullscreen",u)})}},g.supportsFullScreen=function(){if(typeof this.el_.webkitEnterFullScreen=="function"){var o=m.default.navigator&&m.default.navigator.userAgent||"";if(/Android/.test(o)||!/Chrome|Mac OS X 10.5/.test(o))return!0}return!1},g.enterFullScreen=function(){var o=this.el_;if(o.paused&&o.networkState<=o.HAVE_METADATA)xi(this.el_.play()),this.setTimeout(function(){o.pause();try{o.webkitEnterFullScreen()}catch(u){this.trigger("fullscreenerror",u)}},0);else try{o.webkitEnterFullScreen()}catch(u){this.trigger("fullscreenerror",u)}},g.exitFullScreen=function(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()},g.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},g.requestVideoFrameCallback=function(o){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(o):v.prototype.requestVideoFrameCallback.call(this,o)},g.cancelVideoFrameCallback=function(o){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(o):v.prototype.cancelVideoFrameCallback.call(this,o)},g.src=function(o){if(o===void 0)return this.el_.src;this.setSrc(o)},g.reset=function(){T.resetMediaElement(this.el_)},g.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},g.setControls=function(o){this.el_.controls=!!o},g.addTextTrack=function(o,u,y){return this.featuresNativeTextTracks?this.el_.addTextTrack(o,u,y):v.prototype.addTextTrack.call(this,o,u,y)},g.createRemoteTextTrack=function(o){if(!this.featuresNativeTextTracks)return v.prototype.createRemoteTextTrack.call(this,o);var u=_.default.createElement("track");return o.kind&&(u.kind=o.kind),o.label&&(u.label=o.label),(o.language||o.srclang)&&(u.srclang=o.language||o.srclang),o.default&&(u.default=o.default),o.id&&(u.id=o.id),o.src&&(u.src=o.src),u},g.addRemoteTextTrack=function(o,u){var y=v.prototype.addRemoteTextTrack.call(this,o,u);return this.featuresNativeTextTracks&&this.el().appendChild(y),y},g.removeRemoteTextTrack=function(o){if(v.prototype.removeRemoteTextTrack.call(this,o),this.featuresNativeTextTracks)for(var u=this.$$("track"),y=u.length;y--;)(o===u[y]||o===u[y].track)&&this.el().removeChild(u[y])},g.getVideoPlaybackQuality=function(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();var o={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(o.droppedVideoFrames=this.el().webkitDroppedFrameCount,o.totalVideoFrames=this.el().webkitDecodedFrameCount),m.default.performance&&typeof m.default.performance.now=="function"?o.creationTime=m.default.performance.now():m.default.performance&&m.default.performance.timing&&typeof m.default.performance.timing.navigationStart=="number"&&(o.creationTime=m.default.Date.now()-m.default.performance.timing.navigationStart),o},T}(ot);Cu(Se,"TEST_VID",function(){if(le()){var v=_.default.createElement("video"),T=_.default.createElement("track");return T.kind="captions",T.srclang="en",T.label="English",v.appendChild(T),v}}),Se.isSupported=function(){try{Se.TEST_VID.volume=.5}catch{return!1}return!!(Se.TEST_VID&&Se.TEST_VID.canPlayType)},Se.canPlayType=function(v){return Se.TEST_VID.canPlayType(v)},Se.canPlaySource=function(v,T){return Se.canPlayType(v.type)},Se.canControlVolume=function(){try{var v=Se.TEST_VID.volume;Se.TEST_VID.volume=v/2+.1;var T=v!==Se.TEST_VID.volume;return T&&M?(m.default.setTimeout(function(){Se&&Se.prototype&&(Se.prototype.featuresVolumeControl=v!==Se.TEST_VID.volume)}),!1):T}catch{return!1}},Se.canMuteVolume=function(){try{var v=Se.TEST_VID.muted;return Se.TEST_VID.muted=!v,Se.TEST_VID.muted?gs(Se.TEST_VID,"muted","muted"):mr(Se.TEST_VID,"muted","muted"),v!==Se.TEST_VID.muted}catch{return!1}},Se.canControlPlaybackRate=function(){if(Ke&&yt&&Ti<58)return!1;try{var v=Se.TEST_VID.playbackRate;return Se.TEST_VID.playbackRate=v/2+.1,v!==Se.TEST_VID.playbackRate}catch{return!1}},Se.canOverrideAttributes=function(){try{var v=function(){};Object.defineProperty(_.default.createElement("video"),"src",{get:v,set:v}),Object.defineProperty(_.default.createElement("audio"),"src",{get:v,set:v}),Object.defineProperty(_.default.createElement("video"),"innerHTML",{get:v,set:v}),Object.defineProperty(_.default.createElement("audio"),"innerHTML",{get:v,set:v})}catch{return!1}return!0},Se.supportsNativeTextTracks=function(){return b||M&&yt},Se.supportsNativeVideoTracks=function(){return!!(Se.TEST_VID&&Se.TEST_VID.videoTracks)},Se.supportsNativeAudioTracks=function(){return!!(Se.TEST_VID&&Se.TEST_VID.audioTracks)},Se.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(v){var T=v[0],g=v[1];Cu(Se.prototype,T,function(){return Se[g]()},!0)}),Se.prototype.featuresVolumeControl=Se.canControlVolume(),Se.prototype.movingMediaElementInDOM=!M,Se.prototype.featuresFullscreenResize=!0,Se.prototype.featuresProgressEvents=!0,Se.prototype.featuresTimeupdateEvents=!0,Se.prototype.featuresVideoFrameCallback=!!(Se.TEST_VID&&Se.TEST_VID.requestVideoFrameCallback);var Ua;Se.patchCanPlayType=function(){St>=4&&!Ct&&!yt&&(Ua=Se.TEST_VID&&Se.TEST_VID.constructor.prototype.canPlayType,Se.TEST_VID.constructor.prototype.canPlayType=function(v){var T=/^application\/(?:x-|vnd\.apple\.)mpegurl/i;return v&&T.test(v)?"maybe":Ua.call(this,v)})},Se.unpatchCanPlayType=function(){var v=Se.TEST_VID.constructor.prototype.canPlayType;return Ua&&(Se.TEST_VID.constructor.prototype.canPlayType=Ua),v},Se.patchCanPlayType(),Se.disposeMediaElement=function(v){if(v){for(v.parentNode&&v.parentNode.removeChild(v);v.hasChildNodes();)v.removeChild(v.firstChild);v.removeAttribute("src"),typeof v.load=="function"&&function(){try{v.load()}catch{}}()}},Se.resetMediaElement=function(v){if(v){for(var T=v.querySelectorAll("source"),g=T.length;g--;)v.removeChild(T[g]);v.removeAttribute("src"),typeof v.load=="function"&&function(){try{v.load()}catch{}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(v){Se.prototype[v]=function(){return this.el_[v]||this.el_.hasAttribute(v)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(v){Se.prototype["set"+Tt(v)]=function(T){this.el_[v]=T,T?this.el_.setAttribute(v,v):this.el_.removeAttribute(v)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(v){Se.prototype[v]=function(){return this.el_[v]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(v){Se.prototype["set"+Tt(v)]=function(T){this.el_[v]=T}}),["pause","load","play"].forEach(function(v){Se.prototype[v]=function(){return this.el_[v]()}}),ot.withSourceHandlers(Se),Se.nativeSourceHandler={},Se.nativeSourceHandler.canPlayType=function(v){try{return Se.TEST_VID.canPlayType(v)}catch{return""}},Se.nativeSourceHandler.canHandleSource=function(v,T){if(v.type)return Se.nativeSourceHandler.canPlayType(v.type);if(v.src){var g=Jl(v.src);return Se.nativeSourceHandler.canPlayType("video/"+g)}return""},Se.nativeSourceHandler.handleSource=function(v,T,g){T.setSrc(v.src)},Se.nativeSourceHandler.dispose=function(){},Se.registerSourceHandler(Se.nativeSourceHandler),ot.registerTech("Html5",Se);var qp=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],wu={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},Au=["tiny","xsmall","small","medium","large","xlarge","huge"],$a={};Au.forEach(function(v){var T=v.charAt(0)==="x"?"x-"+v.substring(1):v;$a[v]="vjs-layout-"+T});var iE={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},At=function(v){I.default(T,v);function T(d,o,u){var y;if(d.id=d.id||o.id||"vjs_video_"+hi(),o=Pe(T.getTagSettings(d),o),o.initChildren=!1,o.createEl=!1,o.evented=!1,o.reportTouchActivity=!1,!o.language)if(typeof d.closest=="function"){var w=d.closest("[lang]");w&&w.getAttribute&&(o.language=w.getAttribute("lang"))}else for(var F=d;F&&F.nodeType===1;){if(ui(F).hasOwnProperty("lang")){o.language=F.getAttribute("lang");break}F=F.parentNode}if(y=v.call(this,null,o,u)||this,y.boundDocumentFullscreenChange_=function(V){return y.documentFullscreenChange_(V)},y.boundFullWindowOnEscKey_=function(V){return y.fullWindowOnEscKey(V)},y.boundUpdateStyleEl_=function(V){return y.updateStyleEl_(V)},y.boundApplyInitTime_=function(V){return y.applyInitTime_(V)},y.boundUpdateCurrentBreakpoint_=function(V){return y.updateCurrentBreakpoint_(V)},y.boundHandleTechClick_=function(V){return y.handleTechClick_(V)},y.boundHandleTechDoubleClick_=function(V){return y.handleTechDoubleClick_(V)},y.boundHandleTechTouchStart_=function(V){return y.handleTechTouchStart_(V)},y.boundHandleTechTouchMove_=function(V){return y.handleTechTouchMove_(V)},y.boundHandleTechTouchEnd_=function(V){return y.handleTechTouchEnd_(V)},y.boundHandleTechTap_=function(V){return y.handleTechTap_(V)},y.isFullscreen_=!1,y.log=ee(y.id_),y.fsApi_=ie,y.isPosterFromTech_=!1,y.queuedCallbacks_=[],y.isReady_=!1,y.hasStarted_=!1,y.userActive_=!1,y.debugEnabled_=!1,y.audioOnlyMode_=!1,y.audioPosterMode_=!1,y.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!y.options_||!y.options_.techOrder||!y.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(y.tag=d,y.tagAttributes=d&&ui(d),y.language(y.options_.language),o.languages){var $={};Object.getOwnPropertyNames(o.languages).forEach(function(V){$[V.toLowerCase()]=o.languages[V]}),y.languages_=$}else y.languages_=T.prototype.options_.languages;y.resetCache_(),y.poster_=o.poster||"",y.controls_=!!o.controls,d.controls=!1,d.removeAttribute("controls"),y.changingSrc_=!1,y.playCallbacks_=[],y.playTerminatedQueue_=[],d.hasAttribute("autoplay")?y.autoplay(!0):y.autoplay(y.options_.autoplay),o.plugins&&Object.keys(o.plugins).forEach(function(V){if(typeof y[V]!="function")throw new Error('plugin "'+V+'" does not exist')}),y.scrubbing_=!1,y.el_=y.createEl(),Tn(C.default(y),{eventBusKey:"el_"}),y.fsApi_.requestFullscreen&&(Gt(_.default,y.fsApi_.fullscreenchange,y.boundDocumentFullscreenChange_),y.on(y.fsApi_.fullscreenchange,y.boundDocumentFullscreenChange_)),y.fluid_&&y.on(["playerreset","resize"],y.boundUpdateStyleEl_);var K=dt(y.options_);o.plugins&&Object.keys(o.plugins).forEach(function(V){y[V](o.plugins[V])}),o.debug&&y.debug(!0),y.options_.playerOptions=K,y.middleware_=[],y.playbackRates(o.playbackRates),y.initChildren(),y.isAudio(d.nodeName.toLowerCase()==="audio"),y.controls()?y.addClass("vjs-controls-enabled"):y.addClass("vjs-controls-disabled"),y.el_.setAttribute("role","region"),y.isAudio()?y.el_.setAttribute("aria-label",y.localize("Audio Player")):y.el_.setAttribute("aria-label",y.localize("Video Player")),y.isAudio()&&y.addClass("vjs-audio"),y.flexNotSupported_()&&y.addClass("vjs-no-flex"),zt&&y.addClass("vjs-touch-enabled"),M||y.addClass("vjs-workinghover"),T.players[y.id_]=C.default(y);var W=B.split(".")[0];return y.addClass("vjs-v"+W),y.userActive(!0),y.reportUserActivity(),y.one("play",function(V){return y.listenForUserActivity_(V)}),y.on("stageclick",function(V){return y.handleStageClick_(V)}),y.on("keydown",function(V){return y.handleKeyDown(V)}),y.on("languagechange",function(V){return y.handleLanguagechange(V)}),y.breakpoints(y.options_.breakpoints),y.responsive(y.options_.responsive),y.on("ready",function(){y.audioPosterMode(y.options_.audioPosterMode),y.audioOnlyMode(y.options_.audioOnlyMode)}),y}var g=T.prototype;return g.dispose=function(){var o=this;this.trigger("dispose"),this.off("dispose"),xt(_.default,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),xt(_.default,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),T.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),b_(this),qt.names.forEach(function(u){var y=qt[u],w=o[y.getterName]();w&&w.off&&w.off()}),v.prototype.dispose.call(this,{restoreEl:this.options_.restoreEl})},g.createEl=function(){var o=this.tag,u,y=this.playerElIngest_=o.parentNode&&o.parentNode.hasAttribute&&o.parentNode.hasAttribute("data-vjs-player"),w=this.tag.tagName.toLowerCase()==="video-js";y?u=this.el_=o.parentNode:w||(u=this.el_=v.prototype.createEl.call(this,"div"));var F=ui(o);if(w){for(u=this.el_=o,o=this.tag=_.default.createElement("video");u.children.length;)o.appendChild(u.firstChild);Qi(u,"video-js")||_i(u,"video-js"),u.appendChild(o),y=this.playerElIngest_=u,Object.keys(u).forEach(function(we){try{o[we]=u[we]}catch{}})}if(o.setAttribute("tabindex","-1"),F.tabindex="-1",(Ft||yt&&Pt)&&(o.setAttribute("role","application"),F.role="application"),o.removeAttribute("width"),o.removeAttribute("height"),"width"in F&&delete F.width,"height"in F&&delete F.height,Object.getOwnPropertyNames(F).forEach(function(we){w&&we==="class"||u.setAttribute(we,F[we]),w&&o.setAttribute(we,F[we])}),o.playerId=o.id,o.id+="_html5_api",o.className="vjs-tech",o.player=u.player=this,this.addClass("vjs-paused"),m.default.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=vr("vjs-styles-dimensions");var $=Di(".vjs-styles-defaults"),K=Di("head");K.insertBefore(this.styleEl_,$?$.nextSibling:K.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var W=o.getElementsByTagName("a"),V=0;V<W.length;V++){var pe=W.item(V);_i(pe,"vjs-hidden"),pe.setAttribute("hidden","hidden")}return o.initNetworkState_=o.networkState,o.parentNode&&!y&&o.parentNode.insertBefore(u,o),hn(o,u),this.children_.unshift(o),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=u,u},g.crossOrigin=function(o){if(!o)return this.techGet_("crossOrigin");if(o!=="anonymous"&&o!=="use-credentials"){Y.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+o+'"');return}this.techCall_("setCrossOrigin",o)},g.width=function(o){return this.dimension("width",o)},g.height=function(o){return this.dimension("height",o)},g.dimension=function(o,u){var y=o+"_";if(u===void 0)return this[y]||0;if(u===""||u==="auto"){this[y]=void 0,this.updateStyleEl_();return}var w=parseFloat(u);if(isNaN(w)){Y.error('Improper value "'+u+'" supplied for for '+o);return}this[y]=w,this.updateStyleEl_()},g.fluid=function(o){var u=this;if(o===void 0)return!!this.fluid_;this.fluid_=!!o,Ne(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),o?(this.addClass("vjs-fluid"),this.fill(!1),ut(this,function(){u.on(["playerreset","resize"],u.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()},g.fill=function(o){if(o===void 0)return!!this.fill_;this.fill_=!!o,o?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},g.aspectRatio=function(o){if(o===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(o))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=o,this.fluid(!0),this.updateStyleEl_()},g.updateStyleEl_=function(){if(m.default.VIDEOJS_NO_DYNAMIC_STYLE===!0){var o=typeof this.width_=="number"?this.width_:this.options_.width,u=typeof this.height_=="number"?this.height_:this.options_.height,y=this.tech_&&this.tech_.el();y&&(o>=0&&(y.width=o),u>=0&&(y.height=u));return}var w,F,$,K;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?$=this.aspectRatio_:this.videoWidth()>0?$=this.videoWidth()+":"+this.videoHeight():$="16:9";var W=$.split(":"),V=W[1]/W[0];this.width_!==void 0?w=this.width_:this.height_!==void 0?w=this.height_/V:w=this.videoWidth()||300,this.height_!==void 0?F=this.height_:F=w*V,/^[^a-zA-Z]/.test(this.id())?K="dimensions-"+this.id():K=this.id()+"-dimensions",this.addClass(K),ys(this.styleEl_,`
      .`+K+` {
        width: `+w+`px;
        height: `+F+`px;
      }

      .`+K+`.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: `+V*100+`%;
      }
    `)},g.loadTech_=function(o,u){var y=this;this.tech_&&this.unloadTech_();var w=Tt(o),F=o.charAt(0).toLowerCase()+o.slice(1);w!=="Html5"&&this.tag&&(ot.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=w,this.isReady_=!1;var $=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&($=!1);var K={source:u,autoplay:$,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+F+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};qt.names.forEach(function(V){var pe=qt[V];K[pe.getterName]=y[pe.privateName]}),Pe(K,this.options_[w]),Pe(K,this.options_[F]),Pe(K,this.options_[o.toLowerCase()]),this.tag&&(K.tag=this.tag),u&&u.src===this.cache_.src&&this.cache_.currentTime>0&&(K.startTime=this.cache_.currentTime);var W=ot.getTech(o);if(!W)throw new Error("No Tech named '"+w+"' exists! '"+w+"' should be registered using videojs.registerTech()'");this.tech_=new W(K),this.tech_.ready(at(this,this.handleTechReady_),!0),Qf.jsonToTextTracks(this.textTracksJson_||[],this.tech_),qp.forEach(function(V){y.on(y.tech_,V,function(pe){return y["handleTech"+Tt(V)+"_"](pe)})}),Object.keys(wu).forEach(function(V){y.on(y.tech_,V,function(pe){if(y.tech_.playbackRate()===0&&y.tech_.seeking()){y.queuedCallbacks_.push({callback:y["handleTech"+wu[V]+"_"].bind(y),event:pe});return}y["handleTech"+wu[V]+"_"](pe)})}),this.on(this.tech_,"loadstart",function(V){return y.handleTechLoadStart_(V)}),this.on(this.tech_,"sourceset",function(V){return y.handleTechSourceset_(V)}),this.on(this.tech_,"waiting",function(V){return y.handleTechWaiting_(V)}),this.on(this.tech_,"ended",function(V){return y.handleTechEnded_(V)}),this.on(this.tech_,"seeking",function(V){return y.handleTechSeeking_(V)}),this.on(this.tech_,"play",function(V){return y.handleTechPlay_(V)}),this.on(this.tech_,"firstplay",function(V){return y.handleTechFirstPlay_(V)}),this.on(this.tech_,"pause",function(V){return y.handleTechPause_(V)}),this.on(this.tech_,"durationchange",function(V){return y.handleTechDurationChange_(V)}),this.on(this.tech_,"fullscreenchange",function(V,pe){return y.handleTechFullscreenChange_(V,pe)}),this.on(this.tech_,"fullscreenerror",function(V,pe){return y.handleTechFullscreenError_(V,pe)}),this.on(this.tech_,"enterpictureinpicture",function(V){return y.handleTechEnterPictureInPicture_(V)}),this.on(this.tech_,"leavepictureinpicture",function(V){return y.handleTechLeavePictureInPicture_(V)}),this.on(this.tech_,"error",function(V){return y.handleTechError_(V)}),this.on(this.tech_,"posterchange",function(V){return y.handleTechPosterChange_(V)}),this.on(this.tech_,"textdata",function(V){return y.handleTechTextData_(V)}),this.on(this.tech_,"ratechange",function(V){return y.handleTechRateChange_(V)}),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(w!=="Html5"||!this.tag)&&hn(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},g.unloadTech_=function(){var o=this;qt.names.forEach(function(u){var y=qt[u];o[y.privateName]=o[y.getterName]()}),this.textTracksJson_=Qf.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},g.tech=function(o){return o===void 0&&Y.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_},g.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},g.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},g.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},g.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())},g.manualAutoplay_=function(o){var u=this;if(!(!this.tech_||typeof o!="string")){var y=function(){var $=u.muted();u.muted(!0);var K=function(){u.muted($)};u.playTerminatedQueue_.push(K);var W=u.play();if(_n(W))return W.catch(function(V){throw K(),new Error("Rejection at manualAutoplay. Restoring muted value. "+(V||""))})},w;if(o==="any"&&!this.muted()?(w=this.play(),_n(w)&&(w=w.catch(y))):o==="muted"&&!this.muted()?w=y():w=this.play(),!!_n(w))return w.then(function(){u.trigger({type:"autoplay-success",autoplay:o})}).catch(function(){u.trigger({type:"autoplay-failure",autoplay:o})})}},g.updateSourceCaches_=function(o){o===void 0&&(o="");var u=o,y="";typeof u!="string"&&(u=o.src,y=o.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],u&&!y&&(y=w_(this,u)),this.cache_.source=dt({},o,{src:u,type:y});for(var w=this.cache_.sources.filter(function(pe){return pe.src&&pe.src===u}),F=[],$=this.$$("source"),K=[],W=0;W<$.length;W++){var V=ui($[W]);F.push(V),V.src&&V.src===u&&K.push(V.src)}K.length&&!w.length?this.cache_.sources=F:w.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=u},g.handleTechSourceset_=function(o){var u=this;if(!this.changingSrc_){var y=function(K){return u.updateSourceCaches_(K)},w=this.currentSource().src,F=o.src;w&&!/^blob:/.test(w)&&/^blob:/.test(F)&&(!this.lastSource_||this.lastSource_.tech!==F&&this.lastSource_.player!==w)&&(y=function(){}),y(F),o.src||this.tech_.any(["sourceset","loadstart"],function($){if($.type!=="sourceset"){var K=u.techGet("currentSrc");u.lastSource_.tech=K,u.updateSourceCaches_(K)}})}this.lastSource_={player:this.currentSource().src,tech:o.src},this.trigger({src:o.src,type:"sourceset"})},g.hasStarted=function(o){if(o===void 0)return this.hasStarted_;o!==this.hasStarted_&&(this.hasStarted_=o,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},g.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},g.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(function(o){return o.callback(o.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},g.handleTechWaiting_=function(){var o=this;this.addClass("vjs-waiting"),this.trigger("waiting");var u=this.currentTime(),y=function w(){u!==o.currentTime()&&(o.removeClass("vjs-waiting"),o.off("timeupdate",w))};this.on("timeupdate",y)},g.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},g.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},g.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},g.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},g.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},g.handleTechFirstPlay_=function(){this.options_.starttime&&(Y.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},g.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},g.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},g.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},g.handleTechClick_=function(o){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,o):this.paused()?xi(this.play()):this.pause())},g.handleTechDoubleClick_=function(o){if(this.controls_){var u=Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(y){return y.contains(o.target)});u||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,o):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}},g.handleTechTap_=function(){this.userActive(!this.userActive())},g.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},g.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},g.handleTechTouchEnd_=function(o){o.cancelable&&o.preventDefault()},g.handleStageClick_=function(){this.reportUserActivity()},g.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},g.documentFullscreenChange_=function(o){var u=o.target.player;if(!(u&&u!==this)){var y=this.el(),w=_.default[this.fsApi_.fullscreenElement]===y;!w&&y.matches?w=y.matches(":"+this.fsApi_.fullscreen):!w&&y.msMatchesSelector&&(w=y.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(w)}},g.handleTechFullscreenChange_=function(o,u){var y=this;u&&(u.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",function(){y.removeClass("vjs-ios-native-fs")})),this.isFullscreen(u.isFullscreen))},g.handleTechFullscreenError_=function(o,u){this.trigger("fullscreenerror",u)},g.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},g.handleTechEnterPictureInPicture_=function(o){this.isInPictureInPicture(!0)},g.handleTechLeavePictureInPicture_=function(o){this.isInPictureInPicture(!1)},g.handleTechError_=function(){var o=this.tech_.error();this.error(o)},g.handleTechTextData_=function(){var o=null;arguments.length>1&&(o=arguments[1]),this.trigger("textdata",o)},g.getCache=function(){return this.cache_},g.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},g.techCall_=function(o,u){this.ready(function(){if(o in __)return y_(this.middleware_,this.tech_,o,u);if(o in up)return lp(this.middleware_,this.tech_,o,u);try{this.tech_&&this.tech_[o](u)}catch(y){throw Y(y),y}},!0)},g.techGet_=function(o){if(!(!this.tech_||!this.tech_.isReady_)){if(o in T_)return v_(this.middleware_,this.tech_,o);if(o in up)return lp(this.middleware_,this.tech_,o);try{return this.tech_[o]()}catch(u){throw this.tech_[o]===void 0?(Y("Video.js: "+o+" method not defined for "+this.techName_+" playback technology.",u),u):u.name==="TypeError"?(Y("Video.js: "+o+" unavailable on "+this.techName_+" playback technology element.",u),this.tech_.isReady_=!1,u):(Y(u),u)}}},g.play=function(){var o=this,u=this.options_.Promise||m.default.Promise;return u?new u(function(y){o.play_(y)}):this.play_()},g.play_=function(o){var u=this;o===void 0&&(o=xi),this.playCallbacks_.push(o);var y=!!(!this.changingSrc_&&(this.src()||this.currentSrc())),w=!!(b||M);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!y){this.waitToPlay_=function(K){u.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!y&&w&&this.load();return}var F=this.techGet_("play"),$=w&&this.hasClass("vjs-ended");$&&this.resetProgressBar_(),F===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(F)},g.runPlayTerminatedQueue_=function(){var o=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],o.forEach(function(u){u()})},g.runPlayCallbacks_=function(o){var u=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],u.forEach(function(y){y(o)})},g.pause=function(){this.techCall_("pause")},g.paused=function(){return this.techGet_("paused")!==!1},g.played=function(){return this.techGet_("played")||qs(0,0)},g.scrubbing=function(o){if(typeof o>"u")return this.scrubbing_;this.scrubbing_=!!o,this.techCall_("setScrubbing",this.scrubbing_),o?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},g.currentTime=function(o){if(typeof o<"u"){if(o<0&&(o=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=o,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",o),this.cache_.initTime=0;return}return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime},g.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},g.duration=function(o){if(o===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;o=parseFloat(o),o<0&&(o=1/0),o!==this.cache_.duration&&(this.cache_.duration=o,o===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(o)||this.trigger("durationchange"))},g.remainingTime=function(){return this.duration()-this.currentTime()},g.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},g.buffered=function(){var o=this.techGet_("buffered");return(!o||!o.length)&&(o=qs(0,0)),o},g.bufferedPercent=function(){return Xf(this.buffered(),this.duration())},g.bufferedEnd=function(){var o=this.buffered(),u=this.duration(),y=o.end(o.length-1);return y>u&&(y=u),y},g.volume=function(o){var u;if(o!==void 0){u=Math.max(0,Math.min(1,parseFloat(o))),this.cache_.volume=u,this.techCall_("setVolume",u),u>0&&this.lastVolume_(u);return}return u=parseFloat(this.techGet_("volume")),isNaN(u)?1:u},g.muted=function(o){if(o!==void 0){this.techCall_("setMuted",o);return}return this.techGet_("muted")||!1},g.defaultMuted=function(o){return o!==void 0?this.techCall_("setDefaultMuted",o):this.techGet_("defaultMuted")||!1},g.lastVolume_=function(o){if(o!==void 0&&o!==0){this.cache_.lastVolume=o;return}return this.cache_.lastVolume},g.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},g.isFullscreen=function(o){if(o!==void 0){var u=this.isFullscreen_;this.isFullscreen_=!!o,this.isFullscreen_!==u&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_},g.requestFullscreen=function(o){var u=this.options_.Promise||m.default.Promise;if(u){var y=this;return new u(function(w,F){function $(){y.off("fullscreenerror",W),y.off("fullscreenchange",K)}function K(){$(),w()}function W(pe,we){$(),F(we)}y.one("fullscreenchange",K),y.one("fullscreenerror",W);var V=y.requestFullscreenHelper_(o);V&&(V.then($,$),V.then(w,F))})}return this.requestFullscreenHelper_()},g.requestFullscreenHelper_=function(o){var u=this,y;if(this.fsApi_.prefixed||(y=this.options_.fullscreen&&this.options_.fullscreen.options||{},o!==void 0&&(y=o)),this.fsApi_.requestFullscreen){var w=this.el_[this.fsApi_.requestFullscreen](y);return w&&w.then(function(){return u.isFullscreen(!0)},function(){return u.isFullscreen(!1)}),w}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},g.exitFullscreen=function(){var o=this.options_.Promise||m.default.Promise;if(o){var u=this;return new o(function(y,w){function F(){u.off("fullscreenerror",K),u.off("fullscreenchange",$)}function $(){F(),y()}function K(V,pe){F(),w(pe)}u.one("fullscreenchange",$),u.one("fullscreenerror",K);var W=u.exitFullscreenHelper_();W&&(W.then(F,F),W.then(y,w))})}return this.exitFullscreenHelper_()},g.exitFullscreenHelper_=function(){var o=this;if(this.fsApi_.requestFullscreen){var u=_.default[this.fsApi_.exitFullscreen]();return u&&xi(u.then(function(){return o.isFullscreen(!1)})),u}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},g.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=_.default.documentElement.style.overflow,Gt(_.default,"keydown",this.boundFullWindowOnEscKey_),_.default.documentElement.style.overflow="hidden",_i(_.default.body,"vjs-full-window"),this.trigger("enterFullWindow")},g.fullWindowOnEscKey=function(o){S.default.isEventKey(o,"Esc")&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},g.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,xt(_.default,"keydown",this.boundFullWindowOnEscKey_),_.default.documentElement.style.overflow=this.docOrigOverflow,js(_.default.body,"vjs-full-window"),this.trigger("exitFullWindow")},g.disablePictureInPicture=function(o){if(o===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",o),this.options_.disablePictureInPicture=o,this.trigger("disablepictureinpicturechanged")},g.isInPictureInPicture=function(o){if(o!==void 0){this.isInPictureInPicture_=!!o,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_},g.requestPictureInPicture=function(){if("pictureInPictureEnabled"in _.default&&this.disablePictureInPicture()===!1)return this.techGet_("requestPictureInPicture")},g.exitPictureInPicture=function(){if("pictureInPictureEnabled"in _.default)return _.default.exitPictureInPicture()},g.handleKeyDown=function(o){var u=this.options_.userActions;if(!(!u||!u.hotkeys)){var y=function(F){var $=F.tagName.toLowerCase();if(F.isContentEditable)return!0;var K=["button","checkbox","hidden","radio","reset","submit"];if($==="input")return K.indexOf(F.type)===-1;var W=["textarea"];return W.indexOf($)!==-1};y(this.el_.ownerDocument.activeElement)||(typeof u.hotkeys=="function"?u.hotkeys.call(this,o):this.handleHotkeys(o))}},g.handleHotkeys=function(o){var u=this.options_.userActions?this.options_.userActions.hotkeys:{},y=u.fullscreenKey,w=y===void 0?function(We){return S.default.isEventKey(We,"f")}:y,F=u.muteKey,$=F===void 0?function(We){return S.default.isEventKey(We,"m")}:F,K=u.playPauseKey,W=K===void 0?function(We){return S.default.isEventKey(We,"k")||S.default.isEventKey(We,"Space")}:K;if(w.call(this,o)){o.preventDefault(),o.stopPropagation();var V=ge.getComponent("FullscreenToggle");_.default[this.fsApi_.fullscreenEnabled]!==!1&&V.prototype.handleClick.call(this,o)}else if($.call(this,o)){o.preventDefault(),o.stopPropagation();var pe=ge.getComponent("MuteToggle");pe.prototype.handleClick.call(this,o)}else if(W.call(this,o)){o.preventDefault(),o.stopPropagation();var we=ge.getComponent("PlayToggle");we.prototype.handleClick.call(this,o)}},g.canPlayType=function(o){for(var u,y=0,w=this.options_.techOrder;y<w.length;y++){var F=w[y],$=ot.getTech(F);if($||($=ge.getComponent(F)),!$){Y.error('The "'+F+'" tech is undefined. Skipped browser support check for that tech.');continue}if($.isSupported()&&(u=$.canPlayType(o),u))return u}return""},g.selectSource=function(o){var u=this,y=this.options_.techOrder.map(function(W){return[W,ot.getTech(W)]}).filter(function(W){var V=W[0],pe=W[1];return pe?pe.isSupported():(Y.error('The "'+V+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),w=function(V,pe,we){var We;return V.some(function(Xs){return pe.some(function(Mi){if(We=we(Xs,Mi),We)return!0})}),We},F,$=function(V){return function(pe,we){return V(we,pe)}},K=function(V,pe){var we=V[0],We=V[1];if(We.canPlaySource(pe,u.options_[we.toLowerCase()]))return{source:pe,tech:we}};return this.options_.sourceOrder?F=w(o,y,$(K)):F=w(y,o,K),F||!1},g.handleSrc_=function(o,u){var y=this;if(typeof o>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var w=A_(o);if(!w.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,u||(this.cache_.sources=w),this.updateSourceCaches_(w[0]),g_(this,w[0],function(K,W){y.middleware_=W,u||(y.cache_.sources=w),y.updateSourceCaches_(K);var V=y.src_(K);if(V){if(w.length>1)return y.handleSrc_(w.slice(1));y.changingSrc_=!1,y.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),y.triggerReady();return}m_(W,y.tech_)}),this.options_.retryOnError&&w.length>1){var F=function(){y.error(null),y.handleSrc_(w.slice(1),!0)},$=function(){y.off("error",F)};this.one("error",F),this.one("playing",$),this.resetRetryOnError_=function(){y.off("error",F),y.off("playing",$)}}},g.src=function(o){return this.handleSrc_(o,!1)},g.src_=function(o){var u=this,y=this.selectSource([o]);return y?XT(y.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",o):this.techCall_("src",o.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(y.tech,y.source),this.tech_.ready(function(){u.changingSrc_=!1}),!1):!0},g.load=function(){this.techCall_("load")},g.reset=function(){var o=this,u=this.options_.Promise||m.default.Promise;if(this.paused()||!u)this.doReset_();else{var y=this.play();xi(y.then(function(){return o.doReset_()}))}},g.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),Ne(this)&&this.trigger("playerreset")},g.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},g.resetProgressBar_=function(){this.currentTime(0);var o=this.controlBar||{},u=o.durationDisplay,y=o.remainingTimeDisplay;u&&u.updateContent(),y&&y.updateContent()},g.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},g.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},g.currentSources=function(){var o=this.currentSource(),u=[];return Object.keys(o).length!==0&&u.push(o),this.cache_.sources||u},g.currentSource=function(){return this.cache_.source||{}},g.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},g.currentType=function(){return this.currentSource()&&this.currentSource().type||""},g.preload=function(o){if(o!==void 0){this.techCall_("setPreload",o),this.options_.preload=o;return}return this.techGet_("preload")},g.autoplay=function(o){if(o===void 0)return this.options_.autoplay||!1;var u;typeof o=="string"&&/(any|play|muted)/.test(o)||o===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=o,this.manualAutoplay_(typeof o=="string"?o:"play"),u=!1):o?this.options_.autoplay=!0:this.options_.autoplay=!1,u=typeof u>"u"?this.options_.autoplay:u,this.tech_&&this.techCall_("setAutoplay",u)},g.playsinline=function(o){return o!==void 0?(this.techCall_("setPlaysinline",o),this.options_.playsinline=o,this):this.techGet_("playsinline")},g.loop=function(o){if(o!==void 0){this.techCall_("setLoop",o),this.options_.loop=o;return}return this.techGet_("loop")},g.poster=function(o){if(o===void 0)return this.poster_;o||(o=""),o!==this.poster_&&(this.poster_=o,this.techCall_("setPoster",o),this.isPosterFromTech_=!1,this.trigger("posterchange"))},g.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var o=this.tech_.poster()||"";o!==this.poster_&&(this.poster_=o,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},g.controls=function(o){if(o===void 0)return!!this.controls_;o=!!o,this.controls_!==o&&(this.controls_=o,this.usingNativeControls()&&this.techCall_("setControls",o),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},g.usingNativeControls=function(o){if(o===void 0)return!!this.usingNativeControls_;o=!!o,this.usingNativeControls_!==o&&(this.usingNativeControls_=o,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},g.error=function(o){var u=this;if(o===void 0)return this.error_||null;if(O("beforeerror").forEach(function(w){var F=w(u,o);if(!(Be(F)&&!Array.isArray(F)||typeof F=="string"||typeof F=="number"||F===null)){u.log.error("please return a value that MediaError expects in beforeerror hooks");return}o=F}),this.options_.suppressNotSupportedError&&o&&o.code===4){var y=function(){this.error(o)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],y),this.one("loadstart",function(){this.off(["click","touchstart"],y)});return}if(o===null){this.error_=o,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new Kt(o),this.addClass("vjs-error"),Y.error("(CODE:"+this.error_.code+" "+Kt.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),O("error").forEach(function(w){return w(u,u.error_)})},g.reportUserActivity=function(o){this.userActivity_=!0},g.userActive=function(o){if(o===void 0)return this.userActive_;if(o=!!o,o!==this.userActive_){if(this.userActive_=o,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(u){u.stopPropagation(),u.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},g.listenForUserActivity_=function(){var o,u,y,w=at(this,this.reportUserActivity),F=function(we){(we.screenX!==u||we.screenY!==y)&&(u=we.screenX,y=we.screenY,w())},$=function(){w(),this.clearInterval(o),o=this.setInterval(w,250)},K=function(we){w(),this.clearInterval(o)};this.on("mousedown",$),this.on("mousemove",F),this.on("mouseup",K),this.on("mouseleave",K);var W=this.getChild("controlBar");W&&!M&&!Ke&&(W.on("mouseenter",function(pe){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),W.on("mouseleave",function(pe){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",w),this.on("keyup",w);var V;this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(V);var pe=this.options_.inactivityTimeout;pe<=0||(V=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},pe))}},250)},g.playbackRate=function(o){if(o!==void 0){this.techCall_("setPlaybackRate",o);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1},g.defaultPlaybackRate=function(o){return o!==void 0?this.techCall_("setDefaultPlaybackRate",o):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},g.isAudio=function(o){if(o!==void 0){this.isAudio_=!!o;return}return!!this.isAudio_},g.enableAudioOnlyUI_=function(){var o=this;this.addClass("vjs-audio-only-mode");var u=this.children(),y=this.getChild("ControlBar"),w=y&&y.currentHeight();u.forEach(function(F){F!==y&&F.el_&&!F.hasClass("vjs-hidden")&&(F.hide(),o.audioOnlyCache_.hiddenChildren.push(F))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(w),this.trigger("audioonlymodechange")},g.disableAudioOnlyUI_=function(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(function(o){return o.show()}),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")},g.audioOnlyMode=function(o){var u=this;if(typeof o!="boolean"||o===this.audioOnlyMode_)return this.audioOnlyMode_;this.audioOnlyMode_=o;var y=this.options_.Promise||m.default.Promise;if(y){if(o){var w=[];return this.isInPictureInPicture()&&w.push(this.exitPictureInPicture()),this.isFullscreen()&&w.push(this.exitFullscreen()),this.audioPosterMode()&&w.push(this.audioPosterMode(!1)),y.all(w).then(function(){return u.enableAudioOnlyUI_()})}return y.resolve().then(function(){return u.disableAudioOnlyUI_()})}o?(this.isInPictureInPicture()&&this.exitPictureInPicture(),this.isFullscreen()&&this.exitFullscreen(),this.enableAudioOnlyUI_()):this.disableAudioOnlyUI_()},g.enablePosterModeUI_=function(){var o=this.tech_&&this.tech_;o.hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},g.disablePosterModeUI_=function(){var o=this.tech_&&this.tech_;o.show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},g.audioPosterMode=function(o){var u=this;if(typeof o!="boolean"||o===this.audioPosterMode_)return this.audioPosterMode_;this.audioPosterMode_=o;var y=this.options_.Promise||m.default.Promise;if(y){if(o){if(this.audioOnlyMode()){var w=this.audioOnlyMode(!1);return w.then(function(){u.enablePosterModeUI_()})}return y.resolve().then(function(){u.enablePosterModeUI_()})}return y.resolve().then(function(){u.disablePosterModeUI_()})}if(o){this.audioOnlyMode()&&this.audioOnlyMode(!1),this.enablePosterModeUI_();return}this.disablePosterModeUI_()},g.addTextTrack=function(o,u,y){if(this.tech_)return this.tech_.addTextTrack(o,u,y)},g.addRemoteTextTrack=function(o,u){if(this.tech_)return this.tech_.addRemoteTextTrack(o,u)},g.removeRemoteTextTrack=function(o){o===void 0&&(o={});var u=o,y=u.track;if(y||(y=o),this.tech_)return this.tech_.removeRemoteTextTrack(y)},g.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},g.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},g.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},g.language=function(o){if(o===void 0)return this.language_;this.language_!==String(o).toLowerCase()&&(this.language_=String(o).toLowerCase(),Ne(this)&&this.trigger("languagechange"))},g.languages=function(){return dt(T.prototype.options_.languages,this.languages_)},g.toJSON=function(){var o=dt(this.options_),u=o.tracks;o.tracks=[];for(var y=0;y<u.length;y++){var w=u[y];w=dt(w),w.player=void 0,o.tracks[y]=w}return o},g.createModal=function(o,u){var y=this;u=u||{},u.content=o||"";var w=new br(this,u);return this.addChild(w),w.on("dispose",function(){y.removeChild(w)}),w.open(),w},g.updateCurrentBreakpoint_=function(){if(this.responsive())for(var o=this.currentBreakpoint(),u=this.currentWidth(),y=0;y<Au.length;y++){var w=Au[y],F=this.breakpoints_[w];if(u<=F){if(o===w)return;o&&this.removeClass($a[o]),this.addClass($a[w]),this.breakpoint_=w;break}}},g.removeCurrentBreakpoint_=function(){var o=this.currentBreakpointClass();this.breakpoint_="",o&&this.removeClass(o)},g.breakpoints=function(o){return o===void 0?Pe(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Pe({},iE,o),this.updateCurrentBreakpoint_(),Pe(this.breakpoints_))},g.responsive=function(o){if(o===void 0)return this.responsive_;o=!!o;var u=this.responsive_;if(o!==u)return this.responsive_=o,o?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),o},g.currentBreakpoint=function(){return this.breakpoint_},g.currentBreakpointClass=function(){return $a[this.breakpoint_]||""},g.loadMedia=function(o,u){var y=this;if(!(!o||typeof o!="object")){this.reset(),this.cache_.media=dt(o);var w=this.cache_.media,F=w.artwork,$=w.poster,K=w.src,W=w.textTracks;!F&&$&&(this.cache_.media.artwork=[{src:$,type:xa($)}]),K&&this.src(K),$&&this.poster($),Array.isArray(W)&&W.forEach(function(V){return y.addRemoteTextTrack(V,!1)}),this.ready(u)}},g.getMedia=function(){if(!this.cache_.media){var o=this.poster(),u=this.currentSources(),y=Array.prototype.map.call(this.remoteTextTracks(),function(F){return{kind:F.kind,label:F.label,language:F.language,src:F.src}}),w={src:u,textTracks:y};return o&&(w.poster=o,w.artwork=[{src:w.poster,type:xa(w.poster)}]),w}return dt(this.cache_.media)},T.getTagSettings=function(o){var u={sources:[],tracks:[]},y=ui(o),w=y["data-setup"];if(Qi(o,"vjs-fill")&&(y.fill=!0),Qi(o,"vjs-fluid")&&(y.fluid=!0),w!==null){var F=R.default(w||"{}"),$=F[0],K=F[1];$&&Y.error($),Pe(y,K)}if(Pe(u,y),o.hasChildNodes())for(var W=o.childNodes,V=0,pe=W.length;V<pe;V++){var we=W[V],We=we.nodeName.toLowerCase();We==="source"?u.sources.push(ui(we)):We==="track"&&u.tracks.push(ui(we))}return u},g.flexNotSupported_=function(){var o=_.default.createElement("i");return!("flexBasis"in o.style||"webkitFlexBasis"in o.style||"mozFlexBasis"in o.style||"msFlexBasis"in o.style||"msFlexOrder"in o.style)},g.debug=function(o){if(o===void 0)return this.debugEnabled_;o?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},g.playbackRates=function(o){if(o===void 0)return this.cache_.playbackRates;Array.isArray(o)&&o.every(function(u){return typeof u=="number"})&&(this.cache_.playbackRates=o,this.trigger("playbackrateschange"))},T}(ge);qt.names.forEach(function(v){var T=qt[v];At.prototype[T.getterName]=function(){return this.tech_?this.tech_[T.getterName]():(this[T.privateName]=this[T.privateName]||new T.ListClass,this[T.privateName])}}),At.prototype.crossorigin=At.prototype.crossOrigin,At.players={};var Cn=m.default.navigator;At.prototype.options_={techOrder:ot.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:Cn&&(Cn.languages&&Cn.languages[0]||Cn.userLanguage||Cn.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(v){At.prototype[v]=function(){return this.techGet_(v)}}),qp.forEach(function(v){At.prototype["handleTech"+Tt(v)+"_"]=function(){return this.trigger(v)}}),ge.registerComponent("Player",At);var Ha="plugin",kr="activePlugins_",Rr={},ja=function(T){return Rr.hasOwnProperty(T)},Va=function(T){return ja(T)?Rr[T]:void 0},Wp=function(T,g){T[kr]=T[kr]||{},T[kr][g]=!0},Ga=function(T,g,d){var o=(d?"before":"")+"pluginsetup";T.trigger(o,g),T.trigger(o+":"+g.name,g)},sE=function(T,g){var d=function(){Ga(this,{name:T,plugin:g,instance:null},!0);var u=g.apply(this,arguments);return Wp(this,T),Ga(this,{name:T,plugin:g,instance:u}),u};return Object.keys(g).forEach(function(o){d[o]=g[o]}),d},zp=function(T,g){return g.prototype.name=T,function(){Ga(this,{name:T,plugin:g,instance:null},!0);for(var d=arguments.length,o=new Array(d),u=0;u<d;u++)o[u]=arguments[u];var y=x.default(g,[this].concat(o));return this[T]=function(){return y},Ga(this,y.getEventHash()),y}},Oi=function(){function v(g){if(this.constructor===v)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=g,this.log||(this.log=this.player.log.createLogger(this.name)),Tn(this),delete this.trigger,zf(this,this.constructor.defaultState),Wp(g,this.name),this.dispose=this.dispose.bind(this),g.on("dispose",this.dispose)}var T=v.prototype;return T.version=function(){return this.constructor.VERSION},T.getEventHash=function(d){return d===void 0&&(d={}),d.name=this.name,d.plugin=this.constructor,d.instance=this,d},T.trigger=function(d,o){return o===void 0&&(o={}),Ts(this.eventBusEl_,d,this.getEventHash(o))},T.handleStateChanged=function(d){},T.dispose=function(){var d=this.name,o=this.player;this.trigger("dispose"),this.off(),o.off("dispose",this.dispose),o[kr][d]=!1,this.player=this.state=null,o[d]=zp(d,Rr[d])},v.isBasic=function(d){var o=typeof d=="string"?Va(d):d;return typeof o=="function"&&!v.prototype.isPrototypeOf(o.prototype)},v.registerPlugin=function(d,o){if(typeof d!="string")throw new Error('Illegal plugin name, "'+d+'", must be a string, was '+typeof d+".");if(ja(d))Y.warn('A plugin named "'+d+'" already exists. You may want to avoid re-registering plugins!');else if(At.prototype.hasOwnProperty(d))throw new Error('Illegal plugin name, "'+d+'", cannot share a name with an existing player method!');if(typeof o!="function")throw new Error('Illegal plugin for "'+d+'", must be a function, was '+typeof o+".");return Rr[d]=o,d!==Ha&&(v.isBasic(o)?At.prototype[d]=sE(d,o):At.prototype[d]=zp(d,o)),o},v.deregisterPlugin=function(d){if(d===Ha)throw new Error("Cannot de-register base plugin.");ja(d)&&(delete Rr[d],delete At.prototype[d])},v.getPlugins=function(d){d===void 0&&(d=Object.keys(Rr));var o;return d.forEach(function(u){var y=Va(u);y&&(o=o||{},o[u]=y)}),o},v.getPluginVersion=function(d){var o=Va(d);return o&&o.VERSION||""},v}();Oi.getPlugin=Va,Oi.BASE_PLUGIN_NAME=Ha,Oi.registerPlugin(Ha,Oi),At.prototype.usingPlugin=function(v){return!!this[kr]&&this[kr][v]===!0},At.prototype.hasPlugin=function(v){return!!ja(v)};var Yp=!1,rE=function(T,g){g===void 0&&(g={}),Yp||(Y.warn("videojs.extend is deprecated as of Video.js 7.22.0 and will be removed in Video.js 8.0.0"),Yp=!0);var d=function(){T.apply(this,arguments)},o={};typeof g=="object"?(g.constructor!==Object.prototype.constructor&&(d=g.constructor),o=g):typeof g=="function"&&(d=g),N.default(d,T),T&&(d.super_=T);for(var u in o)o.hasOwnProperty(u)&&(d.prototype[u]=o[u]);return d},Xp=function(T){return T.indexOf("#")===0?T.slice(1):T};function Ie(v,T,g){var d=Ie.getPlayer(v);if(d)return T&&Y.warn('Player "'+v+'" is already initialised. Options will not be applied.'),g&&d.ready(g),d;var o=typeof v=="string"?Di("#"+Xp(v)):v;if(!Me(o))throw new TypeError("The element or ID supplied is not valid. (videojs)");(!o.ownerDocument.defaultView||!o.ownerDocument.body.contains(o))&&Y.warn("The element supplied is not included in the DOM"),T=T||{},T.restoreEl===!0&&(T.restoreEl=(o.parentNode&&o.parentNode.hasAttribute("data-vjs-player")?o.parentNode:o).cloneNode(!0)),O("beforesetup").forEach(function(y){var w=y(o,dt(T));if(!Be(w)||Array.isArray(w)){Y.error("please return an object in beforesetup hooks");return}T=dt(T,w)});var u=ge.getComponent("Player");return d=new u(o,T,g),O("setup").forEach(function(y){return y(d)}),d}if(Ie.hooks_=H,Ie.hooks=O,Ie.hook=P,Ie.hookOnce=Q,Ie.removeHook=G,m.default.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&le()){var Ka=Di(".vjs-styles-defaults");if(!Ka){Ka=vr("vjs-styles-defaults");var Iu=Di("head");Iu&&Iu.insertBefore(Ka,Iu.firstChild),ys(Ka,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}return gn(1,Ie),Ie.VERSION=B,Ie.options=At.prototype.options_,Ie.getPlayers=function(){return At.players},Ie.getPlayer=function(v){var T=At.players,g;if(typeof v=="string"){var d=Xp(v),o=T[d];if(o)return o;g=Di("#"+d)}else g=v;if(Me(g)){var u=g,y=u.player,w=u.playerId;if(y||T[w])return y||T[w]}},Ie.getAllPlayers=function(){return Object.keys(At.players).map(function(v){return At.players[v]}).filter(Boolean)},Ie.players=At.players,Ie.getComponent=ge.getComponent,Ie.registerComponent=function(v,T){ot.isTech(T)&&Y.warn("The "+v+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),ge.registerComponent.call(ge,v,T)},Ie.getTech=ot.getTech,Ie.registerTech=ot.registerTech,Ie.use=p_,Object.defineProperty(Ie,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(Ie.middleware,"TERMINATOR",{value:Da,writeable:!1,enumerable:!0}),Ie.browser=A,Ie.TOUCH_ENABLED=zt,Ie.extend=rE,Ie.mergeOptions=dt,Ie.bind=at,Ie.registerPlugin=Oi.registerPlugin,Ie.deregisterPlugin=Oi.deregisterPlugin,Ie.plugin=function(v,T){return Y.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Oi.registerPlugin(v,T)},Ie.getPlugins=Oi.getPlugins,Ie.getPlugin=Oi.getPlugin,Ie.getPluginVersion=Oi.getPluginVersion,Ie.addLanguage=function(v,T){var g;return v=(""+v).toLowerCase(),Ie.options.languages=dt(Ie.options.languages,(g={},g[v]=T,g)),Ie.options.languages[v]},Ie.log=Y,Ie.createLogger=ee,Ie.createTimeRange=Ie.createTimeRanges=qs,Ie.formatTime=Ar,Ie.setFormatTime=x_,Ie.resetFormatTime=O_,Ie.parseUrl=Ql,Ie.isCrossOrigin=Pa,Ie.EventTarget=U,Ie.on=Gt,Ie.one=_r,Ie.off=xt,Ie.trigger=Ts,Ie.xhr=k.default,Ie.TextTrack=En,Ie.AudioTrack=rp,Ie.VideoTrack=np,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(v){Ie[v]=function(){return Y.warn("videojs."+v+"() is deprecated; use videojs.dom."+v+"() instead"),ba[v].apply(null,arguments)}}),Ie.computedStyle=Je,Ie.dom=ba,Ie.url=h_,Ie.defineLazyProperty=Cu,Ie.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"}),Wu=Ie,Wu}var KE=GE(),X=qv(KE);function qE(r){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=e.length,i=new Uint8Array(r),s="";for(let n of crypto.getRandomValues(i))s+=e[n%t];return s}function WE(){let r=pr("volume");if(r!=null){let e=parseFloat(r);return isNaN(e)?void 0:e}}function zE(){let r=pr("mute");if(r!=null)return r==="true"}function YE(){let r=pr("theater-enabled");return r!=null?r==="true":!1}function XE(r){return $s("volume",r.toString())}function QE(r){return $s("mute",r.toString())}function JE(r){return $s("theater-enabled",r.toString())}function ZE(r){return $s("average-bandwidth",r.toString())}function eb(){let r=pr("average-bandwidth");if(r!=null){let e=parseInt(r,10);return isNaN(e)?void 0:e}}function Sg(r){return $s("last-subtitle",r)}function tb(){return pr("last-subtitle")}function ib(r){return $s("preferred-subtitle",r)}function sb(){return pr("preferred-subtitle")}function rb(r,e){return $s("video-watch-history",JSON.stringify(ht(Ue({},Yv()),{[r]:{duration:e,date:`${new Date().toISOString()}`}})))}function Yv(r){let e;try{let t=pr("video-watch-history");if(!t)return{};e=JSON.parse(t)}catch(t){ze.error("Cannot parse video watch history from local storage/",t)}return e=e||{},r?e[r]:e}function xL(){let r=Yv();if(!r)return;let e=Object.keys(r).reduce((t,i)=>{let s=Date.parse(r[i].date);return Math.ceil((new Date().getTime()-s)/(1e3*3600*24))>30?t:ht(Ue({},t),{[i]:r[i]})},{});$s("video-watch-history",JSON.stringify(e))}function nb(){let r="session-id",e=ab(r);return e||(e=qE(32),ob(r,e),e)}var Fl="peertube-videojs-";function pr(r){return fr.getItem(Fl+r)}function $s(r,e){fr.setItem(Fl+r,e)}function ab(r){return fa.getItem(Fl+r)}function ob(r,e){fa.setItem(Fl+r,e)}function lb(){return`
  <div class="vjs-bezels-pause">
    <div class="vjs-bezel" role="status" aria-label="Pause">
      <div class="vjs-bezel-icon">
        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">
          <use class="vjs-svg-shadow" xlink:href="#vjs-id-1"></use>
          <path class="vjs-svg-fill" d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z" id="vjs-id-1"></path>
        </svg>
      </div>
    </div>
  </div>
  `}function ub(){return`
  <div class="vjs-bezels-play">
    <div class="vjs-bezel" role="status" aria-label="Play">
      <div class="vjs-bezel-icon">
        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">
          <use class="vjs-svg-shadow" xlink:href="#vjs-id-2"></use>
          <path class="vjs-svg-fill" d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z" id="ytp-id-2"></path>
        </svg>
      </div>
    </div>
  </div>
  `}var hb=X.getComponent("Component"),Uo=class extends hb{constructor(e,t){super(e,t),!No()&&(this.firstPlayDone=!1,this.paused=!1,this.playerPauseHandler=()=>{e.seeking()||(this.paused=!0,!e.ended()&&(this.container.innerHTML=lb(),this.showBezel()))},this.playerPlayHandler=()=>{if(e.seeking()||!this.firstPlayDone||!this.paused){this.firstPlayDone=!0;return}this.paused=!1,this.firstPlayDone=!0,this.container.innerHTML=ub(),this.showBezel()},this.videoChangeHandler=()=>{this.firstPlayDone=!1},e.on("video-change",()=>this.videoChangeHandler),e.on("pause",this.playerPauseHandler),e.on("play",this.playerPlayHandler))}dispose(){this.playerPauseHandler&&this.player().off("pause",this.playerPauseHandler),this.playerPlayHandler&&this.player().off("play",this.playerPlayHandler),this.videoChangeHandler&&this.player().off("video-change",this.videoChangeHandler),super.dispose()}createEl(){return this.container=super.createEl("div",{className:"vjs-bezels-content"}),this.container.style.display="none",this.container}showBezel(){this.container.style.display="inherit",setTimeout(()=>{this.container.style.display="none"},500)}};X.registerComponent("PauseBezel",Uo);var cb=X.getPlugin("plugin"),Yh=class extends cb{constructor(e,t){super(e),this.player.ready(()=>{e.addClass("vjs-bezels")});let i=new Uo(e,t);e.addChild(i),this.on("dispose",()=>e.removeChild(i))}};X.registerPlugin("bezels",Yh);var db=X.getComponent("MenuItem"),Xh=class extends db{constructor(e,t){super(e,t)}handleClick(e){super.handleClick(e),this.options_.listener(e),setTimeout(()=>{this.player().contextMenu().menu.dispose()},1)}createEl(e,t,i){let s=super.createEl(e,t,i),n=X.dom.createEl("span");return n.innerHTML=`<span class="vjs-menu-item-text">${this.localize(this.options_.label)}</span>`,s.replaceChild(n,s.querySelector(".vjs-menu-item-text")),s}},fb=X.getComponent("Menu"),Qh=class extends fb{constructor(e,t){super(e,ht(Ue({},t),{menuButton:void 0})),this.dispose=X.bind(this,this.dispose);for(let i of t.content())this.addItem(new Xh(e,{label:i.label,listener:X.bind(e,i.listener)}))}createEl(){let e=super.createEl();return X.dom.addClass(e,"vjs-contextmenu-ui-menu"),e.style.left=this.options_.position.left+"px",e.style.top=this.options_.position.top+"px",e}};function pb(r){let e;if(r.getBoundingClientRect&&r.parentNode&&(e=r.getBoundingClientRect()),!e)return{left:0,top:0};let t=document.documentElement,i=document.body,s=t.clientLeft||i.clientLeft||0,n=window.pageXOffset||i.scrollLeft,a=e.left+n-s,l=t.clientTop||i.clientTop||0,c=window.pageYOffset||i.scrollTop,h=e.top+c-l;return{left:Math.round(a),top:Math.round(h)}}function gb(r,e){let t={},i=pb(r),s=r.offsetWidth,n=r.offsetHeight,a=i.top,l=i.left,c=e.pageY,h=e.pageX;return e.changedTouches&&(h=e.changedTouches[0].pageX,c=e.changedTouches[0].pageY),t.y=Math.max(0,Math.min(1,(a-c+n)/n)),t.x=Math.max(0,Math.min(1,(h-l)/s)),t}var mb=X.getPlugin("plugin"),Jh=class extends mb{constructor(e,t){super(e,t),this.options_=t,this.menu&&(this.menu.dispose(),this.player.off("contextmenu",this.onContextMenuBind)),this.onContextMenuBind=this.onContextMenu.bind(this),this.player.on("contextmenu",this.onContextMenuBind),this.player.ready(()=>this.player.addClass("vjs-contextmenu-ui"))}onContextMenu(e){if(vb(this.player)){this.menu.dispose();return}if(yb(e.target))return;let t=gb(this.player.el(),e),i=this.player.el().getBoundingClientRect(),s=Tb(t,i),n=X.browser.IS_FIREFOX?document.documentElement:document;e.preventDefault();let a=this.menu=new Qh(this.player,{content:this.options_.content,position:s});a.on("dispose",()=>{for(let f of["click","tap"])X.off(n,f,a.dispose);this.player.removeChild(a),this.menu=void 0}),this.player.addChild(a);let l=a.el(),c=l.getBoundingClientRect(),h=document.body.getBoundingClientRect();(c.right>h.width||c.bottom>h.height)&&(l.style.left=Math.floor(Math.min(s.left,this.player.currentWidth()-a.currentWidth()))+"px",l.style.top=Math.floor(Math.min(s.top,this.player.currentHeight()-a.currentHeight()))+"px");for(let f of["click","tap"])X.on(n,f,a.dispose)}};X.registerPlugin("contextMenu",Jh);function vb(r){var e;return r.usingPlugin("contextMenu")?!!((e=r.contextMenu().menu)!=null&&e.el()):!1}function yb(r){let e=r.tagName.toLowerCase();return e==="input"||e==="textarea"}function Tb(r,e){return{left:Math.round(e.width*r.x),top:Math.round(e.height-e.height*r.y)}}var _b=X.getComponent("Button"),Zh=class extends _b{constructor(e,t){super(e,t),e.on("texttrackchange",()=>this.update())}buildCSSClass(){return`vjs-caption-toggle-control vjs-captions-button ${super.buildCSSClass()}`}handleClick(e){var t;super.handleClick(e);let i=this.getShowing()||(t=this.getCaptionToEnable())==null?void 0:t.id;for(let s of this.player_.textTracks().tracks_)i&&s.id===i?s.mode="showing":s.mode="disabled"}update(){var e;if(this.getShowing()){this.controlText("Disable subtitles"),this.addClass("enabled");return}this.controlText(this.player_.localize("Enable {1} subtitle",[(e=this.getCaptionToEnable())==null?void 0:e.label])),this.removeClass("enabled")}getShowing(){return this.listCaptions().find(e=>e.mode==="showing")}getCaptionToEnable(){var e;let t=sb()||((e=this.listCaptions()[0])==null?void 0:e.id),i=this.listCaptions();return i.find(s=>s.id===t)||i[0]}listCaptions(){return this.player_.textTracks().tracks_.filter(e=>e.kind==="captions")}};X.registerComponent("CaptionToggleButton",Zh);var Eb=X.getComponent("ClickableComponent"),$o=class extends Eb{constructor(e,t){super(e,t);let i=()=>{if(!this.hasValidDuration())return;let n=this.el();n.style.setProperty("left",this.buildLeftStyle()),n.style.setProperty("display","inline")};this.player().on("durationchange",i);let s=n=>n.stopPropagation();this.on(["mousedown","touchstart"],s),this.one("dispose",()=>{this.player()&&this.player().off("durationchange",i),this.el()&&this.off(["mousedown","touchstart"],s)})}createEl(){return X.dom.createEl("span",{className:"vjs-chapter-marker",style:this.hasValidDuration()?`left: ${this.buildLeftStyle()}`:"display: none;"})}handleClick(e){e.stopPropagation(),this.player()&&this.player().currentTime(this.options_.timecode)}buildLeftStyle(){return`${this.options_.timecode/this.player().duration()*100}%`}hasValidDuration(){let e=this.player().duration();return!(isNaN(e)||!e)}};X.registerComponent("ProgressBarMarkerComponent",$o);var bb=X.getPlugin("plugin"),ec=class extends bb{constructor(e,t){super(e,t),Qe(this,"activeChapter"),this.markers=[],this.chapters=t.chapters,this.player.ready(()=>{e.addClass("vjs-chapters");for(let i of this.chapters){if(i.timecode===0)continue;let s=new $o(e,{timecode:i.timecode});s.on("mouseenter",()=>this.activeChapter=i),s.on("mouseleave",()=>this.activeChapter=void 0),this.markers.push(s),this.getSeekBar().addChild(s)}})}dispose(){for(let e of this.markers)this.getSeekBar().removeChild(e);super.dispose()}getChapter(e){if(this.activeChapter)return this.player.addClass("has-chapter"),{title:this.activeChapter.title,fixedTimecode:this.activeChapter.timecode};if(this.chapters.length!==0)for(let t=this.chapters.length-1;t>=0;t--){let i=this.chapters[t];if(i.timecode<=e)return this.player.addClass("has-chapter"),{title:i.title}}return this.player.removeClass("has-chapter"),{title:""}}getSeekBar(){return this.player.getDescendant("ControlBar","ProgressControl","SeekBar")}};X.registerPlugin("chapters",ec);var Sb=X.getComponent("Button"),Ho=class extends Sb{constructor(e,t){super(e,t),this.player().on("video-change",()=>{this.updateDisabled(),this.updateShowing()}),this.updateDisabled(),this.updateShowing()}createEl(){let e=this.options_.type,t=X.dom.createEl("button",{className:"vjs-"+e+"-video"}),i=X.dom.createEl("span",{className:"icon icon-"+e});return t.appendChild(i),e==="next"?t.title=this.player_.localize("Next video"):t.title=this.player_.localize("Previous video"),t}handleClick(){this.options_.handler()}updateDisabled(){this.options_.isDisabled()?this.addClass("vjs-disabled"):this.removeClass("vjs-disabled")}updateShowing(){this.options_.isDisplayed()?this.show():this.hide()}};X.registerComponent("NextVideoButton",Ho);X.registerComponent("PreviousVideoButton",Ho);function Xv(r){return r.charAt(0).toUpperCase()+r.slice(1)}var zu=[{max:1024,type:"B",decimals:0},{max:1048576,type:"KB",decimals:0},{max:1073741824,type:"MB",decimals:0},{max:10995116e5,type:"GB",decimals:1}];function si(r){let e=zu.find(i=>r<i.max)||zu[zu.length-1];return[(r/(e.max/1024)).toFixed(e.decimals),e.type]}function Cb(r){return{iceServers:r.map(e=>({urls:e}))}}var wb=X.getComponent("Button"),tc=class extends wb{createEl(){let e=X.dom.createEl("div",{className:"vjs-peertube"}),t=X.dom.createEl("div",{className:"vjs-peertube-hidden"});e.appendChild(t);let i=X.dom.createEl("span",{className:"icon icon-download"},{role:"img",ariaLabel:this.player().localize("Download speed:")});t.appendChild(i);let s=X.dom.createEl("span",{className:"download-speed-text"}),n=X.dom.createEl("span",{className:"download-speed-number"}),a=X.dom.createEl("span");s.appendChild(n),s.appendChild(a),t.appendChild(s);let l=X.dom.createEl("span",{className:"icon icon-upload"},{role:"img",ariaLabel:this.player().localize("Upload speed:")});t.appendChild(l);let c=X.dom.createEl("span",{className:"upload-speed-text"}),h=X.dom.createEl("span",{className:"upload-speed-number"}),f=X.dom.createEl("span");c.appendChild(h),c.appendChild(f),t.appendChild(c);let p=X.dom.createEl("span",{className:"peers-text"}),m=X.dom.createEl("span",{className:"peers-number"});t.appendChild(m),t.appendChild(p);let _=X.dom.createEl("div",{className:"vjs-peertube-hidden"}),E=X.dom.createEl("span",{className:"http-fallback"});return _.appendChild(E),e.appendChild(_),this.player_.on("network-info",(S,C)=>{if(!C.p2p)return;t.className="vjs-peertube-displayed",_.className="vjs-peertube-hidden";let I=C.p2p,R=C.http,k=si(I.downloadSpeed+R.downloadSpeed),D=si(I.uploadSpeed),x=si(I.downloaded+R.downloaded),N=si(I.uploaded),B=I.peersWithWebSeed;if(t.title=this.player().localize("Total downloaded: ")+x.join(" ")+`
`,C.source==="p2p-media-loader"){let H=si(R.downloaded).join(" "),O=si(I.downloaded).join(" ");t.title+=" * "+this.player().localize("From servers: ")+H+`
 * `+this.player().localize("From peers: ")+O+`
`}t.title+=this.player().localize("Total uploaded: ")+N.join(" "),n.textContent=k[0],a.textContent=" "+k[1],h.textContent=D[0],f.textContent=" "+D[1],m.textContent=B.toString(),p.textContent=" "+(B>1?this.player().localize("peers"):this.player_.localize("peer")),_.className="vjs-peertube-hidden",t.className="vjs-peertube-displayed"}),this.player_.on("network-info",(S,C)=>{C.p2p||(C.source==="web-video"?E.textContent="HTTP":C.source==="p2p-media-loader"&&(E.textContent="HLS"),_.className="vjs-peertube-displayed",t.className="vjs-peertube-hidden",_.title=this.player().localize("Total downloaded: ")+si(C.http.downloaded).join(" "))}),this.player_.on("video-change",()=>{t.className="vjs-peertube-hidden",_.className="vjs-peertube-hidden"}),e}};X.registerComponent("P2PInfoButton",tc);var Ab=X.getComponent("Component"),ic=class extends Ab{constructor(e,t){super(e,t),this.updateShowing(),this.player().on("video-change",()=>this.updateShowing())}dispose(){this.el()||(this.el().removeEventListener("mouseenter",this.mouseEnterHandler),this.el().removeEventListener("click",this.clickHandler),super.dispose())}createEl(){let e=X.dom.createEl("a",{href:this.buildLink(),innerText:this.options_.instanceName,title:this.player().localize("Video page (new window)"),className:"vjs-peertube-link",target:"_blank"});return this.mouseEnterHandler=()=>this.updateHref(),this.clickHandler=()=>this.player().pause(),e.addEventListener("mouseenter",this.mouseEnterHandler),e.addEventListener("click",this.clickHandler),e}updateShowing(){this.options_.isDisplayed()?this.show():this.hide()}updateHref(){this.el().setAttribute("href",this.buildLink())}buildLink(){let e=Wh({shortUUID:this.options_.shortUUID()});return Uv({url:e,startTime:this.player().currentTime()})}};X.registerComponent("PeerTubeLinkButton",ic);var Ib=X.getComponent("ClickableComponent"),sc=class extends Ib{constructor(e,t){super(e,t),this.interval=this.setInterval(()=>this.updateClass(),1e3),this.updateSync(!0)}dispose(){this.interval&&(this.clearInterval(this.interval),this.interval=void 0),this.contentEl_=null,super.dispose()}createEl(){let e=super.createEl("div",{className:"vjs-pt-live-control vjs-control"});return this.contentEl_=X.dom.createEl("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(X.dom.createEl("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")}\xA0`})),this.contentEl_.appendChild(document.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}handleClick(){let e=this.getHLSJS();e&&(this.player().currentTime(e.liveSyncPosition),this.player().play(),this.updateSync(!0))}updateClass(){let e=this.getHLSJS();if(!e||this.player().currentTime()===0)return;let t=Math.abs(this.player().currentTime()-e.liveSyncPosition)<10;this.updateSync(t)}updateSync(e){e?(this.addClass("synced-with-live-edge"),this.removeAttribute("title"),this.disable()):(this.removeClass("synced-with-live-edge"),this.setAttribute("title",this.localize("Go back to the live")),this.enable())}getHLSJS(){var e;if((e=this.player())!=null&&e.usingPlugin("p2pMediaLoader"))return this.player().p2pMediaLoader().getHLSJS()}};X.registerComponent("PeerTubeLiveDisplay",sc);var Lb=X.getPlugin("plugin"),rc=class extends Lb{constructor(e,t){super(e,t),this.url=t.url,this.height=t.height,this.width=t.width,this.interval=t.interval,this.sprites={},this.boundedHijackMouseTooltip=this.hijackMouseTooltip.bind(this),this.init(),this.player.ready(()=>{e.addClass("vjs-storyboard")})}init(){var e,t,i,s,n;let a=this.player.controlBar;this.progress=a?.progressControl,this.seekBar=(e=this.progress)==null?void 0:e.seekBar,this.mouseTimeTooltip=(i=(t=this.seekBar)==null?void 0:t.mouseTimeDisplay)==null?void 0:i.timeTooltip,this.spritePlaceholder=X.dom.createEl("div",{className:"vjs-storyboard-sprite-placeholder"}),(n=(s=this.seekBar)==null?void 0:s.el())==null||n.appendChild(this.spritePlaceholder),this.onReadyOrLoadstartHandler=l=>{if(l.type!=="ready"){let c=this.player.currentSources().find(f=>Object.prototype.hasOwnProperty.call(f,"storyboard")),h=c?.storyboard;h&&(this.url=h.url,this.height=h.height,this.width=h.width,this.interval=h.interval)}this.cached=!!this.sprites[this.url],this.load()},this.player.on(["ready","loadstart"],this.onReadyOrLoadstartHandler)}dispose(){var e,t;this.onReadyOrLoadstartHandler&&this.player.off(["ready","loadstart"],this.onReadyOrLoadstartHandler),this.progress&&this.progress.off(["mousemove","touchmove"],this.boundedHijackMouseTooltip),(t=(e=this.seekBar)==null?void 0:e.el())==null||t.removeChild(this.spritePlaceholder),super.dispose()}load(){let e=["mousemove","touchmove"];this.isReady()?(this.cached||(this.sprites[this.url]=X.dom.createEl("img",{src:this.url})),this.progress.on(e,this.boundedHijackMouseTooltip)):(this.progress.off(e,this.boundedHijackMouseTooltip),this.resetMouseTooltip())}hijackMouseTooltip(e){let t=this.sprites[this.url],i=t.naturalWidth,s=t.naturalHeight,n=this.seekBar.el();if(!t.complete||!i||!s){this.resetMouseTooltip();return}this.player.requestNamedAnimationFrame("StoryBoardPlugin#hijackMouseTooltip",()=>{let a=X.dom.getBoundingClientRect(n),l=X.dom.getBoundingClientRect(this.player.el());if(!a||!l)return;let c=X.dom.getPointerPosition(n,e).x,h=c*this.player.duration(),f=Math.round(s/this.height*(i/this.width))-1;h=Math.min(h/this.interval,f);let p=600,m=this.player.currentWidth(),_=m<p?m/p:1,E=i/this.width,S=this.width*_,C=this.height*_,I=Math.floor(h%E)*-S,R=Math.floor(h/E)*-C,k=`${i*_}px ${s*_}px`,D=this.player.el().querySelector(".vjs-time-tooltip"),x=-C+parseInt(getComputedStyle(D).top.replace("px",""))-20,N=Math.round(S/2),B=a.width*c-N,H=l.left-a.left,O=a.width-S+(l.right-a.right);B<H&&(B=H),B>O&&(B=O);let P={"background-image":`url("${this.url}")`,"background-repeat":"no-repeat","background-position":`${I}px ${R}px`,"background-size":k,color:"#fff","text-shadow":"1px 1px #000",position:"relative",top:`${x}px`,border:"1px solid #000",width:`${S+2}px`,height:`${C+2}px`};P.left=`${B}px`;for(let[G,Q]of Object.entries(P))this.spritePlaceholder.style.setProperty(G,Q)})}resetMouseTooltip(){this.spritePlaceholder&&(this.spritePlaceholder.style.cssText="")}isReady(){return this.mouseTimeTooltip&&this.width&&this.height&&this.url}};X.registerPlugin("storyboard",rc);var kb=X.getComponent("Button"),Qv=class Eo extends kb{constructor(e,t){super(e,t),this.theaterButtonOptions=t;let i=YE();i===!0&&(this.player().addClass(Eo.THEATER_MODE_CLASS),this.handleTheaterChange()),this.controlText("Theater mode"),this.player().theaterEnabled=i,this.updateShowing(),this.player().on("video-change",()=>this.updateShowing())}buildCSSClass(){return`vjs-theater-control ${super.buildCSSClass()}`}handleTheaterChange(){let e=this.isTheaterEnabled();e?this.controlText("Normal mode"):this.controlText("Theater mode"),JE(e),this.player_.trigger("theater-change",e)}handleClick(){this.player_.toggleClass(Eo.THEATER_MODE_CLASS),this.handleTheaterChange()}isTheaterEnabled(){return this.player_.hasClass(Eo.THEATER_MODE_CLASS)}updateShowing(){this.theaterButtonOptions.isDisplayed()?this.show():this.hide()}};Qe(Qv,"THEATER_MODE_CLASS","vjs-theater-enabled");var Rb=Qv;X.registerComponent("TheaterButton",Rb);var Pb=X.getComponent("TimeTooltip"),nc=class extends Pb{write(e){var t;let i=this.player();if(i.usingPlugin("chapters")){if(e===this.currentTimecode)return;this.currentTimecode=e;let{title:s,fixedTimecode:n}=i.chapters().getChapter(_o(this.currentTimecode));if(s){let a=n?X.formatTime(n,(t=this.player())==null?void 0:t.duration()):this.currentTimecode;return super.write(s+`\r
`+a)}}return super.write(e)}};X.registerComponent("TimeTooltip",nc);var Db=X.getComponent("Component"),jo=class extends Db{constructor(e,t){super(e,t)}createEl(){let e=super.createEl("div",{className:"peertube-dock"});if(this.options_.avatarUrl){let i=X.dom.createEl("img",{className:"peertube-dock-avatar",src:this.options_.avatarUrl},{alt:""});e.appendChild(i)}let t=super.createEl("div",{className:"peertube-dock-title-description"});if(this.options_.title){let i=X.dom.createEl("h2",{className:"peertube-dock-title",title:this.options_.title,innerText:this.options_.title});t.appendChild(i)}if(this.options_.description){let i=X.dom.createEl("div",{className:"peertube-dock-description",title:this.options_.description,innerText:this.options_.description});t.appendChild(i)}return(this.options_.title||this.options_.description)&&e.appendChild(t),e}};X.registerComponent("PeerTubeDockComponent",jo);var xb=X.getPlugin("plugin"),ac=class extends xb{constructor(e,t){super(e,t),e.ready(()=>{e.addClass("peertube-dock")}),this.dockComponent=new jo(e,t),e.addChild(this.dockComponent)}dispose(){var e;(e=this.dockComponent)==null||e.dispose(),this.player.removeChild(this.dockComponent),this.player.removeClass("peertube-dock"),super.dispose()}};X.registerPlugin("peertubeDock",ac);var Ob=X.getComponent("Component"),Vo=class extends Ob{constructor(e,t){super(e,t)}createEl(){let e=super.createEl("div",{className:"nsfw-container"}),t=super.createEl("div",{className:"nsfw-title"});t.textContent=this.player().localize("Sensitive content");let i=super.createEl("div",{className:"nsfw-content"});if(i.textContent=this.player().localize("This video contains sensitive content."),e.appendChild(t),e.appendChild(i),this.options_.flags||this.options_.summary){let s=super.createEl("button",{textContent:this.player().localize("Learn more")},{type:"button"});e.appendChild(s),s.addEventListener("click",()=>{this.appendMoreContent(),s.style.display="none"})}return e}appendMoreContent(){let e=super.createEl("div",{className:"nsfw-more-content"});if(this.options_.flags){let t=super.createEl("div",{className:"nsfw-more-flags"});t.appendChild(super.createEl("strong",{textContent:this.player().localize("Content warning")})),t.appendChild(super.createEl("div",{textContent:this.buildFlagStrings().join(" - ")})),e.appendChild(t)}if(this.options_.summary){let t=super.createEl("div",{className:"nsfw-more-summary"});t.appendChild(super.createEl("strong",{textContent:"Author note"})),t.appendChild(super.createEl("div",{textContent:this.options_.summary})),e.appendChild(t)}this.el().appendChild(e)}buildFlagStrings(){let e=this.options_.flags,t=[];return(e&Wa.VIOLENT)===Wa.VIOLENT&&t.push(this.player().localize("Violence")),(e&Wa.EXPLICIT_SEX)===Wa.EXPLICIT_SEX&&t.push(this.player().localize("Explicit Sex")),t}};X.registerComponent("PeerTubeNSFWComponent",Vo);var Mb=X.getPlugin("plugin"),oc=class extends Mb{constructor(e,t){super(e,t),e.ready(()=>{e.addClass("peertube-nsfw"),this.nsfwComponent=new Vo(e,t),e.addChild(this.nsfwComponent)}),e.one("play",()=>{this.nsfwComponent.hide()})}dispose(){var e;(e=this.nsfwComponent)==null||e.dispose(),this.player.removeChild(this.nsfwComponent),this.player.removeClass("peertube-nsfw"),super.dispose()}};X.registerPlugin("peertubeNSFW",oc);var Fb=X.getPlugin("plugin"),wf=class Bn extends Fb{constructor(e,t){super(e,t),this.isLive=t.isLive,this.handlers=this.buildHandlers(),this.handleKeyFunction=i=>this.onKeyDown(i),document.addEventListener("keydown",this.handleKeyFunction)}dispose(){document.removeEventListener("keydown",this.handleKeyFunction),super.dispose()}onKeyDown(e){if(this.isValidKeyTarget(e.target)){for(let t of this.handlers)if(t.accept(e)){t.cb(e);return}}}buildHandlers(){let e=[{accept:t=>t.key===" "||t.key==="MediaPlayPause",cb:t=>{t.preventDefault(),t.stopPropagation(),this.player.paused()?this.player.play():this.player.pause()}},{accept:t=>this.isNaked(t,"ArrowUp"),cb:t=>{t.preventDefault(),this.player.volume(this.player.volume()+Bn.VOLUME_STEP)}},{accept:t=>this.isNaked(t,"ArrowDown"),cb:t=>{t.preventDefault(),this.player.volume(this.player.volume()-Bn.VOLUME_STEP)}},{accept:t=>this.isNaked(t,"f")||!t.altKey&&t.ctrlKey&&t.key==="Enter",cb:t=>{t.preventDefault(),this.player.isFullscreen()?this.player.exitFullscreen():this.player.requestFullscreen()}},{accept:t=>this.isNaked(t,"m"),cb:t=>{t.preventDefault(),this.player.muted(!this.player.muted())}},{accept:t=>t.key===">",cb:()=>{if(this.isLive)return;let t=Math.min(this.player.playbackRate()+.1,5);this.player.playbackRate(parseFloat(t.toFixed(2)))}},{accept:t=>t.key==="<",cb:()=>{if(this.isLive)return;let t=Math.max(this.player.playbackRate()-.1,.1);this.player.playbackRate(parseFloat(t.toFixed(2)))}},{accept:t=>t.key===",",cb:()=>{if(this.isLive)return;this.player.pause();let t=1/30;this.player.currentTime(this.player.currentTime()-t)}},{accept:t=>t.key===".",cb:()=>{if(this.isLive)return;this.player.pause();let t=1/30;this.player.currentTime(this.player.currentTime()+t)}}];return this.isLive?e:e.concat(this.buildVODHandlers())}buildVODHandlers(){let e=[{accept:t=>this.isNaked(t,"ArrowLeft")||this.isNaked(t,"MediaRewind"),cb:t=>{if(this.isLive)return;t.preventDefault();let i=Math.max(0,this.player.currentTime()-Bn.SEEK_STEP);this.player.currentTime(i)}},{accept:t=>this.isNaked(t,"ArrowRight")||this.isNaked(t,"MediaForward"),cb:t=>{if(this.isLive)return;t.preventDefault();let i=Math.min(this.player.duration(),this.player.currentTime()+Bn.SEEK_STEP);this.player.currentTime(i)}}];for(let t=0;t<10;t++)e.push({accept:i=>this.isNakedOrShift(i,t+""),cb:i=>{this.isLive||(i.preventDefault(),this.player.currentTime(this.player.duration()*t*.1))}});return e}isValidKeyTarget(e){let t=this.player.el(),i=document.activeElement,s=e.tagName.toLowerCase();return i===t||i===t.querySelector(".vjs-tech")||i===t.querySelector(".vjs-control-bar")||e.id==="content"||s==="body"||s==="video"}isNaked(e,t){return t.length===1&&(t=t.toUpperCase()),!e.ctrlKey&&!e.altKey&&!e.metaKey&&!e.shiftKey&&this.getLatinKey(e.key,e.code)===t}isNakedOrShift(e,t){return!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.key===t}getLatinKey(e,t){if(e.length!==1)return e;if(e.charCodeAt(0)>=880){if(t.startsWith("Key")&&t.length===4)return t.charAt(3);if(t.startsWith("Digit")&&t.length===6)return t.charAt(5)}return e.toUpperCase()}};Qe(wf,"VOLUME_STEP",.1);Qe(wf,"SEEK_STEP",5);var Nb=wf;X.registerPlugin("peerTubeHotkeysPlugin",Nb);function Bb(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Jv={exports:{}},Et=Jv.exports={},Ui,$i;function lc(){throw new Error("setTimeout has not been defined")}function uc(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Ui=setTimeout:Ui=lc}catch{Ui=lc}try{typeof clearTimeout=="function"?$i=clearTimeout:$i=uc}catch{$i=uc}})();function Zv(r){if(Ui===setTimeout)return setTimeout(r,0);if((Ui===lc||!Ui)&&setTimeout)return Ui=setTimeout,setTimeout(r,0);try{return Ui(r,0)}catch{try{return Ui.call(null,r,0)}catch{return Ui.call(this,r,0)}}}function Ub(r){if($i===clearTimeout)return clearTimeout(r);if(($i===uc||!$i)&&clearTimeout)return $i=clearTimeout,clearTimeout(r);try{return $i(r)}catch{try{return $i.call(null,r)}catch{return $i.call(this,r)}}}var ns=[],Gr=!1,nr,bo=-1;function $b(){!Gr||!nr||(Gr=!1,nr.length?ns=nr.concat(ns):bo=-1,ns.length&&ey())}function ey(){if(!Gr){var r=Zv($b);Gr=!0;for(var e=ns.length;e;){for(nr=ns,ns=[];++bo<e;)nr&&nr[bo].run();bo=-1,e=ns.length}nr=null,Gr=!1,Ub(r)}}Et.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];ns.push(new ty(r,e)),ns.length===1&&!Gr&&Zv(ey)};function ty(r,e){this.fun=r,this.array=e}ty.prototype.run=function(){this.fun.apply(null,this.array)};Et.title="browser";Et.browser=!0;Et.env={};Et.argv=[];Et.version="";Et.versions={};function ds(){}Et.on=ds;Et.addListener=ds;Et.once=ds;Et.off=ds;Et.removeListener=ds;Et.removeAllListeners=ds;Et.emit=ds;Et.prependListener=ds;Et.prependOnceListener=ds;Et.listeners=function(r){return[]};Et.binding=function(r){throw new Error("process.binding is not supported")};Et.cwd=function(){return"/"};Et.chdir=function(r){throw new Error("process.chdir is not supported")};Et.umask=function(){return 0};var Hb=Jv.exports,Yu=Bb(Hb),Xa={exports:{}},Xu,Cg;function jb(){if(Cg)return Xu;Cg=1;var r=1e3,e=r*60,t=e*60,i=t*24,s=i*7,n=i*365.25;Xu=function(f,p){p=p||{};var m=typeof f;if(m==="string"&&f.length>0)return a(f);if(m==="number"&&isFinite(f))return p.long?c(f):l(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function a(f){if(f=String(f),!(f.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(p){var m=parseFloat(p[1]),_=(p[2]||"ms").toLowerCase();switch(_){case"years":case"year":case"yrs":case"yr":case"y":return m*n;case"weeks":case"week":case"w":return m*s;case"days":case"day":case"d":return m*i;case"hours":case"hour":case"hrs":case"hr":case"h":return m*t;case"minutes":case"minute":case"mins":case"min":case"m":return m*e;case"seconds":case"second":case"secs":case"sec":case"s":return m*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return m;default:return}}}}function l(f){var p=Math.abs(f);return p>=i?Math.round(f/i)+"d":p>=t?Math.round(f/t)+"h":p>=e?Math.round(f/e)+"m":p>=r?Math.round(f/r)+"s":f+"ms"}function c(f){var p=Math.abs(f);return p>=i?h(f,p,i,"day"):p>=t?h(f,p,t,"hour"):p>=e?h(f,p,e,"minute"):p>=r?h(f,p,r,"second"):f+" ms"}function h(f,p,m,_){var E=p>=m*1.5;return Math.round(f/m)+" "+_+(E?"s":"")}return Xu}var Qu,wg;function Vb(){if(wg)return Qu;wg=1;function r(e){i.debug=i,i.default=i,i.coerce=h,i.disable=l,i.enable=n,i.enabled=c,i.humanize=jb(),i.destroy=f,Object.keys(e).forEach(p=>{i[p]=e[p]}),i.names=[],i.skips=[],i.formatters={};function t(p){let m=0;for(let _=0;_<p.length;_++)m=(m<<5)-m+p.charCodeAt(_),m|=0;return i.colors[Math.abs(m)%i.colors.length]}i.selectColor=t;function i(p){let m,_=null,E,S;function C(...I){if(!C.enabled)return;let R=C,k=Number(new Date),D=k-(m||k);R.diff=D,R.prev=m,R.curr=k,m=k,I[0]=i.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let x=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(B,H)=>{if(B==="%%")return"%";x++;let O=i.formatters[H];if(typeof O=="function"){let P=I[x];B=O.call(R,P),I.splice(x,1),x--}return B}),i.formatArgs.call(R,I),(R.log||i.log).apply(R,I)}return C.namespace=p,C.useColors=i.useColors(),C.color=i.selectColor(p),C.extend=s,C.destroy=i.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(E!==i.namespaces&&(E=i.namespaces,S=i.enabled(p)),S),set:I=>{_=I}}),typeof i.init=="function"&&i.init(C),C}function s(p,m){let _=i(this.namespace+(typeof m>"u"?":":m)+p);return _.log=this.log,_}function n(p){i.save(p),i.namespaces=p,i.names=[],i.skips=[];let m=(typeof p=="string"?p:"").trim().replace(" ",",").split(",").filter(Boolean);for(let _ of m)_[0]==="-"?i.skips.push(_.slice(1)):i.names.push(_)}function a(p,m){let _=0,E=0,S=-1,C=0;for(;_<p.length;)if(E<m.length&&(m[E]===p[_]||m[E]==="*"))m[E]==="*"?(S=E,C=_,E++):(_++,E++);else if(S!==-1)E=S+1,C++,_=C;else return!1;for(;E<m.length&&m[E]==="*";)E++;return E===m.length}function l(){let p=[...i.names,...i.skips.map(m=>"-"+m)].join(",");return i.enable(""),p}function c(p){for(let m of i.skips)if(a(p,m))return!1;for(let m of i.names)if(a(p,m))return!0;return!1}function h(p){return p instanceof Error?p.stack||p.message:p}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return i.enable(i.load()),i}return Qu=r,Qu}var Ag;function Gb(){return Ag||(Ag=1,function(r,e){e.formatArgs=i,e.save=s,e.load=n,e.useColors=t,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;let h="color: "+this.color;c.splice(1,0,h,"color: inherit");let f=0,p=0;c[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(f++,m==="%c"&&(p=f))}),c.splice(p,0,h)}e.log=console.debug||console.log||(()=>{});function s(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function n(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof Yu<"u"&&"env"in Yu&&(c=Yu.env.DEBUG),c}function a(){try{return localStorage}catch{}}r.exports=Vb()(e);let{formatters:l}=r.exports;l.j=function(c){try{return JSON.stringify(c)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}(Xa,Xa.exports)),Xa.exports}var Kb=Gb(),fs=qv(Kb),wn=fs("peertube:player:metrics"),qb=X.getPlugin("plugin"),hc=class extends qb{constructor(e,t){super(e),this.options_=t,this.downloadedBytesP2P=0,this.downloadedBytesHTTP=0,this.uploadedBytesP2P=0,this.resolutionChanges=0,this.errors=0,this.bufferStalled=0,this.p2pPeers=0,this.trackBytes(),this.trackResolutionChange(),this.trackErrors(),this.trackBufferStalled(),this.one("play",()=>{this.player.on("video-change",()=>{this.runMetricsIntervalOnPlay()})}),this.runMetricsIntervalOnPlay()}dispose(){this.metricsInterval&&clearInterval(this.metricsInterval),super.dispose()}runMetricsIntervalOnPlay(){this.downloadedBytesP2P=0,this.downloadedBytesHTTP=0,this.uploadedBytesP2P=0,this.resolutionChanges=0,this.errors=0,this.bufferStalled=0,this.lastPlayerNetworkInfo=void 0,wn("Will track metrics on next play"),this.player.one("play",()=>{wn("Tracking metrics"),this.runMetricsInterval()})}runMetricsInterval(){this.metricsInterval&&clearInterval(this.metricsInterval),this.options_.metricsUrl()&&(this.metricsInterval=setInterval(()=>{let e,t;if(this.player.usingPlugin("p2pMediaLoader")){let n=this.player.p2pMediaLoader().getCurrentLevel();if(!n)return;e=Math.min(n.height||0,n.width||0);let a=n?.attrs["FRAME-RATE"];t=a?parseInt(a,10):void 0}else if(this.player.usingPlugin("webVideo")){let n=this.player.webVideo().getCurrentVideoFile();if(!n)return;e=n.resolution.id,t=n.fps&&n.fps!==-1?n.fps:void 0}else return;let i={resolution:e,fps:t,playerMode:this.options_.mode(),resolutionChanges:this.resolutionChanges,errors:this.errors,bufferStalled:this.bufferStalled,downloadedBytesHTTP:this.downloadedBytesHTTP,downloadedBytesP2P:this.downloadedBytesP2P,uploadedBytesP2P:this.uploadedBytesP2P,p2pPeers:this.p2pPeers,p2pEnabled:this.p2pEnabled,videoId:this.options_.videoUUID()};this.resolutionChanges=0,this.downloadedBytesP2P=0,this.downloadedBytesHTTP=0,this.uploadedBytesP2P=0,this.errors=0,this.bufferStalled=0;let s=new Headers({"Content-type":"application/json; charset=UTF-8"});return fetch(this.options_.metricsUrl(),{method:"POST",body:JSON.stringify(i),headers:s}).catch(n=>ze.clientWarn("Cannot send metrics to the server.",n))},this.options_.metricsInterval()))}trackBytes(){this.player.on("network-info",(e,t)=>{var i,s,n,a,l,c,h,f;this.downloadedBytesHTTP+=Math.max(Math.round(t.http.downloaded-(((i=this.lastPlayerNetworkInfo)==null?void 0:i.http.downloaded)||0)),0),this.downloadedBytesP2P+=Math.max(Math.round((((s=t.p2p)==null?void 0:s.downloaded)||0)-(((a=(n=this.lastPlayerNetworkInfo)==null?void 0:n.p2p)==null?void 0:a.downloaded)||0)),0),this.uploadedBytesP2P+=Math.max(Math.round((((l=t.p2p)==null?void 0:l.uploaded)||0)-(((h=(c=this.lastPlayerNetworkInfo)==null?void 0:c.p2p)==null?void 0:h.uploaded)||0)),0),this.p2pPeers=(f=t.p2p)==null?void 0:f.peersP2POnly,this.p2pEnabled=!!t.p2p,this.lastPlayerNetworkInfo=t})}trackResolutionChange(){this.player.on("resolution-change",(e,{initResolutionChange:t})=>{t!==!0&&(wn("Adding resolution change"),this.resolutionChanges++)})}trackErrors(){this.player.on("error",()=>{wn("Adding player error"),this.errors++})}trackBufferStalled(){this.player.on("buffer-stalled",()=>{wn("Adding buffer stalled"),this.bufferStalled++})}};X.registerPlugin("metrics",hc);var Wb=X.getComponent("Component"),cc=class extends Wb{createEl(){let e=super.createEl("div",{className:"vjs-mobile-buttons-overlay"});this.mainButton=super.createEl("div",{className:"main-button"}),this.touchStartHandler=t=>{if(t.stopPropagation(),this.player_.paused()||this.player_.ended()){this.player_.play();return}this.player_.pause()},this.mainButton.addEventListener("touchstart",this.touchStartHandler,{passive:!0}),this.rewind=super.createEl("div",{className:"rewind-button vjs-hidden"}),this.forward=super.createEl("div",{className:"forward-button vjs-hidden"});for(let t=0;t<3;t++)this.rewind.appendChild(super.createEl("span",{className:"icon"})),this.forward.appendChild(super.createEl("span",{className:"icon"}));return this.rewindText=this.rewind.appendChild(super.createEl("div",{className:"text"})),this.forwardText=this.forward.appendChild(super.createEl("div",{className:"text"})),e.appendChild(this.rewind),e.appendChild(this.mainButton),e.appendChild(this.forward),e}dispose(){this.touchStartHandler&&this.mainButton.removeEventListener("touchstart",this.touchStartHandler),super.dispose()}displayFastSeek(e){if(e===0){this.hideRewind(),this.hideForward();return}if(e>0){this.hideRewind(),this.displayForward(e);return}if(e<0){this.hideForward(),this.displayRewind(e);return}}hideRewind(){this.rewind.classList.add("vjs-hidden"),this.rewindText.textContent=""}displayRewind(e){this.rewind.classList.remove("vjs-hidden"),this.rewindText.textContent=this.player().localize("{1} seconds",[e+""])}hideForward(){this.forward.classList.add("vjs-hidden"),this.forwardText.textContent=""}displayForward(e){this.forward.classList.remove("vjs-hidden"),this.forwardText.textContent=this.player().localize("{1} seconds",[e+""])}};X.registerComponent("PeerTubeMobileButtons",cc);var Pr=fs("peertube:player:mobile"),zb=X.getPlugin("plugin"),Af=class So extends zb{constructor(e,t){super(e,t),this.seekAmount=0,X.browser.IS_ANDROID&&screen.orientation&&this.handleFullscreenRotation(),e.controls()&&(this.peerTubeMobileButtons=e.addChild("PeerTubeMobileButtons",{reportTouchActivity:!1}),this.player.options_.userActions||(this.player.options_.userActions={}),this.player.options_.userActions.click=!1,this.player.options_.userActions.doubleClick=!1,this.onPlayHandler=()=>this.initTouchStartEvents(),this.player.one("play",this.onPlayHandler),this.seekBar=this.player.getDescendant(["controlBar","progressControl","seekBar"]),this.sliderActiveHandler=()=>this.player.addClass("vjs-mobile-sliding"),this.sliderInactiveHandler=()=>this.player.removeClass("vjs-mobile-sliding"),this.seekBar.on("slideractive",this.sliderActiveHandler),this.seekBar.on("sliderinactive",this.sliderInactiveHandler))}dispose(){var e;this.onPlayHandler&&this.player.off("play",this.onPlayHandler),this.onFullScreenChangeHandler&&this.player.off("fullscreenchange",this.onFullScreenChangeHandler),this.onTouchStartHandler&&this.player.off("touchstart",this.onFullScreenChangeHandler),this.onMobileButtonTouchStartHandler&&((e=this.peerTubeMobileButtons)==null||e.el().removeEventListener("touchstart",this.onMobileButtonTouchStartHandler)),super.dispose()}handleFullscreenRotation(){this.onFullScreenChangeHandler=()=>{!this.player.isFullscreen()||this.isPortraitVideo()||screen.orientation.lock("landscape").catch(e=>ze.error("Cannot lock screen to landscape.",e))},this.player.on("fullscreenchange",this.onFullScreenChangeHandler)}isPortraitVideo(){return this.player.videoWidth()<this.player.videoHeight()}initTouchStartEvents(){let e=(t,i=!1)=>{if(Pr("Handle touch start"),this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=void 0),this.doubleTapping||this.lastTapEvent&&t.timeStamp-this.lastTapEvent.timeStamp<So.DOUBLE_TAP_DELAY_MS){Pr("Detected double tap"),this.lastTapEvent=t,this.onDoubleTap(t);return}i||(this.newActiveState=!this.player.userActive(),!this.player.paused()&&this.newActiveState===!0&&this.player.addClass("vjs-force-inactive"),this.tapTimeout=setTimeout(()=>{Pr("No double tap detected, set user active state to "+this.newActiveState),this.player.removeClass("vjs-force-inactive"),this.player.userActive(this.newActiveState)},So.DOUBLE_TAP_DELAY_MS),this.lastTapEvent=t)};this.onTouchStartHandler=t=>{let i=this.player.userActive();e(t,i)},this.player.on("touchstart",this.onTouchStartHandler),this.onMobileButtonTouchStartHandler=t=>{t.preventDefault(),t.stopPropagation(),e(t)},this.peerTubeMobileButtons.el().addEventListener("touchstart",this.onMobileButtonTouchStartHandler,{passive:!1})}onDoubleTap(e){let t=this.player.currentWidth(),i=this.findPlayerTarget(e.target).getBoundingClientRect(),s=e.targetTouches[0].pageX-i.left;Pr("Calculating double tap zone (player width: %d, offset X: %d)",t,s),s>.66*t?(this.seekAmount<0&&(this.seekAmount=0),this.seekAmount+=10,Pr("Will forward %d seconds",this.seekAmount)):s<.33*t&&(this.seekAmount>0&&(this.seekAmount=0),this.seekAmount-=10,Pr("Will rewind %d seconds",this.seekAmount)),this.peerTubeMobileButtons.displayFastSeek(this.seekAmount),this.scheduleSetCurrentTime()}findPlayerTarget(e){return e.classList.contains("video-js")?e:this.findPlayerTarget(e.parentElement)}scheduleSetCurrentTime(){this.player.pause(),this.player.addClass("vjs-fast-seeking"),this.doubleTapping=!0,this.setCurrentTimeTimeout&&clearTimeout(this.setCurrentTimeTimeout),this.setCurrentTimeTimeout=setTimeout(()=>{let e=this.player.currentTime()+this.seekAmount;this.seekAmount=0,e=Math.max(0,e),e=Math.min(this.player.duration(),e),this.player.currentTime(e),this.seekAmount=0,this.peerTubeMobileButtons.displayFastSeek(0),this.player.userActive(!1),this.doubleTapping=!1,this.player.play(),setTimeout(()=>{this.player.removeClass("vjs-fast-seeking"),this.player.removeClass("vjs-force-inactive")},100)},So.SET_CURRENT_TIME_DELAY)}};Qe(Af,"DOUBLE_TAP_DELAY_MS",250);Qe(Af,"SET_CURRENT_TIME_DELAY",750);var Yb=Af;X.registerPlugin("peertubeMobile",Yb);var Ce=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},Xb=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=Qb},Qb=Number.MAX_SAFE_INTEGER||9007199254740991,Le=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),z=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r}({}),L=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r}({}),Ge={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ae={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},Is=class{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){let i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){let e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}},dc=class{constructor(e,t,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Is(e),this.fast_=new Is(t),this.defaultTTFB_=s,this.ttfb_=new Is(e)}update(e,t){let{slow_:i,fast_:s,ttfb_:n}=this;i.halfLife!==e&&(this.slow_=new Is(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Is(t,s.getEstimate(),s.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new Is(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);let i=8*t,s=e/1e3,n=i/s;this.fast_.sample(s,n),this.slow_.sample(s,n)}sampleTTFB(e){let t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}};function Jb(r,e,t){return(e=eS(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function it(){return it=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},it.apply(null,arguments)}function Ig(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function rt(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ig(Object(t),!0).forEach(function(i){Jb(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Ig(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function Zb(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function eS(r){var e=Zb(r,"string");return typeof e=="symbol"?e:e+""}var li=class{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;let i=`[${e}]:`;this.trace=Ls,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}},Ls=function(){},tS={trace:Ls,debug:Ls,log:Ls,warn:Ls,info:Ls,error:Ls};function fc(){return it({},tS)}function iS(r,e){let t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):Ls}function Lg(r,e,t){return e[r]?e[r].bind(e):iS(r,t)}var pc=fc();function sS(r,e,t){let i=fc();if(typeof console=="object"&&r===!0||typeof r=="object"){let s=["debug","log","info","warn","error"];s.forEach(n=>{i[n]=Lg(n,r,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.7`)}catch{return fc()}s.forEach(n=>{pc[n]=Lg(n,r)})}else it(pc,i);return i}var Ze=pc;function Bs(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function rS(r){return typeof self<"u"&&r===self.ManagedMediaSource}function iy(r,e){let t=Object.keys(r),i=Object.keys(e),s=t.length,n=i.length;return!s||!n||s===n&&!t.some(a=>i.indexOf(a)===-1)}function oi(r,e=!1){if(typeof TextDecoder<"u"){let h=new TextDecoder("utf-8").decode(r);if(e){let f=h.indexOf("\0");return f!==-1?h.substring(0,f):h}return h.replace(/\0/g,"")}let t=r.length,i,s,n,a="",l=0;for(;l<t;){if(i=r[l++],i===0&&e)return a;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=r[l++],a+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=r[l++],n=r[l++],a+=String.fromCharCode((i&15)<<12|(s&63)<<6|(n&63)<<0);break}}return a}var ir={hexDump:function(r){let e="";for(let t=0;t<r.length;t++){let i=r[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}};function sy(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function nS(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ju={exports:{}},kg;function aS(){return kg||(kg=1,function(r,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,l={buildAbsoluteURL:function(c,h,f){if(f=f||{},c=c.trim(),h=h.trim(),!h){if(!f.alwaysNormalize)return c;var p=l.parseURL(c);if(!p)throw new Error("Error trying to parse base URL.");return p.path=l.normalizePath(p.path),l.buildURLFromParts(p)}var m=l.parseURL(h);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return f.alwaysNormalize?(m.path=l.normalizePath(m.path),l.buildURLFromParts(m)):h;var _=l.parseURL(c);if(!_)throw new Error("Error trying to parse base URL.");if(!_.netLoc&&_.path&&_.path[0]!=="/"){var E=s.exec(_.path);_.netLoc=E[1],_.path=E[2]}_.netLoc&&!_.path&&(_.path="/");var S={scheme:_.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(S.netLoc=_.netLoc,m.path[0]!=="/"))if(!m.path)S.path=_.path,m.params||(S.params=_.params,m.query||(S.query=_.query));else{var C=_.path,I=C.substring(0,C.lastIndexOf("/")+1)+m.path;S.path=l.normalizePath(I)}return S.path===null&&(S.path=f.alwaysNormalize?l.normalizePath(m.path):m.path),l.buildURLFromParts(S)},parseURL:function(c){var h=i.exec(c);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(n,"");c.length!==(c=c.replace(a,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}};r.exports=l})()}(Ju)),Ju.exports}var If=aS(),Yn=class{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},lt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},Go=class{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,oS(this,"stats")}setByteRange(e,t){let i=e.split("@",2),s;i.length===1?s=t?.byteRangeEndOffset||0:s=parseInt(i[1]),this._byteRange=[s,parseInt(i[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[lt.AUDIO]:null,[lt.VIDEO]:null,[lt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Yn),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=If.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){let{elementaryStreams:e}=this;e[lt.AUDIO]=null,e[lt.VIDEO]=null,e[lt.AUDIOVIDEO]=null}};function Lt(r){return r.sn!=="initSegment"}var Vn=class extends Go{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){let e=this.stats.total;if(e)return e}if(this.byteRange){let e=this.byteRange[0],t=this.byteRange[1];if(Ce(e)&&Ce(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){let{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){let t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{let i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;let e=Ce(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){let t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ce(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Lt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){let t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,s,n,a=!1){let{elementaryStreams:l}=this,c=l[e];if(!c){l[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:n,partial:a};return}c.startPTS=Math.min(c.startPTS,t),c.endPTS=Math.max(c.endPTS,i),c.startDTS=Math.min(c.startDTS,s),c.endDTS=Math.max(c.endDTS,n)}},gc=class extends Go{constructor(e,t,i,s,n){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;let a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){let{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}};function ry(r,e){let t=Object.getPrototypeOf(r);if(t){let i=Object.getOwnPropertyDescriptor(t,e);return i||ry(t,e)}}function oS(r,e){let t=ry(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}var Rg=Math.pow(2,32)-1,lS=[].push,ny={video:1,audio:2,id3:3,text:4};function Mt(r){return String.fromCharCode.apply(null,r)}function ay(r,e){let t=r[e]<<8|r[e+1];return t<0?65536+t:t}function Fe(r,e){let t=oy(r,e);return t<0?4294967296+t:t}function Pg(r,e){let t=Fe(r,e);return t*=Math.pow(2,32),t+=Fe(r,e+4),t}function oy(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function uS(r){let e=r.byteLength;for(let t=0;t<e;){let i=Fe(r,t);if(i>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=i>1?t+i:e}return!1}function je(r,e){let t=[];if(!e.length)return t;let i=r.byteLength;for(let s=0;s<i;){let n=Fe(r,s),a=Mt(r.subarray(s+4,s+8)),l=n>1?s+n:i;if(a===e[0])if(e.length===1)t.push(r.subarray(s+8,l));else{let c=je(r.subarray(s+8,l),e.slice(1));c.length&&lS.apply(t,c)}s=l}return t}function hS(r){let e=[],t=r[0],i=8,s=Fe(r,i);i+=4;let n=0,a=0;t===0?(n=Fe(r,i),a=Fe(r,i+4),i+=8):(n=Pg(r,i),a=Pg(r,i+8),i+=16),i+=2;let l=r.length+a,c=ay(r,i);i+=2;for(let h=0;h<c;h++){let f=i,p=Fe(r,f);f+=4;let m=p&2147483647;if((p&2147483648)>>>31===1)return Ze.warn("SIDX has hierarchical references (not supported)"),null;let E=Fe(r,f);f+=4,e.push({referenceSize:m,subsegmentDuration:E,info:{duration:E/s,start:l,end:l+m-1}}),l+=m,f+=4,i=f}return{earliestPresentationTime:n,timescale:s,version:t,referencesCount:c,references:e}}function ly(r){let e=[],t=je(r,["moov","trak"]);for(let s=0;s<t.length;s++){let n=t[s],a=je(n,["tkhd"])[0];if(a){let l=a[0],c=Fe(a,l===0?12:20),h=je(n,["mdia","mdhd"])[0];if(h){l=h[0];let f=Fe(h,l===0?12:20),p=je(n,["mdia","hdlr"])[0];if(p){let m=Mt(p.subarray(8,12)),_={soun:lt.AUDIO,vide:lt.VIDEO}[m],E=je(n,["mdia","minf","stbl","stsd"])[0],S=cS(E);_?(e[c]={timescale:f,type:_,stsd:S},e[_]=rt({timescale:f,id:c},S)):e[c]={timescale:f,type:m,stsd:S}}}}}return je(r,["moov","mvex","trex"]).forEach(s=>{let n=Fe(s,4),a=e[n];a&&(a.default={duration:Fe(s,12),flags:Fe(s,20)})}),e}function cS(r){let e=r.subarray(8),t=e.subarray(86),i=Mt(e.subarray(4,8)),s=i,n,a=i==="enca"||i==="encv";if(a){let h=je(e,[i])[0].subarray(i==="enca"?28:78);je(h,["sinf"]).forEach(p=>{let m=je(p,["schm"])[0];if(m){let _=Mt(m.subarray(4,8));if(_==="cbcs"||_==="cenc"){let E=je(p,["frma"])[0];E&&(s=Mt(E))}}})}let l=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{let c=je(t,["avcC"])[0];c&&c.length>3&&(s+="."+Ja(c[1])+Ja(c[2])+Ja(c[3]),n=Qa(l==="avc1"?"dva1":"dvav",t));break}case"mp4a":{let c=je(e,[i])[0],h=je(c.subarray(28),["esds"])[0];if(h&&h.length>7){let f=4;if(h[f++]!==3)break;f=Zu(h,f),f+=2;let p=h[f++];if(p&128&&(f+=2),p&64&&(f+=h[f++]),h[f++]!==4)break;f=Zu(h,f);let m=h[f++];if(m===64)s+="."+Ja(m);else break;if(f+=12,h[f++]!==5)break;f=Zu(h,f);let _=h[f++],E=(_&248)>>3;E===31&&(E+=1+((_&7)<<3)+((h[f]&224)>>5)),s+="."+E}break}case"hvc1":case"hev1":{let c=je(t,["hvcC"])[0];if(c&&c.length>12){let h=c[1],f=["","A","B","C"][h>>6],p=h&31,m=Fe(c,2),_=(h&32)>>5?"H":"L",E=c[12],S=c.subarray(6,12);s+="."+f+p,s+="."+dS(m).toString(16).toUpperCase(),s+="."+_+E;let C="";for(let I=S.length;I--;){let R=S[I];(R||C)&&(C="."+R.toString(16).toUpperCase()+C)}s+=C}n=Qa(l=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=Qa(s,t)||s;break}case"vp09":{let c=je(t,["vpcC"])[0];if(c&&c.length>6){let h=c[4],f=c[5],p=c[6]>>4&15;s+="."+Bi(h)+"."+Bi(f)+"."+Bi(p)}break}case"av01":{let c=je(t,["av1C"])[0];if(c&&c.length>2){let h=c[1]>>>5,f=c[1]&31,p=c[2]>>>7?"H":"M",m=(c[2]&64)>>6,_=(c[2]&32)>>5,E=h===2&&m?_?12:10:m?10:8,S=(c[2]&16)>>4,C=(c[2]&8)>>3,I=(c[2]&4)>>2,R=c[2]&3;s+="."+h+"."+Bi(f)+p+"."+Bi(E)+"."+S+"."+C+I+R+"."+Bi(1)+"."+Bi(1)+"."+Bi(1)+"."+0,n=Qa("dav1",t)}break}}return{codec:s,encrypted:a,supplemental:n}}function Qa(r,e){let t=je(e,["dvvC"]),i=t.length?t[0]:je(e,["dvcC"])[0];if(i){let s=i[2]>>1&127,n=i[2]<<5&32|i[3]>>3&31;return r+"."+Bi(s)+"."+Bi(n)}}function dS(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function Zu(r,e){let t=e+5;for(;r[e++]&128&&e<t;);return e}function Ja(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function Bi(r){return(r<10?"0":"")+r}function fS(r,e){if(!r||!e)return r;let t=e.keyId;return t&&e.isCommonEncryption&&je(r,["moov","trak"]).forEach(s=>{let a=je(s,["mdia","minf","stbl","stsd"])[0].subarray(8),l=je(a,["enca"]),c=l.length>0;c||(l=je(a,["encv"])),l.forEach(h=>{let f=c?h.subarray(28):h.subarray(78);je(f,["sinf"]).forEach(m=>{let _=pS(m);if(_){let E=_.subarray(8,24);E.some(S=>S!==0)||(Ze.log(`[eme] Patching keyId in 'enc${c?"a":"v"}>sinf>>tenc' box: ${ir.hexDump(E)} -> ${ir.hexDump(t)}`),_.set(t,8))}})})}),r}function pS(r){let e=je(r,["schm"])[0];if(e){let t=Mt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return je(r,["schi","tenc"])[0]}return null}function gS(r,e,t){let i={},s=je(r,["moof","traf"]);for(let n=0;n<s.length;n++){let a=s[n],l=je(a,["tfhd"])[0],c=Fe(l,4),h=e[c];if(!h)continue;let f=i[c]||(i[c]={start:NaN,duration:0,sampleCount:0,timescale:h.timescale,type:h.type}),p=je(a,["tfdt"])[0];if(p){let k=p[0],D=Fe(p,4);k===1&&(D===Rg?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(D*=Rg+1,D+=Fe(p,8))),Ce(D)&&(!Ce(f.start)||D<f.start)&&(f.start=D)}let m=h.default,_=Fe(l,0)|m?.flags,E=m?.duration||0;_&8&&(_&2?E=Fe(l,12):E=Fe(l,8));let S=je(a,["trun"]),C=f.start||0,I=0,R=E;for(let k=0;k<S.length;k++){let D=S[k],x=Fe(D,4),N=f.sampleCount;f.sampleCount+=x;let B=D[3]&1,H=D[3]&4,O=D[2]&1,P=D[2]&2,G=D[2]&4,Q=D[2]&8,ie=8,te=x;for(B&&(ie+=4),H&&x&&(!(D[ie+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=N),ie+=4,O?(R=Fe(D,ie),ie+=4):R=E,P&&(ie+=4),Q&&(ie+=4),C+=R,I+=R,te--);te--;)O?(R=Fe(D,ie),ie+=4):R=E,P&&(ie+=4),G&&(D[ie+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(te+1),f.keyFrameStart=C),ie+=4),Q&&(ie+=4),C+=R,I+=R;!I&&E&&(I+=E*x)}f.duration+=I}if(!Object.keys(i).some(n=>i[n].duration)){let n=1/0,a=0,l=je(r,["sidx"]);for(let c=0;c<l.length;c++){let h=hS(l[c]);if(h!=null&&h.references){n=Math.min(n,h.earliestPresentationTime/h.timescale);let f=h.references.reduce((p,m)=>p+m.info.duration||0,0);a=Math.max(a,f+h.earliestPresentationTime/h.timescale)}}a&&Ce(a)&&Object.keys(i).forEach(c=>{i[c].duration||(i[c].duration=a*i[c].timescale-i[c].start)})}return i}function mS(r){let e={valid:null,remainder:null},t=je(r,["moof"]);if(t.length<2)return e.remainder=r,e;let i=t[t.length-1];return e.valid=r.slice(0,i.byteOffset-8),e.remainder=r.slice(i.byteOffset-8),e}function yi(r,e){let t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Dg(r,e){let t=[],i=e.samples,s=e.timescale,n=e.id,a=!1;return je(i,["moof"]).map(c=>{let h=c.byteOffset-8;je(c,["traf"]).map(p=>{let m=je(p,["tfdt"]).map(_=>{let E=_[0],S=Fe(_,4);return E===1&&(S*=Math.pow(2,32),S+=Fe(_,8)),S/s})[0];return m!==void 0&&(r=m),je(p,["tfhd"]).map(_=>{let E=Fe(_,4),S=Fe(_,0)&16777215,C=(S&1)!==0,I=(S&2)!==0,R=(S&8)!==0,k=0,D=(S&16)!==0,x=0,N=(S&32)!==0,B=8;E===n&&(C&&(B+=8),I&&(B+=4),R&&(k=Fe(_,B),B+=4),D&&(x=Fe(_,B),B+=4),N&&(B+=4),e.type==="video"&&(a=Nl(e.codec)),je(p,["trun"]).map(H=>{let O=H[0],P=Fe(H,0)&16777215,G=(P&1)!==0,Q=0,ie=(P&4)!==0,te=(P&256)!==0,re=0,ne=(P&512)!==0,de=0,Z=(P&1024)!==0,ae=(P&2048)!==0,se=0,oe=Fe(H,4),Y=8;G&&(Q=Fe(H,Y),Y+=4),ie&&(Y+=4);let ee=Q+h;for(let be=0;be<oe;be++){if(te?(re=Fe(H,Y),Y+=4):re=k,ne?(de=Fe(H,Y),Y+=4):de=x,Z&&(Y+=4),ae&&(O===0?se=Fe(H,Y):se=oy(H,Y),Y+=4),e.type===lt.VIDEO){let Ee=0;for(;Ee<de;){let Re=Fe(i,ee);if(ee+=4,vS(a,i[ee])){let Oe=i.subarray(ee,ee+Re);Lf(Oe,a?2:1,r+se/s,t)}ee+=Re,Ee+=Re+4}}r+=re/s}}))})})}),t}function Nl(r){if(!r)return!1;let e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function vS(r,e){if(r){let t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Lf(r,e,t,i){let s=uy(r),n=0;n+=e;let a=0,l=0,c=0;for(;n<s.length;){a=0;do{if(n>=s.length)break;c=s[n++],a+=c}while(c===255);l=0;do{if(n>=s.length)break;c=s[n++],l+=c}while(c===255);let h=s.length-n,f=n;if(l<h)n+=l;else if(l>h){Ze.error(`Malformed SEI payload. ${l} is too small, only ${h} bytes left to parse.`);break}if(a===4){if(s[f++]===181){let m=ay(s,f);if(f+=2,m===49){let _=Fe(s,f);if(f+=4,_===1195456820){let E=s[f++];if(E===3){let S=s[f++],C=31&S,I=64&S,R=I?2+C*3:0,k=new Uint8Array(R);if(I){k[0]=S;for(let D=1;D<R;D++)k[D]=s[f++]}i.push({type:E,payloadType:a,pts:t,bytes:k})}}}}}else if(a===5&&l>16){let p=[];for(let E=0;E<16;E++){let S=s[f++].toString(16);p.push(S.length==1?"0"+S:S),(E===3||E===5||E===7||E===9)&&p.push("-")}let m=l-16,_=new Uint8Array(m);for(let E=0;E<m;E++)_[E]=s[f++];i.push({payloadType:a,pts:t,uuid:p.join(""),userData:oi(_),userDataBytes:_})}}}function uy(r){let e=r.byteLength,t=[],i=1;for(;i<e-2;)r[i]===0&&r[i+1]===0&&r[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return r;let s=e-t.length,n=new Uint8Array(s),a=0;for(i=0;i<s;a++,i++)a===t[0]&&(a++,t.shift()),n[i]=r[a];return n}function yS(r){let e=r[0],t="",i="",s=0,n=0,a=0,l=0,c=0,h=0;if(e===0){for(;Mt(r.subarray(h,h+1))!=="\0";)t+=Mt(r.subarray(h,h+1)),h+=1;for(t+=Mt(r.subarray(h,h+1)),h+=1;Mt(r.subarray(h,h+1))!=="\0";)i+=Mt(r.subarray(h,h+1)),h+=1;i+=Mt(r.subarray(h,h+1)),h+=1,s=Fe(r,12),n=Fe(r,16),l=Fe(r,20),c=Fe(r,24),h=28}else if(e===1){h+=4,s=Fe(r,h),h+=4;let p=Fe(r,h);h+=4;let m=Fe(r,h);for(h+=4,a=2**32*p+m,Xb(a)||(a=Number.MAX_SAFE_INTEGER,Ze.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=Fe(r,h),h+=4,c=Fe(r,h),h+=4;Mt(r.subarray(h,h+1))!=="\0";)t+=Mt(r.subarray(h,h+1)),h+=1;for(t+=Mt(r.subarray(h,h+1)),h+=1;Mt(r.subarray(h,h+1))!=="\0";)i+=Mt(r.subarray(h,h+1)),h+=1;i+=Mt(r.subarray(h,h+1)),h+=1}let f=r.subarray(h,r.byteLength);return{schemeIdUri:t,value:i,timeScale:s,presentationTime:a,presentationTimeDelta:n,eventDuration:l,id:c,payload:f}}function TS(r,...e){let t=e.length,i=8,s=t;for(;s--;)i+=e[s].byteLength;let n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=i&255,n.set(r,4),s=0,i=8;s<t;s++)n.set(e[s],i),i+=e[s].byteLength;return n}function _S(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let i,s;i=0,s=new Uint8Array;let n;i>0?(n=new Uint8Array(4),e.length>0&&new DataView(n.buffer).setUint32(0,e.length,!1)):n=new Uint8Array;let a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),TS([112,115,115,104],new Uint8Array([i,0,0,0]),r,n,s,a,t||new Uint8Array)}var hy=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Jr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function kf(r,e){let t=Jr[e];return!!t&&!!t[r.slice(0,4)]}function mc(r,e,t=!0){return!r.split(",").some(i=>!Rf(i,e,t))}function Rf(r,e,t=!0){var i;let s=Bs(t);return(i=s?.isTypeSupported(Xn(r,e)))!=null?i:!1}function Xn(r,e){return`${e}/mp4;codecs=${r}`}function xg(r){if(r){let e=r.substring(0,4);return Jr.video[e]}return 2}function Ko(r){let e=hy();return r.split(",").reduce((t,i)=>{let n=e&&Nl(i)?9:Jr.video[i];return n?(n*2+t)/(t?3:2):(Jr.audio[i]+t)/(t?2:1)},0)}var eh={};function ES(r,e=!0){if(eh[r])return eh[r];let t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let s=0;s<t.length;s++){var i;if(Rf(t[s],"audio",e))return eh[r]=t[s],t[s];if(t[s]==="mp3"&&(i=Bs(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return r}var bS=/flac|opus|mp4a\.40\.34/i;function qo(r,e=!0){return r.replace(bS,t=>ES(t.toLowerCase(),e))}function SS(r,e){let t=[];if(r){let i=r.split(",");for(let s=0;s<i.length;s++)kf(i[s],"video")||t.push(i[s])}return e&&t.push(e),t.join(",")}function Co(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(Og(r,"audio")||Og(r,"video")))return r;if(e){let t=e.split(",");if(t.length>1){if(r){for(let i=t.length;i--;)if(t[i].substring(0,4)===r.substring(0,4))return t[i]}return t[0]}}return e||r}function Og(r,e){return kf(r,e)&&Rf(r,e)}function CS(r){let e=r.split(",");for(let t=0;t<e.length;t++){let i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function wS(r){if(r.startsWith("av01.")){let e=r.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return r}function Mg(r){let e=Bs(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function vc(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var cy={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function dy(r,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:r}}function AS(r,e,t,i,s,n){let a=r.videoCodec,l=r.audioCodec?r.audioGroups:null,c=n?.audioCodec,h=n?.channels,f=h?parseInt(h):c?1/0:2,p=null;if(l!=null&&l.length)try{l.length===1&&l[0]?p=e.groups[l[0]].channels:p=l.reduce((m,_)=>{if(_){let E=e.groups[_];if(!E)throw new Error(`Audio track group ${_} not found`);Object.keys(E.channels).forEach(S=>{m[S]=(m[S]||0)+E.channels[S]})}return m},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(m=>Nl(m))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(i,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(s,8e6))||!!p&&Ce(f)&&Object.keys(p).some(m=>parseInt(m)>f)}function fy(r,e,t,i={}){let s=r.videoCodec;if(!s&&!r.audioCodec||!t)return Promise.resolve(cy);let n=[],a=IS(r),l=a.length,c=LS(r,e,l>0),h=c.length;for(let f=l||1*h||1;f--;){let p={type:"media-source"};if(l&&(p.video=a[f%l]),h){p.audio=c[f%h];let m=p.audio.bitrate;p.video&&m&&(p.video.bitrate-=m)}n.push(p)}if(s){let f=navigator.userAgent;if(s.split(",").some(p=>Nl(p))&&hy())return Promise.resolve(dy(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),n))}return Promise.all(n.map(f=>{let p=RS(f);return i[p]||(i[p]=t.decodingInfo(f))})).then(f=>({supported:!f.some(p=>!p.supported),configurations:n,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:n,decodingInfoResults:[],error:f}))}function IS(r){var e;let t=(e=r.videoCodec)==null?void 0:e.split(","),i=py(r),s=r.width||640,n=r.height||480,a=r.frameRate||30,l=r.videoRange.toLowerCase();return t?t.map(c=>{let h={contentType:Xn(wS(c),"video"),width:s,height:n,bitrate:i,framerate:a};return l!=="sdr"&&(h.transferFunction=l),h}):[]}function LS(r,e,t){var i;let s=(i=r.audioCodec)==null?void 0:i.split(","),n=py(r);return s&&r.audioGroups?r.audioGroups.reduce((a,l)=>{var c;let h=l?(c=e.groups[l])==null?void 0:c.tracks:null;return h?h.reduce((f,p)=>{if(p.groupId===l){let m=parseFloat(p.channels||"");s.forEach(_=>{let E={contentType:Xn(_,"audio"),bitrate:t?kS(_,n):n};m&&(E.channels=""+m),f.push(E)})}return f},a):a},[]):[]}function kS(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function py(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function RS(r){let e="",{audio:t,video:i}=r;if(i){let s=vc(i.contentType);e+=`${s}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){let s=vc(t.contentType);e+=`${i?"_":""}${s}_c${t.channels}`}return e}var yc=["NONE","TYPE-0","TYPE-1",null];function PS(r){return yc.indexOf(r)>-1}var Wo=["SDR","PQ","HLG"];function DS(r){return!!r&&Wo.indexOf(r)>-1}var wo={No:"",Yes:"YES",v2:"v2"};function Fg(r){let{canSkipUntil:e,canSkipDateRanges:t,age:i}=r,s=i<e/2;return e&&s?t?wo.v2:wo.Yes:wo.No}var zo=class{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){let t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}},hr=class{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;let i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Ng(this._audioGroups,e)}hasSubtitleGroup(e){return Ng(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}};function Ng(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function xS(){if(typeof matchMedia=="function"){let r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function OS(r,e){let t=!1,i=[];if(r&&(t=r!=="SDR",i=[r]),e){i=e.allowedVideoRanges||Wo.slice(0);let s=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&xS(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}var MS=r=>{let e=new WeakSet;return(t,i)=>{if(r&&(i=r(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},ft=(r,e)=>JSON.stringify(r,MS(e));function FS(r,e,t,i,s){let n=Object.keys(r),a=i?.channels,l=i?.audioCodec,c=s?.videoCodec,h=a&&parseInt(a)===2,f=!1,p=!1,m=1/0,_=1/0,E=1/0,S=1/0,C=0,I=[],{preferHDR:R,allowedVideoRanges:k}=OS(e,s);for(let H=n.length;H--;){let O=r[n[H]];f||(f=O.channels[2]>0),m=Math.min(m,O.minHeight),_=Math.min(_,O.minFramerate),E=Math.min(E,O.minBitrate),k.filter(G=>O.videoRanges[G]>0).length>0&&(p=!0)}m=Ce(m)?m:0,_=Ce(_)?_:0;let D=Math.max(1080,m),x=Math.max(30,_);E=Ce(E)?E:t,t=Math.max(E,t),p||(e=void 0);let N=n.length>1;return{codecSet:n.reduce((H,O)=>{let P=r[O];if(O===H)return H;if(I=p?k.filter(G=>P.videoRanges[G]>0):[],N){if(P.minBitrate>t)return Fi(O,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),H;if(!P.hasDefaultAudio)return Fi(O,"no renditions with default or auto-select sound found"),H;if(l&&O.indexOf(l.substring(0,4))%5!==0)return Fi(O,`audio codec preference "${l}" not found`),H;if(a&&!h){if(!P.channels[a])return Fi(O,`no renditions with ${a} channel sound found (channels options: ${Object.keys(P.channels)})`),H}else if((!l||h)&&f&&P.channels[2]===0)return Fi(O,"no renditions with stereo sound found"),H;if(P.minHeight>D)return Fi(O,`min resolution of ${P.minHeight} > maximum of ${D}`),H;if(P.minFramerate>x)return Fi(O,`min framerate of ${P.minFramerate} > maximum of ${x}`),H;if(!I.some(G=>P.videoRanges[G]>0))return Fi(O,`no variants with VIDEO-RANGE of ${ft(I)} found`),H;if(c&&O.indexOf(c.substring(0,4))%5!==0)return Fi(O,`video codec preference "${c}" not found`),H;if(P.maxScore<C)return Fi(O,`max score of ${P.maxScore} < selected max of ${C}`),H}return H&&(Ko(O)>=Ko(H)||P.fragmentError>r[H].fragmentError)?H:(S=P.minIndex,C=P.maxScore,O)},void 0),videoRanges:I,preferHDR:R,minFramerate:_,minBitrate:E,minIndex:S}}function Fi(r,e){Ze.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function gy(r){return r.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);let s=t.channels||"2";return i.channels[s]=(i.channels[s]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function NS(r,e,t,i){return r.slice(t,i+1).reduce((s,n,a)=>{if(!n.codecSet)return s;let l=n.audioGroups,c=s[n.codecSet];c||(s[n.codecSet]=c={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!l,fragmentError:0}),c.minBitrate=Math.min(c.minBitrate,n.bitrate);let h=Math.min(n.height,n.width);return c.minHeight=Math.min(c.minHeight,h),c.minFramerate=Math.min(c.minFramerate,n.frameRate),c.minIndex=Math.min(c.minIndex,a),c.maxScore=Math.max(c.maxScore,n.score),c.fragmentError+=n.fragmentError,c.videoRanges[n.videoRange]=(c.videoRanges[n.videoRange]||0)+1,l&&l.forEach(f=>{if(!f)return;let p=e.groups[f];p&&(c.hasDefaultAudio=c.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(m=>{c.channels[m]=(c.channels[m]||0)+p.channels[m]}))}),s},{})}function Bg(r){if(!r)return r;let{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:n}=r;return{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:n}}function qi(r,e,t){if("attrs"in r){let i=e.indexOf(r);if(i!==-1)return i}for(let i=0;i<e.length;i++){let s=e[i];if(lr(r,s,t))return i}return-1}function lr(r,e,t){let{groupId:i,name:s,lang:n,assocLang:a,default:l}=r,c=r.forced;return(i===void 0||e.groupId===i)&&(s===void 0||e.name===s)&&(n===void 0||BS(n,e.lang))&&(n===void 0||e.assocLang===a)&&(l===void 0||e.default===l)&&(c===void 0||e.forced===c)&&(!("characteristics"in r)||US(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function BS(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function US(r,e=""){let t=r.split(","),i=e.split(",");return t.length===i.length&&!t.some(s=>i.indexOf(s)===-1)}function tr(r,e){let{audioCodec:t,channels:i}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function $S(r,e,t,i,s){let n=e[i],l=e.reduce((m,_,E)=>{let S=_.uri;return(m[S]||(m[S]=[])).push(E),m},{})[n.uri];l.length>1&&(i=Math.max.apply(Math,l));let c=n.videoRange,h=n.frameRate,f=n.codecSet.substring(0,4),p=Ug(e,i,m=>{if(m.videoRange!==c||m.frameRate!==h||m.codecSet.substring(0,4)!==f)return!1;let _=m.audioGroups,E=t.filter(S=>!_||_.indexOf(S.groupId)!==-1);return qi(r,E,s)>-1});return p>-1?p:Ug(e,i,m=>{let _=m.audioGroups,E=t.filter(S=>!_||_.indexOf(S.groupId)!==-1);return qi(r,E,s)>-1})}function Ug(r,e,t){for(let i=e;i>-1;i--)if(t(r[i]))return i;for(let i=e+1;i<r.length;i++)if(t(r[i]))return i;return-1}function Yo(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}var Tc=class extends li{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;let{fragCurrent:s,partCurrent:n,hls:a}=this,{autoLevelEnabled:l,media:c}=a;if(!s||!c)return;let h=performance.now(),f=n?n.stats:s.stats,p=n?n.duration:s.duration,m=h-f.loading.start,_=a.minAutoLevel,E=s.level,S=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||E<=_){this.clearTimer(),this._nextAutoLevel=-1;return}if(!l)return;let C=S>-1&&S!==E,I=!!t||C;if(!I&&(c.paused||!c.playbackRate||!c.readyState))return;let R=a.mainForwardBufferInfo;if(!I&&R===null)return;let k=this.bwEstimator.getEstimateTTFB(),D=Math.abs(c.playbackRate);if(m<=Math.max(k,1e3*(p/(D*2))))return;let x=R?R.len/D:0,N=f.loading.first?f.loading.first-f.loading.start:-1,B=f.loaded&&N>-1,H=this.getBwEstimate(),O=a.levels,P=O[E],G=Math.max(f.loaded,Math.round(p*(s.bitrate||P.averageBitrate)/8)),Q=B?m-N:m;Q<1&&B&&(Q=Math.min(m,f.loaded*8/H));let ie=B?f.loaded*1e3/Q:0,te=k/1e3,re=ie?(G-f.loaded)/ie:G*8/H+te;if(re<=x)return;let ne=ie?ie*8:H,de=((i=t?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,Z=this.hls.config.abrBandWidthUpFactor,ae=Number.POSITIVE_INFINITY,se;for(se=E-1;se>_;se--){let be=O[se].maxBitrate,Ee=!O[se].details||de;if(ae=this.getTimeToLoadFrag(te,ne,p*be,Ee),ae<Math.min(x,p+te))break}if(ae>=re||ae>p*10)return;B?this.bwEstimator.sample(m-Math.min(k,N),f.loaded):this.bwEstimator.sampleTTFB(m);let oe=O[se].maxBitrate;this.getBwEstimate()*Z>oe&&this.resetEstimator(oe);let Y=this.findBestLevel(oe,_,se,0,x,1,1);Y>-1&&(se=Y),this.warn(`Fragment ${s.sn}${n?" part "+n.index:""} of level ${E} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${x.toFixed(3)} s
      Estimated load time for current fragment: ${re.toFixed(3)} s
      Estimated load time for down switch fragment: ${ae.toFixed(3)} s
      TTFB estimate: ${N|0} ms
      Current BW estimate: ${Ce(H)?H|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${se} @ ${oe|0} bps`),a.nextLoadLevel=a.nextAutoLevel=se,this.clearTimer();let ee=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===se&&se>0){let be=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${se>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${be.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,se>_){let Ee=this.findBestLevel(this.hls.levels[_].bitrate,_,se,0,be,1,1);Ee===-1&&(Ee=_),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Ee,this.resetEstimator(this.hls.levels[Ee].bitrate)}}};C||re>ae*2?ee():this.timer=self.setInterval(ee,ae*1e3),a.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:n,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){let e=this.hls.config;return new dc(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){let{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){let i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case z.FRAG_LOAD_TIMEOUT:{let i=t.frag,{fragCurrent:s,partCurrent:n}=this;if(i&&s&&i.sn===s.sn&&i.level===s.level){let a=performance.now(),l=n?n.stats:i.stats,c=a-l.loading.start,h=l.loading.first?l.loading.first-l.loading.start:-1;if(l.loaded&&h>-1){let p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(c-Math.min(p,h),l.loaded)}else this.bwEstimator.sampleTTFB(c)}break}}}getTimeToLoadFrag(e,t,i,s){let n=e+i/t,a=s?e+this.lastLevelLoadSec:0;return n+a}onLevelLoaded(e,t){let i=this.hls.config,{loading:s}=t.stats,n=s.end-s.first;Ce(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){let s=i?i.stats:t.stats;if(t.type===Ae.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){let n=i?i.duration:t.duration,a=this.hls.levels[t.level],l=(a.loaded?a.loaded.bytes:0)+s.loaded,c=(a.loaded?a.loaded.duration:0)+n;a.loaded={bytes:l,duration:c},a.realBitrate=Math.round(8*l/c)}if(t.bitrateTest){let n={stats:s,frag:t,part:i,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,n),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){let{frag:i,part:s}=t,n=s!=null&&s.stats.loaded?s.stats:i.stats;if(n.aborted||this.ignoreFragment(i))return;let a=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ae.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){let{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,n=this.findBestLevel(i,t,e,0,s,1,1);if(n>-1)return n;let a=this.hls.firstLevel,l=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${l}`),l}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){let e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;let n=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){let a=this.hls.levels;if(a.length>Math.max(e,n)&&a[e].loadError<=a[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;let{maxAutoLevel:s,config:n,minAutoLevel:a}=i,l=t?t.duration:e?e.duration:0,c=this.getBwEstimate(),h=this.getStarvationDelay(),f=n.abrBandWidthFactor,p=n.abrBandWidthUpFactor;if(h){let C=this.findBestLevel(c,a,s,h,0,f,p);if(C>=0)return this.rebufferNotice=-1,C}let m=l?Math.min(l,n.maxStarvationDelay):n.maxStarvationDelay;if(!h){let C=this.bitrateTestDelay;C&&(m=(l?Math.min(l,n.maxLoadingDelay):n.maxLoadingDelay)-C,this.info(`bitrate test took ${Math.round(1e3*C)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),f=p=1)}let _=this.findBestLevel(c,a,s,h,m,f,p);if(this.rebufferNotice!==_&&(this.rebufferNotice=_,this.info(`${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${_}`)),_>-1)return _;let E=i.levels[a],S=i.loadLevelObj;return S&&E?.bitrate<S.bitrate?a:i.loadLevel}getStarvationDelay(){let e=this.hls,t=e.media;if(!t)return 1/0;let i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,s,n,a,l){var c;let h=s+n,f=this.lastLoadedFragLevel,p=f===-1?this.hls.firstLevel:f,{fragCurrent:m,partCurrent:_}=this,{levels:E,allAudioTracks:S,loadLevel:C,config:I}=this.hls;if(E.length===1)return 0;let R=E[p],k=!!((c=this.hls.latestLevelDetails)!=null&&c.live),D=C===-1||f===-1,x,N="SDR",B=R?.frameRate||0,{audioPreference:H,videoPreference:O}=I,P=this.audioTracksByGroup||(this.audioTracksByGroup=gy(S)),G=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;let de=this.codecTiers||(this.codecTiers=NS(E,P,t,i)),Z=FS(de,N,e,H,O),{codecSet:ae,videoRanges:se,minFramerate:oe,minBitrate:Y,minIndex:ee,preferHDR:be}=Z;G=ee,x=ae,N=be?se[se.length-1]:se[0],B=oe,e=Math.max(e,Y),this.log(`picked start tier ${ft(Z)}`)}else x=R?.codecSet,N=R?.videoRange;let Q=_?_.duration:m?m.duration:0,ie=this.bwEstimator.getEstimateTTFB()/1e3,te=[];for(let de=i;de>=t;de--){var re,ne;let Z=E[de],ae=de>p;if(!Z)continue;if(I.useMediaCapabilities&&!Z.supportedResult&&!Z.supportedPromise){let Re=navigator.mediaCapabilities;typeof Re?.decodingInfo=="function"&&AS(Z,P,N,B,e,H)?(Z.supportedPromise=fy(Z,P,Re,this.supportedCache),Z.supportedPromise.then(Oe=>{if(!this.hls)return;Z.supportedResult=Oe;let Pe=this.hls.levels,Be=Pe.indexOf(Z);Oe.error?this.warn(`MediaCapabilities decodingInfo error: "${Oe.error}" for level ${Be} ${ft(Oe)}`):Oe.supported?Oe.decodingInfoResults.some(Ve=>Ve.smooth===!1||Ve.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Be} not smooth or powerEfficient: ${ft(Oe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Be} ${ft(Oe)}`),Be>-1&&Pe.length>1&&(this.log(`Removing unsupported level ${Be}`),this.hls.removeLevel(Be),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):Z.supportedResult=cy}if((x&&Z.codecSet!==x||N&&Z.videoRange!==N||ae&&B>Z.frameRate||!ae&&B>0&&B<Z.frameRate||(re=Z.supportedResult)!=null&&(ne=re.decodingInfoResults)!=null&&ne.some(Re=>Re.smooth===!1))&&(!D||de!==G)){te.push(de);continue}let se=Z.details,oe=(_?se?.partTarget:se?.averagetargetduration)||Q,Y;ae?Y=l*e:Y=a*e;let ee=Q&&s>=Q*2&&n===0?Z.averageBitrate:Z.maxBitrate,be=this.getTimeToLoadFrag(ie,Y,ee*oe,se===void 0);if(Y>=ee&&(de===f||Z.loadError===0&&Z.fragmentError===0)&&(be<=ie||!Ce(be)||k&&!this.bitrateTestDelay||be<h)){let Re=this.forcedAutoLevel;return de!==C&&(Re===-1||Re!==C)&&(te.length&&this.trace(`Skipped level(s) ${te.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${E[te[0]].codecs}" ${E[te[0]].videoRange}; not compatible with "${x}" ${N}`),this.info(`switch candidate:${p}->${de} adjustedbw(${Math.round(Y)})-bitrate=${Math.round(Y-ee)} ttfb:${ie.toFixed(1)} avgDuration:${oe.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${be.toFixed(1)} firstSelection:${D} codecSet:${Z.codecSet} videoRange:${Z.videoRange} hls.loadLevel:${C}`)),D&&(this.firstSelection=de),de}}return-1}set nextAutoLevel(e){let t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){let{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}},my={search:function(r,e){let t=0,i=r.length-1,s=null,n=null;for(;t<=i;){s=(t+i)/2|0,n=r[s];let a=e(n);if(a>0)t=s+1;else if(a<0)i=s-1;else return n}return null}};function HS(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!Ce(e))return null;let i=r[0].programDateTime;if(e<(i||0))return null;let s=r[r.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let n=0;n<r.length;++n){let a=r[n];if(VS(e,t,a))return a}return null}function cr(r,e,t=0,i=0,s=.005){let n=null;if(r){n=e[1+r.sn-e[0].sn]||null;let l=r.endDTS-t;l>0&&l<15e-7&&(t+=15e-7),n&&r.level!==n.level&&n.end<=r.end&&(n=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(n=e[0]);if(n&&((!r||r.level===n.level)&&$g(t,i,n)===0||jS(n,r,Math.min(s,i))))return n;let a=my.search(e,$g.bind(null,t,i));return a&&(a!==r||!n)?a:n}function jS(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){let i=e.tagList.reduce((s,n)=>(n[0]==="INF"&&(s+=parseFloat(n[1])),s),t);return r.start<=i}return!1}function $g(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;let i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=r?1:t.start-i>r&&t.start?-1:0}function VS(r,e,t){let i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>r}function vy(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let i=r.fragments,{fragmentHint:s}=r;s&&(i=i.concat(s));let n;return my.search(i,a=>a.cc<e?1:a.cc>e?-1:(n=a,a.end<=t?1:a.start>t?-1:0)),n||null}return null}function Xo(r){switch(r.details){case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_TIMEOUT:case z.LEVEL_LOAD_TIMEOUT:case z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Hg(r,e){let t=Xo(e);return r.default[`${t?"timeout":"error"}Retry`]}function Pf(r,e){let t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function jg(r){return rt(rt({},r),{errorRetry:null,timeoutRetry:null})}function Qo(r,e,t,i){if(!r)return!1;let s=i?.code,n=e<r.maxNumRetry&&(GS(s)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,i,n):n}function GS(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}var jt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ai={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2},_c=class extends li{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){let e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){let e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===Ae.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;let s=this.hls,n=t.context;switch(t.details){case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case z.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Qn();return}case z.FRAG_GAP:case z.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=jt.SendAlternateToPenaltyBox;return}case z.LEVEL_EMPTY_ERROR:case z.LEVEL_PARSING_ERROR:{var a,l;let h=t.parent===Ae.MAIN?t.level:s.loadLevel;t.details===z.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(l=a.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:typeof n?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level));return;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.SUBTITLE_LOAD_ERROR:case z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){let h=s.loadLevelObj;if(h&&(n.type===Ge.AUDIO_TRACK&&h.hasAudioGroup(n.groupId)||n.type===Ge.SUBTITLE_TRACK&&h.hasSubtitleGroup(n.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=jt.SendAlternateToPenaltyBox,t.errorAction.flags=Ai.MoveAllAlternatesMatchingHost;return}}return;case z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{let h=s.loadLevelObj,f=h?.attrs["HDCP-LEVEL"];f?t.errorAction={action:jt.SendAlternateToPenaltyBox,flags:Ai.MoveAllAlternatesMatchingHDCP,hdcpLevel:f}:this.keySystemError(t)}return;case z.BUFFER_ADD_CODEC_ERROR:case z.REMUX_ALLOC_ERROR:case z.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:s.loadLevel)}return;case z.INTERNAL_EXCEPTION:case z.BUFFER_APPENDING_ERROR:case z.BUFFER_FULL_ERROR:case z.LEVEL_SWITCH_ERROR:case z.BUFFER_STALLED_ERROR:case z.BUFFER_SEEK_OVER_HOLE:case z.BUFFER_NUDGE_ON_STALL:t.errorAction=Qn();return}t.type===Le.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){let t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){let i=this.hls,s=Hg(i.config.playlistLoadPolicy,e),n=this.playlistError++;if(Qo(s,n,Xo(e),e.response))return{action:jt.RetryRequest,flags:Ai.None,retryConfig:s,retryCount:n};let l=this.getLevelSwitchAction(e,t);return s&&(l.retryConfig=s,l.retryCount=n),l}getFragRetryOrSwitchAction(e){let t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],{fragLoadPolicy:n,keyLoadPolicy:a}=t.config,l=Hg(e.details.startsWith("key")?a:n,e),c=t.levels.reduce((f,p)=>f+p.fragmentError,0);if(s&&(e.details!==z.FRAG_GAP&&s.fragmentError++,Qo(l,c,Xo(e),e.response)))return{action:jt.RetryRequest,flags:Ai.None,retryConfig:l,retryCount:c};let h=this.getLevelSwitchAction(e,i);return l&&(h.retryConfig=l,h.retryCount=c),h}getLevelSwitchAction(e,t){let i=this.hls;t==null&&(t=i.loadLevel);let s=this.hls.levels[t];if(s){var n,a;let h=e.details;s.loadError++,h===z.BUFFER_APPEND_ERROR&&s.fragmentError++;let f=-1,{levels:p,loadLevel:m,minAutoLevel:_,maxAutoLevel:E}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);let S=(n=e.frag)==null?void 0:n.type,I=(S===Ae.AUDIO&&h===z.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(h===z.BUFFER_ADD_CODEC_ERROR||h===z.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:N})=>s.audioCodec!==N),k=e.sourceBufferName==="video"&&(h===z.BUFFER_ADD_CODEC_ERROR||h===z.BUFFER_APPEND_ERROR)&&p.some(({codecSet:N,audioCodec:B})=>s.codecSet!==N&&s.audioCodec===B),{type:D,groupId:x}=(a=e.context)!=null?a:{};for(let N=p.length;N--;){let B=(N+m)%p.length;if(B!==m&&B>=_&&B<=E&&p[B].loadError===0){var l,c;let H=p[B];if(h===z.FRAG_GAP&&S===Ae.MAIN&&e.frag){let O=p[B].details;if(O){let P=cr(e.frag,O.fragments,e.frag.start);if(P!=null&&P.gap)continue}}else{if(D===Ge.AUDIO_TRACK&&H.hasAudioGroup(x)||D===Ge.SUBTITLE_TRACK&&H.hasSubtitleGroup(x))continue;if(S===Ae.AUDIO&&(l=s.audioGroups)!=null&&l.some(O=>H.hasAudioGroup(O))||S===Ae.SUBTITLE&&(c=s.subtitleGroups)!=null&&c.some(O=>H.hasSubtitleGroup(O))||I&&s.audioCodec===H.audioCodec||!I&&s.audioCodec!==H.audioCodec||k&&s.codecSet===H.codecSet)continue}f=B;break}}if(f>-1&&i.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:jt.SendAlternateToPenaltyBox,flags:Ai.None,nextAutoLevel:f}}return{action:jt.SendAlternateToPenaltyBox,flags:Ai.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case jt.DoNothing:break;case jt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==z.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){let t=this.hls,i=e.errorAction;if(!i)return;let{flags:s,hdcpLevel:n,nextAutoLevel:a}=i;switch(s){case Ai.None:this.switchLevel(e,a);break;case Ai.MoveAllAlternatesMatchingHDCP:n&&(t.maxHdcpLevel=yc[yc.indexOf(n)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===z.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){let i=vc(e.mimeType),s=this.hls.levels;for(let n=s.length;n--;)s[n][`${e.sourceBufferName}Codec`]===i&&this.hls.removeLevel(n)}}};function Qn(r){let e={action:jt.DoNothing,flags:Ai.None};return r&&(e.resolved=!0),e}var Rt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Ec=class{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){let{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){let i=this.activePartLists[t];if(i)for(let s=i.length;s--;){let n=i[s];if(!n)break;let a=n.end;if(n.start<=e&&a!==null&&e<=a)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){let{fragments:s}=this,n=Object.keys(s);for(let a=n.length;a--;){let l=s[n[a]];if(l?.body.type===t&&(!i||l.buffered)){let c=l.body;if(c.start<=e&&e<=c.end)return c}}return null}detectEvictedFragments(e,t,i,s,n){this.timeRanges&&(this.timeRanges[e]=t);let a=s?.fragment.sn||-1;Object.keys(this.fragments).forEach(l=>{let c=this.fragments[l];if(!c||a>=c.body.sn)return;if(!c.buffered&&(!c.loaded||n)){c.body.type===i&&this.removeFragment(c.body);return}let h=c.range[e];if(h){if(h.time.length===0){this.removeFragment(c.body);return}h.time.some(f=>{let p=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return p&&this.removeFragment(c.body),p})}})}detectPartialFragments(e){let t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;let i=e.frag,s=Dr(i),n=this.fragments[s];if(!n||n.buffered&&i.gap)return;let a=!i.relurl;Object.keys(t).forEach(l=>{let c=i.elementaryStreams[l];if(!c)return;let h=t[l],f=a||c.partial===!0;n.range[l]=this.getBufferedTimes(i,e.part,f,h)}),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,(n.body.endList=i.endList||n.body.endList)&&(this.endListFragments[n.body.type]=n),Za(n)||this.removeParts(i.sn-1,i.type)):this.removeFragment(n.body)}removeParts(e,t){let i=this.activePartLists[t];i&&(this.activePartLists[t]=Vg(i,s=>s.fragment.sn>=e))}fragBuffered(e,t){let i=Dr(e),s=this.fragments[i];!s&&t&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,i,s){let n={time:[],partial:i},a=e.start,l=e.end,c=e.minEndPTS||l,h=e.maxStartPTS||a;for(let f=0;f<s.length;f++){let p=s.start(f)-this.bufferPadding,m=s.end(f)+this.bufferPadding;if(h>=p&&c<=m){n.time.push({startPTS:Math.max(a,s.start(f)),endPTS:Math.min(l,s.end(f))});break}else if(a<m&&l>p){let _=Math.max(a,s.start(f)),E=Math.min(l,s.end(f));E>_&&(n.partial=!0,n.time.push({startPTS:_,endPTS:E}))}else if(l<=p)break}return n}getPartialFragment(e){let t=null,i,s,n,a=0,{bufferPadding:l,fragments:c}=this;return Object.keys(c).forEach(h=>{let f=c[h];f&&Za(f)&&(s=f.body.start-l,n=f.body.end+l,e>=s&&e<=n&&(i=Math.min(e-s,n-e),a<=i&&(t=f.body,a=i)))}),t}isEndListAppended(e){let t=this.endListFragments[e];return t!==void 0&&(t.buffered||Za(t))}getState(e){let t=Dr(e),i=this.fragments[t];return i?i.buffered?Za(i)?Rt.PARTIAL:Rt.OK:Rt.APPENDING:Rt.NOT_LOADED}isTimeBuffered(e,t,i){let s,n;for(let a=0;a<i.length;a++){if(s=i.start(a)-this.bufferPadding,n=i.end(a)+this.bufferPadding,e>=s&&t<=n)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;let i=t.frag,s=t.part?null:t,n=Dr(i);this.fragments[n]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){let{frag:i,part:s,timeRanges:n,type:a}=t;if(i.sn==="initSegment")return;let l=i.type;if(s){let h=this.activePartLists[l];h||(this.activePartLists[l]=h=[]),h.push(s)}this.timeRanges=n;let c=n[a];this.detectEvictedFragments(a,c,l,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){let t=Dr(e);return!!this.fragments[t]}hasFragments(e){let{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let s=i.length;s--;){let n=t[i[s]];if(n?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,s,n){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{let l=this.fragments[a];if(!l)return;let c=l.body;c.type!==i||s&&!c.gap||c.start<t&&c.end>e&&(l.buffered||n)&&this.removeFragment(c)})}removeFragment(e){let t=Dr(e);e.clearElementaryStreamInfo();let i=this.activePartLists[e.type];if(i){let s=e.sn;this.activePartLists[e.type]=Vg(i,n=>n.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;let i=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;i&&i.forEach(s=>s.clearElementaryStreamInfo())}};function Za(r){var e,t,i;return r.buffered&&(r.body.gap||((e=r.range.video)==null?void 0:e.partial)||((t=r.range.audio)==null?void 0:t.partial)||((i=r.range.audiovideo)==null?void 0:i.partial))}function Dr(r){return`${r.type}_${r.level}_${r.sn}`}function Vg(r,e){return r.filter(t=>{let i=e(t);return i||t.clearElementaryStreamInfo(),i})}var Us={cbc:0,ctr:1},bc=class{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case Us.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Us.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}};function KS(r){let e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}var Sc=class{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){let t=new DataView(e),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=t.getUint32(s*4);return i}initTable(){let e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],n=i[1],a=i[2],l=i[3],c=this.invSubMix,h=c[0],f=c[1],p=c[2],m=c[3],_=new Uint32Array(256),E=0,S=0,C=0;for(C=0;C<256;C++)C<128?_[C]=C<<1:_[C]=C<<1^283;for(C=0;C<256;C++){let I=S^S<<1^S<<2^S<<3^S<<4;I=I>>>8^I&255^99,e[E]=I,t[I]=E;let R=_[E],k=_[R],D=_[k],x=_[I]*257^I*16843008;s[E]=x<<24|x>>>8,n[E]=x<<16|x>>>16,a[E]=x<<8|x>>>24,l[E]=x,x=D*16843009^k*65537^R*257^E*16843008,h[I]=x<<24|x>>>8,f[I]=x<<16|x>>>16,p[I]=x<<8|x>>>24,m[I]=x,E?(E=R^_[_[_[D^R]]],S^=_[_[S]]):E=S=1}}expandKey(e){let t=this.uint8ArrayToUint32Array_(e),i=!0,s=0;for(;s<t.length&&i;)i=t[s]===this.key[s],s++;if(i)return;this.key=t;let n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);let a=this.ksRows=(n+6+1)*4,l,c,h=this.keySchedule=new Uint32Array(a),f=this.invKeySchedule=new Uint32Array(a),p=this.sBox,m=this.rcon,_=this.invSubMix,E=_[0],S=_[1],C=_[2],I=_[3],R,k;for(l=0;l<a;l++){if(l<n){R=h[l]=t[l];continue}k=R,l%n===0?(k=k<<8|k>>>24,k=p[k>>>24]<<24|p[k>>>16&255]<<16|p[k>>>8&255]<<8|p[k&255],k^=m[l/n|0]<<24):n>6&&l%n===4&&(k=p[k>>>24]<<24|p[k>>>16&255]<<16|p[k>>>8&255]<<8|p[k&255]),h[l]=R=(h[l-n]^k)>>>0}for(c=0;c<a;c++)l=a-c,c&3?k=h[l]:k=h[l-4],c<4||l<=4?f[c]=k:f[c]=E[p[k>>>24]]^S[p[k>>>16&255]]^C[p[k>>>8&255]]^I[p[k&255]],f[c]=f[c]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){let s=this.keySize+6,n=this.invKeySchedule,a=this.invSBox,l=this.invSubMix,c=l[0],h=l[1],f=l[2],p=l[3],m=this.uint8ArrayToUint32Array_(i),_=m[0],E=m[1],S=m[2],C=m[3],I=new Int32Array(e),R=new Int32Array(I.length),k,D,x,N,B,H,O,P,G,Q,ie,te,re,ne,de=this.networkToHostOrderSwap;for(;t<I.length;){for(G=de(I[t]),Q=de(I[t+1]),ie=de(I[t+2]),te=de(I[t+3]),B=G^n[0],H=te^n[1],O=ie^n[2],P=Q^n[3],re=4,ne=1;ne<s;ne++)k=c[B>>>24]^h[H>>16&255]^f[O>>8&255]^p[P&255]^n[re],D=c[H>>>24]^h[O>>16&255]^f[P>>8&255]^p[B&255]^n[re+1],x=c[O>>>24]^h[P>>16&255]^f[B>>8&255]^p[H&255]^n[re+2],N=c[P>>>24]^h[B>>16&255]^f[H>>8&255]^p[O&255]^n[re+3],B=k,H=D,O=x,P=N,re=re+4;k=a[B>>>24]<<24^a[H>>16&255]<<16^a[O>>8&255]<<8^a[P&255]^n[re],D=a[H>>>24]<<24^a[O>>16&255]<<16^a[P>>8&255]<<8^a[B&255]^n[re+1],x=a[O>>>24]<<24^a[P>>16&255]<<16^a[B>>8&255]<<8^a[H&255]^n[re+2],N=a[P>>>24]<<24^a[B>>16&255]<<16^a[H>>8&255]<<8^a[O&255]^n[re+3],R[t]=de(k^_),R[t+1]=de(N^E),R[t+2]=de(x^S),R[t+3]=de(D^C),_=G,E=Q,S=ie,C=te,t=t+4}return R.buffer}},Cc=class{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){let e=qS(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}};function qS(r){switch(r){case Us.cbc:return"AES-CBC";case Us.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}var WS=16,Jn=class{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{let i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){let{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;let i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?KS(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,s){return this.useSoftware?new Promise((n,a)=>{let l=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(l,t,i,s);let c=this.flush();c?n(c.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,s)}softwareDecrypt(e,t,i,s){let{currentIV:n,currentResult:a,remainderData:l}=this;if(s!==Us.cbc||t.byteLength!==16)return Ze.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),l&&(e=yi(l,e),this.remainderData=null);let c=this.getValidChunk(e);if(!c.length)return null;n&&(i=n);let h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new Sc),h.expandKey(t);let f=a;return this.currentResult=h.decrypt(c.buffer,0,i),this.currentIV=c.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,i,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,s));this.key=t,this.fastAesKey=new Cc(this.subtle,t,s)}return this.fastAesKey.expandKey().then(n=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new bc(this.subtle,new Uint8Array(i),s).decrypt(e.buffer,n)):Promise.reject(new Error("web crypto not initialized"))).catch(n=>(Ze.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,i,s)))}onWebCryptoError(e,t,i,s){let n=this.enableSoftwareAES;if(n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,s);let a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(n?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e,i=e.length-e.length%WS;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Ze.log(`[decrypter]: ${e}`),this.logEnabled=!1)}},Gg=Math.pow(2,17),wc=class{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){let i=e.url;if(!i)return Promise.reject(new Ii({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();let s=this.config,n=s.fLoader,a=s.loader;return new Promise((l,c)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(E=>E[0]==="GAP")){c(qg(e));return}else e.gap=!1;let h=this.loader=n?new n(s):new a(s),f=Kg(e);e.loader=h;let p=jg(s.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Gg};e.stats=h.stats;let _={onSuccess:(E,S,C,I)=>{this.resetLoader(e,h);let R=E.data;C.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),l({frag:e,part:null,payload:R,networkDetails:I})},onError:(E,S,C,I)=>{this.resetLoader(e,h),c(new Ii({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:rt({url:i,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:C,stats:I}))},onAbort:(E,S,C)=>{this.resetLoader(e,h),c(new Ii({type:Le.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:C,stats:E}))},onTimeout:(E,S,C)=>{this.resetLoader(e,h),c(new Ii({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:C,stats:E}))}};t&&(_.onProgress=(E,S,C,I)=>t({frag:e,part:null,payload:C,networkDetails:I})),h.load(f,m,_)})}loadPart(e,t,i){this.abort();let s=this.config,n=s.fLoader,a=s.loader;return new Promise((l,c)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){c(qg(e,t));return}let h=this.loader=n?new n(s):new a(s),f=Kg(e,t);e.loader=h;let p=jg(s.fragLoadPolicy.default),m={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Gg};t.stats=h.stats,h.load(f,m,{onSuccess:(_,E,S,C)=>{this.resetLoader(e,h),this.updateStatsFromPart(e,t);let I={frag:e,part:t,payload:_.data,networkDetails:C};i(I),l(I)},onError:(_,E,S,C)=>{this.resetLoader(e,h),c(new Ii({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:rt({url:f.url,data:void 0},_),error:new Error(`HTTP Error ${_.code} ${_.text}`),networkDetails:S,stats:C}))},onAbort:(_,E,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,h),c(new Ii({type:Le.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:_}))},onTimeout:(_,E,S)=>{this.resetLoader(e,h),c(new Ii({type:Le.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${m.timeout}ms`),networkDetails:S,stats:_}))}})})}updateStatsFromPart(e,t){let i=e.stats,s=t.stats,n=s.total;if(i.loaded+=s.loaded,n){let c=Math.round(e.duration/t.duration),h=Math.min(Math.round(i.loaded/n),c),p=(c-h)*Math.round(i.loaded/h);i.total=i.loaded+p}else i.total=Math.max(i.loaded,i.total);let a=i.loading,l=s.loading;a.start?a.first+=l.first-l.start:(a.start=l.start,a.first=l.first),a.end=l.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}};function Kg(r,e=null){let t=e||r,i={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,n=t.byteRangeEndOffset;if(Ce(s)&&Ce(n)){var a;let l=s,c=n;if(r.sn==="initSegment"&&zS((a=r.decryptdata)==null?void 0:a.method)){let h=n-s;h%16&&(c=n+(16-h%16)),s!==0&&(i.resetIV=!0,l=s-16)}i.rangeStart=l,i.rangeEnd=c}return i}function qg(r,e){let t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),i={type:Le.MEDIA_ERROR,details:z.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(i.part=e),(e||r).stats.aborted=!0,new Ii(i)}function zS(r){return r==="AES-128"||r==="AES-256"}var Ii=class extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}},Jo=class extends li{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}},Zn=class{constructor(e,t,i,s=0,n=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=eo(),this.buffering={audio:eo(),video:eo(),audiovideo:eo()},this.level=e,this.sn=t,this.id=i,this.size=s,this.part=n,this.partial=a}};function eo(){return{start:0,executeStart:0,executeEnd:0,end:0}}var Wg={length:0,start:()=>0,end:()=>0},He=class r{static isBuffered(e,t){if(e){let i=r.getBuffered(e);for(let s=i.length;s--;)if(t>=i.start(s)&&t<=i.end(s))return!0}return!1}static bufferedRanges(e){if(e){let t=r.getBuffered(e);return r.timeRangesToArray(t)}return[]}static timeRangesToArray(e){let t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){let s=r.bufferedRanges(e);if(s.length)return r.bufferedInfo(s,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((f,p)=>f.start-p.start||p.end-f.end);let s=-1,n=[];if(i)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(s=f);let p=n.length;if(p){let m=n[p-1].end;e[f].start-m<i?e[f].end>m&&(n[p-1].end=e[f].end):n.push(e[f])}else n.push(e[f])}else n=e;let a=0,l,c=t,h=t;for(let f=0;f<n.length;f++){let p=n[f].start,m=n[f].end;if(s===-1&&t>=p&&t<=m&&(s=f),t+i>=p&&t<m)c=p,h=m,a=h-t;else if(t+i<p){l=p;break}}return{len:a,start:c||0,end:h||0,nextStart:l,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Wg}catch(t){return Ze.log("failed to get media.buffered",t),Wg}}},yy=/\{\$([a-zA-Z0-9-_]+)\}/g;function zg(r){return yy.test(r)}function Ac(r,e){if(r.variableList!==null||r.hasVariableRefs){let t=r.variableList;return e.replace(yy,i=>{let s=i.substring(2,i.length-1),n=t?.[s];return n===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):n})}return e}function Yg(r,e,t){let i=r.variableList;i||(r.variableList=i={});let s,n;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{let a=new self.URL(t).searchParams;if(a.has(s))n=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,n=e.VALUE;s in i?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=n||""}function YS(r,e,t){let i=e.IMPORT;if(t&&i in t){let s=r.variableList;s||(r.variableList=s={}),s[i]=t[i]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}var XS=/^(\d+)x(\d+)$/,Xg=/(.+?)=(".*?"|.*?)(?:,|$)/g,gt=class r{constructor(e,t){typeof e=="string"&&(e=r.parseAttrList(e,t)),it(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){let t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;let i=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)i[s]=parseInt(t.slice(s*2,s*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){let t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){let i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){let i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((s,n)=>(s[n.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){let t=XS.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i,s={},n='"';for(Xg.lastIndex=0;(i=Xg.exec(e))!==null;){let a=i[1].trim(),l=i[2],c=l.indexOf(n)===0&&l.lastIndexOf(n)===l.length-1,h=!1;if(c)l=l.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":h=!0}if(t&&(c||h))l=Ac(t,l);else if(!h&&!c)switch(a){case"CLOSED-CAPTIONS":if(l==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ze.warn(`${e}: attribute ${a} is missing quotes`)}s[a]=l}return s}},QS="com.apple.hls.interstitial";function JS(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function ZS(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}var Zo=class{constructor(e,t,i=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(s=t?.tagOrder)!=null?s:i,t){let n=t.attr;for(let a in n)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==n[a]){Ze.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=it(new gt({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){let n=t?.endDate||new Date(this.attr["END-DATE"]);Ce(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){let e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){let{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ze.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){let e=this._endDate||this._dateAtEnd;if(e)return e;let t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){let e=this.attr.decimalFloatingPoint("DURATION");if(Ce(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===QS}get isValid(){return!!this.id&&!this._badValueForSameId&&Ce(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}},e0=10,Ic=class{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}let t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?Ce(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||e0}get drift(){let e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){let e=this.partList;if(e){let t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){let e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}};function Kr(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function Df(r){switch(r){case"AES-128":case"AES-256":return Us.cbc;case"AES-256-CTR":return Us.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function Ty(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function Lc(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function t0(r){let e=Lc(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function i0(r){let e=function(i,s,n){let a=i[s];i[s]=i[n],i[n]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function s0(r){let e=r.split(":"),t=null;if(e[0]==="data"&&e.length===2){let i=e[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){let n=s[0]==="base64",a=s[1];n?(i.splice(-1,1),t=Ty(a)):t=t0(a)}}return t}var el=typeof self<"u"?self:void 0,_t={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ri={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function kc(r){switch(r){case ri.FAIRPLAY:return _t.FAIRPLAY;case ri.PLAYREADY:return _t.PLAYREADY;case ri.WIDEVINE:return _t.WIDEVINE;case ri.CLEARKEY:return _t.CLEARKEY}}function Qg(r){switch(r){case _t.FAIRPLAY:return ri.FAIRPLAY;case _t.PLAYREADY:return ri.PLAYREADY;case _t.WIDEVINE:return ri.WIDEVINE;case _t.CLEARKEY:return ri.CLEARKEY}}function Ao(r){let{drmSystems:e,widevineLicenseUrl:t}=r,i=e?[_t.FAIRPLAY,_t.WIDEVINE,_t.PLAYREADY,_t.CLEARKEY].filter(s=>!!e[s]):[];return!i[_t.WIDEVINE]&&t&&i.push(_t.WIDEVINE),i}var _y=function(r){return el!=null&&(r=el.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function r0(r,e,t,i){let s;switch(r){case _t.FAIRPLAY:s=["cenc","sinf"];break;case _t.WIDEVINE:case _t.PLAYREADY:s=["cenc"];break;case _t.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return n0(s,e,t,i)}function n0(r,e,t,i){return[{initDataTypes:r,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(n=>({contentType:`audio/mp4; codecs=${n}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(n=>({contentType:`video/mp4; codecs=${n}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function a0(r){var e;return r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function o0(r){let e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(a){let l=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(l){let c=Ty(l).subarray(0,16);return i0(c),c}}return null}var to={},tl=class r{static clearKeyUriToKeyIdMap(){to={}}constructor(e,t,i,s=[1],n=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=s,this.iv=n,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Kr(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(sy(a)))}matches(e){var t,i;return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&e.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((t=e.iv)==null?void 0:t.join(","))===((i=this.iv)==null?void 0:i.join(","))}isSupported(){if(this.method){if(Kr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ri.FAIRPLAY:case ri.WIDEVINE:case ri.PLAYREADY:case ri.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(Kr(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Ze.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);let i=l0(e);return new r(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.pssh&&this.keyId)return this;let t=s0(this.uri);if(t)switch(this.keyFormat){case ri.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){let i=t.length-22;this.keyId=t.subarray(i,i+16)}break;case ri.PLAYREADY:{let i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=_S(i,null,t),this.keyId=o0(t);break}default:{let i=t.subarray(0,16);if(i.length!==16){let s=new Uint8Array(16);s.set(i,16-i.length),i=s}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=to[this.uri];if(!i){let s=Object.keys(to).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,s),to[this.uri]=i}this.keyId=i}return this}};function l0(r){let e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}var Jg=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Zg=/#EXT-X-MEDIA:(.*)/g,u0=/^#EXT(?:INF|-X-TARGETDURATION):/m,th=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),h0=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ar=class r{static findGroup(e,t){for(let i=0;i<e.length;i++){let s=e[i];if(s.id===t)return s}}static resolve(e,t){return If.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return u0.test(e)}static parseMasterPlaylist(e,t){let i=zg(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},n=[];Jg.lastIndex=0;let a;for(;(a=Jg.exec(e))!=null;)if(a[1]){var l;let h=new gt(a[1],s),f=Ac(s,a[2]),p={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:r.resolve(f,t)},m=h.decimalResolution("RESOLUTION");m&&(p.width=m.width,p.height=m.height),im(h.CODECS,p);let _=h["SUPPLEMENTAL-CODECS"];_&&(p.supplemental={},im(_,p.supplemental)),(l=p.unknownCodecs)!=null&&l.length||n.push(p),s.levels.push(p)}else if(a[3]){let h=a[3],f=a[4];switch(h){case"SESSION-DATA":{let p=new gt(f,s),m=p["DATA-ID"];m&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[m]=p);break}case"SESSION-KEY":{let p=em(f,t,s);p.encrypted&&p.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(p)):Ze.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{let p=new gt(f,s);Yg(s,p,t)}break}case"CONTENT-STEERING":{let p=new gt(f,s);s.contentSteering={uri:r.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=tm(f);break}}}let c=n.length>0&&n.length<s.levels.length;return s.levels=c?n:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,i){let s,n={},a=i.levels,l={AUDIO:a.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:a.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]},c=0;for(Zg.lastIndex=0;(s=Zg.exec(e))!==null;){let h=new gt(s[1],i),f=h.TYPE;if(f){let p=l[f],m=n[f]||[];n[f]=m;let _=h.LANGUAGE,E=h["ASSOC-LANGUAGE"],S=h.CHANNELS,C=h.CHARACTERISTICS,I=h["INSTREAM-ID"],R={attrs:h,bitrate:0,id:c++,groupId:h["GROUP-ID"]||"",name:h.NAME||_||"",type:f,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:_,url:h.URI?r.resolve(h.URI,t):""};if(E&&(R.assocLang=E),S&&(R.channels=S),C&&(R.characteristics=C),I&&(R.instreamId=I),p!=null&&p.length){let k=r.findGroup(p,R.groupId)||p[0];sm(R,k,"audioCodec"),sm(R,k,"textCodec")}m.push(R)}}return n}static parseLevelPlaylist(e,t,i,s,n,a){var l;let c={url:t},h=new Ic(t),f=h.fragments,p=[],m=null,_=0,E=0,S=0,C=0,I=0,R=null,k=new Vn(s,c),D,x,N,B=-1,H=!1,O=null,P;if(th.lastIndex=0,h.m3u8=e,h.hasVariableRefs=zg(e),((l=th.exec(e))==null?void 0:l[0])!=="#EXTM3U")return h.playlistParsingError=new Error("Missing format identifier #EXTM3U"),h;for(;(D=th.exec(e))!==null;){H&&(H=!1,k=new Vn(s,c),k.playlistOffset=S,k.start=S,k.sn=_,k.cc=C,I&&(k.bitrate=I),k.level=i,m&&(k.initSegment=m,m.rawProgramDateTime&&(k.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),O&&(k.setByteRange(O),O=null)));let te=D[1];if(te){k.duration=parseFloat(te);let re=(" "+D[2]).slice(1);k.title=re||null,k.tagList.push(re?["INF",te,re]:["INF",te])}else if(D[3]){if(Ce(k.duration)){k.playlistOffset=S,k.start=S,N&&nm(k,N,h),k.sn=_,k.level=i,k.cc=C,f.push(k);let re=(" "+D[3]).slice(1);k.relurl=Ac(h,re),Rc(k,R,p),R=k,S+=k.duration,_++,E=0,H=!0}}else{if(D=D[0].match(h0),!D){Ze.warn("No matches on slow regex match for level playlist!");continue}for(x=1;x<D.length&&D[x]===void 0;x++);let re=(" "+D[x]).slice(1),ne=(" "+D[x+1]).slice(1),de=D[x+2]?(" "+D[x+2]).slice(1):null;switch(re){case"BYTERANGE":R?k.setByteRange(ne,R):k.setByteRange(ne);break;case"PROGRAM-DATE-TIME":k.rawProgramDateTime=ne,k.tagList.push(["PROGRAM-DATE-TIME",ne]),B===-1&&(B=f.length);break;case"PLAYLIST-TYPE":h.type&&Zi(h,re,D),h.type=ne.toUpperCase();break;case"MEDIA-SEQUENCE":h.startSN!==0?Zi(h,re,D):f.length>0&&am(h,re,D),_=h.startSN=parseInt(ne);break;case"SKIP":{h.skippedSegments&&Zi(h,re,D);let Z=new gt(ne,h),ae=Z.decimalInteger("SKIPPED-SEGMENTS");if(Ce(ae)){h.skippedSegments+=ae;for(let oe=ae;oe--;)f.push(null);_+=ae}let se=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");se&&(h.recentlyRemovedDateranges=(h.recentlyRemovedDateranges||[]).concat(se.split("	")));break}case"TARGETDURATION":h.targetduration!==0&&Zi(h,re,D),h.targetduration=Math.max(parseInt(ne),1);break;case"VERSION":h.version!==null&&Zi(h,re,D),h.version=parseInt(ne);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":h.live||Zi(h,re,D),h.live=!1;break;case"#":(ne||de)&&k.tagList.push(de?[ne,de]:[ne]);break;case"DISCONTINUITY":C++,k.tagList.push(["DIS"]);break;case"GAP":k.gap=!0,k.tagList.push([re]);break;case"BITRATE":k.tagList.push([re,ne]),I=parseInt(ne)*1e3,Ce(I)?k.bitrate=I:I=0;break;case"DATERANGE":{let Z=new gt(ne,h),ae=new Zo(Z,h.dateRanges[Z.ID],h.dateRangeTagCount);h.dateRangeTagCount++,ae.isValid||h.skippedSegments?h.dateRanges[ae.id]=ae:Ze.warn(`Ignoring invalid DATERANGE tag: "${ne}"`),k.tagList.push(["EXT-X-DATERANGE",ne]);break}case"DEFINE":{{let Z=new gt(ne,h);"IMPORT"in Z?YS(h,Z,a):Yg(h,Z,t)}break}case"DISCONTINUITY-SEQUENCE":h.startCC!==0?Zi(h,re,D):f.length>0&&am(h,re,D),h.startCC=C=parseInt(ne);break;case"KEY":{let Z=em(ne,t,h);if(Z.isSupported()){if(Z.method==="NONE"){N=void 0;break}N||(N={});let ae=N[Z.keyFormat];ae!=null&&ae.matches(Z)||(ae&&(N=it({},N)),N[Z.keyFormat]=Z)}else Ze.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${ne}"`);break}case"START":h.startTimeOffset=tm(ne);break;case"MAP":{let Z=new gt(ne,h);if(k.duration){let ae=new Vn(s,c);rm(ae,Z,i,N),m=ae,k.initSegment=m,m.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=m.rawProgramDateTime)}else{let ae=k.byteRangeEndOffset;if(ae){let se=k.byteRangeStartOffset;O=`${ae-se}@${se}`}else O=null;rm(k,Z,i,N),m=k,H=!0}m.cc=C;break}case"SERVER-CONTROL":{P&&Zi(h,re,D),P=new gt(ne),h.canBlockReload=P.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=P.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&P.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=P.optionalFloat("PART-HOLD-BACK",0),h.holdBack=P.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{h.partTarget&&Zi(h,re,D);let Z=new gt(ne);h.partTarget=Z.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Z=h.partList;Z||(Z=h.partList=[]);let ae=E>0?Z[Z.length-1]:void 0,se=E++,oe=new gt(ne,h),Y=new gc(oe,k,c,se,ae);Z.push(Y),k.duration+=Y.duration;break}case"PRELOAD-HINT":{let Z=new gt(ne,h);h.preloadHint=Z;break}case"RENDITION-REPORT":{let Z=new gt(ne,h);h.renditionReports=h.renditionReports||[],h.renditionReports.push(Z);break}default:Ze.warn(`line parsed but not handled: ${D}`);break}}}R&&!R.relurl?(f.pop(),S-=R.duration,h.partList&&(h.fragmentHint=R)):h.partList&&(Rc(k,R,p),k.cc=C,h.fragmentHint=k,N&&nm(k,N,h)),h.targetduration||(h.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));let G=f.length,Q=f[0],ie=f[G-1];if(S+=h.skippedSegments*h.targetduration,S>0&&G&&ie){h.averagetargetduration=S/G;let te=ie.sn;h.endSN=te!=="initSegment"?te:0,h.live||(ie.endList=!0),Q&&h.startCC===void 0&&(h.startCC=Q.cc),B>0&&(d0(f,B),Q&&p.unshift(Q))}else h.endSN=0,h.startCC=0;return h.fragmentHint&&(S+=h.fragmentHint.duration),h.totalduration=S,p.length&&h.dateRangeTagCount&&Q&&Ey(p,h),h.endCC=C,h}};function Ey(r,e){let t=r.length;if(!t)return;let i=r[t-1],s=e.live?1/0:e.totalduration,n=Object.keys(e.dateRanges);for(let a=n.length;a--;){let l=e.dateRanges[n[a]],c=l.startDate.getTime();l.tagAnchor=i.ref;for(let h=t;h--;){let f=c0(e,c,r,h,s);if(f!==-1){l.tagAnchor=e.fragments[f].ref;break}}}}function c0(r,e,t,i,s){let n=t[i];if(n){let l=n.programDateTime;if(e>=l||i===0){var a;let c=(((a=t[i+1])==null?void 0:a.start)||s)-n.start;if(e<=l+c*1e3){let h=t[i].sn-r.startSN,f=r.fragments;if(f.length>t.length){let m=(t[i+1]||f[f.length-1]).sn-r.startSN;for(let _=m;_>h;_--){let E=f[_].programDateTime;if(e>=E&&e<E+f[_].duration*1e3)return _}}return h}}}return-1}function em(r,e,t){var i,s;let n=new gt(r,t),a=(i=n.METHOD)!=null?i:"",l=n.URI,c=n.hexadecimalInteger("IV"),h=n.KEYFORMATVERSIONS,f=(s=n.KEYFORMAT)!=null?s:"identity";l&&n.IV&&!c&&Ze.error(`Invalid IV: ${n.IV}`);let p=l?ar.resolve(l,e):"",m=(h||"1").split("/").map(Number).filter(Number.isFinite);return new tl(a,p,f,m,c,n.KEYID)}function tm(r){let t=new gt(r).decimalFloatingPoint("TIME-OFFSET");return Ce(t)?t:null}function im(r,e){let t=(r||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{let s=t.filter(n=>kf(n,i));s.length&&(e[`${i}Codec`]=s.map(n=>n.split("/")[0]).join(","),t=t.filter(n=>s.indexOf(n)===-1))}),e.unknownCodecs=t}function sm(r,e,t){let i=e[t];i&&(r[t]=i)}function d0(r,e){let t=r[e];for(let i=e;i--;){let s=r[i];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Rc(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function rm(r,e,t,i){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",i&&(r.levelkeys=i),r.initSegment=null}function nm(r,e,t){r.levelkeys=e;let{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&i.push(r)}function Zi(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function am(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function ih(r,e){let t=e.startPTS;if(Ce(t)){let i=0,s;e.sn>r.sn?(i=t-r.start,s=r):(i=r.start-t,s=e),s.duration!==i&&s.setDuration(i)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function by(r,e,t,i,s,n){i-t<=0&&(Ze.warn("Fragment should have a positive duration",e),i=t+e.duration,n=s+e.duration);let l=t,c=i,h=e.startPTS,f=e.endPTS;if(Ce(h)){let C=Math.abs(h-t);Ce(e.deltaPTS)?e.deltaPTS=Math.max(C,e.deltaPTS):e.deltaPTS=C,l=Math.max(t,h),t=Math.min(t,h),s=Math.min(s,e.startDTS),c=Math.min(i,f),i=Math.max(i,f),n=Math.max(n,e.endDTS)}let p=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=i,e.minEndPTS=c,e.endDTS=n;let m=e.sn;if(!r||m<r.startSN||m>r.endSN)return 0;let _,E=m-r.startSN,S=r.fragments;for(S[E]=e,_=E;_>0;_--)ih(S[_],S[_-1]);for(_=E;_<S.length-1;_++)ih(S[_],S[_+1]);return r.fragmentHint&&ih(S[S.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,p}function f0(r,e){if(r===e)return;let t=null,i=r.fragments;for(let h=i.length-1;h>=0;h--){let f=i[h].initSegment;if(f){t=f;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let s;m0(r,e,(h,f,p,m)=>{if((!e.startCC||e.skippedSegments)&&f.cc!==h.cc){let _=h.cc-f.cc;for(let E=p;E<m.length;E++)m[E].cc+=_;e.endCC=m[m.length-1].cc}Ce(h.startPTS)&&Ce(h.endPTS)&&(f.setStart(f.startPTS=h.startPTS),f.startDTS=h.startDTS,f.maxStartPTS=h.maxStartPTS,f.endPTS=h.endPTS,f.endDTS=h.endDTS,f.minEndPTS=h.minEndPTS,f.setDuration(h.endPTS-h.startPTS),f.duration&&(s=f),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(f.elementaryStreams=h.elementaryStreams),f.loader=h.loader,h.hasStats&&(f.stats=h.stats),h.initSegment&&(f.initSegment=h.initSegment,t=h.initSegment)});let n=e.fragments,a=e.fragmentHint?n.concat(e.fragmentHint):n;if(t&&a.forEach(h=>{var f;h&&(!h.initSegment||h.initSegment.relurl===((f=t)==null?void 0:f.relurl))&&(h.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=n.some(h=>!h),e.deltaUpdateFailed){Ze.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)n.shift();e.startSN=n[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=p0(r.dateRanges,e));let h=r.fragments.filter(f=>f.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let f=1;f<a.length;f++)a[f].programDateTime===null&&Rc(a[f],a[f-1],h);Ey(h,e)}e.endCC=n[n.length-1].cc}if(!e.startCC){var l;let h=wy(r,e.startSN-1);e.startCC=(l=h?.cc)!=null?l:n[0].cc}g0(r.partList,e.partList,(h,f)=>{f.elementaryStreams=h.elementaryStreams,f.stats=h.stats}),s?by(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):Sy(r,e),n.length&&(e.totalduration=e.edge-n[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;let c=e.advancedDateTime;if(e.advanced&&c){let h=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=h),e.driftEndTime=c,e.driftEnd=h}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function p0(r,e){let{dateRanges:t,recentlyRemovedDateranges:i}=e,s=it({},r);i&&i.forEach(l=>{delete s[l]});let a=Object.keys(s).length;return a&&Object.keys(t).forEach(l=>{let c=s[l],h=new Zo(t[l].attr,c);h.isValid?(s[l]=h,c||(h.tagOrder+=a)):Ze.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ft(t[l].attr)}"`)}),s}function g0(r,e,t){if(r&&e){let i=0;for(let s=0,n=r.length;s<=n;s++){let a=r[s],l=e[s+i];a&&l&&a.index===l.index&&a.fragment.sn===l.fragment.sn?t(a,l):i--}}}function m0(r,e,t){let i=e.skippedSegments,s=Math.max(r.startSN,e.startSN)-e.startSN,n=(r.fragmentHint?1:0)+(i?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,c=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let h=s;h<=n;h++){let f=c[a+h],p=l[h];if(i&&!p&&f&&(p=e.fragments[h]=f),f&&p){if(t(f,p,h,l),f.url&&f.url!==p.url){e.playlistParsingError=om(`media sequence mismatch ${p.sn}:`,r,e,f,p);return}else if(f.cc!==p.cc){e.playlistParsingError=om(`discontinuity sequence mismatch (${f.cc}!=${p.cc})`,r,e,f,p);return}}}}function om(r,e,t,i,s){return new Error(`${r} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Sy(r,e,t=!0){let i=e.startSN+e.skippedSegments-r.startSN,s=r.fragments,n=i>=0,a=0;if(n&&i<s.length)a=s[i].start;else if(n&&e.startSN===r.endSN+1)a=r.fragmentEnd;else if(n&&t)a=r.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=r.fragmentStart;else return;Pc(e,a)}function Pc(r,e){if(e){let t=r.fragments;for(let i=r.skippedSegments;i<t.length;i++)t[i].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function Cy(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){let i=r.fragments;if(i.length&&t*4>e){let n=i[i.length-1].duration*1e3;n<t&&(t=n)}}else t/=2;return Math.round(t)}function wy(r,e,t){if(!r)return null;let i=r.fragments[e-r.startSN];return i||(i=r.fragmentHint,i&&i.sn===e)?i:e<r.startSN&&t&&t.sn===e?t:null}function lm(r,e,t){return r?Ay(r.partList,e,t):null}function Ay(r,e,t){if(r)for(let i=r.length;i--;){let s=r[i];if(s.index===t&&s.fragment.sn===e)return s}return null}function Iy(r){r.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function Gn(r,e){for(let i=0,s=r.length;i<s;i++){var t;if(((t=r[i])==null?void 0:t.cc)===e)return r[i]}return null}function v0(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function um(r,e){if(r){let t=r.start+e;r.start=r.startPTS=t,r.endPTS=t+r.duration}}function Ly(r,e){let t=e.fragments;for(let i=0,s=t.length;i<s;i++)um(t[i],r);e.fragmentHint&&um(e.fragmentHint,r),e.alignedSliding=!0}function y0(r,e){r&&(ky(e,r),!e.alignedSliding&&r&&il(e,r),!e.alignedSliding&&r&&!e.skippedSegments&&Sy(r,e,!1))}function ky(r,e){if(!v0(e,r))return;let t=Math.min(e.endCC,r.endCC),i=Gn(e.fragments,t),s=Gn(r.fragments,t);if(!i||!s)return;Ze.log(`Aligning playlist at start of dicontinuity sequence ${t}`);let n=i.start-s.start;Ly(n,r)}function il(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;let t=r.fragments,i=e.fragments;if(!t.length||!i.length)return;let s,n,a=Math.min(e.endCC,r.endCC);e.startCC<a&&r.startCC<a&&(s=Gn(i,a),n=Gn(t,a)),(!s||!n)&&(s=i[Math.floor(i.length/2)],n=Gn(t,s.cc)||t[Math.floor(t.length/2)]);let l=s.programDateTime,c=n.programDateTime;if(!l||!c)return;let h=(c-l)/1e3-(n.start-s.start);Ly(h,r)}var T0={toString:function(r){let e="",t=r.length;for(let i=0;i<t;i++)e+=`[${r.start(i).toFixed(3)}-${r.end(i).toFixed(3)}]`;return e}},he={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},ea=class extends Jo{constructor(e,t,i,s,n){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=he.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{let{config:a,fragCurrent:l,media:c,mediaBuffer:h,state:f}=this,p=c?c.currentTime:0,m=He.bufferInfo(h||c,p,a.maxBufferHole),_=!m.len;if(this.log(`Media seeking to ${Ce(p)?p.toFixed(3):p}, state: ${f}, ${_?"out of":"in"} buffer`),this.state===he.ENDED)this.resetLoadingState();else if(l){let E=a.maxFragLookUpTolerance,S=l.start-E,C=l.start+l.duration+E;if(_||C<m.start||S>m.end){let I=p>C;(p<S||I)&&(I&&l.loader&&(this.log(`Cancelling fragment load for seek (sn: ${l.sn})`),l.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(c){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);let E=this.lastCurrentTime;if(p>E&&(this.lastCurrentTime=p),!this.loadingParts){let S=Math.max(m.end,p),C=this.shouldLoadParts(this.getLevelDetails(),S);C&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${S.toFixed(2)}`),this.loadingParts=C)}}this.hls.hasEnoughToStart||(this.log(`Setting ${_?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,_&&(this.startPosition=p)),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=n,this.hls=e,this.fragmentLoader=new wc(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Jn(e.config)}registerListeners(){let{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===he.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);let e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=he.STOPPED}get startPositionValue(){let{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;let i=e.end||0,s=this.config.timelineOffset||0;if(i<=s)return!1;let n=e.buffered;this.config.maxBufferHole&&n&&n.length>1&&(e=He.bufferedInfo(n,e.start,0));let a=e.nextStart;if(a&&a>s&&a<t.edge||this.media.currentTime<e.start)return!1;let c=t.partList;if(c!=null&&c.length){let f=c[c.length-1];return He.isBuffered(this.media,f.start+f.duration/2)}let h=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){let e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){let i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);let s=this.config;this.levels&&s.autoStartLoad&&this.state===he.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){let i=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=he.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){let s=n=>{let a=n.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${n.part?" part: "+n.part.index:""} of ${this.fragInfo(a,!1,n.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(n)};this._doFragLoad(e,t,i,s).then(n=>{if(!n)return;let a=this.state,l=n.frag;if(this.fragContextChanged(l)){(a===he.FRAG_LOADING||!this.fragCurrent&&a===he.PARSING)&&(this.fragmentTracker.removeFragment(l),this.state=he.IDLE);return}"payload"in n&&(this.log(`Loaded ${l.type} sn: ${l.sn} of ${this.playlistLabel()} ${l.level}`),this.hls.trigger(L.FRAG_LOADED,n)),this._handleFragmentLoadComplete(n)}).catch(n=>{this.state===he.STOPPED||this.state===he.ERROR||(this.warn(`Frag error: ${n?.message||n}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;let{fragmentTracker:i}=this;if(i.getState(e)===Rt.APPENDING){let n=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,n),l=Math.max(e.duration,a?a.len:this.config.maxBufferLength),c=this.backtrackFragment;((c?e.sn-c.sn:0)===1||this.reduceMaxBufferLength(l,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===Rt.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){let t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){let t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;let s={startOffset:e,endOffset:t,type:i};this.hls.trigger(L.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{let s=i?.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{let{hls:s}=this,{frag:n,payload:a}=i,l=n.decryptdata;if(a&&a.byteLength>0&&l!=null&&l.key&&l.iv&&Kr(l.method)){let c=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),l.key.buffer,l.iv.buffer,Df(l.method)).catch(h=>{throw s.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:n}),h}).then(h=>{let f=self.performance.now();return s.trigger(L.FRAG_DECRYPTED,{frag:n,payload:h,stats:{tstart:c,tdecrypt:f}}),i.payload=h,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===he.STOPPED||this.state===he.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){let{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");let i=e.frag.stats;this.state!==he.STOPPED&&(this.state=he.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){let{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){let i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?T0.toString(He.getBuffered(i)):"(detached)"})`),Lt(e)){var s;if(e.type!==Ae.SUBTITLE){let a=e.elementaryStreams;if(!Object.keys(a).some(l=>!!a[l])){this.state=he.IDLE;return}}let n=(s=this.levels)==null?void 0:s[e.level];n!=null&&n.fragmentError&&(this.log(`Resetting level fragment error count of ${n.fragmentError} on frag buffered`),n.fragmentError=0)}this.state=he.IDLE}_handleFragmentLoadComplete(e){let{transmuxer:t}=this;if(!t)return;let{frag:i,part:s,partsLoaded:n}=e,a=!n||n.length===0||n.some(c=>!c),l=new Zn(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(l)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,s){var n;this.fragCurrent=e;let a=t?.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let l=null;e.encrypted&&!((n=e.decryptdata)!=null&&n.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=he.KEY_LOADING,this.fragCurrent=e,l=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(L.KEY_LOADED,p),this.state===he.KEY_LOADING&&(this.state=he.IDLE),p}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(l=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(l=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),l&&this.log("[eme] blocking frag load until media-keys acquired"));let c=this.fragPrevious;if(Lt(e)&&(!c||e.sn!==c.sn)){let p=this.shouldLoadParts(t.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${c?.sn}->${e.sn}`),this.loadingParts=p)}if(i=Math.max(e.start,i||0),this.loadingParts&&Lt(e)){let p=a.partList;if(p&&s){i>e.end&&a.fragmentHint&&(e=a.fragmentHint);let m=this.getNextPart(p,e,i);if(m>-1){let _=p[m];e=this.fragCurrent=_.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${_.index} (${m}/${p.length-1}) of ${this.fragInfo(e,!1,_)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=_.start+_.duration,this.state=he.FRAG_LOADING;let E;return l?E=l.then(S=>!S||this.fragContextChanged(S.frag)?null:this.doFragPartsLoad(e,_,t,s)).catch(S=>this.handleFragLoadError(S)):E=this.doFragPartsLoad(e,_,t,s).catch(S=>this.handleFragLoadError(S)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:_,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(p,i))return Promise.resolve(null)}}if(Lt(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${a?"["+a.startSN+"-"+a.endSN+"]":""}, target: ${parseFloat(i.toFixed(3))}`),Ce(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=he.FRAG_LOADING;let h=this.config.progressive,f;return h&&l?f=l.then(p=>!p||this.fragContextChanged(p?.frag)?null:this.fragmentLoader.load(e,s)).catch(p=>this.handleFragLoadError(p)):f=Promise.all([this.fragmentLoader.load(e,h?s:void 0),l]).then(([p])=>(!h&&p&&s&&s(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}doFragPartsLoad(e,t,i,s){return new Promise((n,a)=>{var l;let c=[],h=(l=i.details)==null?void 0:l.partList,f=p=>{this.fragmentLoader.loadPart(e,p,s).then(m=>{c[p.index]=m;let _=m.part;this.hls.trigger(L.FRAG_LOADED,m);let E=lm(i.details,e.sn,p.index+1)||Ay(h,e.sn,p.index+1);if(E)f(E);else return n({frag:e,part:_,partsLoaded:c})}).catch(a)};f(t)})}handleFragLoadError(e){if("data"in e){let t=e.data;e.data&&t.details===z.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:Le.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){let t=this.getCurrentContext(e);if(!t||this.state!==he.PARSING){!this.fragCurrent&&this.state!==he.STOPPED&&this.state!==he.ERROR&&(this.state=he.IDLE);return}let{frag:i,part:s,level:n}=t,a=self.performance.now();i.stats.parsing.end=a,s&&(s.stats.parsing.end=a);let l=this.getLevelDetails(),h=l&&i.sn>l.endSN||this.shouldLoadParts(l,i.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=h),this.updateLevelTiming(i,s,n,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var i;let n=e.partList[0],a=n.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=a){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>n.start-n.fragment.duration)return!0}}}return!1}getCurrentContext(e){let{levels:t,fragCurrent:i}=this,{level:s,sn:n,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${n} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;let l=t[s],c=l.details,h=a>-1?lm(c,n,a):null,f=h?h.fragment:wy(c,n,i);return f?(i&&i!==f&&(f.stats=i.stats),{frag:f,part:h,level:l}):null}bufferFragmentData(e,t,i,s,n){var a;if(!e||this.state!==he.PARSING)return;let{data1:l,data2:c}=e,h=l;if(l&&c&&(h=yi(l,c)),!((a=h)!=null&&a.length))return;let f=this.initPTS[t.cc],p=f?-f.baseTime/f.timescale:void 0,m={type:e.type,frag:t,part:i,chunkMeta:s,offset:p,parent:t.type,data:h};if(this.hls.trigger(L.BUFFER_APPENDING,m),e.dropped&&e.independent&&!i){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){let t=this.media;if(!t)return;if(!He.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}let i=t.currentTime,s=He.bufferInfo(t,i,0),n=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,n*.25),l=Math.max(Math.min(e.start-a,s.end-a),i+a);e.start-l>a&&this.flushMainBuffer(l,e.start)}getFwdBufferInfo(e,t){var i;let s=this.getLoadPosition();if(!Ce(s))return null;let a=this.lastCurrentTime>s||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,a)}getFwdBufferInfoAtPos(e,t,i,s){let n=He.bufferInfo(e,t,s);if(n.len===0&&n.nextStart!==void 0){let a=this.fragmentTracker.getBufferedFrag(t,i);if(a&&(n.nextStart<=a.end||a.gap)){let l=Math.max(Math.min(n.nextStart,a.end)-t,s);return He.bufferInfo(e,t,l)}}return n}getMaxBufferLength(e){let{config:t}=this,i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){let i=this.config,s=Math.max(Math.min(e-t,i.maxBufferLength),t),n=Math.max(e-t*3,i.maxMaxBufferLength/2,s);return n>=s?(i.maxMaxBufferLength=n,this.warn(`Reduce max buffer length to ${n}s`),!0):!1}getAppendedFrag(e,t=Ae.MAIN){var i;let s=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(e,t);return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){let i=t.fragments,s=i.length;if(!s)return null;let{config:n}=this,a=i[0].start,l=n.lowLatencyMode&&!!t.partList,c=null;if(t.live){let p=n.initialLiveManifestSize;if(s<p)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var h;l&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),c=this.getInitialLiveFragment(t);let m=this.hls.startPosition,_=this.hls.liveSyncPosition,E=c?(m!==-1&&m>=a?m:_)||c.start:e;this.log(`Setting startPosition to ${E} to match start frag at live edge. mainStart: ${m} liveSyncPosition: ${_} frag.start: ${(h=c)==null?void 0:h.start}`),this.startPosition=this.nextLoadPosition=E}}else e<=a&&(c=i[0]);if(!c){let p=this.loadingParts?t.partEnd:t.fragmentEnd;c=this.getFragmentAtPosition(e,p,t)}let f=this.filterReplacedPrimary(c,t);if(!f&&c){let p=c.sn-t.startSN;f=this.filterReplacedPrimary(i[p+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){let i=this.fragmentTracker.getState(e);return(i===Rt.OK||i===Rt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,s,n){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&i.nextStart)){let l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s,0);if(l!==null&&i.len+l.len>=n){let c=a.sn;return this.loopSn!==c&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${c}`),this.loopSn=c),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(hm(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(hm(this.hls.config)&&e.type!==Ae.SUBTITLE){let i=this.hls.interstitialsManager,s=i?.bufferingItem;if(s){let a=s.event;if(a){if(a.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&t?.live===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}let n=i?.playerQueue;if(n)for(let a=n.length;a--;){let l=n[a].interstitial;if(l.appendInPlace&&e.start>=l.startTime&&e.end<=l.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let s=-1,n=!1,a=!0;for(let l=0,c=e.length;l<c;l++){let h=e[l];if(a=a&&!h.independent,s>-1&&i<h.start)break;let f=h.loaded;f?s=-1:(n||h.independent||a)&&h.fragment===t&&(s=l),n=f}return s}loadedEndOfParts(e,t){let i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e){let t=e.fragments,i=this.fragPrevious,s=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=HS(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){let n=i.sn+1;if(n>=e.startSN&&n<=e.endSN){let a=t[n-e.startSN];i.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=vy(e,i.cc,i.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{let n=this.hls.liveSyncPosition;n!==null&&(s=this.getFragmentAtPosition(n,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,i){let{config:s}=this,{fragPrevious:n}=this,{fragments:a,endSN:l}=i,{fragmentHint:c}=i,{maxFragLookUpTolerance:h}=s,f=i.partList,p=!!(this.loadingParts&&f!=null&&f.length&&c);p&&c&&!this.bitrateTest&&f[f.length-1].fragment.sn===c.sn&&(a=a.concat(c),l=c.sn);let m;if(e<t){var _;let S=e<this.lastCurrentTime||e>t-h||(_=this.media)!=null&&_.paused||!this.startFragRequested?0:h;m=cr(n,a,e,S)}else m=a[a.length-1];if(m){let E=m.sn-i.startSN,S=this.fragmentTracker.getState(m);if((S===Rt.OK||S===Rt.PARTIAL&&m.gap)&&(n=m),n&&m.sn===n.sn&&(!p||f[0].fragment.sn>m.sn||!i.live&&!p)&&n&&m.level===n.level){let I=a[E+1];m.sn<l&&this.fragmentTracker.getState(I)!==Rt.OK?m=I:m=null}}return m}alignPlaylists(e,t,i){let s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;let n=e.fragmentStart,a=!t,l=e.alignedSliding&&Ce(n);if(a||!l&&!n){y0(i,e);let c=e.fragmentStart;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),c}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);let s=this.timelineOffset;if(i===-1){let n=this.startTimeOffset!==null,a=n?this.startTimeOffset:e.startTimeOffset;a!==null&&Ce(a)?(i=t+a,a<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${a} found in ${n?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+s}this.nextLoadPosition=i+s}getLoadPosition(){var e;let{media:t}=this,i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Lt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==he.FRAG_LOADING_WAITING_RETRY)&&(this.state=he.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){let E=this.getCurrentContext(t.chunkMeta);E&&(t.frag=E.frag)}let i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}let n=t.details===z.FRAG_GAP;n&&this.fragmentTracker.fragBuffered(i,!0);let a=t.errorAction,{action:l,flags:c,retryCount:h=0,retryConfig:f}=a||{},p=!!a&&!!f,m=p&&l===jt.RetryRequest,_=p&&!a.resolved&&c===Ai.MoveAllAlternatesMatchingHost;if(!m&&_&&Lt(i)&&!i.endList)this.resetFragmentErrors(e),this.treatAsGap(i),a.resolved=!0;else if((m||_)&&h<f.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);let E=Pf(f,h);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${h+1}/${f.maxNumRetry} in ${E}ms`),a.resolved=!0,this.retryDate=self.performance.now()+E,this.state=he.FRAG_LOADING_WAITING_RETRY}else if(f&&a)if(this.resetFragmentErrors(e),h<f.maxNumRetry)!n&&l!==jt.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else l===jt.SendAlternateToPenaltyBox?this.state=he.WAITING_LEVEL:this.state=he.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===he.PARSING||this.state===he.PARSED){let t=e.frag,i=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,i),n=s&&s.len>.5;n&&this.reduceMaxBufferLength(s.len,t?.duration||10);let a=!n;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Ae.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==he.STOPPED&&(this.state=he.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;let s=He.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===he.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==he.STOPPED&&(this.state=he.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;let t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,s){let n=i.details;if(!n){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((c,h)=>{let f=e.elementaryStreams[h];if(f){let p=f.endPTS-f.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${h} duration reliably (${p})`),c||!1;let m=s?0:by(n,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:n,level:i,drift:m,type:h,frag:e,start:f.startPTS,end:f.endPTS}),!0}return c},!1)){var l;if(i.fragmentError===0&&this.treatAsGap(e,i),((l=this.transmuxer)==null?void 0:l.error)===null){let c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=he.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Ae.MAIN?"level":"track"}fragInfo(e,t=!0,i){var s,n;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((s=t&&!i?e.startPTS:(i||e).start)!=null?s:NaN).toFixed(3)}-${((n=t&&!i?e.endPTS:(i||e).end)!=null?n:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){let t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}};function hm(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}var sl=class{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){let{chunks:e,dataLength:t}=this,i;if(e.length)e.length===1?i=e[0]:i=_0(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}};function _0(r,e){let t=new Uint8Array(e),i=0;for(let s=0;s<r.length;s++){let n=r[s];t.set(n,i),i+=n.length}return t}var sh={exports:{}},cm;function E0(){return cm||(cm=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(c,h,f){this.fn=c,this.context=h,this.once=f||!1}function n(c,h,f,p,m){if(typeof f!="function")throw new TypeError("The listener must be a function");var _=new s(f,p||c,m),E=t?t+h:h;return c._events[E]?c._events[E].fn?c._events[E]=[c._events[E],_]:c._events[E].push(_):(c._events[E]=_,c._eventsCount++),c}function a(c,h){--c._eventsCount===0?c._events=new i:delete c._events[h]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var h=[],f,p;if(this._eventsCount===0)return h;for(p in f=this._events)e.call(f,p)&&h.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(f)):h},l.prototype.listeners=function(h){var f=t?t+h:h,p=this._events[f];if(!p)return[];if(p.fn)return[p.fn];for(var m=0,_=p.length,E=new Array(_);m<_;m++)E[m]=p[m].fn;return E},l.prototype.listenerCount=function(h){var f=t?t+h:h,p=this._events[f];return p?p.fn?1:p.length:0},l.prototype.emit=function(h,f,p,m,_,E){var S=t?t+h:h;if(!this._events[S])return!1;var C=this._events[S],I=arguments.length,R,k;if(C.fn){switch(C.once&&this.removeListener(h,C.fn,void 0,!0),I){case 1:return C.fn.call(C.context),!0;case 2:return C.fn.call(C.context,f),!0;case 3:return C.fn.call(C.context,f,p),!0;case 4:return C.fn.call(C.context,f,p,m),!0;case 5:return C.fn.call(C.context,f,p,m,_),!0;case 6:return C.fn.call(C.context,f,p,m,_,E),!0}for(k=1,R=new Array(I-1);k<I;k++)R[k-1]=arguments[k];C.fn.apply(C.context,R)}else{var D=C.length,x;for(k=0;k<D;k++)switch(C[k].once&&this.removeListener(h,C[k].fn,void 0,!0),I){case 1:C[k].fn.call(C[k].context);break;case 2:C[k].fn.call(C[k].context,f);break;case 3:C[k].fn.call(C[k].context,f,p);break;case 4:C[k].fn.call(C[k].context,f,p,m);break;default:if(!R)for(x=1,R=new Array(I-1);x<I;x++)R[x-1]=arguments[x];C[k].fn.apply(C[k].context,R)}}return!0},l.prototype.on=function(h,f,p){return n(this,h,f,p,!1)},l.prototype.once=function(h,f,p){return n(this,h,f,p,!0)},l.prototype.removeListener=function(h,f,p,m){var _=t?t+h:h;if(!this._events[_])return this;if(!f)return a(this,_),this;var E=this._events[_];if(E.fn)E.fn===f&&(!m||E.once)&&(!p||E.context===p)&&a(this,_);else{for(var S=0,C=[],I=E.length;S<I;S++)(E[S].fn!==f||m&&!E[S].once||p&&E[S].context!==p)&&C.push(E[S]);C.length?this._events[_]=C.length===1?C[0]:C:a(this,_)}return this},l.prototype.removeAllListeners=function(h){var f;return h?(f=t?t+h:h,this._events[f]&&a(this,f)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,r.exports=l}(sh)),sh.exports}var b0=E0(),xf=nS(b0),ta="1.6.7",Zr={};function S0(){return typeof __HLS_WORKER_BUNDLE__=="function"}function C0(){let r=Zr[ta];if(r)return r.clientCount++,r;let e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Zr[ta]=s,s}function w0(r){let e=Zr[r];if(e)return e.clientCount++,e;let t=new self.URL(r,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Zr[r]=s,s}function A0(r){let e=Zr[r||ta];if(e&&e.clientCount--===1){let{worker:i,objectURL:s}=e;delete Zr[r||ta],s&&self.URL.revokeObjectURL(s),i.terminate()}}function Ry(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function Of(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function Bl(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function ia(r,e){let t=e,i=0;for(;Of(r,e);){i+=10;let s=Bl(r,e+6);i+=s,Ry(r,e+10)&&(i+=10),e+=i}if(i>0)return r.subarray(t,t+i)}function I0(r,e,t,i){let s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],n=e[t+2],a=n>>2&15;if(a>12){let _=new Error(`invalid ADTS sampling index:${a}`);r.emit(L.ERROR,L.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!0,error:_,reason:_.message});return}let l=(n>>6&3)+1,c=e[t+3]>>6&3|(n&1)<<2,h="mp4a.40."+l,f=s[a],p=a;(l===5||l===29)&&(p-=3);let m=[l<<3|(p&14)>>1,(p&1)<<7|c<<3];return Ze.log(`manifest codec:${i}, parsed codec:${h}, channels:${c}, rate:${f} (ADTS object type:${l} sampling index:${a})`),{config:m,samplerate:f,channelCount:c,codec:h,parsedCodec:h,manifestCodec:i}}function Py(r,e){return r[e]===255&&(r[e+1]&246)===240}function Dy(r,e){return r[e+1]&1?7:9}function Mf(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function L0(r,e){return e+5<r.length}function rl(r,e){return e+1<r.length&&Py(r,e)}function k0(r,e){return L0(r,e)&&Py(r,e)&&Mf(r,e)<=r.length-e}function R0(r,e){if(rl(r,e)){let t=Dy(r,e);if(e+t>=r.length)return!1;let i=Mf(r,e);if(i<=t)return!1;let s=e+i;return s===r.length||rl(r,s)}return!1}function xy(r,e,t,i,s){if(!r.samplerate){let n=I0(e,t,i,s);if(!n)return;it(r,n)}}function Oy(r){return 1024*9e4/r}function P0(r,e){let t=Dy(r,e);if(e+t<=r.length){let i=Mf(r,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function My(r,e,t,i,s){let n=Oy(r.samplerate),a=i+s*n,l=P0(e,t),c;if(l){let{frameLength:p,headerLength:m}=l,_=m+p,E=Math.max(0,t+_-e.length);E?(c=new Uint8Array(_-m),c.set(e.subarray(t+m,e.length),0)):c=e.subarray(t+m,t+_);let S={unit:c,pts:a};return E||r.samples.push(S),{sample:S,length:_,missing:E}}let h=e.length-t;return c=new Uint8Array(h),c.set(e.subarray(t,e.length),0),{sample:{unit:c,pts:a},length:h,missing:-1}}function D0(r,e){return Of(r,e)&&Bl(r,e+6)+10<=r.length-e}function x0(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function rh(r,e=0,t=1/0){return O0(r,e,t,Uint8Array)}function O0(r,e,t,i){let s=M0(r),n=1;"BYTES_PER_ELEMENT"in i&&(n=i.BYTES_PER_ELEMENT);let a=F0(r)?r.byteOffset:0,l=(a+r.byteLength)/n,c=(a+e)/n,h=Math.floor(Math.max(0,Math.min(c,l))),f=Math.floor(Math.min(h+Math.max(t,0),l));return new i(s,h,f-h)}function M0(r){return r instanceof ArrayBuffer?r:r.buffer}function F0(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function N0(r){let e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}let i=r.data.subarray(1).indexOf(0);if(i===-1)return;let s=oi(rh(r.data,1,i)),n=r.data[2+i],a=r.data.subarray(3+i).indexOf(0);if(a===-1)return;let l=oi(rh(r.data,3+i,a)),c;return s==="-->"?c=oi(rh(r.data,4+i+a)):c=x0(r.data.subarray(4+i+a)),e.mimeType=s,e.pictureType=n,e.description=l,e.data=c,e}function B0(r){if(r.size<2)return;let e=oi(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function U0(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1,i=oi(r.data.subarray(t),!0);t+=i.length+1;let s=oi(r.data.subarray(t));return{key:r.type,info:i,data:s}}let e=oi(r.data.subarray(1));return{key:r.type,info:"",data:e}}function $0(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1,i=oi(r.data.subarray(t),!0);t+=i.length+1;let s=oi(r.data.subarray(t));return{key:r.type,info:i,data:s}}let e=oi(r.data);return{key:r.type,info:"",data:e}}function H0(r){return r.type==="PRIV"?B0(r):r.type[0]==="W"?$0(r):r.type==="APIC"?N0(r):U0(r)}function j0(r){let e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=Bl(r,4),i=10;return{type:e,size:t,data:r.subarray(i,i+t)}}var io=10,V0=10;function Fy(r){let e=0,t=[];for(;Of(r,e);){let i=Bl(r,e+6);r[e+5]>>6&1&&(e+=io),e+=io;let s=e+i;for(;e+V0<s;){let n=j0(r.subarray(e)),a=H0(n);a&&t.push(a),e+=n.size+io}Ry(r,e)&&(e+=io)}return t}function Ny(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function G0(r){if(r.data.byteLength===8){let e=new Uint8Array(r.data),t=e[3]&1,i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function Ff(r){let e=Fy(r);for(let t=0;t<e.length;t++){let i=e[t];if(Ny(i))return G0(i)}}var ai=function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r}({});function Vi(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}var sa=class{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=yi(this.cachedData,e),this.cachedData=null);let i=ia(e,0),s=i?i.length:0,n,a=this._audioTrack,l=this._id3Track,c=i?Ff(i):void 0,h=e.length;for((this.basePTS===null||this.frameIndex===0&&Ce(c))&&(this.basePTS=K0(c,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ai.audioId3,duration:Number.POSITIVE_INFINITY});s<h;){if(this.canParse(e,s)){let f=this.appendFrame(a,e,s);f?(this.frameIndex++,this.lastPTS=f.sample.pts,s+=f.length,n=s):s=h}else D0(e,s)?(i=ia(e,s),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ai.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,n=s):s++;if(s===h&&n!==h){let f=e.slice(n);this.cachedData?this.cachedData=yi(this.cachedData,f):this.cachedData=f}}return{audioTrack:a,videoTrack:Vi(),id3Track:l,textTrack:Vi()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){let t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Vi(),id3Track:this._id3Track,textTrack:Vi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}},K0=(r,e,t)=>{if(Ce(r))return r*90;let i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i},so=null,q0=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],W0=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],z0=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Y0=[0,1,1,4];function By(r,e,t,i,s){if(t+24>e.length)return;let n=Uy(e,t);if(n&&t+n.frameLength<=e.length){let a=n.samplesPerFrame*9e4/n.sampleRate,l=i+s*a,c={unit:e.subarray(t,t+n.frameLength),pts:l,dts:l};return r.config=[],r.channelCount=n.channelCount,r.samplerate=n.sampleRate,r.samples.push(c),{sample:c,length:n.frameLength,missing:0}}}function Uy(r,e){let t=r[e+1]>>3&3,i=r[e+1]>>1&3,s=r[e+2]>>4&15,n=r[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&n!==3){let a=r[e+2]>>1&1,l=r[e+3]>>6,c=t===3?3-i:i===3?3:4,h=q0[c*14+s-1]*1e3,p=W0[(t===3?0:t===2?1:2)*3+n],m=l===3?1:2,_=z0[t][i],E=Y0[i],S=_*8*E,C=Math.floor(_*h/p+a)*E;if(so===null){let k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);so=k?parseInt(k[1]):0}return!!so&&so<=87&&i===2&&h>=224e3&&l===0&&(r[e+3]=r[e+3]|128),{sampleRate:p,channelCount:m,frameLength:C,samplesPerFrame:S}}}function Nf(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function $y(r,e){return e+1<r.length&&Nf(r,e)}function X0(r,e){return Nf(r,e)&&4<=r.length-e}function Hy(r,e){if(e+1<r.length&&Nf(r,e)){let i=Uy(r,e),s=4;i!=null&&i.frameLength&&(s=i.frameLength);let n=e+s;return n===r.length||$y(r,n)}return!1}var Dc=class extends sa{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;let i=ia(e,0),s=i?.length||0;if(Hy(e,s))return!1;for(let n=e.length;s<n;s++)if(R0(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return k0(e,t)}appendFrame(e,t,i){xy(e,this.observer,t,i,e.manifestCodec);let s=My(e,t,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}},jy=(r,e)=>{let t=0,i=5;e+=i;let s=new Uint32Array(1),n=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=r[e];let l=Math.min(i,8),c=8-l;n[0]=4278190080>>>24+c<<c,s[0]=(a[0]&n[0])>>c,t=t?t<<l|s[0]:s[0],e+=1,i-=l}return t},xc=class extends sa{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){let s=Vy(e,t,i,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;let t=ia(e,0);if(!t)return!1;let i=t.length;return e[i]===11&&e[i+1]===119&&Ff(t)!==void 0&&jy(e,i)<16}};function Vy(r,e,t,i,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;let n=e[t+4]>>6;if(n>=3)return-1;let l=[48e3,44100,32e3][n],c=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][c*3+n]*2;if(t+f>e.length)return-1;let p=e[t+6]>>5,m=0;p===2?m+=2:(p&1&&p!==1&&(m+=2),p&4&&(m+=2));let _=(e[t+6]<<8|e[t+7])>>12-m&1,S=[2,1,2,3,3,4,4,5][p]+_,C=e[t+5]>>3,I=e[t+5]&7,R=new Uint8Array([n<<6|C<<1|I>>2,(I&3)<<6|p<<3|_<<2|c>>4,c<<4&224]),k=1536/l*9e4,D=i+s*k,x=e.subarray(t,t+f);return r.config=R,r.channelCount=S,r.samplerate=l,r.samples.push({unit:x,pts:D}),f}var Oc=class extends sa{resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=ia(e,0),i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&Ff(t)!==void 0&&jy(e,i)<=16)return!1;for(let s=e.length;i<s;i++)if(Hy(e,i))return Ze.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return X0(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return By(e,t,i,this.basePTS,this.frameIndex)}},Q0=/\/emsg[-/]ID3/i,Mc=class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,s){let n=this.videoTrack=Vi("video",1),a=this.audioTrack=Vi("audio",1),l=this.txtTrack=Vi("text",1);if(this.id3Track=Vi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;let c=ly(e);if(c.video){let{id:h,timescale:f,codec:p,supplemental:m}=c.video;n.id=h,n.timescale=l.timescale=f,n.codec=p,n.supplemental=m}if(c.audio){let{id:h,timescale:f,codec:p}=c.audio;a.id=h,a.timescale=f,a.codec=p}l.id=ny.text,n.sampleDuration=0,n.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return uS(e)}demux(e,t){this.timeOffset=t;let i=e,s=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=yi(this.remainderData,e));let l=mS(i);this.remainderData=l.remainder,s.samples=l.valid||new Uint8Array}else s.samples=i;let a=this.extractID3Track(s,t);return n.samples=Dg(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){let e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;let s=this.extractID3Track(t,this.timeOffset);return i.samples=Dg(e,t),{videoTrack:t,audioTrack:Vi(),id3Track:s,textTrack:Vi()}}extractID3Track(e,t){let i=this.id3Track;if(e.samples.length){let s=je(e.samples,["emsg"]);s&&s.forEach(n=>{let a=yS(n);if(Q0.test(a.schemeIdUri)){let l=dm(a,t),c=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;c<=.001&&(c=Number.POSITIVE_INFINITY);let h=a.payload;i.samples.push({data:h,len:h.byteLength,dts:l,pts:l,type:ai.emsg,duration:c})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){let l=dm(a,t);i.samples.push({data:a.payload,len:a.payload.byteLength,dts:l,pts:l,type:ai.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}};function dm(r,e){return Ce(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}var Fc=class{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Jn(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Us.cbc)}decryptAacSample(e,t,i){let s=e[t].unit;if(s.length<=16)return;let n=s.subarray(16,s.length-s.length%16),a=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(a).then(l=>{let c=new Uint8Array(l);s.set(c,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){let t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t),s=0;for(let n=32;n<e.length-16;n+=160,s+=16)i.set(e.subarray(n,n+16),s);return i}getAvcDecryptedUnit(e,t){let i=new Uint8Array(t),s=0;for(let n=32;n<e.length-16;n+=160,s+=16)e.set(i.subarray(s,s+16),n);return e}decryptAvcSample(e,t,i,s,n){let a=uy(n.data),l=this.getAvcEncryptedData(a);this.decryptBuffer(l.buffer).then(c=>{n.data=this.getAvcDecryptedUnit(a,c),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,s)})}decryptAvcSamples(e,t,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){s();return}let n=e[t].units;for(;!(i>=n.length);i++){let a=n[i];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,i,s,a),!this.decrypter.isSync()))return}}}},nl=class{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,s;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){let n=i.units;s=n[n.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){let i=t.samples,s=i.length;if(s){let n=i[s-1];e.pts=n.pts,e.dts=n.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){let s=t.byteLength,n=e.naluState||0,a=n,l=[],c=0,h,f,p,m=-1,_=0;for(n===-1&&(m=0,_=this.getNALuType(t,0),n=0,c=1);c<s;){if(h=t[c++],!n){n=h?0:1;continue}if(n===1){n=h?0:2;continue}if(!h)n=3;else if(h===1){if(f=c-n-1,m>=0){let E={data:t.subarray(m,f),type:_};l.push(E)}else{let E=this.getLastNalUnit(e.samples);E&&(a&&c<=4-a&&E.state&&(E.data=E.data.subarray(0,E.data.byteLength-a)),f>0&&(E.data=yi(E.data,t.subarray(0,f)),E.state=0))}c<s?(p=this.getNALuType(t,c),m=c,_=p,n=0):n=-1}else n=0}if(m>=0&&n>=0){let E={data:t.subarray(m,s),type:_,state:n};l.push(E)}if(l.length===0){let E=this.getLastNalUnit(e.samples);E&&(E.data=yi(E.data,t))}return e.naluState=n,l}},ur=class{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let e=this.data,t=this.bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");s.set(e.subarray(i,i+n)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=n*8,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;if(e>32&&Ze.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let e=this.skipLZ();return this.readBits(e+1)-1}readEG(){let e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}},al=class extends nl{parsePES(e,t,i,s){let n=this.parseNALu(e,i.data,s),a=this.VideoSample,l,c=!1;i.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),n.forEach(h=>{var f,p;switch(h.type){case 1:{let S=!1;l=!0;let C=h.data;if(c&&C.length>4){let I=this.readSliceType(C);(I===2||I===4||I===7||I===9)&&(S=!0)}if(S){var m;(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.frame=!0,a.key=S;break}case 5:l=!0,(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 6:{l=!0,Lf(h.data,1,i.pts,t.samples);break}case 7:{var _,E;l=!0,c=!0;let S=h.data,C=this.readSPS(S);if(!e.sps||e.width!==C.width||e.height!==C.height||((_=e.pixelRatio)==null?void 0:_[0])!==C.pixelRatio[0]||((E=e.pixelRatio)==null?void 0:E[1])!==C.pixelRatio[1]){e.width=C.width,e.height=C.height,e.pixelRatio=C.pixelRatio,e.sps=[S];let I=S.subarray(1,4),R="avc1.";for(let k=0;k<3;k++){let D=I[k].toString(16);D.length<2&&(D="0"+D),R+=D}e.codec=R}break}case 8:l=!0,e.pps=[h.data];break;case 9:l=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:l=!0;break;default:l=!1;break}a&&l&&a.units.push(h)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){let t=new ur(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,s=8,n;for(let a=0;a<e;a++)s!==0&&(n=t.readEG(),s=(i+n+256)%256),i=s===0?i:s}readSPS(e){let t=new ur(e),i=0,s=0,n=0,a=0,l,c,h,f=t.readUByte.bind(t),p=t.readBits.bind(t),m=t.readUEG.bind(t),_=t.readBoolean.bind(t),E=t.skipBits.bind(t),S=t.skipEG.bind(t),C=t.skipUEG.bind(t),I=this.skipScalingList.bind(this);f();let R=f();if(p(5),E(3),f(),C(),R===100||R===110||R===122||R===244||R===44||R===83||R===86||R===118||R===128){let H=m();if(H===3&&E(1),C(),C(),E(1),_())for(c=H!==3?8:12,h=0;h<c;h++)_()&&(h<6?I(16,t):I(64,t))}C();let k=m();if(k===0)m();else if(k===1)for(E(1),S(),S(),l=m(),h=0;h<l;h++)S();C(),E(1);let D=m(),x=m(),N=p(1);N===0&&E(1),E(1),_()&&(i=m(),s=m(),n=m(),a=m());let B=[1,1];if(_()&&_())switch(f()){case 1:B=[1,1];break;case 2:B=[12,11];break;case 3:B=[10,11];break;case 4:B=[16,11];break;case 5:B=[40,33];break;case 6:B=[24,11];break;case 7:B=[20,11];break;case 8:B=[32,11];break;case 9:B=[80,33];break;case 10:B=[18,11];break;case 11:B=[15,11];break;case 12:B=[64,33];break;case 13:B=[160,99];break;case 14:B=[4,3];break;case 15:B=[3,2];break;case 16:B=[2,1];break;case 255:{B=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((D+1)*16-i*2-s*2),height:(2-N)*(x+1)*16-(N?2:4)*(n+a),pixelRatio:B}}},ol=class extends nl{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,s){let n=this.parseNALu(e,i.data,s),a=this.VideoSample,l,c=!1;i.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),n.forEach(h=>{var f,p;switch(h.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.frame=!0,l=!0;break;case 16:case 17:case 18:case 21:if(l=!0,c){var m;(m=a)!=null&&m.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:l=!0,(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 39:l=!0,Lf(h.data,2,i.pts,t.samples);break;case 32:l=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=it(e.params,this.readVPS(h.data)),this.initVPS=h.data),e.vps=[h.data];break;case 33:if(l=!0,c=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],h.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){let _=this.readSPS(h.data);e.width=_.width,e.height=_.height,e.pixelRatio=_.pixelRatio,e.codec=_.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(let E in _.params)e.params[E]=_.params[E]}this.pushParameterSet(e.sps,h.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0;break;case 34:if(l=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];let _=this.readPPS(h.data);for(let E in _)e.params[E]=_[E]}this.pushParameterSet(e.pps,h.data,e.vps)}break;case 35:l=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:l=!1;break}a&&l&&a.units.push(h)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){let t=new Uint8Array(e.byteLength),i=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[i]=e[s],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){let t=new ur(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);let i=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:s}}readSPS(e){let t=new ur(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);let i=t.readBits(3);t.readBoolean();let s=t.readBits(2),n=t.readBoolean(),a=t.readBits(5),l=t.readUByte(),c=t.readUByte(),h=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),_=t.readUByte(),E=t.readUByte(),S=t.readUByte(),C=t.readUByte(),I=t.readUByte(),R=[],k=[];for(let xe=0;xe<i;xe++)R.push(t.readBoolean()),k.push(t.readBoolean());if(i>0)for(let xe=i;xe<8;xe++)t.readBits(2);for(let xe=0;xe<i;xe++)R[xe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),k[xe]&&t.readUByte();t.readUEG();let D=t.readUEG();D==3&&t.skipBits(1);let x=t.readUEG(),N=t.readUEG(),B=t.readBoolean(),H=0,O=0,P=0,G=0;B&&(H+=t.readUEG(),O+=t.readUEG(),P+=t.readUEG(),G+=t.readUEG());let Q=t.readUEG(),ie=t.readUEG(),te=t.readUEG(),re=t.readBoolean();for(let xe=re?0:i;xe<=i;xe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Ke=0;Ke<4;Ke++)for(let St=0;St<(Ke===3?2:6);St++)if(!t.readBoolean())t.readUEG();else{let Ct=Math.min(64,1<<4+(Ke<<1));Ke>1&&t.readEG();for(let Ut=0;Ut<Ct;Ut++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());let Z=t.readUEG(),ae=0;for(let xe=0;xe<Z;xe++){let Ke=!1;if(xe!==0&&(Ke=t.readBoolean()),Ke){xe===Z&&t.readUEG(),t.readBoolean(),t.readUEG();let St=0;for(let Vt=0;Vt<=ae;Vt++){let Ct=t.readBoolean(),Ut=!1;Ct||(Ut=t.readBoolean()),(Ct||Ut)&&St++}ae=St}else{let St=t.readUEG(),Vt=t.readUEG();ae=St+Vt;for(let Ct=0;Ct<St;Ct++)t.readUEG(),t.readBoolean();for(let Ct=0;Ct<Vt;Ct++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){let xe=t.readUEG();for(let Ke=0;Ke<xe;Ke++){for(let St=0;St<te+4;St++)t.readBits(1);t.readBits(1)}}let oe=0,Y=1,ee=1,be=!0,Ee=1,Re=0;t.readBoolean(),t.readBoolean();let Oe=!1;if(t.readBoolean()){if(t.readBoolean()){let yt=t.readUByte(),Ti=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ft=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];yt>0&&yt<16?(Y=Ti[yt-1],ee=Ft[yt-1]):yt===255&&(Y=t.readBits(16),ee=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Oe=t.readBoolean(),Oe&&(H+=t.readUEG(),O+=t.readUEG(),P+=t.readUEG(),G+=t.readUEG()),t.readBoolean()&&(Ee=t.readBits(32),Re=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){let Ft=t.readBoolean(),wt=t.readBoolean(),Pt=!1;(Ft||wt)&&(Pt=t.readBoolean(),Pt&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Pt&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let zt=0;zt<=i;zt++){be=t.readBoolean();let Dt=be||t.readBoolean(),kt=!1;Dt?t.readEG():kt=t.readBoolean();let M=kt?1:t.readUEG()+1;if(Ft)for(let b=0;b<M;b++)t.readUEG(),t.readUEG(),Pt&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(wt)for(let b=0;b<M;b++)t.readUEG(),t.readUEG(),Pt&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),oe=t.readUEG())}let Be=x,Ve=N;if(B||Oe){let xe=1,Ke=1;D===1?xe=Ke=2:D==2&&(xe=2),Be=x-xe*O-xe*H,Ve=N-Ke*G-Ke*P}let Je=s?["A","B","C"][s]:"",Ye=l<<24|c<<16|h<<8|f,ni=0;for(let xe=0;xe<32;xe++)ni=(ni|(Ye>>xe&1)<<31-xe)>>>0;let Wt=ni.toString(16);return a===1&&Wt==="2"&&(Wt="6"),{codecString:`hvc1.${Je}${a}.${Wt}.${n?"H":"L"}${I}.B0`,params:{general_tier_flag:n,general_profile_idc:a,general_profile_space:s,general_profile_compatibility_flags:[l,c,h,f],general_constraint_indicator_flags:[p,m,_,E,S,C],general_level_idc:I,bit_depth:Q+8,bit_depth_luma_minus8:Q,bit_depth_chroma_minus8:ie,min_spatial_segmentation_idc:oe,chroma_format_idc:D,frame_rate:{fixed:be,fps:Re/Ee}},width:Be,height:Ve,pixelRatio:[Y,ee]}}readPPS(e){let t=new ur(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);let s=t.readBoolean(),n=t.readBoolean(),a=1;return n&&s?a=0:n?a=3:s&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}},Ot=188,Nc=class r{constructor(e,t,i,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=s,this.videoParser=null}static probe(e,t){let i=r.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){let t=e.length,i=Math.min(Ot*5,t-Ot)+1,s=0;for(;s<i;){let n=!1,a=-1,l=0;for(let c=s;c<t;c+=Ot)if(e[c]===71&&(t-c===Ot||e[c+Ot]===71)){if(l++,a===-1&&(a=c,a!==0&&(i=Math.min(a+Ot*99,e.length-Ot)+1)),n||(n=Bc(e,c)===0),n&&l>1&&(a===0&&l>2||c+Ot>i))return a}else{if(l)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:ny[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=r.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=r.createTrack("audio",s),this._id3Track=r.createTrack("id3"),this._txtTrack=r.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){let{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,s=!1){i||(this.sampleAes=null);let n,a=this._videoTrack,l=this._audioTrack,c=this._id3Track,h=this._txtTrack,f=a.pid,p=a.pesData,m=l.pid,_=c.pid,E=l.pesData,S=c.pesData,C=null,I=this.pmtParsed,R=this._pmtId,k=e.length;if(this.remainderData&&(e=yi(this.remainderData,e),k=e.length,this.remainderData=null),k<Ot&&!s)return this.remainderData=e,{audioTrack:l,videoTrack:a,id3Track:c,textTrack:h};let D=Math.max(0,r.syncOffset(e));k-=(k-D)%Ot,k<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,k,e.buffer.byteLength-k));let x=0;for(let B=D;B<k;B+=Ot)if(e[B]===71){let H=!!(e[B+1]&64),O=Bc(e,B),P=(e[B+3]&48)>>4,G;if(P>1){if(G=B+5+e[B+4],G===B+Ot)continue}else G=B+4;switch(O){case f:if(H){if(p&&(n=xr(p,this.logger))){if(this.videoParser===null)switch(a.segmentCodec){case"avc":this.videoParser=new al;break;case"hevc":this.videoParser=new ol;break}this.videoParser!==null&&this.videoParser.parsePES(a,h,n,!1)}p={data:[],size:0}}p&&(p.data.push(e.subarray(G,B+Ot)),p.size+=B+Ot-G);break;case m:if(H){if(E&&(n=xr(E,this.logger)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,n);break;case"mp3":this.parseMPEGPES(l,n);break;case"ac3":this.parseAC3PES(l,n);break}E={data:[],size:0}}E&&(E.data.push(e.subarray(G,B+Ot)),E.size+=B+Ot-G);break;case _:H&&(S&&(n=xr(S,this.logger))&&this.parseID3PES(c,n),S={data:[],size:0}),S&&(S.data.push(e.subarray(G,B+Ot)),S.size+=B+Ot-G);break;case 0:H&&(G+=e[G]+1),R=this._pmtId=J0(e,G);break;case R:{H&&(G+=e[G]+1);let Q=Z0(e,G,this.typeSupported,i,this.observer,this.logger);f=Q.videoPid,f>0&&(a.pid=f,a.segmentCodec=Q.segmentVideoCodec),m=Q.audioPid,m>0&&(l.pid=m,l.segmentCodec=Q.segmentAudioCodec),_=Q.id3Pid,_>0&&(c.pid=_),C!==null&&!I&&(this.logger.warn(`MPEG-TS PMT found at ${B} after unknown PID '${C}'. Backtracking to sync byte @${D} to parse all TS packets.`),C=null,B=D-188),I=this.pmtParsed=!0;break}case 17:case 8191:break;default:C=O;break}}else x++;x>0&&Uc(this.observer,new Error(`Found ${x} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=p,l.pesData=E,c.pesData=S;let N={audioTrack:l,videoTrack:a,id3Track:c,textTrack:h};return s&&this.extractRemainingSamples(N),N}flush(){let{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){let{audioTrack:t,videoTrack:i,id3Track:s,textTrack:n}=e,a=i.pesData,l=t.pesData,c=s.pesData,h;if(a&&(h=xr(a,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new al;break;case"hevc":this.videoParser=new ol;break}this.videoParser!==null&&(this.videoParser.parsePES(i,n,h,!0),i.pesData=null)}else i.pesData=a;if(l&&(h=xr(l,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,h);break;case"mp3":this.parseMPEGPES(t,h);break;case"ac3":this.parseAC3PES(t,h);break}t.pesData=null}else l!=null&&l.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=l;c&&(h=xr(c,this.logger))?(this.parseID3PES(s,h),s.pesData=null):s.pesData=c}demuxSampleAes(e,t,i){let s=this.demux(e,i,!0,!this.config.progressive),n=this.sampleAes=new Fc(this.observer,this.config,t);return this.decrypt(s,n)}decrypt(e,t){return new Promise(i=>{let{audioTrack:s,videoTrack:n}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,()=>{i(e)}):i(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0,s=this.aacOverFlow,n=t.data;if(s){this.aacOverFlow=null;let p=s.missing,m=s.sample.unit.byteLength;if(p===-1)n=yi(s.sample.unit,n);else{let _=m-p;s.sample.unit.set(n.subarray(0,p),_),e.samples.push(s.sample),i=s.missing}}let a,l;for(a=i,l=n.length;a<l-1&&!rl(n,a);a++);if(a!==i){let p,m=a<l-1;if(m?p=`AAC PES did not start with ADTS header,offset:${a}`:p="No ADTS header found in AAC PES",Uc(this.observer,new Error(p),m,this.logger),!m)return}xy(e,this.observer,n,a,this.audioCodec);let c;if(t.pts!==void 0)c=t.pts;else if(s){let p=Oy(e.samplerate);c=s.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,f;for(;a<l;)if(f=My(e,n,a,c,h),a+=f.length,f.missing){this.aacOverFlow=f;break}else for(h++;a<l-1&&!rl(n,a);a++);}parseMPEGPES(e,t){let i=t.data,s=i.length,n=0,a=0,l=t.pts;if(l===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if($y(i,a)){let c=By(e,i,a,l,n);if(c)a+=c.length,n++;else break}else a++}parseAC3PES(e,t){{let i=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}let n=i.length,a=0,l=0,c;for(;l<n&&(c=Vy(e,i,l,s,a++))>0;)l+=c}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}let i=it({},t,{type:this._videoTrack?ai.emsg:ai.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}};function Bc(r,e){return((r[e+1]&31)<<8)+r[e+2]}function J0(r,e){return(r[e+10]&31)<<8|r[e+11]}function Z0(r,e,t,i,s,n){let a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=(r[e+1]&15)<<8|r[e+2],c=e+3+l-4,h=(r[e+10]&15)<<8|r[e+11];for(e+=12+h;e<c;){let f=Bc(r,e),p=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!i){nh("ADTS AAC",n);break}case 15:a.audioPid===-1&&(a.audioPid=f);break;case 21:a.id3Pid===-1&&(a.id3Pid=f);break;case 219:if(!i){nh("H.264",n);break}case 27:a.videoPid===-1&&(a.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?n.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=f,a.segmentAudioCodec="mp3");break;case 193:if(!i){nh("AC-3",n);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=f,a.segmentAudioCodec="ac3"):n.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&p>0){let m=e+5,_=p;for(;_>2;){switch(r[m]){case 106:t.ac3!==!0?n.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=f,a.segmentAudioCodec="ac3");break}let S=r[m+1]+2;m+=S,_-=S}}break;case 194:case 135:return Uc(s,new Error("Unsupported EC-3 in M2TS found"),void 0,n),a;case 36:a.videoPid===-1&&(a.videoPid=f,a.segmentVideoCodec="hevc",n.log("HEVC in M2TS found"));break}e+=p+5}return a}function Uc(r,e,t,i){i.warn(`parsing error: ${e.message}`),r.emit(L.ERROR,L.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function nh(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function xr(r,e){let t=0,i,s,n,a,l,c=r.data;if(!r||r.size===0)return null;for(;c[0].length<19&&c.length>1;)c[0]=yi(c[0],c[1]),c.splice(1,1);if(i=c[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(s=(i[4]<<8)+i[5],s&&s>r.size-6)return null;let f=i[7];f&192&&(a=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,f&64?(l=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,a-l>60*9e4&&(e.warn(`${Math.round((a-l)/9e4)}s delta between PTS and DTS, align them`),a=l)):l=a),n=i[8];let p=n+9;if(r.size<=p)return null;r.size-=p;let m=new Uint8Array(r.size);for(let _=0,E=c.length;_<E;_++){i=c[_];let S=i.byteLength;if(p)if(p>S){p-=S;continue}else i=i.subarray(p),S-=p,p=0;m.set(i,t),t+=S}return s&&(s-=n+3),{data:m,pts:a,dts:l,len:s}}return null}var $c=class{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}},Es=Math.pow(2,32)-1,Or=(()=>{class r{static init(){r.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in r.types)r.types.hasOwnProperty(t)&&(r.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);let i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);r.HDLR_TYPES={video:i,audio:s};let n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);r.STTS=r.STSC=r.STCO=a,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);let l=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);r.FTYP=r.box(r.types.ftyp,l,h,l,c),r.DINF=r.box(r.types.dinf,r.box(r.types.dref,n))}static box(t,...i){let s=8,n=i.length,a=n;for(;n--;)s+=i[n].byteLength;let l=new Uint8Array(s);for(l[0]=s>>24&255,l[1]=s>>16&255,l[2]=s>>8&255,l[3]=s&255,l.set(t,4),n=0,s=8;n<a;n++)l.set(i[n],s),s+=i[n].byteLength;return l}static hdlr(t){return r.box(r.types.hdlr,r.HDLR_TYPES[t])}static mdat(t){return r.box(r.types.mdat,t)}static mdhd(t,i){i*=t;let s=Math.floor(i/(Es+1)),n=Math.floor(i%(Es+1));return r.box(r.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(t){return r.box(r.types.mdia,r.mdhd(t.timescale||0,t.duration||0),r.hdlr(t.type),r.minf(t))}static mfhd(t){return r.box(r.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?r.box(r.types.minf,r.box(r.types.smhd,r.SMHD),r.DINF,r.stbl(t)):r.box(r.types.minf,r.box(r.types.vmhd,r.VMHD),r.DINF,r.stbl(t))}static moof(t,i,s){return r.box(r.types.moof,r.mfhd(t),r.traf(s,i))}static moov(t){let i=t.length,s=[];for(;i--;)s[i]=r.trak(t[i]);return r.box.apply(null,[r.types.moov,r.mvhd(t[0].timescale||0,t[0].duration||0)].concat(s).concat(r.mvex(t)))}static mvex(t){let i=t.length,s=[];for(;i--;)s[i]=r.trex(t[i]);return r.box.apply(null,[r.types.mvex,...s])}static mvhd(t,i){i*=t;let s=Math.floor(i/(Es+1)),n=Math.floor(i%(Es+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r.box(r.types.mvhd,a)}static sdtp(t){let i=t.samples||[],s=new Uint8Array(4+i.length),n,a;for(n=0;n<i.length;n++)a=i[n].flags,s[n+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return r.box(r.types.sdtp,s)}static stbl(t){return r.box(r.types.stbl,r.stsd(t),r.box(r.types.stts,r.STTS),r.box(r.types.stsc,r.STSC),r.box(r.types.stsz,r.STSZ),r.box(r.types.stco,r.STCO))}static avc1(t){let i=[],s=[],n,a,l;for(n=0;n<t.sps.length;n++)a=t.sps[n],l=a.byteLength,i.push(l>>>8&255),i.push(l&255),i=i.concat(Array.prototype.slice.call(a));for(n=0;n<t.pps.length;n++)a=t.pps[n],l=a.byteLength,s.push(l>>>8&255),s.push(l&255),s=s.concat(Array.prototype.slice.call(a));let c=r.box(r.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(s))),h=t.width,f=t.height,p=t.pixelRatio[0],m=t.pixelRatio[1];return r.box(r.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,r.box(r.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),r.box(r.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(t){let i=t.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...i,6,1,2])}static audioStsd(t){let i=t.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount||0,0,16,0,0,0,0,i>>8&255,i&255,0,0])}static mp4a(t){return r.box(r.types.mp4a,r.audioStsd(t),r.box(r.types.esds,r.esds(t)))}static mp3(t){return r.box(r.types[".mp3"],r.audioStsd(t))}static ac3(t){return r.box(r.types["ac-3"],r.audioStsd(t),r.box(r.types.dac3,t.config))}static stsd(t){let{segmentCodec:i}=t;if(t.type==="audio"){if(i==="aac")return r.box(r.types.stsd,r.STSD,r.mp4a(t));if(i==="ac3"&&t.config)return r.box(r.types.stsd,r.STSD,r.ac3(t));if(i==="mp3"&&t.codec==="mp3")return r.box(r.types.stsd,r.STSD,r.mp3(t))}else if(t.pps&&t.sps){if(i==="avc")return r.box(r.types.stsd,r.STSD,r.avc1(t));if(i==="hevc"&&t.vps)return r.box(r.types.stsd,r.STSD,r.hvc1(t))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${t.type} segment codec (${i}/${t.codec})`)}static tkhd(t){let i=t.id,s=(t.duration||0)*(t.timescale||0),n=t.width||0,a=t.height||0,l=Math.floor(s/(Es+1)),c=Math.floor(s%(Es+1));return r.box(r.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,a>>8&255,a&255,0,0]))}static traf(t,i){let s=r.sdtp(t),n=t.id,a=Math.floor(i/(Es+1)),l=Math.floor(i%(Es+1));return r.box(r.types.traf,r.box(r.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),r.box(r.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255])),r.trun(t,s.length+16+20+8+16+8+8),s)}static trak(t){return t.duration=t.duration||4294967295,r.box(r.types.trak,r.tkhd(t),r.mdia(t))}static trex(t){let i=t.id;return r.box(r.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,i){let s=t.samples||[],n=s.length,a=12+16*n,l=new Uint8Array(a),c,h,f,p,m,_;for(i+=8+a,l.set([t.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255],0),c=0;c<n;c++)h=s[c],f=h.duration,p=h.size,m=h.flags,_=h.cts,l.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,p>>>24&255,p>>>16&255,p>>>8&255,p&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,_>>>24&255,_>>>16&255,_>>>8&255,_&255],12+16*c);return r.box(r.types.trun,l)}static initSegment(t){r.types||r.init();let i=r.moov(t);return yi(r.FTYP,i)}static hvc1(t){let i=t.params,s=[t.vps,t.sps,t.pps],n=4,a=new Uint8Array([1,i.general_profile_space<<6|(i.general_tier_flag?32:0)|i.general_profile_idc,i.general_profile_compatibility_flags[0],i.general_profile_compatibility_flags[1],i.general_profile_compatibility_flags[2],i.general_profile_compatibility_flags[3],i.general_constraint_indicator_flags[0],i.general_constraint_indicator_flags[1],i.general_constraint_indicator_flags[2],i.general_constraint_indicator_flags[3],i.general_constraint_indicator_flags[4],i.general_constraint_indicator_flags[5],i.general_level_idc,240|i.min_spatial_segmentation_idc>>8,255&i.min_spatial_segmentation_idc,252|i.parallelismType,252|i.chroma_format_idc,248|i.bit_depth_luma_minus8,248|i.bit_depth_chroma_minus8,0,parseInt(i.frame_rate.fps),n-1|i.temporal_id_nested<<2|i.num_temporal_layers<<3|(i.frame_rate.fixed?64:0),s.length]),l=a.length;for(let S=0;S<s.length;S+=1){l+=3;for(let C=0;C<s[S].length;C+=1)l+=2+s[S][C].length}let c=new Uint8Array(l);c.set(a,0),l=a.length;let h=s.length-1;for(let S=0;S<s.length;S+=1){c.set(new Uint8Array([32+S|(S===h?128:0),0,s[S].length]),l),l+=3;for(let C=0;C<s[S].length;C+=1)c.set(new Uint8Array([s[S][C].length>>8,s[S][C].length&255]),l),l+=2,c.set(s[S][C],l),l+=s[S][C].length}let f=r.box(r.types.hvcC,c),p=t.width,m=t.height,_=t.pixelRatio[0],E=t.pixelRatio[1];return r.box(r.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>8&255,p&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,r.box(r.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),r.box(r.types.pasp,new Uint8Array([_>>24,_>>16&255,_>>8&255,_&255,E>>24,E>>16&255,E>>8&255,E&255])))}}return r.types=void 0,r.HDLR_TYPES=void 0,r.STTS=void 0,r.STSC=void 0,r.STCO=void 0,r.STSZ=void 0,r.VMHD=void 0,r.SMHD=void 0,r.STSD=void 0,r.FTYP=void 0,r.DINF=void 0,r})(),Gy=9e4;function Bf(r,e,t=1,i=!1){let s=r*e*t;return i?Math.round(s):s}function eC(r,e,t=1,i=!1){return Bf(r,e,1/t,i)}function An(r,e=!1){return Bf(r,1e3,1/Gy,e)}function tC(r,e=1){return Bf(r,Gy,1/e)}var iC=10*1e3,sC=1024,rC=1152,nC=1536,Mr=null,ah=null;function fm(r,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}var qr=class extends li{constructor(e,t,i,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,Mr===null){let a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Mr=a?parseInt(a[1]):0}if(ah===null){let n=navigator.userAgent.match(/Safari\/(\d+)/i);ah=n?parseInt(n[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1,i=e[0].pts,s=e.reduce((n,a)=>{let l=a.pts,c=l-n;return c<-4294967296&&(t=!0,l=gi(l,i),c=l-n),c>0?n:l},i);return t&&this.debug("PTS rollover detected"),s}remux(e,t,i,s,n,a,l,c){let h,f,p,m,_,E,S=n,C=n,I=e.pid>-1,R=t.pid>-1,k=t.samples.length,D=e.samples.length>0,x=l&&k>0||k>1;if((!I||D)&&(!R||x)||this.ISGenerated||l){if(this.ISGenerated){var B,H,O,P;let te=this.videoTrackConfig;(te&&(t.width!==te.width||t.height!==te.height||((B=t.pixelRatio)==null?void 0:B[0])!==((H=te.pixelRatio)==null?void 0:H[0])||((O=t.pixelRatio)==null?void 0:O[1])!==((P=te.pixelRatio)==null?void 0:P[1]))||!te&&x||this.nextAudioTs===null&&D)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,n,a));let G=this.isVideoContiguous,Q=-1,ie;if(x&&(Q=aC(t.samples),!G&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,Q>0){this.warn(`Dropped ${Q} out of ${k} video samples due to a missing keyframe`);let te=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(Q),t.dropped+=Q,C+=(t.samples[0].pts-te)/t.inputTimeScale,ie=C}else Q===-1&&(this.warn(`No keyframe found out of ${k} video samples`),E=!1);if(this.ISGenerated){if(D&&x){let te=this.getVideoStartPts(t.samples),ne=(gi(e.samples[0].pts,te)-te)/t.inputTimeScale;S+=Math.max(0,ne),C+=Math.max(0,-ne)}if(D){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,n,a)),f=this.remuxAudio(e,S,this.isAudioContiguous,a,R||x||c===Ae.AUDIO?C:void 0),x){let te=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,n,a)),h=this.remuxVideo(t,C,G,te)}}else x&&(h=this.remuxVideo(t,C,G,0));h&&(h.firstKeyFrame=Q,h.independent=Q!==-1,h.firstKeyFramePTS=ie)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(_=Ky(i,n,this._initPTS,this._initDTS)),s.samples.length&&(m=qy(s,n,this._initPTS))),{audio:f,video:h,initSegment:p,independent:E,text:m,id3:_}}generateIS(e,t,i,s){let n=e.samples,a=t.samples,l=this.typeSupported,c={},h=this._initPTS,f=!h||s,p="audio/mp4",m,_,E,S;if(f&&(m=_=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":l.mpeg?(p="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}c.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&l.mpeg?new Uint8Array(0):Or.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(S=e.id,E=e.inputTimeScale,!h||E!==h.timescale?m=_=n[0].pts-Math.round(E*i):f=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Or.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(S=t.id,E=t.inputTimeScale,!h||E!==h.timescale){let C=this.getVideoStartPts(a),I=Math.round(E*i);_=Math.min(_,gi(a[0].dts,C)-I),m=Math.min(m,C-I)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,f?(this._initPTS={baseTime:m,timescale:E},this._initDTS={baseTime:_,timescale:E}):m=E=void 0,{tracks:c,initPTS:m,timescale:E,trackId:S}}remuxVideo(e,t,i,s){let n=e.inputTimeScale,a=e.samples,l=[],c=a.length,h=this._initPTS,f=h.baseTime*n/h.timescale,p=this.nextVideoTs,m=8,_=this.videoSampleDuration,E,S,C=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,R=!1;if(!i||p===null){let oe=f+t*n,Y=a[0].pts-gi(a[0].dts,a[0].pts);Mr&&p!==null&&Math.abs(oe-Y-(p+f))<15e3?i=!0:p=oe-Y-f}let k=p+f;for(let oe=0;oe<c;oe++){let Y=a[oe];Y.pts=gi(Y.pts,k),Y.dts=gi(Y.dts,k),Y.dts<a[oe>0?oe-1:oe].dts&&(R=!0)}R&&a.sort(function(oe,Y){let ee=oe.dts-Y.dts,be=oe.pts-Y.pts;return ee||be}),E=a[0].dts,S=a[a.length-1].dts;let D=S-E,x=D?Math.round(D/(c-1)):_||e.inputTimeScale/30;if(i){let oe=E-k,Y=oe>x,ee=oe<-1;if((Y||ee)&&(Y?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${An(oe,!0)} ms (${oe}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${An(-oe,!0)} ms (${oe}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ee||k>=a[0].pts||Mr)){E=k;let be=a[0].pts-oe;if(Y)a[0].dts=E,a[0].pts=be;else{let Ee=!0;for(let Re=0;Re<a.length&&!(a[Re].dts>be&&Ee);Re++){let Oe=a[Re].pts;if(a[Re].dts-=oe,a[Re].pts-=oe,Re<a.length-1){let Pe=a[Re+1].pts,Be=a[Re].pts,Ve=Pe<=Be,Je=Pe<=Oe;Ee=Ve==Je}}}this.log(`Video: Initial PTS/DTS adjusted: ${An(be,!0)}/${An(E,!0)}, delta: ${An(oe,!0)} ms`)}}E=Math.max(0,E);let N=0,B=0,H=E;for(let oe=0;oe<c;oe++){let Y=a[oe],ee=Y.units,be=ee.length,Ee=0;for(let Re=0;Re<be;Re++)Ee+=ee[Re].data.length;B+=Ee,N+=be,Y.length=Ee,Y.dts<H?(Y.dts=H,H+=x/4|0||1):H=Y.dts,C=Math.min(Y.pts,C),I=Math.max(Y.pts,I)}S=a[c-1].dts;let O=B+4*N+8,P;try{P=new Uint8Array(O)}catch(oe){this.observer.emit(L.ERROR,L.ERROR,{type:Le.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:oe,bytes:O,reason:`fail allocating video mdat ${O}`});return}let G=new DataView(P.buffer);G.setUint32(0,O),P.set(Or.types.mdat,4);let Q=!1,ie=Number.POSITIVE_INFINITY,te=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,ne=Number.NEGATIVE_INFINITY;for(let oe=0;oe<c;oe++){let Y=a[oe],ee=Y.units,be=0;for(let Oe=0,Pe=ee.length;Oe<Pe;Oe++){let Be=ee[Oe],Ve=Be.data,Je=Be.data.byteLength;G.setUint32(m,Je),m+=4,P.set(Ve,m),m+=Je,be+=4+Je}let Ee;if(oe<c-1)_=a[oe+1].dts-Y.dts,Ee=a[oe+1].pts-Y.pts;else{let Oe=this.config,Pe=oe>0?Y.dts-a[oe-1].dts:x;if(Ee=oe>0?Y.pts-a[oe-1].pts:x,Oe.stretchShortVideoTrack&&this.nextAudioTs!==null){let Be=Math.floor(Oe.maxBufferHole*n),Ve=(s?C+s*n:this.nextAudioTs+f)-Y.pts;Ve>Be?(_=Ve-Pe,_<0?_=Pe:Q=!0,this.log(`It is approximately ${Ve/90} ms to the next segment; using duration ${_/90} ms for the last video frame.`)):_=Pe}else _=Pe}let Re=Math.round(Y.pts-Y.dts);ie=Math.min(ie,_),re=Math.max(re,_),te=Math.min(te,Ee),ne=Math.max(ne,Ee),l.push(fm(Y.key,_,be,Re))}if(l.length){if(Mr){if(Mr<70){let oe=l[0].flags;oe.dependsOn=2,oe.isNonSync=0}}else if(ah&&ne-te<re-ie&&x/re<.025&&l[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let oe=E;for(let Y=0,ee=l.length;Y<ee;Y++){let be=oe+l[Y].duration,Ee=oe+l[Y].cts;if(Y<ee-1){let Re=be+l[Y+1].cts;l[Y].duration=Re-Ee}else l[Y].duration=Y?l[Y-1].duration:x;l[Y].cts=0,oe=be}}}_=Q||!_?x:_;let de=S+_;this.nextVideoTs=p=de-f,this.videoSampleDuration=_,this.isVideoContiguous=!0;let se={data1:Or.moof(e.sequenceNumber++,E,it(e,{samples:l})),data2:P,startPTS:(C-f)/n,endPTS:(I+_-f)/n,startDTS:(E-f)/n,endDTS:p/n,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,se}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return rC;case"ac3":return nC;default:return sC}}remuxAudio(e,t,i,s,n){let a=e.inputTimeScale,l=e.samplerate?e.samplerate:a,c=a/l,h=this.getSamplesPerFrame(e),f=h*c,p=this._initPTS,m=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,_=[],E=n!==void 0,S=e.samples,C=m?0:8,I=this.nextAudioTs||-1,R=p.baseTime*a/p.timescale,k=R+t*a;if(this.isAudioContiguous=i=i||S.length&&I>0&&(s&&Math.abs(k-(I+R))<9e3||Math.abs(gi(S[0].pts,k)-(I+R))<20*f),S.forEach(function(ne){ne.pts=gi(ne.pts,k)}),!i||I<0){if(S=S.filter(ne=>ne.pts>=0),!S.length)return;n===0?I=0:s&&!E?I=Math.max(0,k-R):I=S[0].pts-R}if(e.segmentCodec==="aac"){let ne=this.config.maxAudioFramesDrift;for(let de=0,Z=I+R;de<S.length;de++){let ae=S[de],se=ae.pts,oe=se-Z,Y=Math.abs(1e3*oe/a);if(oe<=-ne*f&&E)de===0&&(this.warn(`Audio frame @ ${(se/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*oe/a)} ms.`),this.nextAudioTs=I=se-R,Z=se);else if(oe>=ne*f&&Y<iC&&E){let ee=Math.round(oe/f);for(Z=se-ee*f;Z<0&&ee&&f;)ee--,Z+=f;de===0&&(this.nextAudioTs=I=Z-R),this.warn(`Injecting ${ee} audio frames @ ${((Z-R)/a).toFixed(3)}s due to ${Math.round(1e3*oe/a)} ms gap.`);for(let be=0;be<ee;be++){let Ee=$c.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Ee||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Ee=ae.unit.subarray()),S.splice(de,0,{unit:Ee,pts:Z}),Z+=f,de++}}ae.pts=Z,Z+=f}}let D=null,x=null,N,B=0,H=S.length;for(;H--;)B+=S[H].unit.byteLength;for(let ne=0,de=S.length;ne<de;ne++){let Z=S[ne],ae=Z.unit,se=Z.pts;if(x!==null){let Y=_[ne-1];Y.duration=Math.round((se-x)/c)}else if(i&&e.segmentCodec==="aac"&&(se=I+R),D=se,B>0){B+=C;try{N=new Uint8Array(B)}catch(Y){this.observer.emit(L.ERROR,L.ERROR,{type:Le.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:B,reason:`fail allocating audio mdat ${B}`});return}m||(new DataView(N.buffer).setUint32(0,B),N.set(Or.types.mdat,4))}else return;N.set(ae,C);let oe=ae.byteLength;C+=oe,_.push(fm(!0,h,oe,0)),x=se}let O=_.length;if(!O)return;let P=_[_.length-1];I=x-R,this.nextAudioTs=I+c*P.duration;let G=m?new Uint8Array(0):Or.moof(e.sequenceNumber++,D/c,it({},e,{samples:_}));e.samples=[];let Q=(D-R)/a,ie=I/a,re={data1:G,data2:N,startPTS:Q,endPTS:ie,startDTS:Q,endDTS:ie,type:"audio",hasAudio:!0,hasVideo:!1,nb:O};return this.isAudioContiguous=!0,re}};function gi(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function aC(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function Ky(r,e,t,i){let s=r.samples.length;if(!s)return;let n=r.inputTimeScale;for(let l=0;l<s;l++){let c=r.samples[l];c.pts=gi(c.pts-t.baseTime*n/t.timescale,e*n)/n,c.dts=gi(c.dts-i.baseTime*n/i.timescale,e*n)/n}let a=r.samples;return r.samples=[],{samples:a}}function qy(r,e,t){let i=r.samples.length;if(!i)return;let s=r.inputTimeScale;for(let a=0;a<i;a++){let l=r.samples[a];l.pts=gi(l.pts-t.baseTime*s/t.timescale,e*s)/s}r.samples.sort((a,l)=>a.pts-l.pts);let n=r.samples;return r.samples=[],{samples:n}}var Hc=class extends li{constructor(e,t,i,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;let t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,s){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(fS(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}let s=this.initData=ly(e);s.audio&&(t=pm(s.audio,lt.AUDIO,this)),s.video&&(i=pm(s.video,lt.VIDEO,this));let n={};s.audio&&s.video?n.audiovideo={container:"video/mp4",codec:t+","+i,supplemental:s.video.supplemental,initSegment:e,id:"main"}:s.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?n.video={container:"video/mp4",codec:i,supplemental:s.video.supplemental,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=n}remux(e,t,i,s,n,a){var l,c;let{initPTS:h,lastEndTime:f}=this,p={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};Ce(f)||(f=this.lastEndTime=n||0);let m=t.samples;if(!(m!=null&&m.length))return p;let _={initPTS:void 0,timescale:void 0,trackId:void 0},E=this.initData;if((l=E)!=null&&l.length||(this.generateInitSegment(m),E=this.initData),!((c=E)!=null&&c.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(_.tracks=this.initTracks,this.emitInitSegment=!1);let S=gS(m,E,this),C=E.audio?S[E.audio.id]:null,I=E.video?S[E.video.id]:null,R=ro(I,1/0),k=ro(C,1/0),D=ro(I,0,!0),x=ro(C,0,!0),N,B=n,H=0;if(C&&(!I||!h&&k<R||h&&h.trackId===E.audio.id)?(_.trackId=E.audio.id,N=C,H=x-k):I&&(_.trackId=E.video.id,N=I,H=D-R),N){let ne=N.timescale;B=N.start/ne,_.initPTS=N.start-n*ne,_.timescale=ne,h||(this.initPTS=h={baseTime:_.initPTS,timescale:ne,trackId:_.trackId})}(a||!h)&&(oC(h,B,n,H)||_.timescale!==h.timescale)&&(_.initPTS=B-n,_.timescale=1,h&&h.timescale===1&&this.warn(`Adjusting initPTS @${n} from ${h.baseTime/h.timescale} to ${_.initPTS}`),this.initPTS=h={baseTime:_.initPTS,timescale:1});let O=e?B-h.baseTime/h.timescale:f,P=O+H;H>0?this.lastEndTime=P:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());let G=!!E.audio,Q=!!E.video,ie="";G&&(ie+="audio"),Q&&(ie+="video");let te={data1:m,startPTS:O,startDTS:O,endPTS:P,endDTS:P,type:ie,hasAudio:G,hasVideo:Q,nb:1,dropped:0};p.audio=G&&!Q?te:void 0,p.video=Q?te:void 0;let re=I?.sampleCount;if(re){let ne=I.keyFrameIndex,de=ne!==-1;te.nb=re,te.dropped=ne===0||this.isVideoContiguous?0:de?ne:re,te.independent=de,te.firstKeyFrame=ne,de&&I.keyFrameStart&&(te.firstKeyFramePTS=(I.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(p.independent=de),this.isVideoContiguous||(this.isVideoContiguous=de),te.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${ne}/${re} dropped: ${te.dropped} start: ${te.firstKeyFramePTS||"NA"}`)}return p.initSegment=_,p.id3=Ky(i,n,h,h),s.samples.length&&(p.text=qy(s,n,h)),p}};function ro(r,e,t=!1){return r?.start!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function oC(r,e,t,i){if(r===null)return!0;let s=Math.max(i,1),n=e-r.baseTime/r.timescale;return Math.abs(n-t)>s}function pm(r,e,t){let i=r?.codec;return i&&i.length>4?i:e===lt.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?qo(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}var ss;try{ss=self.performance.now.bind(self.performance)}catch{ss=Date.now}var Io=[{demux:Mc,remux:Hc},{demux:Nc,remux:qr},{demux:Dc,remux:qr},{demux:Oc,remux:qr}];Io.splice(2,0,{demux:xc,remux:qr});var ll=class{constructor(e,t,i,s,n,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=n,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,s){let n=i.transmuxing;n.executeStart=ss();let a=new Uint8Array(e),{currentTransmuxState:l,transmuxConfig:c}=this;s&&(this.currentTransmuxState=s);let{contiguous:h,discontinuity:f,trackSwitch:p,accurateTimeOffset:m,timeOffset:_,initSegmentChange:E}=s||l,{audioCodec:S,videoCodec:C,defaultInitPts:I,duration:R,initSegmentData:k}=c,D=lC(a,t);if(D&&Kr(D.method)){let H=this.getDecrypter(),O=Df(D.method);if(H.isSync()){let P=H.softwareDecrypt(a,D.key.buffer,D.iv.buffer,O);if(i.part>-1){let Q=H.flush();P=Q&&Q.buffer}if(!P)return n.executeEnd=ss(),oh(i);a=new Uint8Array(P)}else return this.asyncResult=!0,this.decryptionPromise=H.webCryptoDecrypt(a,D.key.buffer,D.iv.buffer,O).then(P=>{let G=this.push(P,null,i);return this.decryptionPromise=null,G}),this.decryptionPromise}let x=this.needsProbing(f,p);if(x){let H=this.configureTransmuxer(a);if(H)return this.logger.warn(`[transmuxer] ${H.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:H,reason:H.message}),n.executeEnd=ss(),oh(i)}(f||p||E||x)&&this.resetInitSegment(k,S,C,R,t),(f||E||x)&&this.resetInitialTimestamp(I),h||this.resetContiguity();let N=this.transmux(a,D,_,m,i);this.asyncResult=ra(N);let B=this.currentTransmuxState;return B.contiguous=!0,B.discontinuity=!1,B.trackSwitch=!1,n.executeEnd=ss(),N}flush(e){let t=e.transmuxing;t.executeStart=ss();let{decrypter:i,currentTransmuxState:s,decryptionPromise:n}=this;if(n)return this.asyncResult=!0,n.then(()=>this.flush(e));let a=[],{timeOffset:l}=s;if(i){let p=i.flush();p&&a.push(this.push(p.buffer,null,e))}let{demuxer:c,remuxer:h}=this;if(!c||!h){t.executeEnd=ss();let p=[oh(e)];return this.asyncResult?Promise.resolve(p):p}let f=c.flush(l);return ra(f)?(this.asyncResult=!0,f.then(p=>(this.flushRemux(a,p,e),a))):(this.flushRemux(a,f,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,i){let{audioTrack:s,videoTrack:n,id3Track:a,textTrack:l}=t,{accurateTimeOffset:c,timeOffset:h}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===Ae.MAIN?"level":"track"} ${i.level}`);let f=this.remuxer.remux(s,n,a,l,h,c,!0,this.id);e.push({remuxResult:f,chunkMeta:i}),i.transmuxing.executeEnd=ss()}resetInitialTimestamp(e){let{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){let{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,s,n){let{demuxer:a,remuxer:l}=this;!a||!l||(a.resetInitSegment(e,t,i,s),l.resetInitSegment(e,t,i,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,s,n){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,i,s,n):a=this.transmuxUnencrypted(e,i,s,n),a}transmuxUnencrypted(e,t,i,s){let{audioTrack:n,videoTrack:a,id3Track:l,textTrack:c}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,a,l,c,t,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,i,s,n){return this.demuxer.demuxSampleAes(e,t,i).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,i,s,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){let{config:t,observer:i,typeSupported:s}=this,n;for(let p=0,m=Io.length;p<m;p++){var a;if((a=Io[p].demux)!=null&&a.probe(e,this.logger)){n=Io[p];break}}if(!n)return new Error("Failed to find demuxer by probing fragment data");let l=this.demuxer,c=this.remuxer,h=n.remux,f=n.demux;(!c||!(c instanceof h))&&(this.remuxer=new h(i,t,s,this.logger)),(!l||!(l instanceof f))&&(this.demuxer=new f(i,t,s,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Jn(this.config)),e}};function lC(r,e){let t=null;return r.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}var oh=r=>({remuxResult:{},chunkMeta:r});function ra(r){return"then"in r&&r.then instanceof Function}var jc=class{constructor(e,t,i,s,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=s,this.defaultInitPts=n||null}},Vc=class{constructor(e,t,i,s,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=n,this.initSegmentChange=a}},gm=0,ul=class{constructor(e,t,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=gm++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=c=>{let h=c.data,f=this.hls;if(!(!f||!(h!=null&&h.event)||h.instanceNo!==this.instanceNo))switch(h.event){case"init":{var p;let m=(p=this.workerContext)==null?void 0:p.objectURL;m&&self.URL.revokeObjectURL(m);break}case"transmuxComplete":{this.handleTransmuxComplete(h.data);break}case"flush":{this.onFlush(h.data);break}case"workerLog":{f.logger[h.data.logType]&&f.logger[h.data.logType](h.data.message);break}default:{h.data=h.data||{},h.data.frag=this.frag,h.data.part=this.part,h.data.id=this.id,f.trigger(h.event,h.data);break}}},this.onWorkerError=c=>{if(!this.hls)return;let h=new Error(`${c.message}  (${c.filename}:${c.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:Le.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})};let n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;let a=(c,h)=>{h=h||{},h.frag=this.frag||void 0,c===L.ERROR&&(h=h,h.parent=this.id,h.part=this.part,this.error=h.error),this.hls.trigger(c,h)};this.observer=new xf,this.observer.on(L.FRAG_DECRYPTED,a),this.observer.on(L.ERROR,a);let l=Mg(n.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){let c=this.hls.logger;if(n.workerPath||S0()){try{n.workerPath?(c.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=w0(n.workerPath)):(c.log(`injecting Web Worker for "${t}"`),this.workerContext=C0());let{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:l,id:t,config:ft(n)})}catch(f){c.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new ll(this.observer,l,n,"",t,e.logger)}return}}this.transmuxer=new ll(this.observer,l,n,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){let e=this.instanceNo;this.instanceNo=gm++;let t=this.hls.config,i=Mg(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:ft(t)})}}terminateWorker(){if(this.workerContext){let{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),A0(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{let t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,s,n,a,l,c,h,f){var p,m;h.transmuxing.start=self.performance.now();let{instanceNo:_,transmuxer:E}=this,S=a?a.start:n.start,C=n.decryptdata,I=this.frag,R=!(I&&n.cc===I.cc),k=!(I&&h.level===I.level),D=I?h.sn-I.sn:-1,x=this.part?h.part-this.part.index:-1,N=D===0&&h.id>1&&h.id===I?.stats.chunkCount,B=!k&&(D===1||D===0&&(x===1||N&&x<=0)),H=self.performance.now();(k||D||n.stats.parsing.start===0)&&(n.stats.parsing.start=H),a&&(x||!B)&&(a.stats.parsing.start=H);let O=!(I&&((p=n.initSegment)==null?void 0:p.url)===((m=I.initSegment)==null?void 0:m.url)),P=new Vc(R,B,c,k,S,O);if(!B||R||O){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${n.type} sn: ${h.sn}${h.part>-1?" part: "+h.part:""} ${this.id===Ae.MAIN?"level":"track"}: ${h.level} id: ${h.id}
        discontinuity: ${R}
        trackSwitch: ${k}
        contiguous: ${B}
        accurateTimeOffset: ${c}
        timeOffset: ${S}
        initSegmentChange: ${O}`);let G=new jc(i,s,t,l,f);this.configureTransmuxer(G)}if(this.frag=n,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:_,cmd:"demux",data:e,decryptdata:C,chunkMeta:h,state:P},e instanceof ArrayBuffer?[e]:[]);else if(E){let G=E.push(e,C,h,P);ra(G)?G.then(Q=>{this.handleTransmuxComplete(Q)}).catch(Q=>{this.transmuxerError(Q,h,"transmuxer-interface push error")}):this.handleTransmuxComplete(G)}}flush(e){e.transmuxing.start=self.performance.now();let{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){let s=i.flush(e);ra(s)?s.then(n=>{this.handleFlushResult(n,e)}).catch(n=>{this.transmuxerError(n,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){let{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}},mm=100,Gc=class extends ea{constructor(e,t,i){super(e,t,i,"audio-stream-controller",Ae.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){let{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:n}){if(i===Ae.MAIN){let a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:s,timescale:n},this.log(`InitPTS for cc: ${a} found from main: ${s}/${n}`),this.mainAnchor=t,this.state===he.WAITING_INIT_PTS){let c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(t,c?.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===he.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;let s=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&s?.cc===t.cc)return;let n=(s||e).cc,a=this.getLevelDetails(),l=this.getLoadPosition(),c=vy(a,n,l);c&&(this.log(`Syncing with main frag at ${c.start} cc ${c.cc}`),this.startFragRequested=!1,this.nextLoadPosition=c.start,this.resetLoadingState(),this.state===he.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=he.STOPPED;return}let i=this.lastCurrentTime;this.stopLoad(),this.setInterval(mm),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=he.IDLE):this.state=he.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case he.IDLE:this.doTickIdle();break;case he.WAITING_TRACK:{let{levels:t,trackId:i}=this,s=t?.[i],n=s?.details;if(n&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(n))break;this.state=he.WAITING_INIT_PTS}break}case he.FRAG_LOADING_WAITING_RETRY:{var e;let t=performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){let{levels:s,trackId:n}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(s?.[n]||null),this.state=he.IDLE}break}case he.WAITING_INIT_PTS:{let t=this.waitingData;if(t){let{frag:i,part:s,cache:n,complete:a}=t,l=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=he.FRAG_LOADING;let c=n.flush().buffer,h={frag:i,part:s,payload:c,networkDetails:null};this._handleFragmentLoadProgress(h),a&&super._handleFragmentLoadComplete(h)}else l&&l.cc!==t.frag.cc&&this.syncWithAnchor(l,t.frag)}else this.state=he.IDLE}}this.onTickEnd()}resetLoadingState(){let e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){let{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;let{hls:t,levels:i,media:s,trackId:n}=this,a=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(i!=null&&i[n]))return;let l=i[n],c=l.details;if(!c||this.waitForLive(l)||this.waitForCdnTuneIn(c)){this.state=he.WAITING_TRACK,this.startFragRequested=!1;return}let h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,lt.AUDIO,Ae.AUDIO));let f=this.getFwdBufferInfo(h,Ae.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,c)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=he.ENDED;return}let p=f.len,m=t.maxBufferLength,_=c.fragments,E=_[0].start,S=this.getLoadPosition(),C=this.flushing?S:f.end;if(this.switchingTrack&&s){let k=S;c.PTSKnown&&k<E&&(f.end>E||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=E+.05)}if(p>=m&&!this.switchingTrack&&C<_[_.length-1].start)return;let I=this.getNextFragment(C,c);if(I&&this.isLoopLoading(I,C)&&(I=this.getNextFragmentLoopLoading(I,c,f,Ae.MAIN,m)),!I){this.bufferFlushed=!0;return}let R=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&R&&Lt(I)&&!I.endList&&(!c.live||!this.loadingParts&&C<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(R)===Rt.OK&&(this.mainFragLoading=R=null),R&&Lt(R))){if(I.start>R.end){let D=this.fragmentTracker.getFragAtPos(C,Ae.MAIN);D&&D.end>R.end&&(R=D,this.mainFragLoading={frag:D,targetBufferTime:null})}if(I.start>R.end)return}this.loadFragment(I,l,C)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new hr(i))}onAudioTrackSwitching(e,t){let i=!!t.url;this.trackId=t.id;let{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==he.STOPPED&&(this.setInterval(mm),this.state=he.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;let i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;let{levels:s}=this,{details:n,id:a,groupId:l,track:c}=t;if(!s){this.warn(`Audio tracks reset while loading track ${a} "${c.name}" of "${l}"`);return}let h=this.mainDetails;if(!h||n.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=t,this.state!==he.STOPPED&&(this.state=he.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${c.name}" of "${l}" loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);let f=s[a],p=0;if(n.live||(i=f.details)!=null&&i.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;if(f.details){var m;p=this.alignPlaylists(n,f.details,(m=this.levelLastLoaded)==null?void 0:m.details)}n.alignedSliding||(ky(n,h),n.alignedSliding||il(n,h),p=n.fragmentStart)}f.details=n,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(h,p),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:n,id:a,groupId:t.groupId}),this.state===he.WAITING_TRACK&&!this.waitForCdnTuneIn(n)&&(this.state=he.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;let i=e.frag,{part:s,payload:n}=e,{config:a,trackId:l,levels:c}=this;if(!c){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let h=c[l];if(!h){this.warn("Audio track is undefined on fragment load progress");return}let f=h.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}let p=a.defaultAudioCodec||h.audioCodec||"mp4a.40.2",m=this.transmuxer;m||(m=this.transmuxer=new ul(this.hls,Ae.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));let _=this.initPTS[i.cc],E=(t=i.initSegment)==null?void 0:t.data;if(_!==void 0){let C=s?s.index:-1,I=C!==-1,R=new Zn(i.level,i.sn,i.stats.chunkCount,n.byteLength,C,I);m.push(n,E,p,"",i,s,f.totalduration,!1,R,_)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${f.startSN} ,${f.endSN}],track ${l}`);let{cache:S}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new sl,complete:!1};S.push(new Uint8Array(n)),this.state!==he.STOPPED&&(this.state=he.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;let i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Ae.MAIN&&Lt(t.frag)&&(this.mainFragLoading=t,this.state===he.IDLE&&this.tick())}onFragBuffered(e,t){let{frag:i,part:s}=t;if(i.type!==Ae.AUDIO){!this.audioOnly&&i.type===Ae.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Lt(i)){this.fragPrevious=i;let n=this.switchingTrack;n&&(this.bufferedTrack=n,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,rt({},n)))}this.fragBufferedComplete(i,s),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=he.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ae.AUDIO,t);break;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===he.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===Ge.AUDIO_TRACK&&(this.state=he.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==lt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==lt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===he.ENDED&&(this.state=he.IDLE);let i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,Ae.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;let i="audio",{hls:s}=this,{remuxResult:n,chunkMeta:a}=e,l=this.getCurrentContext(a);if(!l){this.resetWhenMissingContext(a);return}let{frag:c,part:h,level:f}=l,{details:p}=f,{audio:m,text:_,id3:E,initSegment:S}=n;if(this.fragContextChanged(c)||!p){this.fragmentTracker.removeFragment(c);return}if(this.state=he.PARSING,this.switchingTrack&&m&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){let C=c.initSegment||c;this._bufferInitSegment(f,S.tracks,C,a),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:i,tracks:S.tracks})}if(m){let{startPTS:C,endPTS:I,startDTS:R,endDTS:k}=m;h&&(h.elementaryStreams[lt.AUDIO]={startPTS:C,endPTS:I,startDTS:R,endDTS:k}),c.setElementaryStreamInfo(lt.AUDIO,C,I,R,k),this.bufferFragmentData(m,c,h,a)}if(E!=null&&(t=E.samples)!=null&&t.length){let C=it({id:i,frag:c,details:p},E);s.trigger(L.FRAG_PARSING_METADATA,C)}if(_){let C=it({id:i,frag:c,details:p},_);s.trigger(L.FRAG_PARSING_USERDATA,C)}}_bufferInitSegment(e,t,i,s){if(this.state!==he.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;let n=t.audio;n.id=Ae.AUDIO;let a=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${a}/${n.codec}]`),a&&a.split(",").length===1&&(n.levelCodec=a),this.hls.trigger(L.BUFFER_CODECS,t);let l=n.initSegment;if(l!=null&&l.byteLength){let c={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:l};this.hls.trigger(L.BUFFER_APPENDING,c)}this.tickImmediate()}loadFragment(e,t,i){let s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===Rt.NOT_LOADED||s===Rt.PARTIAL){var n;if(!Lt(e))this._loadInitSegment(e,t);else if((n=t.details)!=null&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=he.WAITING_INIT_PTS;let a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&il(t.details,a)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){let{name:t,lang:i,assocLang:s,characteristics:n,audioCodec:a,channels:l}=this.bufferedTrack;lr({name:t,lang:i,assocLang:s,characteristics:n,audioCodec:a,channels:l},e,tr)||(Yo(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){let{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,rt({},e))}},na=class extends li{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){let s=t?.renditionReports;if(s){let n=-1;for(let a=0;a<s.length;a++){let l=s[a],c;try{c=new self.URL(l.URI,t.url).href}catch(h){this.warn(`Could not construct new URL for Rendition Report: ${h}`),c=l.URI||""}if(c===e){n=a;break}else c===e.substring(0,c.length)&&(n=a)}if(n!==-1){let a=s[n],l=parseInt(a["LAST-MSN"])||t?.lastPartSn,c=parseInt(a["LAST-PART"])||t?.lastPartIndex;if(this.hls.config.lowLatencyMode){let f=Math.min(t.age-t.partTarget,t.targetduration);c>=0&&f>t.partTarget&&(c+=1)}let h=i&&Fg(i);return new zo(l,c>=0?c:void 0,h)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){let{details:s,stats:n}=t,a=self.performance.now(),l=n.loading.first?Math.max(0,a-n.loading.first):0;s.advancedDateTime=Date.now()-l;let c=this.hls.config.timelineOffset;if(c!==s.appliedTimelineOffset){let f=Math.max(c||0,0);s.appliedTimelineOffset=f,s.fragments.forEach(p=>{p.start=p.playlistOffset+f})}if(s.live||i!=null&&i.live){let f="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(i),i&&s.fragments.length>0){f0(i,s);let R=s.playlistParsingError;if(R){this.warn(R);let k=this.hls;if(!k.config.ignorePlaylistParsingErrors){var h;let{networkDetails:D}=t;k.trigger(L.ERROR,{type:Le.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:R,reason:R.message,level:t.level||void 0,parent:(h=s.fragments[0])==null?void 0:h.type,networkDetails:D,stats:n});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=n.loading.start);let p=this.hls.mainForwardBufferInfo,m=p?p.end-p.len:0,_=(s.edge-m)*1e3,E=Cy(s,_);if(s.requestScheduled+E<a?s.requestScheduled=a:s.requestScheduled+=E,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let S,C,I;if(s.canBlockReload&&s.endSN&&s.advanced){let R=this.hls.config.lowLatencyMode,k=s.lastPartSn,D=s.endSN,x=s.lastPartIndex,N=x!==-1,B=k===D;N?B?(C=D+1,I=R?0:x):(C=k,I=R?x+1:s.maxPartIndex):C=D+1;let H=s.age,O=H+s.ageHeader,P=Math.min(O-s.partTarget,s.targetduration*1.5);if(P>0){if(O>s.targetduration*3)this.log(`Playlist last advanced ${H.toFixed(2)}s ago. Omitting segment and part directives.`),C=void 0,I=void 0;else if(i!=null&&i.tuneInGoal&&O-s.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${P} with playlist age: ${s.age}`),P=0;else{let G=Math.floor(P/s.targetduration);if(C+=G,I!==void 0){let Q=Math.round(P%s.targetduration/s.partTarget);I+=Q}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${H.toFixed(2)}s goal: ${P} skip sn ${G} to part ${I}`)}s.tuneInGoal=P}if(S=this.getDeliveryDirectives(s,t.deliveryDirectives,C,I),R||!B){s.requestScheduled=a,this.loadingPlaylist(f,S);return}}else(s.canBlockReload||s.canSkipUntil)&&(S=this.getDeliveryDirectives(s,t.deliveryDirectives,C,I));S&&C!==void 0&&s.canBlockReload&&(s.requestScheduled=n.loading.first+Math.max(E-l*2,E/2)),this.scheduleLoading(f,S,s)}else this.clearTimer()}scheduleLoading(e,t,i){let s=i||e.details;if(!s){this.loadingPlaylist(e,t);return}let n=self.performance.now(),a=s.requestScheduled;if(n>=a){this.loadingPlaylist(e,t);return}let l=a-n;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(l)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),l)}getDeliveryDirectives(e,t,i,s){let n=Fg(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,n=wo.No),new zo(i,s,n)}checkRetry(e){let t=e.details,i=Xo(e),s=e.errorAction,{action:n,retryCount:a=0,retryConfig:l}=s||{},c=!!s&&!!l&&(n===jt.RetryRequest||!s.resolved&&n===jt.SendAlternateToPenaltyBox);if(c){var h;if(a>=l.maxNumRetry)return!1;if(i&&(h=e.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${l.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{let f=Pf(l,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${a+1}/${l.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,s.resolved=!0}return c}};function Wy(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!aa(r[t].attrs,e[t].attrs))return!1;return!0}function aa(r,e,t){let i=r["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>r[s]!==e[s])}function Kc(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}var qc=class extends na{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){let{id:i,groupId:s,details:n}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Audio track with id:${i} and group:${s} not found in active group ${a?.groupId}`);return}let l=a.details;a.details=t.details,this.log(`Audio track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${n.startSN}-${n.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.audioGroups||null,s=this.groupIds,n=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(l=>s?.indexOf(l)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let l=this.tracks.filter(m=>!i||i.indexOf(m.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(m=>m.default)&&(this.selectDefaultTrack=!1),l.forEach((m,_)=>{m.id=_});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=l;let c=this.hls.config.audioPreference;if(!n&&c){let m=qi(c,l,tr);if(m>-1)n=l[m];else{let _=qi(c,this.tracks);n=this.tracks[_]}}let h=this.findTrackId(n);h===-1&&n&&(h=this.findTrackId(null));let f={audioTracks:l};this.log(`Updating audio tracks, ${l.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,f);let p=this.trackId;if(h!==-1&&p===-1)this.setAudioTrack(h);else if(l.length&&p===-1){var a;let m=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${l.length}`);this.warn(m.message),this.hls.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ge.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){let t=this.hls;if(t.config.audioPreference=e,e){let i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){let s=this.currentTrack;if(s&&lr(e,s,tr))return s;let n=qi(e,this.tracksInGroup,tr);if(n>-1){let a=this.tracksInGroup[n];return this.setAudioTrack(n),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);let l=$S(e,t.levels,i,a,tr);if(l===-1)return null;t.nextLoadLevel=l}if(e.channels||e.audioCodec){let a=qi(e,i);if(a>-1)return i[a]}}}return null}setAudioTrack(e){let t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;let i=this.currentTrack,s=t[e],n=s.details&&!s.details.live;if(e===this.trackId&&s===i&&n||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,rt({},s)),n))return;let a=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(a)}findTrackId(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let s=t[i];if(!(this.selectDefaultTrack&&!s.default)&&(!e||lr(e,s,tr)))return i}if(e){let{name:i,lang:s,assocLang:n,characteristics:a,audioCodec:l,channels:c}=e;for(let h=0;h<t.length;h++){let f=t[h];if(lr({name:i,lang:s,assocLang:n,characteristics:a,audioCodec:l,channels:c},f,tr))return h}for(let h=0;h<t.length;h++){let f=t[h];if(aa(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<t.length;h++){let f=t[h];if(aa(e.attrs,f.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(e){super.loadPlaylist();let t=this.currentTrack;this.shouldLoadPlaylist(t)&&Yo(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=e.id,s=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,l=a?.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:n,id:i,groupId:s,deliveryDirectives:t||null,track:e})}},Wc=class{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;let s=this.queues[t];s.push(e),s.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{let i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){let i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;let i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;let t=this.queues[e];if(t.length){let s=t[0];try{s.execute()}catch(n){var i;if(s.onError(n),this.queues===null||this.tracks===null)return;let a=(i=this.tracks[e])==null?void 0:i.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){let{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;let i=(t=this.tracks)==null?void 0:t[e],s=i?.buffer;return s?`SourceBuffer${s.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}},vm=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,zy="HlsJsTrackRemovedError",zc=class extends Error{constructor(e){super(e),this.name=zy}},Yc=class extends li{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{let{media:s,mediaSource:n}=this;i&&this.log("Media source opened"),!(!s||!n)&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:s,mediaSource:n}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{let{mediaSrc:i,_objectUrl:s}=this;i!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=rS(Bs(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){let{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){let{media:e,mediaSource:t}=this;if(!e)return null;let i={};if(this.operationQueue){let n=this.isUpdating();n||this.operationQueue.removeBlockers();let a=this.isQueued();(n||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${n?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}let s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?it(i,s.tracks):this.sourceBuffers.forEach(n=>{let[a]=n;a&&(i[a]=it({},this.tracks[a]),this.removeBuffer(a)),n[0]=n[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){let e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){let i=this.media=t.media,s=Bs(this.appendSource);if(this.transferData=this.overrides=void 0,i&&s){let n=!!t.mediaSource;(n||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);let a=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(a),n)this._objectUrl=i.src,this.attachTransferred();else{let l=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");let c=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||c&&a instanceof c,ym(i),uC(i,l),i.load()}catch{i.src=l}else i.src=l}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){let e=this.media,t=this.transferData;if(!t||!e)return;let i=this.tracks,s=t.tracks,n=s?Object.keys(s):null,a=n?n.length:0,l=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(s&&n&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${ft(i,(c,h)=>c==="initSegment"?void 0:h)};
transfer tracks: ${ft(s,(c,h)=>c==="initSegment"?void 0:h)}}`),!iy(s,i)){t.mediaSource=null,t.tracks=void 0;let c=e.currentTime,h=this.details,f=Math.max(c,h?.fragments[0].start||0);if(f-c>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${c} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(i)}") start time: ${f} currentTime: ${c}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,n.forEach(c=>{let h=c,f=s[h];if(f){let p=f.buffer;if(p){let m=this.fragmentTracker,_=f.id;if(m.hasFragments(_)||m.hasParts(_)){let C=He.getBuffered(p);m.detectEvictedFragments(h,C,_,null,!0)}let E=lh(h),S=[h,p];this.sourceBuffers[E]=S,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(h),this.trackSourceBuffer(h,f)}}}),l(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),l()}get mediaSourceOpenOrEnded(){var e;let t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){let i=!!t.transferMedia;this.transferData=this.overrides=void 0;let{media:s,mediaSource:n,_objectUrl:a}=this;if(n){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([l])=>{l&&this.removeBuffer(l)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){let l=n.readyState==="open";try{let c=n.sourceBuffers;for(let h=c.length;h--;)l&&c[h].abort(),n.removeSourceBuffer(c[h]);l&&n.endOfStream()}catch(c){this.warn(`onMediaDetaching: ${c.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(n.removeEventListener("startstreaming",this._onStartStreaming),n.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),i||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(s.removeAttribute("src"),this.appendSource&&ym(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;let i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(n){this.warn(`onBufferReset ${e}`,n)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[lh(e)]=[null,null];let t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Wc(this.tracks)}onBufferCodecs(e,t){let i=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);let n="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),a=!n&&this.sourceBufferCount&&this.media&&s.some(l=>!i[l]);if(n||a){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(l=>{var c,h,f;let p=t[l],{id:m,codec:_,levelCodec:E,container:S,metadata:C,supplemental:I}=p,R=i[l],k=(c=this.transferData)==null||(h=c.tracks)==null?void 0:h[l],D=k!=null&&k.buffer?k:R,x=D?.pendingCodec||D?.codec,N=D?.levelCodec;R||(R=i[l]={buffer:void 0,listeners:[],codec:_,supplemental:I,container:S,levelCodec:E,metadata:C,id:m});let B=Co(x,N),H=B?.replace(vm,"$1"),O=Co(_,E),P=(f=O)==null?void 0:f.replace(vm,"$1");O&&B&&H!==P&&(l.slice(0,5)==="audio"&&(O=qo(O,this.appendSource)),this.log(`switching codec ${x} to ${O}`),O!==(R.pendingCodec||R.codec)&&(R.pendingCodec=O),R.container=S,this.appendChangeType(l,S,O))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{let i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){let s=`${t};codecs=${i}`,n={label:`change-type=${s}`,execute:()=>{let a=this.tracks[e];if(a){let l=a.buffer;l!=null&&l.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),l.changeType(s),a.codec=i,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(n,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;let i=e.start,s=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,Ae.MAIN))==null?void 0:t.gap)===!0)return;let a={label:"block-audio",execute:()=>{var l;let c=this.tracks.video;(this.lastVideoAppendEnd>s||c!=null&&c.buffer&&He.isBuffered(c.buffer,s)||((l=this.fragmentTracker.getAppendedFrag(s,Ae.MAIN))==null?void 0:l.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn("Error executing block-audio operation",l)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){let{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){let{tracks:i}=this,{data:s,type:n,parent:a,frag:l,part:c,chunkMeta:h,offset:f}=t,p=h.buffering[n],{sn:m,cc:_}=l,E=self.performance.now();p.start=E;let S=l.stats.buffering,C=c?c.stats.buffering:null;S.start===0&&(S.start=E),C&&C.start===0&&(C.start=E);let I=i.audio,R=!1;n==="audio"&&I?.container==="audio/mpeg"&&(R=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);let k=i.video,D=k?.buffer;if(D&&m!=="initSegment"){let B=c||l,H=this.blockedAudioAppend;if(n==="audio"&&a!=="main"&&!this.blockedAudioAppend){let P=B.start+B.duration*.05,G=D.buffered,Q=this.currentOp("video");!G.length&&!Q?this.blockAudio(B):!Q&&!He.isBuffered(D,P)&&this.lastVideoAppendEnd<P&&this.blockAudio(B)}else if(n==="video"){let O=B.end;if(H){let P=H.frag.start;(O>P||O<this.lastVideoAppendEnd||He.isBuffered(D,P))&&this.unblockAudio()}this.lastVideoAppendEnd=O}}let x=(c||l).start,N={label:`append-${n}`,execute:()=>{var B;p.executeStart=self.performance.now();let H=(B=this.tracks[n])==null?void 0:B.buffer;H&&(R?this.updateTimestampOffset(H,x,.1,n,m,_):f!==void 0&&Ce(f)&&this.updateTimestampOffset(H,f,1e-6,n,m,_)),this.appendExecutor(s,n)},onStart:()=>{},onComplete:()=>{let B=self.performance.now();p.executeEnd=p.end=B,S.first===0&&(S.first=B),C&&C.first===0&&(C.first=B);let H={};this.sourceBuffers.forEach(([O,P])=>{O&&(H[O]=He.getBuffered(P))}),this.appendErrors[n]=0,n==="audio"||n==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:n,frag:l,part:c,chunkMeta:h,parent:l.type,timeRanges:H})},onError:B=>{var H;let O={type:Le.MEDIA_ERROR,parent:l.type,details:z.BUFFER_APPEND_ERROR,sourceBufferName:n,frag:l,part:c,chunkMeta:h,error:B,err:B,fatal:!1},P=(H=this.media)==null?void 0:H.error;if(B.code===DOMException.QUOTA_EXCEEDED_ERR||B.name=="QuotaExceededError"||"quota"in B)O.details=z.BUFFER_FULL_ERROR;else if(B.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!P)O.errorAction=Qn(!0);else if(B.name===zy&&this.sourceBufferCount===0)O.errorAction=Qn(!0);else{let G=++this.appendErrors[n];this.warn(`Failed ${G}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${n}" sourceBuffer (${P||"no media error"})`),(G>=this.hls.config.appendErrorMaxRetry||P)&&(O.fatal=!0)}this.hls.trigger(L.ERROR,O)}};this.append(N,n,this.isPending(this.tracks[n]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){let{type:i,startOffset:s,endOffset:n}=t;i?this.append(this.getFlushOp(i,s,n),i):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,s,n),a)})}onFragParsed(e,t){let{frag:i,part:s}=t,n=[],a=s?s.elementaryStreams:i.elementaryStreams;a[lt.AUDIOVIDEO]?n.push("audiovideo"):(a[lt.AUDIO]&&n.push("audio"),a[lt.VIDEO]&&n.push("video"));let l=()=>{let c=self.performance.now();i.stats.buffering.end=c,s&&(s.stats.buffering.end=c);let h=s?s.stats:i.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:i,part:s,stats:h,id:i.type})};n.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(l,n).catch(c=>{this.warn(`Fragment buffered callback ${c}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,i;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((i=this.tracks[e])==null?void 0:i.ending))})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([a])=>{if(a){let l=this.tracks[a];(!t.type||t.type===a)&&(l.ending=!0,l.ended||(l.ended=!0,this.log(`${a} buffer reached EOS`)))}});let s=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var l;return a&&!((l=this.tracks[a])!=null&&l.ended)})&&(s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();let{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){let t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{let e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===z.BUFFER_APPEND_ERROR&&t.frag){var i;let s=(i=t.errorAction)==null?void 0:i.nextAutoLevel;Ce(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){let{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;let s=e.config,n=i.currentTime,a=t.levelTargetDuration,l=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(Ce(l)&&l>=0){let c=Math.max(l,a),h=Math.floor(n/a)*a-c;this.flushBackBuffer(n,a,h)}if(Ce(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){let c=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),h=Math.max(c,a),f=Math.floor(n/a)*a+h;this.flushFrontBuffer(n,a,f)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([s,n])=>{if(n){let l=He.getBuffered(n);if(l.length>0&&i>l.start(0)){var a;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:i});let c=this.tracks[s];if((a=this.details)!=null&&a.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(c!=null&&c.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:s})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([s,n])=>{if(n){let a=He.getBuffered(n),l=a.length;if(l<2)return;let c=a.start(l-1),h=a.end(l-1);if(i>c||e>=c&&e<=h)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;let{details:t,mediaSource:i}=this;if(!t||!this.media||i?.readyState!=="open")return null;let s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&i.setLiveSeekableRange){let h=Math.max(0,t.fragmentStart),f=Math.max(h,s);return{duration:1/0,start:h,end:f}}return{duration:1/0}}let n=(e=this.overrides)==null?void 0:e.duration;if(n)return Ce(n)?{duration:n}:null;let a=this.media.duration,l=Ce(i.duration)?i.duration:0;return s>l&&s>a||!Ce(a)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:i}){let s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(Ce(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${i}.`),s.setLiveSeekableRange(t,i)))}get tracksReady(){let e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){let{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${ft(i)}`),this.tracksReady){var s;let n=(s=this.transferData)==null?void 0:s.tracks;n&&Object.keys(n).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){let e={};this.sourceBuffers.forEach(([t,i])=>{if(t){let s=this.tracks[t];e[t]={buffer:i,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{let e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){let{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(let n in e){let a=n,l=e[a];if(this.isPending(l)){let c=this.getTrackCodec(l,a),h=`${l.container};codecs=${c}`;l.codec=c,this.log(`creating sourceBuffer(${h})${this.currentOp(a)?" Queued":""} ${ft(l)}`);try{let f=i.addSourceBuffer(h),p=lh(a),m=[a,f];t[p]=m,l.buffer=f}catch(f){var s;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(a),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[a],this.hls.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:a,mimeType:h,parent:l.id});return}this.trackSourceBuffer(a,l)}}this.bufferCreated()}getTrackCodec(e,t){let i=e.supplemental,s=e.codec;i&&(t==="video"||t==="audiovideo")&&mc(i,"video")&&(s=SS(s,i));let n=Co(s,e.levelCodec);return n?t.slice(0,5)==="audio"?qo(n,this.appendSource):n:""}trackSourceBuffer(e,t){let i=t.buffer;if(!i)return;let s=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(n,a)=>{let l=a.removedRanges;l!=null&&l.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:n})})}get mediaSrc(){var e,t;let i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}onSBUpdateStart(e){let t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}let i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;let s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${s}`,t),this.hls.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});let n=this.currentOp(e);n&&n.onError(s)}updateTimestampOffset(e,t,i,s,n,a){let l=t-e.timestampOffset;Math.abs(l)>=i&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${n} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,i){let{media:s,mediaSource:n}=this,a=this.tracks[e],l=a?.buffer;if(!s||!n||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}let c=Ce(s.duration)?s.duration:1/0,h=Ce(n.duration)?n.duration:1/0,f=Math.max(0,t),p=Math.min(i,c,h);p>f&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${f},${p}] from the ${e} SourceBuffer`),l.remove(f,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){let i=this.tracks[t],s=i?.buffer;if(!s)throw new zc(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);let{operationQueue:i}=this,s=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(a=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;let s=(i=this.tracks[t])==null?void 0:i.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){let s=this.tracks[e];if(!s)return;let n=s.buffer;if(!n)return;let a=i.bind(this,e);s.listeners.push({event:t,listener:a}),n.addEventListener(t,a)}removeBufferListeners(e){let t=this.tracks[e];if(!t)return;let i=t.buffer;i&&(t.listeners.forEach(s=>{i.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}};function ym(r){let e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function uC(r,e){let t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function lh(r){return r==="audio"?1:0}var Xc=class r{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){let{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){let{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){let i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){let i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ce(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}let e=this.hls.levels;if(e.length){let t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){let t=this.hls.levels;if(!t.length)return-1;let i=t.filter((s,n)=>this.isLevelAllowed(s)&&n<=e);return this.clientRect=null,r.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;let e=this.media,t={width:0,height:0};if(e){let i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;let s=(l,c)=>c?l.width!==c.width||l.height!==c.height:!0,n=e.length-1,a=Math.max(t,i);for(let l=0;l<e.length;l+=1){let c=e[l];if((c.width>=a||c.height>=a)&&s(c,e[l+1])){n=l;break}}return n}},hC={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Qt=hC,cC={HLS:"h"},dC=cC,fC="CMCD-Object",pC="CMCD-Request",gC="CMCD-Session",mC="CMCD-Status",Un={OBJECT:fC,REQUEST:pC,SESSION:gC,STATUS:mC},vC={[Un.OBJECT]:["br","ab","d","ot","tb","tpb","lb","tab","lab","url"],[Un.REQUEST]:["pb","bl","tbl","dl","ltc","mtp","nor","nrr","rc","sn","sta","su","ttfb","ttfbb","ttlb","cmsdd","cmsds","smrt","df","cs"],[Un.SESSION]:["cid","pr","sf","sid","st","v","msd"],[Un.STATUS]:["bs","bsd","cdn","rtp","bg","pt","ec","e"]},oa=class r{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof r?i:new r(i))),this.value=e,this.params=t}},yC="Dict";function TC(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function _C(r,e,t,i){return new Error(`failed to ${r} "${TC(e)}" as ${t}`,{cause:i})}function zi(r,e,t){return _C("serialize",r,e,t)}var hl=class{constructor(e){this.description=e}},Tm="Bare Item",EC="Boolean";function bC(r){if(typeof r!="boolean")throw zi(r,EC);return r?"?1":"?0"}function SC(r){return btoa(String.fromCharCode(...r))}var CC="Byte Sequence";function wC(r){if(ArrayBuffer.isView(r)===!1)throw zi(r,CC);return`:${SC(r)}:`}var AC="Integer";function IC(r){return r<-999999999999999||999999999999999<r}function Yy(r){if(IC(r))throw zi(r,AC);return r.toString()}function LC(r){return`@${Yy(r.getTime()/1e3)}`}function Xy(r,e){if(r<0)return-Xy(-r,e);let t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){let s=Math.floor(r*t);return(s%2===0?s:s+1)/t}else return Math.round(r*t)/t}var kC="Decimal";function RC(r){let e=Xy(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw zi(r,kC);let t=e.toString();return t.includes(".")?t:`${t}.0`}var PC="String",DC=/[\x00-\x1f\x7f]+/;function xC(r){if(DC.test(r))throw zi(r,PC);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function OC(r){return r.description||r.toString().slice(7,-1)}var MC="Token";function _m(r){let e=OC(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw zi(e,MC);return e}function Qc(r){switch(typeof r){case"number":if(!Ce(r))throw zi(r,Tm);return Number.isInteger(r)?Yy(r):RC(r);case"string":return xC(r);case"symbol":return _m(r);case"boolean":return bC(r);case"object":if(r instanceof Date)return LC(r);if(r instanceof Uint8Array)return wC(r);if(r instanceof hl)return _m(r);default:throw zi(r,Tm)}}var FC="Key";function Jc(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw zi(r,FC);return r}function Uf(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${Jc(e)}`:`;${Jc(e)}=${Qc(t)}`).join("")}function Qy(r){return r instanceof oa?`${Qc(r.value)}${Uf(r.params)}`:Qc(r)}function NC(r){return`(${r.value.map(Qy).join(" ")})${Uf(r.params)}`}function BC(r,e={whitespace:!0}){if(typeof r!="object")throw zi(r,yC);let t=r instanceof Map?r.entries():Object.entries(r),i=e?.whitespace?" ":"";return Array.from(t).map(([s,n])=>{n instanceof oa||(n=new oa(n));let a=Jc(s);return n.value===!0?a+=Uf(n.params):(a+="=",Array.isArray(n.value)?a+=NC(n):a+=Qy(n)),a}).join(`,${i}`)}function UC(r,e){return BC(r,e)}function $C(r){return["ot","sf","st","e","sta"].includes(r)}function HC(r){return typeof r=="number"?Ce(r):r!=null&&r!==""&&r!==!1}function jC(r,e){let t=new URL(r),i=new URL(e);if(t.origin!==i.origin)return r;let s=t.pathname.split("/").slice(1),n=i.pathname.split("/").slice(1,-1);for(;s[0]===n[0];)s.shift(),n.shift();for(;n.length;)n.shift(),s.unshift("..");return s.join("/")}var Lo=r=>Math.round(r),VC=(r,e)=>(e?.baseUrl&&(r=jC(r,e.baseUrl)),encodeURIComponent(r)),no=r=>Lo(r/100)*100,GC={br:Lo,d:Lo,bl:no,dl:no,mtp:no,nor:VC,rtp:no,tb:Lo};function KC(r,e){let t={};if(r==null||typeof r!="object")return t;let i=Object.keys(r).sort(),s=it({},GC,e?.formatters),n=e?.filter;return i.forEach(a=>{if(n?.(a)===!1)return;let l=r[a],c=s[a];c&&(l=c(l,e)),!(a==="v"&&l===1)&&(a=="pr"&&l===1||HC(l)&&($C(a)&&typeof l=="string"&&(l=new hl(l)),t[a]=l))}),t}function Jy(r,e={}){return r?UC(KC(r,e),it({whitespace:!1},e)):""}function qC(r,e={}){let t={};if(!r)return t;let i=Object.entries(r),s=Object.entries(vC).concat(Object.entries(e?.customHeaderMap||{})),n=i.reduce((a,l)=>{var c,h;let[f,p]=l,m=((c=s.find(_=>_[1].includes(f)))===null||c===void 0?void 0:c[0])||Un.REQUEST;return(h=a[m])!==null&&h!==void 0||(a[m]={}),a[m][f]=p,a},{});return Object.entries(n).reduce((a,[l,c])=>(a[l]=Jy(c,e),a),t)}function WC(r,e,t){return it(r,qC(e,t))}var zC="CMCD";function YC(r,e={}){if(!r)return"";let t=Jy(r,e);return`${zC}=${encodeURIComponent(t)}`}var Em=/CMCD=[^&#]+/;function XC(r,e,t){let i=YC(e,t);if(!i)return r;if(Em.test(r))return r.replace(Em,i);let s=r.includes("?")?"&":"?";return`${r}${s}${i}`}var Zc=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Qt.MANIFEST,su:!this.initialized})}catch(n){this.hls.logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=s=>{try{let{frag:n,part:a}=s,l=this.hls.levels[n.level],c=this.getObjectType(n),h={d:(a||n).duration*1e3,ot:c};(c===Qt.VIDEO||c===Qt.AUDIO||c==Qt.MUXED)&&(h.br=l.bitrate/1e3,h.tb=this.getTopBandwidth(c)/1e3,h.bl=this.getBufferLength(c));let f=a?this.getNextPart(a):this.getNextFrag(n);f!=null&&f.url&&f.url!==n.url&&(h.nor=f.url),this.apply(s,h)}catch(n){this.hls.logger.warn("Could not generate segment CMCD data.",n)}},this.hls=e;let t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){let e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){let e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,s;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:dC.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){it(t,this.createData());let i=t.ot===Qt.INIT||t.ot===Qt.VIDEO||t.ot===Qt.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);let{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((a,l)=>(s.includes(l)&&(a[l]=t[l]),a),{}));let n={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),WC(e.headers,t,n)):e.url=XC(e.url,t,n)}getNextFrag(e){var t;let i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){let s=e.sn-i.startSN;return i.fragments[s+1]}}getNextPart(e){var t,i;let{index:s,fragment:n}=e,a=(t=this.hls.levels[n.level])==null||(i=t.details)==null?void 0:i.partList;if(a){let{sn:l}=n;for(let c=a.length-1;c>=0;c--){let h=a[c];if(h.index===s&&h.fragment.sn===l)return a[c+1]}}}getObjectType(e){let{type:t}=e;if(t==="subtitle")return Qt.TIMED_TEXT;if(e.sn==="initSegment")return Qt.INIT;if(t==="audio")return Qt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Qt.VIDEO:Qt.MUXED}getTopBandwidth(e){let t=0,i,s=this.hls;if(e===Qt.AUDIO)i=s.audioTracks;else{let n=s.maxAutoLevel,a=n>-1?n+1:s.levels.length;i=s.levels.slice(0,a)}return i.forEach(n=>{n.bitrate>t&&(t=n.bitrate)}),t>0?t:NaN}getBufferLength(e){let t=this.media,i=e===Qt.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:He.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){let{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new i(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,l){t(n),this.loader.load(n,a,l)}}}createFragmentLoader(){let{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new i(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,l){t(n),this.loader.load(n,a,l)}}}},QC=3e5,ed=class extends li{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){let e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){let e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){let e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){let t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){let{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){let{errorAction:i}=t;if(i?.action===jt.SendAlternateToPenaltyBox&&i.flags===Ai.MoveAllAlternatesMatchingHost){let s=this.levels,n=this._pathwayPriority,a=this.pathwayId;if(t.context){let{groupId:l,pathwayId:c,type:h}=t.context;l&&s?a=this.getPathwayForGroupId(l,h,a):c&&(a=c)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!n&&s&&(n=this.pathways()),n&&n.length>1&&(this.updatePathwayPriority(n),i.resolved=this.pathwayId!==a),t.details===z.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${ft(n)} penalized: ${ft(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){let i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t,i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(n=>{s-i[n]>QC&&delete i[n]});for(let n=0;n<e.length;n++){let a=e[n];if(a in i)continue;if(a===this.pathwayId)return;let l=this.hls.nextLoadLevel,c=this.hls.levels[l];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,Iy(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});let h=this.hls.levels[l];c&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==c.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==c.bitrate&&this.log(`Unstable Pathways change from bitrate ${c.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=l);break}}}getPathwayForGroupId(e,t,i){let s=this.getLevelsForPathway(i).concat(this.levels||[]);for(let n=0;n<s.length;n++)if(t===Ge.AUDIO_TRACK&&s[n].hasAudioGroup(e)||t===Ge.SUBTITLE_TRACK&&s[n].hasSubtitleGroup(e))return s[n].pathwayId;return i}clonePathways(e){let t=this.levels;if(!t)return;let i={},s={};e.forEach(n=>{let{ID:a,"BASE-ID":l,"URI-REPLACEMENT":c}=n;if(t.some(f=>f.pathwayId===a))return;let h=this.getLevelsForPathway(l).map(f=>{let p=new gt(f.attrs);p["PATHWAY-ID"]=a;let m=p.AUDIO&&`${p.AUDIO}_clone_${a}`,_=p.SUBTITLES&&`${p.SUBTITLES}_clone_${a}`;m&&(i[p.AUDIO]=m,p.AUDIO=m),_&&(s[p.SUBTITLES]=_,p.SUBTITLES=_);let E=Zy(f.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",c),S=new hr({attrs:p,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:E,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let C=1;C<f.audioGroups.length;C++)S.addGroupId("audio",`${f.audioGroups[C]}_clone_${a}`);if(f.subtitleGroups)for(let C=1;C<f.subtitleGroups.length;C++)S.addGroupId("text",`${f.subtitleGroups[C]}_clone_${a}`);return S});t.push(...h),bm(this.audioTracks,i,c,a),bm(this.subtitleTracks,s,c,a)})}loadSteeringManifest(e){let t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){let f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+f)}let n={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,l=a.errorRetry||a.timeoutRetry||{},c={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},h={onSuccess:(f,p,m,_)=>{this.log(`Loaded steering manifest: "${s}"`);let E=f.data;if(E?.VERSION!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;let{"RELOAD-URI":S,"PATHWAY-CLONES":C,"PATHWAY-PRIORITY":I}=E;if(S)try{this.uri=new self.URL(S,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||m.url),C&&this.clonePathways(C);let R={steeringManifest:E,url:s.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,R),I&&this.updatePathwayPriority(I)},onError:(f,p,m,_)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${p.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let E=this.timeToLoad*1e3;if(f.code===429){let S=this.loader;if(typeof S?.getResponseHeader=="function"){let C=S.getResponseHeader("Retry-After");C&&(E=parseFloat(C)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,E)},onTimeout:(f,p,m)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(n,c,h)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;let s=(i=this.hls)==null?void 0:i.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}};function bm(r,e,t,i){r&&Object.keys(e).forEach(s=>{let n=r.filter(a=>a.groupId===s).map(a=>{let l=it({},a);return l.details=void 0,l.attrs=new gt(l.attrs),l.url=l.attrs.URI=Zy(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),l.groupId=l.attrs["GROUP-ID"]=e[s],l.attrs["PATHWAY-ID"]=i,l});r.push(...n)})}function Zy(r,e,t,i){let{HOST:s,PARAMS:n,[t]:a}=i,l;e&&(l=a?.[e],l&&(r=l));let c=new self.URL(r);return s&&!l&&(c.host=s),n&&Object.keys(n).sort().forEach(h=>{h&&c.searchParams.set(h,n[h])}),c.href}function vi(r,e,t){ki(r,e,t),r.addEventListener(e,t)}function ki(r,e,t){r.removeEventListener(e,t)}var JC=(()=>{class r extends li{constructor(t){super("eme",t.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=r.CDMCleanupPromise?[r.CDMCleanupPromise]:[],this.onWaitingForKey=i=>{this.log(`"${i.type}" event`)},this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();let t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(t){let{drmSystems:i,widevineLicenseUrl:s}=this.config,n=i[t];if(n)return n.licenseUrl;if(t===_t.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(t){let i=this.getLicenseServerUrl(t);if(i===void 0)throw new Error(`no license server URL configured for key-system "${t}"`);return i}getServerCertificateUrl(t){let{drmSystems:i}=this.config,s=i[t];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){let i=this.hls.levels,s=(l,c,h)=>!!l&&h.indexOf(l)===c,n=i.map(l=>l.audioCodec).filter(s),a=i.map(l=>l.videoCodec).filter(s);return n.length+a.length===0&&a.push("avc1.42e01e"),new Promise((l,c)=>{let h=f=>{let p=f.shift();this.getMediaKeysPromise(p,n,a).then(m=>l({keySystem:p,mediaKeys:m})).catch(m=>{f.length?h(f):m instanceof Jt?c(m):c(new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};h(t)})}requestMediaKeySystemAccess(t,i){let{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${s}`;return _y===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return s(t,i)}getMediaKeysPromise(t,i,s){let n=r0(t,i,s,this.config.drmSystemOptions),a=this.keySystemAccessPromises[t],l=a?.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${t}" key-system access with config: ${ft(n)}`),l=this.requestMediaKeySystemAccess(t,n);let c=this.keySystemAccessPromises[t]={keySystemAccess:l};return l.catch(h=>{this.log(`Failed to obtain access to key-system "${t}": ${h}`)}),l.then(h=>{this.log(`Access for key-system "${h.keySystem}" obtained`);let f=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),c.mediaKeys=h.createMediaKeys().then(p=>(this.log(`Media-keys created for "${t}"`),c.hasMediaKeys=!0,f.then(m=>m?this.setMediaKeysServerCertificate(p,t,m):p))),c.mediaKeys.catch(p=>{this.error(`Failed to create media-keys for "${t}"}: ${p}`)}),c.mediaKeys})}return l.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:i,mediaKeys:s}){this.log(`Creating key-system session "${i}" keyId: ${ir.hexDump(t.keyId||[])}`);let n=s.createSession(),a={decryptdata:t,keySystem:i,mediaKeys:s,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(t){let i=t.decryptdata;if(i.pssh){let s=this.createMediaKeySessionContext(t),n=this.getKeyIdString(i),a="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(s,a,i.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return ir.hexDump(t.keyId)}updateKeySession(t,i){var s;let n=t.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${ir.hexDump(((s=t.decryptdata)==null?void 0:s.keyId)||[])}
      } (data length: ${i&&i.byteLength})`),n.update(i)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(t=>({keySystem:t,hasMediaKeys:this.keySystemAccessPromises[t].hasMediaKeys})).filter(({hasMediaKeys:t})=>!!t).map(({keySystem:t})=>Qg(t)).filter(t=>!!t)}getKeySystemAccess(t){return this.getKeySystemSelectionPromise(t).then(({keySystem:i,mediaKeys:s})=>this.attemptSetMediaKeys(i,s))}selectKeySystem(t){return new Promise((i,s)=>this.getKeySystemSelectionPromise(t).then(({keySystem:n})=>{let a=Qg(n);a?i(a):s(new Error(`Unable to find format for key-system "${n}"`))}).catch(s))}selectKeySystemFormat(t){let i=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)),this.keyFormatPromise}getKeyFormatPromise(t){let i=Ao(this.config),s=t.map(kc).filter(n=>!!n&&i.indexOf(n)!==-1);return this.selectKeySystem(s)}loadKey(t){let i=t.keyInfo.decryptdata,s=this.getKeyIdString(i),n=`(keyId: ${s} format: "${i.keyFormat}" method: ${i.method} uri: ${i.uri})`;this.log(`Starting session for key ${n}`);let a=this.keyIdToKeySessionPromise[s];return a||(a=this.getKeySystemForKeyPromise(i).then(({keySystem:c,mediaKeys:h})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${n}`),this.attemptSetMediaKeys(c,h).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:h,decryptdata:i}))))),(this.keyIdToKeySessionPromise[s]=a.then(c=>{let h="cenc",f=i.pssh?i.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(c,h,f,"playlist-key")})).catch(c=>this.handleError(c))),a}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){this.hls&&(this.error(t.message),t instanceof Jt?this.hls.trigger(L.ERROR,t.data):this.hls.trigger(L.ERROR,{type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){let i=this.getKeyIdString(t),s=this.keyIdToKeySessionPromise[i];if(!s){let n=kc(t.keyFormat),a=n?[n]:Ao(this.config);return this.attemptKeySystemAccess(a)}return s}getKeySystemSelectionPromise(t){if(t.length||(t=Ao(this.config)),t.length===0)throw new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ft({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}attemptSetMediaKeys(t,i){if(this.mediaKeys===i)return Promise.resolve();let s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);let n=Promise.all(s).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(i)});return this.mediaKeys=i,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${t}"`),s.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>s.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(t,i,s,n){var a,l;let c=(a=this.config.drmSystems)==null||(l=a[t.keySystem])==null?void 0:l.generateRequest;if(c)try{let S=c.call(this.hls,i,s,t);if(!S)throw new Error("Invalid response from configured generateRequest filter");i=S.initDataType,s=S.initData?S.initData:null,t.decryptdata.pssh=s?new Uint8Array(s):null}catch(S){var h;if(this.warn(S.message),(h=this.hls)!=null&&h.config.debug)throw S}if(s===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(t);let f=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${n}": ${f} (init data type: ${i} length: ${s?s.byteLength:null})`);let p=new xf,m=t._onmessage=S=>{let C=t.mediaKeysSession;if(!C){p.emit("error",new Error("invalid state"));return}let{messageType:I,message:R}=S;this.log(`"${I}" message event for session "${C.sessionId}" message size: ${R.byteLength}`),I==="license-request"||I==="license-renewal"?this.renewLicense(t,R).catch(k=>{p.eventNames().length?p.emit("error",k):this.handleError(k)}):I==="license-release"?t.keySystem===_t.FAIRPLAY&&(this.updateKeySession(t,Lc("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${I}"`)},_=t._onkeystatuseschange=S=>{if(!t.mediaKeysSession){p.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(t);let I=t.keyStatus;p.emit("keyStatus",I),I==="expired"&&(this.warn(`${t.keySystem} expired for key ${f}`),this.renewKeySession(t))};vi(t.mediaKeysSession,"message",m),vi(t.mediaKeysSession,"keystatuseschange",_);let E=new Promise((S,C)=>{p.on("error",C),p.on("keyStatus",I=>{I.startsWith("usable")?S():I==="output-restricted"?C(new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):I==="internal-error"?C(new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${I}"`)):I==="expired"?C(new Error("key expired while generating request")):this.warn(`unhandled key status change "${I}"`)})});return t.mediaKeysSession.generateRequest(i,s).then(()=>{var S;this.log(`Request generated for key-session "${(S=t.mediaKeysSession)==null?void 0:S.sessionId}" keyId: ${f}`)}).catch(S=>{throw new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_SESSION,error:S,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>E).catch(S=>{throw p.removeAllListeners(),this.removeSession(t),S}).then(()=>(p.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((i,s)=>{if(typeof s=="string"&&typeof i=="object"){let n=s;s=i,i=n}this.log(`key status change "${i}" for keyStatuses keyId: ${ir.hexDump("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))} session keyId: ${ir.hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=i})}fetchServerCertificate(t){let i=this.config,s=i.loader,n=new s(i),a=this.getServerCertificateUrl(t);return a?(this.log(`Fetching server certificate for "${t}"`),new Promise((l,c)=>{let h={responseType:"arraybuffer",url:a},f=i.certLoadPolicy.default,p={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(_,E,S,C)=>{l(_.data)},onError:(_,E,S,C)=>{c(new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:rt({url:h.url,data:void 0},_)},`"${t}" certificate request failed (${a}). Status: ${_.code} (${_.text})`))},onTimeout:(_,E,S)=>{c(new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:h.url,data:void 0}},`"${t}" certificate request timed out (${a})`))},onAbort:(_,E,S)=>{c(new Error("aborted"))}};n.load(h,p,m)})):Promise.resolve()}setMediaKeysServerCertificate(t,i,s){return new Promise((n,a)=>{t.setServerCertificate(s).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${s?.byteLength}) on "${i}"`),n(t)}).catch(l=>{a(new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(t,i){return this.requestLicense(t,new Uint8Array(i)).then(s=>this.updateKeySession(t,new Uint8Array(s)).catch(n=>{throw new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:n,fatal:!0},n.message)}))}unpackPlayReadyKeyMessage(t,i){let s=String.fromCharCode.apply(null,new Uint16Array(i.buffer));if(!s.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),i;let n=new DOMParser().parseFromString(s,"application/xml"),a=n.querySelectorAll("HttpHeader");if(a.length>0){let p;for(let m=0,_=a.length;m<_;m++){var l,c;p=a[m];let E=(l=p.querySelector("name"))==null?void 0:l.textContent,S=(c=p.querySelector("value"))==null?void 0:c.textContent;E&&S&&t.setRequestHeader(E,S)}}let h=n.querySelector("Challenge"),f=h?.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return Lc(atob(f))}setupLicenseXHR(t,i,s,n){let a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return a.call(this.hls,t,i,s,n)}).catch(l=>{if(!s.decryptdata)throw l;return t.open("POST",i,!0),a.call(this.hls,t,i,s,n)}).then(l=>(t.readyState||t.open("POST",i,!0),{xhr:t,licenseChallenge:l||n})):(t.open("POST",i,!0),Promise.resolve({xhr:t,licenseChallenge:n}))}requestLicense(t,i){let s=this.config.keyLoadPolicy.default;return new Promise((n,a)=>{let l=this.getLicenseServerUrlOrThrow(t.keySystem);this.log(`Sending license request to URL: ${l}`);let c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return a(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let h=c.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);let f=this.config.licenseResponseCallback;if(f)try{h=f.call(this.hls,c,l,t)}catch(p){this.error(p)}n(h)}else{let h=s.errorRetry,f=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>f||c.status>=400&&c.status<500)a(new Jt({type:Le.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{let p=f-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${p} attempts left`),this.requestLicense(t,i).then(n,a)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=c,this.setupLicenseXHR(c,l,t,i).then(({xhr:h,licenseChallenge:f})=>{t.keySystem==_t.PLAYREADY&&(f=this.unpackPlayReadyKeyMessage(h,f)),h.send(f)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(t,i){if(!this.config.emeEnabled)return;let s=i.media;this.media=s,vi(s,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){let t=this.media;t&&(ki(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var t;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;let i=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,tl.clearKeyUriToKeyIdMap();let n=s.length;r.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat(i==null||(t=i.setMediaKeys(null))==null?void 0:t.catch(a=>{var l;this.log(`Could not clear media keys: ${a}`),(l=this.hls)==null||l.trigger(L.ERROR,{type:Le.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))).catch(a=>{var l;this.log(`Could not close sessions and clear media keys: ${a}`),(l=this.hls)==null||l.trigger(L.ERROR,{type:Le.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:i}){if(!(!i||!this.config.emeEnabled)&&!this.keyFormatPromise){let s=i.reduce((n,a)=>(n.indexOf(a.keyFormat)===-1&&n.push(a.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(t){let{mediaKeysSession:i,licenseXhr:s}=t;if(i){this.log(`Remove licenses and keys and close session ${i.sessionId}`),t._onmessage&&(i.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;let n=this.mediaKeySessions.indexOf(t);n>-1&&this.mediaKeySessions.splice(n,1);let{drmSystemOptions:a}=this.config;return(a0(a)?new Promise((c,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),i.remove().then(c)}):Promise.resolve()).catch(c=>{var h;this.log(`Could not remove session: ${c}`),(h=this.hls)==null||h.trigger(L.ERROR,{type:Le.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>i.close()).catch(c=>{var h;this.log(`Could not close session: ${c}`),(h=this.hls)==null||h.trigger(L.ERROR,{type:Le.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}}}return r.CDMCleanupPromise=void 0,r})(),Jt=class extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}},td=class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){let i=this.hls.config;if(i.capLevelOnFPSDrop){let s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){let s=performance.now();if(t){if(this.lastTime){let n=s-this.lastTime,a=i-this.lastDroppedFrames,l=t-this.lastDecodedFrames,c=1e3*a/n,h=this.hls;if(h.trigger(L.FPS_DROP,{currentDropped:a,currentDecoded:l,totalDroppedFrames:i}),c>0&&a>h.config.fpsDroppedMonitoringThreshold*l){let f=h.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=f)&&(f=f-1,h.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:h.currentLevel}),h.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){let e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){let t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}};function eT(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function tT(r,e){let t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Ze.debug(`[texttrack-utils]: ${i}`);try{let s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,r.addCue(s)}catch(s){Ze.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(r.mode=t)}function Hr(r,e){let t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let i=r.cues.length;i--;)e&&r.cues[i].removeEventListener("enter",e),r.removeCue(r.cues[i]);t==="disabled"&&(r.mode=t)}function id(r,e,t,i){let s=r.mode;if(s==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){let n=ew(r.cues,e,t);for(let a=0;a<n.length;a++)(!i||i(n[a]))&&r.removeCue(n[a])}s==="disabled"&&(r.mode=s)}function ZC(r,e){if(e<=r[0].startTime)return 0;let t=r.length-1;if(e>r[t].endTime)return-1;let i=0,s=t,n;for(;i<=s;)if(n=Math.floor((s+i)/2),e<r[n].startTime)s=n-1;else if(e>r[n].startTime&&i<t)i=n+1;else return n;return r[i].startTime-e<e-r[s].startTime?i:s}function ew(r,e,t){let i=[],s=ZC(r,e);if(s>-1)for(let n=s,a=r.length;n<a;n++){let l=r[n];if(l.startTime>=e&&l.endTime<=t)i.push(l);else if(l.startTime>t)return i}return i}function ko(r){let e=[];for(let t=0;t<r.length;t++){let i=r[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(r[t])}return e}var sd=class extends na{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null,i=ko(this.media.textTracks);for(let n=0;n<i.length;n++)if(i[n].mode==="hidden")t=i[n];else if(i[n].mode==="showing"){t=i[n];break}let s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){let{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){let i=this.media;if(!i)return;let s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;ko(i.textTracks).forEach(a=>{Hr(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){let{id:i,groupId:s,details:n}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${i} and group:${s} not found in active group ${a?.groupId}`);return}let l=a.details;a.details=t.details,this.log(`Subtitle track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${n.startSN}-${n.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,l)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let i=t.subtitleGroups||null,s=this.groupIds,n=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(a=>s?.indexOf(a)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;let a=this.tracks.filter(f=>!i||i.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,p)=>{f.id=p});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=a;let l=this.hls.config.subtitlePreference;if(!n&&l){this.selectDefaultTrack=!1;let f=qi(l,a);if(f>-1)n=a[f];else{let p=qi(l,this.tracks);n=this.tracks[p]}}let c=this.findTrackId(n);c===-1&&n&&(c=this.findTrackId(null));let h={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,h),c!==-1&&this.trackId===-1&&this.setSubtitleTrack(c)}}findTrackId(e){let t=this.tracksInGroup,i=this.selectDefaultTrack;for(let s=0;s<t.length;s++){let n=t[s];if(!(i&&!n.default||!i&&!e)&&(!e||lr(n,e)))return s}if(e){for(let s=0;s<t.length;s++){let n=t[s];if(aa(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){let n=t[s];if(aa(e.attrs,n.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){let t=this.tracksInGroup;for(let i=0;i<t.length;i++){let s=t[i];if(Kc(s,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ge.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;let t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){let i=this.currentTrack;if(i&&lr(e,i))return i;let s=qi(e,this.tracksInGroup);if(s>-1){let n=this.tracksInGroup[s];return this.setSubtitleTrack(s),n}else{if(i)return null;{let n=qi(e,t);if(n>-1)return t[n]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=e.id,s=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,l=a?.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:n,id:i,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){let{media:e}=this;if(!e)return;let t=ko(e.textTracks),i=this.currentTrack,s;if(i&&(s=t.filter(n=>Kc(i,n))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(n=>{n.mode!=="disabled"&&n!==s&&(n.mode="disabled")}),s){let n=this.subtitleDisplay?"showing":"hidden";s.mode!==n&&(s.mode=n)}}setSubtitleTrack(e){let t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ce(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;let i=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}let n=!!s.details&&!s.details.live;if(e===this.trackId&&s===i&&n)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));let{id:a,groupId:l="",name:c,type:h,url:f}=s;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:a,groupId:l,name:c,type:h,url:f});let p=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(p)}};function tw(){try{return crypto.randomUUID()}catch{try{let e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let n=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?n:n&3|8).toString(16)})}}}function Kn(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}var Wr=.025,cl=function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r}({});function iw(r,e,t){return`${r.identifier}-${t+1}-${Kn(e)}`}var rd=class{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;let i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){let e=this.dateRange.startTime;if(this.snapOptions.out){let t=this.dateRange.tagAnchor;if(t)return uh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;let e=this.dateRange.tagAnchor;if(e){let t=this.dateRange.startTime,i=uh(t,e);return t-i<.1}return!1}get resumptionOffset(){let e=this.resumeOffset,t=Ce(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){let e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){let t=this.resumeAnchor;if(t)return uh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Wr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){let e=this.playoutLimit,t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?cl.Range:cl.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return sw(this)}};function uh(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<Wr)?e.start:e.start+e.duration}function iT(r,e,t){let i=new self.URL(r,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function hh(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function sw(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function $r(r){let e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}var nd=class{constructor(e,t,i,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};let n=this.hls=new e(t);this.interstitial=i,this.assetItem=s;let a=s.uri;try{a=iT(a,t.primarySessionId).href}catch{}n.loadSource(a);let l=()=>{this.hasDetails=!0};n.once(L.LEVEL_LOADED,l),n.once(L.AUDIO_TRACK_LOADED,l),n.once(L.SUBTITLE_TRACK_LOADED,l),n.on(L.MEDIA_ATTACHING,(c,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&n.on(L.BUFFER_APPENDED,()=>{let p=this.bufferedEnd;this.reachedPlayout(p)&&(this._bufferedEosTime=p,n.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var e;return((e=this.interstitial)==null?void 0:e.appendInPlace)||!1}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;let i=this.timelineOffset,s=He.bufferInfo(e,i,0);return this.getAssetTime(s.end)>=this._bufferedEosTime-.02}reachedPlayout(e){let i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){let e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;let t=He.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){let e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){let e=this.assetItem.duration;return e||0}get remaining(){let e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){let t=this.timelineOffset;if(e!==t){let i=e-t;if(Math.abs(i)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){let t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){let e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){let e=this.hls;if(this.hasDetails){e.stopLoad();let t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){this.hls.on(e,t)}once(e,t,i){this.hls.once(e,t)}off(e,t,i){this.hls.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${$r(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}},Sm=.033,ad=class extends li{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,i+1):i,0):0}get duration(){let e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);let s=this.items;if(s)for(s[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(n=s[i])!=null&&n.event;){var n;i--}return i}findItemIndexAtTime(e,t){let i=this.items;if(i)for(let s=0;s<i.length;s++){let n=i[s];if(t&&t!=="primary"&&(n=n[t]),e===n.start||e>n.start&&e<n.end)return s}return-1}findJumpRestrictedIndex(e,t){let i=this.items;if(i)for(let s=e;s<=t&&i[s];s++){let n=i[s].event;if(n!=null&&n.restrictions.jump&&!n.appendInPlace)return s}return-1}findEventIndex(e){let t=this.items;if(t)for(let s=t.length;s--;){var i;if(((i=t[s].event)==null?void 0:i.identifier)===e)return s}return-1}findAssetIndex(e,t){let i=e.assetList,s=i.length;if(s>1)for(let n=0;n<s;n++){let a=i[n];if(!a.error){let l=a.timelineStart;if(t===l||t>l&&t<l+(a.duration||0))return n}}return 0}get assetIdAtEnd(){var e,t;let i=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(i){let s=i.assetList,n=s[s.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){let i=e.main.details,{dateRanges:s}=i,n=this.events,a=this.parseDateRanges(s,{url:i.url},t),l=Object.keys(s),c=n?n.filter(h=>!l.includes(h.identifier)):[];a.length&&a.sort((h,f)=>{let p=h.cue.pre,m=h.cue.post,_=f.cue.pre,E=f.cue.post;if(p&&!_)return-1;if(_&&!p||m&&!E)return 1;if(E&&!m)return-1;if(!p&&!_&&!m&&!E){let S=h.startTime,C=f.startTime;if(S!==C)return S-C}return h.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=a,c.forEach(h=>{this.removeEvent(h)}),this.updateSchedule(e,c)}updateSchedule(e,t=[]){let i=this.events||[];if(i.length||t.length||this.length<2){let s=this.items,n=this.parseSchedule(i,e);(t.length||s?.length!==n.length||n.some((l,c)=>Math.abs(l.playout.start-s[c].playout.start)>.005||Math.abs(l.playout.end-s[c].playout.end)>.005))&&(this.items=n,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,i){let s=[],n=Object.keys(e);for(let a=0;a<n.length;a++){let l=n[a],c=e[l];if(c.isInterstitial){let h=this.eventMap[l];h?h.setDateRange(c):(h=new rd(c,t),this.eventMap[l]=h,i===!1&&(h.appendInPlace=i)),s.push(h)}}return s}parseSchedule(e,t){let i=[],s=t.main.details,n=s.live?1/0:s.edge,a=0;if(e=e.filter(c=>!c.error&&!(c.cue.once&&c.hasPlayed)),e.length){this.resolveOffsets(e,t);let c=0,h=0;if(e.forEach((f,p)=>{let m=f.cue.pre,_=f.cue.post,E=e[p-1]||null,S=f.appendInPlace,C=_?n:f.startOffset,I=f.duration,R=f.timelineOccupancy===cl.Range?I:0,k=f.resumptionOffset,D=E?.startTime===C,x=C+f.cumulativeDuration,N=S?x+I:C+k;if(m||!_&&C<=0){let H=h;h+=R,f.timelineStart=x;let O=a;a+=I,i.push({event:f,start:x,end:N,playout:{start:O,end:a},integrated:{start:H,end:h}})}else if(C<=n){if(!D){let P=C-c;if(P>Sm){let G=c,Q=h;h+=P;let ie=a;a+=P;let te={previousEvent:e[p-1]||null,nextEvent:f,start:G,end:G+P,playout:{start:ie,end:a},integrated:{start:Q,end:h}};i.push(te)}else P>0&&E&&(E.cumulativeDuration+=P,i[i.length-1].end=C)}_&&(N=x),f.timelineStart=x;let H=h;h+=R;let O=a;a+=I,i.push({event:f,start:x,end:N,playout:{start:O,end:a},integrated:{start:H,end:h}})}else return;let B=f.resumeTime;_||B>n?c=n:c=B}),c<n){var l;let f=c,p=h,m=n-c;h+=m;let _=a;a+=m,i.push({previousEvent:((l=i[i.length-1])==null?void 0:l.event)||null,nextEvent:null,start:c,end:f+m,playout:{start:_,end:a},integrated:{start:p,end:h}})}this.setDurations(n,a,h)}else i.push({previousEvent:null,nextEvent:null,start:0,end:n,playout:{start:0,end:n},integrated:{start:0,end:n}}),this.setDurations(n,n,n);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){let i=t.main.details,s=i.live?1/0:i.edge,n=0,a=-1;e.forEach((l,c)=>{let h=l.cue.pre,f=l.cue.post,p=h?0:f?s:l.startTime;this.updateAssetDurations(l),a===p?l.cumulativeDuration=n:(n=0,a=p),!f&&l.snapOptions.in&&(l.resumeAnchor=cr(null,i.fragments,l.startOffset+l.resumptionOffset,0,0)||void 0),l.appendInPlace&&!l.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(l,t)||(l.appendInPlace=!1)),!l.appendInPlace&&c+1<e.length&&e[c+1].startTime-e[c].resumeTime<Sm&&(e[c+1].appendInPlace=!1,e[c+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${l}`));let _=Ce(l.resumeOffset)?l.resumeOffset:l.duration;n+=_})}primaryCanResumeInPlaceAt(e,t){let i=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(i-s)>Wr?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${s}`),!1):t?!Object.keys(t).some(a=>{let l=t[a].details,c=l.edge;if(i>=c)return this.log(`"${e.identifier}" resumption ${i} past ${a} playlist end ${c}`),!1;let h=cr(null,l.fragments,i);if(!h)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${a} playlist (${l.fragStart}-${l.fragmentEnd})`),!0;let f=a==="audio"?.175:0;return Math.abs(h.start-i)<Wr+f||Math.abs(h.end-i)<Wr+f?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${a} fragment bounds (${h.start}-${h.end} sn: ${h.sn} cc: ${h.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${i} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;let t=e.timelineStart,i=0,s=!1,n=!1;e.assetList.forEach((a,l)=>{let c=t+i;a.startOffset=i,a.timelineStart=c,s||(s=a.duration===null),n||(n=!!a.error);let h=a.error?0:a.duration||0;i+=h}),s&&!n?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}};function bs(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}var od=class{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){let i=e.assetListUrl,s;try{s=iT(i,this.hls.sessionId,e.baseUrl)}catch(m){let _=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,m,i);this.hls.trigger(L.ERROR,_);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);let n=this.hls.config,a=n.loader,l=new a(n),c={responseType:"json",url:s.href},h=n.interstitialAssetListLoadPolicy.default,f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,_,E,S)=>{let C=m.data,I=C?.ASSETS;if(!Array.isArray(I)){let R=this.assignAssetListError(e,z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),E.url,_,S);this.hls.trigger(L.ERROR,R);return}e.assetListResponse=C,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:C,networkDetails:S})},onError:(m,_,E,S)=>{let C=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${m.code} ${m.text} (${_.url})`),_.url,S,E);this.hls.trigger(L.ERROR,C)},onTimeout:(m,_,E)=>{let S=this.assignAssetListError(e,z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${_.url})`),_.url,m,E);this.hls.trigger(L.ERROR,S)}};return l.load(c,f,p),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),l}assignAssetListError(e,t,i,s,n,a){return e.error=i,{type:Le.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:i,networkDetails:a,stats:n}}};function Cm(r){r?.play().catch(()=>{})}var ld=class extends li{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{let i=this.currentTime;if(i===void 0||this.playbackDisabled)return;let s=i-this.timelinePos;if(Math.abs(s)<1/7056e5)return;let a=s<=-.01;this.timelinePos=i,this.bufferedPos=i;let l=this.playingItem;if(!l){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(i,i-s)&&this.updateSchedule(),this.checkBuffer(),a&&i<l.start||i>=l.end){var c;let m=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(l)&&(c=this.media)!=null&&c.paused&&(this.shouldPlay=!1),!a){let _=this.findItemIndex(l);if(m>_){let E=this.schedule.findJumpRestrictedIndex(_+1,m);if(E>_){this.setSchedulePosition(E);return}}}this.setSchedulePosition(m);return}let h=this.playingAsset;if(!h){if(this.playingLastItem&&this.isInterstitial(l)){let m=l.event.assetList[0];m&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,m))}return}let f=h.timelineStart,p=h.duration||0;(a&&i<f||i>=f+p)&&this.setScheduleToAssetAtTime(i,h)},this.onTimeupdate=()=>{let i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;let s=this.playingItem;if(!s||this.playingLastItem)return;if(i>=s.end){this.timelinePos=s.end;let l=this.findItemIndex(s);this.setSchedulePosition(l+1)}let n=this.playingAsset;if(!n)return;let a=n.timelineStart+(n.duration||0);i>=a&&this.setScheduleToAssetAtTime(i,n)},this.onScheduleUpdate=(i,s)=>{let n=this.schedule,a=this.playingItem,l=n.events||[],c=n.items||[],h=n.durations,f=i.map(E=>E.identifier),p=!!(l.length||f.length);(p||s)&&this.log(`INTERSTITIALS_UPDATED (${l.length}): ${l}
Schedule: ${c.map(E=>bs(E))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){let S=E.assetItem.timelineStart,C=E.timelineOffset-S;if(C)try{E.timelineOffset=S}catch(I){Math.abs(C)>Wr&&this.warn(`${I} ("${E.assetId}" ${E.timelineOffset}->${S})`)}}});let m=null;if(a){let E=this.updateItem(a,this.timelinePos);this.itemsMatch(a,E)&&(this.playingItem=E,this.waitingItem=this.endedItem=null,m=()=>this.trimInPlace(E,a))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);let _=this.bufferingItem;if(_){let E=this.updateItem(_,this.bufferedPos);this.itemsMatch(_,E)?(this.bufferingItem=E,m||(m=()=>this.trimInPlace(E,_))):_.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(_.event,null))}if(i.forEach(E=>{E.assetList.forEach(S=>{this.clearAssetPlayer(S.identifier,null)})}),p||s){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:l.slice(0),schedule:c.slice(0),durations:h,removedIds:f}),this.isInterstitial(a)&&f.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}m&&m(),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new od(e),this.schedule=new ad(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){let e=this.hls;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){let e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){let e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ki(e,"play",this.onPlay),ki(e,"pause",this.onPause),ki(e,"seeking",this.onSeeking),ki(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){let i=this.media=t.media;vi(i,"seeking",this.onSeeking),vi(i,"timeupdate",this.onTimeupdate),vi(i,"play",this.onPlay),vi(i,"pause",this.onPause)}onMediaAttached(e,t){let i=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!s){this.clearScheduleState();let n=this.findItemIndex(i);this.setSchedulePosition(n)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){let i=!!t.transferMedia,s=this.media;if(this.media=null,!i&&(s&&this.removeMediaListeners(s),this.detachedData)){let n=this.getBufferingPlayer();n&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,n.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;let e=this,t=()=>e.bufferingItem||e.waitingItem,i=p=>p&&e.getAssetPlayer(p.identifier),s=(p,m,_,E,S)=>{if(p){let C=p[m].start,I=p.event;if(I){if(m==="playout"||I.timelineOccupancy!==cl.Point){let R=i(_);R?.interstitial===I&&(C+=R.assetItem.startOffset+R[S])}}else{let R=E==="bufferedPos"?a():e[E];C+=R-p.start}return C}return 0},n=(p,m)=>{if(p!==0&&m!=="primary"&&e.schedule.length){var _;let E=e.schedule.findItemIndexAtTime(p),S=(_=e.schedule.items)==null?void 0:_[E];if(S){let C=S[m].start-S.start;return p+C}}return p},a=()=>{let p=e.bufferedPos;return p===Number.MAX_VALUE?l("primary"):Math.max(p,0)},l=p=>{var m;return(m=e.primaryDetails)!=null&&m.live?e.primaryDetails.edge:e.schedule.durations[p]},c=(p,m)=>{var _,E;let S=e.effectivePlayingItem;if(S!=null&&(_=S.event)!=null&&_.restrictions.skip)return;e.log(`seek to ${p} "${m}"`);let C=e.effectivePlayingItem,I=e.schedule.findItemIndexAtTime(p,m),R=(E=e.schedule.items)==null?void 0:E[I],k=e.getBufferingPlayer(),D=k?.interstitial,x=D?.appendInPlace,N=C&&e.itemsMatch(C,R);if(C&&(x||N)){let H=i(e.playingAsset),O=H?.media||e.primaryMedia;if(O){let P=m==="primary"?O.currentTime:s(C,m,e.playingAsset,"timelinePos","currentTime"),G=p-P,Q=(x?P:O.currentTime)+G;if(Q>=0&&(!H||x||Q<=H.duration)){O.currentTime=Q;return}}}if(R){let H=p;if(m!=="primary"){let P=R[m].start,G=p-P;H=R.start+G}let O=!e.isInterstitial(R);if((!e.isInterstitial(C)||C.event.appendInPlace)&&(O||R.event.appendInPlace)){let P=e.media||(x?k?.media:null);P&&(P.currentTime=H)}else if(C){let P=e.findItemIndex(C);if(I>P){let Q=e.schedule.findJumpRestrictedIndex(P+1,I);if(Q>P){e.setSchedulePosition(Q);return}}let G=0;if(O)e.timelinePos=H,e.checkBuffer();else{var B;let Q=R==null||(B=R.event)==null?void 0:B.assetList;if(Q){let ie=p-(R[m]||R).start;for(let te=Q.length;te--;){let re=Q[te];if(re.duration&&ie>=re.startOffset&&ie<re.startOffset+re.duration){G=te;break}}}}e.setSchedulePosition(I,G)}}},h=()=>{let p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;let m=t();return e.isInterstitial(m)?m:null},f={get currentTime(){let p=h(),m=e.effectivePlayingItem;return m&&m===p?s(m,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-m.playout.start:0},set currentTime(p){let m=h(),_=e.effectivePlayingItem;_&&_===m&&c(p+_.playout.start,"playout")},get duration(){let p=h();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;let m=(p=h())==null?void 0:p.event.assetList;return m?m.map(_=>e.getAssetPlayer(_.identifier)):[]},get playingIndex(){var p;let m=(p=h())==null?void 0:p.event;return m&&e.effectivePlayingAsset?m.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return h()}};this.manager={get events(){var p,m;return((p=e.schedule)==null||(m=p.events)==null?void 0:m.slice(0))||[]},get schedule(){var p,m;return((p=e.schedule)==null||(m=p.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return h()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){let p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){let p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return a()},get currentTime(){let p=e.timelinePos;return p>0?p:0},set currentTime(p){c(p,"primary")},get duration(){return l("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){c(p,"integrated")},get duration(){return l("integrated")},get seekableStart(){var p;return n(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{let p=e.effectivePlayingItem,m=p?.event;if(m&&!m.restrictions.skip){let _=e.findItemIndex(p);if(m.appendInPlace){let E=p.playout.start+p.event.duration;c(E+.001,"playout")}else e.advanceAfterAssetEnded(m,_,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;let t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,i;if(this.mediaSelection===null)return;let s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(n=this.primaryMedia);let a=(i=n)==null?void 0:i.currentTime;if(!(a===void 0||!Ce(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){let i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){let i=e.interstitial.appendInPlace,s=e.media;if(i&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}let n=e.transferMedia();this.log(`transfer MediaSource from ${e} ${ft(n)}`),this.detachedData=n}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var i,s;if(e.media===t)return;let n=null,a=this.hls,l=e!==a,c=l&&e.interstitial.appendInPlace,h=(i=this.detachedData)==null?void 0:i.mediaSource,f;if(a.media)c&&(n=a.transferMedia(),this.detachedData=n),f="Primary";else if(h){let _=this.getBufferingPlayer();_?(n=_.transferMedia(),f=`${_}`):f="detached MediaSource"}else f="detached media";if(!n){if(h)n=this.detachedData,this.log(`using detachedData: MediaSource ${ft(n)}`);else if(!this.detachedData||a.media===t){let _=this.playerQueue;_.length>1&&_.forEach(E=>{if(l&&E.interstitial.appendInPlace!==c){let S=E.interstitial;this.clearInterstitial(E.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${S}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}let p=n&&"mediaSource"in n&&((s=n.mediaSource)==null?void 0:s.readyState)!=="closed",m=p&&n?n:t;if(this.log(`${p?"transfering MediaSource":"attaching media"} to ${l?e:"Primary"} from ${f}`),m===n){let _=l&&e.assetId===this.schedule.assetIdAtEnd;m.overrides={duration:this.schedule.duration,endOfStream:!l||_,cueRemoval:!l}}e.attachMedia(m)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){let e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);let i=this.timelinePos,s=this.effectivePlayingItem;if(i===-1){let n=this.hls.startPosition;if(this.timelinePos=n,t.length&&t[0].cue.pre){let a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(n>=0||!this.primaryLive){let a=this.timelinePos=n>0?n:0,l=e.findItemIndexAtTime(a);this.setSchedulePosition(l)}}else if(s&&!this.playingItem){let n=e.findItemIndex(s);this.setSchedulePosition(n)}}advanceAfterAssetEnded(e,t,i){let s=hh(e,i);if(!e.isAssetPastPlayoutLimit(s))this.setSchedulePosition(t,s);else{let n=this.schedule.items;if(n){let a=t+1,l=n.length;if(a>=l){this.setSchedulePosition(-1);return}let c=e.resumeTime;this.timelinePos<c&&(this.timelinePos=c,this.checkBuffer()),this.setSchedulePosition(a)}}}setScheduleToAssetAtTime(e,t){let i=this.schedule,s=t.parentIdentifier,n=i.getEvent(s);if(n){let a=i.findEventIndex(s),l=i.findAssetIndex(n,e);this.advanceAfterAssetEnded(n,a,l-1)}}setSchedulePosition(e,t){let i=this.schedule.items;if(!i||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);let s=e>=0?i[e]:null,n=this.playingItem,a=this.playingLastItem;if(this.isInterstitial(n)){var l;let h=n.event,f=this.playingAsset,p=f?.identifier,m=p?this.getAssetPlayer(p):null;if(m&&p&&(!this.eventItemsMatch(n,s)||t!==void 0&&p!==((l=h.assetList)==null?void 0:l[t].identifier))){var c;let _=h.findAssetIndex(f);if(this.log(`INTERSTITIAL_ASSET_ENDED ${_+1}/${h.assetList.length} ${$r(f)}`),this.endedAsset=f,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:f,assetListIndex:_,event:h,schedule:i.slice(0),scheduleIndex:e,player:m}),n!==this.playingItem){this.itemsMatch(n,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),_);return}this.retreiveMediaSource(p,s),m.media&&!((c=this.detachedData)!=null&&c.mediaSource)&&m.detachMedia()}if(!this.eventItemsMatch(n,s)&&(this.endedItem=n,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${bs(n)}`),h.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:h,schedule:i.slice(0),scheduleIndex:e}),h.cue.once)){this.updateSchedule();let _=this.schedule.items;if(s&&_){let E=this.findItemIndex(s);this.advanceSchedule(E,_,t,n,a)}return}}this.advanceSchedule(e,i,t,n,a)}advanceSchedule(e,t,i,s,n){let a=e>=0?t[e]:null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(h=>{let f=h.interstitial,p=this.schedule.findEventIndex(f.identifier);(p<e||p>e+1)&&this.clearInterstitial(f,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);let h=a.event;if(i===void 0){i=this.schedule.findAssetIndex(h,this.timelinePos);let _=hh(h,i-1);if(h.isAssetPastPlayoutLimit(_)){this.advanceAfterAssetEnded(h,e,i);return}i=_}let f=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let p=this.preloadAssets(h,i);if(this.eventItemsMatch(a,f||s)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${bs(a)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;let m=h.assetList[i];if(!m){let _=t[e+1],E=this.media;_&&E&&!this.isInterstitial(_)&&E.currentTime<_.start&&(E.currentTime=this.timelinePos=_.start),this.advanceAfterAssetEnded(h,e,i||0);return}if(p||(p=this.getAssetPlayer(m.identifier)),p===null||p.destroyed){let _=h.assetList.length;this.warn(`asset ${i+1}/${_} player destroyed ${h}`),p=this.createAssetPlayer(h,m,i)}if(!this.eventItemsMatch(a,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(m))return;this.startAssetPlayer(p,i,t,e,l),this.shouldPlay&&Cm(p.media)}else a!==null?(this.resumePrimary(a,e,s),this.shouldPlay&&Cm(this.hls.media)):n&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${bs(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.timelinePos=a),this.attachPrimary(a,e)}if(!i)return;let n=this.schedule.items;n&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${bs(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:n.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){let i=e.start;if(this.primaryLive){let s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(i<s.fragmentStart||i>s.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){let t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:He.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;let s=this.primaryMedia;if(!s)return;let n=this.hls;n.media?this.checkBuffer():(this.transferMediaTo(n,s),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;let s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((i=s.mainForwardBufferInfo)==null?void 0:i.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;let i=this.hls.levels[t.level],s=rt(rt({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){let i=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=rt(rt({},this.altSelection),{},{audio:i});return}let n=rt(rt({},s),{},{audio:i});this.mediaSelection=n}onSubtitleTrackUpdated(e,t){let i=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=rt(rt({},this.altSelection),{},{subtitles:i});return}let n=rt(rt({},s),{},{subtitles:i});this.mediaSelection=n}onAudioTrackSwitching(e,t){let i=Bg(t);this.playerQueue.forEach(s=>s.hls.setAudioOption(t)||s.hls.setAudioOption(i))}onSubtitleTrackSwitch(e,t){let i=Bg(t);this.playerQueue.forEach(s=>s.hls.setSubtitleOption(t)||t.id!==-1&&s.hls.setSubtitleOption(i))}onBufferCodecs(e,t){let i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){let i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){let s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){let t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){let n=t[s];if(n.cue.post){var i;let a=this.schedule.findEventIndex(n.identifier),l=(i=this.schedule.items)==null?void 0:i[a];this.isInterstitial(l)&&this.eventItemsMatch(l,this.bufferingItem)&&this.bufferedToItem(l,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){let t=this.playingItem;if(!this.playingLastItem&&t){let i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){let i=this.schedule.items;if(e&&i){let s=this.findItemIndex(e,t);return i[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((n,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(n.identifier,null)});let i=e.end+.25,s=He.bufferInfo(this.primaryMedia,i,0);(s.end>i||(s.nextStart||0)>i)&&(this.attachPrimary(i,null),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){let e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){let t=this.schedule.items;if(!t)return;let i=He.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,t,e)}updateBufferedPos(e,t,i){let s=this.schedule,n=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],n)){this.bufferedPos=e;return}let a=this.playingItem,l=this.findItemIndex(a),c=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var h,f;let p=this.findItemIndex(n),m=Math.min(p+1,t.length-1),_=t[m];if((c===-1&&n&&e>=n.end||(h=_.event)!=null&&h.appendInPlace&&e+.01>=_.start)&&(c=m),m-l>1&&(n==null||(f=n.event)==null?void 0:f.appendInPlace)===!1)return;if(this.bufferedPos=e,c>p&&c>l)this.bufferedToItem(_);else{let E=this.primaryDetails;this.primaryLive&&E&&e>E.edge-E.targetduration&&_.start<E.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(_)&&this.preloadAssets(_.event,0)}}else i&&a&&!this.itemsMatch(a,n)&&(c===l?this.bufferedToItem(a):c===l+1&&this.bufferedToItem(t[c]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{let n=this.getAssetPlayer(s.identifier);return!(n!=null&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){let t=this.bufferingItem,i=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{let{items:s,events:n}=i;if(!s||!n)return t;let a=this.isInterstitial(e),l=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));let c=l?l.remaining:t?t.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${bs(e)}`+(t?` (${c.toFixed(2)} remaining)`:"")),this.playbackDisabled||(a?e.event.assetList.forEach(h=>{let f=this.getAssetPlayer(h.identifier);f&&f.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(h=>h.pauseBuffering()))),this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:n.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){let i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;let s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){let t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){let i=e.event,s=i.assetList.length===0&&!i.assetListLoader,n=i.cue.once;if(s||!n){let a=this.preloadAssets(i,t);if(a!=null&&a.interstitial.appendInPlace){let l=i.assetList[t],c=this.primaryMedia;l&&c&&this.bufferAssetPlayer(a,c)}}}preloadAssets(e,t){let i=e.assetUrl,s=e.assetList.length,n=s===0&&!e.assetListLoader,a=e.cue.once;if(n){let c=e.timelineStart;if(e.appendInPlace){var l;let m=this.playingItem;!this.isInterstitial(m)&&(m==null||(l=m.nextEvent)==null?void 0:l.identifier)===e.identifier&&this.flushFrontBuffer(c+.25)}let h,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){let m=f-c;m>0&&(h=Math.round(m*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:s} ${e}${h?` live-start: ${f} start-offset: ${h}`:""}`),i)return this.createAsset(e,0,0,c,e.duration,i);let p=this.assetListLoader.loadAssetList(e,h);p&&(e.assetListLoader=p)}else if(!a&&s){for(let c=t;c<s;c++){let h=e.assetList[c],f=this.getAssetPlayerQueueIndex(h.identifier);(f===-1||this.playerQueue[f].destroyed)&&!h.error&&this.createAssetPlayer(e,h,c)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){let t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){let t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){let{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,s,n,a){let l={parentIdentifier:e.identifier,identifier:iw(e,a,t),duration:n,startOffset:i,timelineStart:s,uri:a};return this.createAssetPlayer(e,l,t)}createAssetPlayer(e,t,i){let s=this.hls,n=s.userConfig,a=n.videoPreference,l=s.loadLevelObj||s.levels[s.currentLevel];(a||l)&&(a=it({},a),l.videoCodec&&(a.videoCodec=l.videoCodec),l.videoRange&&(a.allowedVideoRanges=[l.videoRange]));let c=s.audioTracks[s.audioTrack],h=s.subtitleTracks[s.subtitleTrack],f=0;if(this.primaryLive||e.appendInPlace){let k=this.timelinePos-t.timelineStart;if(k>1){let D=t.duration;D&&k<D&&(f=k)}}let p=t.identifier,m=rt(rt({},n),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:c||n.audioPreference,subtitlePreference:h||n.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(m.timelineOffset=t.timelineStart));let _=m.cmcd;_!=null&&_.sessionId&&_.contentId&&(m.cmcd=it({},_,{contentId:Kn(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);let E=new nd(this.HlsPlayerClass,m,e,t);this.playerQueue.push(E),e.assetList[i]=t;let S=k=>{if(k.live){let N=new Error(`Interstitials MUST be VOD assets ${e}`),B={fatal:!0,type:Le.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:N};this.handleAssetItemError(B,e,this.schedule.findEventIndex(e.identifier),i,N.message);return}let D=k.edge-k.fragmentStart,x=t.duration;(x===null||D>x)&&(this.log(`Interstitial asset "${p}" duration change ${x} > ${D}`),t.duration=D,this.updateSchedule())};E.on(L.LEVEL_UPDATED,(k,{details:D})=>S(D)),E.on(L.LEVEL_PTS_UPDATED,(k,{details:D})=>S(D));let C=(k,D)=>{let x=this.getAssetPlayer(p);if(x&&D.tracks){x.off(L.BUFFER_CODECS,C),x.tracks=D.tracks;let N=this.primaryMedia;this.bufferingAsset===x.assetItem&&N&&!x.media&&this.bufferAssetPlayer(x,N)}};E.on(L.BUFFER_CODECS,C);let I=()=>{var k;let D=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${D}`),!D)return;let x=this.schedule.findEventIndex(e.identifier),N=(k=this.schedule.items)==null?void 0:k[x];if(this.isInterstitial(N)){let H=e.findAssetIndex(t),O=hh(e,H);if(!e.isAssetPastPlayoutLimit(O))this.bufferedToItem(N,O);else{var B;let P=(B=this.schedule.items)==null?void 0:B[x+1];P&&this.bufferedToItem(P)}}};E.on(L.BUFFERED_TO_END,I);let R=k=>()=>{if(!this.getAssetPlayer(p))return;this.shouldPlay=!0;let x=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,x,k)};return E.once(L.MEDIA_ENDED,R(i)),E.once(L.PLAYOUT_LIMIT_REACHED,R(1/0)),E.on(L.ERROR,(k,D)=>{let x=this.getAssetPlayer(p);if(D.details===z.BUFFER_STALLED_ERROR){if(x!=null&&x.media){let N=x.currentTime,B=x.duration-N;N&&e.appendInPlace&&B/x.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${p} ${e} at ${x.media.currentTime}`),I()):(this.warn(`Stalled at ${N} of ${N+B} in asset ${p} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${D.error} ${e}`)}),E.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(p))return;let D=new Error(`Asset player destroyed unexpectedly ${p}`),x={fatal:!0,type:Le.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:D};this.handleAssetItemError(x,e,this.schedule.findEventIndex(e.identifier),i,D.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${$r(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:E}),E}clearInterstitial(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)}),e.reset()}resetAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);let i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){let i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&bs(t)}`);let s=this.playerQueue[i];this.transferMediaFromPlayer(s,t),this.playerQueue.splice(i,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,s,n){let{interstitial:a,assetItem:l,assetId:c}=e,h=a.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=l,(!f||f.identifier!==c)&&(f&&(this.clearAssetPlayer(f.identifier,i[s]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${h} ${$r(l)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:l,assetListIndex:t,event:a,schedule:i.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,n)}bufferAssetPlayer(e,t){var i,s;let{interstitial:n,assetItem:a}=e,l=this.schedule.findEventIndex(n.identifier),c=(i=this.schedule.items)==null?void 0:i[l];if(!c)return;this.setBufferingItem(c),this.bufferingAsset=a;let h=this.getBufferingPlayer();if(h===e)return;let f=n.appendInPlace;if(f&&h?.interstitial.appendInPlace===!1)return;let p=h?.tracks||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(f&&a!==this.playingAsset){if(!e.tracks)return;if(p&&!iy(p,e.tracks)){let m=new Error(`Asset ${$r(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),_={fatal:!0,type:Le.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:m},E=n.findAssetIndex(a);this.handleAssetItemError(_,n,l,E,m.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,i,s,n){if(e.details===z.BUFFER_STALLED_ERROR)return;let a=t.assetList[s];this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&$r(a)} ${e.error}`);let l=a?.identifier,c=this.getAssetPlayerQueueIndex(l),h=this.playerQueue[c]||null,f=this.schedule.items,p=it({},e,{fatal:!1,errorAction:Qn(!0),asset:a,assetListIndex:s,event:t,schedule:f,scheduleIndex:i,player:h});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;let m=this.playingAsset,_=new Error(n);if(a&&(this.clearAssetPlayer(l,null),a.error=_),!t.assetList.some(E=>!E.error))t.error=_;else{for(let E=s;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):m&&m.identifier===l&&this.advanceAfterAssetEnded(t,i,s)}primaryFallback(e){let t=e.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${i?bs(i):"<none>"} error: ${e.error}`);let s=this.timelinePos;s===-1&&(s=this.hls.startPosition);let n=this.updateItem(i,s);this.itemsMatch(i,n)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let a=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var i;let s=t.event,n=s.identifier,a=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(n))return;let l=s.timelineStart,c=s.duration,h=0;a.forEach((E,S)=>{let C=parseFloat(E.DURATION);this.createAsset(s,S,h,l+h,C,E.URI),h+=C}),s.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${c}) ${s}`);let f=this.waitingItem,p=f?.event.identifier===n;this.updateSchedule();let m=(i=this.bufferingItem)==null?void 0:i.event;if(p){var _;let E=this.schedule.findEventIndex(n),S=(_=this.schedule.items)==null?void 0:_[E];if(S){if(!this.playingItem&&this.timelinePos>S.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){s.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${s}`),this.primaryFallback(s);return}this.setBufferingItem(S)}this.setSchedulePosition(E)}else if(m?.identifier===n&&m.appendInPlace){let E=s.assetList[0],S=this.getAssetPlayer(E.identifier),C=this.primaryMedia;E&&S&&C&&this.bufferAssetPlayer(S,C)}}onError(e,t){switch(t.details){case z.ASSET_LIST_PARSING_ERROR:case z.ASSET_LIST_LOAD_ERROR:case z.ASSET_LIST_LOAD_TIMEOUT:{let i=t.interstitial;i&&this.primaryFallback(i);break}case z.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}},wm=500,ud=class extends ea{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",Ae.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=he.IDLE,this.setInterval(wm),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){let{frag:i,success:s}=t;if(this.fragContextChanged(i)||(Lt(i)&&(this.fragPrevious=i),this.state=he.IDLE),!s)return;let n=this.tracksBuffered[this.currentTrackId];if(!n)return;let a,l=i.start;for(let h=0;h<n.length;h++)if(l>=n[h].start&&l<=n[h].end){a=n[h];break}let c=i.start+i.duration;a?a.end=c:(a={start:l,end:c},n.push(a)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){let{startOffset:i,endOffset:s}=t;if(i===0&&s!==Number.POSITIVE_INFINITY){let n=s-1;if(n<=0)return;t.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(a=>{for(let l=0;l<a.length;){if(a[l].end<=n){a.shift();continue}else if(a[l].start<n)a[l].start=n;else break;l++}}),this.fragmentTracker.removeFragmentsInRange(i,n,Ae.SUBTITLE)}}onError(e,t){let i=t.frag;i?.type===Ae.SUBTITLE&&(t.details===z.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==he.STOPPED&&(this.state=he.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Wy(this.levels,t)){this.levels=t.map(i=>new hr(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{let s=new hr(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ae.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}let s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==he.STOPPED&&this.setInterval(wm)}onSubtitleTrackLoaded(e,t){var i;let{currentTrackId:s,levels:n}=this,{details:a,id:l}=t;if(!n){this.warn(`Subtitle tracks were reset while loading level ${l}`);return}let c=n[l];if(l>=n.length||!c)return;this.log(`Subtitle track ${l} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(a.live||(i=c.details)!=null&&i.live){if(a.deltaUpdateFailed)return;let p=this.mainDetails;if(!p){this.startFragRequested=!1;return}let m=p.fragments[0];if(!c.details)a.hasProgramDateTime&&p.hasProgramDateTime?(il(a,p),h=a.fragmentStart):m&&(h=m.start,Pc(a,h));else{var f;h=this.alignPlaylists(a,c.details,(f=this.levelLastLoaded)==null?void 0:f.details),h===0&&m&&(h=m.start,Pc(a,h))}p&&!this.startFragRequested&&this.setStartPosition(p,h)}c.details=a,this.levelLastLoaded=c,l===s&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:a,id:l,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===he.IDLE&&(cr(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),c.details=void 0)))}_handleFragmentLoadComplete(e){let{frag:t,payload:i}=e,s=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&s!=null&&s.key&&s.iv&&Kr(s.method)){let a=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer,Df(s.method)).catch(l=>{throw n.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:t}),l}).then(l=>{let c=performance.now();n.trigger(L.FRAG_DECRYPTED,{frag:t,payload:l,stats:{tstart:a,tdecrypt:c}})}).catch(l=>{this.warn(`${l.name}: ${l.message}`),this.state=he.IDLE})}}doTick(){if(!this.media){this.state=he.IDLE;return}if(this.state===he.IDLE){let{currentTrackId:e,levels:t}=this,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;let{config:s}=this,n=this.getLoadPosition(),a=He.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,s.maxBufferHole),{end:l,len:c}=a,h=i.details,f=this.hls.maxBufferLength+h.levelTargetDuration;if(c>f)return;let p=h.fragments,m=p.length,_=h.edge,E=null,S=this.fragPrevious;if(l<_){let R=s.maxFragLookUpTolerance,k=l>_-R?0:R;E=cr(S,p,Math.max(p[0].start,l),k),!E&&S&&S.start<p[0].start&&(E=p[0])}else E=p[m-1];if(E=this.filterReplacedPrimary(E,i.details),!E)return;let C=E.sn-h.startSN,I=p[C-1];if(I&&I.cc===E.cc&&this.fragmentTracker.getState(I)===Rt.NOT_LOADED&&(E=I),this.fragmentTracker.getState(E)===Rt.NOT_LOADED){let R=this.mapToInitFragWhenRequired(E);R&&this.loadFragment(R,i,l)}}}loadFragment(e,t,i){Lt(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new hd(this.tracksBuffered[this.currentTrackId]||[])}},hd=class{constructor(e){this.buffered=void 0;let t=(i,s,n)=>{if(s=s>>>0,s>n-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${n})`);return e[s][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}},rw={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},sT=r=>String.fromCharCode(rw[r]||r),wi=15,es=100,nw={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},aw={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ow={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},lw={25:2,26:4,29:6,30:8,31:10,27:13,28:15},uw=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],cd=class{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){let i=typeof t=="function"?t():t;Ze.log(`${this.time} [${e}] ${i}`)}}},Qs=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t},dl=class{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){let t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){let s=t[i];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}},dd=class{constructor(){this.uchar=" ",this.penState=new dl}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}},fd=class{constructor(e){this.chars=[],this.pos=0,this.currPenState=new dl,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<es;t++)this.chars.push(new dd);this.logger=e}equals(e){for(let t=0;t<es;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<es;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<es;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>es&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=es)}moveCursor(e){let t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();let t=sT(e);if(this.pos>=es){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<es;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){let e=[],t=!0;for(let i=0;i<es;i++){let s=this.chars[i].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}},qn=class{constructor(e){this.rows=[],this.currRow=wi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<wi;t++)this.rows.push(new fd(e));this.logger=e}reset(){for(let e=0;e<wi;e++)this.rows[e].clear();this.currRow=wi-1}equals(e){let t=!0;for(let i=0;i<wi;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<wi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<wi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+ft(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let l=0;l<wi;l++)this.rows[l].clear();let n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){let l=a.rows[n].cueStartTime,c=this.logger.time;if(l!==null&&c!==null&&l<c)for(let h=0;h<this.nrRollUpRows;h++)this.rows[t-this.nrRollUpRows+h+1].copy(a.rows[n+h])}}this.currRow=t;let i=this.rows[this.currRow];if(e.indent!==null){let n=e.indent,a=Math.max(n-1,0);i.setCursor(e.indent),e.color=i.chars[a].penState.foreground}let s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+ft(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());let e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;let t=[],i="",s=-1;for(let n=0;n<wi;n++){let a=this.rows[n].getTextString();a&&(s=n+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}},fl=class{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new qn(i),this.nonDisplayedMemory=new qn(i),this.lastOutputScreen=new qn(i),this.currRollUpRow=this.displayedMemory.rows[wi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[wi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);let t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){let e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){let t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{let i=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[i]}this.logger.log(2,"MIDROW: "+ft(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){let t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}},pl=class{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=cw(),this.logger=void 0;let s=this.logger=new cd;this.channels=[null,new fl(e,t,s),new fl(e+1,i,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){let s=t[i]&127,n=t[i+1]&127,a=!1,l=null;if(s===0&&n===0)continue;this.logger.log(3,()=>"["+Qs([t[i],t[i+1]])+"] -> ("+Qs([s,n])+")");let c=this.cmdHistory;if(s>=16&&s<=31){if(hw(s,n,c)){ao(null,null,c),this.logger.log(3,()=>"Repeated command ("+Qs([s,n])+") is dropped");continue}ao(s,n,this.cmdHistory),a=this.parseCmd(s,n),a||(a=this.parseMidrow(s,n)),a||(a=this.parsePAC(s,n)),a||(a=this.parseBackgroundAttributes(s,n))}else ao(null,null,c);if(!a&&(l=this.parseChars(s,n),l)){let f=this.currentChannel;f&&f>0?this.channels[f].insertChars(l):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!l&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Qs([s,n])+" orig: "+Qs([t[i],t[i+1]]))}}parseCmd(e,t){let i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(i||s))return!1;let n=e===20||e===21||e===23?1:2,a=this.channels[n];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;let s=this.channels[i];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Qs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i,s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,n=(e===16||e===24)&&t>=64&&t<=95;if(!(s||n))return!1;let a=e<=23?1:2;t>=64&&t<=95?i=a===1?nw[e]:ow[e]:i=a===1?aw[e]:lw[e];let l=this.channels[a];return l?(l.setPAC(this.interpretPAC(i,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let i,s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(e,t){let i,s=null,n=null;if(e>=25?(i=2,n=e-8):(i=1,n=e),n>=17&&n<=19){let a;n===17?a=t+80:n===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+sT(a)+"' in channel "+i),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Qs(s).join(",")),s}parseBackgroundAttributes(e,t){let i=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(i||s))return!1;let n,a={};e===16||e===24?(n=Math.floor((t-32)/2),a.background=uw[n],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));let l=e<=23?1:2;return this.channels[l].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){let t=this.channels[e];t&&t.reset()}ao(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){let i=this.channels[t];i&&i.cueSplitAtTime(e)}}};function ao(r,e,t){t.a=r,t.b=e}function hw(r,e,t){return t.a===r&&t.b===e}function cw(){return{a:null,b:null}}var $f=function(){if(el!=null&&el.VTTCue)return self.VTTCue;let r=["","lr","rl"],e=["start","middle","end","left","right"];function t(l,c){if(typeof c!="string"||!Array.isArray(l))return!1;let h=c.toLowerCase();return~l.indexOf(h)?h:!1}function i(l){return t(r,l)}function s(l){return t(e,l)}function n(l,...c){let h=1;for(;h<arguments.length;h++){let f=arguments[h];for(let p in f)l[p]=f[p]}return l}function a(l,c,h){let f=this,p={enumerable:!0};f.hasBeenReset=!1;let m="",_=!1,E=l,S=c,C=h,I=null,R="",k=!0,D="auto",x="start",N=50,B="middle",H=50,O="middle";Object.defineProperty(f,"id",n({},p,{get:function(){return m},set:function(P){m=""+P}})),Object.defineProperty(f,"pauseOnExit",n({},p,{get:function(){return _},set:function(P){_=!!P}})),Object.defineProperty(f,"startTime",n({},p,{get:function(){return E},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");E=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",n({},p,{get:function(){return S},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");S=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",n({},p,{get:function(){return C},set:function(P){C=""+P,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",n({},p,{get:function(){return I},set:function(P){I=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",n({},p,{get:function(){return R},set:function(P){let G=i(P);if(G===!1)throw new SyntaxError("An invalid or illegal string was specified.");R=G,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",n({},p,{get:function(){return k},set:function(P){k=!!P,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",n({},p,{get:function(){return D},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",n({},p,{get:function(){return x},set:function(P){let G=s(P);if(!G)throw new SyntaxError("An invalid or illegal string was specified.");x=G,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",n({},p,{get:function(){return N},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");N=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",n({},p,{get:function(){return B},set:function(P){let G=s(P);if(!G)throw new SyntaxError("An invalid or illegal string was specified.");B=G,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",n({},p,{get:function(){return H},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");H=P,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",n({},p,{get:function(){return O},set:function(P){let G=s(P);if(!G)throw new SyntaxError("An invalid or illegal string was specified.");O=G,this.hasBeenReset=!0}})),f.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}(),pd=class{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}};function rT(r){function e(i,s,n,a){return(i|0)*3600+(s|0)*60+(n|0)+parseFloat(a||0)}let t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}var gd=class{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){let i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}};function nT(r,e,t,i){let s=i?r.split(i):[r];for(let n in s){if(typeof s[n]!="string")continue;let a=s[n].split(t);if(a.length!==2)continue;let l=a[0],c=a[1];e(l,c)}}var md=new $f(0,0,""),oo=md.align==="middle"?"middle":"center";function dw(r,e,t){let i=r;function s(){let l=rT(r);if(l===null)throw new Error("Malformed timestamp: "+i);return r=r.replace(/^[^\sa-zA-Z-]+/,""),l}function n(l,c){let h=new gd;nT(l,function(m,_){let E;switch(m){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===_){h.set(m,t[S].region);break}break;case"vertical":h.alt(m,_,["rl","lr"]);break;case"line":E=_.split(","),h.integer(m,E[0]),h.percent(m,E[0])&&h.set("snapToLines",!1),h.alt(m,E[0],["auto"]),E.length===2&&h.alt("lineAlign",E[1],["start",oo,"end"]);break;case"position":E=_.split(","),h.percent(m,E[0]),E.length===2&&h.alt("positionAlign",E[1],["start",oo,"end","line-left","line-right","auto"]);break;case"size":h.percent(m,_);break;case"align":h.alt(m,_,["start",oo,"end","left","right"]);break}},/:/,/\s/),c.region=h.get("region",null),c.vertical=h.get("vertical","");let f=h.get("line","auto");f==="auto"&&md.line===-1&&(f=-1),c.line=f,c.lineAlign=h.get("lineAlign","start"),c.snapToLines=h.get("snapToLines",!0),c.size=h.get("size",100),c.align=h.get("align",oo);let p=h.get("position","auto");p==="auto"&&md.position===50&&(p=c.align==="start"||c.align==="left"?0:c.align==="end"||c.align==="right"?100:50),c.position=p}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);r=r.slice(3),a(),e.endTime=s(),a(),n(r,e)}function aT(r){return r.replace(/<br(?: \/)?>/gi,`
`)}var vd=class{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new pd,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){let t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let n=t.buffer,a=0;for(n=aT(n);a<n.length&&n[a]!=="\r"&&n[a]!==`
`;)++a;let l=n.slice(0,a);return n[a]==="\r"&&++a,n[a]===`
`&&++a,t.buffer=n.slice(a),l}function s(n){nT(n,function(a,l){},/:/)}try{let n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;n=i();let l=n.match(/^()?WEBVTT([ \t].*)?$/);if(!(l!=null&&l[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=i(),t.state){case"HEADER":/:/.test(n)?s(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new $f(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{dw(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{let l=n.indexOf("-->")!==-1;if(!n||l&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n}continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){let e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}},fw=/\r\n|\n\r|\n|\r/g,ch=function(e,t,i=0){return e.slice(i,i+t.length)===t},pw=function(e){let t=parseInt(e.slice(-3)),i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ce(t)||!Ce(i)||!Ce(s)||!Ce(n))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*s,t+=60*60*1e3*n,t};function Hf(r,e,t){return Kn(r.toString())+Kn(e.toString())+Kn(t)}var gw=function(e,t,i){let s=e[t],n=e[s.prevCC];if(!n||!n.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=n)!=null&&a.new;){var a;e.ccOffset+=s.start-n.start,s.new=!1,s=n,n=e[s.prevCC]}e.presentationOffset=i};function mw(r,e,t,i,s,n,a){let l=new vd,c=oi(new Uint8Array(r)).trim().replace(fw,`
`).split(`
`),h=[],f=e?tC(e.baseTime,e.timescale):0,p="00:00.000",m=0,_=0,E,S=!0;l.oncue=function(C){let I=t[i],R=t.ccOffset,k=(m-f)/9e4;if(I!=null&&I.new&&(_!==void 0?R=t.ccOffset=I.start:gw(t,i,k)),k){if(!e){E=new Error("Missing initPTS for VTT MPEGTS");return}R=k-t.presentationOffset}let D=C.endTime-C.startTime,x=gi((C.startTime+R-_)*9e4,s*9e4)/9e4;C.startTime=Math.max(x,0),C.endTime=Math.max(x+D,0);let N=C.text.trim();C.text=decodeURIComponent(encodeURIComponent(N)),C.id||(C.id=Hf(C.startTime,C.endTime,N)),C.endTime>0&&h.push(C)},l.onparsingerror=function(C){E=C},l.onflush=function(){if(E){a(E);return}n(h)},c.forEach(C=>{if(S)if(ch(C,"X-TIMESTAMP-MAP=")){S=!1,C.slice(16).split(",").forEach(I=>{ch(I,"LOCAL:")?p=I.slice(6):ch(I,"MPEGTS:")&&(m=parseInt(I.slice(7)))});try{_=pw(p)/1e3}catch(I){E=I}return}else C===""&&(S=!1);l.parse(C+`
`)}),l.flush()}var dh="stpp.ttml.im1t",oT=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,lT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,vw={left:"start",center:"center",right:"end",start:"start",end:"end"};function Am(r,e,t,i){let s=je(new Uint8Array(r),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}let n=s.map(l=>oi(l)),a=eC(e.baseTime,1,e.timescale);try{n.forEach(l=>t(yw(l,a)))}catch(l){i(l)}}function yw(r,e){let s=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");let n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(n).reduce((p,m)=>(p[m]=s.getAttribute(`ttp:${m}`)||n[m],p),{}),l=s.getAttribute("xml:space")!=="preserve",c=Im(fh(s,"styling","style")),h=Im(fh(s,"layout","region")),f=fh(s,"body","[begin]");return[].map.call(f,p=>{let m=uT(p,l);if(!m||!p.hasAttribute("begin"))return null;let _=gh(p.getAttribute("begin"),a),E=gh(p.getAttribute("dur"),a),S=gh(p.getAttribute("end"),a);if(_===null)throw Lm(p);if(S===null){if(E===null)throw Lm(p);S=_+E}let C=new $f(_-e,S-e,m);C.id=Hf(C.startTime,C.endTime,C.text);let I=h[p.getAttribute("region")],R=c[p.getAttribute("style")],k=Tw(I,R,c),{textAlign:D}=k;if(D){let x=vw[D];x&&(C.lineAlign=x),C.align=D}return it(C,k),C}).filter(p=>p!==null)}function fh(r,e,t){let i=r.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function Im(r){return r.reduce((e,t)=>{let i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function uT(r,e){return[].slice.call(r.childNodes).reduce((t,i,s)=>{var n;return i.nodeName==="br"&&s?t+`
`:(n=i.childNodes)!=null&&n.length?uT(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function Tw(r,e,t){let i="http://www.w3.org/ns/ttml#styling",s=null,n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),n.reduce((l,c)=>{let h=ph(e,i,c)||ph(r,i,c)||ph(s,i,c);return h&&(l[c]=h),l},{})}function ph(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function Lm(r){return new Error(`Could not parse ttml timestamp ${r}`)}function gh(r,e){if(!r)return null;let t=rT(r);return t===null&&(oT.test(r)?t=_w(r,e):lT.test(r)&&(t=Ew(r,e))),t}function _w(r,e){let t=oT.exec(r),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function Ew(r,e){let t=lT.exec(r),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}var jr=class{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}},yd=class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Rm(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){let{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){let e=new jr(this,"textTrack1"),t=new jr(this,"textTrack2"),i=new jr(this,"textTrack3"),s=new jr(this,"textTrack4");this.cea608Parser1=new pl(1,e,t),this.cea608Parser2=new pl(3,i,s)}addCues(e,t,i,s,n){let a=!1;for(let l=n.length;l--;){let c=n[l],h=bw(c[0],c[1],t,i);if(h>=0&&(c[0]=Math.min(c[0],t),c[1]=Math.max(c[1],i),a=!0,h/(i-t)>.5))return}if(a||n.push([t,i]),this.config.renderTextTracksNatively){let l=this.captionsTracks[e];this.Cues.newCue(l,t,i,s)}else{let l=this.Cues.newCue(null,t,i,s);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:l,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:n}){let{unparsedVttFrags:a}=this;i===Ae.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:n}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,l):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){let{media:i}=this;if(i)for(let s=0;s<i.textTracks.length;s++){let n=i.textTracks[s];if(km(n,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;let{captionsProperties:t,captionsTracks:i,media:s}=this,{label:n,languageCode:a}=t[e],l=this.getExistingTrack(n,a);if(l)i[e]=l,Hr(i[e]),eT(i[e],s);else{let c=this.createTextTrack("captions",n,a);c&&(c[e]=!0,i[e]=c)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;let t=this.captionsProperties[e];if(!t)return;let i=t.label,s={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,i){let s=this.media;if(s)return s.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){let i=!!t.transferMedia;if(this.media=null,i)return;let{captionsTracks:s}=this;Object.keys(s).forEach(n=>{Hr(s[n]),delete s[n]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Rm(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){let{media:e}=this;if(!e)return;let t=e.textTracks;if(t)for(let i=0;i<t.length;i++)Hr(t[i])}onSubtitleTracksUpdated(e,t){let i=t.subtitleTracks||[],s=i.some(n=>n.textCodec===dh);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Wy(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){let a=this.media,l=a?ko(a.textTracks):null;if(this.tracks.forEach((c,h)=>{let f;if(l){let p=null;for(let m=0;m<l.length;m++)if(l[m]&&km(l[m],c)){p=l[m],l[m]=null;break}p&&(f=p)}if(f)Hr(f);else{let p=hT(c);f=this.createTextTrack(p,c.name,c.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),l!=null&&l.length){let c=l.filter(h=>h!==null).map(h=>h.label);c.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${c.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){let a=this.tracks.map(l=>({label:l.name,kind:l.type.toLowerCase(),default:l.default,subtitleTrack:l}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{let s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;let n=`textTrack${s[1]}`,a=this.captionsProperties[n];a&&(a.label=i.name,i.lang&&(a.languageCode=i.lang),a.media=i)})}closedCaptionsForLevel(e){let t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Ae.MAIN){var i,s;let{cea608Parser1:n,cea608Parser2:a,lastSn:l}=this,{cc:c,sn:h}=t.frag,f=(i=(s=t.part)==null?void 0:s.index)!=null?i:-1;n&&a&&(h!==l+1||h===l&&f!==this.lastPartIndex+1||c!==this.lastCc)&&(n.reset(),a.reset()),this.lastCc=c,this.lastSn=h,this.lastPartIndex=f}}onFragLoaded(e,t){let{frag:i,payload:s}=t;if(i.type===Ae.SUBTITLE)if(s.byteLength){let n=i.decryptdata,a="stats"in t;if(n==null||!n.encrypted||a){let l=this.tracks[i.level],c=this.vttCCs;c[i.cc]||(c[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),l&&l.textCodec===dh?this._parseIMSC1(i,s):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){let i=this.hls;Am(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),i.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{i.logger.log(`Failed to parse IMSC1: ${s}`),i.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;let{frag:i,payload:s}=e,{initPTS:n,unparsedVttFrags:a}=this,l=n.length-1;if(!n[i.cc]&&l===-1){a.push(e);return}let c=this.hls,h=(t=i.initSegment)!=null&&t.data?yi(i.initSegment.data,new Uint8Array(s)).buffer:s;mw(h,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,f=>{this._appendCues(f,i.level),c.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},f=>{let p=f.message==="Missing initPTS for VTT MPEGTS";p?a.push(e):this._fallbackToIMSC1(i,s),c.logger.log(`Failed to parse VTT cue: ${f}`),!(p&&l>i.cc)&&c.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:f})})}_fallbackToIMSC1(e,t){let i=this.tracks[e.level];i.textCodec||Am(t,this.initPTS[e.cc],()=>{i.textCodec=dh,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){let i=this.hls;if(this.config.renderTextTracksNatively){let s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(n=>tT(s,n))}else{let s=this.tracks[t];if(!s)return;let n=s.default?"default":"subtitles"+t;i.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){let{frag:i}=t;i.type===Ae.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;let{frag:i,samples:s}=t;if(!(i.type===Ae.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let n=0;n<s.length;n++){let a=s[n].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();let l=this.extractCea608Data(a);this.cea608Parser1.addData(s[n].pts,l[0]),this.cea608Parser2.addData(s[n].pts,l[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:s,type:n}){let{media:a}=this;if(!(!a||a.currentTime<i)){if(!n||n==="video"){let{captionsTracks:l}=this;Object.keys(l).forEach(c=>id(l[c],t,i))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){let{textTracks:l}=this;Object.keys(l).forEach(c=>id(l[c],t,s))}}}extractCea608Data(e){let t=[[],[]],i=e[0]&31,s=2;for(let n=0;n<i;n++){let a=e[s++],l=127&e[s++],c=127&e[s++];if(l===0&&c===0)continue;if((4&a)!==0){let f=3&a;(f===0||f===1)&&(t[f].push(l),t[f].push(c))}}return t}};function hT(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function km(r,e){return!!r&&r.kind===hT(e)&&Kc(e,r)}function bw(r,e,t,i){return Math.min(e,i)-Math.max(r,t)}function Rm(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var Sw=/\s/,Cw={newCue(r,e,t,i){let s=[],n,a,l,c,h,f=self.VTTCue||self.TextTrackCue;for(let m=0;m<i.rows.length;m++)if(n=i.rows[m],l=!0,c=0,h="",!n.isEmpty()){var p;for(let S=0;S<n.chars.length;S++)Sw.test(n.chars[S].uchar)&&l?c++:(h+=n.chars[S].uchar,l=!1);n.cueStartTime=e,e===t&&(t+=1e-4),c>=16?c--:c++;let _=aT(h.trim()),E=Hf(e,t,_);r!=null&&(p=r.cues)!=null&&p.getCueById(E)||(a=new f(e,t,_),a.id=E,a.line=m+1,a.align="left",a.position=10+Math.min(80,Math.floor(c*8/32)*10),s.push(a))}return r&&s.length&&(s.sort((m,_)=>m.line==="auto"||_.line==="auto"?0:m.line>8&&_.line>8?_.line-m.line:m.line-_.line),s.forEach(m=>tT(r,m))),s}};function ww(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var Aw=/(\d+)-(\d+)\/(\d+)/,gl=class{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Rw,this.controller=new self.AbortController,this.stats=new Yn}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){let s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();let n=Iw(e,this.controller.signal),a=e.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:h}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=c&&Ce(c)?c:h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(ra(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var m;this.response=this.loader=p;let _=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},h-(_-s.loading.start)),!p.ok){let{status:S,statusText:C}=p;throw new Td(C||"fetch, bad network response",S,p)}s.loading.first=_,s.total=kw(p.headers)||s.total;let E=(m=this.callbacks)==null?void 0:m.onProgress;return E&&Ce(t.highWaterMark)?this.loadProgressively(p,s,e,t.highWaterMark,E):a?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var m,_;let E=this.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);let S=p[l];S&&(s.loaded=s.total=S);let C={url:E.url,data:p,code:E.status},I=(m=this.callbacks)==null?void 0:m.onProgress;I&&!Ce(t.highWaterMark)&&I(s,e,p,E),(_=this.callbacks)==null||_.onSuccess(C,s,e,E)}).catch(p=>{var m;if(self.clearTimeout(this.requestTimeout),s.aborted)return;let _=p&&p.code||0,E=p?p.message:null;(m=this.callbacks)==null||m.onError({code:_,text:E},e,p?p.details:null,s)})}getCacheAge(){let e=null;if(this.response){let t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,s=0,n){let a=new sl,l=e.body.getReader(),c=()=>l.read().then(h=>{if(h.done)return a.dataLength&&n(t,i,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));let f=h.value,p=f.length;return t.loaded+=p,p<s||a.dataLength?(a.push(f),a.dataLength>=s&&n(t,i,a.flush().buffer,e)):n(t,i,f.buffer,e),c()}).catch(()=>Promise.reject());return c()}};function Iw(r,e){let t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(it({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function Lw(r){let e=Aw.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function kw(r){let e=r.get("Content-Range");if(e){let i=Lw(e);if(Ce(i))return i}let t=r.get("Content-Length");if(t)return parseInt(t)}function Rw(r,e){return new self.Request(r.url,e)}var Td=class extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}},Pw=/^age:\s*[\d.]+\s*$/im,ml=class{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Yn,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){let{config:e,context:t}=this;if(!e||!t)return;let i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;let n=this.xhrSetup;n?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return n(i,t.url)}).catch(a=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),n(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(a=>{var l;(l=this.callbacks)==null||l.onError({code:i.status,text:a.message},t,i,s)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);let s=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:a}=i.loadPolicy;if(s)for(let l in s)e.setRequestHeader(l,s[l]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=n&&Ce(n)?n:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){let{context:e,loader:t,stats:i}=this;if(!e||!t)return;let s=t.readyState,n=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;let h=t.status,f=t.responseType==="text"?t.responseText:null;if(h>=200&&h<300){let E=f??t.response;if(E!=null){var a,l;i.loading.end=Math.max(self.performance.now(),i.loading.first);let S=t.responseType==="arraybuffer"?E.byteLength:E.length;i.loaded=i.total=S,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);let C=(a=this.callbacks)==null?void 0:a.onProgress;C&&C(i,e,E,t);let I={url:t.responseURL,data:E,code:h};(l=this.callbacks)==null||l.onSuccess(I,i,e,t);return}}let p=n.loadPolicy.errorRetry,m=i.retry,_={url:e.url,data:void 0,code:h};if(Qo(p,m,!1,_))this.retry(p);else{var c;Ze.error(`${h} while loading ${e.url}`),(c=this.callbacks)==null||c.onError({code:h,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;let e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Qo(e,t,!0))this.retry(e);else{var i;Ze.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);let s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){let{context:t,stats:i}=this;this.retryDelay=Pf(e,i.retry),i.retry++,Ze.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Pw.test(this.loader.getAllResponseHeaders())){let t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}},Dw={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},xw=rt(rt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:ml,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Tc,bufferController:Yc,capLevelController:Xc,errorController:_c,fpsController:td,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:_y,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:Dw},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Ow()),{},{subtitleStreamController:ud,subtitleTrackController:sd,timelineController:yd,audioStreamController:Gc,audioTrackController:qc,emeController:JC,cmcdController:Zc,contentSteeringController:ed,interstitialsController:ld});function Ow(){return{cueHandler:Cw,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Mw(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let i=_d(r),s=["manifest","level","frag"],n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(a=>{let l=`${a==="level"?"playlist":a}LoadPolicy`,c=e[l]===void 0,h=[];n.forEach(f=>{let p=`${a}Loading${f}`,m=e[p];if(m!==void 0&&c){h.push(p);let _=i[l].default;switch(e[l]={default:_},f){case"TimeOut":_.maxLoadTimeMs=m,_.maxTimeToFirstByteMs=m;break;case"MaxRetry":_.errorRetry.maxNumRetry=m,_.timeoutRetry.maxNumRetry=m;break;case"RetryDelay":_.errorRetry.retryDelayMs=m,_.timeoutRetry.retryDelayMs=m;break;case"MaxRetryTimeout":_.errorRetry.maxRetryDelayMs=m,_.timeoutRetry.maxRetryDelayMs=m;break}}}),h.length&&t.warn(`hls.js config: "${h.join('", "')}" setting(s) are deprecated, use "${l}": ${ft(e[l])}`)}),rt(rt({},i),e)}function _d(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(_d):Object.keys(r).reduce((e,t)=>(e[t]=_d(r[t]),e),{}):r}function Fw(r,e){let t=r.loader;t!==gl&&t!==ml?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):ww()&&(r.loader=gl,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}var Ro=2,Nw=.1,Bw=.05,Uw=100,Ed=class extends Jo{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){let{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(Uw),this.mediaSource=t.mediaSource;let i=this.media=t.media;vi(i,"playing",this.onMediaPlaying),vi(i,"waiting",this.onMediaWaiting),vi(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();let{media:i}=this;i&&(ki(i,"playing",this.onMediaPlaying),ki(i,"waiting",this.onMediaWaiting),ki(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;let t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,s;let n=(i=this.hls)==null?void 0:i.config;if(!n)return;let a=this.media;if(!a)return;let{seeking:l}=a,c=this.seeking&&!l,h=!this.seeking&&l,f=a.paused&&!l||a.ended||a.playbackRate===0;if(this.seeking=l,e!==t){t&&(this.ended=0),this.moved=!0,l||(this.nudgeRetry=0,n.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(h||c){c&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!He.getBuffered(a).length){this.nudgeRetry=0;return}let p=He.bufferInfo(a,e,0),m=p.nextStart||0,_=this.fragmentTracker;if(l&&_&&this.hls){let N=Pm(this.hls.inFlightFragments,e),B=p.len>Ro,H=!m||N||m-e>Ro&&!_.getPartialFragment(e);if(B||H)return;this.moved=!1}let E=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&_){if(!(p.len>0)&&!m)return;let B=Math.max(m,p.start||0)-e,O=!!(E!=null&&E.live)?E.targetduration*2:Ro,P=_.getPartialFragment(e);if(B>0&&(B<=O||P)){a.paused||this._trySkipBufferHole(P);return}}let S=n.detectStallWithCurrentTimeMs,C=self.performance.now(),I=this.waiting,R=this.stalled;if(R===null)if(I>0&&C-I<S)R=this.stalled=I;else{this.stalled=C;return}let k=C-R;if(!l&&(k>=S||I)&&this.hls){var D;if(((D=this.mediaSource)==null?void 0:D.readyState)==="ended"&&!(E!=null&&E.live)&&Math.abs(e-(E?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}let x=He.bufferInfo(a,e,n.maxBufferHole);this._tryFixBufferStall(x,k,e)}stallResolved(e){let t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){let i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;let s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&s&&s.length>1&&e>s.end(0)){let n=He.bufferedInfo(He.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){let a=He.timeRangesToArray(s),l=He.bufferedInfo(a,t,0).bufferedIndex;if(l>-1&&l<a.length-1){let c=He.bufferedInfo(a,e,0).bufferedIndex,h=a[l].end,f=a[l+1].start;if((c===-1||c>l)&&f-h<1&&e-h<2){let p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${h} -> ${f} buffered index: ${c}`);this.warn(p.message),this.media.currentTime+=1e-6;let m=this.fragmentTracker.getPartialFragment(e)||void 0,_=He.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:m,buffer:_.len,bufferInfo:_})}}}}}_tryFixBufferStall(e,t,i){var s,n;let{fragmentTracker:a,media:l}=this,c=(s=this.hls)==null?void 0:s.config;if(!l||!a||!c)return;let h=(n=this.hls)==null?void 0:n.latestLevelDetails,f=a.getPartialFragment(i);if((f||h!=null&&h.live&&i<h.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;let p=e.buffered,m=this.adjacentTraversal(e,i);(p&&p.length>1&&e.len>c.maxBufferHole||e.nextStart&&(e.nextStart-i<c.maxBufferHole||m))&&(t>c.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){let i=this.fragmentTracker,s=e.nextStart;if(i&&s){let n=i.getFragAtPos(t,Ae.MAIN),a=i.getFragAtPos(s,Ae.MAIN);if(n&&a)return a.sn-n.sn<2}return!1}_reportStall(e){let{hls:t,media:i,stallReported:s,stalled:n}=this;if(!s&&n!==null&&i&&t){this.stallReported=!0;let a=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${ft(e)})`);this.warn(a.message),t.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:n}})}}_trySkipBufferHole(e){var t;let{fragmentTracker:i,media:s}=this,n=(t=this.hls)==null?void 0:t.config;if(!s||!i||!n)return 0;let a=s.currentTime,l=He.bufferInfo(s,a,0),c=a<l.start?l.start:l.nextStart;if(c&&this.hls){let f=l.len<=n.maxBufferHole,p=l.len>0&&l.len<1&&s.readyState<3,m=c-a;if(m>0&&(f||p)){if(m>n.maxBufferHole){let E=!1;if(a===0){let S=i.getAppendedFrag(0,Ae.MAIN);S&&c<S.end&&(E=!0)}if(!E){let S=e||i.getAppendedFrag(a,Ae.MAIN);if(S){var h;if(!((h=this.hls.loadLevelObj)!=null&&h.details)||Pm(this.hls.inFlightFragments,c))return 0;let I=!1,R=S.end;for(;R<c;){let k=i.getAppendedFrag(R,Ae.MAIN)||i.getPartialFragment(R);if(k)R+=k.duration;else{I=!0;break}}if(I)return 0}}}let _=Math.max(c+Bw,a+Nw);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${_}`),this.moved=!0,s.currentTime=_,!(e!=null&&e.gap)){let E=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${_}`);this.hls.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:E,reason:E.message,frag:e||void 0,buffer:l.len,bufferInfo:l})}return _}}return 0}_tryNudgeBuffer(e){let{hls:t,media:i,nudgeRetry:s}=this,n=t?.config;if(!i||!n)return 0;let a=i.currentTime;if(this.nudgeRetry++,s<n.nudgeMaxRetry){let l=a+(s+1)*n.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${a} to ${l}`);this.warn(c.message),i.currentTime=l,t.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1,buffer:e.len,bufferInfo:e})}else{let l=new Error(`Playhead still not moving while enough data buffered @${a} after ${n.nudgeMaxRetry} nudges`);this.error(l.message),t.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,error:l,fatal:!0,buffer:e.len,bufferInfo:e})}}};function Pm(r,e){let t=Dm(r.main);if(t&&t.start<=e)return t;let i=Dm(r.audio);return i&&i.start<=e?i:null}function Dm(r){if(!r)return null;switch(r.state){case he.IDLE:case he.STOPPED:case he.ENDED:case he.ERROR:return null}return r.frag}var $w=.25;function bd(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function xm(r,e,t,i,s){let n=new r(e,t,"");try{n.value=i,s&&(n.type=s)}catch{n=new r(e,t,ft(s?rt({type:s},i):i))}return n}var lo=(()=>{let r=bd();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})(),Sd=class{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){let{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){let{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){let e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Hr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){let t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){let i=e[t];if(i.kind==="metadata"&&i.label==="id3")return eT(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;let{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:s}}}=this;if(!i&&!s)return;let{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));let a=bd();if(a)for(let l=0;l<n.length;l++){let c=n[l].type;if(c===ai.emsg&&!i||!s)continue;let h=Fy(n[l].data);if(h){let f=n[l].pts,p=f+n[l].duration;p>lo&&(p=lo),p-f<=0&&(p=f+$w);for(let _=0;_<h.length;_++){let E=h[_];if(!Ny(E)){this.updateId3CueEnds(f,c);let S=xm(a,f,p,E,c);S&&this.id3Track.addCue(S)}}}}}updateId3CueEnds(e,t){var i;let s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let n=s.length;n--;){let a=s[n];a.type===t&&a.startTime<e&&a.endTime===lo&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:s}){let{id3Track:n,hls:a}=this;if(!a)return;let{config:{enableEmsgMetadataCues:l,enableID3MetadataCues:c}}=a;if(n&&(l||c)){let h;s==="audio"?h=f=>f.type===ai.audioId3&&c:s==="video"?h=f=>f.type===ai.emsg&&l:h=f=>f.type===ai.audioId3&&c||f.type===ai.emsg&&l,id(n,t,i,h)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;let{id3Track:i}=this,{dateRanges:s}=e,n=Object.keys(s),a=this.dateRangeCuesAppended;if(i&&t){var l;if((l=i.cues)!=null&&l.length){let f=Object.keys(a).filter(p=>!n.includes(p));for(let p=f.length;p--;){let m=f[p],_=a[m].cues;delete a[m],Object.keys(_).forEach(E=>{try{let S=_[E];S.removeEventListener("enter",this.onEventCueEnter),i.removeCue(S)}catch{}})}}else a=this.dateRangeCuesAppended={}}let c=e.fragments[e.fragments.length-1];if(n.length===0||!Ce(c?.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));let h=bd();for(let f=0;f<n.length;f++){let p=n[f],m=s[p],_=m.startTime,E=a[p],S=E?.cues||{},C=E?.durationKnown||!1,I=lo,{duration:R,endDate:k}=m;if(k&&R!==null)I=_+R,C=!0;else if(m.endOnNext&&!C){let x=n.reduce((N,B)=>{if(B!==m.id){let H=s[B];if(H.class===m.class&&H.startDate>m.startDate&&(!N||m.startDate<N.startDate))return H}return N},null);x&&(I=x.startTime,C=!0)}let D=Object.keys(m.attr);for(let x=0;x<D.length;x++){let N=D[x];if(!JS(N))continue;let B=S[N];if(B)C&&!E.durationKnown?B.endTime=I:Math.abs(B.startTime-_)>.01&&(B.startTime=_,B.endTime=I);else if(h){let H=m.attr[N];ZS(N)&&(H=sy(H));let P=xm(h,_,I,{key:N,data:H},ai.dateRange);P&&(P.id=p,this.id3Track.addCue(P),S[N]=P,this.hls.config.interstitialsController&&(N==="X-ASSET-LIST"||N==="X-ASSET-URL")&&P.addEventListener("enter",this.onEventCueEnter))}}a[p]={cues:S,dateRange:m,durationKnown:C}}}},Cd=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{let{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;let s=this.computeLatency();if(s===null)return;this._latency=s;let{lowLatencyMode:n,maxLiveSyncPlaybackRate:a}=this.config;if(!n||a===1||!i.live)return;let l=this.targetLatency;if(l===null)return;let c=s-l,h=Math.min(this.maxLatency,l+i.targetduration);if(c<h&&c>.05&&this.forwardBufferLength>1){let p=Math.min(2,Math.max(1,a)),m=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20,_=Math.min(p,Math.max(1,m));this.changeMediaPlaybackRate(t,_)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){let{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;let t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){let e=this.levelDetails;if(e===null||this.hls===null)return null;let{holdBack:t,partHoldBack:i,targetduration:s}=e,{liveSyncDuration:n,liveSyncDurationCount:a,lowLatencyMode:l}=this.config,c=this.hls.userConfig,h=l&&i||t;(this._targetLatencyUpdated||c.liveSyncDuration||c.liveSyncDurationCount||h===0)&&(h=n!==void 0?n:a*s);let f=s;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){let e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;let i=this.levelDetails;if(i===null)return null;let s=i.edge,n=e-t-this.edgeStalled,a=s-i.totalduration,l=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,n),l)}get drift(){let e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){let e=this.levelDetails;if(e===null)return 0;let t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){let{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;let i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){let{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,s;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){let e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){let e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}},wd=class extends na{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){let{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let i=this.hls.config.preferManagedMediaSource,s=[],n={},a={},l=!1,c=!1,h=!1;t.levels.forEach(f=>{let p=f.attrs,{audioCodec:m,videoCodec:_}=f;m&&(f.audioCodec=m=qo(m,i)||void 0),_&&(_=f.videoCodec=CS(_));let{width:E,height:S,unknownCodecs:C}=f,I=C?C.length:0;if(C)for(let P=I;P--;){let G=C[P];this.isAudioSupported(G)?(f.audioCodec=m=m?`${m},${G}`:G,I--,Jr.audio[m.substring(0,4)]=2):this.isVideoSupported(G)&&(f.videoCodec=_=_?`${_},${G}`:G,I--,Jr.video[_.substring(0,4)]=2)}if(l||(l=!!(E&&S)),c||(c=!!_),h||(h=!!m),I||m&&!this.isAudioSupported(m)||_&&!this.isVideoSupported(_)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}let{CODECS:R,"FRAME-RATE":k,"HDCP-LEVEL":D,"PATHWAY-ID":x,RESOLUTION:N,"VIDEO-RANGE":B}=p,O=`${`${x||"."}-`}${f.bitrate}-${N}-${k}-${R}-${B}-${D}`;if(n[O])if(n[O].uri!==f.url&&!f.attrs["PATHWAY-ID"]){let P=a[O]+=1;f.attrs["PATHWAY-ID"]=new Array(P+1).join(".");let G=this.createLevel(f);n[O]=G,s.push(G)}else n[O].addGroupId("audio",p.AUDIO),n[O].addGroupId("text",p.SUBTITLES);else{let P=this.createLevel(f);n[O]=P,a[O]=1,s.push(P)}}),this.filterAndSortMediaOptions(s,t,l,c,h)}createLevel(e){let t=new hr(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){let s=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(s.message),t.supportedResult=dy(s,[])}return t}isAudioSupported(e){return mc(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return mc(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,s,n){let a=[],l=[],c=e;if((i||s)&&n&&(c=c.filter(({videoCodec:C,videoRange:I,width:R,height:k})=>(!!C||!!(R&&k))&&DS(I))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let C="no level with compatible codecs found in manifest",I=C;t.levels.length&&(I=`one or more CODECS in variant not supported: ${ft(t.levels.map(k=>k.attrs.CODECS).filter((k,D,x)=>x.indexOf(k)===D))}`,this.warn(I),C+=` (${I})`);let R=new Error(C);this.hls.trigger(L.ERROR,{type:Le.MEDIA_ERROR,details:z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:R,reason:I})}});return}t.audioTracks&&(a=t.audioTracks.filter(C=>!C.audioCodec||this.isAudioSupported(C.audioCodec)),Om(a)),t.subtitles&&(l=t.subtitles,Om(l));let h=c.slice(0);c.sort((C,I)=>{if(C.attrs["HDCP-LEVEL"]!==I.attrs["HDCP-LEVEL"])return(C.attrs["HDCP-LEVEL"]||"")>(I.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&C.height!==I.height)return C.height-I.height;if(C.frameRate!==I.frameRate)return C.frameRate-I.frameRate;if(C.videoRange!==I.videoRange)return Wo.indexOf(C.videoRange)-Wo.indexOf(I.videoRange);if(C.videoCodec!==I.videoCodec){let R=xg(C.videoCodec),k=xg(I.videoCodec);if(R!==k)return k-R}if(C.uri===I.uri&&C.codecSet!==I.codecSet){let R=Ko(C.codecSet),k=Ko(I.codecSet);if(R!==k)return k-R}return C.averageBitrate!==I.averageBitrate?C.averageBitrate-I.averageBitrate:0});let f=h[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==h.length)){for(let C=0;C<h.length;C++)if(h[C].pathwayId===c[0].pathwayId){f=h[C];break}}this._levels=c;for(let C=0;C<c.length;C++)if(c[C]===f){var p;this._firstLevel=C;let I=f.bitrate,R=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${I}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){let k=Math.min(I,this.hls.config.abrEwmaDefaultEstimateMax);k>R&&R===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}let m=n&&!s,_=this.hls.config,E=!!(_.audioStreamController&&_.audioTrackController),S={levels:c,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:s,altAudio:E&&!m&&a.some(C=>!!C.url)};this.hls.trigger(L.MANIFEST_PARSED,S)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){let t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){let f=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(L.ERROR,{type:Le.OTHER_ERROR,details:z.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:f,reason:f.message}),p)return;e=Math.min(e,t.length-1)}let i=this.currentLevelIndex,s=this.currentLevel,n=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],l=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,i===e&&s&&n===l)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${l?" with Pathway "+l:""} from level ${i}${n?" with Pathway "+n:""}`);let c={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,c);let h=a.details;if(!h||h.live){let f=this.switchParams(a.uri,s?.details,h);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){let e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){let t=this.steering.pathways(),i=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===Ge.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Ae.MAIN){let i=t.elementaryStreams;if(!Object.keys(i).some(n=>!!i[n]))return;let s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var i;let{level:s,details:n}=t,a=t.levelInfo;if(!a){var l;this.warn(`Invalid level index ${s}`),(l=t.deliveryDirectives)!=null&&l.skip&&(n.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let c=a.details;c===t.details&&c.advanced&&(c=void 0),this.playlistLoaded(s,t,c)}else(i=t.deliveryDirectives)!=null&&i.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let i=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,n=e.attrs["PATHWAY-ID"],a=e.details,l=a?.age;this.log(`Loading level index ${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${n?" Pathway "+n:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(L.LEVEL_LOADING,{url:i,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;let i=this._levels.filter((n,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(n),n===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,n.details&&n.details.fragments.forEach(l=>l.level=-1)),!1));Iy(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);let s=i.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(L.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){let{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}};function Om(r){let e={};r.forEach(t=>{let i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function cT(){return self.SourceBuffer||self.WebKitSourceBuffer}function dT(){if(!Bs())return!1;let e=cT();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function Hw(){if(!dT())return!1;let r=Bs();return typeof r?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(Xn(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(Xn(e,"audio"))))}function jw(){var r;let e=cT();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}var Vw=100,Ad=class extends ea{constructor(e,t,i){super(e,t,i,"stream-controller",Ae.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{let s=this.media,n=s?s.currentTime:null;if(n===null||!Ce(n)||(this.log(`Media seeked to ${n.toFixed(3)}`),!this.getBufferedFrag(n)))return;let a=this.getFwdBufferInfoAtPos(s,n,Ae.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${n} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){let{lastCurrentTime:i,hls:s}=this;if(this.stopLoad(),this.setInterval(Vw),this.level=-1,!this.startFragRequested){let n=s.startLevel;n===-1&&(s.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=s.firstAutoLevel),s.nextLoadLevel=n,this.level=s.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=he.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=he.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case he.WAITING_LEVEL:{let{levels:t,level:i}=this,s=t?.[i],n=s?.details;if(n&&(!n.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(n))break;this.state=he.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=he.IDLE;break}break}case he.FRAG_LOADING_WAITING_RETRY:{var e;let t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){let{levels:s,level:n}=this,a=s?.[n];this.resetStartWhenNotLoaded(a||null),this.state=he.IDLE}}break}this.state===he.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:i,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;let n=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[n]))return;let a=i[n],l=this.getMainFwdBufferInfo();if(l===null)return;let c=this.getLevelDetails();if(c&&this._streamEnded(l,c)){let S={};this.altAudio===2&&(S.type="video"),this.hls.trigger(L.BUFFER_EOS,S),this.state=he.ENDED;return}if(!this.buffering)return;e.loadLevel!==n&&e.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;let h=a.details;if(!h||this.state===he.WAITING_LEVEL||this.waitForLive(a)){this.level=n,this.state=he.WAITING_LEVEL,this.startFragRequested=!1;return}let f=l.len,p=this.getMaxBufferLength(a.maxBitrate);if(f>=p)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);let m=this.backtrackFragment?this.backtrackFragment.start:l.end,_=this.getNextFragment(m,h);if(this.couldBacktrack&&!this.fragPrevious&&_&&Lt(_)&&this.fragmentTracker.getState(_)!==Rt.OK){var E;let C=((E=this.backtrackFragment)!=null?E:_).sn-h.startSN,I=h.fragments[C-1];I&&_.cc===I.cc&&(_=I,this.fragmentTracker.removeFragment(I))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(_&&this.isLoopLoading(_,m)){if(!_.gap){let C=this.audioOnly&&!this.altAudio?lt.AUDIO:lt.VIDEO,I=(C===lt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;I&&this.afterBufferFlushed(I,C,Ae.MAIN)}_=this.getNextFragmentLoopLoading(_,h,l,Ae.MAIN,p)}_&&(_.initSegment&&!_.initSegment.data&&!this.bitrateTest&&(_=_.initSegment),this.loadFragment(_,a,m))}loadFragment(e,t,i){let s=this.fragmentTracker.getState(e);s===Rt.NOT_LOADED||s===Rt.PARTIAL?Lt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ae.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){let{levels:e,media:t}=this;if(t!=null&&t.readyState){let i,s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);let n=this.getLevelDetails();if(n!=null&&n.live){let l=this.getMainFwdBufferInfo();if(!l||l.len<n.targetduration*2)return}if(!t.paused&&e){let l=this.hls.nextLoadLevel,c=e[l],h=this.fragLastKbps;h&&this.fragCurrent?i=this.fragCurrent.duration*c.maxBitrate/(1e3*h)+1:i=0}else i=0;let a=this.getBufferedFrag(t.currentTime+i);if(a){let l=this.followingBufferedFrag(a);if(l){this.abortCurrentFrag();let c=l.maxStartPTS?l.maxStartPTS:l.start,h=l.duration,f=Math.max(a.end,c+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){let e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case he.KEY_LOADING:case he.FRAG_LOADING:case he.FRAG_LOADING_WAITING_RETRY:case he.PARSING:case he.PARSED:this.state=he.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);let i=t.media;vi(i,"playing",this.onMediaPlaying),vi(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){let{media:i}=this;i&&(ki(i,"playing",this.onMediaPlaying),ki(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,s=!1;t.levels.forEach(n=>{let a=n.audioCodec;a&&(i=i||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&s&&!jw(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){let{levels:i}=this;if(!i||this.state!==he.IDLE)return;let s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=he.WAITING_LEVEL)}onLevelLoaded(e,t){var i;let{levels:s,startFragRequested:n}=this,a=t.level,l=t.details,c=l.totalduration;if(!s){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""}, cc [${l.startCC}, ${l.endCC}] duration:${c}`);let h=t.levelInfo,f=this.fragCurrent;f&&(this.state===he.FRAG_LOADING||this.state===he.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let p=0;if(l.live||(i=h.details)!=null&&i.live){var m;if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;p=this.alignPlaylists(l,h.details,(m=this.levelLastLoaded)==null?void 0:m.details)}if(h.details=l,this.levelLastLoaded=h,n||this.setStartPosition(l,p),this.hls.trigger(L.LEVEL_UPDATED,{details:l,level:a}),this.state===he.WAITING_LEVEL){if(this.waitForCdnTuneIn(l))return;this.state=he.IDLE}n&&l.live&&this.synchronizeToLiveEdge(l),this.tick()}synchronizeToLiveEdge(e){let{config:t,media:i}=this;if(!i)return;let s=this.hls.liveSyncPosition,n=this.getLoadPosition(),a=e.fragmentStart,l=e.edge,c=n>=a-t.maxFragLookUpTolerance&&n<=l;if(s!==null&&i.duration>s&&(n<s||!c)){let f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!c&&i.readyState<4||n<l-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),i.readyState))if(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${l}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var h;let p=He.bufferInfo(i,s,0);if(!(p!=null&&(h=p.buffered)!=null&&h.length)){i.currentTime=s;return}if(p.start<=n){i.currentTime=s;return}let{nextStart:_}=He.bufferedInfo(p.buffered,n,0);_&&(i.currentTime=_)}else i.currentTime=s}}_handleFragmentLoadProgress(e){var t;let i=e.frag,{part:s,payload:n}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}let l=a[i.level];if(!l){this.warn(`Level ${i.level} not found on progress`);return}let c=l.details;if(!c){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}let h=l.videoCodec,f=c.PTSKnown||!c.live,p=(t=i.initSegment)==null?void 0:t.data,m=this._getAudioCodec(l),_=this.transmuxer=this.transmuxer||new ul(this.hls,Ae.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=s?s.index:-1,S=E!==-1,C=new Zn(i.level,i.sn,i.stats.chunkCount,n.byteLength,E,S),I=this.initPTS[i.cc];_.push(n,p,m,h,i,s,c.totalduration,f,C,I)}onAudioTrackSwitching(e,t){let i=this.hls,s=this.altAudio===2;if(Yo(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.fragmentTracker.removeAllFragments(),i.once(L.BUFFER_FLUSHED,()=>{var a;(a=this.hls)==null||a.trigger(L.AUDIO_TRACK_SWITCHED,t)}),i.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){let i=Yo(t.url,this.hls);if(i){let s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){let i=t.tracks,s,n,a=!1;for(let l in i){let c=i[l];if(c.id==="main"){if(n=l,s=c,l==="video"){let h=i[l];h&&(this.videoBuffer=h.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){let{frag:i,part:s}=t,n=i.type===Ae.MAIN;if(n){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===he.PARSED&&(this.state=he.IDLE);return}let l=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*l.total/(l.buffering.end-l.loading.first)),Lt(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}let a=this.media;a&&(!this._hasEnoughToStart&&He.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),n&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=he.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ae.MAIN,t);break;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===he.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===Ge.LEVEL&&(this.state=he.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=he.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==lt.AUDIO||!this.altAudio){let i=(t===lt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,Ae.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){let{media:e}=this;if(!e)return;let t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}let s=this.timelineOffset;s&&i&&(i+=s);let n=this.getLevelDetails(),a=He.getBuffered(e),l=a.length?a.start(0):0,c=l-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||c>0&&(c<h||this.loadingParts&&c<2*(n?.partTarget||0)))&&(this.log(`adjusting start position by ${c} to match buffer start`),i+=c,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${l}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{let{hls:s}=this,n=i?.frag;if(!n||this.fragContextChanged(n))return;t.fragmentError=0,this.state=he.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;let a=n.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),s.trigger(L.FRAG_LOADED,i),n.bitrateTest=!1})}_handleTransmuxComplete(e){var t;let i=this.playlistType,{hls:s}=this,{remuxResult:n,chunkMeta:a}=e,l=this.getCurrentContext(a);if(!l){this.resetWhenMissingContext(a);return}let{frag:c,part:h,level:f}=l,{video:p,text:m,id3:_,initSegment:E}=n,{details:S}=f,C=this.altAudio?void 0:n.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=he.PARSING,E){if(E!=null&&E.tracks){let D=c.initSegment||c;this._bufferInitSegment(f,E.tracks,D,a),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:i,tracks:E.tracks})}let I=E.initPTS,R=E.timescale,k=this.initPTS[c.cc];Ce(I)&&(!k||k.baseTime!==I||k.timescale!==R)&&(this.initPTS[c.cc]={baseTime:I,timescale:R},s.trigger(L.INIT_PTS_FOUND,{frag:c,id:i,initPTS:I,timescale:R}))}if(p&&S){C&&p.type==="audiovideo"&&this.logMuxedErr(c);let I=S.fragments[c.sn-1-S.startSN],R=c.sn===S.startSN,k=!I||c.cc>I.cc;if(n.independent!==!1){let{startPTS:D,endPTS:x,startDTS:N,endDTS:B}=p;if(h)h.elementaryStreams[p.type]={startPTS:D,endPTS:x,startDTS:N,endDTS:B};else if(p.firstKeyFrame&&p.independent&&a.id===1&&!k&&(this.couldBacktrack=!0),p.dropped&&p.independent){let H=this.getMainFwdBufferInfo(),O=(H?H.end:this.getLoadPosition())+this.config.maxBufferHole,P=p.firstKeyFramePTS?p.firstKeyFramePTS:D;if(!R&&O<P-this.config.maxBufferHole&&!k){this.backtrack(c);return}else k&&(c.gap=!0);c.setElementaryStreamInfo(p.type,c.start,x,c.start,B,!0)}else R&&D-(S.appliedTimelineOffset||0)>Ro&&(c.gap=!0);c.setElementaryStreamInfo(p.type,D,x,N,B),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(p,c,h,a,R||k)}else if(R||k)c.gap=!0;else{this.backtrack(c);return}}if(C){let{startPTS:I,endPTS:R,startDTS:k,endDTS:D}=C;h&&(h.elementaryStreams[lt.AUDIO]={startPTS:I,endPTS:R,startDTS:k,endDTS:D}),c.setElementaryStreamInfo(lt.AUDIO,I,R,k,D),this.bufferFragmentData(C,c,h,a)}if(S&&_!=null&&(t=_.samples)!=null&&t.length){let I={id:i,frag:c,details:S,samples:_.samples};s.trigger(L.FRAG_PARSING_METADATA,I)}if(S&&m){let I={id:i,frag:c,details:S,samples:m.samples};s.trigger(L.FRAG_PARSING_USERDATA,I)}}logMuxedErr(e){this.warn(`${Lt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,s){if(this.state!==he.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));let{audio:n,video:a,audiovideo:l}=t;if(n){let h=e.audioCodec,f=Co(n.codec,h);f==="mp4a"&&(f="mp4a.40.5");let p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");let m=n.metadata;m&&"channelCount"in m&&(m.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&n.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),h&&h!==f&&this.log(`Swapping manifest audio codec "${h}" for "${f}"`),n.levelCodec=f,n.id=Ae.MAIN,this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${f||""}/${h||""}/${n.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Ae.MAIN;let h=a.codec;if(h?.length===4)switch(h){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${h}]${a.codec!==h?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}l&&(this.log(`Init audiovideo buffer, container:${l.container}, codecs[level/parsed]=[${e.codecs}/${l.codec}]`),delete t.video,delete t.audio);let c=Object.keys(t);if(c.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;c.forEach(h=>{let p=t[h].initSegment;p!=null&&p.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:h,data:p,frag:i,part:null,chunkMeta:s,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){let e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Ae.MAIN)}get maxBufferLength(){let{levels:e,level:t}=this,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=he.IDLE}checkFragmentChanged(){let e=this.media,t=null;if(e&&e.readyState>1&&e.seeking===!1){let i=e.currentTime;if(He.isBuffered(e,i)?t=this.getAppendedFrag(i):He.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;let s=this.fragPlaying,n=t.level;(!s||t.sn!==s.sn||s.level!==n)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!s||s.level!==n)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){let e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;let t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ce(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;let t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ce(t)){let i=this.getLevelDetails(),s=this.currentFrag||(i?cr(null,i.fragments,t):null);if(s){let n=s.programDateTime;if(n!==null){let a=n+(t-s.start)*1e3;return new Date(a)}}}return null}get currentLevel(){let e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){let e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}},Id=class{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(let i in this.keyUriToKeyInfo){let s=this.keyUriToKeyInfo[i].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=z.KEY_LOAD_ERROR,i,s,n){return new Ii({type:Le.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:i,networkDetails:s})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,n=t.length;s<n;s++){let a=t[s];if(e.cc<=a.cc&&(!Lt(e)||!Lt(a)||e.sn<a.sn)||!i&&s==n-1)return this.emeController.selectKeySystemFormat(a).then(l=>{if(!this.emeController)return;a.setKeyFormat(l);let c=kc(l);if(c)return this.emeController.getKeySystemAccess([c])})}if(this.config.requireKeySystemAccessOnStart){let s=Ao(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,s;t&&e.setKeyFormat(t);let n=e.decryptdata;if(!n){let h=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,h))}let a=n.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let l=this.keyUriToKeyInfo[a];if((i=l)!=null&&i.decryptdata.key)return n.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if((s=l)!=null&&s.keyLoadPromise){var c;switch((c=l.mediaKeySessionContext)==null?void 0:c.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise.then(h=>(n.key=h.keyInfo.decryptdata.key,{frag:e,keyInfo:l}))}}switch(l=this.keyUriToKeyInfo[a]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){let i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){let s=this.emeController.loadKey(i);if(s)return(e.keyLoadPromise=s.then(n=>(e.mediaKeySessionContext=n,i))).catch(n=>{throw e.keyLoadPromise=null,n})}return Promise.resolve(i)}loadKeyHTTP(e,t){let i=this.config,s=i.loader,n=new s(i);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((a,l)=>{let c={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h=i.keyLoadPolicy.default,f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(m,_,E,S)=>{let{frag:C,keyInfo:I,url:R}=E;if(!C.decryptdata||I!==this.keyUriToKeyInfo[R])return l(this.createKeyLoadError(C,z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));I.decryptdata.key=C.decryptdata.key=new Uint8Array(m.data),C.keyLoader=null,I.loader=null,a({frag:C,keyInfo:I})},onError:(m,_,E,S)=>{this.resetLoader(_),l(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,new Error(`HTTP Error ${m.code} loading key ${m.text}`),E,rt({url:c.url,data:void 0},m)))},onTimeout:(m,_,E)=>{this.resetLoader(_),l(this.createKeyLoadError(t,z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(m,_,E)=>{this.resetLoader(_),l(this.createKeyLoadError(t,z.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};n.load(c,f,p)})}resetLoader(e){let{frag:t,keyInfo:i,url:s}=e,n=i.loader;t.keyLoader===n&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],n&&n.destroy()}};function Mm(r){let{type:e}=r;switch(e){case Ge.AUDIO_TRACK:return Ae.AUDIO;case Ge.SUBTITLE_TRACK:return Ae.SUBTITLE;default:return Ae.MAIN}}function mh(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}var Ld=class{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){let{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){let{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){let t=this.hls.config,i=t.pLoader,s=t.loader,n=i||s,a=new n(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){let{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ge.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){let{id:i,level:s,pathwayId:n,url:a,deliveryDirectives:l,levelInfo:c}=t;this.load({id:i,level:s,pathwayId:n,responseType:"text",type:Ge.LEVEL,url:a,deliveryDirectives:l,levelOrTrack:c})}onAudioTrackLoading(e,t){let{id:i,groupId:s,url:n,deliveryDirectives:a,track:l}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:Ge.AUDIO_TRACK,url:n,deliveryDirectives:a,levelOrTrack:l})}onSubtitleTrackLoading(e,t){let{id:i,groupId:s,url:n,deliveryDirectives:a,track:l}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:Ge.SUBTITLE_TRACK,url:n,deliveryDirectives:a,levelOrTrack:l})}onLevelsUpdated(e,t){let i=this.loaders[Ge.LEVEL];if(i){let s=i.context;s&&!t.levels.some(n=>n===s.levelOrTrack)&&(i.abort(),delete this.loaders[Ge.LEVEL])}}load(e){var t;let i=this.hls.config,s=this.getInternalLoader(e);if(s){let h=this.hls.logger,f=s.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?h.log(`[playlist-loader]: ignore ${e.url} ongoing request`):h.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}h.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let n;if(e.type===Ge.MANIFEST?n=i.manifestLoadPolicy.default:n=it({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),Ce((t=e.deliveryDirectives)==null?void 0:t.part)){let h;if(e.type===Ge.LEVEL&&e.level!==null?h=this.hls.levels[e.level].details:e.type===Ge.AUDIO_TRACK&&e.id!==null?h=this.hls.audioTracks[e.id].details:e.type===Ge.SUBTITLE_TRACK&&e.id!==null&&(h=this.hls.subtitleTracks[e.id].details),h){let f=h.partTarget,p=h.targetduration;if(f&&p){let m=Math.max(f*3,p*.8)*1e3;n=it({},n,{maxTimeToFirstByteMs:Math.min(m,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(m,n.maxTimeToFirstByteMs)})}}}let a=n.errorRetry||n.timeoutRetry||{},l={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(h,f,p,m)=>{let _=this.getInternalLoader(p);this.resetInternalLoader(p.type);let E=h.data;if(E.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(h,p,new Error("no EXTM3U delimiter"),m||null,f);return}f.parsing.start=performance.now(),ar.isMediaPlaylist(E)||p.type!==Ge.MANIFEST?this.handleTrackOrLevelPlaylist(h,f,p,m||null,_):this.handleMasterPlaylist(h,f,p,m)},onError:(h,f,p,m)=>{this.handleNetworkError(f,p,!1,h,m)},onTimeout:(h,f,p)=>{this.handleNetworkError(f,p,!0,void 0,h)}};s.load(e,l,c)}checkAutostartLoad(){if(!this.hls)return;let{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,s){let n=this.hls,a=e.data,l=mh(e,i),c=ar.parseMasterPlaylist(a,l);if(c.playlistParsingError){this.handleManifestParsingError(e,i,c.playlistParsingError,s,t);return}let{contentSteering:h,levels:f,sessionData:p,sessionKeys:m,startTimeOffset:_,variableList:E}=c;this.variableList=E;let{AUDIO:S=[],SUBTITLES:C,"CLOSED-CAPTIONS":I}=ar.parseMasterPlaylistMedia(a,l,c);S.length&&!S.some(k=>!k.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new gt({}),bitrate:0,url:""})),n.trigger(L.MANIFEST_LOADED,{levels:f,audioTracks:S,subtitles:C,captions:I,contentSteering:h,url:l,stats:t,networkDetails:s,sessionData:p,sessionKeys:m,startTimeOffset:_,variableList:E})}handleTrackOrLevelPlaylist(e,t,i,s,n){let a=this.hls,{id:l,level:c,type:h}=i,f=mh(e,i),p=Ce(c)?c:Ce(l)?l:0,m=Mm(i),_=ar.parseLevelPlaylist(e.data,f,p,m,0,this.variableList);if(h===Ge.MANIFEST){let E={attrs:new gt({}),bitrate:0,details:_,name:"",url:f};_.requestScheduled=t.loading.start+Cy(_,0),a.trigger(L.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:f,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=_,this.handlePlaylistLoaded(_,e,t,i,s,n)}handleManifestParsingError(e,t,i,s,n){this.hls.trigger(L.ERROR,{type:Le.NETWORK_ERROR,details:z.MANIFEST_PARSING_ERROR,fatal:t.type===Ge.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:s,stats:n})}handleNetworkError(e,t,i=!1,s,n){let a=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Ge.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Ge.AUDIO_TRACK||e.type===Ge.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);let l=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let c=z.UNKNOWN,h=!1,f=this.getInternalLoader(e);switch(e.type){case Ge.MANIFEST:c=i?z.MANIFEST_LOAD_TIMEOUT:z.MANIFEST_LOAD_ERROR,h=!0;break;case Ge.LEVEL:c=i?z.LEVEL_LOAD_TIMEOUT:z.LEVEL_LOAD_ERROR,h=!1;break;case Ge.AUDIO_TRACK:c=i?z.AUDIO_TRACK_LOAD_TIMEOUT:z.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case Ge.SUBTITLE_TRACK:c=i?z.SUBTITLE_TRACK_LOAD_TIMEOUT:z.SUBTITLE_LOAD_ERROR,h=!1;break}f&&this.resetInternalLoader(e.type);let p={type:Le.NETWORK_ERROR,details:c,fatal:h,url:e.url,loader:f,context:e,error:l,networkDetails:t,stats:n};if(s){let m=t?.url||e.url;p.response=rt({url:m,data:void 0},s)}this.hls.trigger(L.ERROR,p)}handlePlaylistLoaded(e,t,i,s,n,a){let l=this.hls,{type:c,level:h,id:f,groupId:p,deliveryDirectives:m}=s,_=mh(t,s),E=Mm(s),S=typeof s.level=="number"&&E===Ae.MAIN?h:void 0;if(!e.fragments.length){let I=e.playlistParsingError=new Error("No Segments found in Playlist");l.trigger(L.ERROR,{type:Le.NETWORK_ERROR,details:z.LEVEL_EMPTY_ERROR,fatal:!1,url:_,error:I,reason:I.message,response:t,context:s,level:S,parent:E,networkDetails:n,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));let C=e.playlistParsingError;if(C){if(this.hls.logger.warn(C),!l.config.ignorePlaylistParsingErrors){l.trigger(L.ERROR,{type:Le.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:_,error:C,reason:C.message,response:t,context:s,level:S,parent:E,networkDetails:n,stats:i});return}e.playlistParsingError=null}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),c){case Ge.MANIFEST:case Ge.LEVEL:l.trigger(L.LEVEL_LOADED,{details:e,levelInfo:s.levelOrTrack||l.levels[0],level:S||0,id:f||0,stats:i,networkDetails:n,deliveryDirectives:m,withoutMultiVariant:c===Ge.MANIFEST});break;case Ge.AUDIO_TRACK:l.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:f||0,groupId:p||"",stats:i,networkDetails:n,deliveryDirectives:m});break;case Ge.SUBTITLE_TRACK:l.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:f||0,groupId:p||"",stats:i,networkDetails:n,deliveryDirectives:m});break}}},pt=(()=>{class r{static get version(){return ta}static isMSESupported(){return dT()}static isSupported(){return Hw()}static getMediaSource(){return Bs()}static get Events(){return L}static get MetadataSchema(){return ai}static get ErrorTypes(){return Le}static get ErrorDetails(){return z}static get DefaultConfig(){return r.defaultConfig?r.defaultConfig:xw}static set DefaultConfig(t){r.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new xf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;let i=this.logger=sS(t.debug||!1,"Hls instance",t.assetPlayerId),s=this.config=Mw(r.DefaultConfig,t,i);this.userConfig=t,s.progressive&&Fw(s,i);let{abrController:n,bufferController:a,capLevelController:l,errorController:c,fpsController:h}=s,f=new c(this),p=this.abrController=new n(this),m=new Ec(this),_=s.interstitialsController,E=_?this.interstitialsController=new _(this,r):null,S=this.bufferController=new a(this,m),C=this.capLevelController=new l(this),I=new h(this),R=new Ld(this),k=s.contentSteeringController,D=k?new k(this):null,x=this.levelController=new wd(this,D),N=new Sd(this),B=new Id(this.config),H=this.streamController=new Ad(this,m,B),O=this.gapController=new Ed(this,m);C.setStreamController(H),I.setStreamController(H);let P=[R,x,H];E&&P.splice(1,0,E),D&&P.splice(1,0,D),this.networkControllers=P;let G=[p,S,O,C,I,N,m];this.audioTrackController=this.createController(s.audioTrackController,P);let Q=s.audioStreamController;Q&&P.push(this.audioStreamController=new Q(this,m,B)),this.subtitleTrackController=this.createController(s.subtitleTrackController,P);let ie=s.subtitleStreamController;ie&&P.push(this.subtititleStreamController=new ie(this,m,B)),this.createController(s.timelineController,G),B.emeController=this.emeController=this.createController(s.emeController,G),this.cmcdController=this.createController(s.cmcdController,G),this.latencyController=this.createController(Cd,G),this.coreComponents=G,P.push(f);let te=f.onErrorOut;typeof te=="function"&&this.on(L.ERROR,te,f),this.on(L.MANIFEST_LOADED,R.onManifestLoaded,R)}createController(t,i){if(t){let s=new t(this);return i&&i.push(s),s}return null}on(t,i,s=this){this._emitter.on(t,i,s)}once(t,i,s=this){this._emitter.once(t,i,s)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,i,s=this,n){this._emitter.off(t,i,s,n)}listeners(t){return this._emitter.listeners(t)}emit(t,i,s){return this._emitter.emit(t,i,s)}trigger(t,i){if(this.config.debug)return this.emit(t,t,i);try{return this.emit(t,t,i)}catch(s){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;let n=t===L.ERROR;this.trigger(L.ERROR,{type:Le.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:n,event:t,error:s}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(i=>i.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(i=>i.destroy()),this.coreComponents.length=0;let t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){if(!t||"media"in t&&!t.media){let a=new Error(`attachMedia failed: invalid argument (${t})`);this.trigger(L.ERROR,{type:Le.OTHER_ERROR,details:z.ATTACH_MEDIA_ERROR,fatal:!0,error:a});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());let i="media"in t,s=i?t.media:t,n=i?t:{media:s};this._media=s,this.trigger(L.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;let t=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:t}),t}loadSource(t){this.stopLoad();let i=this.media,s=this._url,n=this._url=If.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),i&&s&&(s!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(i)),this.trigger(L.MANIFEST_LOADING,{url:t})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(t=-1,i){this.logger.log(`startLoad(${t+(i?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(t,i),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!(this.started||!this.networkControllers));t++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(t=>{t.resumeBuffering&&t.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(t=>{t.pauseBuffering&&t.pauseBuffering()}))}get inFlightFragments(){let t={[Ae.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(t[Ae.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[Ae.SUBTITLE]=this.subtititleStreamController.inFlightFrag),t}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");let t=this._media,i=t?.currentTime;this.detachMedia(),t&&(this.attachMedia(t),i&&this.startLoad(i))}removeLevel(t){this.levelController.removeLevel(t)}get sessionId(){let t=this._sessionId;return t||(t=this._sessionId=tw()),t}get levels(){let t=this.levelController.levels;return t||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){this.logger.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){this.logger.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){this.logger.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){this.logger.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){let t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){this.logger.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){let i=!!t;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){let{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get abrEwmaDefaultEstimate(){let{bwEstimator:t}=this.abrController;return t?t.defaultEstimate:NaN}get ttfbEstimate(){let{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(this.logger.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){PS(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){let{levels:t,config:{minAutoBitrate:i}}=this;if(!t)return 0;let s=t.length;for(let n=0;n<s;n++)if(t[n].maxBitrate>=i)return n;return 0}get maxAutoLevel(){let{levels:t,autoLevelCapping:i,maxHdcpLevel:s}=this,n;if(i===-1&&t!=null&&t.length?n=t.length-1:n=i,s)for(let a=n;a--;){let l=t[a].attrs["HDCP-LEVEL"];if(l&&l<=s)return a}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(t){var i;return((i=this.audioTrackController)==null?void 0:i.setAudioOption(t))||null}setSubtitleOption(t){var i;return((i=this.subtitleTrackController)==null?void 0:i.setSubtitleOption(t))||null}get allAudioTracks(){let t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){let t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){let t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){let i=this.audioTrackController;i&&(i.audioTrack=t)}get allSubtitleTracks(){let t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){let t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){let t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){let i=this.subtitleTrackController;i&&(i.subtitleTrack=t)}get subtitleDisplay(){let t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){let i=this.subtitleTrackController;i&&(i.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(t){this.latencyController.targetLatency=t}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(t){this.levelController.pathwayPriority=t}get bufferedToEnd(){var t;return!!((t=this.bufferController)!=null&&t.bufferedToEnd)}get interstitialsManager(){var t;return((t=this.interstitialsController)==null?void 0:t.interstitialsManager)||null}getMediaDecodingInfo(t,i=this.allAudioTracks){let s=gy(i);return fy(t,s,navigator.mediaCapabilities)}}return r.defaultConfig=void 0,r})();function fT(r,e){return e?`${r}|${e.start}-${e.end}`:r}function pT(r,e){if(r!==void 0&&e!==void 0&&r<=e)return{start:r,end:e}}var Fm=globalThis||void 0||self,Gw=Object.defineProperty,Kw=(r,e,t)=>e in r?Gw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ue=(r,e,t)=>Kw(r,typeof e!="symbol"?e+"":e,t),Zt=class extends Error{constructor(e,t){super(t),ue(this,"timestamp"),this.type=e,this.timestamp=performance.now()}},en=class extends Error{constructor(e){super(),this.type=e}},kd=class{constructor(e,t,i){ue(this,"requestControls"),ue(this,"abortController",new AbortController),ue(this,"expectedBytesLength"),ue(this,"requestByteRange"),ue(this,"onChunkDownloaded"),this.request=e,this.httpConfig=t,this.onChunkDownloaded=i.getEventDispatcher("onChunkDownloaded");let{byteRange:s}=this.request.segment;s&&(this.requestByteRange=Ue({},s)),e.loadedBytes!==0&&(this.requestByteRange=this.requestByteRange??{start:0},this.requestByteRange.start=this.requestByteRange.start+e.loadedBytes),this.request.totalBytes&&(this.expectedBytesLength=this.request.totalBytes-this.request.loadedBytes),this.requestControls=this.request.start({downloadSource:"http"},{abort:()=>this.abortController.abort("abort"),notReceivingBytesTimeoutMs:this.httpConfig.httpNotReceivingBytesTimeoutMs}),this.fetch()}fetch(){return mt(this,null,function*(){var e,t,i,s;let{segment:n}=this.request;try{let f=yield(t=(e=this.httpConfig).httpRequestSetup)==null?void 0:t.call(e,n.url,n.byteRange,this.abortController.signal,this.requestByteRange);if(!f){let S=new Headers(this.requestByteRange?{Range:`bytes=${this.requestByteRange.start}-${this.requestByteRange.end??""}`}:void 0);f=new Request(n.url,{headers:S,signal:this.abortController.signal})}if(this.abortController.signal.aborted)throw new DOMException("Request aborted before request fetch","AbortError");let p=yield window.fetch(f);if(this.handleResponseHeaders(p),!p.body)return;let{requestControls:m}=this;m.firstBytesReceived();let _=p.body.getReader();try{for(var a=eg(qw(_)),l,c,h;l=!(c=yield a.next()).done;l=!1){let S=c.value;this.requestControls.addLoadedChunk(S),this.onChunkDownloaded(S.byteLength,"http")}}catch{h=[c]}finally{try{l&&(c=a.return)&&(yield c.call(a))}finally{if(h)throw h[0]}}if(!((yield(s=(i=this.httpConfig).validateHTTPSegment)==null?void 0:s.call(i,n.url,n.byteRange,this.request.data))??!0))throw this.request.clearLoadedBytes(),new Zt("http-segment-validation-failed");m.completeOnSuccess()}catch(f){this.handleError(f)}})}handleResponseHeaders(e){if(!e.ok)throw e.status===406?(this.request.clearLoadedBytes(),new Zt("http-bytes-mismatch",e.statusText)):new Zt("http-error",e.statusText);let{requestByteRange:t}=this;if(t)if(e.status===200){if(this.request.segment.byteRange)throw new Zt("http-unexpected-status-code");this.request.clearLoadedBytes()}else{if(e.status!==206)throw new Zt("http-unexpected-status-code",e.statusText);let i=e.headers.get("Content-Length");if(i&&this.expectedBytesLength!==void 0&&this.expectedBytesLength!==+i)throw this.request.clearLoadedBytes(),new Zt("http-bytes-mismatch",e.statusText);let s=e.headers.get("Content-Range"),n=s?zw(s):void 0;if(n){let{from:a,to:l}=n,c=l!==void 0&&a!==void 0?l-a+1:void 0;if(c!==void 0&&this.expectedBytesLength!==c||a!==void 0&&t.start!==a||l!==void 0&&t.end!==void 0&&t.end!==l)throw this.request.clearLoadedBytes(),new Zt("http-bytes-mismatch",e.statusText)}}if(e.status===200&&this.request.totalBytes===void 0){let i=e.headers.get("Content-Length");i&&this.request.setTotalBytes(+i)}}handleError(e){if(e instanceof Error){if(e.name!=="abort")return;let t=e instanceof Zt?e:new Zt("http-error",e.message);this.requestControls.abortOnError(t)}}};function qw(r){return Zp(this,null,function*(){for(;;){let{done:e,value:t}=yield new Jp(r.read());if(e)break;yield t}})}var Ww=/^bytes (?:(?:(\d+)|)-(?:(\d+)|)|\*)\/(?:(\d+)|\*)$/;function zw(r){let e=Ww.exec(r.trim());if(!e)return;let[,t,i,s]=e;return{from:t?parseInt(t):void 0,to:i?parseInt(i):void 0,total:s?parseInt(s):void 0}}function Yw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var gT={exports:{}},bt=gT.exports={},Hi,ji;function Rd(){throw new Error("setTimeout has not been defined")}function Pd(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Hi=setTimeout:Hi=Rd}catch{Hi=Rd}try{typeof clearTimeout=="function"?ji=clearTimeout:ji=Pd}catch{ji=Pd}})();function mT(r){if(Hi===setTimeout)return setTimeout(r,0);if((Hi===Rd||!Hi)&&setTimeout)return Hi=setTimeout,setTimeout(r,0);try{return Hi(r,0)}catch{try{return Hi.call(null,r,0)}catch{return Hi.call(this,r,0)}}}function Xw(r){if(ji===clearTimeout)return clearTimeout(r);if((ji===Pd||!ji)&&clearTimeout)return ji=clearTimeout,clearTimeout(r);try{return ji(r)}catch{try{return ji.call(null,r)}catch{return ji.call(this,r)}}}var as=[],zr=!1,or,Po=-1;function Qw(){!zr||!or||(zr=!1,or.length?as=or.concat(as):Po=-1,as.length&&vT())}function vT(){if(!zr){var r=mT(Qw);zr=!0;for(var e=as.length;e;){for(or=as,as=[];++Po<e;)or&&or[Po].run();Po=-1,e=as.length}or=null,zr=!1,Xw(r)}}bt.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];as.push(new yT(r,e)),as.length===1&&!zr&&mT(vT)};function yT(r,e){this.fun=r,this.array=e}yT.prototype.run=function(){this.fun.apply(null,this.array)};bt.title="browser";bt.browser=!0;bt.env={};bt.argv=[];bt.version="";bt.versions={};function ps(){}bt.on=ps;bt.addListener=ps;bt.once=ps;bt.off=ps;bt.removeListener=ps;bt.removeAllListeners=ps;bt.emit=ps;bt.prependListener=ps;bt.prependOnceListener=ps;bt.listeners=function(r){return[]};bt.binding=function(r){throw new Error("process.binding is not supported")};bt.cwd=function(){return"/"};bt.chdir=function(r){throw new Error("process.chdir is not supported")};bt.umask=function(){return 0};var Jw=gT.exports,Do=Yw(Jw),Zw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Fm<"u"?Fm:typeof self<"u"?self:{};function gr(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var uo={exports:{}},vh,Nm;function eA(){if(Nm)return vh;Nm=1;var r=1e3,e=r*60,t=e*60,i=t*24,s=i*7,n=i*365.25;vh=function(f,p){p=p||{};var m=typeof f;if(m==="string"&&f.length>0)return a(f);if(m==="number"&&isFinite(f))return p.long?c(f):l(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function a(f){if(f=String(f),!(f.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(p){var m=parseFloat(p[1]),_=(p[2]||"ms").toLowerCase();switch(_){case"years":case"year":case"yrs":case"yr":case"y":return m*n;case"weeks":case"week":case"w":return m*s;case"days":case"day":case"d":return m*i;case"hours":case"hour":case"hrs":case"hr":case"h":return m*t;case"minutes":case"minute":case"mins":case"min":case"m":return m*e;case"seconds":case"second":case"secs":case"sec":case"s":return m*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return m;default:return}}}}function l(f){var p=Math.abs(f);return p>=i?Math.round(f/i)+"d":p>=t?Math.round(f/t)+"h":p>=e?Math.round(f/e)+"m":p>=r?Math.round(f/r)+"s":f+"ms"}function c(f){var p=Math.abs(f);return p>=i?h(f,p,i,"day"):p>=t?h(f,p,t,"hour"):p>=e?h(f,p,e,"minute"):p>=r?h(f,p,r,"second"):f+" ms"}function h(f,p,m,_){var E=p>=m*1.5;return Math.round(f/m)+" "+_+(E?"s":"")}return vh}var yh,Bm;function tA(){if(Bm)return yh;Bm=1;function r(e){i.debug=i,i.default=i,i.coerce=h,i.disable=l,i.enable=n,i.enabled=c,i.humanize=eA(),i.destroy=f,Object.keys(e).forEach(p=>{i[p]=e[p]}),i.names=[],i.skips=[],i.formatters={};function t(p){let m=0;for(let _=0;_<p.length;_++)m=(m<<5)-m+p.charCodeAt(_),m|=0;return i.colors[Math.abs(m)%i.colors.length]}i.selectColor=t;function i(p){let m,_=null,E,S;function C(...I){if(!C.enabled)return;let R=C,k=Number(new Date),D=k-(m||k);R.diff=D,R.prev=m,R.curr=k,m=k,I[0]=i.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let x=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(B,H)=>{if(B==="%%")return"%";x++;let O=i.formatters[H];if(typeof O=="function"){let P=I[x];B=O.call(R,P),I.splice(x,1),x--}return B}),i.formatArgs.call(R,I),(R.log||i.log).apply(R,I)}return C.namespace=p,C.useColors=i.useColors(),C.color=i.selectColor(p),C.extend=s,C.destroy=i.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(E!==i.namespaces&&(E=i.namespaces,S=i.enabled(p)),S),set:I=>{_=I}}),typeof i.init=="function"&&i.init(C),C}function s(p,m){let _=i(this.namespace+(typeof m>"u"?":":m)+p);return _.log=this.log,_}function n(p){i.save(p),i.namespaces=p,i.names=[],i.skips=[];let m=(typeof p=="string"?p:"").trim().replace(" ",",").split(",").filter(Boolean);for(let _ of m)_[0]==="-"?i.skips.push(_.slice(1)):i.names.push(_)}function a(p,m){let _=0,E=0,S=-1,C=0;for(;_<p.length;)if(E<m.length&&(m[E]===p[_]||m[E]==="*"))m[E]==="*"?(S=E,C=_,E++):(_++,E++);else if(S!==-1)E=S+1,C++,_=C;else return!1;for(;E<m.length&&m[E]==="*";)E++;return E===m.length}function l(){let p=[...i.names,...i.skips.map(m=>"-"+m)].join(",");return i.enable(""),p}function c(p){for(let m of i.skips)if(a(p,m))return!1;for(let m of i.names)if(a(p,m))return!0;return!1}function h(p){return p instanceof Error?p.stack||p.message:p}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return i.enable(i.load()),i}return yh=r,yh}var Um;function iA(){return Um||(Um=1,function(r,e){e.formatArgs=i,e.save=s,e.load=n,e.useColors=t,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;let h="color: "+this.color;c.splice(1,0,h,"color: inherit");let f=0,p=0;c[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(f++,m==="%c"&&(p=f))}),c.splice(p,0,h)}e.log=console.debug||console.log||(()=>{});function s(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function n(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof Do<"u"&&"env"in Do&&(c=Do.env.DEBUG),c}function a(){try{return localStorage}catch{}}r.exports=tA()(e);let{formatters:l}=r.exports;l.j=function(c){try{return JSON.stringify(c)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}(uo,uo.exports)),uo.exports}var TT=iA(),Xi=gr(TT),ho={exports:{}},$m;function _T(){if($m)return ho.exports;$m=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function(x,N,B){return Function.prototype.apply.call(x,N,B)},t;r&&typeof r.ownKeys=="function"?t=r.ownKeys:Object.getOwnPropertySymbols?t=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:t=function(x){return Object.getOwnPropertyNames(x)};function i(D){console&&console.warn&&console.warn(D)}var s=Number.isNaN||function(x){return x!==x};function n(){n.init.call(this)}ho.exports=n,ho.exports.once=I,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var a=10;function l(D){if(typeof D!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(D){if(typeof D!="number"||D<0||s(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");a=D}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||s(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this};function c(D){return D._maxListeners===void 0?n.defaultMaxListeners:D._maxListeners}n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(x){for(var N=[],B=1;B<arguments.length;B++)N.push(arguments[B]);var H=x==="error",O=this._events;if(O!==void 0)H=H&&O.error===void 0;else if(!H)return!1;if(H){var P;if(N.length>0&&(P=N[0]),P instanceof Error)throw P;var G=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw G.context=P,G}var Q=O[x];if(Q===void 0)return!1;if(typeof Q=="function")e(Q,this,N);else for(var ie=Q.length,te=E(Q,ie),B=0;B<ie;++B)e(te[B],this,N);return!0};function h(D,x,N,B){var H,O,P;if(l(N),O=D._events,O===void 0?(O=D._events=Object.create(null),D._eventsCount=0):(O.newListener!==void 0&&(D.emit("newListener",x,N.listener?N.listener:N),O=D._events),P=O[x]),P===void 0)P=O[x]=N,++D._eventsCount;else if(typeof P=="function"?P=O[x]=B?[N,P]:[P,N]:B?P.unshift(N):P.push(N),H=c(D),H>0&&P.length>H&&!P.warned){P.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.emitter=D,G.type=x,G.count=P.length,i(G)}return D}n.prototype.addListener=function(x,N){return h(this,x,N,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(x,N){return h(this,x,N,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(D,x,N){var B={fired:!1,wrapFn:void 0,target:D,type:x,listener:N},H=f.bind(B);return H.listener=N,B.wrapFn=H,H}n.prototype.once=function(x,N){return l(N),this.on(x,p(this,x,N)),this},n.prototype.prependOnceListener=function(x,N){return l(N),this.prependListener(x,p(this,x,N)),this},n.prototype.removeListener=function(x,N){var B,H,O,P,G;if(l(N),H=this._events,H===void 0)return this;if(B=H[x],B===void 0)return this;if(B===N||B.listener===N)--this._eventsCount===0?this._events=Object.create(null):(delete H[x],H.removeListener&&this.emit("removeListener",x,B.listener||N));else if(typeof B!="function"){for(O=-1,P=B.length-1;P>=0;P--)if(B[P]===N||B[P].listener===N){G=B[P].listener,O=P;break}if(O<0)return this;O===0?B.shift():S(B,O),B.length===1&&(H[x]=B[0]),H.removeListener!==void 0&&this.emit("removeListener",x,G||N)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(x){var N,B,H;if(B=this._events,B===void 0)return this;if(B.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):B[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete B[x]),this;if(arguments.length===0){var O=Object.keys(B),P;for(H=0;H<O.length;++H)P=O[H],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(N=B[x],typeof N=="function")this.removeListener(x,N);else if(N!==void 0)for(H=N.length-1;H>=0;H--)this.removeListener(x,N[H]);return this};function m(D,x,N){var B=D._events;if(B===void 0)return[];var H=B[x];return H===void 0?[]:typeof H=="function"?N?[H.listener||H]:[H]:N?C(H):E(H,H.length)}n.prototype.listeners=function(x){return m(this,x,!0)},n.prototype.rawListeners=function(x){return m(this,x,!1)},n.listenerCount=function(D,x){return typeof D.listenerCount=="function"?D.listenerCount(x):_.call(D,x)},n.prototype.listenerCount=_;function _(D){var x=this._events;if(x!==void 0){var N=x[D];if(typeof N=="function")return 1;if(N!==void 0)return N.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function E(D,x){for(var N=new Array(x),B=0;B<x;++B)N[B]=D[B];return N}function S(D,x){for(;x+1<D.length;x++)D[x]=D[x+1];D.pop()}function C(D){for(var x=new Array(D.length),N=0;N<x.length;++N)x[N]=D[N].listener||D[N];return x}function I(D,x){return new Promise(function(N,B){function H(P){D.removeListener(x,O),B(P)}function O(){typeof D.removeListener=="function"&&D.removeListener("error",H),N([].slice.call(arguments))}k(D,x,O,{once:!0}),x!=="error"&&R(D,H,{once:!0})})}function R(D,x,N){typeof D.on=="function"&&k(D,"error",x,N)}function k(D,x,N,B){if(typeof D.on=="function")B.once?D.once(x,N):D.on(x,N);else if(typeof D.addEventListener=="function")D.addEventListener(x,function H(O){B.once&&D.removeEventListener(x,H),N(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof D)}return ho.exports}var sA=_T(),ET=gr(sA),co={exports:{}},Th,Hm;function rA(){if(Hm)return Th;Hm=1,Th=r;function r(e,t){if(e&&t)return r(e)(t);if(typeof e!="function")throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(s){i[s]=e[s]}),i;function i(){for(var s=new Array(arguments.length),n=0;n<s.length;n++)s[n]=arguments[n];var a=e.apply(this,s),l=s[s.length-1];return typeof a=="function"&&a!==l&&Object.keys(l).forEach(function(c){a[c]=l[c]}),a}}return Th}var jm;function nA(){if(jm)return co.exports;jm=1;var r=rA();co.exports=r(e),co.exports.strict=r(t),e.proto=e(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return e(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return t(this)},configurable:!0})});function e(i){var s=function(){return s.called?s.value:(s.called=!0,s.value=i.apply(this,arguments))};return s.called=!1,s}function t(i){var s=function(){if(s.called)throw new Error(s.onceError);return s.called=!0,s.value=i.apply(this,arguments)},n=i.name||"Function wrapped with `once`";return s.onceError=n+" shouldn't be called more than once",s.called=!1,s}return co.exports}var aA=nA(),oA=gr(aA);var _h,Vm;function bT(){if(Vm)return _h;Vm=1;let r;return _h=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:Zw):e=>(r||(r=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0)),_h}var Eh,Gm;function lA(){if(Gm)return Eh;Gm=1,Eh=e;let r=bT();function e(t,i){let s,n,a,l=!0;Array.isArray(t)?(s=[],n=t.length):(a=Object.keys(t),s={},n=a.length);function c(f){function p(){i&&i(f,s),i=null}l?r(p):p()}function h(f,p,m){s[f]=m,(--n===0||p)&&c(p)}n?a?a.forEach(function(f){t[f](function(p,m){h(f,p,m)})}):t.forEach(function(f,p){f(function(m,_){h(p,m,_)})}):c(null),l=!1}return Eh}var uA=lA(),hA=gr(uA),hs=typeof window<"u"?window:self,bh=hs.RTCPeerConnection||hs.mozRTCPeerConnection||hs.webkitRTCPeerConnection,cA=hs.RTCSessionDescription||hs.mozRTCSessionDescription||hs.webkitRTCSessionDescription,dA=hs.RTCIceCandidate||hs.mozRTCIceCandidate||hs.webkitRTCIceCandidate,Sh,Km;function fA(){return Km||(Km=1,Sh=class{constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}),Sh}var Ch,qm;function pA(){if(qm)return Ch;qm=1;let r=fA();return Ch=class{constructor(t){this.hwm=t||16,this.head=new r(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){let i=this.head;this.head=i.next=new r(2*this.head.buffer.length),this.head.push(t)}}shift(){this.length!==0&&this.length--;let t=this.tail.shift();if(t===void 0&&this.tail.next){let i=this.tail.next;return this.tail.next=null,this.tail=i,this.tail.shift()}return t}peek(){let t=this.tail.peek();return t===void 0&&this.tail.next?this.tail.next.peek():t}isEmpty(){return this.length===0}},Ch}var wh,Wm;function zm(){return Wm||(Wm=1,wh=class{constructor(e){this.decoder=new TextDecoder(e==="utf16le"?"utf16-le":e)}get remaining(){return-1}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}}),wh}var Ah,Ym;function gA(){if(Ym)return Ah;Ym=1;let r=zm(),e=zm();Ah=class{constructor(s="utf8"){switch(this.encoding=t(s),this.encoding){case"utf8":this.decoder=new e;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new r(this.encoding)}}get remaining(){return this.decoder.remaining}push(s){return typeof s=="string"?s:this.decoder.decode(s)}write(s){return this.push(s)}end(s){let n="";return s&&(n=this.push(s)),n+=this.decoder.flush(),n}};function t(i){switch(i=i.toLowerCase(),i){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return i;default:throw new Error("Unknown encoding: "+i)}}return Ah}var Ih,Xm;function mA(){if(Xm)return Ih;Xm=1;let{EventEmitter:r}=_T(),e=new Error("Stream was destroyed"),t=new Error("Premature close"),i=pA(),s=gA(),n=(1<<29)-1,a=1,l=2,c=4,h=8,f=n^a,p=n^l,m=16,_=32,E=64,S=128,C=256,I=512,R=1024,k=2048,D=4096,x=8192,N=16384,B=32768,H=65536,O=131072,P=C|I,G=m|H,Q=E|m,ie=D|S,te=C|O,re=n^m,ne=n^E,de=n^(E|H),Z=n^H,ae=n^C,se=n^(S|x),oe=n^R,Y=n^P,ee=n^B,be=n^_,Ee=n^O,Re=n^te,Oe=1<<18,Pe=2<<18,Be=4<<18,Ve=8<<18,Je=16<<18,Ye=32<<18,ni=64<<18,Wt=128<<18,Ri=256<<18,xe=512<<18,Ke=1024<<18,St=n^(Oe|Ri),Vt=n^Be,Ct=n^(Oe|xe),Ut=n^Je,yt=n^Ve,Ti=n^Wt,Ft=n^Pe,wt=n^Ke,Pt=m|Oe,zt=n^Pt,Dt=N|Ye,kt=c|h|l,M=kt|a,b=kt|Dt,A=Vt&ne,j=Wt|B,q=j&zt,J=M|q,le=M|R|N,Me=M|N|S,nt=M|R|S,et=M|D|S|x,ke=M|m|R|N|H|O,qe=kt|R|N,hn=_|M|B|E,Qi=B|a,_i=M|xe|Ye,js=Ve|Je,cn=Ve|Oe,pa=Ve|Je|M|Oe,ui=M|Oe|Ve|Ke,ga=Be|Oe,gs=Oe|Ri,mr=M|xe|cn|Ye,ma=Je|kt|xe|Ye,va=Pe|M|Wt|Be,ms=xe|Ye|kt,Pi=Symbol.asyncIterator||Symbol("asyncIterator");class Vs{constructor(U,{highWaterMark:ve=16384,map:De=null,mapWritable:Ne,byteLength:ut,byteLengthWritable:tt}={}){this.stream=U,this.queue=new i,this.highWaterMark=ve,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=tt||ut||ka,this.map=Ne||De,this.afterWrite=Di.bind(this),this.afterUpdateNextTick=Sa.bind(this)}get ended(){return(this.stream._duplexState&Ye)!==0}push(U){return(this.stream._duplexState&ms)!==0?!1:(this.map!==null&&(U=this.map(U)),this.buffered+=this.byteLength(U),this.queue.push(U),this.buffered<this.highWaterMark?(this.stream._duplexState|=Ve,!0):(this.stream._duplexState|=js,!1))}shift(){let U=this.queue.shift();return this.buffered-=this.byteLength(U),this.buffered===0&&(this.stream._duplexState&=yt),U}end(U){typeof U=="function"?this.stream.once("finish",U):U!=null&&this.push(U),this.stream._duplexState=(this.stream._duplexState|xe)&Vt}autoBatch(U,ve){let De=[],Ne=this.stream;for(De.push(U);(Ne._duplexState&ui)===cn;)De.push(Ne._writableState.shift());if((Ne._duplexState&M)!==0)return ve(null);Ne._writev(De,ve)}update(){let U=this.stream;U._duplexState|=Pe;do{for(;(U._duplexState&ui)===Ve;){let ve=this.shift();U._duplexState|=gs,U._write(ve,this.afterWrite)}(U._duplexState&ga)===0&&this.updateNonPrimary()}while(this.continueUpdate()===!0);U._duplexState&=Ft}updateNonPrimary(){let U=this.stream;if((U._duplexState&mr)===xe){U._duplexState=U._duplexState|Oe,U._final(_a.bind(this));return}if((U._duplexState&kt)===c){(U._duplexState&j)===0&&(U._duplexState|=Pt,U._destroy(vs.bind(this)));return}(U._duplexState&J)===a&&(U._duplexState=(U._duplexState|Pt)&f,U._open(Ca.bind(this)))}continueUpdate(){return(this.stream._duplexState&Wt)===0?!1:(this.stream._duplexState&=Ti,!0)}updateCallback(){(this.stream._duplexState&va)===Be?this.update():this.updateNextTick()}updateNextTick(){(this.stream._duplexState&Wt)===0&&(this.stream._duplexState|=Wt,(this.stream._duplexState&Pe)===0&&queueMicrotask(this.afterUpdateNextTick))}}class ya{constructor(U,{highWaterMark:ve=16384,map:De=null,mapReadable:Ne,byteLength:ut,byteLengthReadable:tt}={}){this.stream=U,this.queue=new i,this.highWaterMark=ve===0?1:ve,this.buffered=0,this.readAhead=ve>0,this.error=null,this.pipeline=null,this.byteLength=tt||ut||ka,this.map=Ne||De,this.pipeTo=null,this.afterRead=Ea.bind(this),this.afterUpdateNextTick=ba.bind(this)}get ended(){return(this.stream._duplexState&N)!==0}pipe(U,ve){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof ve!="function"&&(ve=null),this.stream._duplexState|=I,this.pipeTo=U,this.pipeline=new Ta(this.stream,U,ve),ve&&this.stream.on("error",Yt),Ks(U))U._writableState.pipeline=this.pipeline,ve&&U.on("error",Yt),U.on("finish",this.pipeline.finished.bind(this.pipeline));else{let De=this.pipeline.done.bind(this.pipeline,U),Ne=this.pipeline.done.bind(this.pipeline,U,null);U.on("error",De),U.on("close",Ne),U.on("finish",this.pipeline.finished.bind(this.pipeline))}U.on("drain",fn.bind(this)),this.stream.emit("piping",U),U.emit("pipe",this.stream)}push(U){let ve=this.stream;return U===null?(this.highWaterMark=0,ve._duplexState=(ve._duplexState|R)&de,!1):this.map!==null&&(U=this.map(U),U===null)?(ve._duplexState&=Z,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(U),this.queue.push(U),ve._duplexState=(ve._duplexState|S)&Z,this.buffered<this.highWaterMark)}shift(){let U=this.queue.shift();return this.buffered-=this.byteLength(U),this.buffered===0&&(this.stream._duplexState&=se),U}unshift(U){let ve=[this.map!==null?this.map(U):U];for(;this.buffered>0;)ve.push(this.shift());for(let De=0;De<ve.length-1;De++){let Ne=ve[De];this.buffered+=this.byteLength(Ne),this.queue.push(Ne)}this.push(ve[ve.length-1])}read(){let U=this.stream;if((U._duplexState&Me)===S){let ve=this.shift();return this.pipeTo!==null&&this.pipeTo.write(ve)===!1&&(U._duplexState&=Y),(U._duplexState&k)!==0&&U.emit("data",ve),ve}return this.readAhead===!1&&(U._duplexState|=O,this.updateNextTick()),null}drain(){let U=this.stream;for(;(U._duplexState&Me)===S&&(U._duplexState&P)!==0;){let ve=this.shift();this.pipeTo!==null&&this.pipeTo.write(ve)===!1&&(U._duplexState&=Y),(U._duplexState&k)!==0&&U.emit("data",ve)}}update(){let U=this.stream;U._duplexState|=_;do{for(this.drain();this.buffered<this.highWaterMark&&(U._duplexState&ke)===O;)U._duplexState|=G,U._read(this.afterRead),this.drain();(U._duplexState&et)===ie&&(U._duplexState|=x,U.emit("readable")),(U._duplexState&Q)===0&&this.updateNonPrimary()}while(this.continueUpdate()===!0);U._duplexState&=be}updateNonPrimary(){let U=this.stream;if((U._duplexState&nt)===R&&(U._duplexState=(U._duplexState|N)&oe,U.emit("end"),(U._duplexState&b)===Dt&&(U._duplexState|=c),this.pipeTo!==null&&this.pipeTo.end()),(U._duplexState&kt)===c){(U._duplexState&j)===0&&(U._duplexState|=Pt,U._destroy(vs.bind(this)));return}(U._duplexState&J)===a&&(U._duplexState=(U._duplexState|Pt)&f,U._open(Ca.bind(this)))}continueUpdate(){return(this.stream._duplexState&B)===0?!1:(this.stream._duplexState&=ee,!0)}updateCallback(){(this.stream._duplexState&hn)===E?this.update():this.updateNextTick()}updateNextTickIfOpen(){(this.stream._duplexState&Qi)===0&&(this.stream._duplexState|=B,(this.stream._duplexState&_)===0&&queueMicrotask(this.afterUpdateNextTick))}updateNextTick(){(this.stream._duplexState&B)===0&&(this.stream._duplexState|=B,(this.stream._duplexState&_)===0&&queueMicrotask(this.afterUpdateNextTick))}}class dn{constructor(U){this.data=null,this.afterTransform=gn.bind(U),this.afterFinal=null}}class Ta{constructor(U,ve,De){this.from=U,this.to=ve,this.afterPipe=De,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(U,ve){if(ve&&(this.error=ve),U===this.to&&(this.to=null,this.from!==null)){((this.from._duplexState&N)===0||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(U===this.from&&(this.from=null,this.to!==null)){(U._duplexState&N)===0&&this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function fn(){this.stream._duplexState|=I,this.updateCallback()}function _a(_e){let U=this.stream;_e&&U.destroy(_e),(U._duplexState&kt)===0&&(U._duplexState|=Ye,U.emit("finish")),(U._duplexState&b)===Dt&&(U._duplexState|=c),U._duplexState&=Ct,(U._duplexState&Pe)===0?this.update():this.updateNextTick()}function vs(_e){let U=this.stream;!_e&&this.error!==e&&(_e=this.error),_e&&U.emit("error",_e),U._duplexState|=h,U.emit("close");let ve=U._readableState,De=U._writableState;if(ve!==null&&ve.pipeline!==null&&ve.pipeline.done(U,_e),De!==null){for(;De.drains!==null&&De.drains.length>0;)De.drains.shift().resolve(!1);De.pipeline!==null&&De.pipeline.done(U,_e)}}function Di(_e){let U=this.stream;_e&&U.destroy(_e),U._duplexState&=St,this.drains!==null&&pn(this.drains),(U._duplexState&pa)===Je&&(U._duplexState&=Ut,(U._duplexState&ni)===ni&&U.emit("drain")),this.updateCallback()}function Ea(_e){_e&&this.stream.destroy(_e),this.stream._duplexState&=re,this.readAhead===!1&&(this.stream._duplexState&C)===0&&(this.stream._duplexState&=Ee),this.updateCallback()}function ba(){(this.stream._duplexState&_)===0&&(this.stream._duplexState&=ee,this.update())}function Sa(){(this.stream._duplexState&Pe)===0&&(this.stream._duplexState&=Ti,this.update())}function pn(_e){for(let U=0;U<_e.length;U++)--_e[U].writes===0&&(_e.shift().resolve(!0),U--)}function Ca(_e){let U=this.stream;_e&&U.destroy(_e),(U._duplexState&c)===0&&((U._duplexState&le)===0&&(U._duplexState|=E),(U._duplexState&_i)===0&&(U._duplexState|=Be),U.emit("open")),U._duplexState&=zt,U._writableState!==null&&U._writableState.updateCallback(),U._readableState!==null&&U._readableState.updateCallback()}function gn(_e,U){U!=null&&this.push(U),this._writableState.afterWrite(_e)}function mn(_e){this._readableState!==null&&(_e==="data"&&(this._duplexState|=k|te,this._readableState.updateNextTick()),_e==="readable"&&(this._duplexState|=D,this._readableState.updateNextTick())),this._writableState!==null&&_e==="drain"&&(this._duplexState|=ni,this._writableState.updateNextTick())}class vr extends r{constructor(U){super(),this._duplexState=0,this._readableState=null,this._writableState=null,U&&(U.open&&(this._open=U.open),U.destroy&&(this._destroy=U.destroy),U.predestroy&&(this._predestroy=U.predestroy),U.signal&&U.signal.addEventListener("abort",at.bind(this))),this.on("newListener",mn)}_open(U){U(null)}_destroy(U){U(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&h)!==0}get destroying(){return(this._duplexState&kt)!==0}destroy(U){(this._duplexState&kt)===0&&(U||(U=e),this._duplexState=(this._duplexState|c)&A,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=U),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=U),this._duplexState|=l,this._predestroy(),this._duplexState&=p,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class ys extends vr{constructor(U){super(U),this._duplexState|=a|Ye|O,this._readableState=new ya(this,U),U&&(this._readableState.readAhead===!1&&(this._duplexState&=Ee),U.read&&(this._read=U.read),U.eagerOpen&&this._readableState.updateNextTick(),U.encoding&&this.setEncoding(U.encoding))}setEncoding(U){let ve=new s(U),De=this._readableState.map||Tr;return this._readableState.map=Ne,this;function Ne(ut){let tt=ve.push(ut);return tt===""&&(ut.byteLength!==0||ve.remaining>0)?null:De(tt)}}_read(U){U(null)}pipe(U,ve){return this._readableState.updateNextTick(),this._readableState.pipe(U,ve),U}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(U){return this._readableState.updateNextTickIfOpen(),this._readableState.push(U)}unshift(U){return this._readableState.updateNextTickIfOpen(),this._readableState.unshift(U)}resume(){return this._duplexState|=te,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?Re:ae,this}static _fromAsyncIterator(U,ve){let De,Ne=new ys(ht(Ue({},ve),{read(tt){U.next().then(ut).then(tt.bind(null,null)).catch(tt)},predestroy(){De=U.return()},destroy(tt){if(!De)return tt(null);De.then(tt.bind(null,null)).catch(tt)}}));return Ne;function ut(tt){tt.done?Ne.push(null):Ne.push(tt.value)}}static from(U,ve){if(Ts(U))return U;if(U[Pi])return this._fromAsyncIterator(U[Pi](),ve);Array.isArray(U)||(U=U===void 0?[]:[U]);let De=0;return new ys(ht(Ue({},ve),{read(Ne){this.push(De===U.length?null:U[De++]),Ne(null)}}))}static isBackpressured(U){return(U._duplexState&qe)!==0||U._readableState.buffered>=U._readableState.highWaterMark}static isPaused(U){return(U._duplexState&C)===0}[Pi](){let U=this,ve=null,De=null,Ne=null;return this.on("error",Xe=>{ve=Xe}),this.on("readable",ut),this.on("close",tt),{[Pi](){return this},next(){return new Promise(function(Xe,Xt){De=Xe,Ne=Xt;let $t=U.read();$t!==null?bi($t):(U._duplexState&h)!==0&&bi(null)})},return(){return _s(null)},throw(Xe){return _s(Xe)}};function ut(){De!==null&&bi(U.read())}function tt(){De!==null&&bi(null)}function bi(Xe){Ne!==null&&(ve?Ne(ve):Xe===null&&(U._duplexState&N)===0?Ne(e):De({value:Xe,done:Xe===null}),Ne=De=null)}function _s(Xe){return U.destroy(Xe),new Promise((Xt,$t)=>{if(U._duplexState&h)return Xt({value:void 0,done:!0});U.once("close",function(){Xe?$t(Xe):Xt({value:void 0,done:!0})})})}}}class wa extends vr{constructor(U){super(U),this._duplexState|=a|N,this._writableState=new Vs(this,U),U&&(U.writev&&(this._writev=U.writev),U.write&&(this._write=U.write),U.final&&(this._final=U.final),U.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Ke}uncork(){this._duplexState&=wt,this._writableState.updateNextTick()}_writev(U,ve){ve(null)}_write(U,ve){this._writableState.autoBatch(U,ve)}_final(U){U(null)}static isBackpressured(U){return(U._duplexState&ma)!==0}static drained(U){if(U.destroyed)return Promise.resolve(!1);let ve=U._writableState,Ne=(Ei(U)?Math.min(1,ve.queue.length):ve.queue.length)+(U._duplexState&Ri?1:0);return Ne===0?Promise.resolve(!0):(ve.drains===null&&(ve.drains=[]),new Promise(ut=>{ve.drains.push({writes:Ne,resolve:ut})}))}write(U){return this._writableState.updateNextTick(),this._writableState.push(U)}end(U){return this._writableState.updateNextTick(),this._writableState.end(U),this}}class vn extends ys{constructor(U){super(U),this._duplexState=a|this._duplexState&O,this._writableState=new Vs(this,U),U&&(U.writev&&(this._writev=U.writev),U.write&&(this._write=U.write),U.final&&(this._final=U.final))}cork(){this._duplexState|=Ke}uncork(){this._duplexState&=wt,this._writableState.updateNextTick()}_writev(U,ve){ve(null)}_write(U,ve){this._writableState.autoBatch(U,ve)}_final(U){U(null)}write(U){return this._writableState.updateNextTick(),this._writableState.push(U)}end(U){return this._writableState.updateNextTick(),this._writableState.end(U),this}}class hi extends vn{constructor(U){super(U),this._transformState=new dn(this),U&&(U.transform&&(this._transform=U.transform),U.flush&&(this._flush=U.flush))}_write(U,ve){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=U:this._transform(U,this._transformState.afterTransform)}_read(U){if(this._transformState.data!==null){let ve=this._transformState.data;this._transformState.data=null,U(null),this._transform(ve,this._transformState.afterTransform)}else U(null)}destroy(U){super.destroy(U),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(U,ve){ve(null,U)}_flush(U){U(null)}_final(U){this._transformState.afterFinal=U,this._flush(Nt.bind(this))}}class Aa extends hi{}function Nt(_e,U){let ve=this._transformState.afterFinal;if(_e)return ve(_e);U!=null&&this.push(U),this.push(null),ve(null)}function Ia(..._e){return new Promise((U,ve)=>yr(..._e,De=>{if(De)return ve(De);U()}))}function yr(_e,...U){let ve=Array.isArray(_e)?[..._e,...U]:[_e,...U],De=ve.length&&typeof ve[ve.length-1]=="function"?ve.pop():null;if(ve.length<2)throw new Error("Pipeline requires at least 2 streams");let Ne=ve[0],ut=null,tt=null;for(let Xe=1;Xe<ve.length;Xe++)ut=ve[Xe],Ks(Ne)?Ne.pipe(ut,_s):(bi(Ne,!0,Xe>1,_s),Ne.pipe(ut)),Ne=ut;if(De){let Xe=!1,Xt=Ks(ut)||!!(ut._writableState&&ut._writableState.autoDestroy);ut.on("error",$t=>{tt===null&&(tt=$t)}),ut.on("finish",()=>{Xe=!0,Xt||De(tt)}),Xt&&ut.on("close",()=>De(tt||(Xe?null:t)))}return ut;function bi(Xe,Xt,$t,yn){Xe.on("error",yn),Xe.on("close",Tn);function Tn(){if(Xe._readableState&&!Xe._readableState.ended||$t&&Xe._writableState&&!Xe._writableState.ended)return yn(t)}}function _s(Xe){if(!(!Xe||tt)){tt=Xe;for(let Xt of ve)Xt.destroy(Xe)}}}function Tr(_e){return _e}function Gs(_e){return!!_e._readableState||!!_e._writableState}function Ks(_e){return typeof _e._duplexState=="number"&&Gs(_e)}function Vl(_e){return!!_e._readableState&&_e._readableState.ended}function Gt(_e){return!!_e._writableState&&_e._writableState.ended}function xt(_e,U={}){let ve=_e._readableState&&_e._readableState.error||_e._writableState&&_e._writableState.error;return!U.all&&ve===e?null:ve}function Ts(_e){return Ks(_e)&&_e.readable}function _r(_e){return(_e._duplexState&a)!==a||(_e._duplexState&j)!==0}function La(_e){return typeof _e=="object"&&_e!==null&&typeof _e.byteLength=="number"}function ka(_e){return La(_e)?_e.byteLength:1024}function Yt(){}function at(){this.destroy(new Error("Stream aborted."))}function Ei(_e){return _e._writev!==wa.prototype._writev&&_e._writev!==vn.prototype._writev}return Ih={pipeline:yr,pipelinePromise:Ia,isStream:Gs,isStreamx:Ks,isEnded:Vl,isFinished:Gt,isDisturbed:_r,getStreamError:xt,Stream:vr,Writable:wa,Readable:ys,Duplex:vn,Transform:hi,PassThrough:Aa},Ih}var ST=mA(),Lh,Qm;function vA(){if(Qm)return Lh;Qm=1;function r(t,i){for(let s in i)Object.defineProperty(t,s,{value:i[s],enumerable:!0,configurable:!0});return t}function e(t,i,s){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");s||(s={}),typeof i=="object"&&(s=i,i=""),i&&(s.code=i);try{return r(t,s)}catch{s.message=t.message,s.stack=t.stack;let a=function(){};return a.prototype=Object.create(Object.getPrototypeOf(t)),r(new a,s)}}return Lh=e,Lh}var yA=vA(),vt=gr(yA);var vl="0123456789abcdef",CT=[],yl=[];for(let r=0;r<256;r++)CT[r]=vl[r>>4&15]+vl[r&15],r<16&&(r<10?yl[48+r]=r:yl[87+r]=r);var tn=r=>{let e=r.length,t="",i=0;for(;i<e;)t+=CT[r[i++]];return t},Dd=r=>{let e=r.length>>1,t=e<<1,i=new Uint8Array(e),s=0,n=0;for(;n<t;)i[s++]=yl[r.charCodeAt(n++)]<<4|yl[r.charCodeAt(n++)];return i},Jm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",TA=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(In=0;In<Jm.length;In++)TA[Jm.charCodeAt(In)]=In;var In,_A=new TextDecoder,wT=(r,e)=>_A.decode(r),EA=new TextEncoder,jf=r=>EA.encode(r),Fr=r=>{let e="",t,i=0,s=r.length;for(;i<s;)t=r.charCodeAt(i++),e+=vl[t>>4]+vl[t&15];return e},Zm=65536,Wn=r=>{let e=Dd(r);if(e.length<=Zm)return String.fromCharCode(...e);let t="",i=0;for(;i<e.length;)t+=String.fromCharCode(...e.subarray(i,i+=Zm));return t},ev=typeof window<"u"?window:self,xd=ev.crypto||ev.msCrypto||{};xd.subtle||xd.webkitSubtle;var Tl=r=>{let e=new Uint8Array(r);return xd.getRandomValues(e)};var bA=Xi("simple-peer"),kh=64*1024,SA=5*1e3,CA=5*1e3;function tv(r){return r.replace(/a=ice-options:trickle\s\n/g,"")}function wA(r){console.warn(r)}var AT=(()=>{let r=class Od extends ST.Duplex{constructor(t){if(t=Object.assign({allowHalfOpen:!1},t),super(t),ue(this,"_pc"),this.__objectMode=!!t.objectMode,this._id=tn(Tl(4)).slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||tn(Tl(20)):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||Od.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Od.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(i=>i),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||SA,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!bh)throw vt(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new bh(this.config)}catch(i){this.__destroy(vt(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(vt(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this._destroying){if(this.destroyed)throw vt(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof t=="string")try{t=JSON.parse(t)}catch{t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new cA(t)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(vt(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.__destroy(vt(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){let i=new dA(t);this._pc.addIceCandidate(i).catch(s=>{!i.address||i.address.endsWith(".local")?wA("Ignoring unsupported ICE candidate."):this.__destroy(vt(s,"ERR_ADD_ICE_CANDIDATE"))})}send(t){if(!this._destroying){if(this.destroyed)throw vt(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw vt(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(t){this._readableState.ended||this.push(null),t(null)}__destroy(t){this.end(),this._destroy(()=>{},t)}_destroy(t,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),t()},0))}_setupData(t){if(!t.channel)return this.__destroy(vt(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=kh),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{let n=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.__destroy(vt(n,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},CA)}_write(t,i){if(this.destroyed)return i(vt(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(s){return this.__destroy(vt(s,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>kh?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=t,this._cb=i}_onFinish(){if(this.destroyed)return;let t=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=tv(t.sdp)),t.sdp=this.sdpTransform(t.sdp);let i=()=>{if(this.destroyed)return;let a=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:a.type,sdp:a.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},n=a=>{this.__destroy(vt(a,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(s).catch(n)}).catch(t=>{this.__destroy(vt(t,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=tv(t.sdp)),t.sdp=this.sdpTransform(t.sdp);let i=()=>{var a;if(this.destroyed)return;let l=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:l.type,sdp:l.sdp}),this.initiator||(a=this._requestMissingTransceivers)==null||a.call(this)},s=()=>{this.destroyed||(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},n=a=>{this.__destroy(vt(a,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(s).catch(n)}).catch(t=>{this.__destroy(vt(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||this._pc.connectionState==="failed"&&this.__destroy(vt(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;let t=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,i),this.emit("iceStateChange",t,i),(t==="connected"||t==="completed")&&(this._pcReady=!0,this._maybeReady()),t==="failed"&&this.__destroy(vt(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),t==="closed"&&this.__destroy(vt(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(t){let i=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(n=>{Object.assign(s,n)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{let n=[];s.forEach(a=>{n.push(i(a))}),t(null,n)},s=>t(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;let n=[];s.result().forEach(a=>{let l={};a.names().forEach(c=>{l[c]=a.stat(c)}),l.id=a.id,l.type=a.type,l.timestamp=a.timestamp,n.push(i(l))}),t(null,n)},s=>t(s)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;let t=()=>{this.destroyed||this._destroying||this.getStats((i,s)=>{if(this.destroyed||this._destroying)return;i&&(s=[]);let n={},a={},l={},c=!1;s.forEach(f=>{(f.type==="remotecandidate"||f.type==="remote-candidate")&&(n[f.id]=f),(f.type==="localcandidate"||f.type==="local-candidate")&&(a[f.id]=f),(f.type==="candidatepair"||f.type==="candidate-pair")&&(l[f.id]=f)});let h=f=>{c=!0;let p=a[f.localCandidateId];p&&(p.ip||p.address)?(this.localAddress=p.ip||p.address,this.localPort=Number(p.port)):p&&p.ipAddress?(this.localAddress=p.ipAddress,this.localPort=Number(p.portNumber)):typeof f.googLocalAddress=="string"&&(p=f.googLocalAddress.split(":"),this.localAddress=p[0],this.localPort=Number(p[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let m=n[f.remoteCandidateId];m&&(m.ip||m.address)?(this.remoteAddress=m.ip||m.address,this.remotePort=Number(m.port)):m&&m.ipAddress?(this.remoteAddress=m.ipAddress,this.remotePort=Number(m.portNumber)):typeof f.googRemoteAddress=="string"&&(m=f.googRemoteAddress.split(":"),this.remoteAddress=m[0],this.remotePort=Number(m[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(f=>{f.type==="transport"&&f.selectedCandidatePairId&&h(l[f.selectedCandidatePairId]),(f.type==="googCandidatePair"&&f.googActiveConnection==="true"||(f.type==="candidatepair"||f.type==="candidate-pair")&&f.selected)&&h(f)}),!c&&(!Object.keys(l).length||Object.keys(a).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(p){return this.__destroy(vt(p,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');let f=this._cb;this._cb=null,f(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};t()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>kh||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let i=t.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=jf(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);let t=this._cb;this._cb=null,t(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){let t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],bA.apply(null,t)}};return r.WEBRTC_SUPPORT=!!bh,r.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},r.channelConfig={},r})(),AA=bT(),Md=gr(AA),Wi={},IA=Object.freeze(Object.defineProperty({__proto__:null,default:Wi},Symbol.toStringTag,{value:"Module"})),LA=50,kA=82,RA=r=>{let e=new URL(r.replace(/^udp:/,"http:"));return r.match(/^udp:/)&&Object.defineProperties(e,{href:{value:e.href.replace(/^http/,"udp")},protocol:{value:e.protocol.replace(/^http/,"udp")},origin:{value:e.origin.replace(/^http/,"udp")}}),e},Fd=Ue({DEFAULT_ANNOUNCE_PEERS:LA,MAX_ANNOUNCE_PEERS:kA,parseUrl:RA},IA);var PA=Xi("simple-websocket"),Ln=typeof Wi!="function"?WebSocket:Wi,iv=64*1024,DA=(()=>{class r extends ST.Duplex{constructor(t={}){if(typeof t=="string"&&(t={url:t}),t=Object.assign({allowHalfOpen:!1},t),super(t),this.__objectMode=!!t.objectMode,t.objectMode!=null&&delete t.objectMode,t.url==null&&t.socket==null)throw new Error("Missing required `url` or `socket` option");if(t.url!=null&&t.socket!=null)throw new Error("Must specify either `url` or `socket` option, not both");if(this._id=tn(Tl(4)).slice(0,7),this._debug("new websocket: %o",t),this.connected=!1,this._chunk=null,this._cb=null,this._interval=null,t.socket)this.url=t.socket.url,this._ws=t.socket,this.connected=t.socket.readyState===Ln.OPEN;else{this.url=t.url;try{typeof Wi=="function"?this._ws=new Ln(t.url,ht(Ue({},t),{encoding:void 0})):this._ws=new Ln(t.url)}catch(i){Md(()=>this.destroy(i));return}}this._ws.binaryType="arraybuffer",t.socket&&this.connected?Md(()=>this._handleOpen()):this._ws.onopen=()=>this._handleOpen(),this._ws.onmessage=i=>this._handleMessage(i),this._ws.onclose=()=>this._handleClose(),this._ws.onerror=i=>this._handleError(i),this._handleFinishBound=()=>this._handleFinish(),this.once("finish",this._handleFinishBound)}send(t){this._ws.send(t)}_final(t){this._readableState.ended||this.push(null),t(null)}_destroy(t){if(!this.destroyed){if(this._writableState.ended||this.end(),this.connected=!1,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._handleFinishBound&&this.removeListener("finish",this._handleFinishBound),this._handleFinishBound=null,this._ws){let i=this._ws,s=()=>{i.onclose=null};if(i.readyState===Ln.CLOSED)s();else try{i.onclose=s,i.close()}catch{s()}i.onopen=null,i.onmessage=null,i.onerror=()=>{}}this._ws=null,t()}}_write(t,i){if(this.destroyed)return i(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(t)}catch(s){return this.destroy(s)}typeof Wi!="function"&&this._ws.bufferedAmount>iv?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=t,this._cb=i}_handleOpen(){if(!(this.connected||this.destroyed)){if(this.connected=!0,this._chunk){try{this.send(this._chunk)}catch(i){return this.destroy(i)}this._chunk=null,this._debug('sent chunk from "write before connect"');let t=this._cb;this._cb=null,t(null)}typeof Wi!="function"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}}_handleMessage(t){if(this.destroyed)return;let i=t.data;i instanceof ArrayBuffer&&(i=new Uint8Array(i)),this.__objectMode===!1&&(i=jf(i)),this.push(i)}_handleClose(){this.destroyed||(this._debug("on close"),this.destroy())}_handleError(t){this.destroy(new Error(`Error connecting to ${this.url}`))}_handleFinish(){if(this.destroyed)return;let t=()=>{setTimeout(()=>this.destroy(),1e3)};this.connected?t():this.once("connect",t)}_onInterval(){if(!this._cb||!this._ws||this._ws.bufferedAmount>iv)return;this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);let t=this._cb;this._cb=null,t(null)}_debug(){let t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],PA.apply(null,t)}}return r.WEBSOCKET_SUPPORT=!!Ln,r})(),Nd=class extends ET{constructor(e,t){super(),this.client=e,this.announceUrl=t,this.interval=null,this.destroyed=!1}setInterval(e){e==null&&(e=this.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(this.interval),e&&(this.interval=setInterval(()=>{this.announce(this.client._defaultAnnounceOpts())},e),this.interval.unref&&this.interval.unref())}},Ci=Xi("bittorrent-tracker:websocket-tracker"),ts={},xA=10*1e3,OA=60*60*1e3,MA=5*60*1e3,FA=50*1e3,la=class extends Nd{constructor(e,t){super(e,t),Ci("new websocket tracker %s",t),this.peers={},this.socket=null,this.reconnecting=!1,this.retries=0,this.reconnectTimer=null,this.expectingResponse=!1,this._openSocket()}announce(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.announce(e)});return}let t=Object.assign({},e,{action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary});if(this._trackerId&&(t.trackerid=this._trackerId),e.event==="stopped"||e.event==="completed")this._send(t);else{let i=Math.min(e.numwant,5);this._generateOffers(i,s=>{t.numwant=i,t.offers=s,this._send(t)})}}scrape(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.scrape(e)});return}let i={action:"scrape",info_hash:Array.isArray(e.infoHash)&&e.infoHash.length>0?e.infoHash.map(s=>Wn(s)):e.infoHash&&Wn(e.infoHash)||this.client._infoHashBinary};this._send(i)}destroy(e=sv){if(this.destroyed)return e(null);this.destroyed=!0,clearInterval(this.interval),clearTimeout(this.reconnectTimer);for(let n in this.peers){let a=this.peers[n];clearTimeout(a.trackerTimeout),a.destroy()}if(this.peers=null,this.socket&&(this.socket.removeListener("connect",this._onSocketConnectBound),this.socket.removeListener("data",this._onSocketDataBound),this.socket.removeListener("close",this._onSocketCloseBound),this.socket.removeListener("error",this._onSocketErrorBound),this.socket=null),this._onSocketConnectBound=null,this._onSocketErrorBound=null,this._onSocketDataBound=null,this._onSocketCloseBound=null,ts[this.announceUrl]&&(ts[this.announceUrl].consumers-=1),ts[this.announceUrl].consumers>0)return e();let t=ts[this.announceUrl];delete ts[this.announceUrl],t.on("error",sv),t.once("close",e);let i;if(!this.expectingResponse)return s();i=setTimeout(s,Fd.DESTROY_TIMEOUT),t.once("data",s);function s(){i&&(clearTimeout(i),i=null),t.removeListener("data",s),t.destroy(),t=null}}_openSocket(){if(this.destroyed=!1,this.peers||(this.peers={}),this._onSocketConnectBound=()=>{this._onSocketConnect()},this._onSocketErrorBound=e=>{this._onSocketError(e)},this._onSocketDataBound=e=>{this._onSocketData(e)},this._onSocketCloseBound=()=>{this._onSocketClose()},this.socket=ts[this.announceUrl],this.socket)ts[this.announceUrl].consumers+=1,this.socket.connected&&this._onSocketConnectBound();else{let e=new URL(this.announceUrl),t;this.client._proxyOpts&&(t=e.protocol==="wss:"?this.client._proxyOpts.httpsAgent:this.client._proxyOpts.httpAgent,!t&&this.client._proxyOpts.socksProxy&&(t=this.client._proxyOpts.socksProxy)),this.socket=ts[this.announceUrl]=new DA({url:this.announceUrl,agent:t}),this.socket.consumers=1,this.socket.once("connect",this._onSocketConnectBound)}this.socket.on("data",this._onSocketDataBound),this.socket.once("close",this._onSocketCloseBound),this.socket.once("error",this._onSocketErrorBound)}_onSocketConnect(){this.destroyed||this.reconnecting&&(this.reconnecting=!1,this.retries=0,this.announce(this.client._defaultAnnounceOpts()))}_onSocketData(e){if(!this.destroyed){this.expectingResponse=!1;try{e=JSON.parse(wT(e))}catch{this.client.emit("warning",new Error("Invalid tracker response"));return}e.action==="announce"?this._onAnnounceResponse(e):e.action==="scrape"?this._onScrapeResponse(e):this._onSocketError(new Error(`invalid action in WS response: ${e.action}`))}}_onAnnounceResponse(e){if(e.info_hash!==this.client._infoHashBinary){Ci("ignoring websocket data from %s for %s (looking for %s: reused socket)",this.announceUrl,Fr(e.info_hash),this.client.infoHash);return}if(e.peer_id&&e.peer_id===this.client._peerIdBinary)return;Ci("received %s from %s for %s",JSON.stringify(e),this.announceUrl,this.client.infoHash);let t=e["failure reason"];if(t)return this.client.emit("warning",new Error(t));let i=e["warning message"];i&&this.client.emit("warning",new Error(i));let s=e.interval||e["min interval"];s&&this.setInterval(s*1e3);let n=e["tracker id"];if(n&&(this._trackerId=n),e.complete!=null){let l=Object.assign({},e,{announce:this.announceUrl,infoHash:Fr(e.info_hash)});this.client.emit("update",l)}let a;if(e.offer&&e.peer_id&&(Ci("creating peer (from remote offer)"),a=this._createPeer(),a.id=Fr(e.peer_id),a.once("signal",l=>{let c={action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary,to_peer_id:e.peer_id,answer:l,offer_id:e.offer_id};this._trackerId&&(c.trackerid=this._trackerId),this._send(c)}),this.client.emit("peer",a),a.signal(e.offer)),e.answer&&e.peer_id){let l=Fr(e.offer_id);a=this.peers[l],a?(a.id=Fr(e.peer_id),this.client.emit("peer",a),a.signal(e.answer),clearTimeout(a.trackerTimeout),a.trackerTimeout=null,delete this.peers[l]):Ci(`got unexpected answer: ${JSON.stringify(e.answer)}`)}}_onScrapeResponse(e){e=e.files||{};let t=Object.keys(e);if(t.length===0){this.client.emit("warning",new Error("invalid scrape response"));return}t.forEach(i=>{let s=Object.assign(e[i],{announce:this.announceUrl,infoHash:Fr(i)});this.client.emit("scrape",s)})}_onSocketClose(){this.destroyed||(this.destroy(),this._startReconnectTimer())}_onSocketError(e){this.destroyed||(this.destroy(),this.client.emit("warning",e),this._startReconnectTimer())}_startReconnectTimer(){let e=Math.floor(Math.random()*MA)+Math.min(Math.pow(2,this.retries)*xA,OA);this.reconnecting=!0,clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(()=>{this.retries++,this._openSocket()},e),this.reconnectTimer.unref&&this.reconnectTimer.unref(),Ci("reconnecting socket in %s ms",e)}_send(e){if(this.destroyed)return;this.expectingResponse=!0;let t=JSON.stringify(e);Ci("send %s",t),this.socket.send(t)}_generateOffers(e,t){let i=this,s=[];Ci("generating %s offers",e);for(let l=0;l<e;++l)n();a();function n(){let l=tn(Tl(20));Ci("creating peer (from _generateOffers)");let c=i.peers[l]=i._createPeer({initiator:!0});c.once("signal",h=>{s.push({offer:h,offer_id:Wn(l)}),a()}),c.trackerTimeout=setTimeout(()=>{Ci("tracker timeout: destroying peer"),c.trackerTimeout=null,delete i.peers[l],c.destroy()},FA),c.trackerTimeout.unref&&c.trackerTimeout.unref()}function a(){s.length===e&&(Ci("generated %s offers",e),t(s))}}_createPeer(e){let t=this;e=Object.assign({trickle:!1,config:t.client._rtcConfig,wrtc:t.client._wrtc},e);let i=new AT(e);return i.once("error",s),i.once("connect",n),i;function s(a){t.client.emit("warning",new Error(`Connection error: ${a.message}`)),i.destroy()}function n(){i.removeListener("error",s),i.removeListener("connect",n)}}};la.prototype.DEFAULT_ANNOUNCE_INTERVAL=30*1e3;la._socketPool=ts;function sv(){}var Ss=Xi("bittorrent-tracker:client"),NA=(()=>{class r extends ET{constructor(t={}){if(super(),!t.peerId)throw new Error("Option `peerId` is required");if(!t.infoHash)throw new Error("Option `infoHash` is required");if(!t.announce)throw new Error("Option `announce` is required");if(!Do.browser&&!t.port)throw new Error("Option `port` is required");this.peerId=typeof t.peerId=="string"?t.peerId:tn(t.peerId),this._peerIdBuffer=Dd(this.peerId),this._peerIdBinary=Wn(this.peerId),this.infoHash=typeof t.infoHash=="string"?t.infoHash.toLowerCase():tn(t.infoHash),this._infoHashBuffer=Dd(this.infoHash),this._infoHashBinary=Wn(this.infoHash),Ss("new client %s",this.infoHash),this.destroyed=!1,this._port=t.port,this._getAnnounceOpts=t.getAnnounceOpts,this._rtcConfig=t.rtcConfig,this._userAgent=t.userAgent,this._proxyOpts=t.proxyOpts,this._wrtc=typeof t.wrtc=="function"?t.wrtc():t.wrtc;let i=typeof t.announce=="string"?[t.announce]:t.announce==null?[]:t.announce;i=i.map(a=>(ArrayBuffer.isView(a)&&(a=wT(a)),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1)),a)),i=Array.from(new Set(i));let s=this._wrtc!==!1&&(!!this._wrtc||AT.WEBRTC_SUPPORT),n=a=>{Md(()=>{this.emit("warning",a)})};this._trackers=i.map(a=>{let l;try{l=Fd.parseUrl(a)}catch{return n(new Error(`Invalid tracker URL: ${a}`)),null}let c=l.port;if(c<0||c>65535)return n(new Error(`Invalid tracker port: ${a}`)),null;let h=l.protocol;return(h==="http:"||h==="https:")&&typeof Wi=="function"?new Wi(this,a):h==="udp:"&&typeof Wi=="function"?new Wi(this,a):(h==="ws:"||h==="wss:")&&s?h==="ws:"&&typeof window<"u"&&window.location.protocol==="https:"?(n(new Error(`Unsupported tracker protocol: ${a}`)),null):new la(this,a):(n(new Error(`Unsupported tracker protocol: ${a}`)),null)}).filter(Boolean)}start(t){t=this._defaultAnnounceOpts(t),t.event="started",Ss("send `start` %o",t),this._announce(t),this._trackers.forEach(i=>{i.setInterval()})}stop(t){t=this._defaultAnnounceOpts(t),t.event="stopped",Ss("send `stop` %o",t),this._announce(t)}complete(t){t||(t={}),t=this._defaultAnnounceOpts(t),t.event="completed",Ss("send `complete` %o",t),this._announce(t)}update(t){t=this._defaultAnnounceOpts(t),t.event&&delete t.event,Ss("send `update` %o",t),this._announce(t)}_announce(t){this._trackers.forEach(i=>{i.announce(t)})}scrape(t){Ss("send `scrape`"),t||(t={}),this._trackers.forEach(i=>{i.scrape(t)})}setInterval(t){Ss("setInterval %d",t),this._trackers.forEach(i=>{i.setInterval(t)})}destroy(t){if(this.destroyed)return;this.destroyed=!0,Ss("destroy");let i=this._trackers.map(s=>n=>{s.destroy(n)});hA(i,t),this._trackers=[],this._getAnnounceOpts=null}_defaultAnnounceOpts(t={}){return t.numwant==null&&(t.numwant=Fd.DEFAULT_ANNOUNCE_PEERS),t.uploaded==null&&(t.uploaded=0),t.downloaded==null&&(t.downloaded=0),this._getAnnounceOpts&&(t=Object.assign({},t,this._getAnnounceOpts())),t}}return r.scrape=(e,t)=>{if(t=oA(t),!e.infoHash)throw new Error("Option `infoHash` is required");if(!e.announce)throw new Error("Option `announce` is required");let i=Object.assign({},e,{infoHash:Array.isArray(e.infoHash)?e.infoHash[0]:e.infoHash,peerId:jf("01234567890123456789"),port:6881}),s=new r(i);s.once("error",t),s.once("warning",t);let n=Array.isArray(e.infoHash)?e.infoHash.length:1,a={};return s.on("scrape",l=>{if(n-=1,a[l.infoHash]=l,n===0){s.destroy();let c=Object.keys(a);c.length===1?t(null,a[c[0]]):t(null,a)}}),s.scrape({infoHash:e.infoHash}),s},r})(),Rh={exports:{}},rv;function BA(){if(rv)return Rh.exports;rv=1;function r(I,R,k,D,x,N,B){var H=I+(R&k|~R&D)+(x>>>0)+B;return(H<<N|H>>>32-N)+R}function e(I,R,k,D,x,N,B){var H=I+(R&D|k&~D)+(x>>>0)+B;return(H<<N|H>>>32-N)+R}function t(I,R,k,D,x,N,B){var H=I+(R^k^D)+(x>>>0)+B;return(H<<N|H>>>32-N)+R}function i(I,R,k,D,x,N,B){var H=I+(k^(R|~D))+(x>>>0)+B;return(H<<N|H>>>32-N)+R}function s(I){return(256+(I&255)).toString(16).substr(-2)}function n(I){return String.fromCharCode(I&255)}function a(I){return n(I)+n(I>>>8)+n(I>>>16)+n(I>>>24)}var l=function(I){return unescape(encodeURIComponent(I))};function c(I){for(var R=I.length,k=R<<3,D=new Uint32Array(R+72>>>6<<4),x=0,N=I.length;x<N;++x)D[x>>>2]|=I.charCodeAt(x)<<((x&3)<<3);return D[R>>2]|=128<<(k&31),D[D.length-2]=k,D}var h=Rh.exports=function(R){return p(R).toHex()},f=h.fromBytes=function(I){for(var R=c(I),k=1732584193,D=4023233417,x=2562383102,N=271733878,B=7,H=12,O=17,P=22,G=5,Q=9,ie=14,te=20,re=4,ne=11,de=16,Z=23,ae=6,se=10,oe=15,Y=21,ee=0,be=R.length;ee<be;ee+=16){var Ee=k,Re=D,Oe=x,Pe=N;k=r(k,D,x,N,R[ee+0],B,3614090360),N=r(N,k,D,x,R[ee+1],H,3905402710),x=r(x,N,k,D,R[ee+2],O,606105819),D=r(D,x,N,k,R[ee+3],P,3250441966),k=r(k,D,x,N,R[ee+4],B,4118548399),N=r(N,k,D,x,R[ee+5],H,1200080426),x=r(x,N,k,D,R[ee+6],O,2821735955),D=r(D,x,N,k,R[ee+7],P,4249261313),k=r(k,D,x,N,R[ee+8],B,1770035416),N=r(N,k,D,x,R[ee+9],H,2336552879),x=r(x,N,k,D,R[ee+10],O,4294925233),D=r(D,x,N,k,R[ee+11],P,2304563134),k=r(k,D,x,N,R[ee+12],B,1804603682),N=r(N,k,D,x,R[ee+13],H,4254626195),x=r(x,N,k,D,R[ee+14],O,2792965006),D=r(D,x,N,k,R[ee+15],P,1236535329),k=e(k,D,x,N,R[ee+1],G,4129170786),N=e(N,k,D,x,R[ee+6],Q,3225465664),x=e(x,N,k,D,R[ee+11],ie,643717713),D=e(D,x,N,k,R[ee+0],te,3921069994),k=e(k,D,x,N,R[ee+5],G,3593408605),N=e(N,k,D,x,R[ee+10],Q,38016083),x=e(x,N,k,D,R[ee+15],ie,3634488961),D=e(D,x,N,k,R[ee+4],te,3889429448),k=e(k,D,x,N,R[ee+9],G,568446438),N=e(N,k,D,x,R[ee+14],Q,3275163606),x=e(x,N,k,D,R[ee+3],ie,4107603335),D=e(D,x,N,k,R[ee+8],te,1163531501),k=e(k,D,x,N,R[ee+13],G,2850285829),N=e(N,k,D,x,R[ee+2],Q,4243563512),x=e(x,N,k,D,R[ee+7],ie,1735328473),D=e(D,x,N,k,R[ee+12],te,2368359562),k=t(k,D,x,N,R[ee+5],re,4294588738),N=t(N,k,D,x,R[ee+8],ne,2272392833),x=t(x,N,k,D,R[ee+11],de,1839030562),D=t(D,x,N,k,R[ee+14],Z,4259657740),k=t(k,D,x,N,R[ee+1],re,2763975236),N=t(N,k,D,x,R[ee+4],ne,1272893353),x=t(x,N,k,D,R[ee+7],de,4139469664),D=t(D,x,N,k,R[ee+10],Z,3200236656),k=t(k,D,x,N,R[ee+13],re,681279174),N=t(N,k,D,x,R[ee+0],ne,3936430074),x=t(x,N,k,D,R[ee+3],de,3572445317),D=t(D,x,N,k,R[ee+6],Z,76029189),k=t(k,D,x,N,R[ee+9],re,3654602809),N=t(N,k,D,x,R[ee+12],ne,3873151461),x=t(x,N,k,D,R[ee+15],de,530742520),D=t(D,x,N,k,R[ee+2],Z,3299628645),k=i(k,D,x,N,R[ee+0],ae,4096336452),N=i(N,k,D,x,R[ee+7],se,1126891415),x=i(x,N,k,D,R[ee+14],oe,2878612391),D=i(D,x,N,k,R[ee+5],Y,4237533241),k=i(k,D,x,N,R[ee+12],ae,1700485571),N=i(N,k,D,x,R[ee+3],se,2399980690),x=i(x,N,k,D,R[ee+10],oe,4293915773),D=i(D,x,N,k,R[ee+1],Y,2240044497),k=i(k,D,x,N,R[ee+8],ae,1873313359),N=i(N,k,D,x,R[ee+15],se,4264355552),x=i(x,N,k,D,R[ee+6],oe,2734768916),D=i(D,x,N,k,R[ee+13],Y,1309151649),k=i(k,D,x,N,R[ee+4],ae,4149444226),N=i(N,k,D,x,R[ee+11],se,3174756917),x=i(x,N,k,D,R[ee+2],oe,718787259),D=i(D,x,N,k,R[ee+9],Y,3951481745),k=k+Ee>>>0,D=D+Re>>>0,x=x+Oe>>>0,N=N+Pe>>>0}var Be=new String(a(k)+a(D)+a(x)+a(N));return Be.toHex=function(){for(var Ve="",Je=0,Ye=Be.length;Je<Ye;++Je)Ve+=s(Be.charCodeAt(Je));return Ve},Be},p=h.fromUtf8=function(I){return f(l(I))},m="./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function _(I,R){for(var k="";--R>=0;I>>>=6)k+=m.charAt(I&63);return k}var E=64,S=[0,6,12,1,7,13,2,8,14,3,9,15,4,10,5,11],C=h.salt=function(I){var R="";I||(I=8);do R+=m.charAt(64*Math.random()>>>0);while(--I);return R};return h.crypt=function(I,R){if(I.length>E)throw Error("too long key");R||(R="$1$"+C()),I=l(I);for(var k=l(R.replace(/^\$1\$([^$]+)(?:\$.*)?$/,"$1")),D=f(I+k+I),x=I+"$1$"+k,N=I.length;N>16;N-=16)x+=D;x+=D.slice(0,N);for(var N=I.length;N;N>>=1)x+=N&1?"\0":I.charAt(0);D=f(x);for(var B=0;B<1e3;++B)D=f((B&1?I:D)+(B%3?k:"")+(B%7?I:"")+(B&1?D:I));for(var H="$1$"+k+"$",B=0;B<15;B+=3)H+=_(D.charCodeAt(S[B+0])<<16|D.charCodeAt(S[B+1])<<8|D.charCodeAt(S[B+2]),4);return H+_(D.charCodeAt(S[15]),2)},Rh.exports}var UA=BA(),$A=gr(UA),HA="2.2.1",jA=`-PM${qA(HA)}-`,nv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",VA=20;function GA(r){let e=$A.fromUtf8(r).slice(1);return btoa(e)}function KA(r){let e=[r],t=VA-r.length;for(let i=0;i<t;i++)e.push(nv[Math.floor(Math.random()*nv.length)]);return e.join("")}function qA(r){let e=r.split(".");return`${e[0].padStart(2,"0")}${e[1].padStart(2,"0")}`}function Fs(r){return`${r.type}-${r.index}`}function av(r){let{externalId:e}=r;return`(${Fs(r.stream)} | ${e})`}function WA(){let r,e;return{promise:new Promise((i,s)=>{r=i,e=s}),resolve:r,reject:e}}function IT(r,e){e===void 0&&(e=r.reduce((s,n)=>s+n.byteLength,0));let t=new Uint8Array(e),i=0;for(let s of r)t.set(s,i),i+=s.byteLength;return t}function zA(r){return r[Math.floor(Math.random()*r.length)]}function ov(r){let e=new TextEncoder,t=new Uint8Array(r.length);return e.encodeInto(r,t),t}function YA(r){let e=new Uint8Array(r.length/2);for(let i=0;i<r.length;i+=2)e[i/2]=parseInt(r.slice(i,i+2),16);return new TextDecoder().decode(e)}function*lv(r){for(let e=r.length-1;e>=0;e--)yield r[e]}function LT(r){return!!r&&typeof r=="object"&&!Array.isArray(r)}function XA(r){return Array.isArray(r)}function QA(r){function e(t){if(LT(t)){let i={};return Object.keys(t).forEach(s=>{if(t[s]!==void 0){let n=e(t[s]);n!==void 0&&(i[s]=n)}}),i}else return t}return e(r)}function Ps(r){if(XA(r))return r.map(e=>Ps(e));if(LT(r)){let e={};for(let t of Object.keys(r))e[t]=Ps(r[t]);return e}else return r}function JA(r){for(let e=r.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r}function kn(r,e,t={}){return typeof r!="object"||r===null||typeof e!="object"||e===null||Object.keys(e).forEach(i=>{if(i==="__proto__"||i==="constructor"||i==="prototype")throw new Error(`Attempt to modify restricted property '${String(i)}'`);let s=e[i],n=t[i];i in r&&(s===void 0?r[i]=n===void 0?void 0:n:r[i]=s)}),r}function Ph(r){let{defaultConfig:e,baseConfig:t={},specificStreamConfig:i={}}=r,s=Ps(Ue(Ue(Ue({},e),t),i)),n=Object.keys(e),a={};return n.forEach(l=>{l in s&&(a[l]=s[l])}),a}var ks=(r=>(r[r.SegmentsAnnouncement=0]="SegmentsAnnouncement",r[r.SegmentRequest=1]="SegmentRequest",r[r.SegmentData=2]="SegmentData",r[r.SegmentDataSendingCompleted=3]="SegmentDataSendingCompleted",r[r.SegmentAbsent=4]="SegmentAbsent",r[r.CancelSegmentRequest=5]="CancelSegmentRequest",r))(ks||{}),Yr=(r=>(r[r.Min=-1]="Min",r[r.Int=0]="Int",r[r.SimilarIntArray=1]="SimilarIntArray",r[r.String=2]="String",r[r.Max=3]="Max",r))(Yr||{});function ZA(r){return r<0?-r:r}function eI(r){let e=r.toString(2),t=r<0?e.length:e.length+1;return Math.ceil(t/8)}function tI(r){let e=r<0,t=eI(r),i=new Uint8Array(t),s=BigInt(t);r=ZA(r);for(let n=0;n<t;n++){let a=8n*(s-1n-BigInt(n)),l=r>>a&0xffn;i[n]=Number(l)}return e&&(i[0]=i[0]|128),i}function iI(r){let e=BigInt(r.length),t=(s,n)=>{let a=8n*(e-1n-BigInt(n));return BigInt(s)<<a},i=t(r[0]&127,0);for(let s=1;s<e;s++)i=t(r[s],s)|i;return(r[0]&128)>>7!==0&&(i=-i),i}function kT(r){let e=tI(r),t=0|e.length;return new Uint8Array([t,...e])}function RT(r){let e=r[0];if(e>>4!==0)throw new Error("Trying to deserialize integer with invalid serialized item code");let i=e&15,s=1,n=s+i;return{number:iI(r.slice(s,n)),byteLength:i+1}}function sI(r){let e=new Map;for(let i of r){let s=i&~0xffn,n=i&0xffn,a=e.get(s)??new dr;a.length||e.set(s,a),a.push(Number(n))}let t=new dr;t.push([16,e.size]);for(let[i,s]of e){let{length:n}=s.getBytesChunks(),a=i|BigInt(n)&0xffn;s.unshift(kT(a)),t.push(s.getBuffer())}return t.getBuffer()}function rI(r){let[e,t]=r;if(e>>4!==1)throw new Error("Trying to deserialize similar int array with invalid serialized item code");let s=2,n=[];for(let a=0;a<t;a++){let{number:l,byteLength:c}=RT(r.slice(s));s+=c;let h=l&0xffn,f=l&~0xffn;for(let p=0;p<h;p++){let m=BigInt(r[s]);n.push(f|m),s++}}return{numbers:n,byteLength:s}}function nI(r){let{length:e}=r,t=new dr;return t.push([32|e>>8&15,e&255]),t.push(new TextEncoder().encode(r)),t.getBuffer()}function aI(r){let[e,t]=r;if(e>>4!==2)throw new Error("Trying to deserialize bytes (sting) with invalid serialized item code.");let s=(e&15)<<8|t,n=r.slice(2,s+2);return{string:new TextDecoder("utf8").decode(n),byteLength:s+2}}var dr=class{constructor(){ue(this,"bytes",[]),ue(this,"_length",0)}push(e){this.addBytes(e,"end")}unshift(e){this.addBytes(e,"start")}addBytes(e,t){let i;e instanceof Uint8Array?i=e:Array.isArray(e)?i=new Uint8Array(e):i=new Uint8Array([e]),this._length+=i.length,this.bytes[t==="start"?"unshift":"push"](i)}getBytesChunks(){return this.bytes}getBuffer(){return IT(this.bytes,this._length)}get length(){return this._length}},Yi=4,sn=Ul("cstr",Yi),ua=Ul("cend",Yi),Bd=Ul("dstr",Yi),Ud=Ul("dend",Yi),oI=[sn,Bd],lI=[ua,Ud],uv=sn.length+ua.length;function PT(r){let{length:e}=sn,t=r.slice(-e);return oI.some(i=>El(r,i,Yi))&&lI.some(i=>El(t,i,Yi))}function uI(r){return El(r,sn,Yi)}function hI(r){return El(r.slice(-4),ua,Yi)}var rn=class extends Error{constructor(e){super(),this.type=e}},_l=class{constructor(e){ue(this,"chunks",new dr),ue(this,"status","joining"),this.onComplete=e}addCommandChunk(e){if(this.status==="completed")return;let t=uI(e);if(!this.chunks.length&&!t)throw new rn("no-first-chunk");if(this.chunks.length&&t)throw new rn("incomplete-joining");this.chunks.push(this.unframeCommandChunk(e)),hI(e)&&(this.status="completed",this.onComplete(this.chunks.getBuffer()))}unframeCommandChunk(e){return e.slice(Yi,e.length-Yi)}},nn=class{constructor(e,t){ue(this,"bytes",new dr),ue(this,"resultBuffers",[]),ue(this,"status","creating"),this.maxChunkLength=t,this.bytes.push(e)}addInteger(e,t){this.bytes.push(e.charCodeAt(0));let i=kT(BigInt(t));this.bytes.push(i)}addSimilarIntArr(e,t){this.bytes.push(e.charCodeAt(0));let i=sI(t.map(s=>BigInt(s)));this.bytes.push(i)}addString(e,t){this.bytes.push(e.charCodeAt(0));let i=nI(t);this.bytes.push(i)}complete(){if(!this.bytes.length)throw new Error("Buffer is empty");if(this.status==="completed")return;this.status="completed";let e=this.bytes.getBuffer();if(e.length+uv<=this.maxChunkLength){this.resultBuffers.push(fo(e,sn,ua));return}let t=Math.ceil(e.length/this.maxChunkLength);Math.ceil(e.length/t)+uv>this.maxChunkLength&&t++;for(let[i,s]of dI(e,t))i===0?this.resultBuffers.push(fo(s,sn,Ud)):i===t-1?this.resultBuffers.push(fo(s,Bd,ua)):this.resultBuffers.push(fo(s,Bd,Ud))}getResultBuffers(){if(this.status==="creating"||!this.resultBuffers.length)throw new Error("Command is not complete.");return this.resultBuffers}};function DT(r){let[e]=r,t={c:e},i=1;for(;i<r.length;){let s=String.fromCharCode(r[i]);switch(i++,cI(r[i])){case Yr.Int:{let{number:a,byteLength:l}=RT(r.slice(i));t[s]=Number(a),i+=l}break;case Yr.SimilarIntArray:{let{numbers:a,byteLength:l}=rI(r.slice(i));t[s]=a.map(c=>Number(c)),i+=l}break;case Yr.String:{let{string:a,byteLength:l}=aI(r.slice(i));t[s]=a,i+=l}break}}return t}function cI(r){let e=r>>4;if(e<=Yr.Min||e>=Yr.Max)throw new Error("Not existing type");return e}function Ul(r,e){if(r.length!==e)throw new Error("Wrong string length");let t=new Uint8Array(e);for(let i=0;i<r.length;i++)t[i]=r.charCodeAt(i);return t}function*dI(r,e){let t=Math.ceil(r.length/e);for(let i=0;i<e;i++)yield[i,r.slice(i*t,(i+1)*t)]}function fo(r,e,t){let i=new Uint8Array(r.length+e.length+t.length);return i.set(e),i.set(r,e.length),i.set(t,e.length+r.length),i}function El(r,e,t){for(let i=0;i<t;i++)if(r[i]!==e[i])return!1;return!0}function fI(r,e){let{c:t,p:i,l:s}=r,n=new nn(t,e);return s?.length&&n.addSimilarIntArr("l",s),i?.length&&n.addSimilarIntArr("p",i),n.complete(),n.getResultBuffers()}function pI(r,e){let t=new nn(r.c,e);return t.addInteger("i",r.i),t.addInteger("r",r.r),t.complete(),t.getResultBuffers()}function gI(r,e){let t=new nn(r.c,e);return t.addInteger("i",r.i),t.addInteger("s",r.s),t.addInteger("r",r.r),t.complete(),t.getResultBuffers()}function mI(r,e){let t=new nn(r.c,e);return t.addInteger("i",r.i),t.addInteger("r",r.r),r.b&&t.addInteger("b",r.b),t.complete(),t.getResultBuffers()}function xT(r,e){switch(r.c){case ks.CancelSegmentRequest:case ks.SegmentAbsent:case ks.SegmentDataSendingCompleted:return pI(r,e);case ks.SegmentRequest:return mI(r,e);case ks.SegmentsAnnouncement:return fI(r,e);case ks.SegmentData:return gI(r,e)}}var vI=Object.freeze(Object.defineProperty({__proto__:null,BinaryCommandChunksJoiner:_l,BinaryCommandJoiningError:rn,PeerCommandType:ks,deserializeCommand:DT,isCommandChunk:PT,serializePeerCommand:xT},Symbol.toStringTag,{value:"Module"})),$d=class{constructor(e,t,i,s){ue(this,"commandChunks"),ue(this,"uploadingContext"),ue(this,"onChunkDownloaded"),ue(this,"onChunkUploaded"),ue(this,"onDataReceived",n=>{PT(n)?this.receivingCommandBytes(n):(this.eventHandlers.onSegmentChunkReceived(n),this.onChunkDownloaded(n.byteLength,"p2p",this.connection.idUtf8))}),this.connection=e,this.peerConfig=t,this.eventHandlers=i,this.onChunkDownloaded=s.getEventDispatcher("onChunkDownloaded"),this.onChunkUploaded=s.getEventDispatcher("onChunkUploaded"),e.on("data",this.onDataReceived)}sendCommand(e){let t=xT(e,this.peerConfig.webRtcMaxMessageSize);for(let i of t)this.connection.write(i)}stopUploadingSegmentData(){var e;(e=this.uploadingContext)==null||e.stopUploading(),this.uploadingContext=void 0}getUploadingRequestId(){var e;return(e=this.uploadingContext)==null?void 0:e.requestId}splitSegmentDataToChunksAndUploadAsync(e,t){return mt(this,null,function*(){if(this.uploadingContext)throw new Error("Some segment data is already uploading.");let i=yI(e,this.peerConfig.webRtcMaxMessageSize),{promise:s,resolve:n,reject:a}=WA(),l=!1,c={stopUploading:()=>{l=!1},requestId:t};this.uploadingContext=c;let h=()=>{if(!l){a();return}for(;;){let f=i.next().value;if(!f){n();break}let p=this.connection.write(f);if(this.onChunkUploaded(f.byteLength,this.connection.idUtf8),!p)break}};try{this.connection.on("drain",h),l=!0,h(),yield s}finally{this.connection.off("drain",h),this.uploadingContext===c&&(this.uploadingContext=void 0)}})}receivingCommandBytes(e){this.commandChunks||(this.commandChunks=new _l(t=>{this.commandChunks=void 0;let i=DT(t);this.eventHandlers.onCommandReceived(i)}));try{this.commandChunks.addCommandChunk(e)}catch(t){if(!(t instanceof rn))return;this.commandChunks=void 0}}};function*yI(r,e){let t=r.byteLength;for(;t>0;){let i=t>=e?e:t,s=r.byteLength-t,n=r.slice(s,s+i);t-=i,yield n}}var{PeerCommandType:fi}=vI,bl=class r{constructor(e,t,i,s,n){ue(this,"id"),ue(this,"peerProtocol"),ue(this,"downloadingContext"),ue(this,"loadedSegments",new Set),ue(this,"httpLoadingSegments",new Set),ue(this,"downloadingErrors",[]),ue(this,"logger",Xi("p2pml-core:peer")),ue(this,"onPeerClosed"),ue(this,"onCommandReceived",a=>mt(this,null,function*(){var l,c,h;switch(a.c){case fi.SegmentsAnnouncement:this.loadedSegments=new Set(a.l),this.httpLoadingSegments=new Set(a.p),this.eventHandlers.onSegmentsAnnouncement();break;case fi.SegmentRequest:this.peerProtocol.stopUploadingSegmentData(),this.eventHandlers.onSegmentRequested(this,a.i,a.r,a.b);break;case fi.SegmentData:{if(!this.downloadingContext||this.downloadingContext.isSegmentDataCommandReceived)break;let{request:f,controls:p,requestId:m}=this.downloadingContext;if(f.segment.externalId!==a.i||m!==a.r)break;this.downloadingContext.isSegmentDataCommandReceived=!0,p.firstBytesReceived(),f.totalBytes===void 0?f.setTotalBytes(a.s):f.totalBytes-f.loadedBytes!==a.s&&(f.clearLoadedBytes(),this.sendCancelSegmentRequestCommand(f.segment,m),this.cancelSegmentDownloading("peer-response-bytes-length-mismatch"),this.destroy())}break;case fi.SegmentDataSendingCompleted:{let{downloadingContext:f}=this;if(!f?.isSegmentDataCommandReceived)return;let{request:p,controls:m}=f;if(f.request.segment.externalId!==a.i||f.requestId!==a.r){p.clearLoadedBytes(),this.cancelSegmentDownloading("peer-protocol-violation"),this.destroy();return}if(p.loadedBytes!==p.totalBytes){p.clearLoadedBytes(),this.cancelSegmentDownloading("peer-response-bytes-length-mismatch"),this.destroy();return}let S=(yield(c=(l=this.peerConfig).validateP2PSegment)==null?void 0:c.call(l,p.segment.url,p.segment.byteRange,p.data))??!0;if(this.downloadingContext!==f)return;if(!S){p.clearLoadedBytes(),this.cancelSegmentDownloading("p2p-segment-validation-failed"),this.destroy();return}this.downloadingErrors=[],m.completeOnSuccess(),this.downloadingContext=void 0;break}case fi.SegmentAbsent:((h=this.downloadingContext)==null?void 0:h.request.segment.externalId)===a.i&&this.downloadingContext.requestId===a.r&&(this.cancelSegmentDownloading("peer-segment-absent"),this.loadedSegments.delete(a.i));break;case fi.CancelSegmentRequest:{if(this.peerProtocol.getUploadingRequestId()!==a.r)break;this.peerProtocol.stopUploadingSegmentData();break}}})),ue(this,"onSegmentChunkReceived",a=>{var l;if(!((l=this.downloadingContext)!=null&&l.isSegmentDataCommandReceived))return;let{request:c,controls:h}=this.downloadingContext;if(c.totalBytes!==void 0&&c.loadedBytes+a.byteLength>c.totalBytes){c.clearLoadedBytes(),this.cancelSegmentDownloading("peer-response-bytes-length-mismatch"),this.destroy();return}h.addLoadedChunk(a)}),ue(this,"onPeerConnectionClosed",()=>{this.destroy()}),ue(this,"onConnectionError",a=>{this.logger(`peer connection error ${this.id} %O`,a),this.eventTarget.getEventDispatcher("onPeerError")({peerId:this.id,streamType:this.streamType,error:a});let{code:l}=a;l==="ERR_DATA_CHANNEL"?this.destroy():l==="ERR_CONNECTION_FAILURE"&&this.destroy()}),ue(this,"destroy",()=>{this.cancelSegmentDownloading("peer-closed"),this.connection.destroy(),this.eventHandlers.onPeerClosed(this),this.onPeerClosed({peerId:this.id,streamType:this.streamType}),this.logger(`peer closed ${this.id}`)}),this.connection=e,this.eventHandlers=t,this.peerConfig=i,this.streamType=s,this.eventTarget=n,this.onPeerClosed=n.getEventDispatcher("onPeerClose"),this.id=r.getPeerIdFromConnection(e),this.peerProtocol=new $d(e,i,{onSegmentChunkReceived:this.onSegmentChunkReceived,onCommandReceived:this.onCommandReceived},n),n.getEventDispatcher("onPeerConnect")({peerId:this.id,streamType:s}),e.on("error",this.onConnectionError),e.on("close",this.onPeerConnectionClosed),e.on("end",this.onPeerConnectionClosed),e.on("finish",this.onPeerConnectionClosed)}get downloadingSegment(){var e;return(e=this.downloadingContext)==null?void 0:e.request.segment}getSegmentStatus(e){let{externalId:t}=e;if(this.loadedSegments.has(t))return"loaded";if(this.httpLoadingSegments.has(t))return"http-loading"}downloadSegment(e){if(this.downloadingContext)throw new Error("Some segment already is downloading");this.downloadingContext={request:e,requestId:Math.floor(Math.random()*1e3),isSegmentDataCommandReceived:!1,controls:e.start({downloadSource:"p2p",peerId:this.id},{notReceivingBytesTimeoutMs:this.peerConfig.p2pNotReceivingBytesTimeoutMs,abort:i=>{if(!this.downloadingContext)return;let{request:s,requestId:n}=this.downloadingContext;this.sendCancelSegmentRequestCommand(s.segment,n),this.downloadingErrors.push(i),this.downloadingContext=void 0,this.downloadingErrors.filter(l=>l.type==="bytes-receiving-timeout").length>=this.peerConfig.p2pErrorRetries&&this.destroy()}})};let t={c:fi.SegmentRequest,r:this.downloadingContext.requestId,i:e.segment.externalId};e.loadedBytes&&(t.b=e.loadedBytes),this.peerProtocol.sendCommand(t)}uploadSegmentData(e,t,i){return mt(this,null,function*(){let{externalId:s}=e;this.logger(`send segment ${e.externalId} to ${this.id}`);let n={c:fi.SegmentData,i:s,r:t,s:i.byteLength};this.peerProtocol.sendCommand(n);try{yield this.peerProtocol.splitSegmentDataToChunksAndUploadAsync(i,t),this.sendSegmentDataSendingCompletedCommand(e,t),this.logger(`segment ${s} has been sent to ${this.id}`)}catch{this.logger(`cancel segment uploading ${s}`)}})}cancelSegmentDownloading(e){if(!this.downloadingContext)return;let{request:t,controls:i}=this.downloadingContext,{segment:s}=t;this.logger(`cancel segment request ${s.externalId} (${e})`);let n=new Zt(e);i.abortOnError(n),this.downloadingContext=void 0,this.downloadingErrors.push(n)}sendSegmentsAnnouncementCommand(e,t){let i={c:fi.SegmentsAnnouncement,p:t,l:e};this.peerProtocol.sendCommand(i)}sendSegmentAbsentCommand(e,t){this.peerProtocol.sendCommand({c:fi.SegmentAbsent,i:e,r:t})}sendCancelSegmentRequestCommand(e,t){this.peerProtocol.sendCommand({c:fi.CancelSegmentRequest,i:e.externalId,r:t})}sendSegmentDataSendingCompletedCommand(e,t){this.peerProtocol.sendCommand({c:fi.SegmentDataSendingCompleted,r:t,i:e.externalId})}static getPeerIdFromConnection(e){return YA(e.id)}};function TI(){let r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),e=/\b(iPad|iPhone|Macintosh).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return r||e}var OT=class xo{constructor(e,t,i,s,n){ue(this,"streamShortId"),ue(this,"client"),ue(this,"_peers",new Map),ue(this,"logger",Xi("p2pml-core:p2p-tracker-client")),ue(this,"onReceivePeerConnection",c=>{let h=bl.getPeerIdFromConnection(c),f=this._peers.get(h);if(f?.peer){c.destroy();return}f||(f={potentialConnections:new Set},c.idUtf8=h,this._peers.set(h,f)),f.potentialConnections.add(c),c.on("connect",()=>{if(!f.peer){for(let p of f.potentialConnections)p!==c&&p.destroy();f.potentialConnections.clear(),f.peer=new bl(c,{onPeerClosed:this.onPeerClosed,onSegmentRequested:this.eventHandlers.onSegmentRequested,onSegmentsAnnouncement:this.eventHandlers.onSegmentsAnnouncement},this.config,this.stream.type,this.eventTarget),this.logger(`connected with peer: ${f.peer.id} ${this.streamShortId}`),this.eventHandlers.onPeerConnected(f.peer)}})}),ue(this,"onTrackerClientWarning",c=>{this.logger("tracker warning %s:",this.streamShortId,c),this.eventTarget.getEventDispatcher("onTrackerWarning")({streamType:this.stream.type,warning:c})}),ue(this,"onTrackerClientError",c=>{this.logger("tracker error in stream %s:",this.streamShortId,c),this.eventTarget.getEventDispatcher("onTrackerError")({streamType:this.stream.type,error:c})}),ue(this,"onPeerClosed",c=>{this.logger(`peer closed: ${c.id}`),this._peers.delete(c.id)}),this.stream=t,this.eventHandlers=i,this.config=s,this.eventTarget=n;let a=GA(e);this.streamShortId=Fs(t);let l=xo.PEER_ID_BY_INFO_HASH.get(a);l||(l=KA(s.trackerClientVersionPrefix),xo.PEER_ID_BY_INFO_HASH.set(a,l)),this.client=new NA({infoHash:ov(a),peerId:ov(l),announce:TI()?s.announceTrackers.slice(0,1):s.announceTrackers,rtcConfig:this.config.rtcConfig}),this.client.on("peer",this.onReceivePeerConnection),this.client.on("warning",this.onTrackerClientWarning),this.client.on("error",this.onTrackerClientError),this.logger(`create new client; 
stream: ${this.streamShortId}; hash: ${a}
peerId: ${l}`)}start(){this.client.start()}destroy(){this.client.destroy();for(let{peer:e,potentialConnections:t}of this._peers.values()){e?.destroy();for(let i of t)i.destroy()}this._peers.clear(),this.logger("destroy client; stream:",this.streamShortId)}*peers(){for(let e of this._peers.values())e.peer&&(yield e.peer)}static clearPeerIdCache(){xo.PEER_ID_BY_INFO_HASH.clear()}};ue(OT,"PEER_ID_BY_INFO_HASH",new Map);var MT=OT,_I="v2";function os(r,e){return`${_I}-${r}-${bI(e)}`}function hv(r,e){for(let t of r.values()){let i=t.segments.get(e);if(i)return i}}function EI(r,e){for(let t of r.segments.values())if(t.externalId===e)return t}function bI(r){return`${r.type}-${r.index}`}function SI(r){let{segments:e}=r,t=0,{size:i}=e;for(let s of e.values()){let n=s.endTime-s.startTime;t+=n}return t/i}function CI(r,e){let{highDemandTimeWindow:t,httpDownloadTimeWindow:i,p2pDownloadTimeWindow:s}=r,n={highDemandTimeWindow:t,httpDownloadTimeWindow:i,p2pDownloadTimeWindow:s};return e<=5?(n.httpDownloadTimeWindow=0,n.p2pDownloadTimeWindow=0):e<=10&&(n.p2pDownloadTimeWindow=n.httpDownloadTimeWindow),n}function Dh(r,e,t,i,s){let{highDemandTimeWindow:n,httpDownloadTimeWindow:a,p2pDownloadTimeWindow:l}=CI(t,s);return{isHighDemand:xh(r,e,n),isHttpDownloadable:xh(r,e,a),isP2PDownloadable:xh(r,e,l)&&i.isSegmentLoadingOrLoadedBySomeone(r)}}function xh(r,e,t){let{startTime:i,endTime:s}=r,{position:n,rate:a}=e;return!(n+t*a<i||n>s)}var Hd=class{constructor(e,t,i,s,n,a,l){ue(this,"trackerClient"),ue(this,"isAnnounceMicrotaskCreated",!1),ue(this,"onPeerConnected",f=>{if(this.config.isP2PUploadDisabled)return;let{httpLoading:p,loaded:m}=this.getSegmentsAnnouncement();f.sendSegmentsAnnouncementCommand(m,p)}),ue(this,"broadcastAnnouncement",(f=!1)=>{if(f){this.sendSegmentsAnnouncement([],[]);return}if(this.isAnnounceMicrotaskCreated||this.config.isP2PUploadDisabled)return;let{loaded:p,httpLoading:m}=this.getSegmentsAnnouncement();this.sendSegmentsAnnouncement(p,m)}),ue(this,"sendSegmentsAnnouncement",(f,p)=>{this.isAnnounceMicrotaskCreated=!0,queueMicrotask(()=>{for(let m of this.trackerClient.peers())m.sendSegmentsAnnouncementCommand(f,p);this.isAnnounceMicrotaskCreated=!1})}),ue(this,"onSegmentRequested",(f,p,m,_)=>mt(this,null,function*(){let E=EI(this.stream,p);if(!E)return;if(this.config.isP2PUploadDisabled){f.sendSegmentAbsentCommand(p,m);return}let S=this.config.swarmId??this.streamManifestUrl,C=os(S,this.stream),I=yield this.segmentStorage.getSegmentData(S,C,E.externalId);if(!I){f.sendSegmentAbsentCommand(p,m);return}yield f.uploadSegmentData(E,m,_!==void 0?I.slice(_):I)})),this.streamManifestUrl=e,this.stream=t,this.requests=i,this.segmentStorage=s,this.config=n,this.eventTarget=a,this.onSegmentAnnouncement=l;let c=this.config.swarmId??this.streamManifestUrl,h=os(c,this.stream);this.trackerClient=new MT(h,this.stream,{onPeerConnected:this.onPeerConnected,onSegmentRequested:this.onSegmentRequested,onSegmentsAnnouncement:this.onSegmentAnnouncement},this.config,this.eventTarget),this.eventTarget.addEventListener(`onStorageUpdated-${h}`,this.broadcastAnnouncement),this.segmentStorage.setSegmentChangeCallback(f=>{this.eventTarget.dispatchEvent(`onStorageUpdated-${f}`)}),this.trackerClient.start()}downloadSegment(e){let t=[];for(let n of this.trackerClient.peers())!n.downloadingSegment&&n.getSegmentStatus(e)==="loaded"&&t.push(n);if(t.length===0)return;let i=zA(t),s=this.requests.getOrCreateRequest(e);i.downloadSegment(s)}isSegmentLoadingOrLoadedBySomeone(e){for(let t of this.trackerClient.peers())if(t.getSegmentStatus(e))return!0;return!1}isSegmentLoadedBySomeone(e){for(let t of this.trackerClient.peers())if(t.getSegmentStatus(e)==="loaded")return!0;return!1}get connectedPeerCount(){let e=0,t=this.trackerClient.peers();for(;!t.next().done;)e++;return e}getSegmentsAnnouncement(){let e=this.config.swarmId??this.streamManifestUrl,t=os(e,this.stream),i=this.segmentStorage.getStoredSegmentIds(e,t),s=[];for(let n of this.requests.httpRequests()){let a=this.stream.segments.get(n.segment.runtimeId);a&&s.push(a.externalId)}return{loaded:i,httpLoading:s}}destroy(){let e=this.config.swarmId??this.streamManifestUrl,t=os(e,this.stream);this.eventTarget.removeEventListener(`onStorageUpdated-${t}`,this.broadcastAnnouncement),this.trackerClient.destroy()}},jd=class{constructor(e,t,i,s,n,a,l){ue(this,"loaders",new Map),ue(this,"_currentLoaderItem"),ue(this,"logger",Xi("p2pml-core:p2p-loaders-container")),this.streamManifestUrl=e,this.requests=i,this.segmentStorage=s,this.config=n,this.eventTarget=a,this.onSegmentAnnouncement=l,this._currentLoaderItem=this.findOrCreateLoaderForStream(t),this.logger(`set current p2p loader: ${Fs(t)}`)}createLoader(e){if(this.loaders.has(e.runtimeId))throw new Error("Loader for this stream already exists");let t=new Hd(this.streamManifestUrl,e,this.requests,this.segmentStorage,this.config,this.eventTarget,()=>{this._currentLoaderItem.loader===t&&this.onSegmentAnnouncement()}),i=Fs(e);return this.logger(`created new loader: ${i}`),{loader:t,stream:e,loggerInfo:Fs(e)}}findOrCreateLoaderForStream(e){let t=this.loaders.get(e.runtimeId);if(t)return clearTimeout(t.destroyTimeoutId),t.destroyTimeoutId=void 0,t;{let i=this.createLoader(e);return this.loaders.set(e.runtimeId,i),i}}changeCurrentLoader(e){let t=this.config.swarmId??this.streamManifestUrl,i=os(t,this._currentLoaderItem.stream);this.segmentStorage.getStoredSegmentIds(t,i).length?this.setLoaderDestroyTimeout(this._currentLoaderItem):this.destroyAndRemoveLoader(this._currentLoaderItem),this._currentLoaderItem=this.findOrCreateLoaderForStream(e),this.logger(`change current p2p loader: ${Fs(e)}`)}setLoaderDestroyTimeout(e){e.destroyTimeoutId=window.setTimeout(()=>this.destroyAndRemoveLoader(e),this.config.p2pInactiveLoaderDestroyTimeoutMs)}destroyAndRemoveLoader(e){e.loader.destroy(),this.loaders.delete(e.stream.runtimeId),this.logger("destroy p2p loader: ",e.loggerInfo)}get currentLoader(){return this._currentLoaderItem.loader}destroy(){for(let{loader:e,destroyTimeoutId:t}of this.loaders.values())e.destroy(),clearTimeout(t);this.loaders.clear()}};function po(r){return{runtimeId:r.runtimeId,externalId:r.externalId,url:r.url,byteRange:r.byteRange,startTime:r.startTime,endTime:r.endTime}}var wI=class{constructor(e,t,i,s,n,a){ue(this,"currentAttempt"),ue(this,"_failedAttempts",new Vd),ue(this,"finalData"),ue(this,"bytes",[]),ue(this,"_loadedBytes",0),ue(this,"_totalBytes"),ue(this,"_status","not-started"),ue(this,"progress"),ue(this,"notReceivingBytesTimeout"),ue(this,"_abortRequestCallback"),ue(this,"_logger"),ue(this,"_isHandledByProcessQueue",!1),ue(this,"onSegmentError"),ue(this,"onSegmentAbort"),ue(this,"onSegmentStart"),ue(this,"onSegmentLoaded"),ue(this,"abortOnTimeout",()=>{var h;if(this.throwErrorIfNotLoadingStatus(),!this.currentAttempt)return;this.setStatus("failed");let f=new Zt("bytes-receiving-timeout");(h=this._abortRequestCallback)==null||h.call(this,f),this.logger(`${this.downloadSource} ${this.segment.externalId} failed ${f.type}`),this._failedAttempts.add(ht(Ue({},this.currentAttempt),{error:f})),this.onSegmentError({segment:po(this.segment),error:f,downloadSource:this.currentAttempt.downloadSource,peerId:this.currentAttempt.downloadSource==="p2p"?this.currentAttempt.peerId:void 0,streamType:this.segment.stream.type}),this.notReceivingBytesTimeout.clear(),this.manageBandwidthCalculatorsState("stop"),this.requestProcessQueueCallback()}),ue(this,"abortOnError",h=>{this.throwErrorIfNotLoadingStatus(),this.currentAttempt&&(this.setStatus("failed"),this.logger(`${this.downloadSource} ${this.segment.externalId} failed ${h.type}`),this._failedAttempts.add(ht(Ue({},this.currentAttempt),{error:h})),this.onSegmentError({segment:po(this.segment),error:h,downloadSource:this.currentAttempt.downloadSource,peerId:this.currentAttempt.downloadSource==="p2p"?this.currentAttempt.peerId:void 0,streamType:this.segment.stream.type}),this.notReceivingBytesTimeout.clear(),this.manageBandwidthCalculatorsState("stop"),this.requestProcessQueueCallback())}),ue(this,"completeOnSuccess",()=>{this.throwErrorIfNotLoadingStatus(),this.currentAttempt&&(this.manageBandwidthCalculatorsState("stop"),this.notReceivingBytesTimeout.clear(),this.setStatus("succeed"),this._totalBytes=this._loadedBytes,this.onSegmentLoaded({segmentUrl:this.segment.url,bytesLength:this.data.byteLength,downloadSource:this.currentAttempt.downloadSource,peerId:this.currentAttempt.downloadSource==="p2p"?this.currentAttempt.peerId:void 0,streamType:this.segment.stream.type}),this.logger(`${this.currentAttempt.downloadSource} ${this.segment.externalId} succeed`),this.requestProcessQueueCallback())}),ue(this,"addLoadedChunk",h=>{if(this.throwErrorIfNotLoadingStatus(),!this.currentAttempt||!this.progress)return;this.notReceivingBytesTimeout.restart();let{byteLength:f}=h,{all:p,http:m}=this.bandwidthCalculators;p.addBytes(f),this.currentAttempt.downloadSource==="http"&&m.addBytes(f),this.bytes.push(h),this.progress.lastLoadedChunkTimestamp=performance.now(),this.progress.loadedBytes+=f,this._loadedBytes+=f}),ue(this,"firstBytesReceived",()=>{this.throwErrorIfNotLoadingStatus(),this.notReceivingBytesTimeout.restart()}),this.segment=e,this.requestProcessQueueCallback=t,this.bandwidthCalculators=i,this.playback=s,this.playbackConfig=n,this.onSegmentError=a.getEventDispatcher("onSegmentError"),this.onSegmentAbort=a.getEventDispatcher("onSegmentAbort"),this.onSegmentStart=a.getEventDispatcher("onSegmentStart"),this.onSegmentLoaded=a.getEventDispatcher("onSegmentLoaded");let{byteRange:l}=this.segment;if(l){let{end:h,start:f}=l;this._totalBytes=h-f+1}this.notReceivingBytesTimeout=new Gd(this.abortOnTimeout);let{type:c}=this.segment.stream;this._logger=Xi(`p2pml-core:request-${c}`)}clearLoadedBytes(){this._loadedBytes=0,this.bytes=[],this._totalBytes=void 0,this.finalData=void 0}get status(){return this._status}setStatus(e){this._status=e,this._isHandledByProcessQueue=!1}get downloadSource(){var e;return(e=this.currentAttempt)==null?void 0:e.downloadSource}get loadedBytes(){return this._loadedBytes}get totalBytes(){return this._totalBytes}get data(){return this.finalData||(this.finalData=IT(this.bytes)),this.finalData}get failedAttempts(){return this._failedAttempts}get isHandledByProcessQueue(){return this._isHandledByProcessQueue}markHandledByProcessQueue(){this._isHandledByProcessQueue=!0}setTotalBytes(e){if(this._totalBytes!==void 0)throw new Error("Request total bytes value is already set");this._totalBytes=e}start(e,t){if(this._status==="succeed")throw new Error(`Request ${this.segment.externalId} has been already succeed.`);if(this._status==="loading")throw new Error(`Request ${this.segment.externalId} has been already started.`);this.setStatus("loading"),this.currentAttempt=Ue({},e),this.progress={startFromByte:this._loadedBytes,loadedBytes:0,startTimestamp:performance.now()},this.manageBandwidthCalculatorsState("start");let{notReceivingBytesTimeoutMs:i,abort:s}=t;return this._abortRequestCallback=s,i!==void 0&&this.notReceivingBytesTimeout.start(i),this.logger(`${e.downloadSource} ${this.segment.externalId} started`),this.onSegmentStart({segment:po(this.segment),downloadSource:e.downloadSource,peerId:e.downloadSource==="p2p"?e.peerId:void 0}),{firstBytesReceived:this.firstBytesReceived,addLoadedChunk:this.addLoadedChunk,completeOnSuccess:this.completeOnSuccess,abortOnError:this.abortOnError}}abortFromProcessQueue(){var e,t,i,s;this.throwErrorIfNotLoadingStatus(),this.setStatus("aborted"),this.logger(`${(e=this.currentAttempt)==null?void 0:e.downloadSource} ${this.segment.externalId} aborted`),(t=this._abortRequestCallback)==null||t.call(this,new Zt("abort")),this.onSegmentAbort({segment:po(this.segment),downloadSource:(i=this.currentAttempt)==null?void 0:i.downloadSource,peerId:((s=this.currentAttempt)==null?void 0:s.downloadSource)==="p2p"?this.currentAttempt.peerId:void 0,streamType:this.segment.stream.type}),this._abortRequestCallback=void 0,this.manageBandwidthCalculatorsState("stop"),this.notReceivingBytesTimeout.clear()}throwErrorIfNotLoadingStatus(){if(this._status!=="loading")throw new Error(`Request has been already ${this.status}.`)}logger(e){var t;this._logger.color=((t=this.currentAttempt)==null?void 0:t.downloadSource)==="http"?"green":"red",this._logger(e),this._logger.color=""}manageBandwidthCalculatorsState(e){var t;let{all:i,http:s}=this.bandwidthCalculators,n=e==="start"?"startLoading":"stopLoading";((t=this.currentAttempt)==null?void 0:t.downloadSource)==="http"&&s[n](),i[n]()}},Vd=class{constructor(){ue(this,"attempts",[])}add(e){this.attempts.push(e)}get httpAttemptsCount(){return this.attempts.reduce((e,t)=>t.downloadSource==="http"?e+1:e,0)}get lastAttempt(){return this.attempts[this.attempts.length-1]}clear(){this.attempts=[]}},Gd=class{constructor(e){ue(this,"timeoutId"),ue(this,"ms"),this.action=e}start(e){if(this.timeoutId)throw new Error("Timeout is already started.");this.ms=e,this.timeoutId=window.setTimeout(this.action,this.ms)}restart(e){this.timeoutId&&clearTimeout(this.timeoutId),e&&(this.ms=e),this.ms&&(this.timeoutId=window.setTimeout(this.action,this.ms))}clear(){clearTimeout(this.timeoutId),this.timeoutId=void 0}},Kd=class{constructor(e,t,i,s,n){ue(this,"requests",new Map),this.requestProcessQueueCallback=e,this.bandwidthCalculators=t,this.playback=i,this.config=s,this.eventTarget=n}get executingHttpCount(){let e=0;for(let t of this.httpRequests())t.status==="loading"&&e++;return e}get executingP2PCount(){let e=0;for(let t of this.p2pRequests())t.status==="loading"&&e++;return e}get(e){return this.requests.get(e)}getOrCreateRequest(e){let t=this.requests.get(e);return t||(t=new wI(e,this.requestProcessQueueCallback,this.bandwidthCalculators,this.playback,this.config,this.eventTarget),this.requests.set(e,t)),t}remove(e){this.requests.delete(e.segment)}items(){return this.requests.values()}*httpRequests(){for(let e of this.requests.values())e.downloadSource==="http"&&(yield e)}*p2pRequests(){for(let e of this.requests.values())e.downloadSource==="p2p"&&(yield e)}destroy(){for(let e of this.requests.values())e.status==="loading"&&e.abortFromProcessQueue();this.requests.clear()}},qd=class{constructor(e,t){ue(this,"_status","pending"),ue(this,"_shouldBeStartedImmediately",!1),this.segment=e,this.engineCallbacks=t}get status(){return this._status}get shouldBeStartedImmediately(){return this._shouldBeStartedImmediately}resolve(e,t){this._status==="pending"&&(this._status="succeed",this.engineCallbacks.onSuccess({data:e,bandwidth:t}))}reject(){this._status==="pending"&&(this._status="failed",this.engineCallbacks.onError(new en("failed")))}abort(){this._status==="pending"&&(this._status="aborted",this.engineCallbacks.onError(new en("aborted")))}markAsShouldBeStartedImmediately(){this._shouldBeStartedImmediately=!0}};function*cv(r,e,t,i,s){let{runtimeId:n,stream:a}=r,l=a.segments.get(n);if(!l)return;let c=a.segments.values(),h;do{let p=c.next();if(p.done)return;h=p.value}while(h!==l);let f=Dh(h,e,t,i,s);if(Oh(f)){let p=c.next();if(p.done)return;let m=p.value,_=Dh(m,e,t,i,s);if(Oh(_))return;f.isHighDemand=!0,yield{segment:h,statuses:f},yield{segment:m,statuses:_}}else yield{segment:h,statuses:f};for(let p of c){let m=Dh(p,e,t,i,s);if(Oh(m))break;yield{segment:p,statuses:m}}}function Oh(r){let{isHighDemand:e=!1,isHttpDownloadable:t=!1,isP2PDownloadable:i=!1}=r;return!e&&!t&&!i}var AI=6e4,dv=1e3,Wd=class{constructor(e,t,i,s,n,a,l){ue(this,"requests"),ue(this,"engineRequest"),ue(this,"p2pLoaders"),ue(this,"playback"),ue(this,"segmentAvgDuration"),ue(this,"logger"),ue(this,"storageCleanUpIntervalId"),ue(this,"levelChangedTimestamp"),ue(this,"lastQueueProcessingTimeStamp"),ue(this,"randomHttpDownloadInterval"),ue(this,"isProcessQueueMicrotaskCreated",!1),ue(this,"requestProcessQueueMicrotask",(h=!0)=>{let f=performance.now();!h&&this.lastQueueProcessingTimeStamp!==void 0&&f-this.lastQueueProcessingTimeStamp<=1e3||this.isProcessQueueMicrotaskCreated||(this.isProcessQueueMicrotaskCreated=!0,queueMicrotask(()=>{try{this.processQueue(),this.lastQueueProcessingTimeStamp=f}finally{this.isProcessQueueMicrotaskCreated=!1}}))}),this.streamManifestUrl=e,this.lastRequestedSegment=t,this.streamDetails=i,this.config=s,this.bandwidthCalculators=n,this.segmentStorage=a,this.eventTarget=l;let c=this.lastRequestedSegment.stream;this.playback={position:this.lastRequestedSegment.startTime,rate:1},this.segmentAvgDuration=SI(c),this.requests=new Kd(this.requestProcessQueueMicrotask,this.bandwidthCalculators,this.playback,this.config,this.eventTarget),this.p2pLoaders=new jd(this.streamManifestUrl,this.lastRequestedSegment.stream,this.requests,this.segmentStorage,this.config,this.eventTarget,this.requestProcessQueueMicrotask),this.logger=Xi(`p2pml-core:hybrid-loader-${c.type}`),this.logger.color="coral",this.setIntervalLoading()}setIntervalLoading(){let e=this.p2pLoaders.currentLoader.connectedPeerCount,t=Math.random()*dv*e+dv;this.randomHttpDownloadInterval=window.setTimeout(()=>{this.loadRandomThroughHttp(),this.setIntervalLoading()},t)}loadSegment(e,t){return mt(this,null,function*(){var i;this.logger(`requests: ${av(e)}`);let{stream:s}=e;s!==this.lastRequestedSegment.stream&&(this.logger(`stream changed to ${Fs(s)}`),this.p2pLoaders.changeCurrentLoader(s)),this.lastRequestedSegment=e;let n=this.config.swarmId??this.streamManifestUrl,a=os(n,s);this.segmentStorage.onSegmentRequested(n,a,e.externalId,e.startTime,e.endTime,s.type,this.streamDetails.isLive);let l=new qd(e,t);try{if(this.segmentStorage.hasSegment(n,a,e.externalId)){let h=yield this.segmentStorage.getSegmentData(n,a,e.externalId);if(h){let{queueDownloadRatio:f}=this.generateQueue();l.resolve(h,this.getBandwidth(f));return}}(i=this.engineRequest)==null||i.abort(),this.engineRequest=l}catch{l.reject()}finally{this.requestProcessQueueMicrotask()}})}processRequests(e,t){var i;let{stream:s}=this.lastRequestedSegment,{httpErrorRetries:n}=this.config,a=performance.now();for(let l of this.requests.items()){let{downloadSource:c,status:h,segment:f,isHandledByProcessQueue:p}=l,m=((i=this.engineRequest)==null?void 0:i.segment)===f?this.engineRequest:void 0;switch(h){case"loading":!e.has(f.runtimeId)&&!m&&(l.abortFromProcessQueue(),this.requests.remove(l));break;case"succeed":{if(!c)break;c==="http"&&this.p2pLoaders.currentLoader.broadcastAnnouncement(),m&&(m.resolve(l.data,this.getBandwidth(t)),this.engineRequest=void 0),this.requests.remove(l);let E=this.config.swarmId??this.streamManifestUrl,S=os(E,s);this.segmentStorage.storeSegment(E,S,f.externalId,l.data,f.startTime,f.endTime,f.stream.type,this.streamDetails.isLive);break}case"failed":c==="http"&&!p&&this.p2pLoaders.currentLoader.broadcastAnnouncement(),!m&&!s.segments.has(l.segment.runtimeId)&&this.requests.remove(l),l.failedAttempts.httpAttemptsCount>=n&&m&&(this.engineRequest=void 0,m.reject());break;case"not-started":this.requests.remove(l);break;case"aborted":this.requests.remove(l);break}l.markHandledByProcessQueue();let{lastAttempt:_}=l.failedAttempts;_&&a-_.error.timestamp>AI&&l.failedAttempts.clear()}}processQueue(){var e;let{queue:t,queueSegmentIds:i,queueDownloadRatio:s}=this.generateQueue();this.processRequests(i,s);let{simultaneousHttpDownloads:n,simultaneousP2PDownloads:a,httpErrorRetries:l}=this.config;if((e=this.engineRequest)!=null&&e.shouldBeStartedImmediately&&this.engineRequest.status==="pending"&&this.requests.executingHttpCount<n){let{segment:c}=this.engineRequest,h=this.requests.get(c);(!h||h.status==="not-started"||h.status==="failed"&&h.failedAttempts.httpAttemptsCount<this.config.httpErrorRetries)&&this.loadThroughHttp(c)}for(let c of t){let{statuses:h,segment:f}=c,p=this.requests.get(f);if(h.isHighDemand){if(p?.downloadSource==="http"&&p.status==="loading"||p?.downloadSource==="http"&&p.status==="failed"&&p.failedAttempts.httpAttemptsCount>=l)continue;let m=p?.status==="loading"&&p.downloadSource==="p2p";if(this.requests.executingHttpCount<n){m&&p.abortFromProcessQueue(),this.loadThroughHttp(f);continue}if(this.abortLastHttpLoadingInQueueAfterItem(t,f)&&this.requests.executingHttpCount<n){m&&p.abortFromProcessQueue(),this.loadThroughHttp(f);continue}if(m)continue;if(this.requests.executingP2PCount<a){this.loadThroughP2P(f);continue}if(this.abortLastP2PLoadingInQueueAfterItem(t,f)&&this.requests.executingP2PCount<a){this.loadThroughP2P(f);continue}}else if(h.isP2PDownloadable){if(p?.status==="loading")continue;this.requests.executingP2PCount<a?this.loadThroughP2P(f):this.p2pLoaders.currentLoader.isSegmentLoadedBySomeone(f)&&this.abortLastP2PLoadingInQueueAfterItem(t,f)&&this.requests.executingP2PCount<a&&this.loadThroughP2P(f)}}}abortSegmentRequest(e){var t;((t=this.engineRequest)==null?void 0:t.segment.runtimeId)===e&&(this.engineRequest.abort(),this.logger("abort: ",av(this.engineRequest.segment)),this.engineRequest=void 0,this.requestProcessQueueMicrotask())}loadThroughHttp(e){let t=this.requests.getOrCreateRequest(e);new kd(t,this.config,this.eventTarget),this.p2pLoaders.currentLoader.broadcastAnnouncement()}loadThroughP2P(e){this.p2pLoaders.currentLoader.downloadSegment(e)}loadRandomThroughHttp(){let e=this.getAvailableStorageCapacityPercent();if(e<=10)return;let{simultaneousHttpDownloads:t,httpErrorRetries:i}=this.config,s=this.p2pLoaders.currentLoader;if(this.requests.executingHttpCount>=t||!s.connectedPeerCount)return;let n=[];for(let{segment:p,statuses:m}of cv(this.lastRequestedSegment,this.playback,this.config,this.p2pLoaders.currentLoader,e)){let _=this.config.swarmId??this.streamManifestUrl,E=os(_,p.stream);if(!m.isHttpDownloadable||m.isP2PDownloadable||this.segmentStorage.hasSegment(_,E,p.externalId))continue;let S=this.requests.get(p);S&&(S.status==="loading"||S.status==="succeed"||S.failedAttempts.httpAttemptsCount>=i)||n.push(p)}if(!n.length||t-this.requests.executingHttpCount===0)return;let l=s.connectedPeerCount+1,c=Math.min(n.length,t*l),h=JA(Array.from({length:c},(p,m)=>m)),f=c/l;for(let p of h){if(this.requests.executingHttpCount>=t)break;if(f>=1||Math.random()<=f){let m=n[p];this.loadThroughHttp(m)}if(f--,f<=0)break}}abortLastHttpLoadingInQueueAfterItem(e,t){for(let{segment:i}of lv(e)){if(i===t)break;let s=this.requests.get(i);if(s?.downloadSource==="http"&&s.status==="loading")return s.abortFromProcessQueue(),!0}return!1}abortLastP2PLoadingInQueueAfterItem(e,t){for(let{segment:i}of lv(e)){if(i===t)break;let s=this.requests.get(i);if(s?.downloadSource==="p2p"&&s.status==="loading")return s.abortFromProcessQueue(),!0}return!1}getAvailableStorageCapacityPercent(){let{totalCapacity:e,usedCapacity:t}=this.segmentStorage.getUsage();return 100-t/e*100}generateQueue(){var e;let t=[],i=new Set,s=0,n=0,a=this.getAvailableStorageCapacityPercent();for(let l of cv(this.lastRequestedSegment,this.playback,this.config,this.p2pLoaders.currentLoader,a)){s++;let{segment:c}=l,h=this.config.swarmId??this.streamManifestUrl,f=os(h,c.stream);if(this.segmentStorage.hasSegment(h,f,c.externalId)||((e=this.requests.get(c))==null?void 0:e.status)==="succeed"){n++;continue}t.push(l),i.add(c.runtimeId)}return{queue:t,queueSegmentIds:i,maxPossibleLength:s,alreadyLoadedCount:n,queueDownloadRatio:s!==0?n/s:0}}getBandwidth(e){let{http:t,all:i}=this.bandwidthCalculators,{activeLevelBitrate:s}=this.streamDetails;if(this.streamDetails.activeLevelBitrate===0)return i.getBandwidthLoadingOnly(3);let n=Math.max(i.getBandwidth(30,this.levelChangedTimestamp),i.getBandwidth(60,this.levelChangedTimestamp),i.getBandwidth(90,this.levelChangedTimestamp));if(e>=.8||n>=s*.9)return Math.max(i.getBandwidthLoadingOnly(1),i.getBandwidthLoadingOnly(3),i.getBandwidthLoadingOnly(5));let a=Math.max(t.getBandwidthLoadingOnly(1),t.getBandwidthLoadingOnly(3),t.getBandwidthLoadingOnly(5));return Math.max(n,a)}notifyLevelChanged(){this.levelChangedTimestamp=performance.now()}sendBroadcastAnnouncement(e=!1){this.p2pLoaders.currentLoader.broadcastAnnouncement(e)}updatePlayback(e,t){var i;let s=this.playback.rate!==t,n=this.playback.position!==e;if(!s&&!n)return;let a=Math.abs(e-this.playback.position)/this.segmentAvgDuration>.5;n&&(this.playback.position=e),s&&t!==0&&(this.playback.rate=t),a&&(this.logger("position significantly changed"),(i=this.engineRequest)==null||i.markAsShouldBeStartedImmediately()),this.segmentStorage.onPlaybackUpdated(e,t),this.requestProcessQueueMicrotask(a)}updateStream(e){e===this.lastRequestedSegment.stream&&(this.logger(`update stream: ${Fs(e)}`),this.requestProcessQueueMicrotask())}destroy(){var e;clearInterval(this.storageCleanUpIntervalId),clearInterval(this.randomHttpDownloadInterval),this.storageCleanUpIntervalId=void 0,(e=this.engineRequest)==null||e.abort(),this.requests.destroy(),this.p2pLoaders.destroy()}},Sl=class{constructor(e=2e4){ue(this,"loadingsCount",0),ue(this,"bytes",[]),ue(this,"loadingOnlyTimestamps",[]),ue(this,"timestamps",[]),ue(this,"noLoadingsTime",0),ue(this,"loadingsStoppedAt",0),this.clearThresholdMs=e}addBytes(e,t=performance.now()){this.bytes.push(e),this.loadingOnlyTimestamps.push(t-this.noLoadingsTime),this.timestamps.push(t)}startLoading(e=performance.now()){this.clearStale(),this.loadingsCount===0&&this.loadingsStoppedAt!==0&&(this.noLoadingsTime+=e-this.loadingsStoppedAt),this.loadingsCount++}stopLoading(e=performance.now()){this.loadingsCount>0&&(this.loadingsCount--,this.loadingsCount===0&&(this.loadingsStoppedAt=e))}getBandwidthLoadingOnly(e,t=Number.NEGATIVE_INFINITY){if(!this.loadingOnlyTimestamps.length)return 0;let i=e*1e3,s=this.loadingOnlyTimestamps[this.loadingOnlyTimestamps.length-1],n=s,a=s-i,l=0;for(let c=this.bytes.length-1;c>=0;c--){let h=this.loadingOnlyTimestamps[c];if(h<a||this.timestamps[c]<t)break;n=h,l+=this.bytes[c]}return l*8e3/(s-n)}getBandwidth(e,t=Number.NEGATIVE_INFINITY,i=performance.now()){if(!this.timestamps.length)return 0;let s=e*1e3,n=i-s,a=i,l=0;for(let c=this.bytes.length-1;c>=0;c--){let h=this.timestamps[c];if(h<n||h<t)break;a=h,l+=this.bytes[c]}return l*8e3/(i-a)}clearStale(){if(!this.loadingOnlyTimestamps.length)return;let e=this.loadingOnlyTimestamps[this.loadingOnlyTimestamps.length-1]-this.clearThresholdMs,t=0;for(let i of this.loadingOnlyTimestamps){if(i>e)break;t++}this.bytes.splice(0,t),this.loadingOnlyTimestamps.splice(0,t),this.timestamps.splice(0,t)}},go=(r,e)=>`${r}|${e}`,II=r=>/Android/i.test(r),LI=r=>/iPad|iPhone/i.test(r),kI=r=>/Android/i.test(r)&&!/Chrome|Firefox/i.test(r),mo=1048576,zd=class{constructor(){ue(this,"userAgent",navigator.userAgent),ue(this,"segmentMemoryStorageLimit",4*1024),ue(this,"currentStorageUsage",0),ue(this,"cache",new Map),ue(this,"logger"),ue(this,"coreConfig"),ue(this,"mainStreamConfig"),ue(this,"secondaryStreamConfig"),ue(this,"currentPlayback"),ue(this,"lastRequestedSegment"),ue(this,"segmentChangeCallback"),this.logger=Xi("p2pml-core:segment-memory-storage"),this.logger.color="RebeccaPurple"}initialize(e,t,i){return mt(this,null,function*(){this.coreConfig=e,this.mainStreamConfig=t,this.secondaryStreamConfig=i,this.setMemoryStorageLimit(),this.logger("initialized")})}onPlaybackUpdated(e,t){this.currentPlayback={position:e,rate:t}}onSegmentRequested(e,t,i,s,n,a,l){this.lastRequestedSegment={streamId:t,segmentId:i,startTime:s,endTime:n,swarmId:e,streamType:a,isLiveStream:l}}storeSegment(e,t,i,s,n,a,l,c){return mt(this,null,function*(){this.clear(c,s.byteLength);let h=go(t,i);if(this.cache.set(h,{data:s,segmentId:i,streamId:t,startTime:n,endTime:a,streamType:l}),this.increaseStorageUsage(s.byteLength),this.logger(`add segment: ${i} to ${t}`),!this.segmentChangeCallback)throw new Error("dispatchStorageUpdatedEvent is not set");this.segmentChangeCallback(t)})}getSegmentData(e,t,i){return mt(this,null,function*(){let s=go(t,i),n=this.cache.get(s);if(n!==void 0)return n.data})}getUsage(){if(!this.lastRequestedSegment||!this.currentPlayback)return{totalCapacity:this.segmentMemoryStorageLimit,usedCapacity:this.currentStorageUsage};let e=this.currentPlayback.position,t=0;for(let{endTime:i,data:s}of this.cache.values())e>i||(t+=s.byteLength);return{totalCapacity:this.segmentMemoryStorageLimit,usedCapacity:t/mo}}hasSegment(e,t,i){let s=go(t,i);return this.cache.get(s)!==void 0}getStoredSegmentIds(e,t){let i=[];for(let{segmentId:s,streamId:n}of this.cache.values())n===t&&i.push(s);return i}clear(e,t){if(!this.currentPlayback||!this.mainStreamConfig||!this.secondaryStreamConfig||!this.coreConfig||!this.isMemoryLimitReached(t)&&!e)return;let s=new Set,n=Array.from(this.cache.values()).sort((a,l)=>a.startTime-l.startTime);for(let a of n){let{streamId:l,segmentId:c,data:h}=a,f=go(l,c);if(this.shouldRemoveSegment(a,e,this.currentPlayback.position)&&(this.cache.delete(f),s.add(l),this.decreaseStorageUsage(h.byteLength),this.logger(`Removed segment ${c} from stream ${l}`),!this.isMemoryLimitReached(t)&&!e))break}this.sendUpdatesToAffectedStreams(s)}isMemoryLimitReached(e){return this.currentStorageUsage+e/mo>this.segmentMemoryStorageLimit}setSegmentChangeCallback(e){this.segmentChangeCallback=e}sendUpdatesToAffectedStreams(e){e.size!==0&&e.forEach(t=>{if(!this.segmentChangeCallback)throw new Error("dispatchStorageUpdatedEvent is not set");this.segmentChangeCallback(t)})}shouldRemoveSegment(e,t,i){let{endTime:s,streamType:n}=e,a=this.getStreamTimeWindow(n,"highDemandTimeWindow");return i<=s?!1:t?i>a+s:!0}increaseStorageUsage(e){this.currentStorageUsage+=e/mo}decreaseStorageUsage(e){this.currentStorageUsage-=e/mo}setMemoryStorageLimit(){var e;if((e=this.coreConfig)!=null&&e.segmentMemoryStorageLimit){this.segmentMemoryStorageLimit=this.coreConfig.segmentMemoryStorageLimit;return}kI(this.userAgent)||LI(this.userAgent)?this.segmentMemoryStorageLimit=1024:II(this.userAgent)&&(this.segmentMemoryStorageLimit=2*1024)}getStreamTimeWindow(e,t){let i=e==="main"?this.mainStreamConfig:this.secondaryStreamConfig;return i?.[t]??0}destroy(){this.cache.clear()}},Yd=class{constructor(){ue(this,"events",new Map)}dispatchEvent(e,...t){let i=this.events.get(e);if(i)for(let s of i)s(...t)}getEventDispatcher(e){let t=this.events.get(e);t||(t=[],this.events.set(e,t));let i=t;return(...s)=>{for(let n of i)n(...s)}}addEventListener(e,t){let i=this.events.get(e);i?i.push(t):this.events.set(e,[t])}removeEventListener(e,t){let i=this.events.get(e);if(i){let s=i.indexOf(t);s!==-1&&i.splice(s,1)}}},Vf=class Oo{constructor(e){ue(this,"eventTarget",new Yd),ue(this,"manifestResponseUrl"),ue(this,"streams",new Map),ue(this,"mainStreamConfig"),ue(this,"secondaryStreamConfig"),ue(this,"commonCoreConfig"),ue(this,"bandwidthCalculators",{all:new Sl,http:new Sl}),ue(this,"segmentStorage"),ue(this,"mainStreamLoader"),ue(this,"secondaryStreamLoader"),ue(this,"streamDetails",{isLive:!1,activeLevelBitrate:0});let t=QA(e??{});this.commonCoreConfig=Ph({defaultConfig:Oo.DEFAULT_COMMON_CORE_CONFIG,baseConfig:t}),this.mainStreamConfig=Ph({defaultConfig:Oo.DEFAULT_STREAM_CONFIG,baseConfig:t,specificStreamConfig:t.mainStream}),this.secondaryStreamConfig=Ph({defaultConfig:Oo.DEFAULT_STREAM_CONFIG,baseConfig:t,specificStreamConfig:t.secondaryStream})}getConfig(){return ht(Ue({},Ps(this.commonCoreConfig)),{mainStream:Ps(this.mainStreamConfig),secondaryStream:Ps(this.secondaryStreamConfig)})}applyDynamicConfig(e){let{mainStream:t,secondaryStream:i}=e,s=Ps(this.mainStreamConfig),n=Ps(this.secondaryStreamConfig);this.overrideAllConfigs(e,t,i),this.processSpecificDynamicConfigParams(s,e,"main"),this.processSpecificDynamicConfigParams(n,e,"secondary")}processSpecificDynamicConfigParams(e,t,i){let s=this.getUpdatedStreamProperty("isP2PDisabled",t,i);s&&e.isP2PDisabled!==s&&this.destroyStreamLoader(i);let n=this.getUpdatedStreamProperty("isP2PUploadDisabled",t,i);if(n!==void 0&&e.isP2PUploadDisabled!==n){let a=i==="main"?this.mainStreamLoader:this.secondaryStreamLoader;a?.sendBroadcastAnnouncement(n)}}getUpdatedStreamProperty(e,t,i){let s=i==="main"?t.mainStream:t.secondaryStream;return s?.[e]??t[e]}addEventListener(e,t){this.eventTarget.addEventListener(e,t)}removeEventListener(e,t){this.eventTarget.removeEventListener(e,t)}setManifestResponseUrl(e){this.manifestResponseUrl=e.split("?")[0]}hasSegment(e){return!!hv(this.streams,e)}getStream(e){return this.streams.get(e)}addStreamIfNoneExists(e){this.streams.has(e.runtimeId)||this.streams.set(e.runtimeId,ht(Ue({},e),{segments:new Map}))}updateStream(e,t,i){var s,n;let a=this.streams.get(e);if(a){if(t)for(let l of t)a.segments.has(l.runtimeId)||a.segments.set(l.runtimeId,ht(Ue({},l),{stream:a}));if(i)for(let l of i)a.segments.delete(l);(s=this.mainStreamLoader)==null||s.updateStream(a),(n=this.secondaryStreamLoader)==null||n.updateStream(a)}}loadSegment(e,t){return mt(this,null,function*(){if(!this.manifestResponseUrl)throw new Error("Manifest response url is not defined");yield this.initializeSegmentStorage();let i=this.identifySegment(e);this.getStreamHybridLoader(i).loadSegment(i,t)})}abortSegmentLoading(e){var t,i;(t=this.mainStreamLoader)==null||t.abortSegmentRequest(e),(i=this.secondaryStreamLoader)==null||i.abortSegmentRequest(e)}updatePlayback(e,t){var i,s;(i=this.mainStreamLoader)==null||i.updatePlayback(e,t),(s=this.secondaryStreamLoader)==null||s.updatePlayback(e,t)}setActiveLevelBitrate(e){var t,i;e!==this.streamDetails.activeLevelBitrate&&(this.streamDetails.activeLevelBitrate=e,(t=this.mainStreamLoader)==null||t.notifyLevelChanged(),(i=this.secondaryStreamLoader)==null||i.notifyLevelChanged())}setIsLive(e){this.streamDetails.isLive=e}isSegmentLoadable(e){try{let t=this.identifySegment(e);return!(t.stream.type==="main"&&this.mainStreamConfig.isP2PDisabled||t.stream.type==="secondary"&&this.secondaryStreamConfig.isP2PDisabled)}catch{return!1}}destroy(){var e,t,i;this.streams.clear(),(e=this.mainStreamLoader)==null||e.destroy(),(t=this.secondaryStreamLoader)==null||t.destroy(),(i=this.segmentStorage)==null||i.destroy(),this.mainStreamLoader=void 0,this.secondaryStreamLoader=void 0,this.segmentStorage=void 0,this.manifestResponseUrl=void 0,this.streamDetails={isLive:!1,activeLevelBitrate:0},MT.clearPeerIdCache()}initializeSegmentStorage(){return mt(this,null,function*(){if(this.segmentStorage)return;let{isLive:e}=this.streamDetails,t=this.commonCoreConfig.customSegmentStorageFactory;if(t&&typeof t!="function")throw new Error("Storage configuration is invalid");let i=t?t(e):new zd;yield i.initialize(this.commonCoreConfig,this.mainStreamConfig,this.secondaryStreamConfig),this.segmentStorage=i})}identifySegment(e){if(!this.manifestResponseUrl)throw new Error("Manifest response url is undefined");let t=hv(this.streams,e);if(!t)throw new Error(`Not found segment with id: ${e}`);return t}overrideAllConfigs(e,t,i){kn(this.commonCoreConfig,e),kn(this.mainStreamConfig,e),kn(this.secondaryStreamConfig,e),t&&kn(this.mainStreamConfig,t),i&&kn(this.secondaryStreamConfig,i)}destroyStreamLoader(e){var t,i;e==="main"?((t=this.mainStreamLoader)==null||t.destroy(),this.mainStreamLoader=void 0):((i=this.secondaryStreamLoader)==null||i.destroy(),this.secondaryStreamLoader=void 0)}getStreamHybridLoader(e){return e.stream.type==="main"?(this.mainStreamLoader??(this.mainStreamLoader=this.createNewHybridLoader(e)),this.mainStreamLoader):(this.secondaryStreamLoader??(this.secondaryStreamLoader=this.createNewHybridLoader(e)),this.secondaryStreamLoader)}createNewHybridLoader(e){if(!this.manifestResponseUrl)throw new Error("Manifest response url is not defined");if(!this.segmentStorage)throw new Error("Segment storage is not initialized");let t=e.stream.type==="main"?this.mainStreamConfig:this.secondaryStreamConfig;return new Wd(this.manifestResponseUrl,e,this.streamDetails,t,this.bandwidthCalculators,this.segmentStorage,this.eventTarget)}};ue(Vf,"DEFAULT_COMMON_CORE_CONFIG",{segmentMemoryStorageLimit:void 0,customSegmentStorageFactory:void 0});ue(Vf,"DEFAULT_STREAM_CONFIG",{isP2PUploadDisabled:!1,isP2PDisabled:!1,simultaneousHttpDownloads:2,simultaneousP2PDownloads:3,highDemandTimeWindow:15,httpDownloadTimeWindow:3e3,p2pDownloadTimeWindow:6e3,webRtcMaxMessageSize:64*1024-1,p2pNotReceivingBytesTimeoutMs:2e3,p2pInactiveLoaderDestroyTimeoutMs:30*1e3,httpNotReceivingBytesTimeoutMs:3e3,httpErrorRetries:3,p2pErrorRetries:3,trackerClientVersionPrefix:jA,announceTrackers:["wss://tracker.novage.com.ua","wss://tracker.webtorrent.dev","wss://tracker.openwebtorrent.com"],rtcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"}]},validateP2PSegment:void 0,validateHTTPSegment:void 0,httpRequestSetup:void 0,swarmId:void 0});var RI=Vf,PI=TT.debug,Js=function(r,e,t,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},ct=function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},$n,Vr,Mo,is,sr,Rs,Ds,FT,Xd,DI=10,Qd=class{constructor(e,t){$n.add(this),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Vr.set(this,void 0),Mo.set(this,void 0),is.set(this,void 0),sr.set(this,void 0),Rs.set(this,void 0),Ds.set(this,void 0),Js(this,sr,t,"f"),Js(this,Mo,()=>new e.loader(e),"f"),this.stats={aborted:!1,chunkCount:0,loading:{start:0,first:0,end:0},buffering:{start:0,first:0,end:0},parsing:{start:0,end:0},total:1,loaded:1,bwEstimate:0,retry:0}}load(e,t,i){this.context=e,this.config=t,Js(this,Vr,i,"f");let{stats:s}=this,{rangeStart:n,rangeEnd:a}=e,l=pT(n,a!==void 0?a-1:void 0);Js(this,Ds,fT(e.url,l),"f");let c=ct(this,sr,"f").isSegmentLoadable(ct(this,Ds,"f"));if(!ct(this,sr,"f").hasSegment(ct(this,Ds,"f"))||!c){Js(this,is,ct(this,Mo,"f").call(this),"f"),ct(this,is,"f").stats=this.stats,ct(this,is,"f").load(e,t,i);return}let h=p=>{Js(this,Rs,p,"f");let m=ct(this,Rs,"f").data.byteLength;s.loading=xI(ct(this,Rs,"f").bandwidth,m,performance.now()),s.total=m,s.loaded=m,i.onProgress&&i.onProgress(this.stats,e,ct(this,Rs,"f").data,void 0),i.onSuccess({data:ct(this,Rs,"f").data,url:e.url},this.stats,e,void 0)},f=p=>{p instanceof en&&p.type==="aborted"&&this.stats.aborted||ct(this,$n,"m",FT).call(this,p)};ct(this,sr,"f").loadSegment(ct(this,Ds,"f"),{onSuccess:h,onError:f})}abort(){var e,t;ct(this,is,"f")?ct(this,is,"f").abort():(ct(this,$n,"m",Xd).call(this),(t=(e=ct(this,Vr,"f"))==null?void 0:e.onAbort)==null||t.call(e,this.stats,this.context,{}))}destroy(){ct(this,is,"f")?ct(this,is,"f").destroy():(this.stats.aborted||ct(this,$n,"m",Xd).call(this),Js(this,Vr,null,"f"),this.config=null)}};Vr=new WeakMap,Mo=new WeakMap,is=new WeakMap,sr=new WeakMap,Rs=new WeakMap,Ds=new WeakMap,$n=new WeakSet,FT=function(e){var t;let i={code:0,text:""};(e instanceof en&&e.type==="failed"||e instanceof Error)&&(i.text=e.message),(t=ct(this,Vr,"f"))==null||t.onError(i,this.context,null,this.stats)},Xd=function(){!ct(this,Rs,"f")&&ct(this,Ds,"f")&&(this.stats.aborted=!0,ct(this,sr,"f").abortSegmentLoading(ct(this,Ds,"f")))};function xI(r,e,t){let i=e*8e3/r,s=t-i;return{start:s-DI,first:s,end:t}}var OI=function(r,e,t,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Rn=function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},As,Jd=class{constructor(e){As.set(this,void 0),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),OI(this,As,new e.loader(e),"f"),this.stats=Rn(this,As,"f").stats,this.context=Rn(this,As,"f").context}load(e,t,i){Rn(this,As,"f").load(e,t,i)}abort(){Rn(this,As,"f").abort()}destroy(){Rn(this,As,"f").destroy()}};As=new WeakMap;var Zd=class{constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.core=e}processMainManifest(e){let{levels:t,audioTracks:i}=e;for(let[s,n]of t.entries()){let{url:a}=n;this.core.addStreamIfNoneExists({runtimeId:Array.isArray(a)?a[0]:a,type:"main",index:s})}for(let[s,n]of i.entries()){let{url:a}=n;this.core.addStreamIfNoneExists({runtimeId:Array.isArray(a)?a[0]:a,type:"secondary",index:s})}}updatePlaylist(e){let{details:{url:t,fragments:i,live:s}}=e,n=this.core.getStream(t);if(!n)return;let a=new Set(n.segments.keys()),l=[];i.forEach((c,h)=>{let{url:f,byteRange:p,sn:m,start:_,end:E}=c;if(m==="initSegment")return;let[S,C]=p,I=pT(S,C!==void 0?C-1:void 0),R=fT(f,I);a.delete(R),!n.segments.has(R)&&l.push({runtimeId:R,url:f,externalId:s?m:h,byteRange:I,startTime:_,endTime:E})}),!(!l.length&&!a.size)&&this.core.updateStream(t,l,a.values())}},MI=function(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)},FI=function(r,e,t,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t};function NI(r){var e,t;return t=class extends r{get p2pEngine(){return MI(this,e,"f")}constructor(...s){var n;let f=s[0]??{},{p2p:l}=f,c=Qp(f,["p2p"]),h=new Cl(l);super(Ue(Ue({},c),h.getConfigForHlsJs())),e.set(this,void 0),h.bindHls(this),FI(this,e,h,"f"),(n=l?.onHlsJsCreated)==null||n.call(l,this)}},e=new WeakMap,t}var BI=120,Cl=class{static injectMixin(e){return NI(e)}constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"segmentManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hlsInstanceGetter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentHlsInstance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:PI("p2pml-hlsjs:engine")}),Object.defineProperty(this,"updateMediaElementEventHandlers",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var i;let s=(i=this.currentHlsInstance)==null?void 0:i.media;if(!s)return;let n=t==="register"?"addEventListener":"removeEventListener";s[n]("timeupdate",this.handlePlaybackUpdate),s[n]("seeking",this.handlePlaybackUpdate),s[n]("ratechange",this.handlePlaybackUpdate)}}),Object.defineProperty(this,"handleManifestLoaded",{enumerable:!0,configurable:!0,writable:!0,value:(t,i)=>{let s=i.networkDetails;s instanceof XMLHttpRequest?this.core.setManifestResponseUrl(s.responseURL):s instanceof Response&&this.core.setManifestResponseUrl(s.url),this.segmentManager.processMainManifest(i)}}),Object.defineProperty(this,"handleLevelSwitching",{enumerable:!0,configurable:!0,writable:!0,value:(t,i)=>{i.bitrate&&this.core.setActiveLevelBitrate(i.bitrate)}}),Object.defineProperty(this,"handleLevelUpdated",{enumerable:!0,configurable:!0,writable:!0,value:(t,i)=>{this.currentHlsInstance&&i.details.live&&i.details.fragments[0].type==="main"&&!this.currentHlsInstance.userConfig.liveSyncDuration&&!this.currentHlsInstance.userConfig.liveSyncDurationCount&&i.details.fragments.length>4&&this.updateLiveSyncDurationCount(i),this.core.setIsLive(i.details.live),this.segmentManager.updatePlaylist(i)}}),Object.defineProperty(this,"handleMediaAttached",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.updateMediaElementEventHandlers("register")}}),Object.defineProperty(this,"handleMediaDetached",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.updateMediaElementEventHandlers("unregister")}}),Object.defineProperty(this,"handlePlaybackUpdate",{enumerable:!0,configurable:!0,writable:!0,value:t=>{let i=t.target;this.core.updatePlayback(i.currentTime,i.playbackRate)}}),Object.defineProperty(this,"destroyCore",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.core.destroy()}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.destroyCore(),this.updateHlsEventsHandlers("unregister"),this.updateMediaElementEventHandlers("unregister"),this.currentHlsInstance=void 0}}),this.core=new RI(e?.core),this.segmentManager=new Zd(this.core)}addEventListener(e,t){this.core.addEventListener(e,t)}removeEventListener(e,t){this.core.removeEventListener(e,t)}getConfigForHlsJs(){return{fLoader:this.createFragmentLoaderClass(),pLoader:this.createPlaylistLoaderClass()}}getConfig(){return{core:this.core.getConfig()}}applyDynamicConfig(e){e.core&&this.core.applyDynamicConfig(e.core)}bindHls(e){this.hlsInstanceGetter=typeof e=="function"?e:()=>e}initHlsEvents(){var e;let t=(e=this.hlsInstanceGetter)==null?void 0:e.call(this);this.currentHlsInstance!==t&&(this.currentHlsInstance&&this.destroy(),this.currentHlsInstance=t,this.updateHlsEventsHandlers("register"),this.updateMediaElementEventHandlers("register"))}updateHlsEventsHandlers(e){let t=this.currentHlsInstance;if(!t)return;let i=e==="register"?"on":"off";t[i]("hlsManifestLoaded",this.handleManifestLoaded),t[i]("hlsLevelSwitching",this.handleLevelSwitching),t[i]("hlsLevelUpdated",this.handleLevelUpdated),t[i]("hlsAudioTrackLoaded",this.handleLevelUpdated),t[i]("hlsDestroying",this.destroy),t[i]("hlsMediaAttaching",this.destroyCore),t[i]("hlsManifestLoading",this.destroyCore),t[i]("hlsMediaDetached",this.handleMediaDetached),t[i]("hlsMediaAttached",this.handleMediaAttached)}updateLiveSyncDurationCount(e){let t=e.details.targetduration,i=Math.floor(BI/t),s=Math.min(e.details.fragments.length-1,i);this.currentHlsInstance&&this.currentHlsInstance.config.liveSyncDurationCount!==s&&(this.debug(`Setting liveSyncDurationCount to ${s}`),this.currentHlsInstance.config.liveSyncDurationCount=s)}createFragmentLoaderClass(){let{core:e}=this,t=this;return class extends Qd{constructor(s){super(s,e)}static getEngine(){return t}}}createPlaylistLoaderClass(){let e=this;return class extends Jd{constructor(i){super(i),e.initHlsEvents()}}}},fv=Cl.injectMixin(pt),pv=!1,UI=function(r){if(!pt.isSupported()){ze.info("Hls.js is not supported in this browser.");return}let e=r.getTech("Html5");if(!e){ze.error('No "Html5" tech found in videojs');return}pv||(pv=!0,e.registerSourceHandler({canHandleSource:function(t){let i=/^application\/x-mpegURL|application\/vnd\.apple\.mpegurl$/i,s=/\.m3u8/i;return i.test(t.type)?"probably":s.test(t.src)?"maybe":""},handleSource:function(t,i){return i.hlsProvider&&i.hlsProvider.dispose(),i.hlsProvider=new wl(r,t,i),i.hlsProvider}},0),r.Html5Hlsjs=wl)},$I=X.getPlugin("plugin"),ef=class extends $I{constructor(e,t){super(e,t),t&&(e.srOptions_||(e.srOptions_={}),e.srOptions_.hlsjsConfig||(e.srOptions_.hlsjsConfig=t.hlsjsConfig),t.levelLabelHandler&&!e.srOptions_.levelLabelHandler&&(e.srOptions_.levelLabelHandler=t.levelLabelHandler),UI(X))}dispose(){this.player.srOptions_=void 0;let e=this.player.tech(!0);e.hlsProvider&&(e.hlsProvider.dispose(),e.hlsProvider=void 0),super.dispose()}};X.registerPlugin("hlsjs",ef);var wl=class{constructor(e,t,i){Qe(this,"videoElement"),Qe(this,"errorCounts",{}),Qe(this,"player"),Qe(this,"tech"),Qe(this,"source"),Qe(this,"vjs"),Qe(this,"maxNetworkErrorRecovery",5),Qe(this,"hls"),Qe(this,"hlsjsConfig",null),Qe(this,"_duration",null),Qe(this,"metadata",null),Qe(this,"isLive",null),Qe(this,"dvrDuration",null),Qe(this,"edgeMargin",null),Qe(this,"liveEnded",!1),Qe(this,"handlers",{play:null,error:null}),Qe(this,"audioMode",!1),this.vjs=e,this.source=t,this.tech=i,this.tech.name_="Hlsjs",this.videoElement=i.el(),this.player=e(i.options_.playerId),this.handlers.error=s=>{let n,a=(s.currentTarget||s.target).error;if(a){switch(ze.info(a),a.code){case a.MEDIA_ERR_ABORTED:n="You aborted the video playback";break;case a.MEDIA_ERR_DECODE:n="The video playback was aborted due to a corruption problem or because the video used features your browser did not support",this._handleMediaError(a);break;case a.MEDIA_ERR_NETWORK:n="A network error caused the video download to fail part-way";break;case a.MEDIA_ERR_SRC_NOT_SUPPORTED:n="The video could not be loaded, either because the server or network failed or because the format is not supported";break;default:n=a.message}ze.error(`MEDIA_ERROR: ${n}`)}},this.videoElement.addEventListener("error",this.handlers.error),this.initialize()}duration(){return this._duration===1/0?1/0:isNaN(this.videoElement.duration)?this._duration||0:this.videoElement.duration}seekable(){if(this.hls.media){if(!this.isLive)return this.vjs.createTimeRanges(0,this.hls.media.duration);let e=Math.round(this.hls.media.duration-this.dvrDuration),t=Math.round(this.hls.media.duration-this.edgeMargin);return this.vjs.createTimeRanges(e,t)}return this.vjs.createTimeRanges()}dispose(){this.videoElement.removeEventListener("play",this.handlers.play),this.videoElement.removeEventListener("error",this.handlers.error),this.hls.destroy()}_getHumanErrorMsg(e){switch(e.code){default:return e.message}}_handleUnrecoverableError(e){if(this.hls.levels.filter(t=>t.id>-1).length>1){this._removeQuality(this.hls.loadLevel);return}this.hls.destroy(),ze.info("bubbling error up to VIDEOJS"),this.tech.error=()=>ht(Ue({},e),{message:this._getHumanErrorMsg(e)}),this.tech.trigger("error")}_handleMediaError(e){if(this.errorCounts[pt.ErrorTypes.MEDIA_ERROR]===1){ze.info("trying to recover media error"),this.hls.recoverMediaError();return}if(this.errorCounts[pt.ErrorTypes.MEDIA_ERROR]===2){ze.info("2nd try to recover media error (by swapping audio codec"),this.hls.swapAudioCodec(),this.hls.recoverMediaError();return}this.errorCounts[pt.ErrorTypes.MEDIA_ERROR]>2&&this._handleUnrecoverableError(e)}_handleNetworkError(e){var t,i;if(navigator.onLine!==!1){if(this.liveEnded){ze.info("Forcing end of live stream after a network error"),(t=this.player)==null||t.handleTechEnded_(),(i=this.hls)==null||i.stopLoad();return}if(this.errorCounts[pt.ErrorTypes.NETWORK_ERROR]<=this.maxNetworkErrorRecovery){ze.info("trying to recover network error"),setTimeout(()=>this.hls.startLoad(),1e3),this.hls.once(pt.Events.FRAG_LOADED,()=>{this.errorCounts[pt.ErrorTypes.NETWORK_ERROR]=0});return}this._handleUnrecoverableError(e)}}_onError(e,t){let i={message:`HLS.js error: ${t.type} - fatal: ${t.fatal} - ${t.details}`};this.errorCounts[t.type]?this.errorCounts[t.type]+=1:this.errorCounts[t.type]=1,/googlebot/i.test(navigator.userAgent)||(t.fatal?ze.error(i.message,{currentTime:this.player.currentTime(),data:t}):ze.clientWarn(i.message)),t.type===pt.ErrorTypes.NETWORK_ERROR?(i.code=2,this._handleNetworkError(i)):t.fatal&&t.type===pt.ErrorTypes.MEDIA_ERROR&&t.details!==pt.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR?(i.code=3,this._handleMediaError(i)):t.fatal&&this._handleUnrecoverableError(i)}buildLevelLabel(e){return this.player.srOptions_.levelLabelHandler(e,this.player)}_removeQuality(e){this.hls.removeLevel(e),this.player.peertubeResolutions().remove(e),this.hls.currentLevel=-1}_notifyVideoQualities(){if(!this.metadata)return;let e=[];if(this.metadata.levels.forEach((i,s)=>{e.push({id:s,height:i.height,width:i.width,bitrate:i.bitrate,label:this.buildLevelLabel(i),selected:i.id===this.hls.manualLevel,selectCallback:()=>this.manuallySelectVideoLevel(s)})}),e.filter(i=>i.height!==0).length!==0&&this.getSeparateAudioTrack()){let i=this.getSeparateAudioTrack();e.push({id:-2,label:this.player.localize("Audio only"),selected:!1,selectCallback:()=>{this.audioMode||(this.audioMode=!0,this.updateToAudioOrVideo(i))}})}e.push({id:-1,label:this.player.localize("Auto"),selected:!0,selectCallback:()=>this.manuallySelectVideoLevel(-1)}),this.player.peertubeResolutions().add(e)}manuallySelectVideoLevel(e){if(this.audioMode){this.audioMode=!1,this.updateToAudioOrVideo(this.source.src,e);return}this.hls.currentLevel=e}_startLoad(){this.hls.startLoad(-1),this.videoElement.removeEventListener("play",this.handlers.play)}_onMetaData(e,t){this.metadata=t,this._notifyVideoQualities()}initialize(){this.liveEnded=!1,this.buildBaseConfig(),["","auto"].includes(this.videoElement.preload)&&!this.videoElement.autoplay&&this.hlsjsConfig.autoStartLoad===void 0&&(this.hlsjsConfig.autoStartLoad=!1),this.hlsjsConfig.autoStartLoad===!1&&(this.handlers.play=this._startLoad.bind(this),this.videoElement.addEventListener("play",this.handlers.play)),this.hls=new fv(ht(Ue({},tg(this.hlsjsConfig,["p2pMediaLoaderOptions"])),{p2p:{core:this.hlsjsConfig.p2pMediaLoaderOptions}})),this.player.trigger("hlsjs-initialized",{hlsjs:this.hls}),this.hls.on(pt.Events.ERROR,(e,t)=>this._onError(e,t)),this.hls.on(pt.Events.MANIFEST_PARSED,(e,t)=>this._onMetaData(e,t)),this.hls.on(pt.Events.LEVEL_LOADED,(e,t)=>{this.hlsjsConfig.liveSyncDuration?this.edgeMargin=this.hlsjsConfig.liveSyncDuration:this.hlsjsConfig.liveSyncDurationCount&&(this.edgeMargin=this.hlsjsConfig.liveSyncDurationCount*t.details.targetduration),this.isLive&&!t.details.live&&(this.liveEnded=!0,this.player.trigger("hlsjs-live-ended")),this.isLive=t.details.live,this.dvrDuration=t.details.totalduration,this._duration=this.isLive?1/0:t.details.totalduration,this.isLive&&(this.maxNetworkErrorRecovery=30)}),this.registerLevelEventSwitch(),this.hls.once(pt.Events.FRAG_LOADED,()=>{this.tech.trigger("loadedmetadata")}),this.hls.attachMedia(this.videoElement),this.hls.loadSource(this.source.src)}updateToAudioOrVideo(e,t){this.player.addClass("vjs-updating-resolution");let i=this.player.currentTime();this.dispose(),this.buildBaseConfig(),this.hlsjsConfig.autoStartLoad=!0,this.player.autoplay("play"),this.hls=new fv(ht(Ue({},tg(this.hlsjsConfig,["p2pMediaLoaderOptions"])),{p2p:{core:this.hlsjsConfig.p2pMediaLoaderOptions},startPosition:this.duration()===1/0?void 0:i,startLevel:t})),this.player.trigger("hlsjs-initialized",{hlsjs:this.hls}),this.hls.on(pt.Events.ERROR,(s,n)=>this._onError(s,n)),this.registerLevelEventSwitch(),this.hls.attachMedia(this.videoElement),this.hls.loadSource(e),this.player.one("canplay",()=>{this.player.removeClass("vjs-updating-resolution")})}registerLevelEventSwitch(){this.hls.on(pt.Events.LEVEL_SWITCHING,(e,t)=>{let i=t.level,s=-1;this.audioMode?i=-2:this.hls.autoLevelEnabled&&(i=-1,s=t.level),this.player.peertubeResolutions().select({id:i,autoResolutionChosenId:s,fireCallback:!1})})}buildBaseConfig(){let e=this.tech.options_,t=this.player.srOptions_,i=t?.hlsjsConfig||e.hlsjsConfig;this.hlsjsConfig=i?Ue({},i):{}}getSeparateAudioTrack(){if(this.metadata.audioTracks.length!==0)return this.metadata.audioTracks[0].url}},gv=fs("peertube:player:p2p-media-loader"),HI=X.getPlugin("plugin"),tf=class extends HI{constructor(e,t){if(super(e),this.options=t,this.statsP2PBytes={pendingDownload:[],pendingUpload:[],peersWithWebSeed:0,peersP2POnly:0,totalDownload:0,totalUpload:0},this.statsHTTPBytes={pendingDownload:[],totalDownload:0},this.liveEnded=!1,!X.Html5Hlsjs){if(e.canPlayType("application/vnd.apple.mpegurl")){this.fallbackToBuiltInIOS();return}let i="HLS.js does not seem to be supported. Cannot fallback to built-in HLS";ze.warn(i);let s={code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED,message:i,MEDIA_ERR_ABORTED:MediaError.MEDIA_ERR_ABORTED,MEDIA_ERR_DECODE:MediaError.MEDIA_ERR_DECODE,MEDIA_ERR_NETWORK:MediaError.MEDIA_ERR_NETWORK,MEDIA_ERR_SRC_NOT_SUPPORTED:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED};e.ready(()=>e.error(s));return}{let i=(n,{hlsjs:a})=>{var l,c;(c=(l=this.hlsjs)==null?void 0:l.p2pEngine)==null||c.destroy(),clearInterval(this.networkInfoInterval),this.hlsjs=a,gv("hls.js initialized, initializing p2p-media-loader plugin",{hlsjs:a}),e.ready(()=>this.initializePlugin())};e.on("hlsjs-initialized",i);let s=()=>{gv("hls.js says the live is ended"),this.liveEnded=!0};e.on("hlsjs-live-ended",s),this.on("dispose",()=>{this.player.off("hlsjs-initialized",i),this.player.off("hlsjs-live-ended",s)})}e.src({type:t.type,src:t.src})}dispose(){var e,t,i,s;(t=(e=this.hlsjs)==null?void 0:e.p2pEngine)==null||t.destroy(),(i=this.hlsjs)==null||i.destroy(),(s=this.options.segmentValidator)==null||s.destroy(),clearInterval(this.networkInfoInterval),super.dispose()}getCurrentLevel(){if(this.hlsjs)return this.hlsjs.levels[this.hlsjs.currentLevel]}getLiveLatency(){return Math.round(this.hlsjs.latency)}getLiveLatencyFromEdge(){return Math.round(this.hlsjs.latency-this.hlsjs.targetLatency)}getHLSJS(){return this.hlsjs}initializePlugin(){this.hlsjs.p2pEngine.addEventListener("onSegmentError",i=>{if(navigator.onLine===!1||this.liveEnded||i.downloadSource!=="http")return;let s=i.segment;ze.clientError(`Segment ${s.runtimeId} error.`,i),this.options.redundancyUrlManager&&this.options.redundancyUrlManager.onSegmentError(s.url)}),this.hlsjs.p2pEngine.addEventListener("onSegmentLoaded",i=>{i.downloadSource==="http"&&this.options.redundancyUrlManager&&this.options.redundancyUrlManager.onSegmentSuccess(i.segmentUrl)});let e=this.options.redundancyUrlManager?this.options.redundancyUrlManager.countBaseUrls():0;this.totalHTTPPeers=1+e,this.statsP2PBytes.peersWithWebSeed=this.totalHTTPPeers,this.runStats();let t=!0;this.hlsjs.on(pt.Events.LEVEL_SWITCHED,()=>{let i=this.getCurrentLevel(),s=Math.min(i?.height||0,i?.width||0);this.player.trigger("resolution-change",{resolution:s,initResolutionChange:t}),t=!1}),this.hlsjs.on(pt.Events.MANIFEST_PARSED,(i,s)=>{if(Array.isArray(s.levels)&&s.levels.length>=1){let n=s.levels[0];this.player.trigger("video-ratio-changed",{ratio:n.width/n.height})}}),this.hlsjs.on(pt.Events.ERROR,(i,s)=>{s.type===pt.ErrorTypes.MEDIA_ERROR&&s.details===pt.ErrorDetails.BUFFER_STALLED_ERROR&&this.player.trigger("buffer-stalled")})}runStats(){this.connectedPeers=new Set,this.hlsjs.p2pEngine.getConfig().core.mainStream.isP2PDisabled&&this.hlsjs.on(pt.Events.FRAG_LOADED,(e,t)=>{let i=t.frag.stats.loaded;this.statsHTTPBytes.pendingDownload.push(i),this.statsHTTPBytes.totalDownload+=i}),this.hlsjs.p2pEngine.addEventListener("onChunkDownloaded",(e,t)=>{let i=t==="p2p"?this.statsP2PBytes:this.statsHTTPBytes;i.pendingDownload.push(e),i.totalDownload+=e}),this.hlsjs.p2pEngine.addEventListener("onChunkUploaded",e=>{this.statsP2PBytes.pendingUpload.push(e),this.statsP2PBytes.totalUpload+=e}),this.hlsjs.p2pEngine.addEventListener("onPeerConnect",e=>{e.streamType==="main"&&(this.connectedPeers.add(e.peerId),this.statsP2PBytes.peersP2POnly=this.connectedPeers.size,this.statsP2PBytes.peersWithWebSeed=this.totalHTTPPeers+this.statsP2PBytes.peersP2POnly)}),this.hlsjs.p2pEngine.addEventListener("onPeerClose",e=>{e.streamType==="main"&&(this.connectedPeers.delete(e.peerId),this.statsP2PBytes.peersP2POnly=this.connectedPeers.size,this.statsP2PBytes.peersWithWebSeed=this.totalHTTPPeers+this.statsP2PBytes.peersP2POnly)}),this.networkInfoInterval=setInterval(()=>{let e=this.arraySum(this.statsP2PBytes.pendingDownload),t=this.arraySum(this.statsP2PBytes.pendingUpload),i=this.arraySum(this.statsHTTPBytes.pendingDownload);return this.statsP2PBytes.pendingDownload=[],this.statsP2PBytes.pendingUpload=[],this.statsHTTPBytes.pendingDownload=[],this.player.trigger("network-info",{source:"p2p-media-loader",bandwidthEstimate:this.hlsjs.bandwidthEstimate/8,http:{downloadSpeed:i,downloaded:this.statsHTTPBytes.totalDownload},p2p:this.options.p2pEnabled?{downloadSpeed:e,uploadSpeed:t,peersWithWebSeed:this.statsP2PBytes.peersWithWebSeed,peersP2POnly:this.statsP2PBytes.peersP2POnly,downloaded:this.statsP2PBytes.totalDownload,uploaded:this.statsP2PBytes.totalUpload}:void 0})},1e3)}arraySum(e){return e.reduce((t,i)=>t+i,0)}fallbackToBuiltInIOS(){ze.info("HLS.js does not seem to be supported. Fallback to built-in HLS."),this.player.src({type:this.options.type,src:Bv(this.options.src,{videoFileToken:this.options.videoFileToken(),reinjectVideoFileToken:"true"})}),this.getResolutionButton().hide()}getResolutionButton(){return this.player.controlBar.getDescendant(["settingsButton"]).menu.getChild("resolutionMenuButton")}};X.registerPlugin("p2pMediaLoader",tf);var jI="2.0.3",sf=500,mv="user-agent",an="",vv="?",Al="function",Ns="undefined",on="object",rf="string",ei="browser",rs="cpu",Gi="device",Li="engine",mi="os",Xr="result",ye="name",ce="type",me="vendor",Te="version",ti="architecture",ha="major",fe="model",Hn="console",$e="mobile",st="tablet",It="smarttv",Ni="wearable",Mh="xr",jn="embedded",Pn="inapp",Gf="brands",rr="formFactors",Kf="fullVersionList",Qr="platform",qf="platformVersion",$l="bitness",Hs="sec-ch-ua",VI=Hs+"-full-version-list",GI=Hs+"-arch",KI=Hs+"-"+$l,qI=Hs+"-form-factors",WI=Hs+"-"+$e,zI=Hs+"-"+fe,NT=Hs+"-"+Qr,YI=NT+"-version",BT=[Gf,Kf,$e,fe,Qr,qf,ti,rr,$l],vo="Amazon",Nr="Apple",yv="ASUS",Tv="BlackBerry",Zs="Google",_v="Huawei",Ev="Lenovo",bv="Honor",yo="LG",Fh="Microsoft",Nh="Motorola",Bh="Nvidia",Sv="OnePlus",Uh="OPPO",Dn="Samsung",Cv="Sharp",xn="Sony",$h="Xiaomi",Hh="Zebra",wv="Chrome",Av="Chromium",Cs="Chromecast",XI="Edge",On="Firefox",Mn="Opera",jh="Facebook",Iv="Sogou",Br="Mobile ",Fn=" Browser",nf="Windows",QI=typeof window!==Ns,ii=QI&&window.navigator?window.navigator:void 0,xs=ii&&ii.userAgentData?ii.userAgentData:void 0,JI=function(r,e){var t={},i=e;if(!Il(e)){i={};for(var s in e)for(var n in e[s])i[n]=e[s][n].concat(i[n]?i[n]:[])}for(var a in r)t[a]=i[a]&&i[a].length%2===0?i[a].concat(r[a]):r[a];return t},Hl=function(r){for(var e={},t=0;t<r.length;t++)e[r[t].toUpperCase()]=r[t];return e},af=function(r,e){if(typeof r===on&&r.length>0){for(var t in r)if(ls(r[t])==ls(e))return!0;return!1}return un(r)?ls(e).indexOf(ls(r))!==-1:!1},Il=function(r,e){for(var t in r)return/^(browser|cpu|device|engine|os)$/.test(t)||(e?Il(r[t]):!1)},un=function(r){return typeof r===rf},Vh=function(r){if(r){for(var e=[],t=ln(/\\?\"/g,r).split(","),i=0;i<t.length;i++)if(t[i].indexOf(";")>-1){var s=ca(t[i]).split(";v=");e[i]={brand:s[0],version:s[1]}}else e[i]=ca(t[i]);return e}},ls=function(r){return un(r)?r.toLowerCase():r},Gh=function(r){return un(r)?ln(/[^\d\.]/g,r).split(".")[0]:void 0},us=function(r){for(var e in r){var t=r[e];typeof t==on&&t.length==2?this[t[0]]=t[1]:this[t]=void 0}return this},ln=function(r,e){return un(e)?e.replace(r,an):e},Nn=function(r){return ln(/\\?\"/g,r)},ca=function(r,e){if(un(r))return r=ln(/^\s\s*/,r),typeof e===Ns?r:r.substring(0,sf)},Kh=function(r,e){if(!(!r||!e))for(var t=0,i,s,n,a,l,c;t<e.length&&!l;){var h=e[t],f=e[t+1];for(i=s=0;i<h.length&&!l&&h[i];)if(l=h[i++].exec(r),l)for(n=0;n<f.length;n++)c=l[++s],a=f[n],typeof a===on&&a.length>0?a.length===2?typeof a[1]==Al?this[a[0]]=a[1].call(this,c):this[a[0]]=a[1]:a.length===3?typeof a[1]===Al&&!(a[1].exec&&a[1].test)?this[a[0]]=c?a[1].call(this,c,a[2]):void 0:this[a[0]]=c?c.replace(a[1],a[2]):void 0:a.length===4&&(this[a[0]]=c?a[3].call(this,c.replace(a[1],a[2])):void 0):this[a]=c||void 0;t+=2}},Os=function(r,e){for(var t in e)if(typeof e[t]===on&&e[t].length>0){for(var i=0;i<e[t].length;i++)if(af(e[t][i],r))return t===vv?void 0:t}else if(af(e[t],r))return t===vv?void 0:t;return e.hasOwnProperty("*")?e["*"]:r},Lv={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},kv={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":void 0},Rv={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[Te,[ye,Br+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[Te,[ye,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[ye,Te],[/opios[\/ ]+([\w\.]+)/i],[Te,[ye,Mn+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[Te,[ye,Mn+" GX"]],[/\bopr\/([\w\.]+)/i],[Te,[ye,Mn]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[Te,[ye,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[Te,[ye,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[ye,Te],[/quark(?:pc)?\/([-\w\.]+)/i],[Te,[ye,"Quark"]],[/\bddg\/([\w\.]+)/i],[Te,[ye,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[Te,[ye,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[Te,[ye,"WeChat"]],[/konqueror\/([\w\.]+)/i],[Te,[ye,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[Te,[ye,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[Te,[ye,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[Te,[ye,"Smart "+Ev+Fn]],[/(avast|avg)\/([\w\.]+)/i],[[ye,/(.+)/,"$1 Secure"+Fn],Te],[/\bfocus\/([\w\.]+)/i],[Te,[ye,On+" Focus"]],[/\bopt\/([\w\.]+)/i],[Te,[ye,Mn+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[Te,[ye,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[Te,[ye,"Dolphin"]],[/coast\/([\w\.]+)/i],[Te,[ye,Mn+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[Te,[ye,"MIUI"+Fn]],[/fxios\/([\w\.-]+)/i],[Te,[ye,Br+On]],[/\bqihoobrowser\/?([\w\.]*)/i],[Te,[ye,"360"]],[/\b(qq)\/([\w\.]+)/i],[[ye,/(.+)/,"$1Browser"],Te],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[ye,/(.+)/,"$1"+Fn],Te],[/samsungbrowser\/([\w\.]+)/i],[Te,[ye,Dn+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[Te,[ye,Iv+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[ye,Iv+" Mobile"],Te],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[ye,Te],[/(lbbrowser|rekonq)/i],[ye],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[Te,ye],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[ye,jh],Te,[ce,Pn]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[ye,Te,[ce,Pn]],[/\bgsa\/([\w\.]+) .*safari\//i],[Te,[ye,"GSA"],[ce,Pn]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[Te,[ye,"TikTok"],[ce,Pn]],[/\[(linkedin)app\]/i],[ye,[ce,Pn]],[/(chromium)[\/ ]([-\w\.]+)/i],[ye,Te],[/headlesschrome(?:\/([\w\.]+)| )/i],[Te,[ye,wv+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[ye,wv+" WebView"],Te],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[Te,[ye,"Android"+Fn]],[/chrome\/([\w\.]+) mobile/i],[Te,[ye,Br+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[ye,Te],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[Te,[ye,Br+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[ye,Br+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[Te,ye],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[ye,[Te,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[ye,Te],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[ye,Br+On],Te],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[ye,"Netscape"],Te],[/(wolvic|librewolf)\/([\w\.]+)/i],[ye,Te],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[Te,[ye,On+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[ye,[Te,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[ye,[Te,/[^\d\.]+./,an]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[ti,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[ti,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[ti,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[ti,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[ti,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[ti,/ower/,an,ls]],[/ sun4\w[;\)]/i],[[ti,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[ti,ls]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[fe,[me,Dn],[ce,st]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[fe,[me,Dn],[ce,$e]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[fe,[me,Nr],[ce,$e]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[fe,[me,Nr],[ce,st]],[/(macintosh);/i],[fe,[me,Nr]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[fe,[me,Cv],[ce,$e]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[fe,[me,bv],[ce,st]],[/honor([-\w ]+)[;\)]/i],[fe,[me,bv],[ce,$e]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[fe,[me,_v],[ce,st]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[fe,[me,_v],[ce,$e]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[fe,/_/g," "],[me,$h],[ce,st]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[fe,/_/g," "],[me,$h],[ce,$e]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[fe,[me,Uh],[ce,$e]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[fe,[me,Os,{OnePlus:["304","403","203"],"*":Uh}],[ce,st]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[fe,[me,"BLU"],[ce,$e]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[fe,[me,"Vivo"],[ce,$e]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[fe,[me,"Realme"],[ce,$e]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[fe,[me,Nh],[ce,$e]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[fe,[me,Nh],[ce,st]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[fe,[me,yo],[ce,st]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch))(\w+)/i,/\blg-?([\d\w]+) bui/i],[fe,[me,yo],[ce,$e]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[fe,[me,Ev],[ce,st]],[/(nokia) (t[12][01])/i],[me,fe,[ce,st]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[fe,/_/g," "],[ce,$e],[me,"Nokia"]],[/(pixel (c|tablet))\b/i],[fe,[me,Zs],[ce,st]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[fe,[me,Zs],[ce,$e]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[fe,[me,xn],[ce,$e]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[fe,"Xperia Tablet"],[me,xn],[ce,st]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[fe,[me,Sv],[ce,$e]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[fe,[me,vo],[ce,st]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[fe,/(.+)/g,"Fire Phone $1"],[me,vo],[ce,$e]],[/(playbook);[-\w\),; ]+(rim)/i],[fe,me,[ce,st]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[fe,[me,Tv],[ce,$e]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[fe,[me,yv],[ce,st]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[fe,[me,yv],[ce,$e]],[/(nexus 9)/i],[fe,[me,"HTC"],[ce,st]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[me,[fe,/_/g," "],[ce,$e]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[fe,[me,"TCL"],[ce,st]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[fe,[me,"TCL"],[ce,$e]],[/(itel) ((\w+))/i],[[me,ls],fe,[ce,Os,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[fe,[me,"Acer"],[ce,st]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[fe,[me,"Meizu"],[ce,$e]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[fe,[me,"Ulefone"],[ce,$e]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[fe,[me,"Energizer"],[ce,$e]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[fe,[me,"Cat"],[ce,$e]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[fe,[me,"Smartfren"],[ce,$e]],[/droid.+; (a(?:015|06[35]|142p?))/i],[fe,[me,"Nothing"],[ce,$e]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[fe,[me,"Archos"],[ce,st]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[fe,[me,"Archos"],[ce,$e]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[me,fe,[ce,st]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[me,fe,[ce,$e]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[me,fe,[ce,st]],[/(surface duo)/i],[fe,[me,Fh],[ce,st]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[fe,[me,"Fairphone"],[ce,$e]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[fe,[me,Bh],[ce,st]],[/(sprint) (\w+)/i],[me,fe,[ce,$e]],[/(kin\.[onetw]{3})/i],[[fe,/\./g," "],[me,Fh],[ce,$e]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[fe,[me,Hh],[ce,st]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[fe,[me,Hh],[ce,$e]],[/smart-tv.+(samsung)/i],[me,[ce,It]],[/hbbtv.+maple;(\d+)/i],[[fe,/^/,"SmartTV"],[me,Dn],[ce,It]],[/tcast.+(lg)e?. ([-\w]+)/i],[me,fe,[ce,It]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[me,yo],[ce,It]],[/(apple) ?tv/i],[me,[fe,Nr+" TV"],[ce,It]],[/crkey.*devicetype\/chromecast/i],[[fe,Cs+" Third Generation"],[me,Zs],[ce,It]],[/crkey.*devicetype\/([^/]*)/i],[[fe,/^/,"Chromecast "],[me,Zs],[ce,It]],[/fuchsia.*crkey/i],[[fe,Cs+" Nest Hub"],[me,Zs],[ce,It]],[/crkey/i],[[fe,Cs],[me,Zs],[ce,It]],[/(portaltv)/i],[fe,[me,jh],[ce,It]],[/droid.+aft(\w+)( bui|\))/i],[fe,[me,vo],[ce,It]],[/(shield \w+ tv)/i],[fe,[me,Bh],[ce,It]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[fe,[me,Cv],[ce,It]],[/(bravia[\w ]+)( bui|\))/i],[fe,[me,xn],[ce,It]],[/(mi(tv|box)-?\w+) bui/i],[fe,[me,$h],[ce,It]],[/Hbbtv.*(technisat) (.*);/i],[me,fe,[ce,It]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[me,ca],[fe,ca],[ce,It]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[fe,[ce,It]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[ce,It]],[/(ouya)/i,/(nintendo) (\w+)/i],[me,fe,[ce,Hn]],[/droid.+; (shield)( bui|\))/i],[fe,[me,Bh],[ce,Hn]],[/(playstation \w+)/i],[fe,[me,xn],[ce,Hn]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[fe,[me,Fh],[ce,Hn]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[fe,[me,Dn],[ce,Ni]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[me,fe,[ce,Ni]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[fe,[me,Uh],[ce,Ni]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[fe,[me,Nr],[ce,Ni]],[/(opwwe\d{3})/i],[fe,[me,Sv],[ce,Ni]],[/(moto 360)/i],[fe,[me,Nh],[ce,Ni]],[/(smartwatch 3)/i],[fe,[me,xn],[ce,Ni]],[/(g watch r)/i],[fe,[me,yo],[ce,Ni]],[/droid.+; (wt63?0{2,3})\)/i],[fe,[me,Hh],[ce,Ni]],[/droid.+; (glass) \d/i],[fe,[me,Zs],[ce,Mh]],[/(pico) (4|neo3(?: link|pro)?)/i],[me,fe,[ce,Mh]],[/(quest( \d| pro)?s?).+vr/i],[fe,[me,jh],[ce,Mh]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[me,[ce,jn]],[/(aeobc)\b/i],[fe,[me,vo],[ce,jn]],[/(homepod).+mac os/i],[fe,[me,Nr],[ce,jn]],[/windows iot/i],[[ce,jn]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[fe,[ce,Os,{mobile:"Mobile",xr:"VR","*":st}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[ce,st]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[ce,$e]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[fe,[me,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[Te,[ye,XI+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[ye,Te],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[Te,[ye,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[ye,Te],[/ladybird\//i],[[ye,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[Te,ye]],os:[[/microsoft (windows) (vista|xp)/i],[ye,Te],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[ye,[Te,Os,Lv]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[Te,Os,Lv],[ye,nf]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[Te,/_/g,"."],[ye,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[ye,"macOS"],[Te,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[Te,[ye,Cs+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[Te,[ye,Cs+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[Te,[ye,Cs+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[Te,[ye,Cs+" Linux"]],[/crkey\/([\d\.]+)/i],[Te,[ye,Cs]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[Te,ye],[/(ubuntu) ([\w\.]+) like android/i],[[ye,/(.+)/,"$1 Touch"],Te],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/\.; ]?([\d\.]*)/i],[ye,Te],[/\(bb(10);/i],[Te,[ye,Tv]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[Te,[ye,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[Te,[ye,On+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[Te,[ye,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[Te,[ye,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[ye,"Chrome OS"],Te],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[ye,Te],[/(sunos) ?([\w\.\d]*)/i],[[ye,"Solaris"],Te],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[ye,Te]]},To=function(){var r={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return us.call(r.init,[[ei,[ye,Te,ha,ce]],[rs,[ti]],[Gi,[ce,fe,me]],[Li,[ye,Te]],[mi,[ye,Te]]]),us.call(r.isIgnore,[[ei,[Te,ha]],[Li,[Te]],[mi,[Te]]]),us.call(r.isIgnoreRgx,[[ei,/ ?browser$/i],[mi,/ ?os$/i]]),us.call(r.toString,[[ei,[ye,Te]],[rs,[ti]],[Gi,[me,fe]],[Li,[ye,Te]],[mi,[ye,Te]]]),r}(),ZI=function(r,e){var t=To.init[e],i=To.isIgnore[e]||0,s=To.isIgnoreRgx[e]||0,n=To.toString[e]||0;function a(){us.call(this,t)}return a.prototype.getItem=function(){return r},a.prototype.withClientHints=function(){return xs?xs.getHighEntropyValues(BT).then(function(l){return r.setCH(new UT(l,!1)).parseCH().get()}):r.parseCH().get()},a.prototype.withFeatureCheck=function(){return r.detectFeature().get()},e!=Xr&&(a.prototype.is=function(l){var c=!1;for(var h in this)if(this.hasOwnProperty(h)&&!af(i,h)&&ls(s?ln(s,this[h]):this[h])==ls(s?ln(s,l):l)){if(c=!0,l!=Ns)break}else if(l==Ns&&c){c=!c;break}return c},a.prototype.toString=function(){var l=an;for(var c in n)typeof this[n[c]]!==Ns&&(l+=(l?" ":an)+this[n[c]]);return l||Ns}),xs||(a.prototype.then=function(l){var c=this,h=function(){for(var p in c)c.hasOwnProperty(p)&&(this[p]=c[p])};h.prototype={is:a.prototype.is,toString:a.prototype.toString};var f=new h;return l(f),f}),new a};function UT(r,e){if(r=r||{},us.call(this,BT),e)us.call(this,[[Gf,Vh(r[Hs])],[Kf,Vh(r[VI])],[$e,/\?1/.test(r[WI])],[fe,Nn(r[zI])],[Qr,Nn(r[NT])],[qf,Nn(r[YI])],[ti,Nn(r[GI])],[rr,Vh(r[qI])],[$l,Nn(r[KI])]]);else for(var t in r)this.hasOwnProperty(t)&&typeof r[t]!==Ns&&(this[t]=r[t])}function Pv(r,e,t,i){return this.get=function(s){return s?this.data.hasOwnProperty(s)?this.data[s]:void 0:this.data},this.set=function(s,n){return this.data[s]=n,this},this.setCH=function(s){return this.uaCH=s,this},this.detectFeature=function(){if(ii&&ii.userAgent==this.ua)switch(this.itemType){case ei:ii.brave&&typeof ii.brave.isBrave==Al&&this.set(ye,"Brave");break;case Gi:!this.get(ce)&&xs&&xs[$e]&&this.set(ce,$e),this.get(fe)=="Macintosh"&&ii&&typeof ii.standalone!==Ns&&ii.maxTouchPoints&&ii.maxTouchPoints>2&&this.set(fe,"iPad").set(ce,st);break;case mi:!this.get(ye)&&xs&&xs[Qr]&&this.set(ye,xs[Qr]);break;case Xr:var s=this.data,n=function(a){return s[a].getItem().detectFeature().get()};this.set(ei,n(ei)).set(rs,n(rs)).set(Gi,n(Gi)).set(Li,n(Li)).set(mi,n(mi))}return this},this.parseUA=function(){return this.itemType!=Xr&&Kh.call(this.data,this.ua,this.rgxMap),this.itemType==ei&&this.set(ha,Gh(this.get(Te))),this},this.parseCH=function(){var s=this.uaCH,n=this.rgxMap;switch(this.itemType){case ei:case Li:var a=s[Kf]||s[Gf],l;if(a)for(var c in a){var h=a[c].brand||a[c],f=a[c].version;this.itemType==ei&&!/not.a.brand/i.test(h)&&(!l||/chrom/i.test(l)&&h!=Av)&&(h=Os(h,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"}),this.set(ye,h).set(Te,f).set(ha,Gh(f)),l=h),this.itemType==Li&&h==Av&&this.set(Te,f)}break;case rs:var p=s[ti];p&&(p&&s[$l]=="64"&&(p+="64"),Kh.call(this.data,p+";",n));break;case Gi:if(s[$e]&&this.set(ce,$e),s[fe]&&(this.set(fe,s[fe]),!this.get(ce)||!this.get(me))){var m={};Kh.call(m,"droid 9; "+s[fe]+")",n),!this.get(ce)&&m.type&&this.set(ce,m.type),!this.get(me)&&m.vendor&&this.set(me,m.vendor)}if(s[rr]){var _;if(typeof s[rr]!="string")for(var E=0;!_&&E<s[rr].length;)_=Os(s[rr][E++],kv);else _=Os(s[rr],kv);this.set(ce,_)}break;case mi:var S=s[Qr];if(S){var C=s[qf];S==nf&&(C=parseInt(Gh(C),10)>=13?"11":"10"),this.set(ye,S).set(Te,C)}this.get(ye)==nf&&s[fe]=="Xbox"&&this.set(ye,"Xbox").set(Te,void 0);break;case Xr:var I=this.data,R=function(k){return I[k].getItem().setCH(s).parseCH().get()};this.set(ei,R(ei)).set(rs,R(rs)).set(Gi,R(Gi)).set(Li,R(Li)).set(mi,R(mi))}return this},us.call(this,[["itemType",r],["ua",e],["uaCH",i],["rgxMap",t],["data",ZI(this,r)]]),this}function cs(r,e,t){if(typeof r===on?(Il(r,!0)?(typeof e===on&&(t=e),e=r):(t=r,e=void 0),r=void 0):typeof r===rf&&!Il(e,!0)&&(t=e,e=void 0),t&&typeof t.append===Al){var i={};t.forEach(function(c,h){i[h]=c}),t=i}if(!(this instanceof cs))return new cs(r,e,t).getResult();var s=typeof r===rf?r:t&&t[mv]?t[mv]:ii&&ii.userAgent?ii.userAgent:an,n=new UT(t,!0),a=e?JI(Rv,e):Rv,l=function(c){return c==Xr?function(){return new Pv(c,s,a,n).set("ua",s).set(ei,this.getBrowser()).set(rs,this.getCPU()).set(Gi,this.getDevice()).set(Li,this.getEngine()).set(mi,this.getOS()).get()}:function(){return new Pv(c,s,a[c],n).parseUA().get()}};return us.call(this,[["getBrowser",l(ei)],["getCPU",l(rs)],["getDevice",l(Gi)],["getEngine",l(Li)],["getOS",l(mi)],["getResult",l(Xr)],["getUA",function(){return s}],["setUA",function(c){return un(c)&&(s=c.length>sf?ca(c,sf):c),this}]]).setUA(s),this}cs.VERSION=jI;cs.BROWSER=Hl([ye,Te,ha,ce]);cs.CPU=Hl([ti]);cs.DEVICE=Hl([fe,me,ce,Hn,$e,It,st,Ni,jn]);cs.ENGINE=cs.OS=Hl([ye,Te]);var Bt=fs("peertube:player:peertube"),eL=X.getPlugin("plugin"),of=class extends eL{constructor(e,t){super(e),this.options=t,this.setUserAgentInfo(),this.menuOpened=!1,this.mouseInControlBar=!1,this.mouseInSettings=!1,this.hasInitialSeek=!1,this.videoViewUrl=t.videoViewUrl,this.authorizationHeader=t.authorizationHeader,this.hasAutoplay=t.hasAutoplay,this.initialInactivityTimeout=this.player.options_.inactivityTimeout,this.currentSubtitle=this.options.subtitle()||tb(),this.initializePlayer(),this.initOnVideoChange(),this.player.removeClass("vjs-can-play"),this.deleteLegacyIndexedDB(),this.player.on("autoplay-failure",()=>{Bt("Autoplay failed"),this.player.removeClass("vjs-has-autoplay"),this.player.poster(t.poster()),(CE()||wE())&&this.player.hasStarted(!1)}),this.player.on("ratechange",()=>{this.currentPlaybackRate=this.player.playbackRate(),this.player.defaultPlaybackRate(this.currentPlaybackRate)}),this.player.one("canplay",()=>{let i=this.player.options_,s=WE();s!==void 0&&this.player.volume(s);let n=i.muted!==void 0?i.muted:zE();n!==void 0&&this.player.muted(n),this.player.addClass("vjs-can-play")}),this.player.ready(()=>{this.player.on("volumechange",()=>{XE(this.player.volume()),QE(this.player.muted())}),this.player.textTracks().addEventListener("change",()=>{let i=this.player.textTracks().tracks_.find(s=>s.kind==="captions"&&s.mode==="showing");if(!i){Sg("off"),this.currentSubtitle=void 0;return}this.currentSubtitle!==i.language&&(this.currentSubtitle=i.language,Sg(i.language),ib(i.language))}),this.player.on("video-change",()=>{this.initOnVideoChange(),this.hideFatalError()}),this.updatePlayerSizeClasses(),typeof ResizeObserver<"u"&&(this.resizeObserver=new ResizeObserver(()=>{this.updatePlayerSizeClasses()}),this.resizeObserver.observe(this.player.el()))}),this.player.on("resolution-change",(i,{resolution:s})=>{if(this.player.paused()){this.player.on("play",()=>this.adaptPosterForAudioOnly(s));return}this.adaptPosterForAudioOnly(s)}),this.initOnRatioChange()}dispose(){this.videoViewInterval&&clearInterval(this.videoViewInterval),this.resizeObserver&&this.resizeObserver.disconnect(),super.dispose()}onMenuOpened(){this.menuOpened=!0,this.alterInactivity()}onMenuClosed(){this.menuOpened=!1,this.alterInactivity()}displayFatalError(){if(this.errorModal)return;Bt("Display fatal error"),this.player.loadingSpinner.hide();let e=t=>{let i=this.player.localize.bind(this.player),s=document.createElement("div"),n=document.createElement("h1");n.innerText=i("Failed to play video"),s.appendChild(n);let a=document.createElement("div");a.innerText=i("The video failed to play due to technical issues."),s.appendChild(a);let l=document.createElement("p");return l.classList.add("error-details"),l.innerText=t.message,s.appendChild(l),s};this.errorModal=this.player.createModal(e(this.player.error()),{temporary:!0,uncloseable:!0}),this.errorModal.addClass("vjs-custom-error-display"),this.player.addClass("vjs-error-display-enabled"),/googlebot/i.test(navigator.userAgent)?console.error(this.player.error()):ze.error("Fatal error in player",this.player.error())}hideFatalError(){this.errorModal&&(Bt("Hiding fatal error"),this.player.removeClass("vjs-error-display-enabled"),this.player.removeChild(this.errorModal),this.errorModal.close(),this.errorModal=void 0,this.player.loadingSpinner&&this.player.loadingSpinner.show())}setUserAgentInfo(){let e=cs(window.navigator.userAgent),t=No()?"mobile":"desktop";this.userAgentInfo={client:e.browser.name,os:e.os.name,device:e.device.type||t}}initializePlayer(){No()&&this.player.addClass("vjs-is-mobile"),this.initSmoothProgressBar(),this.patchMenuEscapeKey(),this.player.ready(()=>{this.listenControlBarMouse()}),this.listenFullScreenChange()}initOnVideoChange(){this.hasAutoplay()!==!1?this.player.addClass("vjs-has-autoplay"):this.player.removeClass("vjs-has-autoplay"),this.currentPlaybackRate&&this.currentPlaybackRate!==1&&(Bt("Setting playback rate to "+this.currentPlaybackRate),this.player.playbackRate(this.currentPlaybackRate)),this.player.ready(()=>{this.initCaptions(),this.updateControlBar()}),this.handleStartStopTime(),this.runUserViewing()}initOnRatioChange(){if(!this.options.autoPlayerRatio)return;let e=getComputedStyle(this.player.el()).getPropertyValue(this.options.autoPlayerRatio.cssRatioVariable),t=()=>{this.options.videoRatio()&&(this.adaptPlayerFromRatio({ratio:this.options.videoRatio(),defaultRatio:e}),this.updatePlayerSizeClasses())};t(),this.player.on("video-change",()=>t()),this.player.on("video-ratio-changed",(i,s)=>{this.options.videoRatio()||(this.adaptPlayerFromRatio({ratio:s.ratio,defaultRatio:e}),this.updatePlayerSizeClasses())})}adaptPlayerFromRatio(e){let{ratio:t,defaultRatio:i}=e,s=this.player.el(),n=getComputedStyle(s).getPropertyValue(this.options.autoPlayerRatio.cssPlayerPortraitModeVariable)==="1",a=isNaN(t)||!n&&t<1?i:t;s.style.setProperty(this.options.autoPlayerRatio.cssRatioVariable,a+"")}runUserViewing(){let e=_o(this.options.startTime()),t=e,i,s=!1;this.disableUserViewing(),this.videoViewOnPlayHandler=()=>{Bt("Notify user is watching on play: "+e),this.notifyUserIsWatching(e,i)},this.videoViewOnSeekedHandler=()=>{if(this.hasInitialSeek){this.hasInitialSeek=!1;return}let n=Math.floor(this.player.currentTime());if(n===0&&this.player.loop()){Bt("Disabling viewing notification after first video loop."),this.disableUserViewing();return}let a=n-t;a>0&&a<3||(Bt("Detected seek event for user watching"),i="seek")},this.videoViewOnEndedHandler=()=>{if(s=!0,this.options.isLive())return;let n=Math.floor(this.player.duration());t=n,Bt("Notify user is watching on end: "+n),this.notifyUserIsWatching(n,i),i=void 0},this.player.one("play",this.videoViewOnPlayHandler),this.player.on("seeked",this.videoViewOnSeekedHandler),this.player.one("ended",this.videoViewOnEndedHandler),this.videoViewInterval=setInterval(()=>{if(s)return;let n=Math.floor(this.player.currentTime());n!==t&&(Bt("Notify user is watching: "+n),t=n,this.notifyUserIsWatching(n,i).catch(a=>ze.error("Cannot notify user is watching.",a)),i=void 0)},this.options.videoViewIntervalMs)}disableUserViewing(){this.videoViewInterval&&(clearInterval(this.videoViewInterval),this.videoViewInterval=void 0),this.videoViewOnPlayHandler&&(this.player.off("play",this.videoViewOnPlayHandler),this.videoViewOnPlayHandler=void 0),this.videoViewOnSeekedHandler&&(this.player.off("seeked",this.videoViewOnSeekedHandler),this.videoViewOnSeekedHandler=void 0),this.videoViewOnEndedHandler&&(this.player.off("ended",this.videoViewOnEndedHandler),this.videoViewOnEndedHandler=void 0)}notifyUserIsWatching(e,t){if(this.authorizationHeader()||rb(this.options.videoUUID(),e),!this.videoViewUrl())return Promise.resolve(!0);let i=nb(),s={currentTime:e,viewEvent:t,sessionId:i,client:this.userAgentInfo.client||void 0,device:this.userAgentInfo.device||void 0,operatingSystem:this.userAgentInfo.os||void 0},n=new Headers({"Content-type":"application/json; charset=UTF-8"});return this.authorizationHeader()&&n.set("Authorization",this.authorizationHeader()),fetch(this.videoViewUrl(),{method:"POST",body:JSON.stringify(s),headers:n})}adaptPosterForAudioOnly(e){if(Bt("Check if we need to adapt player for audio only",e),e===0){this.player.audioPosterMode(!0),this.player.poster(this.options.poster());return}this.player.audioPosterMode(!1),this.player.poster("")}updatePlayerSizeClasses(){requestAnimationFrame(()=>{if(!this.player)return;Bt("Updating player size classes");let e=this.player.currentWidth(),t=[350,570,750];for(let i of t)e<=i?this.player.addClass("vjs-size-"+i):this.player.removeClass("vjs-size-"+i)})}listenFullScreenChange(){this.player.on("fullscreenchange",()=>{this.player.isFullscreen()&&this.player.focus()})}listenControlBarMouse(){let e=this.player.controlBar,t=e.settingsButton;e.on("mouseenter",()=>{this.mouseInControlBar=!0,this.alterInactivity()}),e.on("mouseleave",()=>{this.mouseInControlBar=!1,this.alterInactivity()}),t.dialog.on("mouseenter",()=>{this.mouseInSettings=!0,this.alterInactivity()}),t.dialog.on("mouseleave",()=>{this.mouseInSettings=!1,this.alterInactivity()})}alterInactivity(){if(this.menuOpened||this.mouseInSettings||this.mouseInControlBar){this.setInactivityTimeout(0);return}this.setInactivityTimeout(this.initialInactivityTimeout),this.player.reportUserActivity(!0)}setInactivityTimeout(e){this.player.cache_.inactivityTimeout=e,this.player.options_.inactivityTimeout=e}initCaptions(){this.currentSubtitle?Bt("Init captions with current subtitle "+this.currentSubtitle):Bt("Init captions without current subtitle"),this.player.tech(!0).clearTracks("text"),this.player.removeClass("vjs-has-captions");for(let e of this.options.videoCaptions())this.player.addRemoteTextTrack({kind:"captions",label:e.automaticallyGenerated?this.player.localize("{1} (auto-generated)",[e.label]):e.label,language:e.language,id:e.language,src:e.src,default:this.currentSubtitle===e.language},!0),this.player.addClass("vjs-has-captions");this.player.trigger("captions-changed")}updateControlBar(){Bt("Updating control bar"),this.options.isLive()?(this.getPlaybackRateButton().hide(),this.player.controlBar.getChild("progressControl").hide(),this.player.controlBar.getChild("currentTimeDisplay").hide(),this.player.controlBar.getChild("timeDivider").hide(),this.player.controlBar.getChild("durationDisplay").hide(),this.player.controlBar.getChild("peerTubeLiveDisplay").show()):(this.getPlaybackRateButton().show(),this.player.controlBar.getChild("progressControl").show(),this.player.controlBar.getChild("currentTimeDisplay").show(),this.player.controlBar.getChild("timeDivider").show(),this.player.controlBar.getChild("durationDisplay").show(),this.player.controlBar.getChild("peerTubeLiveDisplay").hide()),this.options.videoCaptions().length===0?this.getCaptionsButton().hide():this.getCaptionsButton().show()}handleStartStopTime(){this.player.duration(this.options.videoDuration()),this.stopTimeHandler&&(this.player.off("timeupdate",this.stopTimeHandler),this.stopTimeHandler=void 0),this.player.one("canplaythrough",()=>{let e=this.options.startTime();if(e!=null&&(Bt("Start the video at "+e),this.hasInitialSeek=!0,this.player.currentTime(_o(e))),this.options.stopTime()){let t=_o(this.options.stopTime());this.stopTimeHandler=()=>{this.player.currentTime()<=t||(Bt("Stopping the video at "+this.options.stopTime()),this.player.pause(),this.player.trigger("auto-stopped"),this.player.off("timeupdate",this.stopTimeHandler),this.stopTimeHandler=void 0)},this.player.on("timeupdate",this.stopTimeHandler)}})}initSmoothProgressBar(){let e=X.getComponent("SeekBar");e.prototype.getPercent=function(){let s=this.player_.currentTime()/this.player_.duration();return s>=1?1:s},e.prototype.handleMouseMove=function(i){let s=this.calculateDistance(i)*this.player_.duration();s===this.player_.duration()&&(s=s-.1),this.player_.currentTime(s),this.update()}}patchMenuEscapeKey(){let e=X.getComponent("Menu"),t=e.prototype.handleKeyDown;e.prototype.handleKeyDown=function(s){if(s.key==="Escape"){s.preventDefault(),s.stopPropagation(),this.trigger("escaped-key");return}if(s.key==="ArrowRight"){s.preventDefault(),s.stopPropagation(),this.trigger("arrow-right",s.target);return}if(s.key==="ArrowLeft"){s.preventDefault(),s.stopPropagation(),this.trigger("arrow-left");return}t.call(this,s)}}getCaptionsButton(){return this.player.controlBar.getDescendant(["settingsButton"]).menu.getChild("captionsButton")}getPlaybackRateButton(){return this.player.controlBar.getDescendant(["settingsButton"]).menu.getChild("playbackRateMenuButton")}deleteLegacyIndexedDB(){try{if(typeof window.indexedDB>"u"||!window.indexedDB||typeof window.indexedDB.databases!="function")return;window.indexedDB.databases().then(e=>{for(let t of e)window.indexedDB.deleteDatabase(t.name)})}catch(e){Bt("Cannot delete legacy indexed DB",e)}}};X.registerPlugin("peertube",of);var lf=class{constructor(e){this.options=e}getChildrenOptions(){return ht(Ue(Ue(Ue(ht(Ue(Ue(Ue(ht(Ue({},this.getPreviousVideo()),{playToggle:{}}),this.getNextVideo()),this.getTimeControls()),this.getProgressControl()),{p2PInfoButton:{},muteToggle:{},volumeControl:{},captionToggleButton:{}}),this.getSettingsButton()),this.getPeerTubeLinkButton()),this.getTheaterButton()),{fullscreenToggle:{}})}getSettingsButton(){let e=[];return e.push("playbackRateMenuButton"),e.push("captionsButton"),e.push("resolutionMenuButton"),{settingsButton:{setup:{maxHeightOffset:60},entries:e}}}getTimeControls(){return{peerTubeLiveDisplay:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{}}}getProgressControl(){return{progressControl:{children:{seekBar:{children:{loadProgressBar:{},mouseTimeDisplay:{},playProgressBar:{}}}}}}}getPreviousVideo(){return{previousVideoButton:{type:"previous",handler:()=>this.options.previousVideo().handler(),isDisabled:()=>!this.options.previousVideo().enabled,isDisplayed:()=>this.options.previousVideo().displayControlBarButton}}}getNextVideo(){return{nextVideoButton:{type:"next",handler:()=>this.options.nextVideo().handler(),isDisabled:()=>!this.options.nextVideo().enabled,isDisplayed:()=>this.options.nextVideo().displayControlBarButton}}}getPeerTubeLinkButton(){return{peerTubeLinkButton:{isDisplayed:this.options.peertubeLink,shortUUID:this.options.videoShortUUID,instanceName:this.options.instanceName}}}getTheaterButton(){return{theaterButton:{isDisplayed:()=>this.options.theaterButton}}}};function uf(r,e){let t=new URL(r),i=new URL(e);return t.hostname==="localhost"&&i.hostname==="localhost"?!0:t.origin===i.origin}var hf=class{constructor(e=[]){Qe(this,"map",new Map),this.baseUrls=e}onSegmentError(e){if(!this.map.has(e))return;let t=this.map.get(e);this.map.delete(e);let i=iL(t),s=i.length;this.baseUrls=this.baseUrls.filter(n=>n!==i&&n!==i+"/"),s!==this.baseUrls.length&&ze.info(`Removed redundancy of segment URL ${t}.`)}onSegmentSuccess(e){this.map.delete(e)}buildUrl(e){let t=this.baseUrls.length+1,i=this.getRandomInt(t);if(i===t-1)return e;let s=this.baseUrls[i],n=s.endsWith("/")?"":"/",a=s+n+tL(e);return this.map.set(e,a),a}countBaseUrls(){return this.baseUrls.length}getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}};function tL(r){return r.split("/").pop()}function iL(r){let e=r.split("/");return e.pop(),e.join("/")}var $T={},jl={};jl.byteLength=rL;jl.toByteArray=aL;jl.fromByteArray=uL;var Ki=[],pi=[],sL=typeof Uint8Array<"u"?Uint8Array:Array,qh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(er=0,Dv=qh.length;er<Dv;++er)Ki[er]=qh[er],pi[qh.charCodeAt(er)]=er;var er,Dv;pi[45]=62;pi[95]=63;function HT(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function rL(r){var e=HT(r),t=e[0],i=e[1];return(t+i)*3/4-i}function nL(r,e,t){return(e+t)*3/4-t}function aL(r){var e,t=HT(r),i=t[0],s=t[1],n=new sL(nL(r,i,s)),a=0,l=s>0?i-4:i,c;for(c=0;c<l;c+=4)e=pi[r.charCodeAt(c)]<<18|pi[r.charCodeAt(c+1)]<<12|pi[r.charCodeAt(c+2)]<<6|pi[r.charCodeAt(c+3)],n[a++]=e>>16&255,n[a++]=e>>8&255,n[a++]=e&255;return s===2&&(e=pi[r.charCodeAt(c)]<<2|pi[r.charCodeAt(c+1)]>>4,n[a++]=e&255),s===1&&(e=pi[r.charCodeAt(c)]<<10|pi[r.charCodeAt(c+1)]<<4|pi[r.charCodeAt(c+2)]>>2,n[a++]=e>>8&255,n[a++]=e&255),n}function oL(r){return Ki[r>>18&63]+Ki[r>>12&63]+Ki[r>>6&63]+Ki[r&63]}function lL(r,e,t){for(var i,s=[],n=e;n<t;n+=3)i=(r[n]<<16&16711680)+(r[n+1]<<8&65280)+(r[n+2]&255),s.push(oL(i));return s.join("")}function uL(r){for(var e,t=r.length,i=t%3,s=[],n=16383,a=0,l=t-i;a<l;a+=n)s.push(lL(r,a,a+n>l?l:a+n));return i===1?(e=r[t-1],s.push(Ki[e>>2]+Ki[e<<4&63]+"==")):i===2&&(e=(r[t-2]<<8)+r[t-1],s.push(Ki[e>>10]+Ki[e>>4&63]+Ki[e<<2&63]+"=")),s.join("")}var Wf={};Wf.read=function(r,e,t,i,s){var n,a,l=s*8-i-1,c=(1<<l)-1,h=c>>1,f=-7,p=t?s-1:0,m=t?-1:1,_=r[e+p];for(p+=m,n=_&(1<<-f)-1,_>>=-f,f+=l;f>0;n=n*256+r[e+p],p+=m,f-=8);for(a=n&(1<<-f)-1,n>>=-f,f+=i;f>0;a=a*256+r[e+p],p+=m,f-=8);if(n===0)n=1-h;else{if(n===c)return a?NaN:(_?-1:1)*(1/0);a=a+Math.pow(2,i),n=n-h}return(_?-1:1)*a*Math.pow(2,n-i)};Wf.write=function(r,e,t,i,s,n){var a,l,c,h=n*8-s-1,f=(1<<h)-1,p=f>>1,m=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=i?0:n-1,E=i?1:-1,S=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+p>=1?e+=m/c:e+=m*Math.pow(2,1-p),e*c>=2&&(a++,c/=2),a+p>=f?(l=0,a=f):a+p>=1?(l=(e*c-1)*Math.pow(2,s),a=a+p):(l=e*Math.pow(2,p-1)*Math.pow(2,s),a=0));s>=8;r[t+_]=l&255,_+=E,l/=256,s-=8);for(a=a<<s|l,h+=s;h>0;r[t+_]=a&255,_+=E,a/=256,h-=8);r[t+_-E]|=S*128};(function(r){let e=jl,t=Wf,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=f,r.SlowBuffer=x,r.INSPECT_MAX_BYTES=50;let s=2147483647;r.kMaxLength=s;let{Uint8Array:n,ArrayBuffer:a,SharedArrayBuffer:l}=globalThis;f.TYPED_ARRAY_SUPPORT=c(),!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{let M=new n(1),b={foo:function(){return 42}};return Object.setPrototypeOf(b,n.prototype),Object.setPrototypeOf(M,b),M.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function h(M){if(M>s)throw new RangeError('The value "'+M+'" is invalid for option "size"');let b=new n(M);return Object.setPrototypeOf(b,f.prototype),b}function f(M,b,A){if(typeof M=="number"){if(typeof b=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(M)}return p(M,b,A)}f.poolSize=8192;function p(M,b,A){if(typeof M=="string")return S(M,b);if(a.isView(M))return I(M);if(M==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M);if(wt(M,a)||M&&wt(M.buffer,a)||typeof l<"u"&&(wt(M,l)||M&&wt(M.buffer,l)))return R(M,b,A);if(typeof M=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let j=M.valueOf&&M.valueOf();if(j!=null&&j!==M)return f.from(j,b,A);let q=k(M);if(q)return q;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof M[Symbol.toPrimitive]=="function")return f.from(M[Symbol.toPrimitive]("string"),b,A);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M)}f.from=function(M,b,A){return p(M,b,A)},Object.setPrototypeOf(f.prototype,n.prototype),Object.setPrototypeOf(f,n);function m(M){if(typeof M!="number")throw new TypeError('"size" argument must be of type number');if(M<0)throw new RangeError('The value "'+M+'" is invalid for option "size"')}function _(M,b,A){return m(M),M<=0?h(M):b!==void 0?typeof A=="string"?h(M).fill(b,A):h(M).fill(b):h(M)}f.alloc=function(M,b,A){return _(M,b,A)};function E(M){return m(M),h(M<0?0:D(M)|0)}f.allocUnsafe=function(M){return E(M)},f.allocUnsafeSlow=function(M){return E(M)};function S(M,b){if((typeof b!="string"||b==="")&&(b="utf8"),!f.isEncoding(b))throw new TypeError("Unknown encoding: "+b);let A=N(M,b)|0,j=h(A),q=j.write(M,b);return q!==A&&(j=j.slice(0,q)),j}function C(M){let b=M.length<0?0:D(M.length)|0,A=h(b);for(let j=0;j<b;j+=1)A[j]=M[j]&255;return A}function I(M){if(wt(M,n)){let b=new n(M);return R(b.buffer,b.byteOffset,b.byteLength)}return C(M)}function R(M,b,A){if(b<0||M.byteLength<b)throw new RangeError('"offset" is outside of buffer bounds');if(M.byteLength<b+(A||0))throw new RangeError('"length" is outside of buffer bounds');let j;return b===void 0&&A===void 0?j=new n(M):A===void 0?j=new n(M,b):j=new n(M,b,A),Object.setPrototypeOf(j,f.prototype),j}function k(M){if(f.isBuffer(M)){let b=D(M.length)|0,A=h(b);return A.length===0||M.copy(A,0,0,b),A}if(M.length!==void 0)return typeof M.length!="number"||Pt(M.length)?h(0):C(M);if(M.type==="Buffer"&&Array.isArray(M.data))return C(M.data)}function D(M){if(M>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return M|0}function x(M){return+M!=M&&(M=0),f.alloc(+M)}f.isBuffer=function(b){return b!=null&&b._isBuffer===!0&&b!==f.prototype},f.compare=function(b,A){if(wt(b,n)&&(b=f.from(b,b.offset,b.byteLength)),wt(A,n)&&(A=f.from(A,A.offset,A.byteLength)),!f.isBuffer(b)||!f.isBuffer(A))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(b===A)return 0;let j=b.length,q=A.length;for(let J=0,le=Math.min(j,q);J<le;++J)if(b[J]!==A[J]){j=b[J],q=A[J];break}return j<q?-1:q<j?1:0},f.isEncoding=function(b){switch(String(b).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(b,A){if(!Array.isArray(b))throw new TypeError('"list" argument must be an Array of Buffers');if(b.length===0)return f.alloc(0);let j;if(A===void 0)for(A=0,j=0;j<b.length;++j)A+=b[j].length;let q=f.allocUnsafe(A),J=0;for(j=0;j<b.length;++j){let le=b[j];if(wt(le,n))J+le.length>q.length?(f.isBuffer(le)||(le=f.from(le)),le.copy(q,J)):n.prototype.set.call(q,le,J);else if(f.isBuffer(le))le.copy(q,J);else throw new TypeError('"list" argument must be an Array of Buffers');J+=le.length}return q};function N(M,b){if(f.isBuffer(M))return M.length;if(a.isView(M)||wt(M,a))return M.byteLength;if(typeof M!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof M);let A=M.length,j=arguments.length>2&&arguments[2]===!0;if(!j&&A===0)return 0;let q=!1;for(;;)switch(b){case"ascii":case"latin1":case"binary":return A;case"utf8":case"utf-8":return Ct(M).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A*2;case"hex":return A>>>1;case"base64":return Ti(M).length;default:if(q)return j?-1:Ct(M).length;b=(""+b).toLowerCase(),q=!0}}f.byteLength=N;function B(M,b,A){let j=!1;if((b===void 0||b<0)&&(b=0),b>this.length||((A===void 0||A>this.length)&&(A=this.length),A<=0)||(A>>>=0,b>>>=0,A<=b))return"";for(M||(M="utf8");;)switch(M){case"hex":return Y(this,b,A);case"utf8":case"utf-8":return de(this,b,A);case"ascii":return se(this,b,A);case"latin1":case"binary":return oe(this,b,A);case"base64":return ne(this,b,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ee(this,b,A);default:if(j)throw new TypeError("Unknown encoding: "+M);M=(M+"").toLowerCase(),j=!0}}f.prototype._isBuffer=!0;function H(M,b,A){let j=M[b];M[b]=M[A],M[A]=j}f.prototype.swap16=function(){let b=this.length;if(b%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let A=0;A<b;A+=2)H(this,A,A+1);return this},f.prototype.swap32=function(){let b=this.length;if(b%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let A=0;A<b;A+=4)H(this,A,A+3),H(this,A+1,A+2);return this},f.prototype.swap64=function(){let b=this.length;if(b%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let A=0;A<b;A+=8)H(this,A,A+7),H(this,A+1,A+6),H(this,A+2,A+5),H(this,A+3,A+4);return this},f.prototype.toString=function(){let b=this.length;return b===0?"":arguments.length===0?de(this,0,b):B.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(b){if(!f.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:f.compare(this,b)===0},f.prototype.inspect=function(){let b="",A=r.INSPECT_MAX_BYTES;return b=this.toString("hex",0,A).replace(/(.{2})/g,"$1 ").trim(),this.length>A&&(b+=" ... "),"<Buffer "+b+">"},i&&(f.prototype[i]=f.prototype.inspect),f.prototype.compare=function(b,A,j,q,J){if(wt(b,n)&&(b=f.from(b,b.offset,b.byteLength)),!f.isBuffer(b))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof b);if(A===void 0&&(A=0),j===void 0&&(j=b?b.length:0),q===void 0&&(q=0),J===void 0&&(J=this.length),A<0||j>b.length||q<0||J>this.length)throw new RangeError("out of range index");if(q>=J&&A>=j)return 0;if(q>=J)return-1;if(A>=j)return 1;if(A>>>=0,j>>>=0,q>>>=0,J>>>=0,this===b)return 0;let le=J-q,Me=j-A,nt=Math.min(le,Me),et=this.slice(q,J),ke=b.slice(A,j);for(let qe=0;qe<nt;++qe)if(et[qe]!==ke[qe]){le=et[qe],Me=ke[qe];break}return le<Me?-1:Me<le?1:0};function O(M,b,A,j,q){if(M.length===0)return-1;if(typeof A=="string"?(j=A,A=0):A>2147483647?A=2147483647:A<-2147483648&&(A=-2147483648),A=+A,Pt(A)&&(A=q?0:M.length-1),A<0&&(A=M.length+A),A>=M.length){if(q)return-1;A=M.length-1}else if(A<0)if(q)A=0;else return-1;if(typeof b=="string"&&(b=f.from(b,j)),f.isBuffer(b))return b.length===0?-1:P(M,b,A,j,q);if(typeof b=="number")return b=b&255,typeof n.prototype.indexOf=="function"?q?n.prototype.indexOf.call(M,b,A):n.prototype.lastIndexOf.call(M,b,A):P(M,[b],A,j,q);throw new TypeError("val must be string, number or Buffer")}function P(M,b,A,j,q){let J=1,le=M.length,Me=b.length;if(j!==void 0&&(j=String(j).toLowerCase(),j==="ucs2"||j==="ucs-2"||j==="utf16le"||j==="utf-16le")){if(M.length<2||b.length<2)return-1;J=2,le/=2,Me/=2,A/=2}function nt(ke,qe){return J===1?ke[qe]:ke.readUInt16BE(qe*J)}let et;if(q){let ke=-1;for(et=A;et<le;et++)if(nt(M,et)===nt(b,ke===-1?0:et-ke)){if(ke===-1&&(ke=et),et-ke+1===Me)return ke*J}else ke!==-1&&(et-=et-ke),ke=-1}else for(A+Me>le&&(A=le-Me),et=A;et>=0;et--){let ke=!0;for(let qe=0;qe<Me;qe++)if(nt(M,et+qe)!==nt(b,qe)){ke=!1;break}if(ke)return et}return-1}f.prototype.includes=function(b,A,j){return this.indexOf(b,A,j)!==-1},f.prototype.indexOf=function(b,A,j){return O(this,b,A,j,!0)},f.prototype.lastIndexOf=function(b,A,j){return O(this,b,A,j,!1)};function G(M,b,A,j){A=Number(A)||0;let q=M.length-A;j?(j=Number(j),j>q&&(j=q)):j=q;let J=b.length;j>J/2&&(j=J/2);let le;for(le=0;le<j;++le){let Me=parseInt(b.substr(le*2,2),16);if(Pt(Me))return le;M[A+le]=Me}return le}function Q(M,b,A,j){return Ft(Ct(b,M.length-A),M,A,j)}function ie(M,b,A,j){return Ft(Ut(b),M,A,j)}function te(M,b,A,j){return Ft(Ti(b),M,A,j)}function re(M,b,A,j){return Ft(yt(b,M.length-A),M,A,j)}f.prototype.write=function(b,A,j,q){if(A===void 0)q="utf8",j=this.length,A=0;else if(j===void 0&&typeof A=="string")q=A,j=this.length,A=0;else if(isFinite(A))A=A>>>0,isFinite(j)?(j=j>>>0,q===void 0&&(q="utf8")):(q=j,j=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let J=this.length-A;if((j===void 0||j>J)&&(j=J),b.length>0&&(j<0||A<0)||A>this.length)throw new RangeError("Attempt to write outside buffer bounds");q||(q="utf8");let le=!1;for(;;)switch(q){case"hex":return G(this,b,A,j);case"utf8":case"utf-8":return Q(this,b,A,j);case"ascii":case"latin1":case"binary":return ie(this,b,A,j);case"base64":return te(this,b,A,j);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return re(this,b,A,j);default:if(le)throw new TypeError("Unknown encoding: "+q);q=(""+q).toLowerCase(),le=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ne(M,b,A){return b===0&&A===M.length?e.fromByteArray(M):e.fromByteArray(M.slice(b,A))}function de(M,b,A){A=Math.min(M.length,A);let j=[],q=b;for(;q<A;){let J=M[q],le=null,Me=J>239?4:J>223?3:J>191?2:1;if(q+Me<=A){let nt,et,ke,qe;switch(Me){case 1:J<128&&(le=J);break;case 2:nt=M[q+1],(nt&192)===128&&(qe=(J&31)<<6|nt&63,qe>127&&(le=qe));break;case 3:nt=M[q+1],et=M[q+2],(nt&192)===128&&(et&192)===128&&(qe=(J&15)<<12|(nt&63)<<6|et&63,qe>2047&&(qe<55296||qe>57343)&&(le=qe));break;case 4:nt=M[q+1],et=M[q+2],ke=M[q+3],(nt&192)===128&&(et&192)===128&&(ke&192)===128&&(qe=(J&15)<<18|(nt&63)<<12|(et&63)<<6|ke&63,qe>65535&&qe<1114112&&(le=qe))}}le===null?(le=65533,Me=1):le>65535&&(le-=65536,j.push(le>>>10&1023|55296),le=56320|le&1023),j.push(le),q+=Me}return ae(j)}let Z=4096;function ae(M){let b=M.length;if(b<=Z)return String.fromCharCode.apply(String,M);let A="",j=0;for(;j<b;)A+=String.fromCharCode.apply(String,M.slice(j,j+=Z));return A}function se(M,b,A){let j="";A=Math.min(M.length,A);for(let q=b;q<A;++q)j+=String.fromCharCode(M[q]&127);return j}function oe(M,b,A){let j="";A=Math.min(M.length,A);for(let q=b;q<A;++q)j+=String.fromCharCode(M[q]);return j}function Y(M,b,A){let j=M.length;(!b||b<0)&&(b=0),(!A||A<0||A>j)&&(A=j);let q="";for(let J=b;J<A;++J)q+=zt[M[J]];return q}function ee(M,b,A){let j=M.slice(b,A),q="";for(let J=0;J<j.length-1;J+=2)q+=String.fromCharCode(j[J]+j[J+1]*256);return q}f.prototype.slice=function(b,A){let j=this.length;b=~~b,A=A===void 0?j:~~A,b<0?(b+=j,b<0&&(b=0)):b>j&&(b=j),A<0?(A+=j,A<0&&(A=0)):A>j&&(A=j),A<b&&(A=b);let q=this.subarray(b,A);return Object.setPrototypeOf(q,f.prototype),q};function be(M,b,A){if(M%1!==0||M<0)throw new RangeError("offset is not uint");if(M+b>A)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(b,A,j){b=b>>>0,A=A>>>0,j||be(b,A,this.length);let q=this[b],J=1,le=0;for(;++le<A&&(J*=256);)q+=this[b+le]*J;return q},f.prototype.readUintBE=f.prototype.readUIntBE=function(b,A,j){b=b>>>0,A=A>>>0,j||be(b,A,this.length);let q=this[b+--A],J=1;for(;A>0&&(J*=256);)q+=this[b+--A]*J;return q},f.prototype.readUint8=f.prototype.readUInt8=function(b,A){return b=b>>>0,A||be(b,1,this.length),this[b]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(b,A){return b=b>>>0,A||be(b,2,this.length),this[b]|this[b+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(b,A){return b=b>>>0,A||be(b,2,this.length),this[b]<<8|this[b+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(b,A){return b=b>>>0,A||be(b,4,this.length),(this[b]|this[b+1]<<8|this[b+2]<<16)+this[b+3]*16777216},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(b,A){return b=b>>>0,A||be(b,4,this.length),this[b]*16777216+(this[b+1]<<16|this[b+2]<<8|this[b+3])},f.prototype.readBigUInt64LE=Dt(function(b){b=b>>>0,xe(b,"offset");let A=this[b],j=this[b+7];(A===void 0||j===void 0)&&Ke(b,this.length-8);let q=A+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24,J=this[++b]+this[++b]*2**8+this[++b]*2**16+j*2**24;return BigInt(q)+(BigInt(J)<<BigInt(32))}),f.prototype.readBigUInt64BE=Dt(function(b){b=b>>>0,xe(b,"offset");let A=this[b],j=this[b+7];(A===void 0||j===void 0)&&Ke(b,this.length-8);let q=A*2**24+this[++b]*2**16+this[++b]*2**8+this[++b],J=this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+j;return(BigInt(q)<<BigInt(32))+BigInt(J)}),f.prototype.readIntLE=function(b,A,j){b=b>>>0,A=A>>>0,j||be(b,A,this.length);let q=this[b],J=1,le=0;for(;++le<A&&(J*=256);)q+=this[b+le]*J;return J*=128,q>=J&&(q-=Math.pow(2,8*A)),q},f.prototype.readIntBE=function(b,A,j){b=b>>>0,A=A>>>0,j||be(b,A,this.length);let q=A,J=1,le=this[b+--q];for(;q>0&&(J*=256);)le+=this[b+--q]*J;return J*=128,le>=J&&(le-=Math.pow(2,8*A)),le},f.prototype.readInt8=function(b,A){return b=b>>>0,A||be(b,1,this.length),this[b]&128?(255-this[b]+1)*-1:this[b]},f.prototype.readInt16LE=function(b,A){b=b>>>0,A||be(b,2,this.length);let j=this[b]|this[b+1]<<8;return j&32768?j|4294901760:j},f.prototype.readInt16BE=function(b,A){b=b>>>0,A||be(b,2,this.length);let j=this[b+1]|this[b]<<8;return j&32768?j|4294901760:j},f.prototype.readInt32LE=function(b,A){return b=b>>>0,A||be(b,4,this.length),this[b]|this[b+1]<<8|this[b+2]<<16|this[b+3]<<24},f.prototype.readInt32BE=function(b,A){return b=b>>>0,A||be(b,4,this.length),this[b]<<24|this[b+1]<<16|this[b+2]<<8|this[b+3]},f.prototype.readBigInt64LE=Dt(function(b){b=b>>>0,xe(b,"offset");let A=this[b],j=this[b+7];(A===void 0||j===void 0)&&Ke(b,this.length-8);let q=this[b+4]+this[b+5]*2**8+this[b+6]*2**16+(j<<24);return(BigInt(q)<<BigInt(32))+BigInt(A+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24)}),f.prototype.readBigInt64BE=Dt(function(b){b=b>>>0,xe(b,"offset");let A=this[b],j=this[b+7];(A===void 0||j===void 0)&&Ke(b,this.length-8);let q=(A<<24)+this[++b]*2**16+this[++b]*2**8+this[++b];return(BigInt(q)<<BigInt(32))+BigInt(this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+j)}),f.prototype.readFloatLE=function(b,A){return b=b>>>0,A||be(b,4,this.length),t.read(this,b,!0,23,4)},f.prototype.readFloatBE=function(b,A){return b=b>>>0,A||be(b,4,this.length),t.read(this,b,!1,23,4)},f.prototype.readDoubleLE=function(b,A){return b=b>>>0,A||be(b,8,this.length),t.read(this,b,!0,52,8)},f.prototype.readDoubleBE=function(b,A){return b=b>>>0,A||be(b,8,this.length),t.read(this,b,!1,52,8)};function Ee(M,b,A,j,q,J){if(!f.isBuffer(M))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>q||b<J)throw new RangeError('"value" argument is out of bounds');if(A+j>M.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(b,A,j,q){if(b=+b,A=A>>>0,j=j>>>0,!q){let Me=Math.pow(2,8*j)-1;Ee(this,b,A,j,Me,0)}let J=1,le=0;for(this[A]=b&255;++le<j&&(J*=256);)this[A+le]=b/J&255;return A+j},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(b,A,j,q){if(b=+b,A=A>>>0,j=j>>>0,!q){let Me=Math.pow(2,8*j)-1;Ee(this,b,A,j,Me,0)}let J=j-1,le=1;for(this[A+J]=b&255;--J>=0&&(le*=256);)this[A+J]=b/le&255;return A+j},f.prototype.writeUint8=f.prototype.writeUInt8=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,1,255,0),this[A]=b&255,A+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,2,65535,0),this[A]=b&255,this[A+1]=b>>>8,A+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,2,65535,0),this[A]=b>>>8,this[A+1]=b&255,A+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,4,4294967295,0),this[A+3]=b>>>24,this[A+2]=b>>>16,this[A+1]=b>>>8,this[A]=b&255,A+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,4,4294967295,0),this[A]=b>>>24,this[A+1]=b>>>16,this[A+2]=b>>>8,this[A+3]=b&255,A+4};function Re(M,b,A,j,q){Ri(b,j,q,M,A,7);let J=Number(b&BigInt(4294967295));M[A++]=J,J=J>>8,M[A++]=J,J=J>>8,M[A++]=J,J=J>>8,M[A++]=J;let le=Number(b>>BigInt(32)&BigInt(4294967295));return M[A++]=le,le=le>>8,M[A++]=le,le=le>>8,M[A++]=le,le=le>>8,M[A++]=le,A}function Oe(M,b,A,j,q){Ri(b,j,q,M,A,7);let J=Number(b&BigInt(4294967295));M[A+7]=J,J=J>>8,M[A+6]=J,J=J>>8,M[A+5]=J,J=J>>8,M[A+4]=J;let le=Number(b>>BigInt(32)&BigInt(4294967295));return M[A+3]=le,le=le>>8,M[A+2]=le,le=le>>8,M[A+1]=le,le=le>>8,M[A]=le,A+8}f.prototype.writeBigUInt64LE=Dt(function(b,A=0){return Re(this,b,A,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeBigUInt64BE=Dt(function(b,A=0){return Oe(this,b,A,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeIntLE=function(b,A,j,q){if(b=+b,A=A>>>0,!q){let nt=Math.pow(2,8*j-1);Ee(this,b,A,j,nt-1,-nt)}let J=0,le=1,Me=0;for(this[A]=b&255;++J<j&&(le*=256);)b<0&&Me===0&&this[A+J-1]!==0&&(Me=1),this[A+J]=(b/le>>0)-Me&255;return A+j},f.prototype.writeIntBE=function(b,A,j,q){if(b=+b,A=A>>>0,!q){let nt=Math.pow(2,8*j-1);Ee(this,b,A,j,nt-1,-nt)}let J=j-1,le=1,Me=0;for(this[A+J]=b&255;--J>=0&&(le*=256);)b<0&&Me===0&&this[A+J+1]!==0&&(Me=1),this[A+J]=(b/le>>0)-Me&255;return A+j},f.prototype.writeInt8=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,1,127,-128),b<0&&(b=255+b+1),this[A]=b&255,A+1},f.prototype.writeInt16LE=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,2,32767,-32768),this[A]=b&255,this[A+1]=b>>>8,A+2},f.prototype.writeInt16BE=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,2,32767,-32768),this[A]=b>>>8,this[A+1]=b&255,A+2},f.prototype.writeInt32LE=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,4,2147483647,-2147483648),this[A]=b&255,this[A+1]=b>>>8,this[A+2]=b>>>16,this[A+3]=b>>>24,A+4},f.prototype.writeInt32BE=function(b,A,j){return b=+b,A=A>>>0,j||Ee(this,b,A,4,2147483647,-2147483648),b<0&&(b=4294967295+b+1),this[A]=b>>>24,this[A+1]=b>>>16,this[A+2]=b>>>8,this[A+3]=b&255,A+4},f.prototype.writeBigInt64LE=Dt(function(b,A=0){return Re(this,b,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeBigInt64BE=Dt(function(b,A=0){return Oe(this,b,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Pe(M,b,A,j,q,J){if(A+j>M.length)throw new RangeError("Index out of range");if(A<0)throw new RangeError("Index out of range")}function Be(M,b,A,j,q){return b=+b,A=A>>>0,q||Pe(M,b,A,4),t.write(M,b,A,j,23,4),A+4}f.prototype.writeFloatLE=function(b,A,j){return Be(this,b,A,!0,j)},f.prototype.writeFloatBE=function(b,A,j){return Be(this,b,A,!1,j)};function Ve(M,b,A,j,q){return b=+b,A=A>>>0,q||Pe(M,b,A,8),t.write(M,b,A,j,52,8),A+8}f.prototype.writeDoubleLE=function(b,A,j){return Ve(this,b,A,!0,j)},f.prototype.writeDoubleBE=function(b,A,j){return Ve(this,b,A,!1,j)},f.prototype.copy=function(b,A,j,q){if(!f.isBuffer(b))throw new TypeError("argument should be a Buffer");if(j||(j=0),!q&&q!==0&&(q=this.length),A>=b.length&&(A=b.length),A||(A=0),q>0&&q<j&&(q=j),q===j||b.length===0||this.length===0)return 0;if(A<0)throw new RangeError("targetStart out of bounds");if(j<0||j>=this.length)throw new RangeError("Index out of range");if(q<0)throw new RangeError("sourceEnd out of bounds");q>this.length&&(q=this.length),b.length-A<q-j&&(q=b.length-A+j);let J=q-j;return this===b&&typeof n.prototype.copyWithin=="function"?this.copyWithin(A,j,q):n.prototype.set.call(b,this.subarray(j,q),A),J},f.prototype.fill=function(b,A,j,q){if(typeof b=="string"){if(typeof A=="string"?(q=A,A=0,j=this.length):typeof j=="string"&&(q=j,j=this.length),q!==void 0&&typeof q!="string")throw new TypeError("encoding must be a string");if(typeof q=="string"&&!f.isEncoding(q))throw new TypeError("Unknown encoding: "+q);if(b.length===1){let le=b.charCodeAt(0);(q==="utf8"&&le<128||q==="latin1")&&(b=le)}}else typeof b=="number"?b=b&255:typeof b=="boolean"&&(b=Number(b));if(A<0||this.length<A||this.length<j)throw new RangeError("Out of range index");if(j<=A)return this;A=A>>>0,j=j===void 0?this.length:j>>>0,b||(b=0);let J;if(typeof b=="number")for(J=A;J<j;++J)this[J]=b;else{let le=f.isBuffer(b)?b:f.from(b,q),Me=le.length;if(Me===0)throw new TypeError('The value "'+b+'" is invalid for argument "value"');for(J=0;J<j-A;++J)this[J+A]=le[J%Me]}return this};let Je={};function Ye(M,b,A){Je[M]=class extends A{constructor(){super(),Object.defineProperty(this,"message",{value:b.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${M}]`,this.stack,delete this.name}get code(){return M}set code(q){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:q,writable:!0})}toString(){return`${this.name} [${M}]: ${this.message}`}}}Ye("ERR_BUFFER_OUT_OF_BOUNDS",function(M){return M?`${M} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ye("ERR_INVALID_ARG_TYPE",function(M,b){return`The "${M}" argument must be of type number. Received type ${typeof b}`},TypeError),Ye("ERR_OUT_OF_RANGE",function(M,b,A){let j=`The value of "${M}" is out of range.`,q=A;return Number.isInteger(A)&&Math.abs(A)>2**32?q=ni(String(A)):typeof A=="bigint"&&(q=String(A),(A>BigInt(2)**BigInt(32)||A<-(BigInt(2)**BigInt(32)))&&(q=ni(q)),q+="n"),j+=` It must be ${b}. Received ${q}`,j},RangeError);function ni(M){let b="",A=M.length,j=M[0]==="-"?1:0;for(;A>=j+4;A-=3)b=`_${M.slice(A-3,A)}${b}`;return`${M.slice(0,A)}${b}`}function Wt(M,b,A){xe(b,"offset"),(M[b]===void 0||M[b+A]===void 0)&&Ke(b,M.length-(A+1))}function Ri(M,b,A,j,q,J){if(M>A||M<b){let le=typeof b=="bigint"?"n":"",Me;throw b===0||b===BigInt(0)?Me=`>= 0${le} and < 2${le} ** ${(J+1)*8}${le}`:Me=`>= -(2${le} ** ${(J+1)*8-1}${le}) and < 2 ** ${(J+1)*8-1}${le}`,new Je.ERR_OUT_OF_RANGE("value",Me,M)}Wt(j,q,J)}function xe(M,b){if(typeof M!="number")throw new Je.ERR_INVALID_ARG_TYPE(b,"number",M)}function Ke(M,b,A){throw Math.floor(M)!==M?(xe(M,A),new Je.ERR_OUT_OF_RANGE("offset","an integer",M)):b<0?new Je.ERR_BUFFER_OUT_OF_BOUNDS:new Je.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${b}`,M)}let St=/[^+/0-9A-Za-z-_]/g;function Vt(M){if(M=M.split("=")[0],M=M.trim().replace(St,""),M.length<2)return"";for(;M.length%4!==0;)M=M+"=";return M}function Ct(M,b){b=b||1/0;let A,j=M.length,q=null,J=[];for(let le=0;le<j;++le){if(A=M.charCodeAt(le),A>55295&&A<57344){if(!q){if(A>56319){(b-=3)>-1&&J.push(239,191,189);continue}else if(le+1===j){(b-=3)>-1&&J.push(239,191,189);continue}q=A;continue}if(A<56320){(b-=3)>-1&&J.push(239,191,189),q=A;continue}A=(q-55296<<10|A-56320)+65536}else q&&(b-=3)>-1&&J.push(239,191,189);if(q=null,A<128){if((b-=1)<0)break;J.push(A)}else if(A<2048){if((b-=2)<0)break;J.push(A>>6|192,A&63|128)}else if(A<65536){if((b-=3)<0)break;J.push(A>>12|224,A>>6&63|128,A&63|128)}else if(A<1114112){if((b-=4)<0)break;J.push(A>>18|240,A>>12&63|128,A>>6&63|128,A&63|128)}else throw new Error("Invalid code point")}return J}function Ut(M){let b=[];for(let A=0;A<M.length;++A)b.push(M.charCodeAt(A)&255);return b}function yt(M,b){let A,j,q,J=[];for(let le=0;le<M.length&&!((b-=2)<0);++le)A=M.charCodeAt(le),j=A>>8,q=A%256,J.push(q),J.push(j);return J}function Ti(M){return e.toByteArray(Vt(M))}function Ft(M,b,A,j){let q;for(q=0;q<j&&!(q+A>=b.length||q>=M.length);++q)b[q+A]=M[q];return q}function wt(M,b){return M instanceof b||M!=null&&M.constructor!=null&&M.constructor.name!=null&&M.constructor.name===b.name}function Pt(M){return M!==M}let zt=function(){let M="0123456789abcdef",b=new Array(256);for(let A=0;A<16;++A){let j=A*16;for(let q=0;q<16;++q)b[j+q]=M[A]+M[q]}return b}();function Dt(M){return typeof BigInt>"u"?kt:M}function kt(){throw new Error("BigInt not supported")}})($T);var hL=$T.Buffer,cL=fs("peertube:player:segment-validator"),dL=10,cf=class{constructor(e){Qe(this,"destroyed",!1),Qe(this,"segmentJSONPromise"),this.options=e}validate(e,t,i,s=1){return mt(this,null,function*(){if(this.destroyed)return!1;this.loadSha256SegmentsPromiseIfNeeded();let n=cE(e).split("/").pop(),a=(yield this.segmentJSONPromise)[n];if(!a&&s>dL)return ze.clientError(`Unknown segment name ${n} in segment validator`),!1;if(!a)return ze.info(`Refetching sha segments for ${n}`),yield bE(500),this.loadSha256SegmentsPromise(),this.validate(e,t,i,s+1);let l,c="";if(typeof a=="string"?l=a:(c=t.start+"-"+t.end,l=a[c]),l===void 0)return ze.clientError(`Unknown segment name ${n}/${c} in segment validator`),!1;cL(`Validating ${n}`+(c?` range ${c}`:""));let h=yield this.sha256Hex(i);if(h!==l)return ze.clientError(`Hashes does not correspond for segment ${n}/${c} (expected: ${l} instead of ${h})`),!0})}destroy(){this.destroyed=!0}loadSha256SegmentsPromiseIfNeeded(){this.segmentJSONPromise||this.loadSha256SegmentsPromise()}loadSha256SegmentsPromise(){this.segmentJSONPromise=this.fetchSha256Segments()}fetchSha256Segments(){let e={};return uf(this.options.serverUrl,this.options.segmentsSha256Url)&&(this.options.requiresPassword?e={"x-peertube-video-password":this.options.videoPassword()}:this.options.requiresUserAuth&&(e={Authorization:this.options.authorizationHeader()})),fetch(this.options.segmentsSha256Url,{headers:e}).then(t=>t.json()).catch(t=>(ze.clientError("Cannot get sha256 segments",t),{}))}sha256Hex(e){return mt(this,null,function*(){if(!e)return;if(window.crypto.subtle)return window.crypto.subtle.digest("SHA-256",e).then(i=>this.bufferToHex(i));let t=(yield import("./chunk-YAEF27XG.js").then(i=>i.i)).default;return new t.sha256().update(hL.from(e)).digest("hex")})}bufferToHex(e){if(!e)return"";let t="",i="0123456789abcdef";return new Uint8Array(e).forEach(n=>{t+=i[n>>4]+i[n&15]}),t}},fL=fs("peertube:player:hls"),df=class{constructor(e){this.options=e}getPluginOptions(){return mt(this,null,function*(){let e=this.options.hls.segmentsSha256Url;e||ze.info("No segmentsSha256Url found. Disabling P2P & redundancy.");let t=e?new hf(this.options.hls.redundancyBaseUrls):null,i=e?new cf({segmentsSha256Url:e,authorizationHeader:this.options.authorizationHeader,requiresUserAuth:this.options.requiresUserAuth,serverUrl:this.options.serverUrl,requiresPassword:this.options.requiresPassword,videoPassword:this.options.videoPassword}):null,s=yield this.options.pluginsManager.runHook("filter:internal.player.p2p-media-loader.options.result",this.getP2PMediaLoaderOptions({redundancyUrlManager:t,segmentValidator:i})),n={requiresUserAuth:this.options.requiresUserAuth,videoFileToken:this.options.videoFileToken,p2pEnabled:e&&this.options.p2pEnabled,redundancyUrlManager:t,type:"application/x-mpegURL",src:this.options.hls.playlistUrl,segmentValidator:i},a={hlsjsConfig:this.getHLSJSOptions(s),levelLabelHandler:(l,c)=>{let h=Math.min(l.height||0,l.width||0),f=this.options.hls.videoFiles.find(m=>m.resolution.id===h),p=TE({resolution:h,height:f?.height??l.height,width:f?.width??l.width});return c.localize(Vv(p,f?.fps??l.frameRate))}};return fL("Creating HLS player options",{hlsjs:a,p2pMediaLoader:n,loaderOptions:s}),{p2pMediaLoader:n,hlsjs:a}})}getP2PMediaLoaderOptions(e){var t;let{redundancyUrlManager:i,segmentValidator:s}=e,n=!1;(((t=navigator?.connection)==null?void 0:t.type)==="cellular"||fr.getItem("peertube-videojs-p2p-consume-only")==="true")&&(ze.info("We are on a cellular connection: disabling seeding."),n=!0);let a=this.options.hls.trackerAnnounce.filter(h=>h.startsWith("ws")),l=this.options.isLive?this.getP2PMediaLoaderLiveOptions():this.getP2PMediaLoaderVODOptions();return{loader:Ue({announceTrackers:a,rtcConfig:Cb(this.options.stunServers),httpRequestSetup:(h,f,p,m)=>{let{requiresUserAuth:_,requiresPassword:E}=this.options,S=i?i.buildUrl(h):h,C=new Headers;return m&&C.set("Range",`bytes=${m.start}-${m.end??""}`),uf(this.options.serverUrl,S)&&(E?C.set("x-peertube-video-password",this.options.videoPassword()):_&&C.set("Authorization",this.options.authorizationHeader())),Promise.resolve(new Request(S,{headers:C,signal:p}))},validateP2PSegment:s?s.validate.bind(s):null,validateHTTPSegment:s?s.validate.bind(s):null,isP2PDisabled:!this.options.p2pEnabled,isP2PUploadDisabled:n,swarmId:this.options.hls.playlistUrl},l)}}getP2PMediaLoaderLiveOptions(){let e={highDemandTimeWindow:4};switch(this.options.liveOptions.latencyMode){case qa.SMALL_LATENCY:return ht(Ue({},e),{isP2PDisabled:!0});case qa.HIGH_LATENCY:return e;default:return e}}getP2PMediaLoaderVODOptions(){return{highDemandTimeWindow:15,segmentMemoryStorageLimit:1024}}getHLSJSOptions(e){let t=this.options.isLive?this.getHLSLiveOptions():this.getHLSVODOptions(),i=Ue({capLevelToPlayerSize:!0,autoStartLoad:!1,p2pMediaLoaderOptions:e.loader,xhrSetup:(n,a)=>{let{requiresUserAuth:l,requiresPassword:c}=this.options;uf(this.options.serverUrl,a)&&(c?n.setRequestHeader("x-peertube-video-password",this.options.videoPassword()):l&&n.setRequestHeader("Authorization",this.options.authorizationHeader()))}},t),s=eb();return s?ht(Ue({},i),{abrEwmaDefaultEstimate:s*8,backBufferLength:90,startLevel:-1,testBandwidth:!1,debug:!1,enableWorker:!1}):i}getHLSLiveOptions(){switch(this.options.liveOptions.latencyMode){case qa.SMALL_LATENCY:return{liveSyncDurationCount:2};case qa.HIGH_LATENCY:return{liveSyncDurationCount:10};default:return{liveSyncDurationCount:5}}}getHLSVODOptions(){return{liveSyncDurationCount:5}}},ff=class{constructor(e){this.options=e}getPluginOptions(){var e;return{videoFileToken:this.options.videoFileToken,videoFiles:this.options.webVideo.videoFiles.length!==0?this.options.webVideo.videoFiles:((e=this.options.hls)==null?void 0:e.videoFiles)||[]}}},pL=X.getComponent("ClickableComponent"),Ll=class extends pL{constructor(e,t){super(e,t)}createEl(){this.wrapper=super.createEl("div",{className:"vjs-playlist-button",tabIndex:-1});let e=super.createEl("div",{className:"vjs-playlist-icon",tabIndex:-1});return this.playlistInfoElement=super.createEl("div",{className:"vjs-playlist-info",tabIndex:-1}),this.wrapper.appendChild(e),this.wrapper.appendChild(this.playlistInfoElement),this.update(),this.wrapper}update(){this.playlistInfoElement.innerText=this.options_.getCurrentPosition()+"/"+this.options_.playlist.videosLength,this.wrapper.title=this.player().localize("Playlist: {1}",[this.options_.playlist.displayName])}handleClick(){this.options_.playlistMenu.open()}};X.registerComponent("PlaylistButton",Ll);var jT=X.getComponent("Component"),kl=class extends jT{constructor(e,t){super(e,t),this.emitTapEvents(),this.element=t.element,this.clickHandler=()=>this.switchPlaylistItem(),this.keyDownHandler=i=>this.handleKeyDown(i),this.on(["click","tap"],this.clickHandler),this.on("keydown",this.keyDownHandler)}dispose(){this.off(["click","tap"],this.clickHandler),this.off("keydown",this.keyDownHandler),super.dispose()}createEl(){let e=super.createEl("li",{className:"vjs-playlist-menu-item"});this.options_.element.video||e.classList.add("vjs-disabled");let t=super.createEl("div",{className:"item-position-block"}),i=super.createEl("div",{className:"item-position",innerText:this.options_.element.position});return t.appendChild(i),e.appendChild(t),this.options_.element.video?this.buildAvailableVideo(e,t,this.options_):this.buildUnavailableVideo(e),e}setSelected(e){e?this.addClass("vjs-selected"):this.removeClass("vjs-selected")}getElement(){return this.element}buildAvailableVideo(e,t,i){let s=i.element,n=super.createEl("div",{className:"item-player"});t.appendChild(n);let a=super.createEl("img",{src:window.location.origin+s.video.thumbnailPath}),l=super.createEl("div",{className:"info-block"}),c=super.createEl("div",{innerText:s.video.name,className:"title"}),h=super.createEl("div",{innerText:s.video.channel.displayName,className:"channel"});if(l.appendChild(c),l.appendChild(h),s.startTimestamp||s.stopTimestamp){let f="";s.startTimestamp&&(f+=Ms(s.startTimestamp)),s.stopTimestamp&&(f+=" - "+Ms(s.stopTimestamp));let p=super.createEl("div",{innerText:f,className:"timestamps"});l.append(p)}e.append(a),e.append(l)}buildUnavailableVideo(e){let t=super.createEl("div",{className:"item-unavailable",innerText:this.player().localize("Unavailable video")});e.appendChild(t)}handleKeyDown(e){(e.code==="Space"||e.code==="Enter")&&this.switchPlaylistItem()}switchPlaylistItem(){this.options_.onClicked()}};jT.registerComponent("PlaylistMenuItem",kl);var VT=X.getComponent("Component"),Rl=class extends VT{constructor(e,t){super(e,t),this.menuItems=[],this.userInactiveHandler=()=>{this.close()},this.onMouseEnter=()=>{this.player().off("userinactive",this.userInactiveHandler)},this.onMouseLeave=()=>{this.player().one("userinactive",this.userInactiveHandler)},this.onPlayerCick=i=>{let s=i.target;do{if(s.classList.contains("vjs-playlist-menu")||s.classList.contains("vjs-playlist-button"))return;s=s.parentElement}while(s);this.close()},this.el().addEventListener("mouseenter",this.onMouseEnter),this.el().addEventListener("mouseleave",this.onMouseLeave),this.player().on("click",this.onPlayerCick)}dispose(){this.el().removeEventListener("mouseenter",this.onMouseEnter),this.el().removeEventListener("mouseleave",this.onMouseLeave),this.player().off("userinactive",this.userInactiveHandler),this.player().off("click",this.onPlayerCick);for(let e of this.menuItems)e.dispose();super.dispose()}createEl(){this.menuItems=[];let e=super.createEl("div",{className:"vjs-playlist-menu",tabIndex:-1}),t=super.createEl("div",{className:"header"}),i=super.createEl("div"),s=super.createEl("div",{innerText:this.options_.playlist.displayName,className:"title"}),n=this.options_.playlist.videoChannel,a=super.createEl("div",{innerText:n?this.player().localize("By {1}",[n.displayName]):"",className:"channel"});i.appendChild(s),i.appendChild(a);let l=super.createEl("div",{className:"cross"});l.addEventListener("click",()=>this.close()),t.appendChild(i),t.appendChild(l);let c=super.createEl("ol");for(let h of this.options_.elements){let f=new kl(this.player(),{element:h,onClicked:()=>this.onItemClicked(h)});c.appendChild(f.el()),this.menuItems.push(f)}return e.appendChild(t),e.appendChild(c),this.update(),e}update(){this.updateSelected(this.options_.getCurrentPosition())}open(){this.player().addClass("playlist-menu-displayed")}close(){this.player().removeClass("playlist-menu-displayed")}updateSelected(e){for(let t of this.menuItems)t.setSelected(t.getElement().position===e)}onItemClicked(e){this.options_.onItemClicked(e)}};VT.registerComponent("PlaylistMenu",Rl);var gL=X.getPlugin("plugin"),pf=class extends gL{constructor(e,t){super(e,t),this.player.addClass("vjs-playlist"),this.playlistMenu=new Rl(e,t),this.playlistButton=new Ll(e,ht(Ue({},t),{playlistMenu:this.playlistMenu})),e.addChild(this.playlistMenu,t),e.addChild(this.playlistButton,t)}dispose(){this.player.removeClass("vjs-playlist"),this.playlistMenu.dispose(),this.playlistButton.dispose(),this.player.removeChild(this.playlistMenu),this.player.removeChild(this.playlistButton),super.dispose()}};X.registerPlugin("playlist",pf);var mL=X.getPlugin("plugin"),gf=class extends mL{constructor(e){super(e),this.resolutions=[],e.on("video-change",()=>{this.resolutions=[],this.trigger("resolutions-removed")})}add(e){for(let t of e)this.resolutions.push(t);this.currentSelection=this.getSelected(),this.sort(),this.trigger("resolutions-added")}remove(e){this.resolutions=this.resolutions.filter(t=>t.id!==e),this.trigger("resolutions-removed")}getResolutions(){return this.resolutions}getSelected(){return this.resolutions.find(e=>e.selected)}getAutoResolutionChosen(){return this.resolutions.find(e=>e.id===this.autoResolutionChosenId)}select(e){var t;let{id:i,autoResolutionChosenId:s,fireCallback:n}=e;if(!(((t=this.currentSelection)==null?void 0:t.id)===i&&this.autoResolutionChosenId===s)){s!==void 0&&(this.autoResolutionChosenId=s);for(let a of this.resolutions)a.selected=a.id===i,a.selected&&(this.currentSelection=a,n&&a.selectCallback());this.trigger("resolutions-changed")}}sort(){this.resolutions.sort((e,t)=>e.id===-1?1:t.id===-1||e.height>t.height?-1:e.height===t.height?0:1)}};X.registerPlugin("peertubeResolutions",gf);var vL=X.getComponent("Menu"),yL=X.getComponent("Component"),Pl=class extends vL{stepForward(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)}focus(e){e===void 0&&(this.focusedChild_=-1,e=0),this._focus(e)}_focus(e){let t=this.children().slice();if(t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0){e<0?e=0:e>=t.length&&(e=t.length-1);let s=t[e].el();if(s.classList.contains("vjs-hidden"))return this.focusedChild_<e?e===t.length-1?void 0:this.focus(e+1):e===0?void 0:this.focus(e-1);this.focusedChild_=e,s.focus()}}};yL.registerComponent("MenuFocusFixed",Pl);var TL=X.getComponent("MenuItem"),Dl=class extends TL{constructor(e,t){super(e,ht(Ue({},t),{selectable:!0})),this.autoResolutionChosen="",this.resolutionId=t.resolutionId,this.label=t.label,this.updateSelectionHandler=()=>this.updateSelection(),e.peertubeResolutions().on("resolutions-changed",this.updateSelectionHandler)}dispose(){this.player().peertubeResolutions().off("resolutions-changed",this.updateSelectionHandler),super.dispose()}handleClick(e){super.handleClick(e),this.player().peertubeResolutions().select({id:this.resolutionId,fireCallback:!0})}updateSelection(){var e;let t=this.player().peertubeResolutions().getSelected();this.resolutionId===-1&&(this.autoResolutionChosen=(e=this.player().peertubeResolutions().getAutoResolutionChosen())==null?void 0:e.label),this.selected(this.resolutionId===t.id)}getLabel(){return this.resolutionId===-1?this.label+" <small>"+this.autoResolutionChosen+"</small>":this.label}};X.registerComponent("ResolutionMenuItem",Dl);var _L=X.getComponent("Menu"),EL=X.getComponent("MenuButton"),mf=class extends EL{constructor(e,t){super(e,t),this.controlText("Quality"),e.peertubeResolutions().on("resolutions-added",()=>this.update()),e.peertubeResolutions().on("resolutions-removed",()=>this.update()),e.peertubeResolutions().on("resolutions-changed",()=>{setTimeout(()=>this.trigger("label-updated"))})}createEl(){let e=super.createEl();return this.labelEl_=X.dom.createEl("div",{className:"vjs-resolution-value"}),e.appendChild(this.labelEl_),e}updateARIAAttributes(){this.el().setAttribute("aria-label","Quality")}createMenu(){let e=new _L(this.player_,{menuButton:this}),t=this.player().peertubeResolutions().getResolutions();for(let i of t){let s=i.label==="0p"?this.player().localize("Audio only"):i.label,n=new Dl(this.player_,{id:i.id+"",resolutionId:i.id,label:s,selected:i.selected});e.addItem(n)}return e}update(){super.update(),this.trigger("resolution-menu-changed")}buildCSSClass(){return"vjs-resolution-button "+super.buildCSSClass()}buildWrapperCSSClass(){return"vjs-resolution-control "+super.buildWrapperCSSClass()}};X.registerComponent("ResolutionMenuButton",mf);var GT=X.getComponent("Component"),vf=class extends GT{constructor(e){super(e),this.hide()}createEl(){let e=this.player().id(),t="TTsettingsDialogLabel-"+e,i="TTsettingsDialogDescription-"+e;return super.createEl("div",{className:"vjs-settings-dialog vjs-modal-overlay",id:"vjs-settings-dialog-"+e,tabIndex:-1},{role:"dialog","aria-labelledby":t,"aria-describedby":i})}show(){this.player().addClass("vjs-settings-dialog-opened"),super.show()}hide(){this.player().removeClass("vjs-settings-dialog-opened"),super.hide()}};GT.registerComponent("SettingsDialog",vf);var xv=fs("peertube:player:settings"),Ov=X.getComponent("MenuItem"),bL=X.getComponent("Component"),da=class extends Ov{constructor(e,t){super(e,t),this.settingsButton=t.menuButton,this.dialog=this.settingsButton.dialog,this.mainMenu=this.settingsButton.menu,this.panel=this.dialog.getChild("settingsPanel"),this.panelChild=this.panel.getChild("settingsPanelChild"),this.panelChildEl=this.panelChild.el(),this.size=null,this.menuToLoad="mainmenu";let i=Xv(t.entry),s=X.getComponent(i);if(!s)throw new Error(`Component ${i} does not exist`);let n=Object.assign({},t,{entry:t.menuButton,menuButton:this});this.subMenu=new s(this.player(),n);let a=this.subMenu.buildCSSClass().split(" ")[0];this.settingsSubMenuEl_.className+=" "+a,this.eventHandlers(),e.ready(()=>{setTimeout(()=>{this.player_&&(this.build(),i==="PlaybackRateMenuButton"&&(e.on("ratechange",this.submenuClickHandler),e.on("playbackrateschange",()=>{setTimeout(()=>this.rebuildAfterMenuChange())})),i==="CaptionsButton"&&(e.on("captions-changed",()=>{setTimeout(()=>this.rebuildAfterMenuChange())}),e.on("texttrackchange",this.submenuClickHandler)),i==="ResolutionMenuButton"&&this.subMenu.on("resolution-menu-changed",()=>{this.rebuildAfterMenuChange()}),this.reset())},0)})}dispose(){this.settingsSubMenuEl_.removeEventListener("transitionend",this.transitionEndHandler),super.dispose()}eventHandlers(){this.submenuClickHandler=this.onSubmenuClick.bind(this),this.transitionEndHandler=this.onTransitionEnd.bind(this)}onSubmenuClick(e){let t=null;if(e.type==="tap"?t=e.target:t=e.currentTarget||e.target,t?.classList.contains("vjs-back-button")){this.loadMainMenu();return}setTimeout(()=>this.update(e),0),this.subMenu.menu.removeClass("vjs-hidden")}createEl(){let e=X.dom.createEl("li",{className:"vjs-menu-item",tabIndex:0});return this.settingsSubMenuTitleEl_=X.dom.createEl("div",{className:"vjs-settings-sub-menu-title"}),e.appendChild(this.settingsSubMenuTitleEl_),this.settingsSubMenuValueEl_=X.dom.createEl("div",{className:"vjs-settings-sub-menu-value"}),e.appendChild(this.settingsSubMenuValueEl_),this.settingsSubMenuEl_=X.dom.createEl("div",{className:"vjs-settings-sub-menu"}),e}handleClick(e){this.menuToLoad="submenu",X.dom.removeClass(this.el(),"open"),super.handleClick(e),this.mainMenu.el().style.opacity="0",X.dom.hasClass(this.settingsSubMenuEl_,"vjs-hidden")?(X.dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),setTimeout(()=>{this.settingsSubMenuEl_.style.opacity="1",this.settingsSubMenuEl_.style.marginRight="0px"},0),this.settingsButton.setDialogSize(this.size),this.subMenu.menu.focus()):X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}createBackButton(){let e=this.subMenu.menu.addChild("MenuItem",{},0);e.setAttribute("aria-label",this.player().localize("Go back")),e.addClass("vjs-back-button"),e.el().innerHTML=this.player().localize(this.subMenu.controlText())}onTransitionEnd(e){e.propertyName==="margin-right"&&this.menuToLoad==="mainmenu"&&(X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0")}reset(){X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0",this.setMargin()}loadMainMenu(){let e=this.mainMenu.el();this.menuToLoad="mainmenu",this.mainMenu.show(),e.style.opacity="0";let t=this.mainMenu;this.settingsButton.setDialogSize([t.width(),t.height()]),setTimeout(()=>{this.setMargin(),e.style.opacity="1",this.mainMenu.focus()},0)}build(){this.subMenu.on("label-updated",()=>{this.update()}),this.settingsSubMenuTitleEl_.innerHTML=this.player().localize(this.subMenu.controlText()),this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el()),this.panelChildEl.appendChild(this.settingsSubMenuEl_),this.update(),this.createBackButton(),this.setSize(),this.bindClickEvents(),this.bindKeyEvents(),this.settingsSubMenuEl_.addEventListener("transitionend",this.transitionEndHandler,!1)}update(e){if(this.subMenu.name()==="PlaybackRateMenuButton")this.settingsSubMenuValueEl_.innerHTML=this.subMenu.labelEl_.textContent;else for(let i of this.subMenu.menu.children_){if(!(i instanceof Ov))continue;let s=i;if(s.isSelected_){if(typeof s.getLabel=="function"){this.settingsSubMenuValueEl_.innerHTML=s.getLabel();break}this.settingsSubMenuValueEl_.innerHTML=this.player().localize(s.options_.label)}}let t=null;e&&e.type==="tap"?t=e.target:e&&(t=e.currentTarget),t&&!t.classList.contains("vjs-back-button")&&this.settingsButton.hideDialog()}bindClickEvents(){for(let e of this.subMenu.menu.children())e instanceof bL&&e.on(["tap","click"],this.submenuClickHandler)}bindKeyEvents(){this.subMenu.menu.on("escaped-key",()=>{this.trigger("escaped-key")}),this.subMenu.menu.on("arrow-left",()=>{xv("Detected arrow left on sub menu "+this.subMenu.name()),this.loadMainMenu()})}setSize(){this.dialog.removeClass("vjs-hidden"),X.dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),this.size=this.settingsButton.getComponentSize(this.settingsSubMenuEl_),this.setMargin(),this.dialog.addClass("vjs-hidden"),X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}setMargin(){if(!this.size)return;let[e]=this.size;this.settingsSubMenuEl_.style.marginRight=`-${e}px`}hideSubMenu(){this.el()&&X.dom.hasClass(this.el(),"open")&&(X.dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),X.dom.removeClass(this.el(),"open"))}rebuildAfterMenuChange(){xv("Rebuilding menu "+this.subMenu.name()+" after change"),this.settingsSubMenuEl_.innerHTML="",this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el()),this.update(),this.createBackButton(),this.setSize(),this.bindClickEvents(),this.bindKeyEvents()}};da.prototype.contentElType="button";X.registerComponent("SettingsMenuItem",da);var SL=fs("peertube:player:settings"),CL=X.getComponent("Button"),KT=X.getComponent("Component"),yf=class extends CL{constructor(e,t){super(e,t),this.settingsButtonOptions=t,this.controlText("Settings"),this.dialog=this.player().addChild("settingsDialog"),this.dialogEl=this.dialog.el(),this.menu=null,this.panel=this.dialog.addChild("settingsPanel"),this.panelChild=this.panel.addChild("settingsPanelChild"),this.addClass("vjs-settings"),this.setAttribute("aria-controls","vjs-settings-dialog-"+this.player().id()),this.addSettingsItemHandler=this.onAddSettingsItem.bind(this),this.disposeSettingsItemHandler=this.onDisposeSettingsItem.bind(this),this.documentClickHandler=this.onDocumentClick.bind(this),this.userInactiveHandler=this.onUserInactive.bind(this),this.buildMenu(),this.bindEvents(),this.player().one("play",()=>this.hideDialog())}onDocumentClick(e){var t,i,s;let n=e.target;(t=n?.classList)!=null&&t.contains("vjs-settings")||(s=(i=n?.parentElement)==null?void 0:i.classList)!=null&&s.contains("vjs-settings")||this.dialog.hasClass("vjs-hidden")||this.hideDialog()}onDisposeSettingsItem(e,t){if(t===void 0){let i=this.menu.children();for(;i.length>0;)i[0].dispose(),this.menu.removeChild(i[0]);this.addClass("vjs-hidden")}else{let i=this.menu.getChild(t);i&&(i.dispose(),this.menu.removeChild(i))}this.hideDialog(),this.settingsButtonOptions.entries.length===0&&this.addClass("vjs-hidden")}dispose(){document.removeEventListener("click",this.documentClickHandler),this.isInIframe()&&window.removeEventListener("blur",this.documentClickHandler),super.dispose()}onAddSettingsItem(e,t){let[i,s]=t;this.addMenuItem(i,s),this.removeClass("vjs-hidden")}onUserInactive(){this.dialog.hasClass("vjs-hidden")||this.hideDialog()}bindEvents(){document.addEventListener("click",this.documentClickHandler),this.isInIframe()&&window.addEventListener("blur",this.documentClickHandler),this.player().on("addsettingsitem",this.addSettingsItemHandler),this.player().on("disposesettingsitem",this.disposeSettingsItemHandler),this.player().on("userinactive",this.userInactiveHandler)}buildCSSClass(){return`vjs-icon-settings ${super.buildCSSClass()}`}handleClick(){this.dialog.hasClass("vjs-hidden")?this.showDialog():this.hideDialog()}showDialog(){this.player().peertube().onMenuOpened(),this.menu.el().style.opacity="1",this.dialog.show(),this.el().setAttribute("aria-expanded","true"),this.setDialogSize(this.getComponentSize(this.menu)),this.menu.focus()}hideDialog(){this.player_.peertube().onMenuClosed(),this.dialog.hide(),this.el().setAttribute("aria-expanded","false"),this.setDialogSize(this.getComponentSize(this.menu)),this.menu.el().style.opacity="1",this.resetChildren()}getComponentSize(e){let t=null,i=null;if(e instanceof KT){let s=e.el();t=s.offsetWidth,i=s.offsetHeight}else t=e.offsetWidth,i=e.offsetHeight;return[t,i]}setDialogSize([e,t]){if(typeof t!="number")return;let i=this.settingsButtonOptions.setup.maxHeightOffset,s=this.player().el().offsetHeight-i,n=this.panel.el();t>s?(t=s,e+=15,n.style.maxHeight=`${t}px`):n.style.maxHeight!==""&&(n.style.maxHeight=""),this.dialogEl.style.width=`${e}px`,this.dialogEl.style.height=`${t}px`}buildMenu(){this.menu=new Pl(this.player()),this.menu.on("escaped-key",()=>{this.hideDialog(),this.focus()}),this.menu.on("arrow-right",(t,i)=>{SL("Detected arrow right on menu item",i),i.click()}),this.menu.addClass("vjs-main-menu");let e=this.settingsButtonOptions.entries;if(e.length===0){this.addClass("vjs-hidden"),this.panelChild.addChild(this.menu);return}for(let t of e)this.addMenuItem(t,this.settingsButtonOptions);this.panelChild.addChild(this.menu)}addMenuItem(e,t){let i=function(){X.dom.hasClass(this.el_,"open")?X.dom.removeClass(this.el_,"open"):X.dom.addClass(this.el_,"open")};t.name=Xv(e);let s=Object.assign({},t,{entry:e,menuButton:this}),n=new da(this.player(),s);this.menu.addChild(n),n.on("click",X.bind(this,this.hideChildren)),n.on("click",i),n.on("escaped-key",()=>{this.hideDialog(),this.focus()})}resetChildren(){for(let e of this.menu.children())e.reset()}hideChildren(){for(let e of this.menu.children())e.hideSubMenu()}isInIframe(){return window.self!==window.top}};KT.registerComponent("SettingsButton",yf);var qT=X.getComponent("Component"),Tf=class extends qT{createEl(){return super.createEl("div",{className:"vjs-settings-panel",tabIndex:-1})}};qT.registerComponent("SettingsPanel",Tf);var WT=X.getComponent("Component"),_f=class extends WT{createEl(){return super.createEl("div",{className:"vjs-settings-panel-child",tabIndex:-1})}};WT.registerComponent("SettingsPanelChild",_f);var wL=X.getComponent("Component"),xl=class extends wL{constructor(e,t){super(e,t),this.metadataStore={},this.intervalMs=300,this.playerNetworkInfo={}}createEl(){this.containerEl=X.dom.createEl("div",{className:"vjs-stats-content"}),this.containerEl.style.display="none",this.infoListEl=X.dom.createEl("div",{className:"vjs-stats-list"});let e=X.dom.createEl("button",{className:"vjs-stats-close",tabindex:"0",title:"Close stats",innerText:"[x]"},{"aria-label":"Close stats"});return e.onclick=()=>this.hide(),this.containerEl.appendChild(e),this.containerEl.appendChild(this.infoListEl),this.populateInfoBlocks(),this.onNetworkInfoHandler=(t,i)=>{this.mode=i.source;let s=i.p2p,n=i.http;this.playerNetworkInfo.downloadSpeed=si((s?.downloadSpeed||0)+(n.downloadSpeed||0)).join(" "),this.playerNetworkInfo.uploadSpeed=si(s?.uploadSpeed||0).join(" "),this.playerNetworkInfo.totalDownloaded=si((s?.downloaded||0)+n.downloaded).join(" "),this.playerNetworkInfo.totalUploaded=si(s?.uploaded||0).join(" "),this.playerNetworkInfo.numPeers=s?.peersWithWebSeed,i.source==="p2p-media-loader"&&(this.playerNetworkInfo.averageBandwidth=si(i.bandwidthEstimate).join(" ")+"/s",this.playerNetworkInfo.downloadedFromServer=si(n.downloaded).join(" "),this.playerNetworkInfo.downloadedFromPeers=si(s?.downloaded||0).join(" "))},this.player().on("network-info",this.onNetworkInfoHandler),this.containerEl}dispose(){this.updateInterval&&clearInterval(this.updateInterval),this.player().off("network-info",this.onNetworkInfoHandler),super.dispose()}toggle(){this.updateInterval?this.hide():this.show()}show(){this.containerEl.style.display="block",this.updateInterval=setInterval(()=>mt(this,null,function*(){if(this.mode)try{let e=this.mode==="p2p-media-loader"?this.buildHLSOptions():yield this.buildWebVideoOptions();this.populateInfoValues(e)}catch(e){ze.error("Cannot update stats.",e),clearInterval(this.updateInterval)}}),this.intervalMs)}hide(){clearInterval(this.updateInterval),this.containerEl.style.display="none"}buildHLSOptions(){let e=this.player_.p2pMediaLoader(),t=e.getCurrentLevel(),i=t?.videoCodec||t?.audioCodec?`${t?.videoCodec||""} / ${t?.audioCodec||""}`:void 0,s=t?.height?`${t.height}p${t?.attrs["FRAME-RATE"]||""}`:void 0,n=this.timeRangesToString(this.player().buffered()),a,l,c;return this.options_.videoIsLive?(l=Ms(e.getLiveLatency()),c=Ms(e.getLiveLatencyFromEdge())):a=this.player().bufferedPercent(),{playerNetworkInfo:this.playerNetworkInfo,resolution:s,codecs:i,buffer:n,latency:l,latencyFromEdge:c,progress:a}}buildWebVideoOptions(){return mt(this,null,function*(){var e;let t=this.player_.webVideo().getCurrentVideoFile();this.metadataStore[t.fileUrl]||(this.metadataStore[t.fileUrl]=yield fetch(t.metadataUrl).then(h=>h.json()));let i=this.metadataStore[t.fileUrl],s="unknown",n="unknown";if((e=i?.streams)!=null&&e[0]){let h=i.streams[0];s=h.color_space!=="unknown"?h.color_space:"bt709",n=h.codec_name||"avc1"}let a=t?.resolution.label+t?.fps,l=this.timeRangesToString(this.player_.buffered()),c=this.player_.bufferedPercent();return{playerNetworkInfo:this.playerNetworkInfo,progress:c,colorSpace:s,codecs:n,resolution:a,buffer:l}})}populateInfoBlocks(){this.playerMode=this.buildInfoRow(this.player().localize("Player mode")),this.p2p=this.buildInfoRow(this.player().localize("P2P")),this.uuid=this.buildInfoRow(this.player().localize("Video UUID")),this.viewport=this.buildInfoRow(this.player().localize("Viewport / Frames")),this.resolution=this.buildInfoRow(this.player().localize("Resolution")),this.volume=this.buildInfoRow(this.player().localize("Volume")),this.codecs=this.buildInfoRow(this.player().localize("Codecs")),this.color=this.buildInfoRow(this.player().localize("Color")),this.connection=this.buildInfoRow(this.player().localize("Connection Speed")),this.network=this.buildInfoRow(this.player().localize("Network Activity")),this.transferred=this.buildInfoRow(this.player().localize("Total Transfered")),this.download=this.buildInfoRow(this.player().localize("Download Breakdown")),this.bufferProgress=this.buildInfoRow(this.player().localize("Buffer Progress")),this.bufferState=this.buildInfoRow(this.player().localize("Buffer State")),this.liveLatency=this.buildInfoRow(this.player().localize("Live Latency")),this.infoListEl.appendChild(this.playerMode.root),this.infoListEl.appendChild(this.p2p.root),this.infoListEl.appendChild(this.uuid.root),this.infoListEl.appendChild(this.viewport.root),this.infoListEl.appendChild(this.resolution.root),this.infoListEl.appendChild(this.volume.root),this.infoListEl.appendChild(this.codecs.root),this.infoListEl.appendChild(this.color.root),this.infoListEl.appendChild(this.connection.root),this.infoListEl.appendChild(this.network.root),this.infoListEl.appendChild(this.transferred.root),this.infoListEl.appendChild(this.download.root),this.infoListEl.appendChild(this.bufferProgress.root),this.infoListEl.appendChild(this.bufferState.root),this.infoListEl.appendChild(this.liveLatency.root)}populateInfoValues(e){let{playerNetworkInfo:t,progress:i,colorSpace:s,codecs:n,resolution:a,buffer:l,latency:c,latencyFromEdge:h}=e,{downloadedFromServer:f,downloadedFromPeers:p}=t,m=this.player(),_=m.getVideoPlaybackQuality(),E=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),S=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),C=(window.devicePixelRatio||1).toFixed(2),I=`${E}x${S}*${C}`,{droppedVideoFrames:R,totalVideoFrames:k}=_,D=m.localize("{1} / {2} dropped of {3}",[I,R+"",k+""]),x=m.duration(),N=`${Math.round(m.volume()*100)}`;m.muted()&&(N+=m.localize(" (muted)"));let B=t.downloadSpeed?`${t.downloadSpeed} \u21D3 / ${t.uploadSpeed} \u21D1`:void 0,H=t.totalDownloaded?`${t.totalDownloaded} \u21D3`:"";t.totalUploaded&&(H+=`/ ${t.totalUploaded} \u21D1`);let O=t.downloadedFromServer?m.localize("{1} from servers \xB7 {2} from peers",[f,p]):void 0,P=i!==void 0?`${(i*100).toFixed(1)}% (${(i*x).toFixed(1)}s)`:void 0,G=this.options_.p2pEnabled&&this.mode==="p2p-media-loader";this.setInfoValue(this.playerMode,this.mode==="p2p-media-loader"?"P2P Media Loader (v2)":"Web Video"),this.setInfoValue(this.p2p,m.localize(G?"enabled":"disabled")),this.setInfoValue(this.uuid,this.options_.videoUUID),this.setInfoValue(this.viewport,D),this.setInfoValue(this.resolution,a),this.setInfoValue(this.volume,N),this.setInfoValue(this.codecs,n),this.setInfoValue(this.color,s),this.setInfoValue(this.transferred,H),this.setInfoValue(this.connection,t.averageBandwidth),this.setInfoValue(this.network,B),this.setInfoValue(this.download,O),this.setInfoValue(this.bufferProgress,P),this.setInfoValue(this.bufferState,l),c&&h&&this.setInfoValue(this.liveLatency,m.localize("{1} (from edge: {2})",[c,h]))}setInfoValue(e,t){if(!t){e.root.style.display="none";return}e.root.style.display="block",e.value.innerText!==t&&(e.value.innerText=t)}buildInfoRow(e){let t=X.dom.createEl("div");t.style.display="none";let i=X.dom.createEl("div",{innerText:e}),s=X.dom.createEl("span");return t.appendChild(i),t.appendChild(s),{root:t,value:s}}timeRangesToString(e){let t="";for(let i=0;i<e.length;i++){let s=Math.floor(e.start(i)),n=Math.floor(e.end(i));t+=`[${Ms(s)}, ${Ms(n)}] `}return t}};X.registerComponent("StatsCard",xl);var AL=X.getPlugin("plugin"),Ef=class extends AL{constructor(e,t){super(e),this.player.ready(()=>{e.addClass("vjs-stats-for-nerds")}),this.statsCard=new xl(e,t),e.addChild(this.statsCard)}dispose(){this.statsCard&&(this.statsCard.dispose(),this.player.removeChild(this.statsCard)),super.dispose()}show(){this.statsCard.show()}};X.registerPlugin("stats",Ef);function IL(r){return`
    <div class="vjs-upnext-top">
      <span class="vjs-upnext-headtext">${r.headText}</span>
      <div class="vjs-upnext-title"></div>
    </div>
    <div class="vjs-upnext-autoplay-icon">
      <svg height="100%" version="1.1" viewbox="0 0 98 98" width="100%">
        <circle class="vjs-upnext-svg-autoplay-circle" cx="49" cy="49" fill="#000" fill-opacity="0.8" r="48"></circle>
        <circle class="vjs-upnext-svg-autoplay-ring" cx="-49" cy="49" fill-opacity="0" r="46.5"
                stroke="#FFFFFF" stroke-width="4" transform="rotate(-90)"
        ></circle>
        <polygon class="vjs-upnext-svg-autoplay-triangle" fill="#fff" points="32,27 72,49 32,71"></polygon></svg>
    </div>
    <span class="vjs-upnext-bottom">
      <span class="vjs-upnext-cancel">
        <button class="vjs-upnext-cancel-button" tabindex="0" aria-label="Cancel autoplay">${r.cancelText}</button>
      </span>
      <span class="vjs-upnext-suspended">${r.suspendedText}</span>
    </span>
  `}var LL=X.getComponent("Component"),Ol=class extends LL{constructor(e,t){super(e,t),this.dashOffsetTotal=586,this.dashOffsetStart=293,this.interval=50,this.upNextEvents=new X.EventTarget,this.ticks=0,this.totalTicks=this.options_.timeout/this.interval,this.onEndedHandler=()=>{this.options_.isDisplayed()&&(e.addClass("vjs-upnext--showing"),this.showCard(i=>{e.removeClass("vjs-upnext--showing"),this.container.style.display="none",i||this.options_.next()}))},this.onPlayingHandler=()=>{this.upNextEvents.trigger("playing")},e.on(["auto-stopped","ended"],this.onEndedHandler),e.on("playing",this.onPlayingHandler)}dispose(){this.onEndedHandler&&this.player().off(["auto-stopped","ended"],this.onEndedHandler),this.onPlayingHandler&&this.player().off("playing",this.onPlayingHandler),this.timeout&&clearTimeout(this.timeout),super.dispose()}createEl(){let e=super.createEl("div",{className:"vjs-upnext-content",innerHTML:IL(this.options_)});return this.container=e,e.style.display="none",this.autoplayRing=e.getElementsByClassName("vjs-upnext-svg-autoplay-ring")[0],this.title=e.getElementsByClassName("vjs-upnext-title")[0],this.cancelButton=e.getElementsByClassName("vjs-upnext-cancel-button")[0],this.suspendedMessage=e.getElementsByClassName("vjs-upnext-suspended")[0],this.nextButton=e.getElementsByClassName("vjs-upnext-autoplay-icon")[0],this.cancelButton.onclick=()=>{this.upNextEvents.trigger("cancel")},this.nextButton.onclick=()=>{this.upNextEvents.trigger("next")},e}showCard(e){if(this.autoplayRing.setAttribute("stroke-dasharray",`${this.dashOffsetStart}`),this.autoplayRing.setAttribute("stroke-dashoffset",`${-this.dashOffsetStart}`),this.title.innerText=this.options_.getTitle(),this.totalTicks===0)return e(!1);this.upNextEvents.one("cancel",()=>{clearTimeout(this.timeout),this.timeout=void 0,e(!0)}),this.upNextEvents.one("playing",()=>{clearTimeout(this.timeout),this.timeout=void 0,e(!0)}),this.upNextEvents.one("next",()=>{clearTimeout(this.timeout),this.timeout=void 0,e(!1)});let t=n=>{let a=Math.max(-this.dashOffsetTotal,-this.dashOffsetStart-n*this.dashOffsetTotal/2/100);this.autoplayRing.setAttribute("stroke-dashoffset",""+a)},i=()=>{t(this.ticks++*100/this.totalTicks)},s=()=>{this.options_.isSuspended()?(this.suspendedMessage.innerText=this.options_.suspendedText,t(0),this.ticks=0,this.timeout=setTimeout(s.bind(this),300)):this.ticks>=this.totalTicks?(clearTimeout(this.timeout),this.timeout=void 0,e(!1)):(this.suspendedMessage.innerText="",i(),this.timeout=setTimeout(s.bind(this),this.interval))};this.container.style.display="block",this.timeout=setTimeout(s.bind(this),this.interval)}};X.registerComponent("EndCard",Ol);var kL=X.getPlugin("plugin"),bf=class extends kL{constructor(e,t){super(e);let i={next:t.next,getTitle:t.getTitle,timeout:t.timeout,cancelText:e.localize("Cancel"),headText:e.localize("Up Next"),suspendedText:e.localize("Autoplay is suspended"),isDisplayed:t.isDisplayed,isSuspended:t.isSuspended};this.player.ready(()=>{e.addClass("vjs-upnext")});let s=new Ol(e,i);e.addChild(s),this.on("dispose",()=>e.removeChild(s))}};X.registerPlugin("upnext",bf);var Mv=fs("peertube:player:web-video-plugin"),RL=X.getPlugin("plugin"),Sf=class extends RL{constructor(e,t){super(e,t),this.videoFiles=t.videoFiles,this.videoFileToken=t.videoFileToken;let i=this.pickAverageVideoFile();i&&this.updateVideoFile({videoFile:i,isUserResolutionChange:!1}),this.onLoadedMetadata=()=>{e.trigger("video-ratio-changed",{ratio:this.player.videoWidth()/this.player.videoHeight()})},e.on("loadedmetadata",this.onLoadedMetadata),e.ready(()=>{if(this.videoFiles.length===0){this.player.addClass("disabled");return}this.buildQualities(),this.setupNetworkInfoInterval()})}dispose(){this.networkInfoInterval&&clearInterval(this.networkInfoInterval),this.onLoadedMetadata&&this.player.off("loadedmetadata",this.onLoadedMetadata),this.onErrorHandler&&this.player.off("error",this.onErrorHandler),this.onPlayHandler&&this.player.off("canplay",this.onPlayHandler),super.dispose()}getCurrentResolutionId(){var e;return(e=this.currentVideoFile)==null?void 0:e.resolution.id}updateVideoFile(e){this.currentVideoFile=e.videoFile,Mv("Updating web video file to "+this.currentVideoFile.fileUrl);let t=this.player.paused(),i=this.player.playbackRate(),s=this.player.currentTime();this.onErrorHandler||(this.onErrorHandler=()=>this.player.peertube().displayFatalError(),this.player.one("error",this.onErrorHandler));let n=this.currentVideoFile.fileUrl;this.videoFileToken()&&(n=Bv(n,{videoFileToken:this.videoFileToken()}));let a=this.player.autoplay();e.isUserResolutionChange&&(this.player.autoplay(!1),this.player.addClass("vjs-updating-resolution")),this.player.src(n),this.onPlayHandler=()=>{var l;this.player.playbackRate(i),this.player.currentTime(s),this.player.trigger("resolution-change",{resolution:(l=this.currentVideoFile)==null?void 0:l.resolution.id,initResolutionChange:!e.isUserResolutionChange}),e.isUserResolutionChange&&(this.player.trigger("web-video-source-change"),this.tryToPlay().then(()=>{t&&this.player.pause(),this.player.autoplay(a)}))},this.player.one("canplay",this.onPlayHandler)}getCurrentVideoFile(){return this.currentVideoFile}tryToPlay(){Mv("Try to play manually the video");let e=this.player.play();if(e!==void 0)return e.catch(t=>{t.message.includes("The play() request was interrupted by a call to pause()")||(ze.warn(t),this.player.pause(),this.player.posterImage.show(),this.player.removeClass("vjs-has-autoplay"),this.player.removeClass("vjs-playing-audio-only-content"))}).finally(()=>{this.player.removeClass("vjs-updating-resolution")})}pickAverageVideoFile(){if(!this.videoFiles||this.videoFiles.length===0)return;if(this.videoFiles.length===1)return this.videoFiles[0];let e=this.videoFiles.filter(t=>t.resolution.id!==0);return e[Math.floor(e.length/2)]}buildQualities(){let e=this.videoFiles.map(t=>{var i;return{id:t.resolution.id,label:this.player.localize(Vv(t.resolution.label,t.fps)),height:t.resolution.id,selected:t.id===((i=this.currentVideoFile)==null?void 0:i.id),selectCallback:()=>this.updateVideoFile({videoFile:t,isUserResolutionChange:!0})}});this.player.peertubeResolutions().add(e)}setupNetworkInfoInterval(){this.networkInfoInterval=setInterval(()=>{var e;return this.player.trigger("network-info",{source:"web-video",http:{downloaded:this.player.bufferedPercent()*((e=this.currentVideoFile)==null?void 0:e.size)}})},1e3)}};X.registerPlugin("webVideo",Sf);var zT=X.getComponent("CaptionsButton");zT.prototype.controlText_="Subtitles/CC";zT.prototype.label_=" ";var PL=X.getComponent("PlaybackRateMenuButton");PL.prototype.controlText_="Speed";var Fv=X.getComponent("PlayProgressBar");Fv.prototype.options_.children.includes("timeTooltip")!==!0&&Fv.prototype.options_.children.push("timeTooltip");var Nv=class{constructor(e){Qe(this,"pluginsManager"),Qe(this,"videojsDecodeErrors",0),Qe(this,"player"),Qe(this,"currentLoadOptions"),this.options=e,this.pluginsManager=e.pluginsManager}unload(){this.player&&(this.disposeDynamicPluginsIfNeeded(),this.player.reset())}load(e){return mt(this,null,function*(){this.currentLoadOptions=e,this.setPoster(""),this.disposeDynamicPluginsIfNeeded(),yield this.buildPlayerIfNeeded(),this.currentLoadOptions.mode==="p2p-media-loader"?yield this.loadP2PMediaLoader():this.loadWebVideo(),this.loadDynamicPlugins(),this.options.controlBar===!1?this.player.controlBar.hide():this.player.controlBar.show(),this.player.autoplay(this.getAutoPlayValue(this.currentLoadOptions.autoplay)),this.player.autoplay()||this.setPoster(e.poster),this.player.trigger("video-change")})}getPlayer(){return this.player}destroy(){this.player&&this.player.dispose()}setPoster(e){var t;if(!this.player){this.options.playerElement().poster=e;return}(t=this.player)==null||t.poster(e),this.options.playerElement().poster=""}enable(){this.player&&(this.player.el().style.pointerEvents="auto")}disable(){this.player&&(this.player.isFullscreen()&&this.player.exitFullscreen(),this.player.hasStarted(!1),this.player.removeClass("vjs-has-autoplay"),this.player.bigPlayButton.hide(),this.player.el().style.pointerEvents="none")}setCurrentTime(e){if(this.player.paused()){this.currentLoadOptions.startTime=e,this.player.play();return}this.player.currentTime(e),this.player.userActive(!0)}loadP2PMediaLoader(){return mt(this,null,function*(){let e=new df(Ue(Ue({},ku(this.options,["pluginsManager","serverUrl","authorizationHeader","stunServers"])),ku(this.currentLoadOptions,["videoPassword","requiresUserAuth","videoFileToken","requiresPassword","isLive","p2pEnabled","liveOptions","hls"]))),{hlsjs:t,p2pMediaLoader:i}=yield e.getPluginOptions();this.player.hlsjs(t),this.player.p2pMediaLoader(i)})}loadWebVideo(){let e=new ff(ku(this.currentLoadOptions,["videoFileToken","webVideo","hls"]));this.player.webVideo(e.getPluginOptions())}buildPlayerIfNeeded(){return mt(this,null,function*(){if(this.player)return;yield EE.loadLocaleInVideoJS(this.options.serverUrl,this.options.language,X);let e=yield this.pluginsManager.runHook("filter:internal.player.videojs.options.result",this.getVideojsOptions());this.player=X(this.options.playerElement(),e),this.player.ready(()=>{isNaN(+this.options.playbackRate)||this.player.playbackRate(+this.options.playbackRate);let t=!1,i=()=>{t||(t=!0,this.currentLoadOptions.mode==="p2p-media-loader"?this.tryToRecoverHLSError(this.player.error()):this.maybeFallbackToWebVideo())};this.player.on("video-change",()=>t=!1),this.player.on("error",()=>i()),this.player.on("network-info",(s,n)=>{n.source!=="p2p-media-loader"||isNaN(n.bandwidthEstimate)||ZE(n.bandwidthEstimate)}),this.player.contextMenu(this.getContextMenuOptions()),this.displayNotificationWhenOffline()})})}disposeDynamicPluginsIfNeeded(){this.player&&(this.player.usingPlugin("peertubeMobile")&&this.player.peertubeMobile().dispose(),this.player.usingPlugin("peerTubeHotkeysPlugin")&&this.player.peerTubeHotkeysPlugin().dispose(),this.player.usingPlugin("playlist")&&this.player.playlist().dispose(),this.player.usingPlugin("bezels")&&this.player.bezels().dispose(),this.player.usingPlugin("upnext")&&this.player.upnext().dispose(),this.player.usingPlugin("stats")&&this.player.stats().dispose(),this.player.usingPlugin("storyboard")&&this.player.storyboard().dispose(),this.player.usingPlugin("chapters")&&this.player.chapters().dispose(),this.player.usingPlugin("peertubeNSFW")&&this.player.peertubeNSFW().dispose(),this.player.usingPlugin("peertubeDock")&&this.player.peertubeDock().dispose(),this.player.usingPlugin("p2pMediaLoader")&&this.player.p2pMediaLoader().dispose(),this.player.usingPlugin("hlsjs")&&this.player.hlsjs().dispose(),this.player.usingPlugin("webVideo")&&this.player.webVideo().dispose())}loadDynamicPlugins(){No()&&this.player.peertubeMobile(),this.player.bezels(),this.player.stats({videoUUID:this.currentLoadOptions.videoUUID,videoIsLive:this.currentLoadOptions.isLive,mode:this.currentLoadOptions.mode,p2pEnabled:this.currentLoadOptions.p2pEnabled}),this.options.enableHotkeys===!0&&this.player.peerTubeHotkeysPlugin({isLive:this.currentLoadOptions.isLive}),this.currentLoadOptions.playlist&&this.player.playlist(this.currentLoadOptions.playlist),this.currentLoadOptions.upnext&&this.player.upnext({timeout:this.currentLoadOptions.upnext.timeout,getTitle:()=>this.currentLoadOptions.nextVideo.getVideoTitle(),next:()=>this.currentLoadOptions.nextVideo.handler(),isDisplayed:()=>this.currentLoadOptions.nextVideo.enabled&&this.currentLoadOptions.upnext.isEnabled(),isSuspended:()=>this.currentLoadOptions.upnext.isSuspended(this.player)}),this.currentLoadOptions.storyboard&&this.player.storyboard(this.currentLoadOptions.storyboard),this.currentLoadOptions.videoChapters&&this.player.chapters({chapters:this.currentLoadOptions.videoChapters}),this.currentLoadOptions.dock&&this.player.peertubeDock(this.currentLoadOptions.dock),this.currentLoadOptions.nsfwWarning&&this.player.peertubeNSFW(this.currentLoadOptions.nsfwWarning)}tryToRecoverHLSError(e){return mt(this,null,function*(){if(e.code===MediaError.MEDIA_ERR_DECODE){if(this.videojsDecodeErrors===0&&this.options.errorNotifier(this.player.localize("The video failed to play, will try to fast forward.")),this.videojsDecodeErrors===20){this.maybeFallbackToWebVideo();return}ze.info("Fast forwarding HLS to recover from an error.",{err:e,videoShortUUID:this.currentLoadOptions.videoShortUUID,currentTime:this.player.currentTime(),resolution:this.player.videoHeight()}),this.videojsDecodeErrors++,yield this.load(ht(Ue({},this.currentLoadOptions),{mode:"p2p-media-loader",startTime:this.player.currentTime()+2,autoplay:!0}))}else this.maybeFallbackToWebVideo()})}maybeFallbackToWebVideo(){return mt(this,null,function*(){if(this.currentLoadOptions.mode==="web-video"){this.player.peertube().displayFatalError();return}ze.info("Fallback to web-video."),yield this.load(ht(Ue({},this.currentLoadOptions),{mode:"web-video",startTime:this.player.currentTime(),autoplay:!0}))})}getVideojsOptions(){let e={preloadTextTracks:!1,nativeTextTracks:!1},t={peertube:{hasAutoplay:()=>this.getAutoPlayValue(this.currentLoadOptions.autoplay),videoViewUrl:()=>this.currentLoadOptions.videoViewUrl,videoViewIntervalMs:this.options.videoViewIntervalMs,authorizationHeader:this.options.authorizationHeader,videoDuration:()=>this.currentLoadOptions.duration,startTime:()=>this.currentLoadOptions.startTime,stopTime:()=>this.currentLoadOptions.stopTime,videoCaptions:()=>this.currentLoadOptions.videoCaptions,isLive:()=>this.currentLoadOptions.isLive,videoUUID:()=>this.currentLoadOptions.videoUUID,subtitle:()=>this.currentLoadOptions.subtitle,videoRatio:()=>this.currentLoadOptions.videoRatio,poster:()=>this.currentLoadOptions.poster,autoPlayerRatio:this.options.autoPlayerRatio},metrics:{mode:()=>this.currentLoadOptions.mode,metricsUrl:()=>this.options.metricsUrl,metricsInterval:()=>this.options.metricsInterval,videoUUID:()=>this.currentLoadOptions.videoUUID}},i=new lf(ht(Ue({},this.options),{videoShortUUID:()=>this.currentLoadOptions.videoShortUUID,p2pEnabled:()=>this.currentLoadOptions.p2pEnabled,nextVideo:()=>this.currentLoadOptions.nextVideo,previousVideo:()=>this.currentLoadOptions.previousVideo}));return{html5:e,textTrackSettings:!1,controls:this.options.controls!==void 0?this.options.controls:!0,loop:this.options.loop!==void 0?this.options.loop:!1,muted:this.options.muted!==void 0?this.options.muted:void 0,autoplay:this.getAutoPlayValue(this.currentLoadOptions.autoplay),poster:this.currentLoadOptions.poster,inactivityTimeout:this.options.inactivityTimeout,playbackRates:[.25,.5,.75,1,1.25,1.5,1.75,2],plugins:t,controlBar:{children:i.getChildrenOptions()},language:this.options.language&&!jv(this.options.language)?this.options.language:void 0}}getAutoPlayValue(e){return e!==!0?!1:this.currentLoadOptions.forceAutoplay?"any":"play"}displayNotificationWhenOffline(){let e=document.createElement("div");e.classList.add("vjs-peertube-offline-notification"),e.innerText=this.player.localize("You seem to be offline and the video may not work");let t=!1,i=()=>{t&&(this.player.el().removeChild(e),t=!1,ze.info("The browser is online"))},s=()=>{t||(this.player.el().appendChild(e),t=!0,ze.info("The browser is offline"))};window.addEventListener("online",i),window.addEventListener("offline",s),this.player.on("dispose",()=>{window.removeEventListener("online",i),window.removeEventListener("offline",s)})}getContextMenuOptions(){return{content:()=>{let t=this,i=this.player,s=t.currentLoadOptions.videoShortUUID,n=i.options_.loop,a=[{icon:"repeat",label:i.localize("Play in loop")+(n?'<span class="vjs-icon-tick-white"></span>':""),listener:function(){i.options_.loop=!n}},{label:i.localize("Copy the video URL"),listener:function(){Ru(Wh({shortUUID:s}),i.el())}},{label:i.localize("Copy the video URL at the current time"),listener:function(){let l=Wh({shortUUID:s});Ru(Uv({url:l,startTime:i.currentTime()}),i.el())}},{icon:"code",label:i.localize("Copy embed code"),listener:()=>{Ru(SE({embedUrl:t.currentLoadOptions.embedUrl,embedTitle:t.currentLoadOptions.embedTitle}),i.el())}}];return a.push({icon:"info",label:i.localize("Stats for nerds"),listener:()=>{i.stats().show()}}),a.map(l=>ht(Ue({},l),{label:`<span class="vjs-icon-${l.icon||"link-2"}"></span>`+l.label}))}}}};export{qv as a,X as b,YE as c,Yv as d,xL as e,Nv as f};
/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*/
//# sourceMappingURL=chunk-R64WLZOJ.js.map
