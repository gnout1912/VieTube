import{a as he}from"./chunk-LSIL47EV.js";import{a as Re}from"./chunk-DEVNJA25.js";import{c as Te}from"./chunk-BFVCLNOF.js";import{e as fe}from"./chunk-BOZAQTZE.js";import{b as ue,c as me}from"./chunk-25AA3I7H.js";import{a as Ee}from"./chunk-6JJL547V.js";import{m as Se,o as de,p as pe}from"./chunk-RT7DTAS6.js";import{B as le,C as ae,c as te,g as ie,h as oe,n as re,q as se,t as _e}from"./chunk-WO4VNXA3.js";import{Ad as ce,Ag as ge,Bb as f,Bc as ee,Cb as p,Dc as I,Ea as B,Ha as c,Ic as ne,Mb as q,Na as j,Nb as J,Ob as v,Sa as M,Wa as W,Xf as U,Ya as S,Zb as y,aa as b,eb as a,ga as V,ha as P,ia as O,jb as m,jc as Z,la as Y,lf as Ce,lg as be,nb as s,ob as _,pb as N,q as z,qb as E,r as X,rb as R,ta as g,tb as A,v as k,xb as u,yb as K,zb as Q,zd as w}from"./chunk-F7FAPFPY.js";import{i as h}from"./chunk-AI7IVZV2.js";function Me(n,o){n&1&&(s(0,"span"),u(1,0),_());}function Ne(n,o){n&1&&(s(0,"span"),u(1,1),_());}function Ae(n,o){n&1&&(s(0,"my-help"),E(1),u(2,2),R(),_());}function Ie(n,o){n&1&&(s(0,"my-help"),E(1),u(2,3),R(),_());}var Pe=(()=>{let o=class o extends me{formReactiveService=b(ue);notifier=b(U);uri=g(void 0);interact=g(!1);showHelp=g(!1);ngOnInit(){this.buildForm({text:fe});}onValidKey(){this.forceCheck(),this.form.valid&&this.formValidated();}formValidated(){let t=this.form.value.text||"";t=t.replace(/^@/,"");let[i,e]=t.split("@");fetch(`https://${e}/.well-known/webfinger?resource=acct:${i}@${e}`).then(l=>l.json()).then(l=>{if(!l||Array.isArray(l.links)===!1)throw new Error("Not links in webfinger response");let C=l.links.find(T=>T&&typeof T.template=="string"&&T.rel==="http://ostatus.org/schema/1.0/subscribe");if(C?.template.includes("{uri}"))return C.template.replace("{uri}",encodeURIComponent(this.uri()));throw new Error("No subscribe template in webfinger response");}).then(l=>Re()?window.location.href=l:window.open(l)).catch(l=>{Ce.error(l),this.notifier.error("Ne povas akiri informojn pri \u0109i tiu defora konto");});}};h(o,"\u0275fac",(()=>{let t;return function(e){return(t||(t=Y(o)))(e||o);};})()),h(o,"\u0275cmp",M({type:o,selectors:[["my-remote-subscribe"]],inputs:{uri:[1,"uri"],interact:[1,"interact"],showHelp:[1,"showHelp"]},features:[W],decls:8,vars:5,consts:()=>{let t;t="Remote interact";let i;i="Remote subscribe";let e;e="Vi poval aboni la kanalon per \u0109iu nodo de la federuniverso, kapabla je ActivityPub (ekzemple PeerTube, Mastodono, a\u016D Pleromo).";let l;return l="Vi povas interagi kun \u0109i tio per \u0109iu nodo de la federuniverso, kapabla je ActivityPub (PeerTube, Mastodono a\u016D Pleromo, ekzemple).",[t,i,e,l,["novalidate","",3,"ngSubmit","formGroup"],[1,"form-group"],["type","email","formControlName","text","placeholder","jane_doe@example.com",1,"form-control",3,"keyup.control.enter","keyup.meta.enter"],["type","submit",1,"peertube-button","primary-button",3,"disabled"],[4,"ngIf"]];},template:function(i,e){i&1&&(s(0,"form",4),f("ngSubmit",function(){return e.formValidated();}),s(1,"div",5)(2,"input",6),f("keyup.control.enter",function(){return e.onValidKey();})("keyup.meta.enter",function(){return e.onValidKey();}),_()(),s(3,"button",7),S(4,Me,2,0,"span")(5,Ne,2,0,"span"),_(),S(6,Ae,3,0,"my-help",8)(7,Ie,3,0,"my-help",8),_()),i&2&&(a("formGroup",e.form),c(3),a("disabled",!e.form.valid),c(),m(e.interact()?4:5),c(2),a("ngIf",!e.interact()&&e.showHelp()),c(),a("ngIf",e.showHelp()&&e.interact()));},dependencies:[le,re,te,ie,oe,ae,se,_e,I,Ee],encapsulation:2}));let n=o;return n;})();var Ue=["dropdown"],Be=n=>({big:n}),ve=n=>({"extra-text":n});function ye(n,o){n&1&&(E(0),u(1,4),R());}function we(n,o){if(n&1&&(s(0,"div",24),u(1,6),_()),n&2){let r=p(3);c(),K(r.subscribeStatus(!0).length)(r.subscribed.size),Q(1);}}function $e(n,o){if(n&1&&(s(0,"div"),u(1,5),_(),S(2,we,2,2,"div",23)),n&2){let r=p(2);c(2),a("ngIf",r.isAtLeastOneChannelSubscribed);}}function De(n,o){if(n&1&&(s(0,"div",22),S(1,ye,2,0,"ng-container")(2,$e,3,1),_()),n&2){let r=p();a("ngClass",y(2,ve,r.isAtLeastOneChannelSubscribed)),c(),m(r.isSingleSubscribe?1:2);}}function He(n,o){n&1&&(E(0),u(1,7),R());}function xe(n,o){n&1&&(E(0),u(1,8),R());}function Le(n,o){if(n&1){let r=A();s(0,"button",26),f("click",function(){P(r);let i=p(2);return O(i.unsubscribe());}),S(1,He,2,0,"ng-container")(2,xe,2,0,"ng-container"),_();}if(n&2){let r=p(2);a("ngClass",r.buttonClasses),c(),m(r.account()?1:2);}}function Fe(n,o){}function Ge(n,o){if(n&1){let r=A();s(0,"button",27),f("click",function(){P(r);let i=p(2);return O(i.subscribe());}),S(1,Fe,0,0,"ng-template",28),_(),N(2,"button",29);}if(n&2){let r=p(2),t=v(2);a("ngClass",r.buttonClasses),c(),a("ngTemplateOutlet",t),c(),a("ngClass",r.buttonClasses);}}function ze(n,o){if(n&1&&S(0,Le,3,2,"button",25)(1,Ge,3,3),n&2){let r=p();m(r.isAllChannelsSubscribed?0:1);}}function Xe(n,o){}function ke(n,o){if(n&1&&(s(0,"button",14),S(1,Xe,0,0,"ng-template",28),_()),n&2){let r=p(),t=v(2);a("ngClass",r.buttonClasses),c(),a("ngTemplateOutlet",t);}}function Ve(n,o){n&1&&(s(0,"span"),u(1,9),_());}function Ye(n,o){n&1&&(s(0,"span"),u(1,10),_());}function je(n,o){if(n&1&&(s(0,"div",30)(1,"div",31),u(2,11),_(),N(3,"my-remote-subscribe",32),_()),n&2){let r=p();c(3),a("showHelp",!0)("uri",r.uri);}}function We(n,o){if(n&1&&(s(0,"a",21),u(1,12),_()),n&2){let r=p();a("href",r.podcastFeedUri,B);}}var Rn=(()=>{let o=class o{authService=b(be);redirectService=b(ge);notifier=b(U);userSubscriptionService=b(he);videoService=b(Te);account=g(void 0);videoChannels=g(void 0);size=g("normal");dropdown=j("dropdown");subscribed=new Map();buttonClasses={};get handle(){let t=this.account();return t?t.nameWithHost:this.videoChannel.name+"@"+this.videoChannel.host;}get channelHandle(){return this.getChannelHandler(this.videoChannel);}get uri(){let t=this.account();return t?t.url:this.videoChannels()[0].url;}get rssUri(){let t=this.account();return(t?this.videoService.getAccountFeedUrls(t.id).find(e=>e.format===w.RSS):this.videoService.getVideoChannelFeedUrls(this.videoChannels()[0].id).find(e=>e.format===w.RSS)).url;}get podcastFeedUri(){return this.account()?void 0:this.videoService.getVideoChannelFeedUrls(this.videoChannels()[0].id).find(t=>t.type===ce.PODCAST).url;}get videoChannel(){return this.videoChannels()[0];}get isAllChannelsSubscribed(){return this.subscribeStatus(!0).length===this.videoChannels().length;}get isAtLeastOneChannelSubscribed(){return this.subscribeStatus(!0).length>0;}get isBigButton(){return this.isUserLoggedIn()&&this.videoChannels().length>1&&this.isAtLeastOneChannelSubscribed;}get isSingleSubscribe(){return!this.account();}ngOnChanges(){this.loadSubscribedStatus(),this.buildClasses();}subscribe(){let t=this.dropdown();return t&&t.close(),this.isUserLoggedIn()?this.localSubscribe():this.gotoLogin();}localSubscribe(){let t=this.subscribeStatus(!1),i=this.videoChannels().map(e=>this.getChannelHandler(e)).filter(e=>t.includes(e)).map(e=>this.userSubscriptionService.addSubscription(e));X(i).subscribe({next:()=>{this.buildClasses();let e=this.account();this.notifier.success(e?"Abonanta \u0109iujn nunajn kanalojn de "+e.displayName+". Vi scii\u011Dos pri \u0109iuj \u011Diaj novaj filmoj.":"Abonanta je "+this.videoChannels()[0].displayName+". Vi scii\u011Dos pri \u0109iuj \u011Diaj novaj filmoj.","Abonita");},error:e=>this.notifier.error(e.message)});}unsubscribe(){let t=this.dropdown();t&&t.close(),this.isUserLoggedIn()&&this.localUnsubscribe();}localUnsubscribe(){let t=this.subscribeStatus(!0),i=this.videoChannels().map(e=>this.getChannelHandler(e)).filter(e=>t.includes(e)).map(e=>this.userSubscriptionService.deleteSubscription(e));z(...i).subscribe({complete:()=>{this.buildClasses();let e=this.account();this.notifier.success(e?"Malabonis \u0109iujn kanalojn de\n          "+e.nameWithHost+"\n        ":"Malabonis\n          "+this.videoChannels()[0].nameWithHost+"\n        ","Malabonita");},error:e=>this.notifier.error(e.message)});}isUserLoggedIn(){return this.authService.isLoggedIn();}gotoLogin(){this.redirectService.redirectToLogin();}subscribeStatus(t){let i=[];for(let[e,l]of this.subscribed.entries())l===t&&i.push(e);return i;}isSubscribedToAll(){return Array.from(this.subscribed.values()).every(t=>t===!0);}isRemoteSubscribeAvailable(){return this.isSingleSubscribe&&!this.isUserLoggedIn();}getChannelHandler(t){return t.name+"@"+t.host;}loadSubscribedStatus(){if(this.isUserLoggedIn())for(let t of this.videoChannels()){let i=this.getChannelHandler(t);this.subscribed.set(i,!1),k(this.userSubscriptionService.listenToSubscriptionCacheChange(i),this.userSubscriptionService.doesSubscriptionExist(i)).subscribe({next:e=>{this.subscribed.set(i,e),this.buildClasses();},error:e=>this.notifier.error(e.message)});}}buildClasses(){this.buttonClasses={"peertube-button":!0,"primary-button":!this.isAllChannelsSubscribed,"secondary-button":this.isAllChannelsSubscribed};}};h(o,"\u0275fac",function(i){return new(i||o)();}),h(o,"\u0275cmp",M({type:o,selectors:[["my-subscribe-button"]],viewQuery:function(i,e){i&1&&q(e.dropdown,Ue,5),i&2&&J();},inputs:{account:[1,"account"],videoChannels:[1,"videoChannels"],size:[1,"size"]},features:[V],decls:18,vars:8,consts:()=>{let t;t="Pluraj manieroj aboni la nunan kanalon";let i;i="Per konto de ActivityPub";let e;e="Per abonfluo";let l;l="Aboni per RSS";let C;C="Aboni";let T;T="Aboni \u0109iujn kanalojn";let $;$=""+"\uFFFD0\uFFFD"+"/"+"\uFFFD1\uFFFD"+" channels subscribed ";let D;D="Unsubscribe from all channels";let H;H="Unsubscribe";let x;x="Aboni per via loka konto";let L;L="Aboni per konto \u0109e tiu \u0109i nodo";let F;F="Aboni per defora konto:";let G;return G="Subscribe via Podcast Feed",[["subscribeContent",""],i,e,l,C,T,$,D,H,x,L,F,G,["role","group","ngbDropdown","dropdown","autoClose","outside","placement","bottom-right bottom-left bottom auto","role","group","aria-label",t,1,"btn-group",3,"ngClass"],["ngbDropdownToggle","","type","button",1,"btn",3,"ngClass"],["ngbDropdownMenu","",1,"dropdown-menu"],[1,"dropdown-header"],["type","button",1,"dropdown-item",3,"click"],["type","button","class","dropdown-item dropdown-item-neutral",4,"ngIf"],[1,"dropdown-divider"],["target","_blank","class","dropdown-item",3,"href",4,"ngIf"],["target","_blank",1,"dropdown-item",3,"href"],[1,"d-inline-block",3,"ngClass"],["class","fs-8 fw-normal lh-1",4,"ngIf"],[1,"fs-8","fw-normal","lh-1"],["type","button",1,"btn","last-in-group",3,"ngClass"],["type","button",1,"btn","last-in-group",3,"click","ngClass"],["type","button",1,"btn",3,"click","ngClass"],[3,"ngTemplateOutlet"],["type","button","ngbDropdownToggle","","aria-label","Open subscription dropdown",1,"btn","dropdown-toggle-split",3,"ngClass"],["type","button",1,"dropdown-item","dropdown-item-neutral"],[1,"mb-1"],[3,"showHelp","uri"]];},template:function(i,e){if(i&1){let l=A();s(0,"div",13),S(1,De,3,4,"ng-template",null,0,Z)(3,ze,2,1)(4,ke,2,2,"button",14),s(5,"div",15)(6,"h6",16),u(7,1),_(),s(8,"button",17),f("click",function(){return P(l),O(e.subscribe());}),S(9,Ve,2,0,"span")(10,Ye,2,0,"span"),_(),S(11,je,4,2,"div",18),N(12,"div",19),s(13,"h6",16),u(14,2),_(),S(15,We,2,1,"a",20),s(16,"a",21),u(17,3),_()()();}i&2&&(a("ngClass",y(6,Be,e.isBigButton)),c(3),m(e.isUserLoggedIn()?3:4),c(6),m(e.isUserLoggedIn()?9:10),c(2),a("ngIf",e.isRemoteSubscribeAvailable()),c(4),a("ngIf",e.podcastFeedUri),c(),a("href",e.rssUri,B));},dependencies:[ee,I,ne,pe,de,Se,Pe],styles:[`.btn-group[_ngcontent-%COMP%]{padding:0}.btn-group[_ngcontent-%COMP%]   .peertube-button[_ngcontent-%COMP%]{z-index:unset!important;padding:var(--input-y-padding) 10px}.btn-group[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]:after{position:relative;top:1px}.btn-group[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]:not(.dropdown-toggle-split):after{margin-left:.5rem}.btn-group[_ngcontent-%COMP%]   .dropdown-toggle-split[_ngcontent-%COMP%]{padding-left:8px;padding-right:8px}.btn-group[_ngcontent-%COMP%]:not(.big){white-space:nowrap}.btn-group.big[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:first-child{width:max-content;min-width:175px}.btn-group[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{cursor:default}.btn-group[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}@media screen and (max-width: 500px){.btn-group[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]{white-space:normal}}.btn-group[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   .dropdown-item-neutral[_ngcontent-%COMP%]{cursor:default}.btn-group[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   .dropdown-item-neutral[_ngcontent-%COMP%]:hover, .btn-group[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   .dropdown-item-neutral[_ngcontent-%COMP%]:focus{background-color:inherit}.btn-group[_ngcontent-%COMP%]     form{padding:.25rem 1rem}.btn-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:16px;padding:var(--input-y-padding) var(--input-x-padding);width:100%;max-width:100%;color:var(--input-fg);background-color:var(--input-bg);border:1px solid var(--input-border-color);border-radius:var(--input-border-radius);line-height:24px}.btn-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder);font-size:14px}.btn-group[_ngcontent-%COMP%]   input[readonly][_ngcontent-%COMP%]{color:var(--fg-300)}.btn-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .btn-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 .2rem var(--fg-100);outline:0}.btn-group[_ngcontent-%COMP%]   input[disabled][_ngcontent-%COMP%]{color:var(--fg-300);opacity:.8}@media screen and (max-width: calc(100% + 40px)){.btn-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}}
/*# sourceMappingURL=subscribe-button.component-FRWUCFBP.css.map */`]}));let n=o;return n;})();export{Pe as a,Rn as b};/**i18n:1cf7c077143c4c267fdafbe5508f191afcef21bad6aba22a3a8dc180e1003753*///# sourceMappingURL=chunk-736AMHRO.js.map